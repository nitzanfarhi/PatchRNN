commit 8abde9acdfc82aacbfd96e65fe416c29c4856500
Author: Ian Abbott <abbotti@mev.co.uk>
Date:   Wed Mar 8 18:44:31 2017 +0000

    staging: comedi: jr3_pci: check PCI BAR 0 size
    
    The various supported boards have different numbers of subdevices from 1
    to 4.  Each subdevice needs a block of registers in PCI BAR 0.  Check
    the region is large enough for the required number of subdevices.
    Return an error from `jr3_pci_auto_attach()` if it is too small.
    
    Signed-off-by: Ian Abbott <abbotti@mev.co.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/comedi/drivers/jr3_pci.c b/drivers/staging/comedi/drivers/jr3_pci.c
index c0ae92217932..a21344e1a4c3 100644
--- a/drivers/staging/comedi/drivers/jr3_pci.c
+++ b/drivers/staging/comedi/drivers/jr3_pci.c
@@ -705,6 +705,9 @@ static int jr3_pci_auto_attach(struct comedi_device *dev,
 	if (ret)
 		return ret;
 
+	if (pci_resource_len(pcidev, 0) < board->n_subdevs * sizeof(*block))
+		return -ENXIO;
+
 	dev->mmio = pci_ioremap_bar(pcidev, 0);
 	if (!dev->mmio)
 		return -ENOMEM;

