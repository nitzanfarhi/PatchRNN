commit bc6ab72bc7af27189e7b524b97e45c6fcadab5cf
Author: Michael Niedermayer <michael@niedermayer.cc>
Date:   Wed Jun 28 20:29:02 2017 +0200

    avcodec/vb: Check vertical GMC component before multiply
    
    Fixes: runtime error: signed integer overflow: 8224 * 663584 cannot be represented in type 'int'
    Fixes: 2393/clusterfuzz-testcase-minimized-6128334993883136
    
    Found-by: continuous fuzzing process https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg
    Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>

diff --git a/libavcodec/vb.c b/libavcodec/vb.c
index 560165adc7..021657f7d8 100644
--- a/libavcodec/vb.c
+++ b/libavcodec/vb.c
@@ -205,6 +205,10 @@ static int decode_frame(AVCodecContext *avctx, void *data, int *got_frame,
     if (flags & VB_HAS_GMC) {
         i = (int16_t)bytestream2_get_le16(&c->stream);
         j = (int16_t)bytestream2_get_le16(&c->stream);
+        if (FFABS(j) > avctx->height) {
+            av_log(avctx, AV_LOG_ERROR, "GMV out of range\n");
+            return AVERROR_INVALIDDATA;
+        }
         offset = i + j * avctx->width;
     }
     if (flags & VB_HAS_VIDEO) {

