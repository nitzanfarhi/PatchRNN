commit 0e0d5e0c4bb0476d53a43bfc87d03a25ec4b5579
Author: Sage Weil <sage@newdream.net>
Date:   Fri Apr 2 16:07:19 2010 -0700

    ceph: fix ack counter reset on connection reset
    
    If in_seq_acked isn't reset along with in_seq, we don't ack received
    messages until we reach the old count, consuming gobs memory on the other
    end of the connection and introducing a large delay when those messages
    are eventually deleted.
    
    Signed-off-by: Sage Weil <sage@newdream.net>

diff --git a/fs/ceph/messenger.c b/fs/ceph/messenger.c
index a32f0f896d9f..f35b4945a9c3 100644
--- a/fs/ceph/messenger.c
+++ b/fs/ceph/messenger.c
@@ -332,6 +332,7 @@ static void reset_connection(struct ceph_connection *con)
 		con->out_msg = NULL;
 	}
 	con->in_seq = 0;
+	con->in_seq_acked = 0;
 }
 
 /*

