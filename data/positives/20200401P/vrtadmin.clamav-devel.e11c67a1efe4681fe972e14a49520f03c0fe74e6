commit e11c67a1efe4681fe972e14a49520f03c0fe74e6
Author: David Raynor <draynor@sourcefire.com>
Date:   Tue Feb 19 16:23:51 2013 -0500

    cid #10403 follow-up

diff --git a/libclamunrar_iface/unrar_iface.c b/libclamunrar_iface/unrar_iface.c
index ff828354a..3547a2f0e 100644
--- a/libclamunrar_iface/unrar_iface.c
+++ b/libclamunrar_iface/unrar_iface.c
@@ -313,7 +313,10 @@ int unrar_open(int fd, const char *dirname, unrar_state_t *state)
 	unrar_dbgmsg("UNRAR: Offset: %x\n", offset);
 	if(offset < 0){
 	    unrar_dbgmsg("UNRAR: Error Offset: %d\n", offset);
-	    offset = 0;
+	    free(main_hdr);
+	    free(state->comment_dir);
+	    free(unpack_data);
+	    return UNRAR_ERR;
 	}
 	comment_header = read_header(fd, COMM_HEAD);
 	if(comment_header) {

