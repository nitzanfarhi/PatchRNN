commit 420d1df2e2a857eae45fa947e16eae7494793d57
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Thu Mar 29 17:52:21 2012 +0000

    apedec: check bits <= 32.
    
    Fixes a floating-point exception further down.
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    CC: libav-stable@libav.org
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
    Signed-off-by: Ronald S. Bultje <rsbultje@gmail.com>
    Signed-off-by: Derek Buitenhuis <derek.buitenhuis@gmail.com>

diff --git a/libavcodec/apedec.c b/libavcodec/apedec.c
index a9953e1b3..1f982670f 100644
--- a/libavcodec/apedec.c
+++ b/libavcodec/apedec.c
@@ -421,9 +421,12 @@ static inline int ape_decode_value(APEContext *ctx, APERice *rice)
 
         if (tmpk <= 16)
             x = range_decode_bits(ctx, tmpk);
-        else {
+        else if (tmpk <= 32) {
             x = range_decode_bits(ctx, 16);
             x |= (range_decode_bits(ctx, tmpk - 16) << 16);
+        } else {
+            av_log(ctx->avctx, AV_LOG_ERROR, "Too many bits: %d\n", tmpk);
+            return AVERROR_INVALIDDATA;
         }
         x += overflow << tmpk;
     } else {

