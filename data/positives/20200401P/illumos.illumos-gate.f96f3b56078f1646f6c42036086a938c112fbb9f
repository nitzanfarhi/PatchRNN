commit f96f3b56078f1646f6c42036086a938c112fbb9f
Author: Srikanth, Ramana <Ramana.Srikanth@Sun.COM>
Date:   Fri Dec 4 19:21:57 2009 -0500

    6901707 panic BAD TRAP: Page fault in module "pmcs" due to NULL pointer dereference when reseating SAS cable

diff --git a/usr/src/uts/common/io/scsi/adapters/pmcs/pmcs_ds.c b/usr/src/uts/common/io/scsi/adapters/pmcs/pmcs_ds.c
index fb8a423060..289f1f77f2 100644
--- a/usr/src/uts/common/io/scsi/adapters/pmcs/pmcs_ds.c
+++ b/usr/src/uts/common/io/scsi/adapters/pmcs/pmcs_ds.c
@@ -53,6 +53,12 @@ pmcs_get_dev_state(pmcs_hw_t *pwp, pmcs_phy_t *phyp, pmcs_xscsi_t *xp,
 	if (xp != NULL) {
 		ASSERT(mutex_owned(&xp->statlock));
 	}
+
+	if (phyp == NULL) {
+		pmcs_prt(pwp, PMCS_PRT_DEBUG_DEV_STATE, NULL, xp,
+		    "%s: PHY is NULL", __func__);
+		return (-1);
+	}
 	ASSERT(mutex_owned(&phyp->phy_lock));
 
 	pwrk = pmcs_gwork(pwp, PMCS_TAG_TYPE_WAIT, phyp);

