commit e84956f92a846246b09b34f2a728329c386d250f
Author: Rafael J. Wysocki <rjw@sisk.pl>
Date:   Mon Oct 6 11:59:29 2008 +0200

    x86 ACPI: Blacklist two HP machines with buggy BIOSes
    
    There is a bug in the BIOSes of some HP boxes with AMD Turions which
    connects IO-APIC pins with ACPI thermal trip points in such a way that
    if the state of the IO-APIC is not as expected by the (buggy) BIOS, the
    thermal trip points are set to insanely low values (usually all of them
    become 16 degrees Celsius).  As a result, thermal throttling kicks in
    and knock the system down to its shoes.
    
    Unfortunately some of the recent IO-APIC changes made the bug show up.
    To prevent this from happening, blacklist machines that are known to be
    affected (nx6115 and 6715b in this particular case).
    
    This fixes http://bugzilla.kernel.org/show_bug.cgi?id=11516 listed as
    a regression from 2.6.26.
    
    On my box it was caused by:
    
    commit 691874fa96d6349a8b60f8ea9c2bae52ece79941
    Author: Maciej W. Rozycki <macro@linux-mips.org>
    Date:   Tue May 27 21:19:51 2008 +0100
    
        x86: I/O APIC: timer through 8259A second-chance
    
        Signed-off-by: Maciej W. Rozycki <macro@linux-mips.org>
        Signed-off-by: Ingo Molnar <mingo@elte.hu>
    
    and the whole story is described in this (huge) thread:
    
        http://marc.info/?l=linux-kernel&m=121358440508410&w=4
    
    Matthew Garrett told us about that happening on the nx6125:
    
        http://marc.info/?l=linux-kernel&m=121396307411930&w=4
    
    and then Maciej analysed the breakage on the basis of a DSDT from the
    nx6325:
    
        http://marc.info/?l=linux-kernel&m=121401068718826&w=4
    
    As far as the Dmitry's and Jason's boxes are concerned, I recognized the
    symptoms and asked them to verify that the blacklisting helped.
    
    It appears that the buggy BIOS code has been copy-pasted to the entire
    range of machines, for no good reason.
    
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Tested-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Tested-by: Jason Vas Dias <jason.vas.dias@gmail.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/arch/x86/kernel/acpi/boot.c b/arch/x86/kernel/acpi/boot.c
index bfd10fd211cd..c102af85df9c 100644
--- a/arch/x86/kernel/acpi/boot.c
+++ b/arch/x86/kernel/acpi/boot.c
@@ -1603,6 +1603,14 @@ static struct dmi_system_id __initdata acpi_dmi_table[] = {
 	 * is not connected at all.  Force ignoring BIOS IRQ0 pin2
 	 * override in that cases.
 	 */
+	{
+	 .callback = dmi_ignore_irq0_timer_override,
+	 .ident = "HP nx6115 laptop",
+	 .matches = {
+		     DMI_MATCH(DMI_SYS_VENDOR, "Hewlett-Packard"),
+		     DMI_MATCH(DMI_PRODUCT_NAME, "HP Compaq nx6115"),
+		     },
+	 },
 	{
 	 .callback = dmi_ignore_irq0_timer_override,
 	 .ident = "HP NX6125 laptop",
@@ -1619,6 +1627,14 @@ static struct dmi_system_id __initdata acpi_dmi_table[] = {
 		     DMI_MATCH(DMI_PRODUCT_NAME, "HP Compaq nx6325"),
 		     },
 	 },
+	{
+	 .callback = dmi_ignore_irq0_timer_override,
+	 .ident = "HP 6715b laptop",
+	 .matches = {
+		     DMI_MATCH(DMI_SYS_VENDOR, "Hewlett-Packard"),
+		     DMI_MATCH(DMI_PRODUCT_NAME, "HP Compaq 6715b"),
+		     },
+	 },
 	{}
 };
 

