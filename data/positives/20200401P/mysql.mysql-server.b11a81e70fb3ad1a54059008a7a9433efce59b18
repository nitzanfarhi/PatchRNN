commit b11a81e70fb3ad1a54059008a7a9433efce59b18
Author: Vasil Dimov <vasil.dimov@oracle.com>
Date:   Wed Aug 3 14:23:01 2011 +0300

    Fix Bug 12813354 - PLUGIN_VAR_MEMALLOC WITHOUT VALIDATION FUNC CRASHES
    IF THE VALUE IS SET TO NULL
    
    Do not try to strdup() the string if the value is NULL. In this case
    *(char **)tgt has already been assigned NULL at the start of the function.
    
    Reviewed by:    magne.mahre (via IM)

diff --git a/sql/sql_plugin.cc b/sql/sql_plugin.cc
index 00a3a53dd21..455426451b4 100644
--- a/sql/sql_plugin.cc
+++ b/sql/sql_plugin.cc
@@ -2279,7 +2279,9 @@ static void update_func_str(THD *thd, struct st_mysql_sys_var *var,
   *(char **)tgt= *(char **) save;
   if (var->flags & PLUGIN_VAR_MEMALLOC)
   {
-    *(char **)tgt= my_strdup(*(char **) save, MYF(0));
+    if (*(char **) save != NULL) {
+      *(char **)tgt= my_strdup(*(char **) save, MYF(0));
+    }
     my_free(old);
   }
 }

