commit ae0b693c12cc78913085733d28e0e0e6020db6f4
Author: Shanyu Zhao <shanyu.zhao@intel.com>
Date:   Thu Dec 2 11:02:28 2010 -0800

    iwlagn: check ready in iwlagn_bss_info_changed()
    
    In function iwlagn_bss_info_changed(), we need to check if the driver
    is ready before doing real work. Also, the previously put WARN() is
    removed because the vif is not guaranteed to be valid. uCode restart
    routine will clear the vif.
    
    Signed-off-by: Shanyu Zhao <shanyu.zhao@intel.com>
    Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>

diff --git a/drivers/net/wireless/iwlwifi/iwl-agn-rxon.c b/drivers/net/wireless/iwlwifi/iwl-agn-rxon.c
index 4865b82355d7..769479eb6ea9 100644
--- a/drivers/net/wireless/iwlwifi/iwl-agn-rxon.c
+++ b/drivers/net/wireless/iwlwifi/iwl-agn-rxon.c
@@ -518,7 +518,14 @@ void iwlagn_bss_info_changed(struct ieee80211_hw *hw,
 
 	mutex_lock(&priv->mutex);
 
-	if (WARN_ON(!ctx->vif)) {
+	if (unlikely(!iwl_is_ready(priv))) {
+                IWL_DEBUG_MAC80211(priv, "leave - not ready\n");
+                mutex_unlock(&priv->mutex);
+		return;
+        }
+
+	if (unlikely(!ctx->vif)) {
+		IWL_DEBUG_MAC80211(priv, "leave - vif is NULL\n");
 		mutex_unlock(&priv->mutex);
 		return;
 	}

