commit a7428cd2ef77734465e36bceb43290e37e2a97c6
Author: Cyrill Gorcunov <gorcunov@openvz.org>
Date:   Sat Aug 1 11:48:00 2009 +0400

    x86, ioapic: Throw BUG instead of NULL dereference
    
    Instead of plain NULL deref we better throw error
    message with a backtrace. Actually we need more
    gracious error handling here. Meanwhile leave it
    as is.
    
    Signed-off-by: Cyrill Gorcunov <gorcunov@openvz.org>
    Cc: yinghai@kernel.org
    LKML-Reference: <20090801075435.769301745@openvz.org>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/arch/x86/kernel/apic/io_apic.c b/arch/x86/kernel/apic/io_apic.c
index ffd8fdfcbe4c..2a145d3a8375 100644
--- a/arch/x86/kernel/apic/io_apic.c
+++ b/arch/x86/kernel/apic/io_apic.c
@@ -503,6 +503,10 @@ static void add_pin_to_irq_node(struct irq_cfg *cfg, int node, int apic, int pin
 	}
 
 	entry = get_one_free_irq_2_pin(node);
+	if (!entry) {
+		printk(KERN_ERR "can not alloc irq_pin_list\n");
+		BUG_ON(1);
+	}
 	entry->apic = apic;
 	entry->pin = pin;
 

