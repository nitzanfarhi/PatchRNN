commit 24e2fb615fd6b624c320cec9ea9d91a75dad902e
Author: Roel Kluin <roel.kluin@gmail.com>
Date:   Sun Aug 2 13:00:18 2009 +0200

    cifs: Read buffer overflow
    
    Check whether index is within bounds before testing the element.
    
    Acked-by: Jeff Layton <jlayton@redhat.com>
    Signed-off-by: Roel Kluin <roel.kluin@gmail.com>
    Signed-off-by: Steve French <sfrench@us.ibm.com>

diff --git a/fs/cifs/cifs_unicode.c b/fs/cifs/cifs_unicode.c
index 60e3c4253de0..714a542cbafc 100644
--- a/fs/cifs/cifs_unicode.c
+++ b/fs/cifs/cifs_unicode.c
@@ -44,7 +44,7 @@ cifs_ucs2_bytes(const __le16 *from, int maxbytes,
 	int maxwords = maxbytes / 2;
 	char tmp[NLS_MAX_CHARSET_SIZE];
 
-	for (i = 0; from[i] && i < maxwords; i++) {
+	for (i = 0; i < maxwords && from[i]; i++) {
 		charlen = codepage->uni2char(le16_to_cpu(from[i]), tmp,
 					     NLS_MAX_CHARSET_SIZE);
 		if (charlen > 0)

