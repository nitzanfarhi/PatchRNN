commit 2c46d2aec054e61a33feac8c3992218eabdcc22a
Author: Joerg Roedel <joerg.roedel@amd.com>
Date:   Wed Feb 9 18:29:39 2011 +0100

    KVM: SVM: Advance instruction pointer in dr_intercept
    
    In the dr_intercept function a new cpu-feature called
    decode-assists is implemented and used when available. This
    code-path does not advance the guest-rip causing the guest
    to dead-loop over mov-dr instructions. This is fixed by this
    patch.
    
    Signed-off-by: Joerg Roedel <joerg.roedel@amd.com>
    Signed-off-by: Avi Kivity <avi@redhat.com>

diff --git a/arch/x86/kvm/svm.c b/arch/x86/kvm/svm.c
index 54ce246a383e..63fec1531e89 100644
--- a/arch/x86/kvm/svm.c
+++ b/arch/x86/kvm/svm.c
@@ -2777,6 +2777,8 @@ static int dr_interception(struct vcpu_svm *svm)
 			kvm_register_write(&svm->vcpu, reg, val);
 	}
 
+	skip_emulated_instruction(&svm->vcpu);
+
 	return 1;
 }
 

