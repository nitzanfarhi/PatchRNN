commit d704b2d32c39c256dea659e142a31b875a13c63b
Author: Aaron Brice <aaron.brice@datasoft.com>
Date:   Thu Oct 6 15:13:04 2016 -0700

    tty: serial: fsl_lpuart: Fix Tx DMA edge case
    
    In the case where head == 0 on the circular buffer, there should be one
    DMA buffer, not two.  The second zero-length buffer would break the
    lpuart driver, transfer would never complete.
    
    Signed-off-by: Aaron Brice <aaron.brice@datasoft.com>
    Acked-by: Stefan Agner <stefan@agner.ch>
    Tested-by: Stefan Agner <stefan@agner.ch>
    Tested-by: Bhuvanchandra DV <bhuvanchandra.dv@toradex.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/tty/serial/fsl_lpuart.c b/drivers/tty/serial/fsl_lpuart.c
index de9d5107c00a..76103f2c4a80 100644
--- a/drivers/tty/serial/fsl_lpuart.c
+++ b/drivers/tty/serial/fsl_lpuart.c
@@ -328,7 +328,7 @@ static void lpuart_dma_tx(struct lpuart_port *sport)
 
 	sport->dma_tx_bytes = uart_circ_chars_pending(xmit);
 
-	if (xmit->tail < xmit->head) {
+	if (xmit->tail < xmit->head || xmit->head == 0) {
 		sport->dma_tx_nents = 1;
 		sg_init_one(sgl, xmit->buf + xmit->tail, sport->dma_tx_bytes);
 	} else {
@@ -359,7 +359,6 @@ static void lpuart_dma_tx(struct lpuart_port *sport)
 	sport->dma_tx_in_progress = true;
 	sport->dma_tx_cookie = dmaengine_submit(sport->dma_tx_desc);
 	dma_async_issue_pending(sport->dma_tx_chan);
-
 }
 
 static void lpuart_dma_tx_complete(void *arg)

