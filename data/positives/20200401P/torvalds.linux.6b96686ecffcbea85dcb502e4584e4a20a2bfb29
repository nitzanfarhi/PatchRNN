commit 6b96686ecffcbea85dcb502e4584e4a20a2bfb29
Author: Daniel Borkmann <dborkman@redhat.com>
Date:   Fri Nov 7 15:34:54 2014 +0100

    netfilter: nft_masq: fix uninitialized range in nft_masq_{ipv4, ipv6}_eval
    
    When transferring from the original range in nf_nat_masquerade_{ipv4,ipv6}()
    we copy over values from stack in from min_proto/max_proto due to uninitialized
    range variable in both, nft_masq_{ipv4,ipv6}_eval. As we only initialize
    flags at this time from nft_masq struct, just zero out the rest.
    
    Fixes: 9ba1f726bec09 ("netfilter: nf_tables: add new nft_masq expression")
    Signed-off-by: Daniel Borkmann <dborkman@redhat.com>
    Acked-by: Arturo Borrero Gonzalez <arturo.borrero.glez@gmail.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

diff --git a/net/ipv4/netfilter/nft_masq_ipv4.c b/net/ipv4/netfilter/nft_masq_ipv4.c
index c1023c445920..665de06561cd 100644
--- a/net/ipv4/netfilter/nft_masq_ipv4.c
+++ b/net/ipv4/netfilter/nft_masq_ipv4.c
@@ -24,6 +24,7 @@ static void nft_masq_ipv4_eval(const struct nft_expr *expr,
 	struct nf_nat_range range;
 	unsigned int verdict;
 
+	memset(&range, 0, sizeof(range));
 	range.flags = priv->flags;
 
 	verdict = nf_nat_masquerade_ipv4(pkt->skb, pkt->ops->hooknum,
diff --git a/net/ipv6/netfilter/nft_masq_ipv6.c b/net/ipv6/netfilter/nft_masq_ipv6.c
index 8a7ac685076d..529c119cbb14 100644
--- a/net/ipv6/netfilter/nft_masq_ipv6.c
+++ b/net/ipv6/netfilter/nft_masq_ipv6.c
@@ -25,6 +25,7 @@ static void nft_masq_ipv6_eval(const struct nft_expr *expr,
 	struct nf_nat_range range;
 	unsigned int verdict;
 
+	memset(&range, 0, sizeof(range));
 	range.flags = priv->flags;
 
 	verdict = nf_nat_masquerade_ipv6(pkt->skb, &range, pkt->out);

