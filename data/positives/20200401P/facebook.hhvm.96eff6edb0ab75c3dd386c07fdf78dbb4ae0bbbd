commit 96eff6edb0ab75c3dd386c07fdf78dbb4ae0bbbd
Author: macvicar <macvicar@facebook.com>
Date:   Wed Aug 11 01:01:09 2010 -0700

    realpath() with the second parameter as 0 / NULL is glibc only
    
    Summary:
    realpath() takes a second parameter of a buffer to use, take
    advantage of that so we're more portable on OSX and FreeBSD
    
    Test Plan:
    make
    maek fast_tests
    
    DiffCamp Revision: 144309
    Reviewed By: andrewparoski
    Commenters: mwilliams
    CC: hphp-diffs@lists, macvicar, andrewparoski, mwilliams
    Revert Plan:
    Ok

diff --git a/src/runtime/eval/runtime/eval_state.cpp b/src/runtime/eval/runtime/eval_state.cpp
index 2f5b442e2f..507f1fa742 100644
--- a/src/runtime/eval/runtime/eval_state.cpp
+++ b/src/runtime/eval/runtime/eval_state.cpp
@@ -271,8 +271,11 @@ bool RequestEvalState::includeFile(Variant &res, CStrRef path, bool once,
     }
     efile = it->second;
   } else {
-    char *rpath = realpath(spath.c_str(), 0);
-    if (rpath && rpath != spath) {
+    char *rpath = (char *)malloc(PATH_MAX);
+    if (rpath == NULL) {
+      return false;
+    }
+    if (realpath(spath.c_str(), rpath) && rpath != spath) {
       it = self->m_evaledFiles.find(rpath);
       if (it != self->m_evaledFiles.end()) {
         self->m_evaledFiles[spath] = efile = it->second;

