commit 2f787b0b76bf5de2eaa3ca3a29d89123ae03c856
Author: YOSHIFUJI Hideaki / 吉藤英明 <yoshfuji@linux-ipv6.org>
Date:   Sun Apr 4 17:59:30 2010 +0000

    mac80211: Ensure initializing private mc_list in prepare_multicast().
    
    Fix kernel panic by NULL pointer dereference in the context of
    ieee80211_ops->prepare_multicast().
    
    This bug was introduced by commit 22bedad3c.. ("net: convert
    multicast list to list_head").
    
    Call __hw_addr_init() in ieee80211_alloc_hw() to initialize
    list_head of private device multicast list, like we do in
    bond_init().
    
    Signed-off-by: YOSHIFUJI Hideaki <yoshfuji@linux-ipv6.org>
    Reviewed-by: Jiri Pirko <jpirko@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/mac80211/main.c b/net/mac80211/main.c
index 84ad249a4e2e..0b82cd2f781e 100644
--- a/net/mac80211/main.c
+++ b/net/mac80211/main.c
@@ -388,6 +388,9 @@ struct ieee80211_hw *ieee80211_alloc_hw(size_t priv_data_len,
 	local->uapsd_max_sp_len = IEEE80211_DEFAULT_MAX_SP_LEN;
 
 	INIT_LIST_HEAD(&local->interfaces);
+
+	__hw_addr_init(&local->mc_list);
+
 	mutex_init(&local->iflist_mtx);
 	mutex_init(&local->scan_mtx);
 

