commit e7fd02c4e2eeb423b1541f9d5989a4548d2e6f64
Author: Thomas Klausner <tk@giga.or.at>
Date:   Sun Jan 31 23:01:36 2010 +0100

    Initialize zstr.next_in. Before this might have passed uninitialized
    data to zlib's deflate() (when adding an empty file to an archive).
    
    Problem reported by Alexander Galanin.
    
    --HG--
    branch : HEAD

diff --git a/lib/zip_close.c b/lib/zip_close.c
index 49af3bb..da0510c 100644
--- a/lib/zip_close.c
+++ b/lib/zip_close.c
@@ -444,6 +444,7 @@ add_data_uncomp(struct zip *za, zip_source_callback cb, void *ud,
 
     zstr.next_out = (Bytef *)b2;
     zstr.avail_out = sizeof(b2);
+    zstr.next_in = NULL;
     zstr.avail_in = 0;
 
     flush = 0;

