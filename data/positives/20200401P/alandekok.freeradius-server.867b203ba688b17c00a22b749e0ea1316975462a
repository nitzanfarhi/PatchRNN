commit 867b203ba688b17c00a22b749e0ea1316975462a
Author: aland <aland>
Date:   Mon Jul 7 19:11:45 2003 +0000

            check & memset

diff --git a/src/modules/rlm_eap/rlm_eap.c b/src/modules/rlm_eap/rlm_eap.c
index 38e813b62..356dc5d7e 100644
--- a/src/modules/rlm_eap/rlm_eap.c
+++ b/src/modules/rlm_eap/rlm_eap.c
@@ -54,11 +54,12 @@ static int eap_instantiate(CONF_SECTION *cs, void **instance)
 	conf	 = NULL;
 	auth_type = NULL;
 
-	conf = (EAP_CONF *)malloc(sizeof(EAP_CONF));
+	conf = (EAP_CONF *)malloc(sizeof(*conf));
 	if (conf == NULL) {
 		radlog(L_ERR, "rlm_eap: out of memory");
 		return -1;
 	}
+	memset(conf, 0, sizeof(*conf));
 	if (cf_section_parse(cs, conf, module_config) < 0) {
 		free(conf);
 		return -1;
diff --git a/src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c b/src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c
index 01732ad77..06f9bc195 100644
--- a/src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c
+++ b/src/modules/rlm_eap/types/rlm_eap_tls/rlm_eap_tls.c
@@ -56,11 +56,12 @@ static int eaptls_attach(CONF_SECTION *cs, void **arg)
 	eaptls = (eap_tls_t **)arg;
 
 	/* Parse the config file & get all the configured values */
-	conf = (EAP_TLS_CONF *)malloc(sizeof(EAP_TLS_CONF));
+	conf = (EAP_TLS_CONF *)malloc(sizeof(*conf));
 	if (conf == NULL) {
 		radlog(L_ERR, "rlm_eap_tls: out of memory");
 		return -1;
 	}
+	memset(conf, 0, sizeof(*conf));
 	if (cf_section_parse(cs, conf, module_config) < 0) {
 		free(conf);
 		return -1;
@@ -141,11 +142,14 @@ static int eaptls_initiate(void *type_arg, EAP_HANDLER *handler)
 	handler->opaque = ((void *)ssn);
 	handler->free_opaque = session_free;
 
+	DEBUG2("  rlm_eap_tls: Initiate");
+
 	/*
 	 * TLS session initialization is over
 	 * Now handle TLS related hanshaking or Data
 	 */
 	status = eaptls_start(handler->eap_ds);
+	DEBUG2("  rlm_eap_tls: Start returned %d", status);
 	if (status == 0)
 		return 0;
 
@@ -178,6 +182,8 @@ static int eaptls_authenticate(void *arg, EAP_HANDLER *handler)
 	EAPTLS_PACKET	*tlspacket;
 	eaptls_status_t	status;
 
+	DEBUG2("  rlm_eap_tls: Authenticate");
+
 	/* This case is when SSL generates Alert then we 
 	 * send that alert to the client and then send the EAP-Failure
 	 */
diff --git a/src/modules/rlm_preprocess/rlm_preprocess.c b/src/modules/rlm_preprocess/rlm_preprocess.c
index e37b3112a..5b41a9cc9 100644
--- a/src/modules/rlm_preprocess/rlm_preprocess.c
+++ b/src/modules/rlm_preprocess/rlm_preprocess.c
@@ -615,6 +615,7 @@ static int preprocess_instantiate(CONF_SECTION *conf, void **instance)
 	 *	Allocate room to put the module's instantiation data.
 	 */
 	data = (rlm_preprocess_t *) rad_malloc(sizeof(*data));
+	memset(data, 0, sizeof(*data));
 
 	/*
 	 *	Read this modules configuration data.
diff --git a/src/modules/rlm_sqlcounter/rlm_sqlcounter.c b/src/modules/rlm_sqlcounter/rlm_sqlcounter.c
index 38199e89a..17d7a8972 100644
--- a/src/modules/rlm_sqlcounter/rlm_sqlcounter.c
+++ b/src/modules/rlm_sqlcounter/rlm_sqlcounter.c
@@ -379,6 +379,7 @@ static int sqlcounter_instantiate(CONF_SECTION *conf, void **instance)
 	 *	Set up a storage area for instance data
 	 */
 	data = rad_malloc(sizeof(*data));
+	memset(data, 0, sizeof(*data));
 
 	/*
 	 *	If the configuration parameters can't be parsed, then
diff --git a/src/modules/rlm_unix/rlm_unix.c b/src/modules/rlm_unix/rlm_unix.c
index 2fb5b82b5..2dec07367 100644
--- a/src/modules/rlm_unix/rlm_unix.c
+++ b/src/modules/rlm_unix/rlm_unix.c
@@ -262,7 +262,11 @@ static int unix_instantiate(CONF_SECTION *conf, void **instance)
 	/*
 	 *	Allocate room for the instance.
 	 */
-	inst = *instance = rad_malloc(sizeof(struct unix_instance));
+	inst = *instance = rad_malloc(sizeof(*inst));
+	if (!inst) {
+		return -1;
+	}
+	memset(inst, 0, sizeof(*inst));
 
 	/*
 	 *	Parse the configuration, failing if we can't do so.

