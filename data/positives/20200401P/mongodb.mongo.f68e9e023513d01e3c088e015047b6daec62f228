commit f68e9e023513d01e3c088e015047b6daec62f228
Author: Eliot Horowitz <eliot@10gen.com>
Date:   Mon May 3 08:48:15 2010 -0400

    fix ScopedDBCOnnectionleak SERVER-1077

diff --git a/client/connpool.cpp b/client/connpool.cpp
index d81f26a829..1e66292a00 100644
--- a/client/connpool.cpp
+++ b/client/connpool.cpp
@@ -137,9 +137,11 @@ namespace mongo {
     }
     
     ScopedDbConnection::~ScopedDbConnection() {
-        if ( _conn && ! _conn->isFailed() ) {
-            /* see done() comments above for why we log this line */
-            log() << "~ScopedDBConnection: _conn != null" << endl;
+        if ( _conn ){
+            if ( ! _conn->isFailed() ) {
+                /* see done() comments above for why we log this line */
+                log() << "~ScopedDBConnection: _conn != null" << endl;
+            }
             kill();
         }
     }
diff --git a/client/connpool.h b/client/connpool.h
index f39fc8da8a..6bdd81a531 100644
--- a/client/connpool.h
+++ b/client/connpool.h
@@ -65,8 +65,10 @@ namespace mongo {
         void flush();
         DBClientBase *get(const string& host);
         void release(const string& host, DBClientBase *c) {
-            if ( c->isFailed() )
+            if ( c->isFailed() ){
+                delete c;
                 return;
+            }
             scoped_lock L(_mutex);
             _pools[host]->pool.push(c);
         }

