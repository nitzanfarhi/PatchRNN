commit e85fbc595aa527e0b3c9a738c4dc1d7717afb30c
Author: Salyzyn, Mark <mark_salyzyn@adaptec.com>
Date:   Wed Oct 31 16:40:37 2007 -0400

    [SCSI] aacraid: fix potential panic in thread stop
    
    Got a panic in the threading code on an older kernel when the Adapter
    failed to load properly and driver shut down apparently before any
    threading had started, can not dupe. Expect that this may be relevant in
    the latest kernel, but not sure. This patch does no harm, and should
    alleviate the possibility of this panic.
    
    Signed-off-by: Mark Salyzyn <aacraid@adaptec.com>
    Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>

diff --git a/drivers/scsi/aacraid/linit.c b/drivers/scsi/aacraid/linit.c
index 038980be763d..53061bceaad8 100644
--- a/drivers/scsi/aacraid/linit.c
+++ b/drivers/scsi/aacraid/linit.c
@@ -950,7 +950,8 @@ static struct scsi_host_template aac_driver_template = {
 
 static void __aac_shutdown(struct aac_dev * aac)
 {
-	kthread_stop(aac->thread);
+	if (aac->aif_thread)
+		kthread_stop(aac->thread);
 	aac_send_shutdown(aac);
 	aac_adapter_disable_int(aac);
 	free_irq(aac->pdev->irq, aac);

