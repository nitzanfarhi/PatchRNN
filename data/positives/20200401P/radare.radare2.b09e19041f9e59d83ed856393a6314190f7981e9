commit b09e19041f9e59d83ed856393a6314190f7981e9
Author: √Ålvaro Felipe Melchor <alvaro.felipe91@gmail.com>
Date:   Sun Oct 2 22:57:50 2016 +0200

    Fix oob read in ragg2

diff --git a/libr/util/sys.c b/libr/util/sys.c
index 60c672f2a..5e611961c 100644
--- a/libr/util/sys.c
+++ b/libr/util/sys.c
@@ -643,17 +643,18 @@ R_API int r_sys_run(const ut8 *buf, int len) {
 	int st, pid;
 #endif
 // TODO: define R_SYS_ALIGN_FORWARD in r_util.h
-	ut8 *ptr, *p = malloc ((sz+len)<<1);
+	ut8 *ptr, *p = malloc ((sz + len) << 1);
 	ptr = p;
-	pdelta = ((size_t)(p)) & (4096-1);
-	if (pdelta)
-		ptr += (4096-pdelta);
+	pdelta = ((size_t)(p)) & (4096 - 1);
+	if (pdelta) {
+		ptr += (4096 - pdelta);
+	}
 	if (!ptr || !buf) {
 		eprintf ("r_sys_run: Cannot run empty buffer\n");
 		free (p);
 		return false;
 	}
-	memcpy (ptr, buf, sz);
+	memcpy (ptr, buf, len);
 	r_mem_protect (ptr, sz, "rx");
 	//r_mem_protect (ptr, sz, "rwx"); // try, ignore if fail
 	cb = (void*)ptr;
@@ -664,7 +665,7 @@ R_API int r_sys_run(const ut8 *buf, int len) {
 #else
 	pid = -1;
 #endif
-	if (pid<0) {
+	if (pid < 0) {
 		return cb ();
 	}
 	if (!pid) {

