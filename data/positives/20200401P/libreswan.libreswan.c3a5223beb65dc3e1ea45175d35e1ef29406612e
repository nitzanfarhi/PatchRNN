commit c3a5223beb65dc3e1ea45175d35e1ef29406612e
Author: Avesh Agarwal <avagarwa@redhat.com>
Date:   Wed Jun 9 15:42:57 2010 -0400

    I have attached a patch to solve an issue in which pluto was crashing
    when remote_peer_type=cisco is configured. The issue occurs only with
    "remote_peer_type=cisco" without affecting any other functionality. The
    issue occurred because in general pluto assumes that there is a
    only one "spd" policy associated with a connection. However, when
    remote_peer_type=cisco is configured, there can be more than policy
    (required for split networking) leading to multiple "spd" policies.

diff --git a/programs/pluto/initiate.c b/programs/pluto/initiate.c
index 2f3af0ce3..73c08c7c7 100644
--- a/programs/pluto/initiate.c
+++ b/programs/pluto/initiate.c
@@ -86,6 +86,11 @@ orient(struct connection *c)
 
 	for (sr = &c->spd; sr; sr = sr->next)
 	{
+	    /* There can be more then 1 spd policy associated - required
+	     * for cisco split networking when remote_peer_type=cisco
+	     */
+	    if(c->remotepeertype ==CISCO && sr != &c->spd ) continue;
+
 	    /* Note: this loop does not stop when it finds a match:
 	     * it continues checking to catch any ambiguity.
 	     */

