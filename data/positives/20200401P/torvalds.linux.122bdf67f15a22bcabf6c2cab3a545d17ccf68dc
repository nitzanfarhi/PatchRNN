commit 122bdf67f15a22bcabf6c2cab3a545d17ccf68dc
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Wed Mar 14 21:13:11 2012 +0000

    ipv6: fix icmp6_dst_alloc()
    
    commit 87a115783 ( ipv6: Move xfrm_lookup() call down into
    icmp6_dst_alloc().) forgot to convert one error path, leading
    to crashes in mld_sendpack()
    
    Many thanks to Dave Jones for providing a very complete bug report.
    
    Reported-by: Dave Jones <davej@redhat.com>
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/ipv6/route.c b/net/ipv6/route.c
index 8c2e3ab58f2a..22b766407de1 100644
--- a/net/ipv6/route.c
+++ b/net/ipv6/route.c
@@ -1077,7 +1077,7 @@ struct dst_entry *icmp6_dst_alloc(struct net_device *dev,
 	struct net *net = dev_net(dev);
 
 	if (unlikely(!idev))
-		return NULL;
+		return ERR_PTR(-ENODEV);
 
 	rt = ip6_dst_alloc(&net->ipv6.ip6_dst_ops, dev, 0);
 	if (unlikely(!rt)) {

