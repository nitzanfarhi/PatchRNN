commit 9b8937744e365000a85d527ce41e6205ca16422e
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Wed Apr 11 09:09:00 2007 +0000

    Remember to initialize C_flag and don't exit in far away code.
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@1312 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/mgt_vcc.c b/bin/varnishd/mgt_vcc.c
index f7b4e169d..d7156f897 100644
--- a/bin/varnishd/mgt_vcc.c
+++ b/bin/varnishd/mgt_vcc.c
@@ -315,14 +315,14 @@ mgt_vcc_default(const char *b_arg, const char *f_arg, int C_flag)
 		if (C_flag) {
 			csrc = VCC_Compile(sb, buf, NULL);
 			fputs(csrc, stdout);
-			exit (0);
+			return (0);
 		}
 		vf = mgt_VccCompile(sb, buf, NULL);
 		free(buf);
 	} else if (C_flag) {
 		csrc = VCC_CompileFile(sb, f_arg);
 		fputs(csrc, stdout);
-		exit (0);
+		return (0);
 	} else {
 		vf = mgt_VccCompileFile(sb, f_arg);
 	}
diff --git a/bin/varnishd/varnishd.c b/bin/varnishd/varnishd.c
index b42839969..e547bec32 100644
--- a/bin/varnishd/varnishd.c
+++ b/bin/varnishd/varnishd.c
@@ -398,7 +398,7 @@ main(int argc, char *argv[])
 	const char *h_flag = "classic";
 	const char *s_arg = "file";
 	const char *T_arg = NULL;
-	unsigned C_flag;
+	unsigned C_flag = 0;
 	char *p;
 	struct params param;
 	struct cli cli[1];
@@ -501,6 +501,8 @@ main(int argc, char *argv[])
 
 	if (mgt_vcc_default(b_arg, f_arg, C_flag))
 		exit (2);
+	if (C_flag)
+		exit (0);
 
 	setup_storage(s_arg);
 	setup_hash(h_flag);

