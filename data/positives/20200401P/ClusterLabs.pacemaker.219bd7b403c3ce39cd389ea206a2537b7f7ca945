commit 219bd7b403c3ce39cd389ea206a2537b7f7ca945
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Wed May 26 15:01:26 2010 +0200

    High: Tools: Fix use-after-free defect from coverity
    
    Mercurial revision: f857df8d00138737369e6fe69f48e46af981709c

diff --git a/tools/crm_inject.c b/tools/crm_inject.c
index 0b017e8be..4a0c9df3c 100644
--- a/tools/crm_inject.c
+++ b/tools/crm_inject.c
@@ -547,10 +547,10 @@ run_simulation(pe_working_set_t *data_set)
 
     if(quiet == FALSE) {
 	xmlNode *cib_object = NULL;
-	ha_time_t *a_date = data_set->now;
 	int rc = global_cib->cmds->query(global_cib, NULL, &cib_object, cib_sync_call|cib_scope_local);
-	CRM_ASSERT(rc == cib_ok);
+	ha_time_t *a_date = data_set->now; data_set->now = NULL; /* Prevent it being free'd in cleanup_alloc_calculations() */
 
+	CRM_ASSERT(rc == cib_ok);
 	quiet_log("\nRevised cluster status:\n");
 	cleanup_alloc_calculations(data_set);
 	data_set->input = cib_object;

