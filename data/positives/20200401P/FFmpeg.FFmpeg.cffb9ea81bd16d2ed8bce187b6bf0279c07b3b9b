commit cffb9ea81bd16d2ed8bce187b6bf0279c07b3b9b
Author: Andreas Cadhalpun <Andreas.Cadhalpun@googlemail.com>
Date:   Tue May 26 14:24:37 2015 +0100

    mov: reject zero bytes_per_frame with non-zero samples_per_frame
    
    In this case the mov demuxer can return a large number of empty packets.
    
    Signed-off-by: Andreas Cadhalpun <Andreas.Cadhalpun@googlemail.com>
    Signed-off-by: Luca Barbato <lu_zero@gentoo.org>

diff --git a/libavformat/mov.c b/libavformat/mov.c
index fbbfef0bf3..2cf6e8e540 100644
--- a/libavformat/mov.c
+++ b/libavformat/mov.c
@@ -2263,6 +2263,13 @@ static void mov_build_index(MOVContext *mov, AVStream *st)
                 AVIndexEntry *e;
                 unsigned size, samples;
 
+                if (sc->samples_per_frame > 1 && !sc->bytes_per_frame) {
+                    avpriv_request_sample(mov->fc,
+                           "Zero bytes per frame, but %d samples per frame",
+                           sc->samples_per_frame);
+                    return;
+                }
+
                 if (sc->samples_per_frame >= 160) { // gsm
                     samples = sc->samples_per_frame;
                     size = sc->bytes_per_frame;

