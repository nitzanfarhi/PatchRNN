commit 37e76548e686c78a75de04c28e2f5e4ec15f5b93
Author: Bron Gondwana <brong@opera.com>
Date:   Thu Oct 4 23:59:59 2012 +0200

    mboxname: unlock namelock files explicitly

diff --git a/imap/mboxname.c b/imap/mboxname.c
index 54761b26b..c3d480eee 100644
--- a/imap/mboxname.c
+++ b/imap/mboxname.c
@@ -156,8 +156,11 @@ static void remove_lockitem(struct mboxlocklist *remitem)
 		previtem->next = item->next;
 	    else
 		open_mboxlocks = item->next;
-	    if (item->l.lock_fd != -1)
+	    if (item->l.lock_fd != -1) {
+		if (item->l.locktype)
+		    lock_unlock(item->l.lock_fd, item->l.name);
 		close(item->l.lock_fd);
+	    }
 	    free(item->l.name);
 	    free(item);
 	    return;

