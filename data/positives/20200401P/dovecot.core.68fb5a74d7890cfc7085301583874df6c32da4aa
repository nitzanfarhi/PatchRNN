commit 68fb5a74d7890cfc7085301583874df6c32da4aa
Author: Stephan Bosch <stephan@rename-it.nl>
Date:   Sun Oct 12 08:58:40 2014 -0700

    lib-http: client: Fixed segfault caused by earlier change.

diff --git a/src/lib-http/http-client-connection.c b/src/lib-http/http-client-connection.c
index 0c69ac54f..7faf9261a 100644
--- a/src/lib-http/http-client-connection.c
+++ b/src/lib-http/http-client-connection.c
@@ -503,7 +503,6 @@ http_client_connection_return_response(struct http_client_connection *conn,
 	http_client_connection_ref(conn);
 	retrying = !http_client_request_callback(req, response);
 	http_client_connection_unref(&conn);
-	conn->in_req_callback = FALSE;
 	if (conn == NULL) {
 		/* the callback managed to get this connection destroyed */
 		if (!retrying)
@@ -511,6 +510,7 @@ http_client_connection_return_response(struct http_client_connection *conn,
 		http_client_request_unref(&req);
 		return FALSE;
 	}
+	conn->in_req_callback = FALSE;
 
 	if (retrying) {
 		/* retrying, don't destroy the request */

