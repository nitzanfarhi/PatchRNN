commit c159b2e9c8c55348d96439b8ac9aa9ea0946a889
Author: Armin Novak <armin.novak@thincast.com>
Date:   Thu Aug 23 12:43:29 2018 +0200

    Fixed missing check before calling memcpy

diff --git a/winpr/include/winpr/stream.h b/winpr/include/winpr/stream.h
index 4a0005948..0ec18a23f 100644
--- a/winpr/include/winpr/stream.h
+++ b/winpr/include/winpr/stream.h
@@ -216,8 +216,11 @@ static INLINE void Stream_Write_UINT64(wStream* _s, UINT64 _v)
 }
 static INLINE void Stream_Write(wStream* _s, const void* _b, size_t _n)
 {
-	memcpy(_s->pointer, (_b), (_n));
-	Stream_Seek(_s, _n);
+	if (_n > 0)
+	{
+		memcpy(_s->pointer, (_b), (_n));
+		Stream_Seek(_s, _n);
+	}
 }
 
 #define Stream_Seek_UINT8(_s)		Stream_Seek(_s, 1)
@@ -342,7 +345,7 @@ static INLINE BOOL Stream_Read_UTF16_String(wStream* s, WCHAR* dst, size_t lengt
 	if (Stream_GetRemainingLength(s) / sizeof(WCHAR) < length)
 		return FALSE;
 
-	for (x=0; x<length; x++)
+	for (x = 0; x < length; x++)
 		Stream_Read_UINT16(s, dst[x]);
 
 	return TRUE;
@@ -358,7 +361,7 @@ static INLINE BOOL Stream_Write_UTF16_String(wStream* s, const WCHAR* src, size_
 	if (Stream_GetRemainingCapacity(s) / sizeof(WCHAR) < length)
 		return FALSE;
 
-	for (x=0; x<length; x++)
+	for (x = 0; x < length; x++)
 		Stream_Write_UINT16(s, src[x]);
 
 	return TRUE;

