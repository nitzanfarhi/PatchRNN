commit d371c3c2e2830d9783465ecfe1ab7d93351083b7
Author: Anton Khirnov <anton@khirnov.net>
Date:   Mon Mar 18 21:31:54 2013 +0100

    vf_frei0r: make config_props work properly when called multiple times.
    
    Do not leak the initialized filter instance.

diff --git a/libavfilter/vf_frei0r.c b/libavfilter/vf_frei0r.c
index ff7e308a8..7e79b28f8 100644
--- a/libavfilter/vf_frei0r.c
+++ b/libavfilter/vf_frei0r.c
@@ -317,6 +317,8 @@ static int config_input_props(AVFilterLink *inlink)
     AVFilterContext *ctx = inlink->dst;
     Frei0rContext *s = ctx->priv;
 
+    if (s->destruct && s->instance)
+        s->destruct(s->instance);
     if (!(s->instance = s->construct(inlink->w, inlink->h))) {
         av_log(ctx, AV_LOG_ERROR, "Impossible to load frei0r instance");
         return AVERROR(EINVAL);
@@ -451,6 +453,8 @@ static int source_config_props(AVFilterLink *outlink)
     outlink->h = s->h;
     outlink->time_base = s->time_base;
 
+    if (s->destruct && s->instance)
+        s->destruct(s->instance);
     if (!(s->instance = s->construct(outlink->w, outlink->h))) {
         av_log(ctx, AV_LOG_ERROR, "Impossible to load frei0r instance");
         return AVERROR(EINVAL);

