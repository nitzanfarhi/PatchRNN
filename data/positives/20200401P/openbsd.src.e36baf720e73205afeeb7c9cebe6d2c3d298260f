commit e36baf720e73205afeeb7c9cebe6d2c3d298260f
Author: jason <jason@openbsd.org>
Date:   Mon Mar 26 23:07:38 2001 +0000

    Fix bug I introduced... if m_pullup fails, don't try to free the result.

diff --git a/sys/net/if_vlan.c b/sys/net/if_vlan.c
index 6cff8ead00d..ffd63436775 100644
--- a/sys/net/if_vlan.c
+++ b/sys/net/if_vlan.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: if_vlan.c,v 1.13 2001/03/26 19:00:58 jason Exp $ */
+/*	$OpenBSD: if_vlan.c,v 1.14 2001/03/26 23:07:38 jason Exp $ */
 /*
  * Copyright 1998 Massachusetts Institute of Technology
  *
@@ -345,10 +345,8 @@ vlan_input(eh, m)
 	u_int tag;
 
 	if (m->m_len < EVL_ENCAPLEN &&
-	    (m = m_pullup(m, EVL_ENCAPLEN)) == NULL) {
-		m_freem(m);
+	    (m = m_pullup(m, EVL_ENCAPLEN)) == NULL)
 		return (-1);
-	}
 
 	tag = EVL_VLANOFTAG(ntohs(*mtod(m, u_int16_t *)));
 

