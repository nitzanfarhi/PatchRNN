commit 46eea9aa49722595f92bdbdb7a66414db4fd7a3d
Author: ray <ray@openbsd.org>
Date:   Tue Mar 6 03:22:11 2007 +0000

    - Pass full buffer to fgets().
    - Use sizeof(buf) instead of BUFSIZ.
    - Only overwrite '\n'.
    
    From Charles Longeau.
    
    OK millert@ and moritz@.

diff --git a/usr.sbin/httpd/src/modules/standard/mod_mime_magic.c b/usr.sbin/httpd/src/modules/standard/mod_mime_magic.c
index a9b6ddf5636..bb1ce2b1921 100644
--- a/usr.sbin/httpd/src/modules/standard/mod_mime_magic.c
+++ b/usr.sbin/httpd/src/modules/standard/mod_mime_magic.c
@@ -931,13 +931,13 @@ static int apprentice(server_rec *s, pool *p)
     conf->magic = conf->last = NULL;
 
     /* parse it */
-    for (lineno = 1; fgets(line, BUFSIZ, f) != NULL; lineno++) {
+    for (lineno = 1; fgets(line, sizeof(line), f) != NULL; lineno++) {
 	int ws_offset;
+	char *p;
 
 	/* delete newline */
-	if (line[0]) {
-	    line[strlen(line) - 1] = '\0';
-	}
+	if ((p = strchr(line, '\n')) != NULL)
+	    *p = '\0';
 
 	/* skip leading whitespace */
 	ws_offset = 0;
diff --git a/usr.sbin/sliplogin/sliplogin.c b/usr.sbin/sliplogin/sliplogin.c
index b485f8d7d54..2d5ec497318 100644
--- a/usr.sbin/sliplogin/sliplogin.c
+++ b/usr.sbin/sliplogin/sliplogin.c
@@ -35,7 +35,7 @@ char copyright[] =
 
 #ifndef lint
 /*static char sccsid[] = "from: @(#)sliplogin.c	5.6 (Berkeley) 3/2/91";*/
-static char rcsid[] = "$Id: sliplogin.c,v 1.25 2004/09/14 22:29:04 deraadt Exp $";
+static char rcsid[] = "$Id: sliplogin.c,v 1.26 2007/03/06 03:22:11 ray Exp $";
 #endif /* not lint */
 
 /*
@@ -117,7 +117,7 @@ findid(char *name)
 		syslog(LOG_ERR, "%s: %m", _PATH_ACCESS);
 		err(1, "%s", _PATH_ACCESS);
 	}
-	while (fgets(loginargs, sizeof(loginargs) - 1, fp)) {
+	while (fgets(loginargs, sizeof(loginargs), fp)) {
 		if (ferror(fp))
 			break;
 		if ((p = strchr(loginargs, '#')))

