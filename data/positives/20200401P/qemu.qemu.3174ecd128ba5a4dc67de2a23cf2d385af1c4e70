commit 3174ecd128ba5a4dc67de2a23cf2d385af1c4e70
Author: Michael S. Tsirkin <mst@redhat.com>
Date:   Wed Jul 22 18:51:14 2009 +0300

    qemu: msix nit: clear msix_entries_nr on error
    
    I don't think it's critical to do this, but it's
    best to keep uninit and error recovery consistent.
    
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
    Signed-off-by: Anthony Liguori <aliguori@us.ibm.com>

diff --git a/hw/msix.c b/hw/msix.c
index 3420ce9b24..c954d471c2 100644
--- a/hw/msix.c
+++ b/hw/msix.c
@@ -255,6 +255,7 @@ int msix_init(struct PCIDevice *dev, unsigned short nentries,
     return 0;
 
 err_config:
+    dev->msix_entries_nr = 0;
     cpu_unregister_io_memory(dev->msix_mmio_index);
 err_index:
     qemu_free(dev->msix_table_page);

