commit 6246ccab99093a562044596dd868213caa0b2b4c
Author: Eric Paris <eparis@redhat.com>
Date:   Mon Jan 7 14:01:18 2008 -0500

    [AUDIT] do not panic on exclude messages in audit_log_pid_context()
    
    If we fail to get an ab in audit_log_pid_context this may be due to an exclude
    rule rather than a memory allocation failure.  If it was due to a memory
    allocation failue we would have already paniced and no need to do it again.
    
    Signed-off-by: Eric Paris <eparis@redhat.com>

diff --git a/kernel/auditsc.c b/kernel/auditsc.c
index 6e5de767bad1..aaaca8a13bbe 100644
--- a/kernel/auditsc.c
+++ b/kernel/auditsc.c
@@ -948,7 +948,7 @@ static int audit_log_pid_context(struct audit_context *context, pid_t pid,
 
 	ab = audit_log_start(context, GFP_KERNEL, AUDIT_OBJ_PID);
 	if (!ab)
-		return 1;
+		return rc;
 
 	audit_log_format(ab, "opid=%d oauid=%d ouid=%d oses=%d", pid, auid,
 			 uid, sessionid);

