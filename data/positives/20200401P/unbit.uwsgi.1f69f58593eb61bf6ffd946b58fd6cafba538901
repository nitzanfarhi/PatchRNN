commit 1f69f58593eb61bf6ffd946b58fd6cafba538901
Author: roberto@debian32 <roberto@debian32>
Date:   Fri Jun 17 08:44:32 2011 +0200

    fixed a stupid bug in non-async initialization

diff --git a/uwsgi.c b/uwsgi.c
index 00a3f3ab..e27a042b 100644
--- a/uwsgi.c
+++ b/uwsgi.c
@@ -2250,17 +2250,17 @@ int uwsgi_start(void *v_argv) {
 		}
 
 		uwsgi_add_sockets_to_queue(uwsgi.async_queue);
-	}
 
-	uwsgi.rb_async_timeouts = uwsgi_init_rb_timer();
+		uwsgi.rb_async_timeouts = uwsgi_init_rb_timer();
 
-	uwsgi.async_queue_unused = uwsgi_malloc(sizeof(struct wsgi_request *) * uwsgi.async);
+		uwsgi.async_queue_unused = uwsgi_malloc(sizeof(struct wsgi_request *) * uwsgi.async);
 
-	for (i = 0; i < uwsgi.async; i++) {
-		uwsgi.async_queue_unused[i] = uwsgi.wsgi_requests[i];
-	}
+		for (i = 0; i < uwsgi.async; i++) {
+			uwsgi.async_queue_unused[i] = uwsgi.wsgi_requests[i];
+		}
 
-	uwsgi.async_queue_unused_ptr = uwsgi.async - 1;
+		uwsgi.async_queue_unused_ptr = uwsgi.async - 1;
+	}
 #endif
 
 

