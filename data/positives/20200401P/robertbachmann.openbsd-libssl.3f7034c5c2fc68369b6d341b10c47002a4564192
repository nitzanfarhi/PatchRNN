commit 3f7034c5c2fc68369b6d341b10c47002a4564192
Author: markus <markus>
Date:   Wed Mar 17 12:28:29 2004 +0000

    avoid null-pointer deref (aka CAN-2004-0079)
    see http://www.openssl.org/news/secadv_20040317.txt

diff --git a/src/ssl/s3_pkt.c b/src/ssl/s3_pkt.c
index 3f88429e..9f3e5139 100644
--- a/src/ssl/s3_pkt.c
+++ b/src/ssl/s3_pkt.c
@@ -1085,6 +1085,14 @@ start:
 			goto err;
 			}
 
+		/* Check we have a cipher to change to */
+		if (s->s3->tmp.new_cipher == NULL)
+			{
+			i=SSL_AD_UNEXPECTED_MESSAGE;
+			SSLerr(SSL_F_SSL3_GET_CERT_VERIFY,SSL_R_CCS_RECEIVED_EARLY);
+			goto err;
+			}
+
 		rr->length=0;
 
 		if (s->msg_callback)

