commit 6f6f9512ea915009abeb6a4c5f204d4c25f090e0
Author: Victor Kaplansky <victork@redhat.com>
Date:   Tue Dec 1 15:32:26 2015 +0200

    vhost-user: verify that number of queues is non-zero
    
    Fix QEMU crash when -netdev type=vhost-user,queues=n is passed
    with zero number of queues.
    
    Signed-off-by: Victor Kaplansky <victork@redhat.com>
    Reviewed-by: Michael S. Tsirkin <mst@redhat.com>
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
    Acked-by: Jason Wang <jasowang@redhat.com>

diff --git a/net/vhost-user.c b/net/vhost-user.c
index 5071602e9b..b368a90219 100644
--- a/net/vhost-user.c
+++ b/net/vhost-user.c
@@ -316,6 +316,11 @@ int net_init_vhost_user(const NetClientOptions *opts, const char *name,
     }
 
     queues = vhost_user_opts->has_queues ? vhost_user_opts->queues : 1;
+    if (queues < 1) {
+        error_setg(errp,
+                   "vhost-user number of queues must be bigger than zero");
+        return -1;
+    }
 
     return net_vhost_user_init(peer, "vhost_user", name, chr, queues);
 }

