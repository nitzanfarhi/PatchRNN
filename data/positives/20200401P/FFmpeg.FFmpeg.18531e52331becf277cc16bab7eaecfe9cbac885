commit 18531e52331becf277cc16bab7eaecfe9cbac885
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Tue Dec 24 13:04:26 2002 +0000

    fix segfault with -vcodec copy
    
    Originally committed as revision 1360 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/ffmpeg.c b/ffmpeg.c
index 2fed0e8582..e0c7cb14b4 100644
--- a/ffmpeg.c
+++ b/ffmpeg.c
@@ -1400,8 +1400,15 @@ static int av_encode(AVFormatContext **output_files,
                             av_abort();
                         }
                     } else {
+                        AVFrame avframe;
+                                                
                         /* no reencoding needed : output the packet directly */
                         /* force the input stream PTS */
+                        
+                        //XXX/FIXME set keyframe flag from demuxer (or optionally from decoder)
+                        memset(&avframe, 0, sizeof(AVFrame));
+                        ost->st->codec.coded_frame= &avframe;
+                        
                         av_write_frame(os, ost->index, data_buf, data_size);
 			ost->st->codec.frame_number++;
 			ost->frame_number++;

