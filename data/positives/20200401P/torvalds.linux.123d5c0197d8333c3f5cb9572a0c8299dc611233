commit 123d5c0197d8333c3f5cb9572a0c8299dc611233
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Thu Sep 23 16:15:21 2010 +0100

    drm/i915/sdvo: Cleanup connector on error path
    
    We weren't unlinking the freed connector from the drm lists, and so
    hit some use-after-free if we failed to initialise the connector.
    
    Reported-and-tested-by: Woody Suwalski <terraluna977@gmail.com>
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=18342
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

diff --git a/drivers/gpu/drm/i915/intel_sdvo.c b/drivers/gpu/drm/i915/intel_sdvo.c
index e8e902d614ed..60fcef700be6 100644
--- a/drivers/gpu/drm/i915/intel_sdvo.c
+++ b/drivers/gpu/drm/i915/intel_sdvo.c
@@ -2170,8 +2170,7 @@ intel_sdvo_tv_init(struct intel_sdvo *intel_sdvo, int type)
         return true;
 
 err:
-	intel_sdvo_destroy_enhance_property(connector);
-	kfree(intel_sdvo_connector);
+	intel_sdvo_destroy(connector);
 	return false;
 }
 
@@ -2243,8 +2242,7 @@ intel_sdvo_lvds_init(struct intel_sdvo *intel_sdvo, int device)
 	return true;
 
 err:
-	intel_sdvo_destroy_enhance_property(connector);
-	kfree(intel_sdvo_connector);
+	intel_sdvo_destroy(connector);
 	return false;
 }
 

