commit 777e015699b812bde58ce15eb5bfa6090819499a
Author: Embedthis Software <dev@embedthis.com>
Date:   Fri Mar 1 15:35:35 2013 -0800

    Fix render safe

diff --git a/src/esp/espTemplate.c b/src/esp/espTemplate.c
index 2ca165536..2ffb18c16 100644
--- a/src/esp/espTemplate.c
+++ b/src/esp/espTemplate.c
@@ -516,11 +516,13 @@ PUBLIC char *espBuildScript(HttpRoute *route, cchar *page, cchar *path, cchar *c
                 if (token == 0) { 
                     token = "";
                 }
+                /* If users want a format and safe, use %S or renderSafe() */
+                token = strim(token, " \t\r\n;", MPR_TRIM_BOTH);
+                body = sjoin(body, "  espRender(conn, \"", fmt, "\", ", token, ");\n", NULL);
             } else {
-                fmt = "%s";
+                token = strim(token, " \t\r\n;", MPR_TRIM_BOTH);
+                body = sjoin(body, "  espRenderSafeString(conn, ", token, ");\n", NULL);
             }
-            token = strim(token, " \t\r\n;", MPR_TRIM_BOTH);
-            body = sjoin(body, "  espRenderSafeString(conn, \"", fmt, "\", ", token, ");\n", NULL);
             break;
 
         case ESP_TOK_FIELD:

