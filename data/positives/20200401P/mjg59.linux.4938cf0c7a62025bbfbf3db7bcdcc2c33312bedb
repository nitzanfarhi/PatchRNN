commit 4938cf0c7a62025bbfbf3db7bcdcc2c33312bedb
Author: Wang Nan <wangnan0@huawei.com>
Date:   Mon Dec 7 02:35:44 2015 +0000

    perf hists browser: Fix segfault if use symbol filter in cmdline
    
    If feed perf a symbol filter in cmdline and the result is empty,
    pressing 'Enter' in the hist browser causes crash:
    
     # ./perf report perf.data   <-- Common mistake for beginners
    
    Then press 'Enter':
    
     perf: Segmentation fault
     -------- backtrace --------
     /home/wangnan/perf[0x53e578]
     /lib64/libc.so.6(+0x3545f)[0x7f76bafe045f]
     /home/wangnan/perf[0x539dd4]
     /home/wangnan/perf(perf_evlist__tui_browse_hists+0x96)[0x53d216]
     /home/wangnan/perf(cmd_report+0x1b9f)[0x442c7f]
     /home/wangnan/perf[0x47efa2]
     /home/wangnan/perf(main+0x5f5)[0x432fa5]
     /lib64/libc.so.6(__libc_start_main+0xf4)[0x7f76bafccbd4]
     /home/wangnan/perf[0x4330d4]
    
    This is because 'perf.data' is interpreted as a symbol filter, and the
    result is empty, so selection is empty. However,
    hist_browser__toggle_fold() forgets to check it.
    
    This patch simply return false when selection is NULL.
    
    Signed-off-by: Wang Nan <wangnan0@huawei.com>
    Acked-by: Namhyung Kim <namhyung@kernel.org>
    Tested-by: Arnaldo Carvalho de Melo <acme@redhat.com>
    Cc: Zefan Li <lizefan@huawei.com>
    Cc: pi3orama@163.com
    Link: http://lkml.kernel.org/r/1449455746-41952-2-git-send-email-wangnan0@huawei.com
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/perf/ui/browsers/hists.c b/tools/perf/ui/browsers/hists.c
index 84c8251f39a1..81def6c3f24b 100644
--- a/tools/perf/ui/browsers/hists.c
+++ b/tools/perf/ui/browsers/hists.c
@@ -298,6 +298,9 @@ static bool hist_browser__toggle_fold(struct hist_browser *browser)
 	struct callchain_list *cl = container_of(ms, struct callchain_list, ms);
 	bool has_children;
 
+	if (!he || !ms)
+		return false;
+
 	if (ms == &he->ms)
 		has_children = hist_entry__toggle_fold(he);
 	else

