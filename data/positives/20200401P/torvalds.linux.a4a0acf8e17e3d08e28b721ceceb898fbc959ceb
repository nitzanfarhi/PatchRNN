commit a4a0acf8e17e3d08e28b721ceceb898fbc959ceb
Author: Suresh Siddha <suresh.b.siddha@intel.com>
Date:   Tue Jan 13 18:43:03 2009 -0800

    x86: fix broken flush_tlb_others_ipi()
    
    This commit broke flush_tlb_others_ipi() causing boot hangs on a
    16 logical cpu system:
    
    >       commit 4595f9620cda8a1e973588e743cf5f8436dd20c6
    >       Author: Rusty Russell <rusty@rustcorp.com.au>
    >       Date:   Sat Jan 10 21:58:09 2009 -0800
    >
    >           x86: change flush_tlb_others to take a const struct cpumask
    
    This change resulted in sending the invalidate tlb vector to the
    sender itself causing the hang. flush_tlb_others_ipi() should exclude
    the sender itself from the destination list.
    
    Signed-off-by: Suresh Siddha <suresh.b.siddha@intel.com>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/arch/x86/kernel/tlb_64.c b/arch/x86/kernel/tlb_64.c
index 7a3f9891302d..54ee2ecb5e26 100644
--- a/arch/x86/kernel/tlb_64.c
+++ b/arch/x86/kernel/tlb_64.c
@@ -188,7 +188,7 @@ static void flush_tlb_others_ipi(const struct cpumask *cpumask,
 	 * We have to send the IPI only to
 	 * CPUs affected.
 	 */
-	send_IPI_mask(cpumask, INVALIDATE_TLB_VECTOR_START + sender);
+	send_IPI_mask(f->flush_cpumask, INVALIDATE_TLB_VECTOR_START + sender);
 
 	while (!cpumask_empty(to_cpumask(f->flush_cpumask)))
 		cpu_relax();

