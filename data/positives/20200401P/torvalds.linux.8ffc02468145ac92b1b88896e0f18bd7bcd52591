commit 8ffc02468145ac92b1b88896e0f18bd7bcd52591
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Sep 14 14:14:28 2011 +0200

    drm/i915: Defend against userspace creating a gem object with size==0
    
    We currently only round up the userspace size to the next page. We
    assume that userspace hasn't made a mistake and requested a zero-length
    gem object and all through our internal code we then presume that every
    object is backed by at least a single page. Fix that oversight and
    report EINVAL back to userspace if they try to create a zero length
    object.
    
    [danvet: This fixes tests/gem_bad_length]
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-Off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Ben Widawsky <ben@bwidawsk.net>
    Signed-off-by: Keith Packard <keithp@keithp.com>

diff --git a/drivers/gpu/drm/i915/i915_gem.c b/drivers/gpu/drm/i915/i915_gem.c
index d8e0c15c874f..52b199da7d5d 100644
--- a/drivers/gpu/drm/i915/i915_gem.c
+++ b/drivers/gpu/drm/i915/i915_gem.c
@@ -195,6 +195,8 @@ i915_gem_create(struct drm_file *file,
 	u32 handle;
 
 	size = roundup(size, PAGE_SIZE);
+	if (size == 0)
+		return -EINVAL;
 
 	/* Allocate the new object */
 	obj = i915_gem_alloc_object(dev, size);

