commit 63fa2c5b8f5f5e0e02193ee7700479b076ebd5e6
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Jun 25 19:40:24 2012 +0300

    imapc: Fixed crash on saving/copying if remote IMAP server didn't support UIDPLUS.

diff --git a/src/lib-storage/index/imapc/imapc-save.c b/src/lib-storage/index/imapc/imapc-save.c
index e3410d5aa..4d6ff7b64 100644
--- a/src/lib-storage/index/imapc/imapc-save.c
+++ b/src/lib-storage/index/imapc/imapc-save.c
@@ -165,7 +165,8 @@ static void imapc_save_callback(const struct imapc_command_reply *reply,
 	uint32_t uid = 0;
 
 	if (reply->state == IMAPC_COMMAND_STATE_OK) {
-		if (strcasecmp(reply->resp_text_key, "APPENDUID") == 0)
+		if (reply->resp_text_key != NULL &&
+		    strcasecmp(reply->resp_text_key, "APPENDUID") == 0)
 			imapc_save_appenduid(ctx->ctx, reply, &uid);
 		imapc_save_add_to_index(ctx->ctx, uid);
 		ctx->ret = 0;
@@ -354,7 +355,8 @@ static void imapc_copy_callback(const struct imapc_command_reply *reply,
 	uint32_t uid = 0;
 
 	if (reply->state == IMAPC_COMMAND_STATE_OK) {
-		if (strcasecmp(reply->resp_text_key, "COPYUID") == 0)
+		if (reply->resp_text_key != NULL &&
+		    strcasecmp(reply->resp_text_key, "COPYUID") == 0)
 			imapc_save_copyuid(ctx->ctx, reply, &uid);
 		imapc_save_add_to_index(ctx->ctx, uid);
 		ctx->ret = 0;

