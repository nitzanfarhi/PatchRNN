commit 40e76aa4f07432338a0c8efbb16a10c7cc763d12
Author: Kefu Chai <kchai@redhat.com>
Date:   Fri Jul 27 12:13:42 2018 +0800

    common/config: fix the lock in ConfigProxy::diff()
    
    it's a regression introduced by e406d8eb9e1deb801ecb346169eaaf96adbb4b53
    
    Signed-off-by: Kefu Chai <kchai@redhat.com>

diff --git a/src/common/config_proxy.h b/src/common/config_proxy.h
index 2bcc7a44e6..d6f75b10b8 100644
--- a/src/common/config_proxy.h
+++ b/src/common/config_proxy.h
@@ -71,8 +71,8 @@ public:
     return config.find_option(name);
   }
   void diff(Formatter *f, const std::string& name=string{}) const {
-    return config.diff(values, f, name);
     Mutex::Locker l{lock};
+    return config.diff(values, f, name);
   }
   void get_my_sections(std::vector <std::string> &sections) const {
     Mutex::Locker l{lock};

