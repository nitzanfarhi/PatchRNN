commit 8b957f851227d7a41b94bba3c95130b5e2872829
Author: √Ålvaro Felipe Melchor <alvaro.felipe91@gmail.com>
Date:   Tue Jun 21 23:01:09 2016 +0200

    fix two uaf in anal.c

diff --git a/libr/core/anal.c b/libr/core/anal.c
index 3515b2f2a..4dc90a893 100644
--- a/libr/core/anal.c
+++ b/libr/core/anal.c
@@ -1739,7 +1739,7 @@ R_API int r_core_anal_fcn_list(RCore *core, const char *input, int rad) {
 	r_list_sort (fcns, &cmpfcn);
 	fcnlist_gather_metadata (fcns);
 
-	if (input) {		// input points to a filter argument
+	if (input && *input) {// input points to a filter argument
 		ut64 addr;
 		addr = core->offset;
 		if (*input) {
@@ -1782,7 +1782,8 @@ R_API int r_core_anal_fcn_list(RCore *core, const char *input, int rad) {
 		fcn_list_default (core, fcns, false);
 		break;
 	}
-	if (input) {
+	//make sure you don't free core->anal->fcns
+	if (input && core->anal->fcns != fcns) {
 		// The list does not own the its members, so don't purge.
 		free (fcns);
 	}

