commit a78ea556d346d18a1d800d1bd0279be9c1e77f62
Author: Maxim Sobolev <sobomax@sippysoft.com>
Date:   Tue Oct 21 03:05:33 2008 +0000

    In get_to_uid() throw an error when username is empty. Judging by the
    fact that the get_to_uid() is trying to do zero-byte copy and underlying
    consumers doing other nasty things such as trying to allocate 0-byte
    memory buffer nobody expects this condition to happen.
    
    Sponsored by:   Sippy Software, Inc.
    Debugging:      mpatrol

diff --git a/id.c b/id.c
index 5edd22d14..be226b7c1 100644
--- a/id.c
+++ b/id.c
@@ -159,6 +159,10 @@ int get_to_uid(str* uid, struct sip_msg* msg)
 			DBG("get_to_uid: Username too long\n");
 			return -1;
 		}
+		if (p == NULL || uid->len == 0) {
+			DBG("get_to_uid: Username is empty\n");
+			return -1;
+		}
 		memcpy(buf, p, uid->len);
 		uid->s = buf;
 		strlower(uid);

