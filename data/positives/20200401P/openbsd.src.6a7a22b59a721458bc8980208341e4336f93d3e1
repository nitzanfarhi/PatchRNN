commit 6a7a22b59a721458bc8980208341e4336f93d3e1
Author: henning <henning@openbsd.org>
Date:   Mon Jan 27 10:00:40 2003 +0000

    bugfix from Can Erkin Acar <canacar@eee.metu.edu.tr>:
    hbhopt_print() and dstopt_print() can return 0 if
    the option is located just one byte short of snapend
    this would cause an infinite loop in ip6_print().

diff --git a/usr.sbin/tcpdump/print-ip6.c b/usr.sbin/tcpdump/print-ip6.c
index 156976d0d82..3dee1dc64a5 100644
--- a/usr.sbin/tcpdump/print-ip6.c
+++ b/usr.sbin/tcpdump/print-ip6.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: print-ip6.c,v 1.3 2002/02/19 19:39:40 millert Exp $	*/
+/*	$OpenBSD: print-ip6.c,v 1.4 2003/01/27 10:00:40 henning Exp $	*/
 
 /*
  * Copyright (c) 1988, 1989, 1990, 1991, 1992, 1993, 1994
@@ -165,6 +165,8 @@ ip6_print(register const u_char *bp, register int length)
 			(void)printf("ip-proto-%d %d", ip6->ip6_nxt, len);
 			goto end;
 		}
+		if (hlen == 0)
+			break;
 	}
 
  end:

