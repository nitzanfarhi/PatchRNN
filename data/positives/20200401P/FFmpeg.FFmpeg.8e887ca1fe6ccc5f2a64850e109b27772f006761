commit 8e887ca1fe6ccc5f2a64850e109b27772f006761
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Sun Jun 9 00:36:04 2013 +0200

    jpeg2000dec: Check bpno in decode_cblk()
    
    Fixes integer overflow in fate-redcode-demux
    
    Reviewed-by: Nicolas BERTRAND <nicoinattendu@gmail.com>
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/jpeg2000dec.c b/libavcodec/jpeg2000dec.c
index af542b9c80..da510c66ac 100644
--- a/libavcodec/jpeg2000dec.c
+++ b/libavcodec/jpeg2000dec.c
@@ -901,6 +901,10 @@ static int decode_cblk(Jpeg2000DecoderContext *s, Jpeg2000CodingStyle *codsty,
     ff_mqc_initdec(&t1->mqc, cblk->data);
 
     while (passno--) {
+        if (bpno < 0) {
+            av_log(s->avctx, AV_LOG_ERROR, "bpno invalid\n");
+            return AVERROR(EINVAL);
+        }
         switch(pass_t) {
         case 0:
             decode_sigpass(t1, width, height, bpno + 1, bandpos,

