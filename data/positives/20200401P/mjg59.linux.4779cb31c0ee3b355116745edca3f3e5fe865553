commit 4779cb31c0ee3b355116745edca3f3e5fe865553
Author: Andi Kleen <ak@linux.intel.com>
Date:   Wed Oct 14 01:51:41 2009 +0200

    HWPOISON: Fix page count leak in hwpoison late kill in do_swap_page
    
    When returning due to a poisoned page drop the page count.
    
    It wasn't a fatal problem because noone cares about the page count
    on a poisoned page (except when it wraps), but it's cleaner to fix it.
    
    Pointed out by Linus.
    
    Signed-off-by: Andi Kleen <ak@linux.intel.com>

diff --git a/mm/memory.c b/mm/memory.c
index 7e91b5f9f690..7a3b0ad5594a 100644
--- a/mm/memory.c
+++ b/mm/memory.c
@@ -2539,7 +2539,7 @@ static int do_swap_page(struct mm_struct *mm, struct vm_area_struct *vma,
 	} else if (PageHWPoison(page)) {
 		ret = VM_FAULT_HWPOISON;
 		delayacct_clear_flag(DELAYACCT_PF_SWAPIN);
-		goto out;
+		goto out_release;
 	}
 
 	lock_page(page);
@@ -2611,6 +2611,7 @@ out_nomap:
 	pte_unmap_unlock(page_table, ptl);
 out_page:
 	unlock_page(page);
+out_release:
 	page_cache_release(page);
 	return ret;
 }

