commit 1b1b7b235b040f27952d48ab8811c958a1f6d052
Author: Tay Ray Chuan <rctay89@gmail.com>
Date:   Sat Jun 6 16:43:37 2009 +0800

    http-push: do not SEGV after fetching a bad pack idx file
    
    In a70c232 ("http-fetch: do not SEGV after fetching a bad pack idx
    file"), changes were made to the setup_index method in http-fetch.c
    (known in its present form as http-walker.c after 30ae764 ("Modularize
    commit-walker")). Since http-push.c has similar similar code for
    processing index files, these changes should apply to http-push.c's
    implementation of setup_index as well.
    
    Signed-off-by: Tay Ray Chuan <rctay89@gmail.com>
    Signed-off-by: Junio C Hamano <gitster@pobox.com>

diff --git a/http-push.c b/http-push.c
index 82018009f..281e153eb 100644
--- a/http-push.c
+++ b/http-push.c
@@ -1065,6 +1065,8 @@ static int setup_index(unsigned char *sha1)
 		return -1;
 
 	new_pack = parse_pack_index(sha1);
+	if (!new_pack)
+		return -1; /* parse_pack_index() already issued error message */
 	new_pack->next = repo->packs;
 	repo->packs = new_pack;
 	return 0;

