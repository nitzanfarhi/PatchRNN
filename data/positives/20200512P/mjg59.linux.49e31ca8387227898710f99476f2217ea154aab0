commit 49e31ca8387227898710f99476f2217ea154aab0
Author: Ralf Baechle <ralf@linux-mips.org>
Date:   Mon Apr 24 10:48:54 2006 +0100

    [MIPS] Fix oprofile module unloading
    
    When unloading oprofile module with timer-mode, oprofile_arch_exit
    dereferences a NULL pointer.
    
    Signed-off-by: Atsushi Nemoto <anemo@mba.ocn.ne.jp>
    Signed-off-by: Ralf Baechle <ralf@linux-mips.org>

diff --git a/arch/mips/oprofile/common.c b/arch/mips/oprofile/common.c
index 935dd851f480..49ef8fd338d6 100644
--- a/arch/mips/oprofile/common.c
+++ b/arch/mips/oprofile/common.c
@@ -114,5 +114,6 @@ int __init oprofile_arch_init(struct oprofile_operations *ops)
 
 void oprofile_arch_exit(void)
 {
-	model->exit();
+	if (model)
+		model->exit();
 }

