commit 07605fad600a84f94637cf795fab81b60f54793f
Author: Con Kolivas <kernel@kolivas.org>
Date:   Wed Oct 10 23:07:33 2012 +1100

    stratum auth can be unset if we fail to authorise on subsequent calls to auth_stratum which undoes the requirement of setting it in one place so set it in pool_active.

diff --git a/cgminer.c b/cgminer.c
index 6a2f3af1..71bae1d0 100644
--- a/cgminer.c
+++ b/cgminer.c
@@ -4265,6 +4265,7 @@ retry_stratum:
 			return false;
 		if (!auth_stratum(pool))
 			return false;
+		pool->stratum_auth = true;
 		pool->idle = false;
 		init_stratum_thread(pool);
 		return true;
diff --git a/util.c b/util.c
index 6d6409bc..3b90f8e8 100644
--- a/util.c
+++ b/util.c
@@ -1205,8 +1205,6 @@ out:
 	if (val)
 		json_decref(val);
 
-	pool->stratum_auth = ret;
-
 	return ret;
 }
 

