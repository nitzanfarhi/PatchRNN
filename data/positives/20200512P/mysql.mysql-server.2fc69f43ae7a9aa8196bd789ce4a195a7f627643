commit 2fc69f43ae7a9aa8196bd789ce4a195a7f627643
Author: Evgeny Potemkin <evgeny.potemkin@oracle.com>
Date:   Wed Jun 6 13:42:30 2012 +0400

    Bug#14152665 - VALGRIND: DEFINITELY LOST AT MALLOC FROM FILESORT_BUFFER::ALLOC_SORT_BUFFER
    Fixed a memory leak that was introduced by WL#6071.
    The leak was visible on the main.server_uuid and main.key tests
    with the --valgrind flag.

diff --git a/sql/sql_tmp_table.cc b/sql/sql_tmp_table.cc
index 62d34ac78a8..61ff2543d3d 100644
--- a/sql/sql_tmp_table.cc
+++ b/sql/sql_tmp_table.cc
@@ -21,6 +21,7 @@
 #include "sql_base.h"
 #include "opt_trace.h"
 #include "debug_sync.h"
+#include "filesort.h"   // filesort_free_buffers
 
 #include <algorithm>
 using std::max;
@@ -1826,6 +1827,8 @@ free_tmp_table(THD *thd, TABLE *entry)
   // Release latches since this can take a long time
   ha_release_temporary_latches(thd);
 
+  filesort_free_buffers(entry, true);
+
   if (entry->file && entry->created)
   {
     if (entry->db_stat)

