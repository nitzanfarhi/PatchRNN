commit 2e82636a3dd8d3cf1ba87380608da4f6a0f6ec47
Author: Randy Dunlap <rdunlap@xenotime.net>
Date:   Fri Jul 14 00:24:28 2006 -0700

    [PATCH] TPM: fix failure path leak
    
    kfree(devname) on the misc_register() failure path.  Otherwise it is lost
    forever.
    
    Signed-off-by: Randy Dunlap <rdunlap@xenotime.net>
    Cc: Kylene Jo Hall <kjhall@us.ibm.com>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/drivers/char/tpm/tpm.c b/drivers/char/tpm/tpm.c
index 6889e7db3aff..a082a2e34252 100644
--- a/drivers/char/tpm/tpm.c
+++ b/drivers/char/tpm/tpm.c
@@ -1141,6 +1141,7 @@ struct tpm_chip *tpm_register_hardware(struct device *dev, const struct tpm_vend
 		put_device(dev);
 		clear_bit(chip->dev_num, dev_mask);
 		kfree(chip);
+		kfree(devname);
 		return NULL;
 	}
 

