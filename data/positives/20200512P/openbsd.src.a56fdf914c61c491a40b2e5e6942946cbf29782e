commit a56fdf914c61c491a40b2e5e6942946cbf29782e
Author: tedu <tedu@openbsd.org>
Date:   Wed Aug 27 23:05:14 2003 +0000

    oops

diff --git a/usr.bin/sup/src/scmio.c b/usr.bin/sup/src/scmio.c
index 23f4e9f2170..c63a4043ef0 100644
--- a/usr.bin/sup/src/scmio.c
+++ b/usr.bin/sup/src/scmio.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: scmio.c,v 1.13 2003/08/27 23:02:19 tedu Exp $	*/
+/*	$OpenBSD: scmio.c,v 1.14 2003/08/27 23:05:14 tedu Exp $	*/
 
 /*
  * Copyright (c) 1992 Carnegie Mellon University
@@ -673,11 +673,12 @@ int readstring(buf)	/* read string data block */
 		return (scmerr(-1, "Can't malloc %d bytes for string", count));
 	if (cryptflag) {
 		x = getcryptbuf(count+1);
+		if (x == SCMOK)
+			x = readdata(count, cryptbuf);
 		if (x != SCMOK) {
 			free(p);
 			return (x);
 		}
-		x = readdata(count, cryptbuf);
 		if (scmdebug > 3)
 			printf("SCM Reading encrypted string %s\n", cryptbuf);
 		decode(cryptbuf, p, count);

