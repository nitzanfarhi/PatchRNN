commit 59885b39303edc0b3284f324a1ca42cb6e7742d0
Author: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Date:   Wed Apr 9 09:18:04 2014 +0900

    Btrfs: fix possible memory leak in btrfs_create_tree()
    
    In btrfs_create_tree(), if btrfs_insert_root() fails, we should
    free root->commit_root.
    
    Reported-by: Alex Lyakas <alex@zadarastorage.com>
    Signed-off-by: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
    Signed-off-by: Chris Mason <clm@fb.com>

diff --git a/fs/btrfs/disk-io.c b/fs/btrfs/disk-io.c
index cf8427a7a615..d3bd34e434f6 100644
--- a/fs/btrfs/disk-io.c
+++ b/fs/btrfs/disk-io.c
@@ -1366,6 +1366,7 @@ struct btrfs_root *btrfs_create_tree(struct btrfs_trans_handle *trans,
 fail:
 	if (leaf) {
 		btrfs_tree_unlock(leaf);
+		free_extent_buffer(root->commit_root);
 		free_extent_buffer(leaf);
 	}
 	kfree(root);

