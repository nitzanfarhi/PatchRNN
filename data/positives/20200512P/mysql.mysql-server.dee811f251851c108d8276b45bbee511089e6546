commit dee811f251851c108d8276b45bbee511089e6546
Author: Bill Qu <bill.qu@Oracle.com>
Date:   Fri Jul 4 14:49:56 2014 +0800

    Bug #19068390   VALGRIND FAILURE IN WEEKLY TESTING OF RPL.RPL_CHECK_GTID
    
    rpl.rpl_check_gtid failed with valgrind. Since we missed to delete
    the created THD after failed to create a compression thread, which
    causes a memory leak.
    
    To fix the problem, delete the created THD after failed to create
    a compression thread.

diff --git a/sql/rpl_gtid_persist.cc b/sql/rpl_gtid_persist.cc
index 729b1e1cabc..58398d74ecd 100644
--- a/sql/rpl_gtid_persist.cc
+++ b/sql/rpl_gtid_persist.cc
@@ -915,6 +915,7 @@ void create_compress_gtid_table_thread()
   {
     sql_print_error("Failed to initialize thread attribute "
                     "when creating compression thread.");
+    delete thd;
     return;
   }
 
@@ -925,8 +926,12 @@ void create_compress_gtid_table_thread()
       (error= mysql_thread_create(key_thread_compress_gtid_table,
                                   &compress_thread_id, &attr,
                                   compress_gtid_table, (void*) thd)))
+  {
     sql_print_error("Can not create thread to compress gtid_executed table "
                     "(errno= %d)", error);
+    /* Delete the created THD after failed to create a compression thread. */
+    delete thd;
+  }
 
   (void) pthread_attr_destroy(&attr);
 }

