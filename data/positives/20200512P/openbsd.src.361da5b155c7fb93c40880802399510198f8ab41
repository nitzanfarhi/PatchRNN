commit 361da5b155c7fb93c40880802399510198f8ab41
Author: itojun <itojun@openbsd.org>
Date:   Thu Mar 22 15:06:57 2007 +0000

    do not try to grab default router list on "ndp -r" if it's empty
    (happens when the machine is an IPv6 router).
    from kame
    ok deraadt, mbalmer

diff --git a/usr.sbin/ndp/ndp.c b/usr.sbin/ndp/ndp.c
index 7c33066e75c..0a74e2d1a1a 100644
--- a/usr.sbin/ndp/ndp.c
+++ b/usr.sbin/ndp/ndp.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: ndp.c,v 1.38 2007/02/18 23:50:47 ray Exp $	*/
+/*	$OpenBSD: ndp.c,v 1.39 2007/03/22 15:06:57 itojun Exp $	*/
 /*	$KAME: ndp.c,v 1.101 2002/07/17 08:46:33 itojun Exp $	*/
 
 /*
@@ -1029,6 +1029,8 @@ rtrlist(void)
 		err(1, "sysctl(ICMPV6CTL_ND6_DRLIST)");
 		/*NOTREACHED*/
 	}
+	if (l == 0)
+		return;
 	buf = malloc(l);
 	if (buf == NULL) {
 		err(1, "malloc");

