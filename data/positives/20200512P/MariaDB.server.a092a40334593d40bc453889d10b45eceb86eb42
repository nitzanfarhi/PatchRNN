commit a092a40334593d40bc453889d10b45eceb86eb42
Author: Jan Lindstr√∂m <jplindst@mariadb.org>
Date:   Wed Mar 19 17:23:38 2014 +0200

    MDEV-5830: Assertion failure mutex_get_waiters(mutex) == 0 at shutdown.

diff --git a/storage/xtradb/buf/buf0lru.cc b/storage/xtradb/buf/buf0lru.cc
index 8a6d042f4c7..15a46970f60 100644
--- a/storage/xtradb/buf/buf0lru.cc
+++ b/storage/xtradb/buf/buf0lru.cc
@@ -2290,11 +2290,14 @@ buf_LRU_block_free_non_file_page(
 		page_zip_set_size(&block->page.zip, 0);
 	}
 
+	ut_a(buf_pool->free_list_mutex.high_priority_waiters == 0);
 	mutex_enter_first(&buf_pool->free_list_mutex);
+	ut_a(buf_pool->free_list_mutex.high_priority_waiters == 0);
 	buf_block_set_state(block, BUF_BLOCK_NOT_USED);
 	UT_LIST_ADD_FIRST(list, buf_pool->free, (&block->page));
 	ut_d(block->page.in_free_list = TRUE);
 	mutex_exit(&buf_pool->free_list_mutex);
+	ut_a(buf_pool->free_list_mutex.high_priority_waiters == 0);
 
 	UNIV_MEM_ASSERT_AND_FREE(block->frame, UNIV_PAGE_SIZE);
 }

