commit 63faceb60b8e026d62db228ff04038e8089fa74a
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Fri May 23 16:15:11 2014 +0200

    iwlwifi: mvm: don't send zero quota to the firmware
    
    There are some cases where we can currently send zero quota
    for a valid binding, e.g. if we update while an interface is
    bound to a channel context but not yet acting as an AP.
    
    Avoid this by reordering the checks.
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>

diff --git a/drivers/net/wireless/iwlwifi/mvm/quota.c b/drivers/net/wireless/iwlwifi/mvm/quota.c
index 75d2c95b4076..8bb2fced0811 100644
--- a/drivers/net/wireless/iwlwifi/mvm/quota.c
+++ b/drivers/net/wireless/iwlwifi/mvm/quota.c
@@ -105,11 +105,6 @@ static void iwl_mvm_quota_iterator(void *_data, u8 *mac,
 	if (WARN_ON_ONCE(id >= MAX_BINDINGS))
 		return;
 
-	if (data->colors[id] < 0)
-		data->colors[id] = mvmvif->phy_ctxt->color;
-	else
-		WARN_ON_ONCE(data->colors[id] != mvmvif->phy_ctxt->color);
-
 	if (data->type == IWL_MVM_QUOTA_UPDATE_TYPE_DISABLED &&
 	    vif == data->vif)
 		return;
@@ -135,6 +130,11 @@ static void iwl_mvm_quota_iterator(void *_data, u8 *mac,
 		return;
 	}
 
+	if (data->colors[id] < 0)
+		data->colors[id] = mvmvif->phy_ctxt->color;
+	else
+		WARN_ON_ONCE(data->colors[id] != mvmvif->phy_ctxt->color);
+
 	data->n_interfaces[id]++;
 
 	if (iwl_mvm_vif_low_latency(mvmvif) && !data->low_latency[id]) {

