commit a8590a9aee2762b69bbe0db0ed971d4c74d05ce2
Author: schwarze <schwarze@openbsd.org>
Date:   Sun Jun 29 21:19:34 2014 +0000

    Bugfix in roff_setstrn():
    Do not call strcmp() on an array of char that might not be NUL-terminated.

diff --git a/usr.bin/mandoc/roff.c b/usr.bin/mandoc/roff.c
index a404623bf6e..0d2a81b40a5 100644
--- a/usr.bin/mandoc/roff.c
+++ b/usr.bin/mandoc/roff.c
@@ -1,4 +1,4 @@
-/*	$Id: roff.c,v 1.83 2014/06/25 00:19:17 schwarze Exp $ */
+/*	$Id: roff.c,v 1.84 2014/06/29 21:19:34 schwarze Exp $ */
 /*
  * Copyright (c) 2010, 2011, 2012 Kristaps Dzonsons <kristaps@bsd.lv>
  * Copyright (c) 2010-2014 Ingo Schwarze <schwarze@openbsd.org>
@@ -2064,7 +2064,8 @@ roff_setstrn(struct roffkv **r, const char *name, size_t namesz,
 	/* Search for an existing string with the same name. */
 	n = *r;
 
-	while (n && strcmp(name, n->key.p))
+	while (n && (namesz != n->key.sz ||
+			strncmp(n->key.p, name, namesz)))
 		n = n->next;
 
 	if (NULL == n) {

