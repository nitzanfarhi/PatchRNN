commit 79aec2b80db1089f983d60e4a22cb95d8b939844
Author: Anand Jain <Anand.Jain@oracle.com>
Date:   Wed Jul 30 20:04:10 2014 +0800

    btrfs: sysfs label interface should check for read only FS
    
    Not sure how this escaped many eyes so far
    
    Signed-off-by: Anand Jain <anand.jain@oracle.com>
    Signed-off-by: Chris Mason <clm@fb.com>

diff --git a/fs/btrfs/sysfs.c b/fs/btrfs/sysfs.c
index e6a5e7d82f42..b2e7bb4393f6 100644
--- a/fs/btrfs/sysfs.c
+++ b/fs/btrfs/sysfs.c
@@ -377,6 +377,9 @@ static ssize_t btrfs_label_store(struct kobject *kobj,
 	int ret;
 	size_t p_len;
 
+	if (fs_info->sb->s_flags & MS_RDONLY)
+		return -EROFS;
+
 	/*
 	 * p_len is the len until the first occurrence of either
 	 * '\n' or '\0'

