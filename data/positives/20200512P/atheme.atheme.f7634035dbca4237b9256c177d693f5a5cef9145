commit f7634035dbca4237b9256c177d693f5a5cef9145
Author: Elly <elly@leptoquark.net>
Date:   Sun May 23 16:31:15 2010 -0400

    node_add_before() needs to set before->prev->next.

diff --git a/src/dlink.c b/src/dlink.c
index 36a92b12b..c420c3dc2 100644
--- a/src/dlink.c
+++ b/src/dlink.c
@@ -145,6 +145,8 @@ void node_add_before(void *data, node_t *n, list_t *l, node_t *before)
 	{
 		n->data = data;
 		n->prev = before->prev;
+		if (before->prev)
+			before->prev->next = n;
 		n->next = before;
 		before->prev = n;
 		l->count++;

