commit 7bb939ef70752f2731d27b18c944ea94e5b23eb5
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Jun 16 12:26:52 2006 +0300

    If cache field's size is wrong, rebuild the cache file instead of crashing
    sometimes later.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mail-cache-fields.c b/src/lib-index/mail-cache-fields.c
index df305f65a..0f1a1a3a2 100644
--- a/src/lib-index/mail-cache-fields.c
+++ b/src/lib-index/mail-cache-fields.c
@@ -244,7 +244,15 @@ int mail_cache_header_fields_read(struct mail_cache *cache)
 			}
 			if (cache->fields[field.idx].field.type != types[i]) {
 				mail_cache_set_corrupted(cache,
-					"registered field type changed");
+					"registered field %s type changed",
+					names);
+				return -1;
+			}
+			if (cache->fields[field.idx].field.field_size !=
+			    sizes[i]) {
+				mail_cache_set_corrupted(cache,
+					"registered field %s size changed",
+					names);
 				return -1;
 			}
 		} else {

