commit abed375ea669c2b8863cd0b253e6b9508b4950bb
Author: Yukihiro "Matz" Matsumoto <matz@ruby-lang.org>
Date:   Mon May 29 14:12:23 2017 +0900

    Mark proc objects representing methods as internal objects; fix #3621

diff --git a/src/class.c b/src/class.c
index b0d7c8aa..77b67049 100644
--- a/src/class.c
+++ b/src/class.c
@@ -431,6 +431,7 @@ mrb_define_method_raw(mrb_state *mrb, struct RClass *c, mrb_sym mid, struct RPro
   k = kh_put(mt, mrb, h, mid);
   kh_value(h, k) = p;
   if (p) {
+    p->c = NULL;
     mrb_field_write_barrier(mrb, (struct RBasic *)c, (struct RBasic *)p);
   }
 }

