commit c403f312d478d967879aecaf9a52e3fd6d8742c4
Author: Jean Le Feuvre <jeanlf@users.sourceforge.net>
Date:   Wed Jan 4 18:29:19 2012 +0000

    fixed potential crash when gui.bt is used
    
    git-svn-id: http://svn.code.sf.net/p/gpac/code/trunk/gpac@3832 63c20433-aa62-49bd-875c-5a186b69a8fb

diff --git a/src/scenegraph/vrml_smjs.c b/src/scenegraph/vrml_smjs.c
index ae668a048..ee4a0e10e 100644
--- a/src/scenegraph/vrml_smjs.c
+++ b/src/scenegraph/vrml_smjs.c
@@ -4661,11 +4661,18 @@ void gf_sg_handle_dom_event_for_vrml(GF_Node *node, GF_DOM_Event *event, GF_Node
 
 	gf_sg_lock_javascript(priv->js_ctx, 1);
 
+	evt = gf_dom_new_event(priv->js_ctx);
+	if (!evt) {
+		gf_sg_lock_javascript(priv->js_ctx, 0);
+		GF_LOG(GF_LOG_ERROR, GF_LOG_SCRIPT, ("[DOM Events] Cannot create JavaScript dom event for event type %d\n", event->type));
+		return;
+	}
+
 	prev_type = event->is_vrml;
 	event->is_vrml = 1;
 	JS_SetPrivate(priv->js_ctx, priv->event, event);
 
-	evt = gf_dom_new_event(priv->js_ctx);
+
 	JS_SetPrivate(priv->js_ctx, evt, event);
 	argv[0] = OBJECT_TO_JSVAL(evt);
 

