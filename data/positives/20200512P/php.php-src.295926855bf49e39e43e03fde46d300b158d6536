commit 295926855bf49e39e43e03fde46d300b158d6536
Author: Rasmus Lerdorf <rasmus@php.net>
Date:   Wed Jan 21 11:39:23 2015 -0800

    Slightly modify and merge PR#105 from @MegaManSec

diff --git a/sapi/fpm/fpm/fpm_conf.c b/sapi/fpm/fpm/fpm_conf.c
index 6fb1a3dcc9..9a619ce887 100644
--- a/sapi/fpm/fpm/fpm_conf.c
+++ b/sapi/fpm/fpm/fpm_conf.c
@@ -574,6 +574,8 @@ static char *fpm_conf_set_array(zval *key, zval *value, void **config, int conve
 	} else {
 		kv->value = strdup(Z_STRVAL_P(value));
 		if (fpm_conf_expand_pool_name(&kv->value) == -1) {
+			free(kv->key);
+			free(kv);
 			return "Can't use '$pool' when the pool is not defined";
 		}
 	}
diff --git a/sapi/fpm/fpm/fpm_sockets.c b/sapi/fpm/fpm/fpm_sockets.c
index 38a7acf63d..b5639fece7 100644
--- a/sapi/fpm/fpm/fpm_sockets.c
+++ b/sapi/fpm/fpm/fpm_sockets.c
@@ -287,6 +287,7 @@ static int fpm_socket_af_inet_listening_socket(struct fpm_worker_pool_s *wp) /*
 
 	if ((status = getaddrinfo(addr, port_str, &hints, &servinfo)) != 0) {
 		zlog(ZLOG_ERROR, "getaddrinfo: %s\n", gai_strerror(status));
+		free(dup_address);
 		return -1;
 	}
 

