commit 998504d715738711671e25201f7463a28c2baf79
Author: ram@gw.mysql.r18.ru <>
Date:   Tue Sep 14 17:30:57 2004 +0500

    A fix (bug #5546: mysqld crash on PURGE MASTER LOGS BEFORE '...' with log-bin off).

diff --git a/sql/sql_repl.cc b/sql/sql_repl.cc
index 32c5f0bfdab..d9f02488077 100644
--- a/sql/sql_repl.cc
+++ b/sql/sql_repl.cc
@@ -306,8 +306,13 @@ int purge_master_logs(THD* thd, const char* to_log)
 
 int purge_master_logs_before_date(THD* thd, time_t purge_time)
 {
-  int res = mysql_bin_log.purge_logs_before_date(purge_time);
-  return purge_error_message(thd ,res);
+  if (!mysql_bin_log.is_open())
+  {
+    send_ok(current_thd);
+    return 0;
+  }
+  return purge_error_message(thd,
+                             mysql_bin_log.purge_logs_before_date(purge_time));
 }
 
 /*

