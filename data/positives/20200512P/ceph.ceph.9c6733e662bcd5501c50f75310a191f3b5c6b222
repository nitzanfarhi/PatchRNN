commit 9c6733e662bcd5501c50f75310a191f3b5c6b222
Author: David Zafman <david.zafman@inktank.com>
Date:   Wed Apr 2 19:44:44 2014 -0700

    librados: Allow rados_pool_list() to get NULL buffer if len == 0
    
    Coverity wants a NULL check for buf, but caller should be able to
    pass a NULL buf and 0 len in order to get byte count of pool list.
    
    Signed-off-by: David Zafman <david.zafman@inktank.com>

diff --git a/src/librados/librados.cc b/src/librados/librados.cc
index 80f2c63b21..994123bf1c 100644
--- a/src/librados/librados.cc
+++ b/src/librados/librados.cc
@@ -2035,7 +2035,7 @@ extern "C" int rados_pool_list(rados_t cluster, char *buf, size_t len)
   if (r < 0)
     return r;
 
-  if (!buf)
+  if (len > 0 && !buf)
     return -EINVAL;
 
   char *b = buf;

