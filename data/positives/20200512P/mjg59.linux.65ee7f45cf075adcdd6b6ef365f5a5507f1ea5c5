commit 65ee7f45cf075adcdd6b6ef365f5a5507f1ea5c5
Author: Rafal Krypa <r.krypa@samsung.com>
Date:   Mon Jul 9 19:36:34 2012 +0200

    Smack: don't show empty rules when /smack/load or /smack/load2 is read
    
    This patch removes empty rules (i.e. with access set to '-') from the
    rule list presented to user space.
    
    Smack by design never removes labels nor rules from its lists. Access
    for a rule may be set to '-' to effectively disable it. Such rules would
    show up in the listing generated when /smack/load or /smack/load2 is
    read. This may cause clutter if many rules were disabled.
    
    As a rule with access set to '-' is equivalent to no rule at all, they
    may be safely hidden from the listing.
    
    Targeted for git://git.gitorious.org/smack-next/kernel.git
    
    Signed-off-by: Rafal Krypa <r.krypa@samsung.com>
    Signed-off-by: Casey Schaufler <casey@schaufler-ca.com>

diff --git a/security/smack/smackfs.c b/security/smack/smackfs.c
index 29b760d6b746..d31e6d957c21 100644
--- a/security/smack/smackfs.c
+++ b/security/smack/smackfs.c
@@ -518,6 +518,9 @@ static void smk_rule_show(struct seq_file *s, struct smack_rule *srp, int max)
 	if (strlen(srp->smk_subject) >= max || strlen(srp->smk_object) >= max)
 		return;
 
+	if (srp->smk_access == 0)
+		return;
+
 	seq_printf(s, "%s %s", srp->smk_subject, srp->smk_object);
 
 	seq_putc(s, ' ');
@@ -532,8 +535,6 @@ static void smk_rule_show(struct seq_file *s, struct smack_rule *srp, int max)
 		seq_putc(s, 'a');
 	if (srp->smk_access & MAY_TRANSMUTE)
 		seq_putc(s, 't');
-	if (srp->smk_access == 0)
-		seq_putc(s, '-');
 
 	seq_putc(s, '\n');
 }

