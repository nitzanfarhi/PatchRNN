commit 910ee13b20b622b9aa0c53025d86b19e9dcdf586
Author: Dan Fandrich <dan@coneharvesters.com>
Date:   Tue Apr 10 00:38:41 2007 +0000

    Fixed an out of memory handling issue.

diff --git a/lib/http.c b/lib/http.c
index 011f1141e..8e4d322af 100644
--- a/lib/http.c
+++ b/lib/http.c
@@ -1206,15 +1206,18 @@ CURLcode Curl_proxyCONNECT(struct connectdata *conn,
             /* CRLF terminate the request */
             result = add_bufferf(req_buffer, "\r\n");
 
-          if(CURLE_OK == result)
+          if(CURLE_OK == result) {
             /* Now send off the request */
             result = add_buffer_send(req_buffer, conn,
                                      &data->info.request_size, 0, sockindex);
+            req_buffer = NULL;
+          }
         }
         if(result)
           failf(data, "Failed sending CONNECT to proxy");
       }
       free(host_port);
+      Curl_safefree(req_buffer);
       if(result)
         return result;
 

