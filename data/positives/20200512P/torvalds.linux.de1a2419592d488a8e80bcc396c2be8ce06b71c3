commit de1a2419592d488a8e80bcc396c2be8ce06b71c3
Author: Russell King <rmk+kernel@arm.linux.org.uk>
Date:   Thu Jun 27 10:29:32 2013 +0100

    DMA-API: dma: pl08x: add dma_set_mask_and_coherent() call
    
    The DMA API requires drivers to call the appropriate dma_set_mask()
    functions before doing any DMA mapping.  Add this required call to
    the AMBA PL08x driver.
    
    Acked-by: Vinod Koul <vinod.koul@intel.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>

diff --git a/drivers/dma/amba-pl08x.c b/drivers/dma/amba-pl08x.c
index fce46c5bf1c7..e51a9832ef0d 100644
--- a/drivers/dma/amba-pl08x.c
+++ b/drivers/dma/amba-pl08x.c
@@ -2055,6 +2055,11 @@ static int pl08x_probe(struct amba_device *adev, const struct amba_id *id)
 	if (ret)
 		return ret;
 
+	/* Ensure that we can do DMA */
+	ret = dma_set_mask_and_coherent(&adev->dev, DMA_BIT_MASK(32));
+	if (ret)
+		goto out_no_pl08x;
+
 	/* Create the driver state holder */
 	pl08x = kzalloc(sizeof(*pl08x), GFP_KERNEL);
 	if (!pl08x) {

