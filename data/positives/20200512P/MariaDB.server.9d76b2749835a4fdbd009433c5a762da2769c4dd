commit 9d76b2749835a4fdbd009433c5a762da2769c4dd
Author: Marko Mäkelä <marko.makela@mariadb.com>
Date:   Wed Dec 13 22:30:13 2017 +0200

    Follow-up fix for MDEV-12352: Plug a memory leak
    
    trx_rollback_active(): When aborting the rollback, free the query graph.

diff --git a/storage/innobase/trx/trx0roll.cc b/storage/innobase/trx/trx0roll.cc
index de4f48a1506..ab488b06121 100644
--- a/storage/innobase/trx/trx0roll.cc
+++ b/storage/innobase/trx/trx0roll.cc
@@ -579,6 +579,8 @@ trx_rollback_active(
 		ut_ad(!srv_undo_sources);
 		ut_ad(srv_fast_shutdown);
 		ut_ad(!dictionary_locked);
+		que_graph_free(static_cast<que_t*>(
+				       roll_node->undo_thr->common.parent));
 		goto func_exit;
 	}
 
diff --git a/storage/xtradb/trx/trx0roll.cc b/storage/xtradb/trx/trx0roll.cc
index de4f48a1506..ab488b06121 100644
--- a/storage/xtradb/trx/trx0roll.cc
+++ b/storage/xtradb/trx/trx0roll.cc
@@ -579,6 +579,8 @@ trx_rollback_active(
 		ut_ad(!srv_undo_sources);
 		ut_ad(srv_fast_shutdown);
 		ut_ad(!dictionary_locked);
+		que_graph_free(static_cast<que_t*>(
+				       roll_node->undo_thr->common.parent));
 		goto func_exit;
 	}
 

