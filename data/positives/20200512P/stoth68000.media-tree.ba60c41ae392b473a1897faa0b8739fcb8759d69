commit ba60c41ae392b473a1897faa0b8739fcb8759d69
Author: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
Date:   Wed Sep 2 12:33:53 2015 +0530

    kvm: irqchip: fix memory leak
    
    We were taking the exit path after checking ue->flags and return value
    of setup_routing_entry(), but 'e' was not freed incase of a failure.
    
    Signed-off-by: Sudip Mukherjee <sudip@vectorindia.org>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

diff --git a/virt/kvm/irqchip.c b/virt/kvm/irqchip.c
index 21c14244f4c4..d7ea8e20dae4 100644
--- a/virt/kvm/irqchip.c
+++ b/virt/kvm/irqchip.c
@@ -213,11 +213,15 @@ int kvm_set_irq_routing(struct kvm *kvm,
 			goto out;
 
 		r = -EINVAL;
-		if (ue->flags)
+		if (ue->flags) {
+			kfree(e);
 			goto out;
+		}
 		r = setup_routing_entry(new, e, ue);
-		if (r)
+		if (r) {
+			kfree(e);
 			goto out;
+		}
 		++ue;
 	}
 

