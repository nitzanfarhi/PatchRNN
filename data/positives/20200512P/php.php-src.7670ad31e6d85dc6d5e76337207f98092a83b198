commit 7670ad31e6d85dc6d5e76337207f98092a83b198
Author: Antony Dovgal <tony2001@php.net>
Date:   Thu Jan 8 22:36:03 2009 +0000

    MFH: use correct check for constants and stop segfaulting
    (5_2 doesn't need this)

diff --git a/Zend/zend_compile.c b/Zend/zend_compile.c
index ae51d4de2c..bcabafb03c 100644
--- a/Zend/zend_compile.c
+++ b/Zend/zend_compile.c
@@ -4641,7 +4641,7 @@ void zend_do_declare_stmt(znode *var, znode *val TSRMLS_DC)
 		zend_encoding *new_encoding, *old_encoding;
 		zend_encoding_filter old_input_filter;
 
-		if (Z_TYPE(val->u.constant) == IS_CONSTANT) {
+		if ((Z_TYPE(val->u.constant) & IS_CONSTANT_TYPE_MASK) == IS_CONSTANT) {
 			zend_error(E_COMPILE_ERROR, "Cannot use constants as encoding");
 		}
 

