commit d2042caca68c29b14785069b7bb1c843379b142e
Author: SergeyV@selena. <>
Date:   Fri Nov 11 19:06:18 2005 +0300

    Fixes bug #14569. In addition to check current db of not being NULL value
    it is added a check of not being empty value. When modifying SP with Admin
    application on win32 it does not pass curent database so sp is stored with
    db=null which causes a crash later on show procedure status;

diff --git a/sql/sql_parse.cc b/sql/sql_parse.cc
index 4bbca55f6ba..03abd98c944 100644
--- a/sql/sql_parse.cc
+++ b/sql/sql_parse.cc
@@ -4099,7 +4099,7 @@ end_with_restore_list:
 
     if (!lex->sphead->m_db.str || !lex->sphead->m_db.str[0])
     {
-      if (! thd->db)
+      if (!thd->db || thd->db[0] == 0)
       {
         my_message(ER_NO_DB_ERROR, ER(ER_NO_DB_ERROR), MYF(0));
         delete lex->sphead;

