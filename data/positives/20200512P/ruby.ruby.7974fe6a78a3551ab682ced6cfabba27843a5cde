commit 7974fe6a78a3551ab682ced6cfabba27843a5cde
Author: headius <headius@b2dd03c8-39d4-4d8f-98ff-823fe69b080e>
Date:   Sat Aug 3 21:53:54 2013 +0000

    * ext/stringio/stringio.c (strio_substr): Trivial fix for invalid
      pointer when len = 0 and pos outside of string. Bug #8728.
    
    git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/trunk@42366 b2dd03c8-39d4-4d8f-98ff-823fe69b080e

diff --git a/ext/stringio/stringio.c b/ext/stringio/stringio.c
index 57854919cd..ef3df832b8 100644
--- a/ext/stringio/stringio.c
+++ b/ext/stringio/stringio.c
@@ -102,6 +102,7 @@ strio_substr(struct StringIO *ptr, long pos, long len)
 
     if (len > rlen) len = rlen;
     if (len < 0) len = 0;
+    if (len == 0) return rb_str_new(0,0);
     return rb_enc_str_new(RSTRING_PTR(str)+pos, len, enc);
 }
 

