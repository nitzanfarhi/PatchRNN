commit 3ff9667010d76850eea79bdb7ff489b24dac2c32
Author: Tomasz Sterna <tomek@xiaoka.com>
Date:   Tue May 3 22:56:07 2016 +0200

    CID 90844 Drop incoming conn if unable to get port

diff --git a/router/router.c b/router/router.c
index bc2a085..d705540 100644
--- a/router/router.c
+++ b/router/router.c
@@ -1085,7 +1085,8 @@ int router_mio_callback(mio_t m, mio_action_t a, mio_fd_t fd, void *data, void *
         case action_ACCEPT:
             log_debug(ZONE, "accept action on fd %d", fd->fd);
 
-            getpeername(fd->fd, (struct sockaddr *) &sa, &namelen);
+            if(getpeername(fd->fd, (struct sockaddr *) &sa, &namelen) < 0)
+                return 1;
             port = j_inet_getport(&sa);
 
             log_write(r->log, LOG_NOTICE, "[%s, port=%d] connect", (char *) data, port);

