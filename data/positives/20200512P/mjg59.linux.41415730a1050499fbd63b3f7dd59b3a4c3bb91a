commit 41415730a1050499fbd63b3f7dd59b3a4c3bb91a
Author: Josef Bacik <josef@redhat.com>
Date:   Wed Mar 16 13:59:32 2011 -0400

    Btrfs: check return value of btrfs_search_slot properly
    
    Doing an audit of where we use btrfs_search_slot only showed one place where we
    don't check the return value of btrfs_search_slot properly.  Just fix
    mark_extent_written to see if btrfs_search_slot failed and act accordingly.
    Thanks,
    
    Signed-off-by: Josef Bacik <josef@redhat.com>

diff --git a/fs/btrfs/file.c b/fs/btrfs/file.c
index 3786eca2a905..a85b044cf39e 100644
--- a/fs/btrfs/file.c
+++ b/fs/btrfs/file.c
@@ -608,6 +608,8 @@ again:
 	key.offset = split;
 
 	ret = btrfs_search_slot(trans, root, &key, path, -1, 1);
+	if (ret < 0)
+		goto out;
 	if (ret > 0 && path->slots[0] > 0)
 		path->slots[0]--;
 

