commit f96b36c779f92328bb1c802e6268609191d4449d
Author: Claudiu Beznea <claudiu.beznea@gmail.com>
Date:   Wed Mar 23 20:37:26 2016 +0200

    Staging: wlan-ng: wiphy_free() is not called in case wiphy_register() fails
    
    This patch covers wiphy_register() failures in wlan_create_wiphy()
    from cfg80211.c by calling wiphy_free() for the correspondent
    struct wiphy allocated structure.
    
    Signed-off-by: Claudiu Beznea <claudiu.beznea@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/wlan-ng/cfg80211.c b/drivers/staging/wlan-ng/cfg80211.c
index 8bad018eda47..ee989d1d5715 100644
--- a/drivers/staging/wlan-ng/cfg80211.c
+++ b/drivers/staging/wlan-ng/cfg80211.c
@@ -771,8 +771,10 @@ static struct wiphy *wlan_create_wiphy(struct device *dev, wlandevice_t *wlandev
 	wiphy->n_cipher_suites = PRISM2_NUM_CIPHER_SUITES;
 	wiphy->cipher_suites = prism2_cipher_suites;
 
-	if (wiphy_register(wiphy) < 0)
+	if (wiphy_register(wiphy) < 0) {
+		wiphy_free(wiphy);
 		return NULL;
+	}
 
 	return wiphy;
 }

