commit f38dfec3fd3757fd02d8c7bb46fecdfc427678ce
Author: Alex Reece <alex@delphix.com>
Date:   Thu Sep 4 16:08:28 2014 -0700

    Illumos 5049 - panic when removing log device
    
    Reviewed by: George Wilson <george.wilson@delphix.com>
    Reviewed by: Mattew Ahrens <mahrens@delphix.com>
    Reviewed by: Paul Dagnelie <paul.dagnelie@delphix.com>
    Reviewed by: Dan Kimmel <dan.kimmel@delphix.com>
    Reviewed by: Saso Kiselkov <skiselkov@gmail.com>
    Approved by: Rich Lowe <richlowe@richlowe.net>
    
    References:
      https://www.illumos.org/issues/5049
      https://github.com/illumos/illumos-gate/commit/2986efa
    
    Ported-by: Brian Behlendorf <behlendorf1@llnl.gov>
    Closes #2636

diff --git a/module/zfs/vdev.c b/module/zfs/vdev.c
index 0303edada..7c689b3c8 100644
--- a/module/zfs/vdev.c
+++ b/module/zfs/vdev.c
@@ -2655,8 +2655,9 @@ vdev_get_stats(vdev_t *vd, vdev_stat_t *vs)
 	if (vd->vdev_ops->vdev_op_leaf)
 		vs->vs_rsize += VDEV_LABEL_START_SIZE + VDEV_LABEL_END_SIZE;
 	vs->vs_esize = vd->vdev_max_asize - vd->vdev_asize;
-	if (vd->vdev_aux == NULL && vd == vd->vdev_top)
+	if (vd->vdev_aux == NULL && vd == vd->vdev_top && !vd->vdev_ishole) {
 		vs->vs_fragmentation = vd->vdev_mg->mg_fragmentation;
+	}
 
 	/*
 	 * If we're getting stats on the root vdev, aggregate the I/O counts

