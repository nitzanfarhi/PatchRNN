commit 3ff69d5dc4ae7c2161b1956bd3f006443e9b3d2b
Author: gluh@gluh.mysql.r18.ru <>
Date:   Mon Nov 24 13:57:49 2003 +0400

    Fix for bug #1855: mysqld crashes with certain SSL connections

diff --git a/sql/sql_acl.cc b/sql/sql_acl.cc
index 065394c87d0..03a359d44e7 100644
--- a/sql/sql_acl.cc
+++ b/sql/sql_acl.cc
@@ -588,6 +588,11 @@ ulong acl_getroot(THD *thd, const char *host, const char *ip, const char *user,
 	      /* Prepare certificate (if exists) */
 	      DBUG_PRINT("info",("checkpoint 1"));
 	      X509* cert=SSL_get_peer_certificate(ssl);
+	      if (!cert)
+	      {
+		user_access=NO_ACCESS;
+		break;
+	      }
 	      DBUG_PRINT("info",("checkpoint 2"));
 	      /* If X509 issuer is speified, we check it... */
 	      if (acl_user->x509_issuer)

