commit eac5c7b8377f3f0e8262ab44e5ccb2c7ed060cdd
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Wed Dec 3 19:05:56 2014 +0100

    avformat/aviobuf: Fix infinite loop in ff_get_line()
    
    Fixes ticket4152
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavformat/aviobuf.c b/libavformat/aviobuf.c
index da94a4afff..f374314fba 100644
--- a/libavformat/aviobuf.c
+++ b/libavformat/aviobuf.c
@@ -676,7 +676,7 @@ int ff_get_line(AVIOContext *s, char *buf, int maxlen)
         if (c && i < maxlen-1)
             buf[i++] = c;
     } while (c != '\n' && c != '\r' && c);
-    if (c == '\r' && avio_r8(s) != '\n')
+    if (c == '\r' && avio_r8(s) != '\n' && !avio_feof(s))
         avio_skip(s, -1);
 
     buf[i] = 0;

