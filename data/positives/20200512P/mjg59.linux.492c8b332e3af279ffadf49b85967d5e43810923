commit 492c8b332e3af279ffadf49b85967d5e43810923
Author: Christoph Hellwig <hch@lst.de>
Date:   Wed May 23 13:57:53 2007 -0700

    uselib: add missing MNT_NOEXEC check
    
    We don't allow loading ELF shared library from noexec points so the
    same should apply to sys_uselib aswell.
    
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Cc: Ulrich Drepper <drepper@gmail.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/fs/exec.c b/fs/exec.c
index 0b685888ff6f..f20561ff4528 100644
--- a/fs/exec.c
+++ b/fs/exec.c
@@ -134,6 +134,9 @@ asmlinkage long sys_uselib(const char __user * library)
 	if (error)
 		goto out;
 
+	error = -EACCES;
+	if (nd.mnt->mnt_flags & MNT_NOEXEC)
+		goto exit;
 	error = -EINVAL;
 	if (!S_ISREG(nd.dentry->d_inode->i_mode))
 		goto exit;

