commit b91eade93ba9812a7f6a4678f8e9e3a18aa1ecdf
Author: pancake <pancake@nopcode.org>
Date:   Mon Nov 16 22:15:26 2015 +0100

    Fix malloc(0) issue in /c

diff --git a/libr/core/cmd_search.c b/libr/core/cmd_search.c
index e320eef8d..bdd65d1d3 100644
--- a/libr/core/cmd_search.c
+++ b/libr/core/cmd_search.c
@@ -812,7 +812,12 @@ static void print_rop (RCore *core, RList *hitlist, char mode, int *json_first)
 		r_list_foreach (hitlist, iter, hit) {
 			char *comment = rop_comments ?r_meta_get_string (core->anal,
 					R_META_TYPE_COMMENT, hit->addr) : NULL;
-			ut8 *buf = malloc (hit->len);
+			if (hit->len<0) {
+				eprintf ("Invalid hit length here\n");
+				continue;
+			}
+			ut8 *buf = malloc (1 + hit->len);
+			buf[hit->len] = 0;
 			r_core_read_at (core, hit->addr, buf, hit->len);
 			r_asm_set_pc (core->assembler, hit->addr);
 			r_asm_disassemble (core->assembler, &asmop, buf, hit->len);

