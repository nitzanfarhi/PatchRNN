commit b3d67e7c7019a2ea4a8b5c1f84c41ae9b03a8218
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Wed Jan 7 16:46:04 2009 +0100

    Medium: PE: CID:7,8 - Prevent hypothetical use-of-NULL in LogActions
    
    Mercurial revision: 300a2cbba3f543a0777eeeae8f8e476e680a1459

diff --git a/pengine/native.c b/pengine/native.c
index 10341a8b0..fca5c8534 100644
--- a/pengine/native.c
+++ b/pengine/native.c
@@ -1303,12 +1303,14 @@ LogActions(resource_t *rsc, pe_working_set_t *data_set)
 	    start = possible_matches->data;
 	}
 
-	if(start == NULL || start->optional) {
+	CRM_CHECK(next != NULL,);
+	if(next == FALSE) {
+	} else if(start == NULL || start->optional) {
 	    crm_notice("Leave resource %s\t(%s %s%s)",
 		       rsc->id, role2text(rsc->role), next->details->uname,
 		       is_not_set(rsc->flags, pe_rsc_managed)?" unmanaged":"");
 	    
-	} else if(moving) {
+	} else if(moving && current) {
 	    crm_notice("Move resource %s\t(%s %s -> %s)",
 		       rsc->id, role2text(rsc->role), current->details->uname, next->details->uname);
 	    
@@ -1326,20 +1328,30 @@ LogActions(resource_t *rsc, pe_working_set_t *data_set)
     }
 
     if(rsc->role > RSC_ROLE_SLAVE && rsc->role > rsc->next_role) {
-	crm_notice("Demote %s\t(%s -> %s %s)", rsc->id,
-		   role2text(rsc->role), role2text(rsc->next_role),
-		   current->details->uname);
+	CRM_CHECK(current != NULL,);
+	if(current != NULL) {
+	    crm_notice("Demote %s\t(%s -> %s %s)", rsc->id,
+		       role2text(rsc->role), role2text(rsc->next_role),
+		       current->details->uname);
+	}
     }
 
     if(rsc->next_role == RSC_ROLE_STOPPED || moving) {
-	crm_notice("Stop resource %s\t(%s)", rsc->id, current->details->uname);
+	CRM_CHECK(current != NULL,);
+	if(current != NULL) {
+	    crm_notice("Stop resource %s\t(%s)", rsc->id, current->details->uname);
+	}
     }
 
     if(rsc->role == RSC_ROLE_STOPPED || moving) {
-	crm_notice("Start %s\t(%s)", rsc->id, next->details->uname);
+	CRM_CHECK(next != NULL,);
+	if(next != NULL) {
+	    crm_notice("Start %s\t(%s)", rsc->id, next->details->uname);
+	}
     }    
 
     if(rsc->next_role > RSC_ROLE_MASTER && rsc->role < rsc->next_role) {
+	CRM_CHECK(next != NULL,);
 	crm_notice("Promote %s\t(%s -> %s %s)", rsc->id,
 		   role2text(rsc->role), role2text(rsc->next_role),
 		   next->details->uname);

