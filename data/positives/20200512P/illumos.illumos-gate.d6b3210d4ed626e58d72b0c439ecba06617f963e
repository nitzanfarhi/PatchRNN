commit d6b3210d4ed626e58d72b0c439ecba06617f963e
Author: sowmini <none@none>
Date:   Tue Feb 27 13:44:50 2007 -0800

    6494556 in.routed leaks memory via rt_spares
    6498249 ripv2 client not updating network route with lower metric

diff --git a/usr/src/cmd/cmd-inet/usr.sbin/in.routed/input.c b/usr/src/cmd/cmd-inet/usr.sbin/in.routed/input.c
index 8d12d005ef..1a17a3371f 100644
--- a/usr/src/cmd/cmd-inet/usr.sbin/in.routed/input.c
+++ b/usr/src/cmd/cmd-inet/usr.sbin/in.routed/input.c
@@ -1,5 +1,5 @@
 /*
- * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
+ * Copyright 2007 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
  *
  * Copyright (c) 1983, 1988, 1993
@@ -1164,11 +1164,13 @@ input_route(in_addr_t dst,			/* network order */
 		 * then note it.
 		 */
 		if (i == rt->rt_num_spares) {
+			uint8_t old_metric = rts->rts_metric;
+
 			rtchange(rt, rt->rt_state | rt_state, new, 0);
 			/*
 			 * If the route got worse, check for something better.
 			 */
-			if (new->rts_metric != rts->rts_metric)
+			if (new->rts_metric != old_metric)
 				rtswitch(rt, 0);
 			return;
 		}
diff --git a/usr/src/cmd/cmd-inet/usr.sbin/in.routed/table.c b/usr/src/cmd/cmd-inet/usr.sbin/in.routed/table.c
index f7dcbd4e26..e70bf4c332 100644
--- a/usr/src/cmd/cmd-inet/usr.sbin/in.routed/table.c
+++ b/usr/src/cmd/cmd-inet/usr.sbin/in.routed/table.c
@@ -1,5 +1,5 @@
 /*
- * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
+ * Copyright 2007 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
  *
  * Copyright (c) 1983, 1988, 1993
@@ -2465,6 +2465,7 @@ rtdelete(struct rt_entry *rt)
 			free(deleted_rt);
 	}
 	total_routes--;
+	free(rt->rt_spares);
 	free(rt);
 
 	if (dst_sock.sin_addr.s_addr == RIP_DEFAULT) {

