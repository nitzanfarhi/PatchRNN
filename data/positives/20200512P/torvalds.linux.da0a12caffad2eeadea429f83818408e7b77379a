commit da0a12caffad2eeadea429f83818408e7b77379a
Author: Li Zefan <lizefan@huawei.com>
Date:   Wed Jul 31 16:16:28 2013 +0800

    cgroup: fix a leak when percpu_ref_init() fails
    
    ss->css_free() is not called when perfcpu_ref_init() fails.
    
    Signed-off-by: Li Zefan <lizefan@huawei.com>
    Signed-off-by: Tejun Heo <tj@kernel.org>

diff --git a/kernel/cgroup.c b/kernel/cgroup.c
index afb8d53ca6c7..468e410f9e61 100644
--- a/kernel/cgroup.c
+++ b/kernel/cgroup.c
@@ -4344,8 +4344,10 @@ static long cgroup_create(struct cgroup *parent, struct dentry *dentry,
 		}
 
 		err = percpu_ref_init(&css->refcnt, css_release);
-		if (err)
+		if (err) {
+			ss->css_free(cgrp);
 			goto err_free_all;
+		}
 
 		init_cgroup_css(css, ss, cgrp);
 

