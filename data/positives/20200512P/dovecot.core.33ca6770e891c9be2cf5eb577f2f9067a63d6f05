commit 33ca6770e891c9be2cf5eb577f2f9067a63d6f05
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Dec 21 21:39:58 2007 +0200

    Don't try to cache BODY/BODYSTRUCTURE if we didn't even parse it.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-storage/index/index-mail.c b/src/lib-storage/index/index-mail.c
index 5826d0d7e..08d926557 100644
--- a/src/lib-storage/index/index-mail.c
+++ b/src/lib-storage/index/index-mail.c
@@ -542,6 +542,9 @@ index_mail_body_parsed_cache_bodystructure(struct index_mail *mail,
 		}
 	}
 
+	if (!data->parsed_bodystructure)
+		return;
+
 	/* If BODY is fetched first but BODYSTRUCTURE is also wanted, we don't
 	   normally want to first cache BODY and then BODYSTRUCTURE. So check
 	   the wanted_fields also in here. */

