commit aa877b3dc9f2a1fdffac4ea36bee97c21db11a69
Author: Glauber de Oliveira Costa <glommer@br.ibm.com>
Date:   Mon Nov 28 13:44:02 2005 -0800

    [PATCH] ext3: Wrong return value for EXT3_IOC_GROUP_ADD
    
    This patch corrects the return value for the EXT3_IOC_GROUP_ADD in case it
    fails due to the presence of multiple resizers at the filesystem.
    
    The problem is a little bit more serious than a wrong return value in this
    case, since the clause err=0 in the exit_journal path will lead to a call
    to update_backups which in turns causes a NULL pointer dereference.
    
    Signed-off-by: Glauber de Oliveira Costa <glommer@br.ibm.com>
    Cc: "Stephen C. Tweedie" <sct@redhat.com>
    Cc: Andreas Dilger <adilger@clusterfs.com>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/fs/ext3/resize.c b/fs/ext3/resize.c
index 1be78b4b4de9..6104ad310507 100644
--- a/fs/ext3/resize.c
+++ b/fs/ext3/resize.c
@@ -767,6 +767,7 @@ int ext3_group_add(struct super_block *sb, struct ext3_new_group_data *input)
 	if (input->group != EXT3_SB(sb)->s_groups_count) {
 		ext3_warning(sb, __FUNCTION__,
 			     "multiple resizers run on filesystem!\n");
+		err = -EBUSY;
 		goto exit_journal;
 	}
 

