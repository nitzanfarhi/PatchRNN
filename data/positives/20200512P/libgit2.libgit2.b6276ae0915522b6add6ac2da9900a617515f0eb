commit b6276ae0915522b6add6ac2da9900a617515f0eb
Author: Patrick Steinhardt <ps@pks.im>
Date:   Thu Mar 29 09:15:48 2018 +0100

    odb: mempack: fix leaking objects when freeing mempacks
    
    When a ODB mempack gets free'd, we take no measures at all to free its
    contents, most notably the objects added to the database, resulting in a
    memory leak. Call `git_mempack_reset` previous to freeing the ODB
    structures themselves, which takes care of releasing all associated
    data structures.

diff --git a/src/odb_mempack.c b/src/odb_mempack.c
index a81716ee3..e351d4df9 100644
--- a/src/odb_mempack.c
+++ b/src/odb_mempack.c
@@ -157,6 +157,7 @@ static void impl__free(git_odb_backend *_backend)
 {
 	struct memory_packer_db *db = (struct memory_packer_db *)_backend;
 
+	git_mempack_reset(_backend);
 	git_oidmap_free(db->objects);
 	git__free(db);
 }

