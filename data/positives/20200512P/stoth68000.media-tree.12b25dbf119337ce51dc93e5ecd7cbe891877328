commit 12b25dbf119337ce51dc93e5ecd7cbe891877328
Author: Clement Perrochaud <clement.perrochaud@nxp.com>
Date:   Tue Apr 8 11:13:49 2014 +0000

    NFC: pn544_i2c: Fix null pointer exception when not using platform data
    
    Fixes a null pointer exception occurring when the IRQ request in
    pn544_hci_i2c_probe fails and no platform data is available.
    
    Signed-off-by: Cl√©ment Perrochaud <clement.perrochaud@nxp.com>
    Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>

diff --git a/drivers/nfc/pn544/i2c.c b/drivers/nfc/pn544/i2c.c
index 5239e3b54120..440291ab7263 100644
--- a/drivers/nfc/pn544/i2c.c
+++ b/drivers/nfc/pn544/i2c.c
@@ -1029,8 +1029,12 @@ static int pn544_hci_i2c_probe(struct i2c_client *client,
 	free_irq(client->irq, phy);
 
 err_rti:
-	if (pdata->free_resources != NULL)
+	if (!pdata) {
+		gpio_free(phy->gpio_en);
+		gpio_free(phy->gpio_fw);
+	} else if (pdata->free_resources) {
 		pdata->free_resources();
+	}
 
 	return r;
 }

