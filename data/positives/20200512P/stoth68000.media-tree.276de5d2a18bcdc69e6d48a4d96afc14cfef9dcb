commit 276de5d2a18bcdc69e6d48a4d96afc14cfef9dcb
Author: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
Date:   Sun May 23 14:16:13 2010 +0300

    UBIFS: check return code
    
    The error code from 'ubifs_rcvry_gc_commit()' was ignored, so UBIFS
    failed to recover and continued. Instead, we should refuse mounting
    the file-system.
    
    Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>

diff --git a/fs/ubifs/super.c b/fs/ubifs/super.c
index 4d2f2157dd3f..010eea009036 100644
--- a/fs/ubifs/super.c
+++ b/fs/ubifs/super.c
@@ -1307,6 +1307,8 @@ static int mount_ubifs(struct ubifs_info *c)
 			if (err)
 				goto out_orphans;
 			err = ubifs_rcvry_gc_commit(c);
+			if (err)
+				goto out_orphans;
 		} else {
 			err = take_gc_lnum(c);
 			if (err)

