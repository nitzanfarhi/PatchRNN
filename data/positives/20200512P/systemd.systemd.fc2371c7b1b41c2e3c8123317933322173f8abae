commit fc2371c7b1b41c2e3c8123317933322173f8abae
Author: Doug Christman <douglaschristman@gmail.com>
Date:   Wed Dec 14 13:21:27 2016 -0500

    calendarspec: free memory when parsing fails (#4890)
    
    This prevents memory leaks on strings like `*~*-*`.
    
    Fixes #4887

diff --git a/src/basic/calendarspec.c b/src/basic/calendarspec.c
index 514587d23..adf79eb53 100644
--- a/src/basic/calendarspec.c
+++ b/src/basic/calendarspec.c
@@ -688,8 +688,11 @@ static int parse_date(const char **p, CalendarSpec *c) {
                 c->month = first;
                 c->day = second;
                 return 0;
-        } else if (c->end_of_month)
+        } else if (c->end_of_month) {
+                free_chain(first);
+                free_chain(second);
                 return -EINVAL;
+        }
 
         if (*t == '~')
                 c->end_of_month = true;

