commit 66ac9fe7bacf9fa76c472efc7a7aaa590c7bce6a
Author: David Sterba <dsterba@suse.com>
Date:   Tue Apr 26 16:03:57 2016 +0200

    btrfs: add check to sysfs handler of label
    
    Add a sanity check for the fs_info as we will dereference it, similar to
    what the 'store features' handler does.
    
    Signed-off-by: David Sterba <dsterba@suse.com>

diff --git a/fs/btrfs/sysfs.c b/fs/btrfs/sysfs.c
index 6a6bb600b1ff..3d14618ce54b 100644
--- a/fs/btrfs/sysfs.c
+++ b/fs/btrfs/sysfs.c
@@ -377,6 +377,9 @@ static ssize_t btrfs_label_store(struct kobject *kobj,
 	struct btrfs_fs_info *fs_info = to_fs_info(kobj);
 	size_t p_len;
 
+	if (!fs_info)
+		return -EPERM;
+
 	if (fs_info->sb->s_flags & MS_RDONLY)
 		return -EROFS;
 

