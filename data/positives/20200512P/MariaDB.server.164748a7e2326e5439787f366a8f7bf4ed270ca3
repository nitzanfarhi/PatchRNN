commit 164748a7e2326e5439787f366a8f7bf4ed270ca3
Author: Zardosht Kasheff <zardosht@tokutek.com>
Date:   Wed Apr 17 00:02:08 2013 -0400

    [t:4472], add table lock for truncate
    
    git-svn-id: file:///svn/mysql/tokudb-engine/tokudb-engine@39739 c7de825b-a66e-492c-adef-691d508d4ae1

diff --git a/storage/tokudb/ha_tokudb.cc b/storage/tokudb/ha_tokudb.cc
index f7e44b51b2d..434af7352a7 100644
--- a/storage/tokudb/ha_tokudb.cc
+++ b/storage/tokudb/ha_tokudb.cc
@@ -7851,6 +7851,11 @@ int ha_tokudb::delete_all_rows() {
             txn
             );
         if (error) { goto cleanup; }
+        error = share->key_file[i]->pre_acquire_table_lock(
+            share->key_file[i], 
+            txn
+            );
+        if (error) { goto cleanup; }
     }
     for (uint i = 0; i < curr_num_DBs; i++) {
         error = truncate_dictionary(i, txn);

