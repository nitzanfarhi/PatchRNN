commit a2d977362a01b38243e4840f15dd4f289a984a58
Author: Timo Sirainen <tss@iki.fi>
Date:   Sun Jan 25 19:39:41 2009 -0500

    dict proxy client: Don't hang when doing an async commit.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-dict/dict-client.c b/src/lib-dict/dict-client.c
index a32681f49..8fb8fb740 100644
--- a/src/lib-dict/dict-client.c
+++ b/src/lib-dict/dict-client.c
@@ -473,10 +473,10 @@ static int client_dict_transaction_commit(struct dict_transaction_context *_ctx,
 					ctx->id);
 		if (client_dict_send_transaction_query(ctx, query) < 0)
 			ret = -1;
-		else if (ret < 0) {
-			/* rollback sent, it has no reply */
+		else if (ret < 0 || async) {
+			/* no reply */
 		} else {
-			/* read reply */
+			/* sync commit, read reply */
 			line = client_dict_read_line(dict);
 			if (line == NULL || *line != DICT_PROTOCOL_REPLY_OK)
 				ret = -1;

