commit 7521ce6eb2d3650a04ac7a1d176607ae9441826a
Author: Avinash Patil <patila@marvell.com>
Date:   Wed Feb 11 23:12:25 2015 +0530

    mwifiex: do not process mgmt rx on uninitialized interface
    
    This patch fixes a crash which was happening because of RX of
    management frames on uninitialzed interface. Now we drop management
    frames for interfaces where cfg80211 has not registered any management
    subtype reception or interface has no NL80211 iftype set.
    
    Signed-off-by: Avinash Patil <patila@marvell.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>

diff --git a/drivers/net/wireless/mwifiex/util.c b/drivers/net/wireless/mwifiex/util.c
index 308550611f22..47e215b6d5f5 100644
--- a/drivers/net/wireless/mwifiex/util.c
+++ b/drivers/net/wireless/mwifiex/util.c
@@ -367,6 +367,13 @@ mwifiex_process_mgmt_packet(struct mwifiex_private *priv,
 	if (!skb)
 		return -1;
 
+	if (!priv->mgmt_frame_mask ||
+	    priv->wdev.iftype == NL80211_IFTYPE_UNSPECIFIED) {
+		dev_dbg(priv->adapter->dev,
+			"do not receive mgmt frames on uninitialized intf");
+		return -1;
+	}
+
 	rx_pd = (struct rxpd *)skb->data;
 
 	skb_pull(skb, le16_to_cpu(rx_pd->rx_pkt_offset));

