commit 00ee7a37fdc3ed9bc6315f8af0270f2df55437d7
Author: Octavian Purdila <octavian.purdila@intel.com>
Date:   Tue Nov 18 14:57:59 2014 +0200

    mfd: dln2: Add a limit check for invalid echo
    
    The echo field in dln2_transfer_complete comes directly from an USB
    transfer and we should not trust it is valid.
    
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Octavian Purdila <octavian.purdila@intel.com>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>

diff --git a/drivers/mfd/dln2.c b/drivers/mfd/dln2.c
index cf22841c1e3c..df2fda9cd3db 100644
--- a/drivers/mfd/dln2.c
+++ b/drivers/mfd/dln2.c
@@ -195,6 +195,9 @@ static bool dln2_transfer_complete(struct dln2_dev *dln2, struct urb *urb,
 	struct dln2_rx_context *rxc;
 	bool valid_slot = false;
 
+	if (rx_slot >= DLN2_MAX_RX_SLOTS)
+		goto out;
+
 	rxc = &rxs->slots[rx_slot];
 
 	/*
@@ -210,6 +213,7 @@ static bool dln2_transfer_complete(struct dln2_dev *dln2, struct urb *urb,
 	}
 	spin_unlock(&rxs->lock);
 
+out:
 	if (!valid_slot)
 		dev_warn(dev, "bad/late response %d/%d\n", handle, rx_slot);
 

