commit 28a0291d07d54e7d40b4453e25cc41ced8ff2b3b
Author: Victor Julien <victor@inliniac.net>
Date:   Thu Aug 9 13:45:04 2018 +0200

    detect: don't setup PMATCH if it will be unused
    
    Safes a bit of memory and makes it easier to debug.

diff --git a/src/detect-engine-build.c b/src/detect-engine-build.c
index 98004b91..47b1d24d 100644
--- a/src/detect-engine-build.c
+++ b/src/detect-engine-build.c
@@ -1849,6 +1849,9 @@ static int SigMatchPrepare(DetectEngineCtx *de_ctx)
         /* built-ins */
         int type;
         for (type = 0; type < DETECT_SM_LIST_MAX; type++) {
+            /* skip PMATCH if it is used in a stream 'app engine' instead */
+            if (type == DETECT_SM_LIST_PMATCH && (s->init_data->init_flags & SIG_FLAG_INIT_STATE_MATCH))
+                continue;
             SigMatch *sm = s->init_data->smlists[type];
             s->sm_arrays[type] = SigMatchList2DataArray(sm);
         }

