commit ffc1c742c0fc55c717a88bcfd322e75dae17fa37
Author: Riccardo Magliocchetti <riccardo.magliocchetti@gmail.com>
Date:   Tue Jul 7 16:14:23 2015 +0200

    plugins/emperor_amqp: fix leak on error path
    
    Reported by Coverity as CID #1308287

diff --git a/plugins/emperor_amqp/amqp.c b/plugins/emperor_amqp/amqp.c
index 00e14756..d39f2d9b 100644
--- a/plugins/emperor_amqp/amqp.c
+++ b/plugins/emperor_amqp/amqp.c
@@ -469,8 +469,10 @@ static char *amqp_simple_get_frame(int fd, struct amqp_frame_header *fh) {
         while(len < fh->size+1) {
                 rlen = recv(fd, ptr, (fh->size+1)-len, 0);
                 if (rlen <= 0) {
-			if (rlen < 0)
+			if (rlen < 0) {
                         	uwsgi_error("recv()");
+			}
+			free(frame);
                         return NULL;
                 }
                 len += rlen;

