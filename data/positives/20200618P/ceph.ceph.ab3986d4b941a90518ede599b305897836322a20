commit ab3986d4b941a90518ede599b305897836322a20
Author: Yehuda Sadeh <yehuda@hq.newdream.net>
Date:   Thu Dec 4 09:46:24 2008 -0800

    kclient: fix NULL dereferencing oops

diff --git a/src/kernel/snap.c b/src/kernel/snap.c
index 342af555e3..c335f465b7 100644
--- a/src/kernel/snap.c
+++ b/src/kernel/snap.c
@@ -724,11 +724,14 @@ void ceph_handle_snap(struct ceph_mds_client *mdsc,
 				continue;
 			ci = ceph_inode(inode);
 			spin_lock(&inode->i_lock);
+			if (!ci->i_snap_realm)
+				goto split_skip_inode;
 			ceph_put_snap_realm(mdsc, ci->i_snap_realm);
 			list_add(&ci->i_snap_realm_item,
 				 &realm->inodes_with_caps);
 			ci->i_snap_realm = realm;
 			realm->nref++;
+		split_skip_inode:
 			spin_unlock(&inode->i_lock);
 			iput(inode);
 		}

