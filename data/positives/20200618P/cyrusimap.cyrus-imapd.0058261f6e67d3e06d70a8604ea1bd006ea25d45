commit 0058261f6e67d3e06d70a8604ea1bd006ea25d45
Author: Bron Gondwana <brong@fastmail.fm>
Date:   Tue Dec 15 03:30:33 2009 +0000

    Fix memory leak in sync_flags_meta_to_list
    
    If flags changed name, we were writing over an
    xstrdup'd pointer without freeing if first.

diff --git a/imap/sync_support.c b/imap/sync_support.c
index 22e00e852..6da8ff2a6 100644
--- a/imap/sync_support.c
+++ b/imap/sync_support.c
@@ -39,7 +39,7 @@
  * AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING
  * OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
  *
- * $Id: sync_support.c,v 1.22 2009/03/31 04:11:20 brong Exp $
+ * $Id: sync_support.c,v 1.23 2009/12/15 03:30:33 brong Exp $
  */
 
 #include <config.h>
@@ -330,6 +330,9 @@ void sync_flags_meta_to_list(struct sync_flags_meta *meta, char **flagname)
             !strcmp(flagname[n], meta->flagname[n]))
             continue;
         
+	if (flagname[n])
+	    free(flagname[n]);
+
         if (meta->flagname[n])
             flagname[n] = xstrdup(meta->flagname[n]);
         else

