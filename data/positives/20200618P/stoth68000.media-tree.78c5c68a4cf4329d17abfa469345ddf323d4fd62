commit 78c5c68a4cf4329d17abfa469345ddf323d4fd62
Author: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Date:   Fri Dec 9 15:06:18 2011 +1100

    powerpc/pmac: Fix SMP kernels on pre-core99 UP machines
    
    The code for "powersurge" SMP would kick in and cause a crash
    at boot due to the lack of a NULL test.
    
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>

diff --git a/arch/powerpc/platforms/powermac/smp.c b/arch/powerpc/platforms/powermac/smp.c
index e6f7378f4a49..44d769258ebf 100644
--- a/arch/powerpc/platforms/powermac/smp.c
+++ b/arch/powerpc/platforms/powermac/smp.c
@@ -414,7 +414,7 @@ static struct irqaction psurge_irqaction = {
 
 static void __init smp_psurge_setup_cpu(int cpu_nr)
 {
-	if (cpu_nr != 0)
+	if (cpu_nr != 0 || !psurge_start)
 		return;
 
 	/* reset the entry point so if we get another intr we won't

