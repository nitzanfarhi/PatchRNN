commit c8a0ce0fd5fc70db4be5e6db0310f6708ad442b1
Author: Wouter Verhelst <w@uter.be>
Date:   Wed Nov 21 22:28:19 2012 +0100

    Fix off-by-one in exptrim
    
    Otherwise we may miss (part of) a TRIM command if it happens to fall on
    a file boundary (or on the start of a single-file export)
    
    Discovered-By: Nicolas Trangez

diff --git a/nbd-server.c b/nbd-server.c
index 9d16d18..13a2dda 100644
--- a/nbd-server.c
+++ b/nbd-server.c
@@ -1489,7 +1489,7 @@ int exptrim(struct nbd_request* req, CLIENT* client) {
 		if(i<client->export->len) {
 			cur = g_array_index(client->export, FILE_INFO, i);
 		}
-		if(prev.startoff < req->from) {
+		if(prev.startoff <= req->from) {
 			off_t curoff = req->from - prev.startoff;
 			off_t curlen = cur.startoff - prev.startoff - curoff;
 			fallocate(prev.fhandle, FALLOC_FL_PUNCH_HOLE, curoff, curlen);

