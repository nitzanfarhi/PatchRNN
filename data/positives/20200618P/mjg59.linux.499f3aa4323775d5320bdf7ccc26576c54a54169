commit 499f3aa4323775d5320bdf7ccc26576c54a54169
Author: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
Date:   Fri Sep 18 16:27:07 2015 +0530

    iommu/vt-d: Fix memory leak in dmar_insert_one_dev_info()
    
    We are returning NULL if we are not able to attach the iommu
    to the domain but while returning we missed freeing info.
    
    Signed-off-by: Sudip Mukherjee <sudip@vectorindia.org>
    Signed-off-by: Joerg Roedel <jroedel@suse.de>

diff --git a/drivers/iommu/intel-iommu.c b/drivers/iommu/intel-iommu.c
index 2d7349a3ee14..da99310c1b25 100644
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@ -2301,6 +2301,7 @@ static struct dmar_domain *dmar_insert_one_dev_info(struct intel_iommu *iommu,
 
 	if (ret) {
 		spin_unlock_irqrestore(&device_domain_lock, flags);
+		free_devinfo_mem(info);
 		return NULL;
 	}
 

