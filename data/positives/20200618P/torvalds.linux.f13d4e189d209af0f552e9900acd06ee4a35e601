commit f13d4e189d209af0f552e9900acd06ee4a35e601
Author: Marek Vasut <marex@denx.de>
Date:   Mon Sep 26 14:14:53 2016 +0200

    spi: imx: Gracefully handle NULL master->cs_gpios
    
    It is possible that master->cs_gpios is NULL after spi_bitbang_start(),
    this happens if the master has no CS GPIOs specified in DT. Check for
    this case after spi_bitbang_start() to prevent NULL pointer dereference
    in the subsequent for loop, which accesses the master->cs_gpios field.
    
    Signed-off-by: Marek Vasut <marex@denx.de>
    Cc: Martin Kaiser <martin@kaiser.cx>
    Cc: Mark Brown <broonie@kernel.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/drivers/spi/spi-imx.c b/drivers/spi/spi-imx.c
index 53e7a326c213..1ef5429afcb6 100644
--- a/drivers/spi/spi-imx.c
+++ b/drivers/spi/spi-imx.c
@@ -1268,6 +1268,11 @@ static int spi_imx_probe(struct platform_device *pdev)
 		goto out_clk_put;
 	}
 
+	if (!master->cs_gpios) {
+		dev_err(&pdev->dev, "No CS GPIOs available\n");
+		goto out_clk_put;
+	}
+
 	for (i = 0; i < master->num_chipselect; i++) {
 		if (!gpio_is_valid(master->cs_gpios[i]))
 			continue;

