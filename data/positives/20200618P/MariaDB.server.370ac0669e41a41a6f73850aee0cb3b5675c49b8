commit 370ac0669e41a41a6f73850aee0cb3b5675c49b8
Author: Tor Didriksen <tor.didriksen@oracle.com>
Date:   Thu Feb 7 17:05:07 2013 +0100

    Bug#16192219 CRASH IN TEST_IF_SKIP_SORT_ORDER ON SELECT DISTINCT WITH ORDER BY
    
    This is a backport of the fix for:
    
    Bug#13633549 HANDLE_FATAL_SIGNAL IN TEST_IF_SKIP_SORT_ORDER/CREATE_SORT_INDEX
    Don't invoke the range optimizer for a NULL select.

diff --git a/sql/sql_select.cc b/sql/sql_select.cc
index 89567bd1f5e..12143c739f7 100644
--- a/sql/sql_select.cc
+++ b/sql/sql_select.cc
@@ -13753,7 +13753,8 @@ test_if_skip_sort_order(JOIN_TAB *tab,ORDER *order,ha_rows select_limit,
 
     if (best_key >= 0)
     {
-      if (table->quick_keys.is_set(best_key) && best_key != ref_key)
+      if (select &&
+          table->quick_keys.is_set(best_key) && best_key != ref_key)
       {
         key_map map;
         map.clear_all();       // Force the creation of quick select

