commit 52c4c0fa4a24dc66018b7d1ce6116ea8d254259c
Author: Sage Weil <sage@newdream.net>
Date:   Wed Apr 23 11:11:50 2008 -0700

    kclient: reset session cap seq # on reconnect

diff --git a/src/kernel/mds_client.c b/src/kernel/mds_client.c
index 092c51d9d7..4a13c6cf35 100644
--- a/src/kernel/mds_client.c
+++ b/src/kernel/mds_client.c
@@ -1211,6 +1211,7 @@ void send_mds_reconnect(struct ceph_mds_client *mdsc, int mds)
 	session = __get_session(mdsc, mds);
 	if (session) {
 		session->s_state = CEPH_MDS_SESSION_RECONNECTING;
+		session->s_cap_seq = 0;
 
 		/* estimate needed space */
 		len += session->s_nr_caps *

