commit fc39e6fe2623534d383fe7a13368b8168bb6c466
Author: Sage Weil <sage@redhat.com>
Date:   Thu Dec 17 10:29:31 2015 -0500

    os/MemStore: fix use-after-free on iterator
    
    Signed-off-by: Sage Weil <sage@redhat.com>

diff --git a/src/os/MemStore.cc b/src/os/MemStore.cc
index 9033ad0985..fd79170399 100644
--- a/src/os/MemStore.cc
+++ b/src/os/MemStore.cc
@@ -1024,9 +1024,9 @@ int MemStore::_remove(coll_t cid, const ghobject_t& oid)
   auto i = c->object_hash.find(oid);
   if (i == c->object_hash.end())
     return -ENOENT;
+  used_bytes -= i->second->get_size();
   c->object_hash.erase(i);
   c->object_map.erase(oid);
-  used_bytes -= i->second->get_size();
 
   return 0;
 }

