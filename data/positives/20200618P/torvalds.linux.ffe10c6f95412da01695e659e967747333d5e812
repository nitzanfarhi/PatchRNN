commit ffe10c6f95412da01695e659e967747333d5e812
Author: Namhyung Kim <namhyung.kim@lge.com>
Date:   Mon Oct 15 12:39:42 2012 +0900

    perf tools: Fix segfault when using srcline sort key
    
    The srcline sort key is for grouping samples based on their source file
    and line number.  It use addr2line tool to get the information but it
    requires dso name.  It caused a segfault when a sample does not have the
    name by dereferencing a NULL pointer.  Fix it by using raw ip addresses
    for those samples.
    
    Signed-off-by: Namhyung Kim <namhyung@kernel.org>
    Cc: Ingo Molnar <mingo@kernel.org>
    Cc: Paul Mackerras <paulus@samba.org>
    Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Link: http://lkml.kernel.org/r/1350272383-7016-1-git-send-email-namhyung@kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/perf/util/sort.c b/tools/perf/util/sort.c
index b5b1b9211960..dd68f115d392 100644
--- a/tools/perf/util/sort.c
+++ b/tools/perf/util/sort.c
@@ -260,6 +260,9 @@ static int hist_entry__srcline_snprintf(struct hist_entry *self, char *bf,
 	if (path != NULL)
 		goto out_path;
 
+	if (!self->ms.map)
+		goto out_ip;
+
 	snprintf(cmd, sizeof(cmd), "addr2line -e %s %016" PRIx64,
 		 self->ms.map->dso->long_name, self->ip);
 	fp = popen(cmd, "r");

