commit 3a6c4a0e1d2a40b1746b5cd9f4212347a9dc364d
Author: Frank Morgner <morgner@informatik.hu-berlin.de>
Date:   Wed Apr 29 23:22:27 2015 +0200

    pkcs15-cache: fixed resource leak

diff --git a/src/libopensc/pkcs15-cache.c b/src/libopensc/pkcs15-cache.c
index 74d56431..66f5fb76 100644
--- a/src/libopensc/pkcs15-cache.c
+++ b/src/libopensc/pkcs15-cache.c
@@ -115,13 +115,16 @@ int sc_pkcs15_read_cached_file(struct sc_pkcs15_card *p15card,
 		return SC_ERROR_FILE_NOT_FOUND;
 	}
 	if (offset) {
-		if (0 != fseek(f, (long)offset, SEEK_SET))
+		if (0 != fseek(f, (long)offset, SEEK_SET)) {
+			fclose(f);
+			free(data);
 			return SC_ERROR_FILE_NOT_FOUND;
+		}
 	}
 	if (data)
 		*buf = data;
 	got = fread(*buf, 1, count, f);
-        fclose(f);
+	fclose(f);
 	if (got != count) {
 		if (data)
 			free(data);

