commit bd60e381fab88979c3312265d18bb635c314d242
Author: Cai Zhiyong <caizhiyong@huawei.com>
Date:   Mon Nov 18 20:21:49 2013 +0800

    regmap: Fix 'ret' would return an uninitialized value
    
    This patch give a warning when calling regmap_register_patch with
    parameter num_regs <= 0.
    
    When the num_regs parameter is zero and krealloc doesn't fail,
    then the code would return an uninitialized value. However,
    calling this function with num_regs == 0, would be a waste as it
    essentially does nothing.
    
    Signed-off-by: Cai Zhiyong <caizhiyong@huawei.com>
    Reviewed-by: Geyslan G. Bem <geyslan@gmail.com>
    Signed-off-by: Mark Brown <broonie@linaro.org>

diff --git a/drivers/base/regmap/regmap.c b/drivers/base/regmap/regmap.c
index 9c021d9cace0..9a36ac14b0b5 100644
--- a/drivers/base/regmap/regmap.c
+++ b/drivers/base/regmap/regmap.c
@@ -2173,6 +2173,10 @@ int regmap_register_patch(struct regmap *map, const struct reg_default *regs,
 	int i, ret;
 	bool bypass;
 
+	if (WARN_ONCE(num_regs <= 0, "invalid registers number (%d)\n",
+	    num_regs))
+		return 0;
+
 	map->lock(map->lock_arg);
 
 	bypass = map->cache_bypass;

