commit c10d8ee3feaf725007e515b5f2972dffaa793f9a
Author: Lothar Waßmann <LW@KARO-electronics.de>
Date:   Thu Dec 6 08:42:27 2012 +0100

    mtd: mxc_nand: fix unbalanced clk_disable() in error path
    
    If nand_scan_ident() or nand_scan_tail() fails, the NAND chip may have
    been deselected and the clock already disabled. Thus, check 'clk_act'
    in the error path to decide whether the clock still needs to be
    disabled.
    
    This fixes a:
    |WARNING: at drivers/clk/clk.c:472 __clk_disable+0x3c/0x78()
    
    Signed-off-by: Lothar Waßmann <LW@KARO-electronics.de>
    Acked-by: Sascha Hauer <s.hauer@pengutronix.de>
    Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>

diff --git a/drivers/mtd/nand/mxc_nand.c b/drivers/mtd/nand/mxc_nand.c
index 4aef6a355d54..ab0fe383c50b 100644
--- a/drivers/mtd/nand/mxc_nand.c
+++ b/drivers/mtd/nand/mxc_nand.c
@@ -1533,7 +1533,8 @@ static int mxcnd_probe(struct platform_device *pdev)
 	return 0;
 
 escan:
-	clk_disable_unprepare(host->clk);
+	if (host->clk_act)
+		clk_disable_unprepare(host->clk);
 
 	return err;
 }

