commit 0f46825d9833b70cec671d825b0065850c485196
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Sat Oct 13 00:30:42 2012 +0200

    ffserver: prevent nb_streams from becoming too large
    
    Fixes CID732249
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/ffserver.c b/ffserver.c
index cb7e3aeda3..955c326b8c 100644
--- a/ffserver.c
+++ b/ffserver.c
@@ -3474,6 +3474,9 @@ static AVStream *add_av_stream1(FFStream *stream, AVCodecContext *codec, int cop
 {
     AVStream *fst;
 
+    if(stream->nb_streams >= FF_ARRAY_ELEMS(stream->streams))
+        return NULL;
+
     fst = av_mallocz(sizeof(AVStream));
     if (!fst)
         return NULL;
@@ -3821,6 +3824,9 @@ static void add_codec(FFStream *stream, AVCodecContext *av)
 {
     AVStream *st;
 
+    if(stream->nb_streams >= FF_ARRAY_ELEMS(stream->streams))
+        return NULL;
+
     /* compute default parameters */
     switch(av->codec_type) {
     case AVMEDIA_TYPE_AUDIO:

