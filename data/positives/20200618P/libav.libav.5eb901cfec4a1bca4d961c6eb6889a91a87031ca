commit 5eb901cfec4a1bca4d961c6eb6889a91a87031ca
Author: Stefano Sabatini <stefano.sabatini-lala@poste.it>
Date:   Mon Apr 18 19:21:25 2011 +0200

    vsrc_movie: fix leak in request_frame()
    
    Also set movie->picref to NULL, in order to avoid a crash in uninit()
    when movie->picref is unreffed again and it was already freed.
    
    Signed-off-by: Stefano Sabatini <stefano.sabatini-lala@poste.it>
    Signed-off-by: Anton Khirnov <anton@khirnov.net>

diff --git a/libavfilter/vsrc_movie.c b/libavfilter/vsrc_movie.c
index 25bbd4736..92eb0ecfe 100644
--- a/libavfilter/vsrc_movie.c
+++ b/libavfilter/vsrc_movie.c
@@ -290,6 +290,8 @@ static int request_frame(AVFilterLink *outlink)
     avfilter_start_frame(outlink, outpicref);
     avfilter_draw_slice(outlink, 0, outlink->h, 1);
     avfilter_end_frame(outlink);
+    avfilter_unref_buffer(movie->picref);
+    movie->picref = NULL;
 
     return 0;
 }

