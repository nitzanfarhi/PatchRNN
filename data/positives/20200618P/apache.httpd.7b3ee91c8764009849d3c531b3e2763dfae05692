commit 7b3ee91c8764009849d3c531b3e2763dfae05692
Author: Ruediger Pluem <rpluem@apache.org>
Date:   Mon Feb 20 20:56:50 2006 +0000

    * Disable persistent connections for SSL backends again as we do not
      handle them correctly, because we recreate backend->connection for each
      request and thus try to initialize an already existing SSL connection.
    
    Noticed by: Joe Orton
    
    
    git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/trunk@379237 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/modules/proxy/mod_proxy_http.c b/modules/proxy/mod_proxy_http.c
index 4d59be05ed..9d439a61ee 100644
--- a/modules/proxy/mod_proxy_http.c
+++ b/modules/proxy/mod_proxy_http.c
@@ -987,7 +987,7 @@ skip_body:
      * otherwise sent Connection: Keep-Alive.
      */
     if (!force10) {
-        if (p_conn->close) {
+        if (p_conn->close || p_conn->close_on_recycle) {
             buf = apr_pstrdup(p, "Connection: close" CRLF);
         }
         else {
@@ -1672,6 +1672,14 @@ static int proxy_http_handler(request_rec *r, proxy_worker *worker,
 
 
     backend->is_ssl = is_ssl;
+    /*
+     * TODO: Currently we cannot handle persistent SSL backend connections,
+     * because we recreate backend->connection for each request and thus
+     * try to initialize an already existing SSL connection. This does
+     * not work.
+     */
+    if (is_ssl)
+        backend->close_on_recycle = 1;
 
     /* Step One: Determine Who To Connect To */
     if ((status = ap_proxy_determine_connection(p, r, conf, worker, backend,

