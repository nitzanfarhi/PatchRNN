commit ae1c15042a4a525eaa0dfb1ae6ef89a2f9b09661
Author: macvicar <macvicar@facebook.com>
Date:   Mon Sep 27 14:53:58 2010 -0700

    fgetcsv() when reaching an empty row inserts "" instead of NULL
    
    Summary:
    This sync our code with the behaviour of PHP 5.2.14, when fgetcsv()
    encounters a blank line in the middle of the CSV file it should
    return NULL instead of "" so the result can be differentiated.
    
    Upstream Bug: http://bugs.php.net/48313
    
    Test Plan:
    make
    make fast_tests
    
    DiffCamp Revision: 162749
    Reviewed By: hzhao
    CC: hzhao, hphp-diffs@lists
    Revert Plan:
    Ok

diff --git a/src/runtime/base/file/file.cpp b/src/runtime/base/file/file.cpp
index 92d6a04bb0..1a845ff0de 100644
--- a/src/runtime/base/file/file.cpp
+++ b/src/runtime/base/file/file.cpp
@@ -834,8 +834,12 @@ Array File::readCSV(int64 length /* = 0 */, char delimiter_char /* = ',' */,
     }
 
     /* 3. Now pass our field back to php */
-    *comp_end = '\0';
-    ret.append(String(temp, comp_end - temp, CopyString));
+    if (comp_end - temp) {
+      *comp_end = '\0';
+      ret.append(String(temp, comp_end - temp, CopyString));
+    } else {
+      ret.append(null_variant);
+    }
   } while (bptr < limit);
 
   free(temp);

