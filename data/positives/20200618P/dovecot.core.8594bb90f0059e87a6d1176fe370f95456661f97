commit 8594bb90f0059e87a6d1176fe370f95456661f97
Author: Timo Sirainen <tss@iki.fi>
Date:   Wed Nov 6 13:00:13 2013 +0200

    lib-imap-storage: Fixed leaking istream on error conditions.
    Caught by Tomasz PotÄ™ga

diff --git a/src/lib-imap-storage/imap-msgpart.c b/src/lib-imap-storage/imap-msgpart.c
index 74dd21566..e696589a3 100644
--- a/src/lib-imap-storage/imap-msgpart.c
+++ b/src/lib-imap-storage/imap-msgpart.c
@@ -398,6 +398,7 @@ imap_msgpart_crlf_seek(struct mail *mail, struct istream *input,
 	if (message_skip_virtual(input, virtual_skip, &cr_skipped) < 0) {
 		errinput = i_stream_create_error(errno);
 		i_stream_set_name(errinput, i_stream_get_name(input));
+		i_stream_unref(&input);
 		return errinput;
 	}
 

