commit e9c78e4fdd9ea6eaae5fdd22fa029a63a9a2b964
Author: deraadt <deraadt@openbsd.org>
Date:   Wed Dec 3 19:53:20 2014 +0000

    handle the (impossible) situation of a size_t - 1 buffer from
    EC_POINT_point2oct so that later allocation does not overflow
    with miod

diff --git a/lib/libcrypto/ec/ec_print.c b/lib/libcrypto/ec/ec_print.c
index 1c142a1df59..af4d1996c0f 100644
--- a/lib/libcrypto/ec/ec_print.c
+++ b/lib/libcrypto/ec/ec_print.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: ec_print.c,v 1.6 2014/12/03 19:45:16 deraadt Exp $ */
+/* $OpenBSD: ec_print.c,v 1.7 2014/12/03 19:53:20 deraadt Exp $ */
 /* ====================================================================
  * Copyright (c) 1998-2002 The OpenSSL Project.  All rights reserved.
  *
@@ -131,7 +131,7 @@ EC_POINT_point2hex(const EC_GROUP * group, const EC_POINT * point,
 
 	buf_len = EC_POINT_point2oct(group, point, form,
 	    NULL, 0, ctx);
-	if (buf_len == 0)
+	if (buf_len == 0 || buf_len + 1 == 0)
 		return NULL;
 
 	if ((buf = malloc(buf_len)) == NULL)
diff --git a/lib/libssl/src/crypto/ec/ec_print.c b/lib/libssl/src/crypto/ec/ec_print.c
index 1c142a1df59..af4d1996c0f 100644
--- a/lib/libssl/src/crypto/ec/ec_print.c
+++ b/lib/libssl/src/crypto/ec/ec_print.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: ec_print.c,v 1.6 2014/12/03 19:45:16 deraadt Exp $ */
+/* $OpenBSD: ec_print.c,v 1.7 2014/12/03 19:53:20 deraadt Exp $ */
 /* ====================================================================
  * Copyright (c) 1998-2002 The OpenSSL Project.  All rights reserved.
  *
@@ -131,7 +131,7 @@ EC_POINT_point2hex(const EC_GROUP * group, const EC_POINT * point,
 
 	buf_len = EC_POINT_point2oct(group, point, form,
 	    NULL, 0, ctx);
-	if (buf_len == 0)
+	if (buf_len == 0 || buf_len + 1 == 0)
 		return NULL;
 
 	if ((buf = malloc(buf_len)) == NULL)

