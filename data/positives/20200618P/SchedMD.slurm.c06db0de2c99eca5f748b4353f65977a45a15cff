commit c06db0de2c99eca5f748b4353f65977a45a15cff
Author: Morris Jette <jette@schedmd.com>
Date:   Mon Jul 18 11:18:05 2016 -0700

    Select/cons_res memory corruption fix
    
    A job allocation selecting nodes and no cores/CPUs could write
      off the end of arrays and corrupt memory. Now to figure out how
      the logic reached this point in the first place.
    bug 2808

diff --git a/src/plugins/select/cons_res/dist_tasks.c b/src/plugins/select/cons_res/dist_tasks.c
index 35f4296eb1..7c2b364fa4 100644
--- a/src/plugins/select/cons_res/dist_tasks.c
+++ b/src/plugins/select/cons_res/dist_tasks.c
@@ -355,6 +355,16 @@ static void _block_sync_core_bitmap(struct job_record *job_ptr,
 
 	if (!job_res)
 		return;
+	if (!job_res->core_bitmap) {
+		error("%s: core_bitmap for job %u is NULL",
+		      __func__, job_ptr->job_id);
+		return;
+	}
+	if (bit_ffs(job_res->core_bitmap) == -1) {
+		error("%s: core_bitmap for job %u has no bits set",
+		      __func__, job_ptr->job_id);
+		return;
+	}
 
 	if (cr_type & CR_SOCKET)
 		alloc_sockets = true;

