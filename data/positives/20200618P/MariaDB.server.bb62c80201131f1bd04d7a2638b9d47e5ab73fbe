commit bb62c80201131f1bd04d7a2638b9d47e5ab73fbe
Author: bell@sanja.is.com.ua <>
Date:   Sat Sep 4 23:05:12 2004 +0300

    memory leaks fixed

diff --git a/sql/sql_derived.cc b/sql/sql_derived.cc
index 3137890f2ba..5c827741e6d 100644
--- a/sql/sql_derived.cc
+++ b/sql/sql_derived.cc
@@ -220,10 +220,12 @@ static int mysql_derived(THD *thd, LEX *lex, SELECT_LEX_UNIT *unit,
       table->next= thd->derived_tables;
       thd->derived_tables= table;
     }
+  }
+  else
+    free_tmp_table(thd, table);
 
 exit:
-    delete derived_result;
-    lex->current_select= save_current_select;
-  }
+  delete derived_result;
+  lex->current_select= save_current_select;
   DBUG_RETURN(res);
 }
diff --git a/sql/sql_view.cc b/sql/sql_view.cc
index 67c7c39e223..2b1971907b3 100644
--- a/sql/sql_view.cc
+++ b/sql/sql_view.cc
@@ -339,8 +339,6 @@ static File_option view_parameters[]=
   FILE_OPTIONS_STRING}
 };
 
-static const uint required_view_parameters= 6;
-
 static LEX_STRING view_file_type[]= {{(char*)"VIEW", 4}};
 
 
@@ -604,8 +602,6 @@ mysql_make_view(File_parser *parser, TABLE_LIST *table)
     {
       /* move SP to main LEX */
       sp_merge_funs(old_lex, lex);
-      if (lex->spfuns.array.buffer)
-        hash_free(&lex->spfuns);
       if (old_lex->proc_table == 0 &&
           (old_lex->proc_table=
            (TABLE_LIST*)thd->calloc(sizeof(TABLE_LIST))) != 0)
@@ -619,6 +615,8 @@ mysql_make_view(File_parser *parser, TABLE_LIST *table)
         include_proc_table= 1;
       }
     }
+    if (lex->spfuns.array.buffer)
+      hash_free(&lex->spfuns);
 
     old_next= table->next_global;
     if ((table->next_global= lex->query_tables))

