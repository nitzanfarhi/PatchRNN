commit f38899477bdb3215fa0c34fc011bea9d417f8cf3
Author: Anton Kochkov <anton.kochkov@gmail.com>
Date:   Sat May 3 04:08:01 2014 +0400

    Fix CID 1134839

diff --git a/libr/core/cmd_write.c b/libr/core/cmd_write.c
index 1e8a6ee89..a048efb17 100644
--- a/libr/core/cmd_write.c
+++ b/libr/core/cmd_write.c
@@ -155,13 +155,15 @@ static int cmd_write(void *data, const char *input) {
 				r_file_dump (tmpfile, (ut8*)out, strlen (out));
 				r_core_patch (core, tmpfile);
 				r_file_rm (tmpfile);
+				free (out);
 			}
-		} else
-		if (input[1]==' ' && input[2]) {
-			r_core_patch (core, input+2);
 		} else {
-			eprintf ("Usage: wp [-|r2patch-file]\n"
+			if (input[1]==' ' && input[2]) {
+				r_core_patch (core, input+2);
+			} else {
+				eprintf ("Usage: wp [-|r2patch-file]\n"
 			         "TODO: rapatch format documentation here\n");
+			}
 		}
 		break;
 	case 'u':

