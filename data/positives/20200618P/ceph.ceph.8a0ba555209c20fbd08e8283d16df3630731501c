commit 8a0ba555209c20fbd08e8283d16df3630731501c
Author: Sage Weil <sage@newdream.net>
Date:   Mon Apr 7 11:31:23 2008 -0700

    kclient: check for ENAMETOOLONG in lookup

diff --git a/src/kernel/dir.c b/src/kernel/dir.c
index 69e4380de1..5cac51d7f4 100644
--- a/src/kernel/dir.c
+++ b/src/kernel/dir.c
@@ -209,6 +209,9 @@ int ceph_do_lookup(struct super_block *sb, struct dentry *dentry, int mask)
 	struct ceph_mds_request_head *rhead;
 	int err;
 
+	if (dentry->d_name.len > NAME_MAX)
+		return -ENAMETOOLONG;
+
 	dout(10, "do_lookup %p mask %d\n", dentry, CEPH_STAT_MASK_INODE_ALL);
 	path = ceph_build_dentry_path(dentry, &pathlen);
 	if (IS_ERR(path))

