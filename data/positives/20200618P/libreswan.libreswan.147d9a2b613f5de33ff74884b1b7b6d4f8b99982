commit 147d9a2b613f5de33ff74884b1b7b6d4f8b99982
Author: Matt Rogers <mrogers@redhat.com>
Date:   Fri Apr 4 12:32:19 2014 -0400

    pluto: fix double free in load_cert_from_nss()
    
    This happens when trying to load a cert with an unsupported algorithm,
    i.e. elliptic curve.

diff --git a/programs/pluto/certload.c b/programs/pluto/certload.c
index 93aa62470..d25e2f807 100644
--- a/programs/pluto/certload.c
+++ b/programs/pluto/certload.c
@@ -213,7 +213,6 @@ bool load_cert_from_nss(const char *nssHostCertNickName,
 				nssHostCertNickName));
 	}
 
-
 	blob.len = nssCert->derCert.len;
 	blob.ptr = alloc_bytes(blob.len, label);
 	memcpy(blob.ptr, nssCert->derCert.data, blob.len);
@@ -221,6 +220,8 @@ bool load_cert_from_nss(const char *nssHostCertNickName,
 	if (!is_asn1(blob)) {
 		if (verbose)
 			libreswan_log("  cert read from NSS db is not in DER format");
+		pfree(blob.ptr);
+		/* failure */
 	} else {
 		DBG(DBG_PARSING,
 			DBG_log("file coded in DER format"));
@@ -239,8 +240,6 @@ bool load_cert_from_nss(const char *nssHostCertNickName,
 		}
 	}
 
-	/* failure */
-	pfree(blob.ptr);
 	return FALSE;
 }
 

