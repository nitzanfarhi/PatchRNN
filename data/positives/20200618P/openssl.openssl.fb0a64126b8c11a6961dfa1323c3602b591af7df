commit fb0a64126b8c11a6961dfa1323c3602b591af7df
Author: Bernd Edlinger <bernd.edlinger@hotmail.de>
Date:   Tue Jun 13 21:22:45 2017 +0200

    Fix a possible crash in dsa_builtin_paramgen2.
    
    Reviewed-by: Rich Salz <rsalz@openssl.org>
    (Merged from https://github.com/openssl/openssl/pull/3675)

diff --git a/crypto/dsa/dsa_gen.c b/crypto/dsa/dsa_gen.c
index 3efeab84fa..e58ad8d70d 100644
--- a/crypto/dsa/dsa_gen.c
+++ b/crypto/dsa/dsa_gen.c
@@ -376,6 +376,8 @@ int dsa_builtin_paramgen2(DSA *ret, size_t L, size_t N,
     } else {
         p = BN_CTX_get(ctx);
         q = BN_CTX_get(ctx);
+        if (q == NULL)
+            goto err;
     }
 
     if (!BN_lshift(test, BN_value_one(), L - 1))

