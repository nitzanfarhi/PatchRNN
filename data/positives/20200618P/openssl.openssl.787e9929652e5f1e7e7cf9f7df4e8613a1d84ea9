commit 787e9929652e5f1e7e7cf9f7df4e8613a1d84ea9
Author: Jonas Maebe <jonas.maebe@elis.ugent.be>
Date:   Sun Dec 8 22:54:33 2013 +0100

    pkey_gost_ctrl: check for NULL after allocating pctx->shared_ukm
    
    Signed-off-by: Kurt Roeckx <kurt@roeckx.be>
    Reviewed-by: Richard Levitte <levitte@openssl.org>

diff --git a/engines/ccgost/gost_pmeth.c b/engines/ccgost/gost_pmeth.c
index 3189798cf4..c8bf31c8e2 100644
--- a/engines/ccgost/gost_pmeth.c
+++ b/engines/ccgost/gost_pmeth.c
@@ -106,6 +106,11 @@ static int pkey_gost_ctrl(EVP_PKEY_CTX *ctx, int type, int p1, void *p2)
 			return 1;
 		case EVP_PKEY_CTRL_SET_IV:
 			pctx->shared_ukm=OPENSSL_malloc((int)p1);
+			if (pctx->shared_ukm == NULL)
+				{
+				GOSTerr(GOST_F_PKEY_GOST_CTRL, ERR_R_MALLOC_FAILURE);
+				return 0;
+				}
 			memcpy(pctx->shared_ukm,p2,(int) p1);
 			return 1;
 		case EVP_PKEY_CTRL_PEER_KEY:

