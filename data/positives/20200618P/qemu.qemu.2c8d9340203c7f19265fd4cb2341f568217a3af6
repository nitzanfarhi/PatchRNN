commit 2c8d9340203c7f19265fd4cb2341f568217a3af6
Author: Gerd Hoffmann <kraxel@redhat.com>
Date:   Thu Sep 10 11:43:23 2009 +0200

    isapc: Fix irq routing
    
    Only send irqs to ioapic in case we have one.
    Fixes qemu segfault.
    
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

diff --git a/hw/pc.c b/hw/pc.c
index 6292001373..9af0cdb0da 100644
--- a/hw/pc.c
+++ b/hw/pc.c
@@ -100,7 +100,8 @@ static void isa_irq_handler(void *opaque, int n, int level)
     if (n < 16) {
         qemu_set_irq(isa->i8259[n], level);
     }
-    qemu_set_irq(isa->ioapic[n], level);
+    if (isa->ioapic)
+        qemu_set_irq(isa->ioapic[n], level);
 };
 
 static void ioport80_write(void *opaque, uint32_t addr, uint32_t data)

