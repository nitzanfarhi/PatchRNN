commit cadc8a15f939fa51eb4ac4ce38d8837b223c172e
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Tue Jun 17 13:37:43 2003 +0000

    Fixed bug #24223 (missing variable initialization in bundled gd)

diff --git a/ext/gd/libgd/gdft.c b/ext/gd/libgd/gdft.c
index 38b1b88bfc..f642e0d7f5 100644
--- a/ext/gd/libgd/gdft.c
+++ b/ext/gd/libgd/gdft.c
@@ -889,11 +889,16 @@ gdImageStringFTEx (gdImage * im, int *brect, int fg, char *fontlist, double ptsi
 	}
 
 #ifndef JISX0208
-	if (!font->have_char_map_sjis) {
-		next = string;
-	} else
+	if (font->have_char_map_sjis) {
 #endif
 		tmpstr = (char *) gdMalloc(BUFSIZ);
+		any2eucjp(tmpstr, string, BUFSIZ);
+		next = tmpstr;
+#ifndef JISX0208
+	} else {
+		next = string;
+	}
+#endif
 
 	while (*next) {
 		ch = *next;

