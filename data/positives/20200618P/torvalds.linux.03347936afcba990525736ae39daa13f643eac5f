commit 03347936afcba990525736ae39daa13f643eac5f
Author: ecashin@coraid.com <ecashin@coraid.com>
Date:   Mon Apr 18 22:00:19 2005 -0700

    [PATCH] aoe 5/12: don't try to free null bufpool
    
    don't try to free null bufpool
    
    Signed-off-by: Ed L. Cashin <ecashin@coraid.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/block/aoe/aoedev.c b/drivers/block/aoe/aoedev.c
index a40a78a7f44a..ec16c64dd114 100644
--- a/drivers/block/aoe/aoedev.c
+++ b/drivers/block/aoe/aoedev.c
@@ -146,7 +146,8 @@ aoedev_freedev(struct aoedev *d)
 		put_disk(d->gd);
 	}
 	kfree(d->frames);
-	mempool_destroy(d->bufpool);
+	if (d->bufpool)
+		mempool_destroy(d->bufpool);
 	kfree(d);
 }
 

