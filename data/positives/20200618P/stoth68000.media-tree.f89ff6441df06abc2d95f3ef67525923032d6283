commit f89ff6441df06abc2d95f3ef67525923032d6283
Author: Larry Finger <Larry.Finger@lwfinger.net>
Date:   Wed Oct 24 08:57:16 2012 -0500

    b43: Fix oops on unload when firmware not found
    
    When b43 fails to find firmware when loaded, a subsequent unload will
    oops due to calling ieee80211_unregister_hw() when the corresponding
    register call was never made.
    
    Commit 2d838bb608e2d1f6cb4280e76748cb812dc822e7 fixed the same problem
    for b43legacy.
    
    Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
    Tested-by: Markus Kanet <dvmailing@gmx.eu>
    Cc: Stable <stable@vger.kernel.org> [V3.3.0+ (the patch will need to be refactored)]
    Cc: Markus Kanet <dvmailing@gmx.eu>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/b43/main.c b/drivers/net/wireless/b43/main.c
index 73730e94e0ac..c5a99c8c8168 100644
--- a/drivers/net/wireless/b43/main.c
+++ b/drivers/net/wireless/b43/main.c
@@ -5404,6 +5404,8 @@ static void b43_bcma_remove(struct bcma_device *core)
 	cancel_work_sync(&wldev->restart_work);
 
 	B43_WARN_ON(!wl);
+	if (!wldev->fw.ucode.data)
+		return;			/* NULL if firmware never loaded */
 	if (wl->current_dev == wldev && wl->hw_registred) {
 		b43_leds_stop(wldev);
 		ieee80211_unregister_hw(wl->hw);
@@ -5478,6 +5480,8 @@ static void b43_ssb_remove(struct ssb_device *sdev)
 	cancel_work_sync(&wldev->restart_work);
 
 	B43_WARN_ON(!wl);
+	if (!wldev->fw.ucode.data)
+		return;			/* NULL if firmware never loaded */
 	if (wl->current_dev == wldev && wl->hw_registred) {
 		b43_leds_stop(wldev);
 		ieee80211_unregister_hw(wl->hw);

