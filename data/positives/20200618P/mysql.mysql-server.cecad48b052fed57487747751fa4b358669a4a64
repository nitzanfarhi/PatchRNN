commit cecad48b052fed57487747751fa4b358669a4a64
Author: Georgi Kodinov <georgi.kodinov@oracle.com>
Date:   Fri May 10 10:25:32 2013 +0300

    Addendum 2 to BUG#16241992
    Re-added missing free() calls after a successful change user.

diff --git a/sql/sql_parse.cc b/sql/sql_parse.cc
index 253060c6967..93662dff6a7 100644
--- a/sql/sql_parse.cc
+++ b/sql/sql_parse.cc
@@ -1243,6 +1243,8 @@ bool dispatch_command(enum enum_server_command command, THD *thd,
     USER_CONN *save_user_connect=
       const_cast<USER_CONN*>(thd->get_user_connect());
 #endif
+    char *save_db= thd->db;
+    Security_context save_security_ctx= *thd->security_ctx;
 
     auth_rc= acl_authenticate(thd, packet_length);
     MYSQL_AUDIT_NOTIFY_CONNECTION_CHANGE_USER(thd);
@@ -1262,6 +1264,9 @@ bool dispatch_command(enum enum_server_command command, THD *thd,
       if (save_user_connect)
 	decrease_user_connections(save_user_connect);
 #endif /* NO_EMBEDDED_ACCESS_CHECKS */
+      my_free(save_db);
+      my_free(save_security_ctx.user);
+
     }
     break;
   }

