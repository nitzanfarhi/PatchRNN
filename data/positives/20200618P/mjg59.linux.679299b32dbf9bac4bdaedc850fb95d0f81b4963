commit 679299b32dbf9bac4bdaedc850fb95d0f81b4963
Author: Matt Mackall <mpm@selenic.com>
Date:   Mon Feb 4 22:29:37 2008 -0800

    slob: fix free block merging at head of subpage
    
    We weren't merging freed blocks at the beginning of the free list.  Fixing
    this showed a 2.5% efficiency improvement in a userspace test harness.
    
    Signed-off-by: Matt Mackall <mpm@selenic.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/mm/slob.c b/mm/slob.c
index 773a7aa80ab5..c56c5e57c192 100644
--- a/mm/slob.c
+++ b/mm/slob.c
@@ -398,6 +398,10 @@ static void slob_free(void *block, int size)
 	sp->units += units;
 
 	if (b < sp->free) {
+		if (b + units == sp->free) {
+			units += slob_units(sp->free);
+			sp->free = slob_next(sp->free);
+		}
 		set_slob(b, units, sp->free);
 		sp->free = b;
 	} else {

