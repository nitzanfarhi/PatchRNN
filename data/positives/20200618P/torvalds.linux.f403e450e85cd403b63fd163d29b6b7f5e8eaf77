commit f403e450e85cd403b63fd163d29b6b7f5e8eaf77
Author: Kinglong Mee <kinglongmee@gmail.com>
Date:   Mon Dec 23 17:31:21 2013 +0800

    NFSD: fix a leak which can cause CREATE_SESSION failures
    
    check_forechannel_attrs gets drc memory, so nfsd must put it when
    check_backchannel_attrs fails.
    
    After many requests with bad back channel attrs, nfsd will deny any
    client's CREATE_SESSION forever.
    
    A new test case named CSESS29 for pynfs will send in another mail.
    
    Signed-off-by: Kinglong Mee <kinglongmee@gmail.com>
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>

diff --git a/fs/nfsd/nfs4state.c b/fs/nfsd/nfs4state.c
index 1aed9be56414..9a6d088247fd 100644
--- a/fs/nfsd/nfs4state.c
+++ b/fs/nfsd/nfs4state.c
@@ -1915,7 +1915,7 @@ nfsd4_create_session(struct svc_rqst *rqstp,
 		return status;
 	status = check_backchannel_attrs(&cr_ses->back_channel);
 	if (status)
-		return status;
+		goto out_release_drc_mem;
 	status = nfserr_jukebox;
 	new = alloc_session(&cr_ses->fore_channel);
 	if (!new)

