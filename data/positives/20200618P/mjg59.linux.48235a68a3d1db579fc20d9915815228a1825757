commit 48235a68a3d1db579fc20d9915815228a1825757
Author: Stefan Behrens <sbehrens@giantdisaster.de>
Date:   Wed May 23 17:57:49 2012 +0200

    Btrfs: fix false positive in check-integrity on unmount
    
    During unmount, it could happen that the integrity checker printed a
    warning message "attempt to free ... on umount which is not yet iodone"
    which turned out to be a false positive.
    
    Signed-off-by: Stefan Behrens <sbehrens@giantdisaster.de>

diff --git a/fs/btrfs/check-integrity.c b/fs/btrfs/check-integrity.c
index ed7618389327..9cebb1fd6a3c 100644
--- a/fs/btrfs/check-integrity.c
+++ b/fs/btrfs/check-integrity.c
@@ -3337,7 +3337,7 @@ void btrfsic_unmount(struct btrfs_root *root,
 				btrfsic_block_link_free(l);
 		}
 
-		if (b_all->is_iodone)
+		if (b_all->is_iodone || b_all->never_written)
 			btrfsic_block_free(b_all);
 		else
 			printk(KERN_INFO "btrfs: attempt to free %c-block"

