commit 3acc10f2f3121982c50ab784a34ebc692b5dd257
Author: Dieter Baron <dillo@nih.at>
Date:   Mon Aug 14 10:57:07 2017 +0200

    Free buffer in case of error.

diff --git a/lib/zip_open.c b/lib/zip_open.c
index 265eb2e..3bd593b 100644
--- a/lib/zip_open.c
+++ b/lib/zip_open.c
@@ -403,7 +403,6 @@ _zip_read_cdir(zip_t *za, zip_buffer_t *buffer, zip_uint64_t buf_offset, zip_err
 
             if (offset < 0) {
                 _zip_error_set_from_source(error, za->src);
-                _zip_buffer_free(cd_buffer);
                 _zip_cdir_free(cd);
                 return NULL;
             }
@@ -805,10 +804,16 @@ _zip_read_eocd64(zip_source_t *src, zip_buffer_t *buffer, zip_uint64_t buf_offse
     }
     if ((flags & ZIP_CHECKCONS) && (eocd_disk != eocd_disk64 || num_disks != num_disks64)) {
 	zip_error_set(error, ZIP_ER_INCONS, 0);
+        if (free_buffer) {
+            _zip_buffer_free(buffer);
+        }
 	return NULL;
     }
     if (num_disks != 0 || eocd_disk != 0) {
 	zip_error_set(error, ZIP_ER_MULTIDISK, 0);
+        if (free_buffer) {
+            _zip_buffer_free(buffer);
+        }
 	return NULL;
     }
 

