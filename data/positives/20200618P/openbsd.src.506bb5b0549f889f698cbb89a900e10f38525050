commit 506bb5b0549f889f698cbb89a900e10f38525050
Author: krw <krw@openbsd.org>
Date:   Thu Oct 7 01:52:25 2010 +0000

    Fix some pms(4) vs wsmoused issues. From Alexandr Shadchin via
    tech@. Tested on the usual problematic machines by myself, nicm@
    and ian@.

diff --git a/sys/dev/pckbc/pms.c b/sys/dev/pckbc/pms.c
index 8a6c3076eab..67913104210 100644
--- a/sys/dev/pckbc/pms.c
+++ b/sys/dev/pckbc/pms.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: pms.c,v 1.7 2010/10/02 00:28:57 krw Exp $ */
+/* $OpenBSD: pms.c,v 1.8 2010/10/07 01:52:25 krw Exp $ */
 /* $NetBSD: psm.c,v 1.11 2000/06/05 22:20:57 sommerfeld Exp $ */
 
 /*-
@@ -243,7 +243,8 @@ pms_change_state(struct pms_softc *sc, int newstate)
 
 		pckbc_slot_enable(sc->sc_kbctag, sc->sc_kbcslot, 1);
 
-		pckbc_flush(sc->sc_kbctag, sc->sc_kbcslot);
+		if (sc->poll)
+			pckbc_flush(sc->sc_kbctag, sc->sc_kbcslot);
 
 		cmd[0] = PMS_RESET;
 		res = pms_cmd(sc, cmd, 1, resp, 2);

