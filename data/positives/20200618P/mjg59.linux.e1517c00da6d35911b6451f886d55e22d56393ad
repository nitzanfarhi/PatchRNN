commit e1517c00da6d35911b6451f886d55e22d56393ad
Author: Michael Hennerich <michael.hennerich@analog.com>
Date:   Wed Oct 6 16:15:37 2010 +0200

    staging: iio: adc: max1363: prevent buffer overflow
    
    ring->access.read_last() reads the entire datum from
    the ring including padding and time stamp.
    
    Acked-by: Jonathan Cameron <jic23@cam.ac.uk>
    Signed-off-by: Michael Hennerich <michael.hennerich@analog.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/staging/iio/adc/max1363_ring.c b/drivers/staging/iio/adc/max1363_ring.c
index 1d6ce54e9a86..896a3672b332 100644
--- a/drivers/staging/iio/adc/max1363_ring.c
+++ b/drivers/staging/iio/adc/max1363_ring.c
@@ -38,9 +38,8 @@ int max1363_single_channel_from_ring(long mask, struct max1363_state *st)
 		ret = -EBUSY;
 		goto error_ret;
 	}
-	numvals = hweight_long(st->current_mode->modemask);
 
-	ring_data = kmalloc(numvals*2, GFP_KERNEL);
+	ring_data = kmalloc(ring->access.get_bytes_per_datum(ring), GFP_KERNEL);
 	if (ring_data == NULL) {
 		ret = -ENOMEM;
 		goto error_ret;

