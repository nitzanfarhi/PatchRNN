commit 7214610475b2847a81478d96e4d3ba0bbe49598c
Author: Ian Campbell <Ian.Campbell@eu.citrix.com>
Date:   Thu Feb 3 09:49:35 2011 +0000

    xen: events: do not free legacy IRQs
    
    c514d00c8057 "xen: events: add xen_allocate_irq_{dynamic, gsi} and
    xen_free_irq" correctly avoids reallocating legacy IRQs (which are
    managed by the arch core) but erroneously did not prevent them being
    freed.
    
    Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

diff --git a/drivers/xen/events.c b/drivers/xen/events.c
index 06f2e61de691..accb37ad0944 100644
--- a/drivers/xen/events.c
+++ b/drivers/xen/events.c
@@ -434,6 +434,10 @@ static int xen_allocate_irq_gsi(unsigned gsi)
 
 static void xen_free_irq(unsigned irq)
 {
+	/* Legacy IRQ descriptors are managed by the arch. */
+	if (irq < NR_IRQS_LEGACY)
+		return;
+
 	irq_free_desc(irq);
 }
 

