commit 2b4e49d4281690db67073ba644ad2ffc17767cdf
Author: Laurent Aimar <fenrir@videolan.org>
Date:   Sat Sep 24 16:16:38 2011 +0200

    flvdec: Fix invalid pointer deferences when parsing index
    
    Signed-off-by: Martin Storsj√∂ <martin@martin.st>

diff --git a/libavformat/flvdec.c b/libavformat/flvdec.c
index 569d7343c..474c4d865 100644
--- a/libavformat/flvdec.c
+++ b/libavformat/flvdec.c
@@ -196,8 +196,8 @@ static int parse_keyframes_index(AVFormatContext *s, AVIOContext *ioc, AVStream
         }
     }
 
-    if (timeslen == fileposlen)
-         for(i = 0; i < arraylen; i++)
+    if (!ret && timeslen == fileposlen)
+         for (i = 0; i < fileposlen; i++)
              av_add_index_entry(vstream, filepositions[i], times[i]*1000, 0, 0, AVINDEX_KEYFRAME);
     else
         av_log(s, AV_LOG_WARNING, "Invalid keyframes object, skipping.\n");

