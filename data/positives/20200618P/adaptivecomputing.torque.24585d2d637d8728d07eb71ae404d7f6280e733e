commit 24585d2d637d8728d07eb71ae404d7f6280e733e
Author: dbeer <dbeer@8f940c70-5916-0410-ac46-d1fa2fa6ea29>
Date:   Wed Nov 23 22:06:39 2011 +0000

    Fix two segfaults - if there were more than 2 reqs in a nodes requests than the third and beyond weren't saved, causing segfaults. Also, if a mom couldn't be found by the ip address (because the node didn't exist anymore) NULL was returned and then dereferenced in relay_to_mom(). Not something people will run into unless they are removing moms, but it can happen

diff --git a/src/server/issue_request.c b/src/server/issue_request.c
index c44f87a9c..ced68b4bb 100644
--- a/src/server/issue_request.c
+++ b/src/server/issue_request.c
@@ -164,7 +164,10 @@ int relay_to_mom(
   /* if MOM is down don't try to connect */
   addr = pjob->ji_qs.ji_un.ji_exect.ji_momaddr;
 
-  node = tfind_addr(addr,pjob->ji_qs.ji_un.ji_exect.ji_momport,pjob);
+  if ((node = tfind_addr(addr,pjob->ji_qs.ji_un.ji_exect.ji_momport,pjob)) == NULL)
+    {
+    return(PBSE_NORELYMOM);
+    }
 
   if ((node != NULL) &&
       (node->nd_state & INUSE_DOWN))
diff --git a/src/server/node_manager.c b/src/server/node_manager.c
index 5f7c9724f..0c5927e9c 100644
--- a/src/server/node_manager.c
+++ b/src/server/node_manager.c
@@ -3960,6 +3960,7 @@ static int node_spec(
       plus += strlen("nodes=");
 
     all_reqs.req_start[i] = plus;
+    i++;
     }
 
   /* now parse each spec into the data */

