commit 86028598de16538f02519141756ccf4accfc29a6
Author: Paul Mackerras <paulus@samba.org>
Date:   Thu Mar 5 14:05:57 2009 +1100

    perfcounters/powerpc: fix oops with multiple counters in a group
    
    Impact: fix oops-causing bug
    
    This fixes a bug in the powerpc hw_perf_counter_init where the code
    didn't initialize ctrs[n] before passing the ctrs array to check_excludes,
    leading to possible oopses and other incorrect behaviour.  This fixes it
    by initializing ctrs[n] correctly.
    
    Signed-off-by: Paul Mackerras <paulus@samba.org>

diff --git a/arch/powerpc/kernel/perf_counter.c b/arch/powerpc/kernel/perf_counter.c
index 112332d07fc2..4fec112386fc 100644
--- a/arch/powerpc/kernel/perf_counter.c
+++ b/arch/powerpc/kernel/perf_counter.c
@@ -633,6 +633,7 @@ hw_perf_counter_init(struct perf_counter *counter)
 			return NULL;
 	}
 	events[n] = ev;
+	ctrs[n] = counter;
 	if (check_excludes(ctrs, n, 1))
 		return NULL;
 	if (power_check_constraints(events, n + 1))

