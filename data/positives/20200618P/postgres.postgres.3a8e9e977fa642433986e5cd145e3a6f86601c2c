commit 3a8e9e977fa642433986e5cd145e3a6f86601c2c
Author: Heikki Linnakangas <heikki.linnakangas@iki.fi>
Date:   Tue May 6 15:14:51 2014 +0300

    Fix use of free in walsender error handling after a sysid mismatch.
    
    Found via valgrind. The bug exists since the introduction of the walsender,
    so backpatch to 9.0.
    
    Andres Freund

diff --git a/src/backend/replication/libpqwalreceiver/libpqwalreceiver.c b/src/backend/replication/libpqwalreceiver/libpqwalreceiver.c
index 96f31c4c55..88d27c7690 100644
--- a/src/backend/replication/libpqwalreceiver/libpqwalreceiver.c
+++ b/src/backend/replication/libpqwalreceiver/libpqwalreceiver.c
@@ -152,6 +152,7 @@ libpqrcv_identify_system(TimeLineID *primary_tli)
 			 GetSystemIdentifier());
 	if (strcmp(primary_sysid, standby_sysid) != 0)
 	{
+		primary_sysid = pstrdup(primary_sysid);
 		PQclear(res);
 		ereport(ERROR,
 				(errmsg("database system identifier differs between the primary and standby"),

