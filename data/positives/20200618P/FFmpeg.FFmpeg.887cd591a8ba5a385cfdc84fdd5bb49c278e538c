commit 887cd591a8ba5a385cfdc84fdd5bb49c278e538c
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Sun Jan 22 03:29:32 2012 +0100

    mpegpsmux: Fix integer overflow with huge VBV sizes.
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavformat/mpegenc.c b/libavformat/mpegenc.c
index dce1786b5e..b42c9afbd8 100644
--- a/libavformat/mpegenc.c
+++ b/libavformat/mpegenc.c
@@ -1047,7 +1047,7 @@ retry:
         StreamInfo *stream = st->priv_data;
         const int avail_data=  av_fifo_size(stream->fifo);
         const int space= stream->max_buffer_size - stream->buffer_index;
-        int rel_space= 1024*space / stream->max_buffer_size;
+        int rel_space= 1024LL*space / stream->max_buffer_size;
         PacketDesc *next_pkt= stream->premux_packet;
 
         /* for subtitle, a single PES packet must be generated,

