commit 420068c6e1806a2b12be481abba1afec5d73d82e
Author: Felipe Pena <felipensp@gmail.com>
Date:   Sun Oct 20 01:04:55 2013 -0200

    - Fix possible memory leak

diff --git a/ext/zip/php_zip.c b/ext/zip/php_zip.c
index d7bd5f49e6..df16383d10 100644
--- a/ext/zip/php_zip.c
+++ b/ext/zip/php_zip.c
@@ -1856,15 +1856,16 @@ static ZIPARCHIVE_METHOD(addFromString)
 	/* TODO: fix  _zip_replace */
 	if (cur_idx >= 0) {
 		if (zip_delete(intern, cur_idx) == -1) {
-			RETURN_FALSE;
+			goto fail;
 		}
 	}
 
-	if (zip_add(intern, name, zs) == -1) {
-		RETURN_FALSE;
-	} else {
+	if (zip_add(intern, name, zs) != -1) {
 		RETURN_TRUE;
 	}
+fail:
+	zip_source_free(zs);
+	RETURN_FALSE;	
 }
 /* }}} */
 

