commit 658a0b7737b822a50056d9ceabddc1b5831192fe
Author: Jon Olav Hauglid <jon.hauglid@oracle.com>
Date:   Tue Oct 4 08:38:42 2016 +0200

    Bug#24732194: "USE DB_NAME" AND "SELECT SCHEMA()"
                  WORK FOR NON-EXISTING DATABASES
    
    Post-push fix: Fix memory leak in case dd::schema_exists() fails.

diff --git a/sql/sql_db.cc b/sql/sql_db.cc
index 00269c57818..06326dcafa3 100644
--- a/sql/sql_db.cc
+++ b/sql/sql_db.cc
@@ -1313,7 +1313,10 @@ bool mysql_change_db(THD *thd, const LEX_CSTRING &new_db_name,
 #endif
 
   if (dd::schema_exists(thd, new_db_file_name.str, &schema_exists))
+  {
+    my_free(new_db_file_name.str);
     DBUG_RETURN(true);
+  }
 
   if (!schema_exists)
   {

