commit 9766e4492cb7d90f0c60804f3bbbbc7f8ef01a7e
Author: Florian Festi <ffesti@redhat.com>
Date:   Wed Oct 22 14:03:52 2008 +0200

    Fix path problem in doLookup

diff --git a/lib/fprint.c b/lib/fprint.c
index 4f449c606..d17ad816c 100644
--- a/lib/fprint.c
+++ b/lib/fprint.c
@@ -89,7 +89,13 @@ static fingerPrint doLookup(fingerPrintCache cache,
     if (*cleanDirName == '/') {
 	if (!scareMemory) {
 	    cdnbuf = xstrdup(dirName);
-	    cleanDirName = rpmCleanPath(cdnbuf);
+	    char trailingslash = (cdnbuf[strlen(cdnbuf)-1] == '/');
+	    cdnbuf = rpmCleanPath(cdnbuf);
+	    if (trailingslash) {
+		cdnbuf = rstrcat(&cdnbuf, "/");
+	    }
+	    cleanDirName = cdnbuf;
+	    cdnl = strlen(cleanDirName);
 	}
     } else {
 	scareMemory = 0;	/* XXX causes memory leak */

