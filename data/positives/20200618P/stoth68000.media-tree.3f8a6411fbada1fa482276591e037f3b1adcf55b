commit 3f8a6411fbada1fa482276591e037f3b1adcf55b
Author: Theodore Ts'o <tytso@mit.edu>
Date:   Sun Apr 21 22:56:32 2013 -0400

    ext4: add check for inodes_count overflow in new resize ioctl
    
    Addresses-Red-Hat-Bugzilla: #913245
    
    Reported-by: Eric Sandeen <sandeen@redhat.com>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>
    Reviewed-by: Carlos Maiolino <cmaiolino@redhat.com>
    Cc: stable@vger.kernel.org

diff --git a/fs/ext4/resize.c b/fs/ext4/resize.c
index 08d2312c0fd4..b27c96d01965 100644
--- a/fs/ext4/resize.c
+++ b/fs/ext4/resize.c
@@ -1882,6 +1882,10 @@ int ext4_resize_fs(struct super_block *sb, ext4_fsblk_t n_blocks_count)
 		return 0;
 
 	n_group = ext4_get_group_number(sb, n_blocks_count - 1);
+	if (n_group > (0xFFFFFFFFUL / EXT4_INODES_PER_GROUP(sb))) {
+		ext4_warning(sb, "resize would cause inodes_count overflow");
+		return -EINVAL;
+	}
 	ext4_get_group_no_and_offset(sb, o_blocks_count - 1, &o_group, &offset);
 
 	n_desc_blocks = num_desc_blocks(sb, n_group + 1);

