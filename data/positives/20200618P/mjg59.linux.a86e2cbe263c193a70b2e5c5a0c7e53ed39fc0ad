commit a86e2cbe263c193a70b2e5c5a0c7e53ed39fc0ad
Author: Scott Wood <scottwood@freescale.com>
Date:   Fri May 2 13:42:41 2008 -0500

    fs_enet: Fix a memory leak in fs_enet_mdio_probe
    
    There are more memory leaks in the !PPC_CPM_NEW_BINDING case, but that code
    will disappear soon along with arch/ppc.
    
    Reported by Daniel Marjamki <danielm77@spray.se> at
    http://bugzilla.kernel.org/show_bug.cgi?id=10591
    
    Signed-off-by: Scott Wood <scottwood@freescale.com>
    Signed-off-by: Jeff Garzik <jgarzik@redhat.com>

diff --git a/drivers/net/fs_enet/mii-fec.c b/drivers/net/fs_enet/mii-fec.c
index ba75efc9f5b5..f0014cfbb275 100644
--- a/drivers/net/fs_enet/mii-fec.c
+++ b/drivers/net/fs_enet/mii-fec.c
@@ -194,7 +194,7 @@ static int __devinit fs_enet_mdio_probe(struct of_device *ofdev,
 
 	ret = of_address_to_resource(ofdev->node, 0, &res);
 	if (ret)
-		return ret;
+		goto out_res;
 
 	snprintf(new_bus->id, MII_BUS_ID_SIZE, "%x", res.start);
 
@@ -236,6 +236,7 @@ out_free_irqs:
 	kfree(new_bus->irq);
 out_unmap_regs:
 	iounmap(fec->fecp);
+out_res:
 out_fec:
 	kfree(fec);
 out_mii:

