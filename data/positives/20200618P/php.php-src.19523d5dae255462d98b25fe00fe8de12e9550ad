commit 19523d5dae255462d98b25fe00fe8de12e9550ad
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Sun Dec 16 17:22:00 2007 +0000

    MFB: Fixed bug #43589 (a possible infinite loop in bz2_filter.c)

diff --git a/ext/bz2/bz2_filter.c b/ext/bz2/bz2_filter.c
index 2e642b3bf8..0536fd2de2 100644
--- a/ext/bz2/bz2_filter.c
+++ b/ext/bz2/bz2_filter.c
@@ -132,6 +132,8 @@ static php_stream_filter_status_t php_bz2_decompress_filter(
 				data->strm.avail_out = data->outbuf_len;
 				data->strm.next_out = data->outbuf;
 				exit_status = PSFS_PASS_ON;
+			} else if (status == BZ_OK) {
+				break;
 			}
 		}
 	}

