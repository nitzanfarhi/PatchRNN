commit f4d13801b620f55e886f3108f6f37ef386c4669d
Author: nobu <nobu@b2dd03c8-39d4-4d8f-98ff-823fe69b080e>
Date:   Tue Mar 7 09:07:57 2017 +0000

    string.c: fix integer overflow
    
    * string.c (str_byte_substr): fix another integer overflow which
      can happen only when SHARABLE_MIDDLE_SUBSTRING is enabled.
      [ruby-core:79951] [Bug #13289]
    
    
    git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/trunk@57799 b2dd03c8-39d4-4d8f-98ff-823fe69b080e

diff --git a/string.c b/string.c
index 4968e86d74..43b8b4e007 100644
--- a/string.c
+++ b/string.c
@@ -5254,7 +5254,7 @@ str_byte_substr(VALUE str, long beg, long len, int empty)
 	beg += n;
 	if (beg < 0) return Qnil;
     }
-    if (beg + len > n)
+    if (len > n - beg)
 	len = n - beg;
     if (len <= 0) {
 	if (!empty) return Qnil;

