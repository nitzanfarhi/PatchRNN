commit e9982024619c7f8f8cce97b0038a0075b135089c
Author: Colin Ian King <colin.king@canonical.com>
Date:   Wed Nov 22 17:16:18 2017 +0000

    rtc: sun6i: ensure rtc is kfree'd on error
    
    The error return path on clk_data allocation failure does not kfree
    the allocated rtc object. Fix this with a kfree of rtc on the error
    exit path.
    
    Detected by CoverityScan, CID#1452264 ("Resource Leak")
    
    Signed-off-by: Colin Ian King <colin.king@canonical.com>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@free-electrons.com>

diff --git a/drivers/rtc/rtc-sun6i.c b/drivers/rtc/rtc-sun6i.c
index 3d2216ccd860..5bc28eed1adf 100644
--- a/drivers/rtc/rtc-sun6i.c
+++ b/drivers/rtc/rtc-sun6i.c
@@ -201,8 +201,10 @@ static void __init sun6i_rtc_clk_init(struct device_node *node)
 
 	clk_data = kzalloc(sizeof(*clk_data) + (sizeof(*clk_data->hws) * 2),
 			   GFP_KERNEL);
-	if (!clk_data)
+	if (!clk_data) {
+		kfree(rtc);
 		return;
+	}
 
 	spin_lock_init(&rtc->lock);
 

