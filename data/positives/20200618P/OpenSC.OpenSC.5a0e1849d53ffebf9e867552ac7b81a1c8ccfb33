commit 5a0e1849d53ffebf9e867552ac7b81a1c8ccfb33
Author: henryk <henryk@c6295689-39f2-0310-b995-f0e70906c6a9>
Date:   Tue Sep 26 10:31:03 2006 +0000

    Make do { ... } while (...); into while (...) { ... };.
    Fixes behaviour with empty files.
    
    
    git-svn-id: https://www.opensc-project.org/svnp/opensc/trunk@3025 c6295689-39f2-0310-b995-f0e70906c6a9

diff --git a/src/libopensc/pkcs15.c b/src/libopensc/pkcs15.c
index fd2f3d24..b1607487 100644
--- a/src/libopensc/pkcs15.c
+++ b/src/libopensc/pkcs15.c
@@ -1333,7 +1333,7 @@ int sc_pkcs15_parse_df(struct sc_pkcs15_card *p15card,
 		return r;
 
 	p = buf;
-	do {
+	while (bufsize && *p != 0x00) {
 		const u8 *oldp;
 		size_t obj_len;
 		
@@ -1372,7 +1372,7 @@ int sc_pkcs15_parse_df(struct sc_pkcs15_card *p15card,
 			sc_perror(ctx, r, "Error adding object");
 			goto ret;
 		}
-	} while (bufsize && *p != 0x00);
+	};
 ret:
 	free(buf);
 	return r;

