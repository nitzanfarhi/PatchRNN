commit feb20edda79ed1184b1fb508b03a08712014b0f8
Author: Pawel Jakub Dawidek <pawel@dawidek.net>
Date:   Fri Feb 3 09:00:39 2012 +0100

    Plug memory leak in case of an empty file and terminate string with '\0'.

diff --git a/libfreerdp-core/certificate.c b/libfreerdp-core/certificate.c
index ec50b4ed0..5eb877146 100644
--- a/libfreerdp-core/certificate.c
+++ b/libfreerdp-core/certificate.c
@@ -610,13 +610,17 @@ int certificate_data_match(rdpCertificateStore* certificate_store, rdpCertificat
 	size = ftell(fp);
 	fseek(fp, 0, SEEK_SET);
 
-	data = (char*) xmalloc(size + 1);
-	length = fread(data, size, 1, fp);
-
 	if (size < 1)
 		return match;
 
+	data = (char*) xmalloc(size + 2);
+	if (fread(data, size, 1, fp) != 1) {
+		xfree(data);
+		return match;
+	}
+
 	data[size] = '\n';
+	data[size + 1] = '\0';
 	pline = strtok(data, "\n");
 
 	while (pline != NULL)

