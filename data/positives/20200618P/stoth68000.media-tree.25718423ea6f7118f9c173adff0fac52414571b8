commit 25718423ea6f7118f9c173adff0fac52414571b8
Author: Namjae Jeon <namjae.jeon@samsung.com>
Date:   Sat Feb 2 23:52:42 2013 +0900

    f2fs: mark gc_thread as NULL when thread creation is failed
    
    When gc thread creation is failed, mark gc_thread as NULL to avoid
    crash while trying to stop invalid thread in stop_gc_thread->kthread_stop.
    Instead make it return from:
            if (!gc_th)
           return;
    
    Signed-off-by: Namjae Jeon <namjae.jeon@samsung.com>
    Signed-off-by: Amit Sahrawat <a.sahrawat@samsung.com>
    Signed-off-by: Jaegeuk Kim <jaegeuk.kim@samsung.com>

diff --git a/fs/f2fs/gc.c b/fs/f2fs/gc.c
index b1e498503e59..16fdec355201 100644
--- a/fs/f2fs/gc.c
+++ b/fs/f2fs/gc.c
@@ -104,6 +104,7 @@ int start_gc_thread(struct f2fs_sb_info *sbi)
 			"f2fs_gc-%u:%u", MAJOR(dev), MINOR(dev));
 	if (IS_ERR(gc_th->f2fs_gc_task)) {
 		kfree(gc_th);
+		sbi->gc_thread = NULL;
 		return -ENOMEM;
 	}
 	return 0;

