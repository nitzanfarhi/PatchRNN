commit c9bc1edd92328be06cb50b73733ff1abb4c6dc6d
Author: Gerald Combs <gerald@wireshark.org>
Date:   Thu Jul 21 21:40:57 2005 +0000

    When trying to handle gzip-compressed data, don't seek past the end of our
    compressed data buffer.  Fixes bug 288.
    
    svn path=/trunk/; revision=14981

diff --git a/epan/tvbuff.c b/epan/tvbuff.c
index aff4825cad..e3878bf76e 100644
--- a/epan/tvbuff.c
+++ b/epan/tvbuff.c
@@ -2408,6 +2408,12 @@ tvb_uncompress(tvbuff_t *tvb, int offset, int comprlen)
 			inflateReset(strm);
 			next = c;
 			strm->next_in = next;
+			if (c - compr > comprlen) {
+				g_free(strm);
+				g_free(compr);
+				g_free(strmbuf);
+				return NULL;
+			}
 			comprlen -= (c - compr);
 			
 			err = inflateInit2(strm, wbits);

