commit ac0f3e30d87e593dc1460d5f0407662073281d93
Author: Lixin Wang <alan.1.wang@nokia-sbell.com>
Date:   Mon Oct 16 17:54:32 2017 +0800

    of: overlay: fix memory leak related to duplicated property
    
    Function of_changeset_add_property or of_changeset_update_property may
    fails. In this case the property just allocated is never deallocated.
    
    Signed-off-by: Lixin Wang <alan.1.wang@nokia-sbell.com>
    Signed-off-by: Rob Herring <robh@kernel.org>

diff --git a/drivers/of/overlay.c b/drivers/of/overlay.c
index 8ecfee31ab6d..af3b9a16df26 100644
--- a/drivers/of/overlay.c
+++ b/drivers/of/overlay.c
@@ -162,6 +162,7 @@ static int of_overlay_apply_single_property(struct of_overlay *ov,
 		bool is_symbols_node)
 {
 	struct property *propn = NULL, *tprop;
+	int ret = 0;
 
 	/* NOTE: Multiple changes of single properties not supported */
 	tprop = of_find_property(target, prop->name, NULL);
@@ -186,10 +187,16 @@ static int of_overlay_apply_single_property(struct of_overlay *ov,
 
 	/* not found? add */
 	if (tprop == NULL)
-		return of_changeset_add_property(&ov->cset, target, propn);
-
-	/* found? update */
-	return of_changeset_update_property(&ov->cset, target, propn);
+		ret = of_changeset_add_property(&ov->cset, target, propn);
+	else /* found? update */
+		ret = of_changeset_update_property(&ov->cset, target, propn);
+
+	if (ret) {
+		kfree(propn->name);
+		kfree(propn->value);
+		kfree(propn);
+	}
+	return ret;
 }
 
 static int of_overlay_apply_single_device_node(struct of_overlay *ov,

