commit fa9765323a93473d3853d04c9903958453c92ad4
Author: Ilya Dryomov <idryomov@gmail.com>
Date:   Tue May 23 17:49:55 2017 +0200

    nbd: don't leak nbd_config
    
    nbd_config is allocated in nbd_alloc_config(), but never freed.
    
    Fixes: 5ea8d10802ec ("nbd: separate out the config information")
    Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
    Reviewed-by: Josef Bacik <jbacik@fb.com>
    Signed-off-by: Jens Axboe <axboe@fb.com>

diff --git a/drivers/block/nbd.c b/drivers/block/nbd.c
index e725d8d5ab0b..f3f191ba8ca4 100644
--- a/drivers/block/nbd.c
+++ b/drivers/block/nbd.c
@@ -1021,6 +1021,7 @@ static void nbd_config_put(struct nbd_device *nbd)
 			}
 			kfree(config->socks);
 		}
+		kfree(nbd->config);
 		nbd->config = NULL;
 
 		nbd->tag_set.timeout = 0;

