commit 93bab704c1513f824d0e19fd02f8b57b107feceb
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Date:   Wed Feb 14 23:20:00 2018 -0600

    drm/amdgpu_gem: fix error handling path in amdgpu_gem_va_update_vm
    
    Currently, if amdgpu_vm_bo_update() fails, the returned error
    is being ignored.
    
    Fix this by properly checking _r_ after calling amdgpu_vm_bo_update.
    Also, remove redundant code just before label _error_.
    
    Addresses-Coverity-ID: 1464280 ("Unused value")
    Fixes: 0abc6878fc2d ("drm/amdgpu: update VM PDs after the PTs")
    Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
    Reviewed-by: Christian KÃ¶nig <christian.koenig@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_gem.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_gem.c
index a66f4c5de882..55a840ae6d68 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_gem.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_gem.c
@@ -523,12 +523,13 @@ static void amdgpu_gem_va_update_vm(struct amdgpu_device *adev,
 		goto error;
 
 	if (operation == AMDGPU_VA_OP_MAP ||
-	    operation == AMDGPU_VA_OP_REPLACE)
+	    operation == AMDGPU_VA_OP_REPLACE) {
 		r = amdgpu_vm_bo_update(adev, bo_va, false);
+		if (r)
+			goto error;
+	}
 
 	r = amdgpu_vm_update_directories(adev, vm);
-	if (r)
-		goto error;
 
 error:
 	if (r && r != -ERESTARTSYS)

