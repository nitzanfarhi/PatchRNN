commit 3927c3aa28ea2ed8dbb5228de3e69928972da412
Author: Christopher L. Farrow <cfarrow@enthought.com>
Date:   Thu Aug 4 17:47:04 2011 -0500

    BUG: porting bugfix from refactor @ 3da77df

diff --git a/numpy/core/src/multiarray/ctors.c b/numpy/core/src/multiarray/ctors.c
index d7c17e8ad..ac1cdc13a 100644
--- a/numpy/core/src/multiarray/ctors.c
+++ b/numpy/core/src/multiarray/ctors.c
@@ -3698,6 +3698,9 @@ PyArray_FromString(char *data, npy_intp slen, PyArray_Descr *dtype,
 
     if (dtype == NULL) {
         dtype=PyArray_DescrFromType(NPY_DEFAULT_TYPE);
+        if (dtype == NULL) {
+            return NULL;
+        }
     }
     if (PyDataType_FLAGCHK(dtype, NPY_ITEM_IS_POINTER) ||
                     PyDataType_REFCHK(dtype)) {

