commit e74bad6b015b732d8269a8ddfb303c9b33092722
Author: Philippe Reynes <tremyfr@gmail.com>
Date:   Fri Mar 17 22:54:04 2017 +0100

    net: sun: sungem: rix a possible null dereference
    
    The function gem_begin_auto_negotiation dereference
    the pointer ep before testing if it's null. This
    patch add a check on ep before dereferencing it.
    
    Fixes: 92552fdda557 ("net: sun: sungem: use new api
    ethtool_{get|set}_link_ksettings")
    
    Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Philippe Reynes <tremyfr@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/ethernet/sun/sungem.c b/drivers/net/ethernet/sun/sungem.c
index dbfca0466760..fa607d062cb3 100644
--- a/drivers/net/ethernet/sun/sungem.c
+++ b/drivers/net/ethernet/sun/sungem.c
@@ -1259,8 +1259,9 @@ static void gem_begin_auto_negotiation(struct gem *gp,
 	int duplex;
 	u32 advertising;
 
-	ethtool_convert_link_mode_to_legacy_u32(&advertising,
-						ep->link_modes.advertising);
+	if (ep)
+		ethtool_convert_link_mode_to_legacy_u32(
+			&advertising, ep->link_modes.advertising);
 
 	if (gp->phy_type != phy_mii_mdio0 &&
      	    gp->phy_type != phy_mii_mdio1)

