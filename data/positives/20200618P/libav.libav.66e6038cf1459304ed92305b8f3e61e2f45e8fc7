commit 66e6038cf1459304ed92305b8f3e61e2f45e8fc7
Author: Reimar DÃ¶ffinger <Reimar.Doeffinger@gmx.de>
Date:   Sun Feb 22 09:51:58 2009 +0000

    Check return value of frame_start(), this avoids a crash if AVCodecContext::get_buffer failed.
    Not sure if returning -1 is the best possible solution but at least avoids the crash.
    
    Originally committed as revision 17520 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavcodec/h264.c b/libavcodec/h264.c
index 372adb931..5339ed017 100644
--- a/libavcodec/h264.c
+++ b/libavcodec/h264.c
@@ -3792,7 +3792,8 @@ static int decode_slice_header(H264Context *h, H264Context *h0){
         while(h->frame_num !=  h->prev_frame_num &&
               h->frame_num != (h->prev_frame_num+1)%(1<<h->sps.log2_max_frame_num)){
             av_log(NULL, AV_LOG_DEBUG, "Frame num gap %d %d\n", h->frame_num, h->prev_frame_num);
-            frame_start(h);
+            if (frame_start(h) < 0)
+                return -1;
             h->prev_frame_num++;
             h->prev_frame_num %= 1<<h->sps.log2_max_frame_num;
             s->current_picture_ptr->frame_num= h->prev_frame_num;

