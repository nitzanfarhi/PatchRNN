commit 407caeb5d0c8a6b158e2caef48dd909011d40340
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Sep 24 18:36:22 2010 +0100

    pgsql: Avoid epoll_ctl() errors when closing connection.

diff --git a/src/lib-sql/driver-pgsql.c b/src/lib-sql/driver-pgsql.c
index 240a549b9..dcb61d369 100644
--- a/src/lib-sql/driver-pgsql.c
+++ b/src/lib-sql/driver-pgsql.c
@@ -97,10 +97,11 @@ static void driver_pgsql_close(struct pgsql_db *db)
 	db->io_dir = 0;
 	db->fatal_error = FALSE;
 
+	driver_pgsql_stop_io(db);
+
 	PQfinish(db->pg);
 	db->pg = NULL;
 
-	driver_pgsql_stop_io(db);
 	if (db->to_connect != NULL)
 		timeout_remove(&db->to_connect);
 

