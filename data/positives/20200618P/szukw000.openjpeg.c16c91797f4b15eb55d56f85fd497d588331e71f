commit c16c91797f4b15eb55d56f85fd497d588331e71f
Author: mayeut <mayeut@users.noreply.github.com>
Date:   Thu Sep 17 12:41:41 2015 +0200

    Fix resource leak in opj_j2k_encode
    
    Fixes #598

diff --git a/src/lib/openjp2/j2k.c b/src/lib/openjp2/j2k.c
index e733c645..ec3635b6 100644
--- a/src/lib/openjp2/j2k.c
+++ b/src/lib/openjp2/j2k.c
@@ -9999,11 +9999,15 @@ OPJ_BOOL opj_j2k_encode(opj_j2k_t * p_j2k,
                         /* now copy this data into the tile component */
                         if (! opj_tcd_copy_tile_data(p_j2k->m_tcd,l_current_data,l_current_tile_size)) {
 																opj_event_msg(p_manager, EVT_ERROR, "Size mismatch between tile data and sent data." );
+																opj_free(l_current_data);
 																return OPJ_FALSE;
                         }
                 }
 
                 if (! opj_j2k_post_write_tile (p_j2k,p_stream,p_manager)) {
+                        if (l_current_data) {
+                                opj_free(l_current_data);
+                        }
                         return OPJ_FALSE;
                 }
         }

