commit 60eb3f7cf1b9c183559ce5c9a21cf2cfd6e6da05
Author: Lennart Poettering <lennart@poettering.net>
Date:   Tue Aug 5 04:16:26 2014 +0200

    resolved: don't override zone item state after starting the probe
    
    After all, the probe might be finished immeidately (due to resources,
    ...), and we shouldn't then set the state back to probing.

diff --git a/src/resolve/resolved-dns-zone.c b/src/resolve/resolved-dns-zone.c
index 649cc5c73..04a46745f 100644
--- a/src/resolve/resolved-dns-zone.c
+++ b/src/resolve/resolved-dns-zone.c
@@ -279,14 +279,14 @@ int dns_zone_put(DnsZone *z, DnsScope *s, DnsResourceRecord *rr, bool probe) {
                 if (established)
                         i->state = DNS_ZONE_ITEM_ESTABLISHED;
                 else {
+                        i->state = DNS_ZONE_ITEM_PROBING;
+
                         r = dns_zone_item_probe_start(i);
                         if (r < 0) {
                                 dns_zone_item_remove_and_free(z, i);
                                 i = NULL;
                                 return r;
                         }
-
-                        i->state = DNS_ZONE_ITEM_PROBING;
                 }
         } else
                 i->state = DNS_ZONE_ITEM_ESTABLISHED;

