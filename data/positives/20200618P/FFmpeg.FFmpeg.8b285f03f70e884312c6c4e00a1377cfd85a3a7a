commit 8b285f03f70e884312c6c4e00a1377cfd85a3a7a
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Mon Dec 23 01:53:05 2013 +0100

    avcodec/utils: fix memleak on avcodec_open2() failure
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index b8a8d471f6..c000d27155 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -1477,8 +1477,10 @@ end:
 free_and_end:
     av_dict_free(&tmp);
     av_freep(&avctx->priv_data);
-    if (avctx->internal)
+    if (avctx->internal) {
         av_freep(&avctx->internal->pool);
+        av_frame_free(&avctx->internal->to_free);
+    }
     av_freep(&avctx->internal);
     avctx->codec = NULL;
     goto end;

