commit 83f15a1228895434a982c840b09edccd1c64e800
Author: Ronald S. Bultje <rsbultje@gmail.com>
Date:   Wed Feb 15 16:21:34 2012 -0800

    avs: fix infinite loop on end-of-stream.
    
    The codec would keep returning the last decoded frame if the stream
    contains B-frames, since it wouldn't clear that frame from the list of
    frames to be returned to the user.
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    CC: libav-stable@libav.org

diff --git a/libavcodec/cavsdec.c b/libavcodec/cavsdec.c
index 1da4eb1922..e3201343be 100644
--- a/libavcodec/cavsdec.c
+++ b/libavcodec/cavsdec.c
@@ -656,6 +656,7 @@ static int cavs_decode_frame(AVCodecContext * avctx,void *data, int *data_size,
         if (!s->low_delay && h->DPB[0].f.data[0]) {
             *data_size = sizeof(AVPicture);
             *picture = h->DPB[0].f;
+            memset(&h->DPB[0], 0, sizeof(h->DPB[0]));
         }
         return 0;
     }

