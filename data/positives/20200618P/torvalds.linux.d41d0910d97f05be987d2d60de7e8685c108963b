commit d41d0910d97f05be987d2d60de7e8685c108963b
Author: Mustafa Ismail <mustafa.ismail@intel.com>
Date:   Tue Aug 23 16:50:13 2016 -0500

    i40iw: Fix double free of allocated_buffer
    
    Memory allocated for iwqp; iwqp->allocated_buffer is freed twice in
    the create_qp error path. Correct this by having it freed only once in
    i40iw_free_qp_resources().
    
    Fixes: d37498417947 ("i40iw: add files for iwarp interface")
    
    Signed-off-by: Mustafa Ismail <mustafa.ismail@intel.com>
    Signed-off-by: Shiraz Saleem <shiraz.saleem@intel.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>

diff --git a/drivers/infiniband/hw/i40iw/i40iw_verbs.c b/drivers/infiniband/hw/i40iw/i40iw_verbs.c
index 2360338877bf..722e5af1e3d8 100644
--- a/drivers/infiniband/hw/i40iw/i40iw_verbs.c
+++ b/drivers/infiniband/hw/i40iw/i40iw_verbs.c
@@ -794,7 +794,6 @@ static struct ib_qp *i40iw_create_qp(struct ib_pd *ibpd,
 	return &iwqp->ibqp;
 error:
 	i40iw_free_qp_resources(iwdev, iwqp, qp_num);
-	kfree(mem);
 	return ERR_PTR(err_code);
 }
 

