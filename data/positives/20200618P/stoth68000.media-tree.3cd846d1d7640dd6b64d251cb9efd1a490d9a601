commit 3cd846d1d7640dd6b64d251cb9efd1a490d9a601
Author: Miao Xie <miaox@cn.fujitsu.com>
Date:   Mon Jul 22 16:36:57 2013 +0800

    Btrfs, raid56: fix memory leak when allocating pages for p/q stripes failed
    
    Signed-off-by: Miao Xie <miaox@cn.fujitsu.com>
    Signed-off-by: Josef Bacik <jbacik@fusionio.com>
    Signed-off-by: Chris Mason <chris.mason@fusionio.com>

diff --git a/fs/btrfs/raid56.c b/fs/btrfs/raid56.c
index 0db856ceecc4..d0ecfbd9cc9f 100644
--- a/fs/btrfs/raid56.c
+++ b/fs/btrfs/raid56.c
@@ -1540,8 +1540,10 @@ static int full_stripe_write(struct btrfs_raid_bio *rbio)
 	int ret;
 
 	ret = alloc_rbio_parity_pages(rbio);
-	if (ret)
+	if (ret) {
+		__free_raid_bio(rbio);
 		return ret;
+	}
 
 	ret = lock_stripe_add(rbio);
 	if (ret == 0)

