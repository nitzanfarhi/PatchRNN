commit b0e6e0a85777faa93aa05a524f9ed73023acb101
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Jul 30 09:17:51 2007 +0300

    auth_bind=yes and empty auth_bind_userdn leaked memory.
    
    --HG--
    branch : HEAD

diff --git a/src/auth/passdb-ldap.c b/src/auth/passdb-ldap.c
index 1d4385117..5118158b5 100644
--- a/src/auth/passdb-ldap.c
+++ b/src/auth/passdb-ldap.c
@@ -262,6 +262,7 @@ handle_request_authbind_search(struct ldap_connection *conn,
 		(struct passdb_ldap_request *)ldap_request;
 	struct auth_request *auth_request = ldap_request->context;
 	LDAPMessage *entry;
+	char *dn;
 
 	entry = handle_request_get_entry(conn, auth_request,
 					 passdb_ldap_request, res);
@@ -271,8 +272,10 @@ handle_request_authbind_search(struct ldap_connection *conn,
 	ldap_query_save_result(conn, entry, auth_request);
 
 	/* switch the handler to the authenticated bind handler */
-	ldap_request->base =
-		p_strdup(auth_request->pool, ldap_get_dn(conn->ld, entry));
+	dn = ldap_get_dn(conn->ld, entry);
+	ldap_request->base = p_strdup(auth_request->pool, dn);
+	ldap_memfree(dn);
+
 	ldap_request->filter = NULL;
 	ldap_request->callback = handle_request_authbind;
 

