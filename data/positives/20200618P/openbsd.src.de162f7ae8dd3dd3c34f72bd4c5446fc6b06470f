commit de162f7ae8dd3dd3c34f72bd4c5446fc6b06470f
Author: niklas <niklas@openbsd.org>
Date:   Thu Aug 3 07:23:32 2000 +0000

    Merge with EOM 1.53
    
    author: provos
    prevent isakmpd crashing when client gives an unknown ID in aggressive mode.
    bug report from James Winquist <winquist@mail.cybernet.com>

diff --git a/sbin/isakmpd/ike_auth.c b/sbin/isakmpd/ike_auth.c
index e5ab1433067..11d7e6cf90b 100644
--- a/sbin/isakmpd/ike_auth.c
+++ b/sbin/isakmpd/ike_auth.c
@@ -1,5 +1,5 @@
-/*	$OpenBSD: ike_auth.c,v 1.26 2000/06/20 05:55:15 niklas Exp $	*/
-/*	$EOM: ike_auth.c,v 1.52 2000/06/19 07:41:07 niklas Exp $	*/
+/*	$OpenBSD: ike_auth.c,v 1.27 2000/08/03 07:23:32 niklas Exp $	*/
+/*	$EOM: ike_auth.c,v 1.53 2000/07/25 17:15:40 provos Exp $	*/
 
 /*
  * Copyright (c) 1998, 1999, 2000 Niklas Hallqvist.  All rights reserved.
@@ -372,6 +372,10 @@ pre_shared_gen_skeyid (struct exchange *exchange, size_t *sz)
   if (buf)
     free (buf);
 
+  /* Fail if no key could be found */
+  if (key == NULL) 
+    return 0;
+
   /* Store the secret key for later policy processing.  */
   exchange->recv_cert = malloc (keylen);
   if (!exchange->recv_cert)

