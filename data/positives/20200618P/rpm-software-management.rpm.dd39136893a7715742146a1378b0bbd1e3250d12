commit dd39136893a7715742146a1378b0bbd1e3250d12
Author: Panu Matilainen <pmatilai@redhat.com>
Date:   Tue Nov 9 09:54:31 2010 +0200

    Eliminate pointless (and racy) test for rebuilddb directory existence
    - mkdir() will error out with a reasonable error message of its
      own, no point doing separate, buggy test with access()

diff --git a/lib/rpmdb.c b/lib/rpmdb.c
index 516bd732c..8c420777a 100644
--- a/lib/rpmdb.c
+++ b/lib/rpmdb.c
@@ -2915,13 +2915,6 @@ int rpmdbRebuild(const char * prefix, rpmts ts,
     rpmlog(RPMLOG_DEBUG, "rebuilding database %s into %s\n",
 	rootdbpath, newrootdbpath);
 
-    if (!access(newrootdbpath, F_OK)) {
-	rpmlog(RPMLOG_ERR, _("temporary database %s already exists\n"),
-	      newrootdbpath);
-	rc = 1;
-	goto exit;
-    }
-
     rpmlog(RPMLOG_DEBUG, "creating directory %s\n", newrootdbpath);
     if (mkdir(newrootdbpath, 0755)) {
 	rpmlog(RPMLOG_ERR, _("failed to create directory %s: %s\n"),

