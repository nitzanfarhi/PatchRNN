commit 024f7daec490322cafabae5243fc4ca60698bf66
Author: Eliot Horowitz <eliot@10gen.com>
Date:   Tue Nov 8 09:56:42 2011 -0500

    fix some unchecked mallocs SERVER-4228

diff --git a/bson/util/builder.h b/bson/util/builder.h
index 710c2d4369..f189f58b27 100644
--- a/bson/util/builder.h
+++ b/bson/util/builder.h
@@ -65,6 +65,8 @@ namespace mongo {
             if( p == buf ) {
                 if( sz <= SZ ) return buf;
                 void *d = malloc(sz);
+                if ( d == 0 )
+                    msgasserted( 15912 , "out of memory StackAllocator::Realloc" );
                 memcpy(d, p, SZ);
                 return d;
             }
@@ -113,6 +115,8 @@ namespace mongo {
             if ( maxSize && size > maxSize ) {
                 al.Free(data);
                 data = (char*)al.Malloc(maxSize);
+                if ( data == 0 )
+                    msgasserted( 15913 , "out of memory BufBuilder::reset" );
                 size = maxSize;
             }
         }

