commit 05b51bc720d3382d1d40f94dd30e722d598b9681
Author: Abhay Vardhan <abhay.vardhan@gmail.com>
Date:   Fri Jul 1 11:53:42 2011 -0700

    Fix overflow bug while calculating new size of buffer

diff --git a/bson/buffer.c b/bson/buffer.c
index 957ebdc0..ec69cc58 100644
--- a/bson/buffer.c
+++ b/bson/buffer.c
@@ -67,7 +67,12 @@ static int buffer_grow(buffer_t buffer, int min_length) {
         return 0;
     }
     while (size < min_length) {
+        int old_size = size;
         size *= 2;
+        if (size <= old_size) {
+           /* size did not increase. Could be an overflow or size < 1. Just go with min_length */
+           size = min_length;
+	    }  
     }
     buffer->buffer = (char*)realloc(buffer->buffer, sizeof(char) * size);
     if (buffer->buffer == NULL) {

