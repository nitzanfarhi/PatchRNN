commit 01a60e76b6392547ad3dca3ac05b9c886fa5da45
Author: Dan Carpenter <dan.carpenter@oracle.com>
Date:   Fri Apr 5 08:43:20 2013 +0300

    USB: keyspan: add a sanity test on "len"
    
    "len" comes from the USB transfer and it's probably correct.  The thing
    is that we already have similar checks like:
    
            if (data[i] >= serial->num_ports) {
    
    So adding a sanity test here matches the rest of the code and is a good
    idea.
    
    Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/usb/serial/keyspan.c b/drivers/usb/serial/keyspan.c
index 3d92394aba3a..025310bc358a 100644
--- a/drivers/usb/serial/keyspan.c
+++ b/drivers/usb/serial/keyspan.c
@@ -741,14 +741,15 @@ static void usa49wg_indat_callback(struct urb *urb)
 		if ((data[i] & 0x80) == 0) {
 			/* no error on any byte */
 			i++;
-			for (x = 1; x < len ; ++x)
+			for (x = 1; x < len && i < urb->actual_length; ++x)
 				tty_insert_flip_char(&port->port,
 						data[i++], 0);
 		} else {
 			/*
 			 * some bytes had errors, every byte has status
 			 */
-			for (x = 0; x + 1 < len; x += 2) {
+			for (x = 0; x + 1 < len &&
+				    i + 1 < urb->actual_length; x += 2) {
 				int stat = data[i], flag = 0;
 
 				if (stat & RXERROR_OVERRUN)

