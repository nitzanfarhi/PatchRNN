commit e245d4f45ca5e2b97daef5944d63323c07d545bc
Author: Luca Barbato <lu_zero@gentoo.org>
Date:   Tue Mar 14 09:15:29 2017 +0000

    dca: Validate the channel map
    
    Having a mismatch between the number of channels in the stream and those
    in the channel map will lead to a segfault or worse.
    
    Bug-Id: 1016
    
    CC: libav-stable@libav.org
    
    Signed-off-by: Luca Barbato <lu_zero@gentoo.org>

diff --git a/libavcodec/dcadec.c b/libavcodec/dcadec.c
index cd4432368..af26dceaf 100644
--- a/libavcodec/dcadec.c
+++ b/libavcodec/dcadec.c
@@ -1297,6 +1297,9 @@ static int set_channel_layout(AVCodecContext *avctx, int channels, int num_core_
                 s->channel_order_tab = ff_dca_channel_reorder_nolfe[s->amode];
         }
 
+        if (channels < ff_dca_channels[s->amode])
+            return AVERROR_INVALIDDATA;
+
         if (channels > !!s->lfe &&
             s->channel_order_tab[channels - 1 - !!s->lfe] < 0)
             return AVERROR_INVALIDDATA;

