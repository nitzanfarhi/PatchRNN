commit 866ef901d01b3962c407e43c670f7cde9912ce28
Author: Tomas Heinrich <theinric@redhat.com>
Date:   Mon Jul 14 19:31:24 2014 +0200

    bugfix: plug a memleak in mmsnmptrapd
    
    Error: RESOURCE_LEAK (CWE-772):
    rsyslog-7.4.10/plugins/mmsnmptrapd/mmsnmptrapd.c:292: alloc_fn: Storage is returned from allocation function "malloc(size_t)".
    rsyslog-7.4.10/plugins/mmsnmptrapd/mmsnmptrapd.c:292: var_assign: Assigning: "node" = storage returned from "malloc(24UL)".
    rsyslog-7.4.10/plugins/mmsnmptrapd/mmsnmptrapd.c:303: leaked_storage: Variable "node" going out of scope leaks the storage it points to.

diff --git a/plugins/mmsnmptrapd/mmsnmptrapd.c b/plugins/mmsnmptrapd/mmsnmptrapd.c
index 8b1888327..a5d29fc34 100644
--- a/plugins/mmsnmptrapd/mmsnmptrapd.c
+++ b/plugins/mmsnmptrapd/mmsnmptrapd.c
@@ -263,7 +263,7 @@ buildSeverityMapping(instanceData *pData)
 	uchar pszSevCode[512];
 	int sevCode;
 	uchar *mapping;
-	struct severMap_s *node;
+	struct severMap_s *node = NULL;
 	DEFiRet;
 
 	mapping = cs.pszSeverityMapping;
@@ -296,6 +296,10 @@ buildSeverityMapping(instanceData *pData)
 	}
 
 finalize_it:
+	if(iRet != RS_RET_OK) {
+		if(node != NULL)
+			free(node);
+	}
 	RETiRet;
 }
 

