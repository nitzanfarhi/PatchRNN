commit 6e1b1a27a4034c578018d5042b3c8228278c4cd6
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Fri Aug 30 20:57:55 2013 +0200

    avcodec/avpacket: Use av_free_packet() in error cleanups
    
    This prevents memleaks on errors
    reproduceable with fate when error pathes are forced
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/avpacket.c b/libavcodec/avpacket.c
index 7196c3165e..b6b4109a2c 100644
--- a/libavcodec/avpacket.c
+++ b/libavcodec/avpacket.c
@@ -215,7 +215,7 @@ FF_ENABLE_DEPRECATION_WARNINGS
     return 0;
 
 failed_alloc:
-    av_destruct_packet(pkt);
+    av_free_packet(pkt);
     return AVERROR(ENOMEM);
 }
 
@@ -237,7 +237,7 @@ int av_copy_packet_side_data(AVPacket *pkt, AVPacket *src)
     return 0;
 
 failed_alloc:
-    av_destruct_packet(pkt);
+    av_free_packet(pkt);
     return AVERROR(ENOMEM);
 }
 

