commit 8b7af6e1e7163d62fc98add772da73b2f88b31d7
Author: Dirk Lemstra <dirk@git.imagemagick.org>
Date:   Thu Apr 27 12:06:41 2017 +0200

    Fixed more memory leaks.

diff --git a/coders/png.c b/coders/png.c
index 6a6b4c8e6..8fadcf525 100644
--- a/coders/png.c
+++ b/coders/png.c
@@ -6240,8 +6240,12 @@ static Image *ReadOneMNGImage(MngInfo* mng_info, const ImageInfo *image_info,
                               SEEK_SET);
 
                             if (offset < 0)
-                              ThrowReaderException(CorruptImageError,
-                                "ImproperImageHeader");
+                              {
+                                chunk=(unsigned char *) RelinquishMagickMemory(
+                                  chunk);
+                                ThrowReaderException(CorruptImageError,
+                                  "ImproperImageHeader");
+                              }
                           }
 
                         else
@@ -6557,7 +6561,10 @@ static Image *ReadOneMNGImage(MngInfo* mng_info, const ImageInfo *image_info,
           }
 #if defined(MNG_INSERT_LAYERS)
         if (length < 8)
-          ThrowReaderException(CorruptImageError,"ImproperImageHeader");
+          {
+            chunk=(unsigned char *) RelinquishMagickMemory(chunk);
+            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
+          }
 
         image_width=(size_t) mng_get_long(p);
         image_height=(size_t) mng_get_long(&p[4]);

