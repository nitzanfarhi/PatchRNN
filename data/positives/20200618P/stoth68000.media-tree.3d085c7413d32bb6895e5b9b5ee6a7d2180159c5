commit 3d085c7413d32bb6895e5b9b5ee6a7d2180159c5
Author: Kees Cook <keescook@chromium.org>
Date:   Wed Apr 6 15:53:27 2016 -0700

    lkdtm: do not leak free page on kmalloc failure
    
    This frees the allocated page if there is a kmalloc failure.
    
    Signed-off-by: Kees Cook <keescook@chromium.org>

diff --git a/drivers/misc/lkdtm.c b/drivers/misc/lkdtm.c
index 5b3a63c87ec9..0a5cbbe12452 100644
--- a/drivers/misc/lkdtm.c
+++ b/drivers/misc/lkdtm.c
@@ -507,8 +507,10 @@ static void lkdtm_do_action(enum ctype which)
 			break;
 
 		val = kmalloc(1024, GFP_KERNEL);
-		if (!val)
+		if (!val) {
+			free_page(p);
 			break;
+		}
 
 		base = (int *)p;
 

