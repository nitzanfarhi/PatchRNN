commit 08ff39f1c8f2134f7d0f38123ca5952371665cc5
Author: Sven Wegener <sven.wegener@stealer.net>
Date:   Thu Oct 16 14:16:53 2008 +1100

    md: check for memory allocation failure in faulty personality
    
    It's a fault injection module, but I don't think we should oops here.
    
    Signed-off-by: Sven Wegener <sven.wegener@stealer.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Neil Brown <neilb@suse.de>

diff --git a/drivers/md/faulty.c b/drivers/md/faulty.c
index 268547dbfbd3..f26c1f9a475b 100644
--- a/drivers/md/faulty.c
+++ b/drivers/md/faulty.c
@@ -287,6 +287,8 @@ static int run(mddev_t *mddev)
 	int i;
 
 	conf_t *conf = kmalloc(sizeof(*conf), GFP_KERNEL);
+	if (!conf)
+		return -ENOMEM;
 
 	for (i=0; i<Modes; i++) {
 		atomic_set(&conf->counters[i], 0);

