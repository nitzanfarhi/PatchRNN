commit f3bd7d3ae2379ebecb96e8d2d5bd990c7b68aa21
Author: Török Edvin <edwin@clamav.net>
Date:   Mon Mar 1 19:46:58 2010 +0200

    Fix error path leak in unrar.
    
    When unpack29 fails, we try 20/15 which may succeed.
    In that case the vm is inited, but on next iteration it will try to init it
    again, loosing the pointer to old vm data forever.

diff --git a/libclamunrar/unrar.c b/libclamunrar/unrar.c
index 06970c376..bfa078729 100644
--- a/libclamunrar/unrar.c
+++ b/libclamunrar/unrar.c
@@ -1101,6 +1101,7 @@ int rar_unpack(int fd, int method, int solid, unpack_data_t *unpack_data)
 	default:
 		retval = rar_unpack29(fd, solid, unpack_data);
 		if(retval == FALSE) {
+		    rarvm_free(&unpack_data->rarvm_data);
 		    retval = rar_unpack20(fd, solid, unpack_data);
 		    if(retval == FALSE)
 			retval = rar_unpack15(fd, solid, unpack_data);

