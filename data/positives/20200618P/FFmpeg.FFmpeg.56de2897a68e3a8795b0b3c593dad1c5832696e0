commit 56de2897a68e3a8795b0b3c593dad1c5832696e0
Author: Dale Curtis <dalecurtis@chromium.org>
Date:   Tue Dec 2 16:47:55 2014 +0000

    h264: Fix memory leak on ff_h264_decode_init() failure
    
    CC: libav-devel@libav.org

diff --git a/libavcodec/h264.c b/libavcodec/h264.c
index a3920543e4..cb29d3621b 100644
--- a/libavcodec/h264.c
+++ b/libavcodec/h264.c
@@ -662,8 +662,10 @@ av_cold int ff_h264_decode_init(AVCodecContext *avctx)
 
     if (avctx->extradata_size > 0 && avctx->extradata) {
        ret = ff_h264_decode_extradata(h);
-       if (ret < 0)
+       if (ret < 0) {
+           ff_h264_free_context(h);
            return ret;
+       }
     }
 
     if (h->sps.bitstream_restriction_flag &&

