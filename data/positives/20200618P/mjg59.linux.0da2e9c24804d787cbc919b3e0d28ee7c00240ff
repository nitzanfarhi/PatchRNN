commit 0da2e9c24804d787cbc919b3e0d28ee7c00240ff
Author: Arnaldo Carvalho de Melo <acme@redhat.com>
Date:   Tue Oct 16 14:51:04 2012 -0300

    perf python: Initialize 'page_size' variable
    
    The commit 0c1fe6b:
    
     'perf tools: Have the page size value available for all tools'
    
    Broke the python binding because the global variable 'page_size' is
    initialized on the main() routine, that is not called when using
    just the python binding, causing evlist.mmap() to fail because it
    expects that variable to be initialized to the system's page size.
    
    Fix it by initializing it on the binding init routine.
    
    Reported-by: David Ahern <dsahern@gmail.com>
    Cc: David Ahern <dsahern@gmail.com>
    Cc: Frederic Weisbecker <fweisbec@gmail.com>
    Cc: Jiri Olsa <jolsa@redhat.com>
    Cc: Mike Galbraith <efault@gmx.de>
    Cc: Namhyung Kim <namhyung@gmail.com>
    Cc: Paul Mackerras <paulus@samba.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Stephane Eranian <eranian@google.com>
    Link: http://lkml.kernel.org/n/tip-vrvp3azmbfzexnpmkhmvtzzc@git.kernel.org
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/perf/util/python.c b/tools/perf/util/python.c
index 9181bf212fb9..a2657fd96837 100644
--- a/tools/perf/util/python.c
+++ b/tools/perf/util/python.c
@@ -1015,6 +1015,8 @@ PyMODINIT_FUNC initperf(void)
 	    pyrf_cpu_map__setup_types() < 0)
 		return;
 
+	page_size = sysconf(_SC_PAGE_SIZE);
+
 	Py_INCREF(&pyrf_evlist__type);
 	PyModule_AddObject(module, "evlist", (PyObject*)&pyrf_evlist__type);
 

