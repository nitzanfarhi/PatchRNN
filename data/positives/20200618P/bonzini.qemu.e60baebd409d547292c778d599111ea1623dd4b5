commit e60baebd409d547292c778d599111ea1623dd4b5
Author: Gonglei <arei.gonglei@huawei.com>
Date:   Wed May 6 20:55:29 2015 +0800

    usb-mtp: fix segmentation fault
    
    When x-root property not be configured, will cause segfault
    because of null pointer accessing. Add a check for s->root
    property avoid segfault.
    
    Signed-off-by: Gonglei <arei.gonglei@huawei.com>
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

diff --git a/hw/usb/dev-mtp.c b/hw/usb/dev-mtp.c
index c9c1f3210c..809b1cb118 100644
--- a/hw/usb/dev-mtp.c
+++ b/hw/usb/dev-mtp.c
@@ -1071,6 +1071,10 @@ static void usb_mtp_realize(USBDevice *dev, Error **errp)
     usb_desc_init(dev);
     QTAILQ_INIT(&s->objects);
     if (s->desc == NULL) {
+        if (s->root == NULL) {
+            error_setg(errp, "usb-mtp: x-root property must be configured");
+            return;
+        }
         s->desc = strrchr(s->root, '/');
         if (s->desc && s->desc[0]) {
             s->desc = g_strdup(s->desc + 1);

