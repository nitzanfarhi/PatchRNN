commit c9656d8532d50a8b52c8dda62dd058f0da36bdbc
Author: Robert R. Henry <rrh@newrelic.com>
Date:   Wed Jan 7 08:28:00 2015 -0800

    Don't double box properties.
    
    Summary: There may be other instances of this problem that I haven't found.
    
    Closes https://github.com/facebook/hhvm/issues/4554
    Closes https://github.com/facebook/hhvm/pull/4587
    
    Reviewed By: @JoelMarcey
    
    Differential Revision: D1768665
    
    Signature: t1:1768665:1420648029:7e170a1da83949e78bfcd301c4935b40fb1a05a6

diff --git a/hphp/runtime/ext_zend_compat/php-src/Zend/zend_API.cpp b/hphp/runtime/ext_zend_compat/php-src/Zend/zend_API.cpp
index 4a10a7ec4d..5d5830e47b 100644
--- a/hphp/runtime/ext_zend_compat/php-src/Zend/zend_API.cpp
+++ b/hphp/runtime/ext_zend_compat/php-src/Zend/zend_API.cpp
@@ -1634,7 +1634,9 @@ ZEND_API zval *zend_read_property(zend_class_entry *scope, zval *object, const c
 
   if (!lookup.accessible || prop->m_type == HPHP::KindOfUninit) return nullptr;
 
-  tvBox(prop);
+  if (prop->m_type != HPHP::KindOfRef) {
+    tvBox(prop);
+  }
   return prop->m_data.pref;
 }
 
@@ -1656,7 +1658,9 @@ ZEND_API zval *zend_read_static_property(zend_class_entry *scope, const char *na
 
   if (!prop || !lookup.accessible) return nullptr;
 
-  if (prop->m_type != HPHP::KindOfRef) tvBox(prop);
+  if (prop->m_type != HPHP::KindOfRef) {
+    tvBox(prop);
+  }
   return prop->m_data.pref;
 }
 

