commit af1be4f851db4f4975f0139211a6561776ef37c0
Author: Stefan Behrens <sbehrens@giantdisaster.de>
Date:   Tue Nov 27 17:39:51 2012 +0000

    Btrfs: fix a scrub regression in case of write errors
    
    This regression was introduced by the device-replace patches.
    Scrub immediately stops checking those disks that have write errors.
    This is nothing that happens in the real world, but it is wrong
    since scrub is the tool to detect and repair defects. Fix it.
    
    Signed-off-by: Stefan Behrens <sbehrens@giantdisaster.de>
    Signed-off-by: Chris Mason <chris.mason@fusionio.com>

diff --git a/fs/btrfs/scrub.c b/fs/btrfs/scrub.c
index 30ba99724896..8db6a6413a5f 100644
--- a/fs/btrfs/scrub.c
+++ b/fs/btrfs/scrub.c
@@ -2657,7 +2657,8 @@ int scrub_enumerate_chunks(struct scrub_ctx *sctx,
 		btrfs_put_block_group(cache);
 		if (ret)
 			break;
-		if (atomic64_read(&dev_replace->num_write_errors) > 0) {
+		if (is_dev_replace &&
+		    atomic64_read(&dev_replace->num_write_errors) > 0) {
 			ret = -EIO;
 			break;
 		}

