commit fd2ffd31a29c6d63d3de7a09c84a9184f853317b
Author: Lauri Kasanen <cand@gmx.com>
Date:   Thu Jun 6 17:42:46 2013 +0300

    Sched: Fix a segfault when iterating timeouts

diff --git a/src/mk_scheduler.c b/src/mk_scheduler.c
index cc125c38..4ece9a92 100644
--- a/src/mk_scheduler.c
+++ b/src/mk_scheduler.c
@@ -470,6 +470,10 @@ int mk_sched_check_timeouts(struct sched_list_node *sched)
 
                 mk_sched_remove_client(sched, cs_node->socket);
                 mk_session_remove(cs_node->socket);
+
+                /* This removal invalidated our iterator. Start over from the beginning. */
+                node = rb_first(cs_list);
+                if (!node) break;
             }
         }
     }

