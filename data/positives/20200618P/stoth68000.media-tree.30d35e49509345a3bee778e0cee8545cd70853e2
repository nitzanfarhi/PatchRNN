commit 30d35e49509345a3bee778e0cee8545cd70853e2
Author: Jean-Francois Moine <moinejf@free.fr>
Date:   Tue Apr 21 13:57:31 2009 -0300

    V4L/DVB (11711): gspca - main: Fix a crash when no bandwidth available
    
    When the bandwidth is not wide enough, the transfer endpoint may be set to
    the one of the alternate setting 0. This one may be null and this causes a
    divide by 0 oops.
    
    Reported-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Jean-Francois Moine <moinejf@free.fr>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/video/gspca/gspca.c b/drivers/media/video/gspca/gspca.c
index 873e95580407..efa4dd349f60 100644
--- a/drivers/media/video/gspca/gspca.c
+++ b/drivers/media/video/gspca/gspca.c
@@ -449,7 +449,8 @@ static struct usb_host_endpoint *alt_xfer(struct usb_host_interface *alt,
 	for (i = 0; i < alt->desc.bNumEndpoints; i++) {
 		ep = &alt->endpoint[i];
 		attr = ep->desc.bmAttributes & USB_ENDPOINT_XFERTYPE_MASK;
-		if (attr == xfer)
+		if (attr == xfer
+		    && ep->desc.wMaxPacketSize != 0)
 			return ep;
 	}
 	return NULL;

