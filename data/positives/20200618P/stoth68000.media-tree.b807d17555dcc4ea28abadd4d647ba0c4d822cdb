commit b807d17555dcc4ea28abadd4d647ba0c4d822cdb
Author: Julia Lawall <julia@diku.dk>
Date:   Tue Aug 4 22:00:24 2009 -0300

    V4L/DVB (12421): drivers/media/video/gspca: introduce missing kfree
    
    Error handling code following a kmalloc should free the allocated data.
    
    Signed-off-by: Julia Lawall <julia@diku.dk>
    Acked-by: Erik Andr√©n <erik.andren@gmail.com>
    Signed-off-by: Douglas Schilling Landgraf <dougsland@redhat.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/video/gspca/m5602/m5602_s5k83a.c b/drivers/media/video/gspca/m5602/m5602_s5k83a.c
index 7127321ace8c..6b89f33a4ce0 100644
--- a/drivers/media/video/gspca/m5602/m5602_s5k83a.c
+++ b/drivers/media/video/gspca/m5602/m5602_s5k83a.c
@@ -178,8 +178,10 @@ int s5k83a_probe(struct sd *sd)
 
 	sens_priv->settings =
 	kmalloc(sizeof(s32)*ARRAY_SIZE(s5k83a_ctrls), GFP_KERNEL);
-	if (!sens_priv->settings)
+	if (!sens_priv->settings) {
+		kfree(sens_priv);
 		return -ENOMEM;
+	}
 
 	sd->gspca_dev.cam.cam_mode = s5k83a_modes;
 	sd->gspca_dev.cam.nmodes = ARRAY_SIZE(s5k83a_modes);

