commit e61a9bf1c908aba426db8e18d3c834c267f5d9b6
Author: Bron Gondwana <brong@fastmail.fm>
Date:   Tue Feb 19 13:58:53 2013 +1100

    buf: don't realloc for every buf_ensure

diff --git a/lib/util.c b/lib/util.c
index 6ec1799de..3f21f55a1 100644
--- a/lib/util.c
+++ b/lib/util.c
@@ -756,6 +756,9 @@ EXPORTED void buf_ensure(struct buf *buf, size_t n)
     /* protect against wrap */
     assert(newlen >= buf->len);
 
+    if (buf->alloc >= newlen)
+	return;
+
     if (buf->alloc) {
 	buf->s = xrealloc(buf->s, newlen);
     }

