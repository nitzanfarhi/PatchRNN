commit 77906a5075a4eb767026c2e07b1a412d08aea5be
Author: Li Zefan <lizf@cn.fujitsu.com>
Date:   Thu Jul 14 03:16:00 2011 +0000

    Btrfs: copy string correctly in INO_LOOKUP ioctl
    
    Memory areas [ptr, ptr+total_len] and [name, name+total_len]
    may overlap, so it's wrong to use memcpy().
    
    Signed-off-by: Li Zefan <lizf@cn.fujitsu.com>
    Signed-off-by: Chris Mason <chris.mason@oracle.com>

diff --git a/fs/btrfs/ioctl.c b/fs/btrfs/ioctl.c
index fd252fff4c66..2bb08862a4f6 100644
--- a/fs/btrfs/ioctl.c
+++ b/fs/btrfs/ioctl.c
@@ -1757,11 +1757,10 @@ static noinline int btrfs_search_path_in_tree(struct btrfs_fs_info *info,
 		key.objectid = key.offset;
 		key.offset = (u64)-1;
 		dirid = key.objectid;
-
 	}
 	if (ptr < name)
 		goto out;
-	memcpy(name, ptr, total_len);
+	memmove(name, ptr, total_len);
 	name[total_len]='\0';
 	ret = 0;
 out:

