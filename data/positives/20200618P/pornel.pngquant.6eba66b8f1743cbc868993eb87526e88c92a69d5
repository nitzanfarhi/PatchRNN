commit 6eba66b8f1743cbc868993eb87526e88c92a69d5
Author: Kornel LesinÃÅski <kornel@geekhood.net>
Date:   Thu Mar 21 07:34:02 2013 -0500

    Protect against int overflow

diff --git a/lib/libimagequant.c b/lib/libimagequant.c
index 7f61189..e340ea7 100644
--- a/lib/libimagequant.c
+++ b/lib/libimagequant.c
@@ -18,6 +18,7 @@
 #include <string.h>
 #include <stdarg.h>
 #include <stdbool.h>
+#include <limits.h>
 
 #if !defined(__STDC_VERSION__) || __STDC_VERSION__ < 199900L
 #error "This program requires C99, e.g. -std=c99 switch in GCC. MSVC doesn't support C newer than '89, please use MinGW on Windows."
@@ -414,6 +415,9 @@ LIQ_EXPORT liq_image *liq_image_create_custom(liq_attr *attr, liq_image_get_rgba
 
 LIQ_EXPORT liq_image *liq_image_create_rgba_rows(liq_attr *attr, void* rows[], int width, int height, double gamma)
 {
+    if (width <= 0 || height <= 0) return NULL;
+    if (width > INT_MAX/height/16 || height > INT_MAX/width/16) return NULL;
+
     for(int i=0; i < height; i++) {
         if (!CHECK_USER_POINTER(rows+i) || !CHECK_USER_POINTER(rows[i])) return NULL;
     }
@@ -423,6 +427,7 @@ LIQ_EXPORT liq_image *liq_image_create_rgba_rows(liq_attr *attr, void* rows[], i
 LIQ_EXPORT liq_image *liq_image_create_rgba(liq_attr *attr, void* bitmap, int width, int height, double gamma)
 {
     if (width <= 0 || height <= 0 || gamma < 0 || gamma > 1.0) return NULL;
+    if (width > INT_MAX/height/16 || height > INT_MAX/width/16) return NULL;
     if (!CHECK_STRUCT_TYPE(attr, liq_attr)) return NULL;
     if (!CHECK_USER_POINTER(bitmap)) return NULL;
 

