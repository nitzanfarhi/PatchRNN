commit 24fce3a74996628c6ecdcd0e8622400744ccc731
Author: Zhang Zhaolong <zhangzl2013@126.com>
Date:   Sat Apr 26 12:05:52 2014 +0800

    core: fix memory leak in case of error out.

diff --git a/libfreerdp/core/gateway/tsg.c b/libfreerdp/core/gateway/tsg.c
index a4cbd9a2a..62a84a6a9 100644
--- a/libfreerdp/core/gateway/tsg.c
+++ b/libfreerdp/core/gateway/tsg.c
@@ -373,6 +373,10 @@ BOOL TsProxyCreateTunnelReadResponse(rdpTsg* tsg, RPC_PDU* pdu)
 
 			default:
 				fprintf(stderr, "Unexpected Message Type: 0x%X\n", (int) MessageSwitchValue);
+				free(tsgCaps);
+				free(versionCaps);
+				free(packetCapsResponse);
+				free(packet);
 				return FALSE;
 
 		}
@@ -619,6 +623,7 @@ BOOL TsProxyAuthorizeTunnelReadResponse(rdpTsg* tsg, RPC_PDU* pdu)
 	{
 		fprintf(stderr, "status: E_PROXY_NAP_ACCESSDENIED (0x%08X)\n", E_PROXY_NAP_ACCESSDENIED);
 		fprintf(stderr, "Ensure that the Gateway Connection Authorization Policy is correct\n");
+		free(packet);
 		return FALSE;
 	}
 

