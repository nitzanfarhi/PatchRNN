commit a677f47926b9640c53fbd00c94d6eb7a590a94fc
Author: Josh Durgin <josh.durgin@inktank.com>
Date:   Mon Sep 24 15:03:56 2012 -0700

    librados: fix use without NULL check in rados_pool_list
    
    CID 716911: Dereference after null check (FORWARD_NULL)
    At (5): Passing null pointer "b" to function "strncat(char *, char
    const *, size_t)", which dereferences it. (The dereference is assumed
    on the basis of the 'nonnull' parameter attribute.)
    
    Signed-off-by: Josh Durgin <josh.durgin@inktank.com>

diff --git a/src/librados/librados.cc b/src/librados/librados.cc
index 5aad1a64c7..82721a96aa 100644
--- a/src/librados/librados.cc
+++ b/src/librados/librados.cc
@@ -1483,6 +1483,9 @@ extern "C" int rados_pool_list(rados_t cluster, char *buf, size_t len)
   std::list<std::string> pools;
   client->pool_list(pools);
 
+  if (!buf)
+    return -EINVAL;
+
   char *b = buf;
   if (b)
     memset(b, 0, len);

