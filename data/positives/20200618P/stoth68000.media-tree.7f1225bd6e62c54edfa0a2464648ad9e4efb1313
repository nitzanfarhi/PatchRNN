commit 7f1225bd6e62c54edfa0a2464648ad9e4efb1313
Author: Satish <x0124230@ti.com>
Date:   Wed Jun 9 13:21:27 2010 +0300

    omap iommu: Fix Memory leak
    
    The memory allocated for sgt structure is not freed on error
    when sg_alloc_table is called in sgtable_alloc().
    
    Signed-off-by: Satish Kumar <x0124230@ti.com>
    Signed-off-by: Manjunatha GK <manjugk@ti.com>
    Cc: Vimal Singh <vimal.newwork@gmail.com>
    Signed-off-by: Hiroshi DOYU <Hiroshi.DOYU@nokia.com>
    Signed-off-by: Tony Lindgen <tony@atomide.com>

diff --git a/arch/arm/plat-omap/iovmm.c b/arch/arm/plat-omap/iovmm.c
index e43983ba59c5..8ce0de247c71 100644
--- a/arch/arm/plat-omap/iovmm.c
+++ b/arch/arm/plat-omap/iovmm.c
@@ -140,8 +140,10 @@ static struct sg_table *sgtable_alloc(const size_t bytes, u32 flags)
 		return ERR_PTR(-ENOMEM);
 
 	err = sg_alloc_table(sgt, nr_entries, GFP_KERNEL);
-	if (err)
+	if (err) {
+		kfree(sgt);
 		return ERR_PTR(err);
+	}
 
 	pr_debug("%s: sgt:%p(%d entries)\n", __func__, sgt, nr_entries);
 

