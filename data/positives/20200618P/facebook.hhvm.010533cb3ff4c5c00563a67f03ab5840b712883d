commit 010533cb3ff4c5c00563a67f03ab5840b712883d
Author: Jingyi Wei <jyw@epochtimes.com>
Date:   Tue Jan 6 21:23:24 2015 -0800

    Call gzclearerr() in gzseek().
    
    Summary: This clears gzeof so data can be read. This only occurs when the user read
    a gz file to the end, seek and read again with buffer size >= 8192.
    
    Part of #4136.
    Fixed test/zend/good/ext/zlib/tests/gzreadgzwriteplain.php.
    Closes https://github.com/facebook/hhvm/pull/4573
    
    Reviewed By: @JoelMarcey
    
    Differential Revision: D1765384
    
    Signature: t1:1765384:1420608129:52cf086d5b7c4aaec8d8727a2c926a7cf097c9b4

diff --git a/hphp/runtime/ext/zlib/zip-file.cpp b/hphp/runtime/ext/zlib/zip-file.cpp
index 9b55a8fbab..e8b24cc6ae 100644
--- a/hphp/runtime/ext/zlib/zip-file.cpp
+++ b/hphp/runtime/ext/zlib/zip-file.cpp
@@ -142,6 +142,7 @@ bool ZipFile::seek(int64_t offset, int whence /* = SEEK_SET */) {
   setWritePosition(0);
   setReadPosition(0);
   setEof(false);
+  gzclearerr(m_gzFile);
   flush();
   off_t result = gzseek(m_gzFile, offset, whence);
   setPosition(result);

