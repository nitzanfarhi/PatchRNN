commit ff17e953cb70e37ceb7b487113a0a37441052219
Author: Jim Meyering <jim@meyering.net>
Date:   Tue Mar 4 15:25:11 2008 -0800

    USB: usbaudio: handle kcalloc failure
    
    sound/usb/usbaudio.c (check_hw_params_convention): Handle kcalloc failure.
    
    Signed-off-by: Jim Meyering <meyering@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/sound/usb/usbaudio.c b/sound/usb/usbaudio.c
index 675672f313be..f48838a078cb 100644
--- a/sound/usb/usbaudio.c
+++ b/sound/usb/usbaudio.c
@@ -1762,6 +1762,8 @@ static int check_hw_params_convention(struct snd_usb_substream *subs)
 
 	channels = kcalloc(MAX_MASK, sizeof(u32), GFP_KERNEL);
 	rates = kcalloc(MAX_MASK, sizeof(u32), GFP_KERNEL);
+	if (!channels || !rates)
+		goto __out;
 
 	list_for_each(p, &subs->fmt_list) {
 		struct audioformat *f;

