commit 74c8719b8ee0922593a5cbec0bd6127d86d8a2f4
Author: Amitkumar Karwar <akarwar@marvell.com>
Date:   Thu Dec 1 19:23:31 2016 +0530

    mwifiex: sdio: fix use after free issue for save_adapter
    
    If we have sdio work requests received when sdio card reset is
    happening, we may end up accessing older save_adapter pointer
    later which is already freed during card reset.
    This patch solves the problem by cancelling those pending requests.
    
    Signed-off-by: Amitkumar Karwar <akarwar@marvell.com>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>

diff --git a/drivers/net/wireless/marvell/mwifiex/sdio.c b/drivers/net/wireless/marvell/mwifiex/sdio.c
index 740d79cd91fa..43facba641bf 100644
--- a/drivers/net/wireless/marvell/mwifiex/sdio.c
+++ b/drivers/net/wireless/marvell/mwifiex/sdio.c
@@ -2237,6 +2237,12 @@ static void mwifiex_recreate_adapter(struct sdio_mmc_card *card)
 	mmc_hw_reset(func->card->host);
 	sdio_release_host(func);
 
+	/* Previous save_adapter won't be valid after this. We will cancel
+	 * pending work requests.
+	 */
+	clear_bit(MWIFIEX_IFACE_WORK_DEVICE_DUMP, &iface_work_flags);
+	clear_bit(MWIFIEX_IFACE_WORK_CARD_RESET, &iface_work_flags);
+
 	mwifiex_sdio_probe(func, device_id);
 }
 

