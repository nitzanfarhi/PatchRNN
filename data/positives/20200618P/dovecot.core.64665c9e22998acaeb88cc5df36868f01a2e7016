commit 64665c9e22998acaeb88cc5df36868f01a2e7016
Author: Timo Sirainen <tss@iki.fi>
Date:   Sat Dec 13 14:59:39 2008 +0200

    expunged and has(_no)_nuls status wasn't reset when switching between mails.
    This may have caused Dovecot to wrongly assume that a mail was expunged if
    the previous one was.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-storage/index/index-mail.c b/src/lib-storage/index/index-mail.c
index 6e560ae07..7c440ae76 100644
--- a/src/lib-storage/index/index-mail.c
+++ b/src/lib-storage/index/index-mail.c
@@ -1132,6 +1132,12 @@ static void index_mail_reset(struct index_mail *mail)
 	data->save_date = (time_t)-1;
 	data->received_date = (time_t)-1;
 	data->sent_date.time = (uint32_t)-1;
+
+	mail->mail.mail.seq = 0;
+	mail->mail.mail.uid = 0;
+	mail->mail.mail.expunged = FALSE;
+	mail->mail.mail.has_nuls = FALSE;
+	mail->mail.mail.has_no_nuls = FALSE;
 }
 
 static void check_envelope(struct index_mail *mail)

