commit 8b7d510fb182ca40bd0f905bb2f5543b0d9549de
Author: Junio C Hamano <junkio@cox.net>
Date:   Sat May 28 12:22:38 2005 -0700

    [PATCH] Fix count-delta overcounting
    
    The count-delta routine sometimes overcounted the copied source
    material which resulted in unsigned int wraparound.
    
    Signed-off-by: Junio C Hamano <junkio@cox.net>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/count-delta.c b/count-delta.c
index 3bcc205f5..e10c832a7 100644
--- a/count-delta.c
+++ b/count-delta.c
@@ -88,5 +88,8 @@ unsigned long count_delta(void *delta_buf, unsigned long delta_size)
 	/* delete size is what was _not_ copied from source.
 	 * edit size is that and literal additions.
 	 */
+	if (src_size + added_literal < copied_from_source)
+		/* we ended up overcounting and underflowed */
+		return 0;
 	return (src_size - copied_from_source) + added_literal;
 }

