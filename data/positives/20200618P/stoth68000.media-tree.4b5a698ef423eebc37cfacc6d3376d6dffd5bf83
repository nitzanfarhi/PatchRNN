commit 4b5a698ef423eebc37cfacc6d3376d6dffd5bf83
Author: Patrick McHardy <kaber@trash.net>
Date:   Sun Jul 6 15:49:08 2008 -0700

    net: fix dev_set_promiscuity() breakage
    
    Commit dad9b335 (netdevice: Fix promiscuity and allmulti overflow) broke
    dev_set_promiscuity() by returning on success without reprogramming the
    device.
    
    Signed-off-by: Patrick McHardy <kaber@trash.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/core/dev.c b/net/core/dev.c
index bfa9a6a951dd..75933932463d 100644
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@ -2859,7 +2859,7 @@ int dev_set_promiscuity(struct net_device *dev, int inc)
 	int err;
 
 	err = __dev_set_promiscuity(dev, inc);
-	if (!err)
+	if (err < 0)
 		return err;
 	if (dev->flags != old_flags)
 		dev_set_rx_mode(dev);

