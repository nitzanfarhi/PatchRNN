commit 768eb9182e94a94bc2ef46f565a0dac7afef3b57
Author: Mark Thompson <sw@jkqxz.net>
Date:   Mon Aug 14 16:46:32 2017 +0100

    cbs_h2645: Return error if writing fails

diff --git a/libavcodec/cbs_h2645.c b/libavcodec/cbs_h2645.c
index 23556f47f..4d8ba99b3 100644
--- a/libavcodec/cbs_h2645.c
+++ b/libavcodec/cbs_h2645.c
@@ -1244,6 +1244,11 @@ static int cbs_h2645_write_nal_unit(CodedBitstreamContext *ctx,
     // Overflow but we didn't notice.
     av_assert0(put_bits_count(&pbc) <= 8 * priv->write_buffer_size);
 
+    if (err < 0) {
+        // Write failed for some other reason.
+        return err;
+    }
+
     if (put_bits_count(&pbc) % 8)
         unit->data_bit_padding = 8 - put_bits_count(&pbc) % 8;
     else

