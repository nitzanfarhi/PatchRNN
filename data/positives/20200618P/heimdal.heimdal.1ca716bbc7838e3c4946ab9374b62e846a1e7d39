commit 1ca716bbc7838e3c4946ab9374b62e846a1e7d39
Author: Love Hornquist Astrand <lha@h5l.org>
Date:   Thu Jul 30 07:42:12 2009 +0200

    Free buf on random generator error [CID-177]

diff --git a/kdc/pkinit.c b/kdc/pkinit.c
index 96bac4dfa..d73224fe5 100644
--- a/kdc/pkinit.c
+++ b/kdc/pkinit.c
@@ -1450,8 +1450,10 @@ _kdc_pk_mk_pa_reply(krb5_context context,
 
 	ret = krb5_generate_random_keyblock(context, sessionetype, 
 					    sessionkey);
-	if (ret)
+	if (ret) {
+	    free(buf);
 	    goto out;
+	}
 
     } else
 	krb5_abortx(context, "PK-INIT internal error");

