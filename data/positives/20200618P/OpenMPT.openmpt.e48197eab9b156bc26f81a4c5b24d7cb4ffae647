commit e48197eab9b156bc26f81a4c5b24d7cb4ffae647
Author: Johannes Schultz <saga-games@users.sourceforge.net>
Date:   Fri Mar 28 02:34:36 2014 +0000

    [Fix] In some cases, sample slots occupied by other instruments were overwritten when loading a new instrument (http://forum.openmpt.org/index.php?topic=5253.0).
    
    git-svn-id: https://source.openmpt.org/svn/openmpt/trunk/OpenMPT@3980 56274372-70c3-4bfc-bfc3-4c3a0b034d27

diff --git a/soundlib/Sndfile.cpp b/soundlib/Sndfile.cpp
index afa600720..5b5c99dba 100644
--- a/soundlib/Sndfile.cpp
+++ b/soundlib/Sndfile.cpp
@@ -1979,7 +1979,7 @@ SAMPLEINDEX CSoundFile::GetNextFreeSample(INSTRUMENTINDEX targetInstrument, SAMP
 				// In instrument mode, check whether any instrument references this sample slot. If that is the case, we won't use it as it could lead to unwanted conflicts.
 				// If we are loading the sample *into* an instrument, we should also not consider that instrument's sample map, since it might be inconsistent at this time.
 				bool isReferenced = false;
-				for(INSTRUMENTINDEX ins = 1; ins < GetNumInstruments(); ins++)
+				for(INSTRUMENTINDEX ins = 1; ins <= GetNumInstruments(); ins++)
 				{
 					if(ins == targetInstrument)
 					{

