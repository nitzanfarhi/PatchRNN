commit 5e540f7715b8cd83b8e60beaaa525b125cc122de
Author: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Date:   Mon Dec 27 06:53:10 2010 +0000

    btrfs: Fix memory leak in btrfs_read_fs_root_no_radix()
    
    In btrfs_read_fs_root_no_radix(), 'root' is not freed if
    btrfs_search_slot() returns error.
    
    Signed-off-by: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
    Signed-off-by: Chris Mason <chris.mason@oracle.com>

diff --git a/fs/btrfs/disk-io.c b/fs/btrfs/disk-io.c
index a0c37b2ee9ed..9b1dd4138072 100644
--- a/fs/btrfs/disk-io.c
+++ b/fs/btrfs/disk-io.c
@@ -1153,6 +1153,7 @@ struct btrfs_root *btrfs_read_fs_root_no_radix(struct btrfs_root *tree_root,
 	}
 	btrfs_free_path(path);
 	if (ret) {
+		kfree(root);
 		if (ret > 0)
 			ret = -ENOENT;
 		return ERR_PTR(ret);

