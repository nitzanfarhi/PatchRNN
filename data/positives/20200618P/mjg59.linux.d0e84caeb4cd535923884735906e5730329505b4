commit d0e84caeb4cd535923884735906e5730329505b4
Author: Kyle Manna <kyle@kylemanna.com>
Date:   Thu Aug 11 22:33:14 2011 -0500

    mfd: Check for twl4030-madc NULL pointer
    
    If the twl4030-madc device wasn't registered, and another device, such
    as twl4030-madc-hwmon, calls twl4030_madc_conversion() a NULL pointer is
    dereferenced.
    
    Signed-off-by: Kyle Manna <kyle@kylemanna.com>
    Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>

diff --git a/drivers/mfd/twl4030-madc.c b/drivers/mfd/twl4030-madc.c
index cb44b53dee35..7cbf2aa9e64f 100644
--- a/drivers/mfd/twl4030-madc.c
+++ b/drivers/mfd/twl4030-madc.c
@@ -510,8 +510,9 @@ int twl4030_madc_conversion(struct twl4030_madc_request *req)
 	u8 ch_msb, ch_lsb;
 	int ret;
 
-	if (!req)
+	if (!req || !twl4030_madc)
 		return -EINVAL;
+
 	mutex_lock(&twl4030_madc->lock);
 	if (req->method < TWL4030_MADC_RT || req->method > TWL4030_MADC_SW2) {
 		ret = -EINVAL;

