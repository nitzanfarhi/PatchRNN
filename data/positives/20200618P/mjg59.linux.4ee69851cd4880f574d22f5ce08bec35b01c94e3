commit 4ee69851cd4880f574d22f5ce08bec35b01c94e3
Author: Dan Carpenter <error27@gmail.com>
Date:   Mon Aug 23 12:28:15 2010 +0200

    cciss: handle allocation failure
    
    If kmalloc() fails then cleanup and return failure (-1).
    
    Signed-off-by: Dan Carpenter <error27@gmail.com>
    Acked-by: Stephen M. Cameron <scameron@beardog.cce.hp.com>
    Signed-off-by: Jens Axboe <jaxboe@fusionio.com>

diff --git a/drivers/block/cciss.c b/drivers/block/cciss.c
index ce1a75df5902..7191c16954d2 100644
--- a/drivers/block/cciss.c
+++ b/drivers/block/cciss.c
@@ -4718,6 +4718,9 @@ static int __devinit cciss_init_one(struct pci_dev *pdev,
 	h->scatter_list = kmalloc(h->max_commands *
 						sizeof(struct scatterlist *),
 						GFP_KERNEL);
+	if (!h->scatter_list)
+		goto clean4;
+
 	for (k = 0; k < h->nr_cmds; k++) {
 		h->scatter_list[k] = kmalloc(sizeof(struct scatterlist) *
 							h->maxsgentries,

