commit 3b3c1f24e96c411a95daabb6af9e09c5381f713b
Author: Florian Fainelli <florian@openwrt.org>
Date:   Fri Nov 26 10:39:55 2010 +0100

    watchdog: Fix null pointer dereference while accessing rdc321x platform_data
    
    rdc321x-wdt currently fetches its driver specific data by using the
    platform_device->platform_data pointer, this is wrong because the mfd
    device which registers our platform_device has been added using
    mfd_add_device() which sets the platform_device->driver_data pointer
    instead.
    
    Signed-off-by: Florian Fainelli <florian@openwrt.org>
    CC: stable@kernel.org
    Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>

diff --git a/drivers/watchdog/rdc321x_wdt.c b/drivers/watchdog/rdc321x_wdt.c
index 428f8a1583e8..3939e53f5f98 100644
--- a/drivers/watchdog/rdc321x_wdt.c
+++ b/drivers/watchdog/rdc321x_wdt.c
@@ -231,7 +231,7 @@ static int __devinit rdc321x_wdt_probe(struct platform_device *pdev)
 	struct resource *r;
 	struct rdc321x_wdt_pdata *pdata;
 
-	pdata = pdev->dev.platform_data;
+	pdata = platform_get_drvdata(pdev);
 	if (!pdata) {
 		dev_err(&pdev->dev, "no platform data supplied\n");
 		return -ENODEV;

