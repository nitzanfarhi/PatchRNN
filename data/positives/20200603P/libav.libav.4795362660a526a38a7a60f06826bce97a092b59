commit 4795362660a526a38a7a60f06826bce97a092b59
Author: Justin Ruggles <justin.ruggles@gmail.com>
Date:   Mon Jun 11 10:29:57 2012 -0400

    golomb: check remaining bits during unary decoding in get_ur_golomb_jpegls()
    
    Fixes infinite loop in FLAC decoding in case of a truncated bitstream due to
    the safe bitstream reader returning 0's at the end.
    
    Fixes Bug 310.
    
    CC:libav-stable@libav.org

diff --git a/libavcodec/golomb.h b/libavcodec/golomb.h
index 1712540fd..b6b8cc841 100644
--- a/libavcodec/golomb.h
+++ b/libavcodec/golomb.h
@@ -301,7 +301,7 @@ static inline int get_ur_golomb_jpegls(GetBitContext *gb, int k, int limit, int
         return buf;
     }else{
         int i;
-        for (i = 0; i < limit && SHOW_UBITS(re, gb, 1) == 0; i++) {
+        for (i = 0; i < limit && SHOW_UBITS(re, gb, 1) == 0 && HAVE_BITS_REMAINING(re, gb); i++) {
             LAST_SKIP_BITS(re, gb, 1);
             UPDATE_CACHE(re, gb);
         }

