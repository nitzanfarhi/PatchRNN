commit 9da77f6c948da8ac223b99f8e085c3d384787bff
Author: Sam Hartman <hartmans@mit.edu>
Date:   Tue Mar 31 22:35:59 2009 +0000

    Initialize request state in the TGS path
    
    ticket: 6436
    
    git-svn-id: svn://anonsvn.mit.edu/krb5/trunk@22151 dc483132-0cff-0310-8789-dd5450dbe970

diff --git a/src/kdc/do_tgs_req.c b/src/kdc/do_tgs_req.c
index 5af773046..e06d94dfc 100644
--- a/src/kdc/do_tgs_req.c
+++ b/src/kdc/do_tgs_req.c
@@ -164,6 +164,11 @@ process_tgs_req(krb5_data *pkt, const krb5_fulladdr *from,
         status="UNEXPECTED NULL in header_ticket";
         goto cleanup;
     }
+    errcode = kdc_make_rstate(&state);
+    if (errcode !=0) {
+	status = "making state";
+	goto cleanup;
+    }
     scratch.length = pa_tgs_req->length;
     scratch.data = (char *) pa_tgs_req->contents;
     errcode = kdc_find_fast(&request, &scratch, subkey, header_ticket->enc_part2->session, state);

