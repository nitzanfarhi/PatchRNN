commit a88ae0d44b6b5830b752641b2198735272f13eaf
Author: Eduardo Habkost <ehabkost@redhat.com>
Date:   Mon Sep 28 17:01:23 2015 -0300

    pc: Require xen when initializing xenfv machine
    
    Without this check, the xen-platform device will crash on reset
    if using the accel option with anything other than xen (e.g.
    "-machine xenfv,accel=kvm").
    
    Signed-off-by: Eduardo Habkost <ehabkost@redhat.com>
    Reviewed-by: Stefano Stabellini <stefano.stabellini@eu.citrix.com>
    Signed-off-by: Stefano Stabellini <stefano.stabellini@eu.citrix.com>

diff --git a/hw/i386/pc_piix.c b/hw/i386/pc_piix.c
index ae7bbebd0f..a91cc3dada 100644
--- a/hw/i386/pc_piix.c
+++ b/hw/i386/pc_piix.c
@@ -434,6 +434,11 @@ static void pc_xen_hvm_init(MachineState *machine)
 {
     PCIBus *bus;
 
+    if (!xen_enabled()) {
+        error_report("xenfv machine requires the xen accelerator");
+        exit(1);
+    }
+
     pc_xen_hvm_init_pci(machine);
 
     bus = pci_find_primary_bus();

