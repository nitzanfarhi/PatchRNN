commit 641d2f63cfe24539e154efa2f932937934c27dde
Author: Vegard Nossum <vegard.nossum@gmail.com>
Date:   Tue Nov 18 19:22:13 2008 +0100

    trace: introduce missing mutex_unlock()
    
    Impact: fix tracing buffer mutex leak in case of allocation failure
    
    This error was spotted by this semantic patch:
    
      http://www.emn.fr/x-info/coccinelle/mut.html
    
    It looks correct as far as I can tell. Please review.
    
    Signed-off-by: Vegard Nossum <vegard.nossum@gmail.com>
    Signed-off-by: Steven Rostedt <srostedt@redhat.com>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/kernel/trace/ring_buffer.c b/kernel/trace/ring_buffer.c
index 036456cbb4f7..f780e9552f91 100644
--- a/kernel/trace/ring_buffer.c
+++ b/kernel/trace/ring_buffer.c
@@ -617,6 +617,7 @@ int ring_buffer_resize(struct ring_buffer *buffer, unsigned long size)
 		list_del_init(&page->list);
 		free_buffer_page(page);
 	}
+	mutex_unlock(&buffer->mutex);
 	return -ENOMEM;
 }
 

