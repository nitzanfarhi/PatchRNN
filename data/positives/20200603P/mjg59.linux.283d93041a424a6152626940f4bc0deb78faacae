commit 283d93041a424a6152626940f4bc0deb78faacae
Author: Shailendra Verma <shailendra.capricorn@gmail.com>
Date:   Tue May 19 20:29:00 2015 +0530

    Staging:Android:ion - Fix for memory leak if ion device registration get failed.
    
    Fix to avoid possible memory leak if the ion device registration
    get failed.Free the allocated device creation memory before return
    in case the ion device registration get failed.
    
    Signed-off-by: Shailendra Verma <shailendra.capricorn@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/android/ion/ion.c b/drivers/staging/android/ion/ion.c
index b0b96ab31954..6f4811263557 100644
--- a/drivers/staging/android/ion/ion.c
+++ b/drivers/staging/android/ion/ion.c
@@ -1579,6 +1579,7 @@ struct ion_device *ion_device_create(long (*custom_ioctl)
 	ret = misc_register(&idev->dev);
 	if (ret) {
 		pr_err("ion: failed to register misc device.\n");
+		kfree(idev);
 		return ERR_PTR(ret);
 	}
 

