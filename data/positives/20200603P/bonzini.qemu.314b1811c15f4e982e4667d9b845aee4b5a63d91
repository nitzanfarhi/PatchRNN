commit 314b1811c15f4e982e4667d9b845aee4b5a63d91
Author: Gerd Hoffmann <kraxel@redhat.com>
Date:   Wed Mar 10 17:47:17 2010 +0100

    scsi-disk: fix buffer overflow
    
    In case s->version is shorter than 4 bytes we overflow the memcpy src
    buffer.  Fix it by clearing the target buffer, then copy only the
    amount of bytes we actually have.
    
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
    Signed-off-by: Anthony Liguori <aliguori@us.ibm.com>

diff --git a/hw/scsi-disk.c b/hw/scsi-disk.c
index 1fbd4ee1bb..77cb1daec8 100644
--- a/hw/scsi-disk.c
+++ b/hw/scsi-disk.c
@@ -460,7 +460,9 @@ static int scsi_disk_emulate_inquiry(SCSIRequest *req, uint8_t *outbuf)
         memcpy(&outbuf[16], "QEMU HARDDISK   ", 16);
     }
     memcpy(&outbuf[8], "QEMU    ", 8);
-    memcpy(&outbuf[32], s->version ? s->version : QEMU_VERSION, 4);
+    memset(&outbuf[32], 0, 4);
+    memcpy(&outbuf[32], s->version ? s->version : QEMU_VERSION,
+           MIN(4, strlen(s->version ? s->version : QEMU_VERSION)));
     /*
      * We claim conformance to SPC-3, which is required for guests
      * to ask for modern features like READ CAPACITY(16) or the

