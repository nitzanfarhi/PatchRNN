commit f9b7132175ed7b789d3c39452db3e2e216e5fc21
Author: Steve Holme <steve_holme@hotmail.com>
Date:   Tue Dec 2 21:04:23 2014 +0000

    smb: Don't try to connect with empty credentials
    
    On some platforms curl would crash if no credentials were used. As such
    added detection of such a use case to prevent this from happening.
    
    Reported-by: Gisle Vanem

diff --git a/lib/smb.c b/lib/smb.c
index 326b231c6..d990a892f 100644
--- a/lib/smb.c
+++ b/lib/smb.c
@@ -216,6 +216,10 @@ static CURLcode smb_connect(struct connectdata *conn, bool *done)
 
   (void) done;
 
+  /* Check we have a username and password to authenticate with */
+  if(!conn->bits.user_passwd)
+    return CURLE_LOGIN_DENIED;
+
   /* Initialize the connection state */
   memset(smbc, 0, sizeof(*smbc));
   smbc->state = SMB_CONNECTING;

