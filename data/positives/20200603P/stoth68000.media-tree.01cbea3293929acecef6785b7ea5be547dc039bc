commit 01cbea3293929acecef6785b7ea5be547dc039bc
Author: Axel Lin <axel.lin@gmail.com>
Date:   Tue Nov 16 16:10:41 2010 +0800

    ASoC: Fix incorrect kfree in wm8731_probe error path
    
    We allocated memory for wm8731 in wm8731_spi_probe / wm8731_i2c_probe,
    and will free the memory in either wm8731_spi_probe / wm8731_i2c_probe
    error path or wm8731_spi_remove / wm8731_i2c_remove.
    
    Thus we should not call kfree(wm8731) in wm8731_probe, otherwise
    we have double free of wm8731.
    
    Signed-off-by: Axel Lin <axel.lin@gmail.com>
    Acked-by: Liam Girdwood <lrg@slimlogic.co.uk>
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>

diff --git a/sound/soc/codecs/wm8731.c b/sound/soc/codecs/wm8731.c
index 95ade3245056..4b709589e26c 100644
--- a/sound/soc/codecs/wm8731.c
+++ b/sound/soc/codecs/wm8731.c
@@ -543,7 +543,6 @@ static int wm8731_probe(struct snd_soc_codec *codec)
 err_regulator_get:
 	regulator_bulk_free(ARRAY_SIZE(wm8731->supplies), wm8731->supplies);
 
-	kfree(wm8731);
 	return ret;
 }
 

