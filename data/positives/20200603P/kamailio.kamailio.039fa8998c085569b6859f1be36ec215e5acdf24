commit 039fa8998c085569b6859f1be36ec215e5acdf24
Author: Henning Westerholt <henning.westerholt@1und1.de>
Date:   Thu Sep 27 14:05:25 2007 +0000

    - add a missing release_data(rd)
      Found by Carsten Bock, lists at bock dot info
    - add a note about the AVP implementation
    
    
    git-svn-id: https://openser.svn.sourceforge.net/svnroot/openser/trunk@2829 689a6050-402a-0410-94f2-e92a70836424

diff --git a/modules_k/carrierroute/route_func.c b/modules_k/carrierroute/route_func.c
index 6421c7a8e..eb5d81315 100644
--- a/modules_k/carrierroute/route_func.c
+++ b/modules_k/carrierroute/route_func.c
@@ -197,6 +197,8 @@ int user_route_uri(struct sip_msg * _msg, char * _user, char * _domain) {
 	domain = (int)_domain;
 	struct rewrite_data * rd = NULL;
 	struct carrier_tree * ct = NULL;
+	// TODO it would be better to use the new introduced pv_parse and pv_print functions
+	// like in textops:append_to_reply_f and :it_list_fixup.
 	switch (hf_type->id) {
 		case REQ_URI: /* Request-URI */
 			if (get_request_uri(_msg, &uri) < 0) {
@@ -277,6 +279,7 @@ int user_route_uri(struct sip_msg * _msg, char * _user, char * _domain) {
 			} else {
 				LM_ERR("desired routing tree with id %i doesn't exist\n",
 					carrier_id);
+				release_data(rd);
 				return -1;
 			}
 		} else {

