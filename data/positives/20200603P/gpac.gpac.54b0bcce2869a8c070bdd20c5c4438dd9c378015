commit 54b0bcce2869a8c070bdd20c5c4438dd9c378015
Author: Pierre Souchay <pierre@souchay.net>
Date:   Thu Mar 8 16:10:29 2012 +0000

    Fixed wrong initialization of variables in IPV6 Code + Fixed crash in MPD
    
    git-svn-id: http://svn.code.sf.net/p/gpac/code/trunk/gpac@3955 63c20433-aa62-49bd-875c-5a186b69a8fb

diff --git a/modules/mpd_in/mpd_in.c b/modules/mpd_in/mpd_in.c
index 236748573..6b0cd63e3 100644
--- a/modules/mpd_in/mpd_in.c
+++ b/modules/mpd_in/mpd_in.c
@@ -1691,9 +1691,10 @@ restart_period:
 				}
 			}
 
-			if (e == GF_OK || group->segment_must_be_streamed) {
+			if (local_file_name && (e == GF_OK || group->segment_must_be_streamed )) {
 				gf_mx_p(mpdin->dl_mutex);
 				assert(group->nb_cached_segments<group->max_cached_segments);
+				assert( local_file_name );
 				group->cached[group->nb_cached_segments].cache = gf_strdup(local_file_name);
 				group->cached[group->nb_cached_segments].url = gf_strdup( resource_name );
 				group->cached[group->nb_cached_segments].start_range = 0;
diff --git a/src/utils/os_net.c b/src/utils/os_net.c
index 569916e1f..412a803cd 100644
--- a/src/utils/os_net.c
+++ b/src/utils/os_net.c
@@ -256,12 +256,14 @@ Bool gf_net_is_ipv6(const char *address)
 }
 
 #ifdef GPAC_HAS_IPV6
+#define MAX_PEER_NAME_LEN 1024
 static struct addrinfo *gf_sk_get_ipv6_addr(const char *PeerName, u16 PortNumber, int family, int flags, int sock_type)
 {
 	struct	addrinfo *res=NULL;
 	struct	addrinfo hints;
-	char node[50], portstring[20], *service, *dest;
-
+	char node[MAX_PEER_NAME_LEN], portstring[20];
+	char *service, *dest;
+	service = dest = NULL;
 #ifdef WIN32
 		if (!wsa_init) {
 			WSADATA Data;
@@ -281,11 +283,12 @@ static struct addrinfo *gf_sk_get_ipv6_addr(const char *PeerName, u16 PortNumber
 		service = (char *)portstring;
 	}
 	if (PeerName) {
- 		strcpy(node, PeerName);
+ 		strncpy(node, PeerName, MAX_PEER_NAME_LEN);
  		if (node[0]=='[') {
  			node[strlen(node)-1] = 0;
- 			strcpy(node, &node[1]);
+ 			strncpy(node, &node[1], MAX_PEER_NAME_LEN);
  		}
+		node[MAX_PEER_NAME_LEN - 1] = 0;
 		dest = (char *) node;
 	}
 	if (getaddrinfo((const char *)dest, (const char *)service, &hints, &res) != 0) return NULL;

