commit 0eb14647fc6b56f73efb28a72ca0c7cc03a653f9
Author: Johannes Berg <johannes@sipsolutions.net>
Date:   Thu Jul 2 15:49:03 2009 +0200

    cfg80211: reset auth algorithm
    
    When the interface is brought down, we need to
    reset the auth algorithm because wpa_supplicant
    doesn't reset it, and then we fail to use shared
    key auth when required later.
    
    Signed-off-by: Johannes Berg <johannes@sipsolutions.net>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/wireless/core.c b/net/wireless/core.c
index 413d291d07d7..5f6a8322bcb3 100644
--- a/net/wireless/core.c
+++ b/net/wireless/core.c
@@ -579,6 +579,7 @@ static int cfg80211_netdev_notifier_call(struct notifier_block * nb,
 			kfree(wdev->wext.ie);
 			wdev->wext.ie = NULL;
 			wdev->wext.ie_len = 0;
+			wdev->wext.connect.auth_type = NL80211_AUTHTYPE_AUTOMATIC;
 #endif
 			cfg80211_disconnect(rdev, dev,
 					    WLAN_REASON_DEAUTH_LEAVING, true);

