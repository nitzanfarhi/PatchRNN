commit 65e5c0262169a92bdec71a8bb9edb32dab2d8d1f
Author: Akinobu Mita <akinobu.mita@gmail.com>
Date:   Mon Feb 5 16:21:09 2007 -0800

    IB/ehca: Fix memleak on module unloading
    
    Percpu data is not freed on module unloading.
    
    Cc: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Christoph Raisch <raisch@de.ibm.com>
    Signed-off-by: Akinobu Mita <akinobu.mita@gmail.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Acked-by: Hoang-Nam Nguyen <hnguyen@de.ibm.com>
    Signed-off-by: Roland Dreier <rolandd@cisco.com>

diff --git a/drivers/infiniband/hw/ehca/ehca_irq.c b/drivers/infiniband/hw/ehca/ehca_irq.c
index c069be8cbcb2..6c4f9f91b15d 100644
--- a/drivers/infiniband/hw/ehca/ehca_irq.c
+++ b/drivers/infiniband/hw/ehca/ehca_irq.c
@@ -756,6 +756,8 @@ void ehca_destroy_comp_pool(void)
 		if (cpu_online(i))
 			destroy_comp_task(pool, i);
 	}
+	free_percpu(pool->cpu_comp_tasks);
+	kfree(pool);
 #endif
 
 	return;

