commit a52f07ecd143baee51623b063be5007585748a4f
Author: Grant Likely <grant.likely@secretlab.ca>
Date:   Fri Mar 18 10:21:29 2011 -0600

    dt: protect against NULL matches passed to of_match_node()
    
    There are a few use cases where it is convenient to pass NULL to
    of_match_node() and have it fail gracefully.  The patch adds a null
    check to the beginning so taht it does so.
    
    Signed-off-by: Grant Likely <grant.likely@secretlab.ca>

diff --git a/drivers/of/base.c b/drivers/of/base.c
index 710b53bfac6d..632ebae7f17a 100644
--- a/drivers/of/base.c
+++ b/drivers/of/base.c
@@ -496,6 +496,9 @@ EXPORT_SYMBOL(of_find_node_with_property);
 const struct of_device_id *of_match_node(const struct of_device_id *matches,
 					 const struct device_node *node)
 {
+	if (!matches)
+		return NULL;
+
 	while (matches->name[0] || matches->type[0] || matches->compatible[0]) {
 		int match = 1;
 		if (matches->name[0])

