commit 847790d5aab84df38256a6f9b4849af0eb408419
Author: Stephan Bosch <stephan.bosch@dovecot.fi>
Date:   Mon May 14 23:56:21 2018 +0200

    lmtp: Fix segfault occurring when a user turns out to be over quota at DATA transfer.
    
    The LMTP recipient context was not updated with the final recipient address when
    the RCPT command was accepted. This left a dangling struct smtp_address pointer
    which triggered the segfault when used.

diff --git a/src/lmtp/lmtp-common.c b/src/lmtp/lmtp-common.c
index b3f13dec4..39ed6c1b4 100644
--- a/src/lmtp/lmtp-common.c
+++ b/src/lmtp/lmtp-common.c
@@ -22,6 +22,7 @@ void lmtp_recipient_finish(struct lmtp_recipient *rcpt,
 {
 	trcpt->context = rcpt;
 
+	rcpt->path = trcpt->path;
 	rcpt->rcpt = trcpt;
 	rcpt->index = index;
 	rcpt->rcpt_cmd = NULL;

