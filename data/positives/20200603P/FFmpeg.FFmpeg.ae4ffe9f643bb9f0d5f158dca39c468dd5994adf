commit ae4ffe9f643bb9f0d5f158dca39c468dd5994adf
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Tue Sep 30 01:45:53 2008 +0000

    Allocate 1 line more in the chroma plane for H.264, this avoids some
    out of array reads with mmx/sse2 code.
    Fixes issue327.
    
    Originally committed as revision 15467 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index 66122a5c9f..cf40681759 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -170,6 +170,8 @@ void avcodec_align_dimensions(AVCodecContext *s, int *width, int *height){
 
     *width = ALIGN(*width , w_align);
     *height= ALIGN(*height, h_align);
+    if(s->codec_id == CODEC_ID_H264)
+        *height+=2; // some of the optimized chroma MC reads one line too much
 }
 
 int avcodec_check_dimensions(void *av_log_ctx, unsigned int w, unsigned int h){

