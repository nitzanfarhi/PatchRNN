commit 57b8bc4492334b189158803a338c88c21a429200
Author: Alan T. DeKok <aland@freeradius.org>
Date:   Mon Oct 17 16:40:50 2011 +0200

    Hack to work around race condition
    
    We may give up on a proxied packet (and set proxy_listener = NULL)
    just as we're receiving a duplicate packet from the NAS.  In that
    case, we catch it, and do nothing

diff --git a/src/main/process.c b/src/main/process.c
index fa199d8d4..d70119c15 100644
--- a/src/main/process.c
+++ b/src/main/process.c
@@ -2688,6 +2688,8 @@ static void request_proxied(REQUEST *request, int action)
 
 	switch (action) {
 	case FR_ACTION_DUP:
+		if (!request->proxy_listener) return;
+
 		if ((home->state == HOME_STATE_IS_DEAD) ||
 		    (request->proxy_listener->status != RAD_LISTEN_STATUS_KNOWN)) {
 			request_proxy_anew(request);

