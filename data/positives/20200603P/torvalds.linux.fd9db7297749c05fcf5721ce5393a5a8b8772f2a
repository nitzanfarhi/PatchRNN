commit fd9db7297749c05fcf5721ce5393a5a8b8772f2a
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Tue Apr 28 16:56:35 2009 +0200

    fuse: destroy bdi on error
    
    Destroy bdi on error in fuse_fill_super().
    
    This was an omission from commit 26c3679101dbccc054dcf370143941844ba70531
    "fuse: destroy bdi on umount", which moved the bdi_destroy() call from
    fuse_conn_put() to fuse_put_super().
    
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
    CC: stable@kernel.org

diff --git a/fs/fuse/inode.c b/fs/fuse/inode.c
index 459b73dd45e1..75ca5ac603ae 100644
--- a/fs/fuse/inode.c
+++ b/fs/fuse/inode.c
@@ -908,6 +908,7 @@ static int fuse_fill_super(struct super_block *sb, void *data, int silent)
  err_put_root:
 	dput(root_dentry);
  err_put_conn:
+	bdi_destroy(&fc->bdi);
 	fuse_conn_put(fc);
  err_fput:
 	fput(file);

