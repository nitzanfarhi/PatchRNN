commit 72df9264074154a2bdc403193b2a188f3a780058
Author: Danny Auble <da@llnl.gov>
Date:   Thu May 11 23:23:16 2006 +0000

    small memory leaks in the bluegene plugin

diff --git a/src/plugins/select/bluegene/block_allocator/block_allocator.c b/src/plugins/select/bluegene/block_allocator/block_allocator.c
index d2d8326aad..49b4d2c797 100644
--- a/src/plugins/select/bluegene/block_allocator/block_allocator.c
+++ b/src/plugins/select/bluegene/block_allocator/block_allocator.c
@@ -1595,7 +1595,7 @@ static int _append_geo(int *geometry, List geos, int rotate)
 	int *geo = NULL;
 	int temp_geo;
 	int i, j;
-	geo = xmalloc(sizeof(int)*BA_SYSTEM_DIMENSIONS);
+	
 	if(rotate) {
 		for (i = (BA_SYSTEM_DIMENSIONS - 1); i >= 0; i--) {
 			for (j = 1; j <= i; j++) {
@@ -1618,6 +1618,7 @@ static int _append_geo(int *geometry, List geos, int rotate)
 	list_iterator_destroy(itr);
 	
 	if(geo_ptr == NULL) { 
+		geo = xmalloc(sizeof(int)*BA_SYSTEM_DIMENSIONS);
 		geo[X] = geometry[X];
 		geo[Y] = geometry[Y];
 		geo[Z] = geometry[Z];
diff --git a/src/plugins/select/bluegene/plugin/bluegene.c b/src/plugins/select/bluegene/plugin/bluegene.c
index 665b5a5320..c38351512e 100644
--- a/src/plugins/select/bluegene/plugin/bluegene.c
+++ b/src/plugins/select/bluegene/plugin/bluegene.c
@@ -1057,6 +1057,8 @@ extern int create_dynamic_block(ba_request_t *request, List my_block_list)
 						list_iterator_destroy(itr);
 						slurm_mutex_unlock(
 							&block_state_mutex);
+						if(my_bitmap)
+							bit_free(my_bitmap);
 						return SLURM_ERROR;
 					}
 				} 
@@ -1072,6 +1074,8 @@ extern int create_dynamic_block(ba_request_t *request, List my_block_list)
 					list_iterator_destroy(itr);
 					slurm_mutex_unlock(
 						&block_state_mutex);
+					if(my_bitmap)
+						bit_free(my_bitmap);
 					return SLURM_ERROR;
 				}
 				xfree(name);

