commit d984abc97e400d68a09729b80060fe0ec591eb16
Author: Pete Zaitcev <zaitcev@redhat.com>
Date:   Fri May 11 22:00:29 2007 -0700

    USB: Deref URB after usbmon is done with it
    
    I haven't personally run across an oops because of this, but I feel safer
    with this fix in place.
    
    Signed-off-by: Pete Zaitcev <zaitcev@redhat.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/usb/core/hcd.c b/drivers/usb/core/hcd.c
index 9ad2970a095d..e277258df382 100644
--- a/drivers/usb/core/hcd.c
+++ b/drivers/usb/core/hcd.c
@@ -1018,8 +1018,8 @@ done:
 		atomic_dec (&urb->use_count);
 		if (urb->reject)
 			wake_up (&usb_kill_urb_queue);
-		usb_put_urb (urb);
 		usbmon_urb_submit_error(&hcd->self, urb, status);
+		usb_put_urb (urb);
 	}
 	return status;
 }

