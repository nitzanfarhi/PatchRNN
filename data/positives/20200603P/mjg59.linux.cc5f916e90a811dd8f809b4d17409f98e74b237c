commit cc5f916e90a811dd8f809b4d17409f98e74b237c
Author: Rafael J. Wysocki <rjw@sisk.pl>
Date:   Mon Oct 29 14:37:12 2007 -0700

    Freezer: do not allow freezing processes to clear TIF_SIGPENDING
    
    Do not allow processes to clear their TIF_SIGPENDING if TIF_FREEZE is set,
    so that they will not race with the freezer (like mysqld does, for example).
    
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Acked-by: Nigel Cunningham <nigel@suspend2.net>
    Acked-by: Pavel Machek <pavel@ucw.cz>
    Cc: Oleg Nesterov <oleg@tv-sign.ru>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/kernel/signal.c b/kernel/signal.c
index 4537bdda1ebf..909a0cc6bc70 100644
--- a/kernel/signal.c
+++ b/kernel/signal.c
@@ -124,7 +124,7 @@ void recalc_sigpending_and_wake(struct task_struct *t)
 
 void recalc_sigpending(void)
 {
-	if (!recalc_sigpending_tsk(current))
+	if (!recalc_sigpending_tsk(current) && !freezing(current))
 		clear_thread_flag(TIF_SIGPENDING);
 
 }

