commit 3a1418872569c27332be0c4ea116c95a5159c605
Author: Antony Dovgal <tony2001@php.net>
Date:   Tue Dec 20 09:48:24 2005 +0000

    MFB: fix #35740 (memory leak when including a directory)

diff --git a/main/streams/streams.c b/main/streams/streams.c
index 4ac17dcc7f..c9430fe73c 100755
--- a/main/streams/streams.c
+++ b/main/streams/streams.c
@@ -2485,6 +2485,10 @@ PHPAPI php_stream *_php_stream_open_wrapper_ex(char *path, char *mode, int optio
 
 	if (stream == NULL && (options & REPORT_ERRORS)) {
 		php_stream_display_wrapper_errors(wrapper, path, "failed to open stream" TSRMLS_CC);
+		if (opened_path && *opened_path) {
+			efree(*opened_path);
+			*opened_path = NULL;
+		}
 	}
 	php_stream_tidy_wrapper_error_log(wrapper TSRMLS_CC);
 #if ZEND_DEBUG

