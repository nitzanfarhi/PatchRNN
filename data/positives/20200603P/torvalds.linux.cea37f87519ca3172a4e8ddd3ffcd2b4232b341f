commit cea37f87519ca3172a4e8ddd3ffcd2b4232b341f
Author: Daeseok Youn <daeseok.youn@gmail.com>
Date:   Tue Apr 1 19:15:59 2014 +0900

    xen: fix memory leak in __xen_pcibk_add_pci_dev()
    
    It need to free dev_entry when it failed to assign to a new
    slot on the virtual PCI bus.
    
    smatch says:
     drivers/xen/xen-pciback/vpci.c:142 __xen_pcibk_add_pci_dev() warn:
    possible memory leak of 'dev_entry'
    
    Signed-off-by: Daeseok Youn <daeseok.youn@gmail.com>
    Signed-off-by: David Vrabel <david.vrabel@citrix.com>

diff --git a/drivers/xen/xen-pciback/vpci.c b/drivers/xen/xen-pciback/vpci.c
index 3165ce361b00..51afff96c515 100644
--- a/drivers/xen/xen-pciback/vpci.c
+++ b/drivers/xen/xen-pciback/vpci.c
@@ -137,6 +137,8 @@ static int __xen_pcibk_add_pci_dev(struct xen_pcibk_device *pdev,
 	/* Publish this device. */
 	if (!err)
 		err = publish_cb(pdev, 0, 0, PCI_DEVFN(slot, func), devid);
+	else
+		kfree(dev_entry);
 
 out:
 	return err;

