commit 6442185ab674cc202d63c18605057b9a51ca2722
Author: Lennart Poettering <lennart@poettering.net>
Date:   Thu Apr 30 19:44:10 2015 +0200

    util: be a bit safer in path_is_safe()
    
    We should be more strict when verifying paths with path_is_safe() for
    potentially dangerous constructs, and that includes lengths of
    PATH_MAX-1 and larger. Be more accurate here.

diff --git a/src/shared/util.c b/src/shared/util.c
index 2c7254eed..d9bd34b3b 100644
--- a/src/shared/util.c
+++ b/src/shared/util.c
@@ -3917,7 +3917,7 @@ bool path_is_safe(const char *p) {
         if (streq(p, "..") || startswith(p, "../") || endswith(p, "/..") || strstr(p, "/../"))
                 return false;
 
-        if (strlen(p) > PATH_MAX)
+        if (strlen(p)+1 > PATH_MAX)
                 return false;
 
         /* The following two checks are not really dangerous, but hey, they still are confusing */

