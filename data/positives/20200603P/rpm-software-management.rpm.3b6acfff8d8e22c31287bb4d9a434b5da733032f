commit 3b6acfff8d8e22c31287bb4d9a434b5da733032f
Author: Panu Matilainen <pmatilai@redhat.com>
Date:   Thu Jun 28 14:44:48 2007 +0300

    Remember to free up match iterators (rhbz#246044)

diff --git a/lib/query.c b/lib/query.c
index 2a6d4ff88..fde74fa16 100644
--- a/lib/query.c
+++ b/lib/query.c
@@ -680,10 +680,12 @@ int rpmQueryVerify(QVA_t qva, rpmts ts, const char * arg)
     case RPMQV_PACKAGE:
     {
 	int matches = 0;
-	qva->qva_mi = rpmtsInitIterator(ts, RPMDBI_LABEL, arg, 0);
-	while (rpmdbNextIterator(qva->qva_mi) != NULL) {
+	rpmdbMatchIterator mi;
+	mi = rpmtsInitIterator(ts, RPMDBI_LABEL, arg, 0);
+	while (rpmdbNextIterator(mi) != NULL) {
 	    matches++;
 	}
+	rpmdbFreeIterator(mi);
 	if (! matches) {
 	    rpmError(RPMERR_QUERYINFO, _("package %s is not installed\n"), arg);
 	    res = 1;

