commit ef12ec23fa03e520bffef34ec2eba2ac0572fb27
Author: Reimar DÃ¶ffinger <Reimar.Doeffinger@gmx.de>
Date:   Thu Apr 9 14:16:22 2009 +0000

    Fix memleak in nuv demuxer: free packet already allocated packet when
    returning an error in nuv_packet.
    
    Originally committed as revision 18385 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavformat/nuv.c b/libavformat/nuv.c
index a6e8e013f..2f055b5f0 100644
--- a/libavformat/nuv.c
+++ b/libavformat/nuv.c
@@ -226,7 +226,10 @@ static int nuv_packet(AVFormatContext *s, AVPacket *pkt) {
                 pkt->stream_index = ctx->v_id;
                 memcpy(pkt->data, hdr, copyhdrsize);
                 ret = get_buffer(pb, pkt->data + copyhdrsize, size);
-                if (ret < 0) return ret;
+                if (ret < 0) {
+                    av_free_packet(pkt);
+                    return ret;
+                }
                 if (ret < size)
                     av_shrink_packet(pkt, copyhdrsize + ret);
                 return 0;

