commit bc38e83793be5f7a184c88be55e556453a25224b
Author: Laurent Aimar <fenrir@videolan.org>
Date:   Sat Oct 8 23:40:41 2011 +0200

    mpegts: do not return from ff_mpegts_parse_packet() after having seen the first PMT
    
    It prevents leaving the AVPacket uninitialized.
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavformat/mpegts.c b/libavformat/mpegts.c
index 1d26c6c438..ea4c535e24 100644
--- a/libavformat/mpegts.c
+++ b/libavformat/mpegts.c
@@ -1894,10 +1894,8 @@ int ff_mpegts_parse_packet(MpegTSContext *ts, AVPacket *pkt,
 
     len1 = len;
     ts->pkt = pkt;
-    ts->stop_parse = 0;
     for(;;) {
-        if (ts->stop_parse>0)
-            break;
+        ts->stop_parse = 0;
         if (len < TS_PACKET_SIZE)
             return -1;
         if (buf[0] != 0x47) {
@@ -1907,6 +1905,8 @@ int ff_mpegts_parse_packet(MpegTSContext *ts, AVPacket *pkt,
             handle_packet(ts, buf);
             buf += TS_PACKET_SIZE;
             len -= TS_PACKET_SIZE;
+            if (ts->stop_parse == 1)
+                break;
         }
     }
     return len1 - len;

