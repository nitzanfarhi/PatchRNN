commit e81dcfb13e814d434f0e49938292b264bb0dbd83
Author: Thomas Klausner <wiz@danbala.tuwien.ac.at>
Date:   Tue Oct 5 17:54:07 1999 +0000

    One more fix for closing files
    
    --HG--
    branch : HEAD

diff --git a/lib/zip_close.c b/lib/zip_close.c
index d9ecd46..a9245d6 100644
--- a/lib/zip_close.c
+++ b/lib/zip_close.c
@@ -173,8 +173,10 @@ zip_close(struct zip *zf)
     
     if (fclose(tzf->zp)==0) {
 	tzf->zp = NULL;
-	fclose(zf->zp);
-	zf->zp = NULL;
+	if (zf->zp) {
+	    fclose(zf->zp);
+	    zf->zp = NULL;
+	}
 	if (rename(tzf->zn, zf->zn) != 0) {
 	    zip_err = ZERR_RENAME;
 	    _zip_free(tzf);

