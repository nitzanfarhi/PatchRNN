commit fd3cba3f735e4106450ba9f59d042136ff9f7570
Author: Rob Richards <rrichards@php.net>
Date:   Mon May 14 11:54:58 2007 +0000

    MFB: free wholetext properly

diff --git a/ext/dom/text.c b/ext/dom/text.c
index f420271a92..43309ae9f7 100644
--- a/ext/dom/text.c
+++ b/ext/dom/text.c
@@ -110,12 +110,11 @@ int dom_text_whole_text_read(dom_object *obj, zval **retval TSRMLS_DC)
 	ALLOC_ZVAL(*retval);
 	if (wholetext != NULL) {
 		ZVAL_XML_STRING(*retval, wholetext, ZSTR_DUPLICATE);
+		xmlFree(wholetext);
 	} else {
 		ZVAL_EMPTY_STRING(*retval);
 	}
 
-	xmlFree(wholetext);
-
 	return SUCCESS;
 }
 

