commit c0905047b4bc6c93f3970834b53922e2f128f87d
Author: Tomasz Åšniatowski <kailoran@gmail.com>
Date:   Sat Apr 12 20:11:03 2008 +0100

    add null checks for two more unchecked calls to localtime(), just in case

diff --git a/src/generate_report.cpp b/src/generate_report.cpp
index fc7d52b698..7071e7437f 100644
--- a/src/generate_report.cpp
+++ b/src/generate_report.cpp
@@ -546,10 +546,14 @@ Units cannot be killed by poison alone. The poison will not reduce it below 1 HP
 	case REPORT_CLOCK: {
 		time_t t = time(NULL);
 		struct tm *lt=localtime(&t);
-		char temp[10];
-		size_t s = strftime(temp,10,preferences::clock_format().c_str(),lt);
-		if(s>0) {
-			return report(temp);
+		if (lt) {
+			char temp[10];
+			size_t s = strftime(temp,10,preferences::clock_format().c_str(),lt);
+			if(s>0) {
+				return report(temp);
+			} else {
+				return report();
+			}
 		} else {
 			return report();
 		}
diff --git a/src/log.cpp b/src/log.cpp
index a599d80939..25a8cea0c5 100644
--- a/src/log.cpp
+++ b/src/log.cpp
@@ -94,8 +94,11 @@ std::string list_logdomains()
 }
 
 std::string get_timestamp(const time_t& t, const std::string& format) {
-	char buf[100];
-	strftime(buf, 100, format.c_str(), localtime(&t));
+	char buf[100] = {0};
+	tm* lt = localtime(&t);
+	if (lt) {
+		strftime(buf, 100, format.c_str(), lt);
+	}
 	return buf;
 }
 

