commit d2f6650a950dadd20667a04a9dc785f240d43695
Author: Thomas Renninger <trenn@suse.de>
Date:   Fri Jan 29 17:48:51 2010 +0100

    ACPI: Add NULL pointer check in acpi_bus_start
    
    If acpi_bus_add does not return a device and it's passed
    to acpi_bus_start, bad things will happen:
    
    BUG: unable to handle kernel NULL pointer dereference at 0000000000000008
    IP: [<ffffffff8128402d>] acpi_bus_start+0x14/0x24
    ...
    [<ffffffffa008977a>] acpiphp_bus_add+0xba/0x130 [acpiphp]
    [<ffffffffa008aa72>] enable_device+0x132/0x2ff [acpiphp]
    [<ffffffffa0089b68>] acpiphp_enable_slot+0xb8/0x130 [acpiphp]
    [<ffffffffa0089df7>] handle_hotplug_event_func+0x87/0x190 [acpiphp]
    
    Next patch would make this NULL pointer check obsolete, but
    better having one more than one missing...
    
    Signed-off-by: Thomas Renninger <trenn@suse.de>
    Acked-by: Bjorn Helgaas <bjorn.helgaas@hp.com>
    CC: stable@kernel.org
    Signed-off-by: Len Brown <len.brown@intel.com>

diff --git a/drivers/acpi/scan.c b/drivers/acpi/scan.c
index ff9f6226085d..8044583f3034 100644
--- a/drivers/acpi/scan.c
+++ b/drivers/acpi/scan.c
@@ -1357,6 +1357,9 @@ int acpi_bus_start(struct acpi_device *device)
 {
 	struct acpi_bus_ops ops;
 
+	if (!device)
+		return -EINVAL;
+
 	memset(&ops, 0, sizeof(ops));
 	ops.acpi_op_start = 1;
 

