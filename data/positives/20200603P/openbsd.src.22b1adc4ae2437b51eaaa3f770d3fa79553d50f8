commit 22b1adc4ae2437b51eaaa3f770d3fa79553d50f8
Author: oga <oga@openbsd.org>
Date:   Fri Jan 8 13:27:59 2010 +0000

    Don't leak memory after strdup() in makedirs().
    
    From Igor Zinovik; thanks!
    
    ok stsp@, millert@

diff --git a/usr.bin/patch/util.c b/usr.bin/patch/util.c
index 8c3f888ae66..b27b57b62c3 100644
--- a/usr.bin/patch/util.c
+++ b/usr.bin/patch/util.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: util.c,v 1.33 2009/10/27 23:59:41 deraadt Exp $	*/
+/*	$OpenBSD: util.c,v 1.34 2010/01/08 13:27:59 oga Exp $	*/
 
 /*
  * patch - a program to apply diffs to original files
@@ -310,8 +310,10 @@ makedirs(const char *filename, bool striplast)
 
 	if (striplast) {
 		char	*s = strrchr(tmpbuf, '/');
-		if (s == NULL)
+		if (s == NULL) {
+			free(tmpbuf);
 			return;	/* nothing to be done */
+		}
 		*s = '\0';
 	}
 	if (mkpath(tmpbuf) != 0)

