commit e6436be21e77e3659b4ff7e357ab5a8342d132d2
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Tue Apr 26 13:47:08 2016 +0200

    mac80211: fix statistics leak if dev_alloc_name() fails
    
    In the case that dev_alloc_name() fails, e.g. because the name was
    given by the user and already exists, we need to clean up properly
    and free the per-CPU statistics. Fix that.
    
    Cc: stable@vger.kernel.org
    Fixes: 5a490510ba5f ("mac80211: use per-CPU TX/RX statistics")
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/mac80211/iface.c b/net/mac80211/iface.c
index 453b4e741780..e1cb22c16530 100644
--- a/net/mac80211/iface.c
+++ b/net/mac80211/iface.c
@@ -1761,7 +1761,7 @@ int ieee80211_if_add(struct ieee80211_local *local, const char *name,
 
 		ret = dev_alloc_name(ndev, ndev->name);
 		if (ret < 0) {
-			free_netdev(ndev);
+			ieee80211_if_free(ndev);
 			return ret;
 		}
 
@@ -1847,7 +1847,7 @@ int ieee80211_if_add(struct ieee80211_local *local, const char *name,
 
 		ret = register_netdevice(ndev);
 		if (ret) {
-			free_netdev(ndev);
+			ieee80211_if_free(ndev);
 			return ret;
 		}
 	}

