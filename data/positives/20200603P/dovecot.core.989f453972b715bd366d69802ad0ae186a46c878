commit 989f453972b715bd366d69802ad0ae186a46c878
Author: Timo Sirainen <tss@iki.fi>
Date:   Wed Oct 28 14:10:55 2009 -0400

    data stack: Fixes to handling out-of-memory situations.
    
    --HG--
    branch : HEAD

diff --git a/src/lib/data-stack.c b/src/lib/data-stack.c
index fe5977ee7..092f0f881 100644
--- a/src/lib/data-stack.c
+++ b/src/lib/data-stack.c
@@ -69,7 +69,7 @@ static bool outofmem = FALSE;
 
 static union {
 	struct stack_block block;
-	unsigned char data[128];
+	unsigned char data[512];
 } outofmem_area;
 
 static void data_stack_last_buffer_reset(bool preserve_data ATTR_UNUSED)
@@ -169,7 +169,8 @@ static void free_blocks(struct stack_block *block)
 			unused_block = block;
 		} else {
 #ifndef USE_GC
-			free(block);
+			if (block != &outofmem_area.block)
+				free(block);
 #endif
 		}
 

