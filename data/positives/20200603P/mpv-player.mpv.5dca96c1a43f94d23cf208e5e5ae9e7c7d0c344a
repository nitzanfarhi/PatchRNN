commit 5dca96c1a43f94d23cf208e5e5ae9e7c7d0c344a
Author: wm4 <wm4@nowhere>
Date:   Thu Nov 21 16:08:09 2013 +0100

    stream_lavf: fix a small memory leak
    
    Also add an explanation why this special code path for rtsp is needed.

diff --git a/stream/stream_lavf.c b/stream/stream_lavf.c
index a3c803d70a..1adf8177e4 100644
--- a/stream/stream_lavf.c
+++ b/stream/stream_lavf.c
@@ -157,11 +157,15 @@ static int open_f(stream_t *stream, int mode)
             filename += strlen(prefix[i]);
     if (!strncmp(filename, "rtsp:", 5)) {
         /* This is handled as a special demuxer, without a separate
-         * stream layer. demux_lavf will do all the real work.
+         * stream layer. demux_lavf will do all the real work. Note
+         * that libavformat doesn't even provide a protocol entry for
+         * this (the rtsp demuxer's probe function checks for a "rtsp:"
+         * filename prefix), so it has to be handled specially here.
          */
         stream->seek = NULL;
         stream->demuxer = "lavf";
         stream->lavf_type = "rtsp";
+        talloc_free(temp);
         return STREAM_OK;
     }
     mp_msg(MSGT_OPEN, MSGL_V, "[ffmpeg] Opening %s\n", filename);

