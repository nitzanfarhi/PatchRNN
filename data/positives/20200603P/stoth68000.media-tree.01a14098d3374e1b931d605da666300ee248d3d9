commit 01a14098d3374e1b931d605da666300ee248d3d9
Author: Matthew Finlay <matt@mellanox.com>
Date:   Fri Apr 29 01:36:31 2016 +0300

    net/mlx5e: Call vxlan_get_rx_port() with rtnl lock
    
    Hold the rtnl lock when calling vxlan_get_rx_port().
    
    Fixes: b7aade15485a ("vxlan: break dependency with netdev drivers")
    Signed-off-by: Matthew Finlay <matt@mellanox.com>
    Reported-by: Alexander Duyck <alexander.duyck@gmail.com>
    Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
index 8b0bd42a9762..48825cb69e7e 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_main.c
@@ -2938,8 +2938,11 @@ static void *mlx5e_create_netdev(struct mlx5_core_dev *mdev)
 		goto err_tc_cleanup;
 	}
 
-	if (mlx5e_vxlan_allowed(mdev))
+	if (mlx5e_vxlan_allowed(mdev)) {
+		rtnl_lock();
 		vxlan_get_rx_port(netdev);
+		rtnl_unlock();
+	}
 
 	mlx5e_enable_async_events(priv);
 	schedule_work(&priv->set_rx_mode_work);

