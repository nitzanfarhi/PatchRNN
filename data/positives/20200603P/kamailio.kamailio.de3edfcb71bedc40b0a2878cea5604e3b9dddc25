commit de3edfcb71bedc40b0a2878cea5604e3b9dddc25
Author: Andrei Pelinescu-Onciul <andrei@iptel.org>
Date:   Wed Apr 23 18:29:39 2008 +0000

    - fix: memory leak in subst_user (missing pkg_free(result->s)). Thanks go to
      the anonymous reporter of SER-374.
      Closes SER-374.

diff --git a/modules_s/textops/textops.c b/modules_s/textops/textops.c
index e0a204766..4da3adddc 100644
--- a/modules_s/textops/textops.c
+++ b/modules_s/textops/textops.c
@@ -566,6 +566,7 @@ static int subst_user_f(struct sip_msg* msg, char*  subst, char* ignored)
 	act.val[0].u.string = result->s;
 	init_run_actions_ctx(&ra_ctx);
 	rval = do_action(&ra_ctx, &act, msg);
+	if (result->s) pkg_free(result->s); /* SET_USER_T doesn't consume s */
 	pkg_free(result);
 	return rval;
 }

