commit 25a64ec0e1fb68f4c1f4c4c642b00dfa6105f8ec
Author: Shawn Webb <swebb@sourcefire.com>
Date:   Tue Apr 15 10:27:34 2014 -0400

    Check for NULL allocation

diff --git a/libclamav/fmap.c b/libclamav/fmap.c
index 29082f9a6..4954f76ab 100644
--- a/libclamav/fmap.c
+++ b/libclamav/fmap.c
@@ -255,6 +255,10 @@ extern cl_fmap_t *cl_fmap_open_handle(void *handle, size_t offset, size_t len,
 #endif /* ANONYMOUS_MAP */
     if (!use_aging) {
 	m = (fmap_t *)cli_malloc(mapsz);
+    if (!(m)) {
+        cli_warnmsg("fmap: map allocation failed\n");
+        return NULL;
+    }
 	memset(m, 0, hdrsz);
     }
     if(!m) {

