commit 31bd8fbb41b1fdf61f80e3e506574b43fad5e478
Author: Libo Chen <clbchenlibo.chen@huawei.com>
Date:   Wed Jul 3 15:01:11 2013 -0700

    drivers/cdrom/gdrom.c: fix device number leak
    
    Without this patch, gdrom_major will leak when gd.cd_info alloc fails.
    
    Signed-off-by: Libo Chen <libo.chen@huawei.com>
    Cc: Jens Axboe <axboe@kernel.dk>
    Acked-by: Tejun Heo <tj@kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/cdrom/gdrom.c b/drivers/cdrom/gdrom.c
index 4afcb65cc623..5980cb9af857 100644
--- a/drivers/cdrom/gdrom.c
+++ b/drivers/cdrom/gdrom.c
@@ -830,9 +830,9 @@ probe_fail_cdrom_register:
 	del_gendisk(gd.disk);
 probe_fail_no_disk:
 	kfree(gd.cd_info);
+probe_fail_no_mem:
 	unregister_blkdev(gdrom_major, GDROM_DEV_NAME);
 	gdrom_major = 0;
-probe_fail_no_mem:
 	pr_warning("Probe failed - error is 0x%X\n", err);
 	return err;
 }

