commit 90544a10eea4d9ea30b7c175de256e3003f474f4
Author: Uwe Steinmann <steinm@php.net>
Date:   Wed Oct 24 08:31:54 2001 +0000

    - freeing memory wasn't always done right

diff --git a/ext/hyperwave/hg_comm.c b/ext/hyperwave/hg_comm.c
index ff8913d339..22dfb927cb 100644
--- a/ext/hyperwave/hg_comm.c
+++ b/ext/hyperwave/hg_comm.c
@@ -599,11 +599,12 @@ DLIST *fnCreateAnchorList(hw_objectID objID, char **anchors, char **docofanchorr
 		
 				}
 		
-				efree(anchors[i]);
-				if(docofanchorrec[i]) efree(docofanchorrec[i]);
-				if(reldestrec)
-					if(reldestrec[i]) efree(reldestrec[i]);
 			}
+			/* free memory even if it is an invisible anchor */
+			efree(anchors[i]);
+			if(docofanchorrec[i]) efree(docofanchorrec[i]);
+			if(reldestrec)
+				if(reldestrec[i]) efree(reldestrec[i]);
 		}
 	}
 	return pAnchorList;
@@ -802,7 +803,8 @@ char *fnInsAnchorsIntoText(char *text, DLIST *pAnchorList, char **bodytag, char
 	}
 	snprintf(istr, BUFFERLEN, "<BODY %s>", bgstr);
 	*bodytag = estrdup(istr);
-	if(scriptname != urlprefix) efree(scriptname);
+//	if(scriptname != urlprefix) efree(scriptname);
+	if(scriptname != NULL) efree(scriptname);
 	return(newtext);
 }
 #undef BUFFERLEN
@@ -2221,7 +2223,6 @@ int send_insertanchors(char **text, int *count, char **anchors, char **destrec,
 #endif
 		*bodytag = strdup(body);
 		if(body) efree(body);
-fprintf(stderr, "bodytag = %s\n", *bodytag);
 		*text = newtext;
 		*count = strlen(newtext);
 	}

