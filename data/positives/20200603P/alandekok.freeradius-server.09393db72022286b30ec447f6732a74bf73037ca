commit 09393db72022286b30ec447f6732a74bf73037ca
Author: aland <aland>
Date:   Tue May 15 10:17:23 2007 +0000

            Port fix for Coverity bug #25 from 1.1.x

diff --git a/src/modules/rlm_passwd/rlm_passwd.c b/src/modules/rlm_passwd/rlm_passwd.c
index c2ed184d4..c30c13701 100644
--- a/src/modules/rlm_passwd/rlm_passwd.c
+++ b/src/modules/rlm_passwd/rlm_passwd.c
@@ -430,20 +430,24 @@ static int passwd_instantiate(CONF_SECTION *conf, void **instance)
 	}while(*s);
 	if(keyfield < 0) {
 		radlog(L_ERR, "rlm_passwd: no field market as key in format: %s", inst->format);
+		free(lf);
 		return -1;
 	}
 	if (! (inst->ht = build_hash_table (inst->filename, nfields, keyfield, listable, inst->hashsize, inst->ignorenislike, *inst->delimiter)) ){
 		radlog(L_ERR, "rlm_passwd: can't build hashtable from passwd file");
+		free(lf);
 		return -1;
 	}
 	if (! (inst->pwdfmt = mypasswd_malloc(inst->format, nfields, &len)) ){
 		radlog(L_ERR, "rlm_passwd: memory allocation failed");
 		release_ht(inst->ht);
+		free(lf);
 		return -1;
 	}
 	if (!string_to_entry(inst->format, nfields, ':', inst->pwdfmt , len)) {
 		radlog(L_ERR, "rlm_passwd: unable to convert format entry");
 		release_ht(inst->ht);
+		free(lf);
 		return -1;
 	}
 

