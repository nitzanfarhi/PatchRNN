commit bfdef55e14ade87589bd10a6a1dafce53427ecf4
Author: Timo Sirainen <tss@iki.fi>
Date:   Tue Jan 8 05:37:43 2013 +0200

    DEBUG: buffer_verify_pool() crashed with empty buffer.

diff --git a/src/lib/buffer.c b/src/lib/buffer.c
index 1e30d5d35..e056da9e8 100644
--- a/src/lib/buffer.c
+++ b/src/lib/buffer.c
@@ -320,7 +320,7 @@ void buffer_verify_pool(buffer_t *_buf)
 	const struct real_buffer *buf = (const struct real_buffer *)_buf;
 	void *ret;
 
-	if (buf->pool != NULL && buf->pool->datastack_pool) {
+	if (buf->pool != NULL && buf->pool->datastack_pool && buf->alloc > 0) {
 		/* this doesn't really do anything except verify the
 		   stack frame */
 		ret = p_realloc(buf->pool, buf->w_buffer,

