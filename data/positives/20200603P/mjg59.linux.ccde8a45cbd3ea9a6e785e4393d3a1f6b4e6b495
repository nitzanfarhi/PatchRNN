commit ccde8a45cbd3ea9a6e785e4393d3a1f6b4e6b495
Author: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Date:   Fri Jan 6 12:58:16 2012 +0100

    wireless: b43: fix Oops on card eject during transfer
    
    An Oops has once been observed, when the SDIO card had been ejected during
    IO. The PC value shows, that the dev pointer in b43_op_stop() was NULL.
    
    (I moved the NULL check before the lock, based upon a suggestion from
    Julian Calaby <julian.calaby@gmail.com>. -- JWL)
    
    Signed-off-by: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/b43/main.c b/drivers/net/wireless/b43/main.c
index 1c6f19393efa..b91f28ef1032 100644
--- a/drivers/net/wireless/b43/main.c
+++ b/drivers/net/wireless/b43/main.c
@@ -4852,6 +4852,9 @@ static void b43_op_stop(struct ieee80211_hw *hw)
 
 	cancel_work_sync(&(wl->beacon_update_trigger));
 
+	if (!dev)
+		goto out;
+
 	mutex_lock(&wl->mutex);
 	if (b43_status(dev) >= B43_STAT_STARTED) {
 		dev = b43_wireless_core_stop(dev);
@@ -4863,7 +4866,7 @@ static void b43_op_stop(struct ieee80211_hw *hw)
 
 out_unlock:
 	mutex_unlock(&wl->mutex);
-
+out:
 	cancel_work_sync(&(wl->txpower_adjust_work));
 }
 

