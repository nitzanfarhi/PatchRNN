commit d1c627b59c8e69d40b94a4ff28a582a84c6a95a3
Author: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Date:   Thu Oct 1 15:44:32 2009 -0700

    spi-imx: initialize complete config struct
    
    Otherwise the config function uses random data from the stack.  This
    didn't stick out because config is called once more in the chipselect
    function with correct parameters.
    
    Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Acked-by: Sascha Hauer <s.hauer@pengutronix.de>
    Cc: David Brownell <dbrownell@users.sourceforge.net>
    Cc: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/spi/spi_imx.c b/drivers/spi/spi_imx.c
index b6a8149220fb..2fec1170b6c0 100644
--- a/drivers/spi/spi_imx.c
+++ b/drivers/spi/spi_imx.c
@@ -442,6 +442,7 @@ static int spi_imx_setupxfer(struct spi_device *spi,
 	config.bpw = t ? t->bits_per_word : spi->bits_per_word;
 	config.speed_hz  = t ? t->speed_hz : spi->max_speed_hz;
 	config.mode = spi->mode;
+	config.cs = spi_imx->chipselect[spi->chip_select];
 
 	if (!config.speed_hz)
 		config.speed_hz = spi->max_speed_hz;

