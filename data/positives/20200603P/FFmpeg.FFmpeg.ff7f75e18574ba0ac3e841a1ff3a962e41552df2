commit ff7f75e18574ba0ac3e841a1ff3a962e41552df2
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Sun Nov 30 23:51:02 2008 +0000

    Fix segfault due to deallocated entries in delayed_pic after size change.
    Fixes issue714.
    
    Originally committed as revision 15965 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavcodec/h264.c b/libavcodec/h264.c
index e31500f15f..84875962a4 100644
--- a/libavcodec/h264.c
+++ b/libavcodec/h264.c
@@ -3639,6 +3639,7 @@ static int decode_slice_header(H264Context *h, H264Context *h0){
         if(h != h0)
             return -1;   // width / height changed during parallelized decoding
         free_tables(h);
+        flush_dpb(s->avctx);
         MPV_common_end(s);
     }
     if (!s->context_initialized) {

