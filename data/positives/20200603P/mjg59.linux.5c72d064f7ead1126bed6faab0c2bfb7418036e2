commit 5c72d064f7ead1126bed6faab0c2bfb7418036e2
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Wed Apr 13 09:28:23 2011 +0100

    drm/i915: Initialise g4x watermarks for disabled pipes
    
    We were using uninitialised watermarks values for disabled pipes which
    were combined into a single WM register and so corrupting the values for
    the enabled pipe and upsetting the display hardware.
    
    Reported-by: Riccardo Magliocchetti <riccardo.magliocchetti@gmail.com>
    Bugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=32612
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-off-by: Keith Packard <keithp@keithp.com>

diff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c
index 4fc21e047a2d..e522c702b04e 100644
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@ -3771,8 +3771,11 @@ static bool g4x_compute_wm0(struct drm_device *dev,
 	int entries, tlb_miss;
 
 	crtc = intel_get_crtc_for_plane(dev, plane);
-	if (crtc->fb == NULL || !crtc->enabled)
+	if (crtc->fb == NULL || !crtc->enabled) {
+		*cursor_wm = cursor->guard_size;
+		*plane_wm = display->guard_size;
 		return false;
+	}
 
 	htotal = crtc->mode.htotal;
 	hdisplay = crtc->mode.hdisplay;

