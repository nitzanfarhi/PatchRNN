commit de69113ec1896443c732e8b812e8005fb44eeeeb
Author: Axel Lin <axel.lin@gmail.com>
Date:   Thu Aug 4 07:58:07 2011 +0800

    TPM: tpm_nsc: Fix a double free of pdev in cleanup_nsc
    
    platform_device_unregister() will release all resources
    and remove it from the subsystem, then drop reference count by
    calling platform_device_put().
    
    We should not call kfree(pdev) after platform_device_unregister(pdev).
    
    Signed-off-by: Axel Lin <axel.lin@gmail.com>
    Signed-off-by: Rajiv Andrade <srajiv@linux.vnet.ibm.com>
    Signed-off-by: James Morris <jmorris@namei.org>

diff --git a/drivers/char/tpm/tpm_nsc.c b/drivers/char/tpm/tpm_nsc.c
index 82facc9104c7..4d2464871ada 100644
--- a/drivers/char/tpm/tpm_nsc.c
+++ b/drivers/char/tpm/tpm_nsc.c
@@ -396,8 +396,6 @@ static void __exit cleanup_nsc(void)
 	if (pdev) {
 		tpm_nsc_remove(&pdev->dev);
 		platform_device_unregister(pdev);
-		kfree(pdev);
-		pdev = NULL;
 	}
 
 	platform_driver_unregister(&nsc_drv);

