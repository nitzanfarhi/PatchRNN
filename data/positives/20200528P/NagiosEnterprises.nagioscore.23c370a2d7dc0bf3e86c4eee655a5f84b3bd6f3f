commit 23c370a2d7dc0bf3e86c4eee655a5f84b3bd6f3f
Author: Andreas Ericsson <ae@op5.se>
Date:   Wed Nov 28 16:17:33 2012 +0000

    nerd: Fix subscriptions after config reload
    
    We didn't clean up the channels completely during shutdown, so in a
    reload, we'd append the channels created during startup after the old,
    stale ones. The old ones no longer did anything, and when trying to
    subscribe to the new ones, we'd end up subscribing to the old ones.
    
    Signed-off-by: Robin Sonefors <robin.sonefors@op5.com>
    
    git-svn-id: https://nagios.svn.sourceforge.net/svnroot/nagios/nagioscore/trunk@2486 5f96b256-904b-4d8d-8c98-d829582c6739

diff --git a/base/nerd.c b/base/nerd.c
index 3ce3b365..578e84d4 100644
--- a/base/nerd.c
+++ b/base/nerd.c
@@ -359,6 +359,9 @@ static int nerd_deinit(void)
 		}
 		chan->subscriptions = NULL;
 	}
+	my_free(channels);
+	num_channels = 0;
+	alloc_channels = 0;
 
 	return 0;
 }

