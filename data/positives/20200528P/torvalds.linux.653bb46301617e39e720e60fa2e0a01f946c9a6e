commit 653bb46301617e39e720e60fa2e0a01f946c9a6e
Author: Leo Kim <leo.kim@atmel.com>
Date:   Mon Dec 21 14:18:24 2015 +0900

    staging: wilc1000: fixes potential null dereference 'wid.val'
    
    This patch fixes the error reported by smatch.
     - Handle_ListenStateExpired() error: potential null dereference 'wid.val'
    If kmalloc failed, referenced to a NULL pointer.
    
    Signed-off-by: Leo Kim <leo.kim@atmel.com>
    Signed-off-by: Glen Lee <glen.lee@atmel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/wilc1000/host_interface.c b/drivers/staging/wilc1000/host_interface.c
index d1707f6f0dcc..2289ba344300 100644
--- a/drivers/staging/wilc1000/host_interface.c
+++ b/drivers/staging/wilc1000/host_interface.c
@@ -2635,8 +2635,10 @@ static u32 Handle_ListenStateExpired(struct host_if_drv *hif_drv,
 		wid.size = 2;
 		wid.val = kmalloc(wid.size, GFP_KERNEL);
 
-		if (!wid.val)
+		if (!wid.val) {
 			PRINT_ER("Failed to allocate memory\n");
+			return -ENOMEM;
+		}
 
 		wid.val[0] = u8remain_on_chan_flag;
 		wid.val[1] = FALSE_FRMWR_CHANNEL;

