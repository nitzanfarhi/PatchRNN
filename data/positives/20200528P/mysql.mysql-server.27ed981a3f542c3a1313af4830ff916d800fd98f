commit 27ed981a3f542c3a1313af4830ff916d800fd98f
Author: Jon Olav Hauglid <jon.hauglid@oracle.com>
Date:   Thu Jun 18 12:41:00 2015 +0100

    Bug#21250644: ASAN: MEMORY LEAK IN MYSQL CLIENT WHEN FAILED SSL
    
    Fix memory leak in mysql_real_connect().
    Free scramble_buffer also when SSL connection fails.

diff --git a/sql-common/client.c b/sql-common/client.c
index 133eb5b6a60..b3b72ab50ec 100644
--- a/sql-common/client.c
+++ b/sql-common/client.c
@@ -4687,7 +4687,10 @@ CLI_MYSQL_REAL_CONNECT(MYSQL *mysql,const char *host, const char *user,
     goto error;
 
   if (scramble_buffer_allocated == TRUE)
+  {
+    scramble_buffer_allocated= FALSE;
     my_free(scramble_buffer);
+  }
 
   MYSQL_TRACE_STAGE(mysql, READY_FOR_COMMAND);
 
@@ -4764,6 +4767,8 @@ error:
     mysql_close_free(mysql);
     if (!(client_flag & CLIENT_REMEMBER_OPTIONS))
       mysql_close_free_options(mysql);
+    if (scramble_buffer_allocated)
+      my_free(scramble_buffer);
   }
   DBUG_RETURN(0);
 }

