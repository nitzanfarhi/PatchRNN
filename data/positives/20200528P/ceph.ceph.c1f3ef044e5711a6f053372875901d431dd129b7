commit c1f3ef044e5711a6f053372875901d431dd129b7
Author: Yan, Zheng <zyan@redhat.com>
Date:   Wed Nov 25 15:52:22 2015 +0800

    mds: set bad dirfrag's version to 1
    
    there are lots of places assume 'version == 0' means dirfrag is
    uninitialized
    
    Signed-off-by: Yan, Zheng <zyan@redhat.com>

diff --git a/src/mds/CDir.cc b/src/mds/CDir.cc
index 37c592c40c..6866943e51 100644
--- a/src/mds/CDir.cc
+++ b/src/mds/CDir.cc
@@ -1891,12 +1891,14 @@ void CDir::_omap_fetched(bufferlist& hdrbl, map<string, bufferlist>& omap,
 
 void CDir::go_bad()
 {
+  if (get_version() == 0)
+    set_version(1);
   state_set(STATE_BADFRAG);
   // mark complete, !fetching
   mark_complete();
   state_clear(STATE_FETCHING);
   auth_unpin(this);
-  
+
   // kick waiters
   finish_waiting(WAIT_COMPLETE, 0);
 }

