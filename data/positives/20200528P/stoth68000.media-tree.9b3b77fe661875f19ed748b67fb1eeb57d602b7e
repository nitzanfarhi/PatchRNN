commit 9b3b77fe661875f19ed748b67fb1eeb57d602b7e
Author: tinguely@sgi.com <tinguely@sgi.com>
Date:   Fri Sep 27 09:00:55 2013 -0500

    xfs: fix memory leak in xlog_recover_add_to_trans
    
    Free the memory in error path of xlog_recover_add_to_trans().
    Normally this memory is freed in recovery pass2, but is leaked
    in the error path.
    
    Signed-off-by: Mark Tinguely <tinguely@sgi.com>
    Reviewed-by: Eric Sandeen <sandeen@redhat.com>
    Signed-off-by: Ben Myers <bpm@sgi.com>
    
    (cherry picked from commit 519ccb81ac1c8e3e4eed294acf93be00b43dcad6)

diff --git a/fs/xfs/xfs_log_recover.c b/fs/xfs/xfs_log_recover.c
index cc179878fe41..43240583fd5b 100644
--- a/fs/xfs/xfs_log_recover.c
+++ b/fs/xfs/xfs_log_recover.c
@@ -1585,6 +1585,7 @@ xlog_recover_add_to_trans(
 		"bad number of regions (%d) in inode log format",
 				  in_f->ilf_size);
 			ASSERT(0);
+			free(ptr);
 			return XFS_ERROR(EIO);
 		}
 

