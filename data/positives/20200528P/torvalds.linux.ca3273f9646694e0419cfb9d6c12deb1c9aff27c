commit ca3273f9646694e0419cfb9d6c12deb1c9aff27c
Author: Li Zefan <lizf@cn.fujitsu.com>
Date:   Fri Nov 7 14:47:21 2008 +0800

    sched: fix memory leak in a failure path
    
    Impact: fix rare memory leak in the sched-domains manual reconfiguration code
    
    In the failure path, rd is not attached to a sched domain,
    so it causes a leak.
    
    Signed-off-by: Li Zefan <lizf@cn.fujitsu.com>
    Acked-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/kernel/sched.c b/kernel/sched.c
index 4c7e2bcdfa89..57c933ffbee1 100644
--- a/kernel/sched.c
+++ b/kernel/sched.c
@@ -7676,6 +7676,7 @@ static int __build_sched_domains(const cpumask_t *cpu_map,
 error:
 	free_sched_groups(cpu_map, tmpmask);
 	SCHED_CPUMASK_FREE((void *)allmasks);
+	kfree(rd);
 	return -ENOMEM;
 #endif
 }

