commit f77927efc87f1af093582165aba815af0dda1065
Author: Steven Dake <sdake@mvista.com>
Date:   Thu Feb 17 00:25:01 2005 +0000

    mutex bug fixes as reported by Kristen Smith.
    
    (Logical change 1.139)
    
    
    git-svn-id: http://svn.fedorahosted.org/svn/corosync/trunk@498 fd59a12c-fef9-0310-b244-a6a79926bd2f

diff --git a/lib/clm.c b/lib/clm.c
index caf1dc8e..9b034e8e 100644
--- a/lib/clm.c
+++ b/lib/clm.c
@@ -223,7 +223,7 @@ saClmDispatch (
 
 		error = saPollRetry (&ufds, 1, timeout);
 		if (error != SA_OK) {
-			goto error_nounlock;
+			goto error_put;
 		}
 
 		pthread_mutex_lock (&clmInstance->mutex);
@@ -233,7 +233,6 @@ saClmDispatch (
 		 */
 		if (clmInstance->finalize == 1) {
 			error = SA_OK;
-			pthread_mutex_unlock (&clmInstance->mutex);
 			goto error_unlock;
 		}
 
@@ -337,7 +336,7 @@ saClmDispatch (
 
 		default:
 			error = SA_ERR_LIBRARY;
-			goto error_nounlock;
+			goto error_put;
 			break;
 		}
 
@@ -356,6 +355,8 @@ saClmDispatch (
 	} while (cont);
 
 error_unlock:
+	pthread_mutex_unlock (&clmInstance->mutex);
+error_put:
 	saHandleInstancePut (&clmHandleDatabase, clmHandle);
 error_nounlock:
 	return (error);

