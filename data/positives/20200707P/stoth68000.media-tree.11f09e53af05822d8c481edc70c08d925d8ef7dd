commit 11f09e53af05822d8c481edc70c08d925d8ef7dd
Author: Kiran Padwal <kiran.padwal@smartplayin.com>
Date:   Wed Feb 11 15:06:45 2015 +0530

    video: ARM CLCD: Add missing error check for devm_kzalloc
    
    This patch add a missing check on the return value of devm_kzalloc,
    which would cause a NULL pointer dereference in a OOM situation.
    
    Signed-off-by: Kiran Padwal <kiran.padwal@smartplayin.com>
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>

diff --git a/drivers/video/fbdev/amba-clcd.c b/drivers/video/fbdev/amba-clcd.c
index 32c0b6b28097..9362424c2340 100644
--- a/drivers/video/fbdev/amba-clcd.c
+++ b/drivers/video/fbdev/amba-clcd.c
@@ -599,6 +599,9 @@ static int clcdfb_of_get_mode(struct device *dev, struct device_node *endpoint,
 
 	len = clcdfb_snprintf_mode(NULL, 0, mode);
 	name = devm_kzalloc(dev, len + 1, GFP_KERNEL);
+	if (!name)
+		return -ENOMEM;
+
 	clcdfb_snprintf_mode(name, len + 1, mode);
 	mode->name = name;
 

