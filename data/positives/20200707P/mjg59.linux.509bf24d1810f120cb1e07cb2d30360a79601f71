commit 509bf24d1810f120cb1e07cb2d30360a79601f71
Author: David Howells <dhowells@redhat.com>
Date:   Fri Sep 20 14:18:00 2013 +0100

    CacheFiles: Don't try to dump the index key if the cookie has been cleared
    
    Don't try to dump the index key that distinguishes an object if netfs
    data in the cookie the object refers to has been cleared (ie.  the
    cookie has passed most of the way through
    __fscache_relinquish_cookie()).
    
    Since the netfs holds the index key, we can't get at it once the ->def
    and ->netfs_data pointers have been cleared - and a NULL pointer
    exception will ensue, usually just after a:
    
            CacheFiles: Error: Unexpected object collision
    
    error is reported.
    
    Signed-off-by: David Howells <dhowells@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/fs/cachefiles/namei.c b/fs/cachefiles/namei.c
index 25badd1aec5c..f4a08d7fa2f7 100644
--- a/fs/cachefiles/namei.c
+++ b/fs/cachefiles/namei.c
@@ -56,7 +56,7 @@ void __cachefiles_printk_object(struct cachefiles_object *object,
 		       object->fscache.cookie->parent,
 		       object->fscache.cookie->netfs_data,
 		       object->fscache.cookie->flags);
-		if (keybuf)
+		if (keybuf && cookie->def)
 			keylen = cookie->def->get_key(cookie->netfs_data, keybuf,
 						      CACHEFILES_KEYBUF_SIZE);
 		else

