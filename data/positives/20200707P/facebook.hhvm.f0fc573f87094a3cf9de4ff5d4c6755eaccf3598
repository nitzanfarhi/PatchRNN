commit f0fc573f87094a3cf9de4ff5d4c6755eaccf3598
Author: Christopher Dykes <cdykes@fb.com>
Date:   Thu Sep 29 16:36:06 2016 -0700

    Fix OOB read in exif_process_IFD_in_MAKERNOTE
    
    Summary: Because they aren't good.
    
    Reviewed By: aorenste
    
    Differential Revision: D3799206
    
    fbshipit-source-id: f6d2907825786d6cccee3dc51a2ce4a1d52a31b9

diff --git a/hphp/runtime/ext/gd/ext_gd.cpp b/hphp/runtime/ext/gd/ext_gd.cpp
index 4d65f76887..8d5203e132 100644
--- a/hphp/runtime/ext/gd/ext_gd.cpp
+++ b/hphp/runtime/ext/gd/ext_gd.cpp
@@ -6443,6 +6443,7 @@ static int exif_process_IFD_in_MAKERNOTE(image_info_type *ImageInfo,
       if (value_end - (dir_start+10) < 4) return 0;
       offset_diff = 2 + NumDirEntries*12 + 4 -
                     php_ifd_get32u(dir_start+10, ImageInfo->motorola_intel);
+      if (offset_diff < 0 || offset_diff >= value_len) return 0;
       offset_base = value_ptr + offset_diff;
       break;
     default:

