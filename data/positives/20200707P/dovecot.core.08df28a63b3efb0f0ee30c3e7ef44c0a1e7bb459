commit 08df28a63b3efb0f0ee30c3e7ef44c0a1e7bb459
Author: Timo Sirainen <tss@iki.fi>
Date:   Sat Feb 16 13:32:57 2013 +0200

    mdbox: mailbox_copy() didn't properly free the save context.

diff --git a/src/lib-storage/index/dbox-multi/mdbox-save.c b/src/lib-storage/index/dbox-multi/mdbox-save.c
index c0a3bf13b..2193c8ace 100644
--- a/src/lib-storage/index/dbox-multi/mdbox-save.c
+++ b/src/lib-storage/index/dbox-multi/mdbox-save.c
@@ -425,8 +425,10 @@ int mdbox_copy(struct mail_save_context *_ctx, struct mail *mail)
 	memset(&rec, 0, sizeof(rec));
 	rec.save_date = ioloop_time;
 	if (mdbox_mail_lookup(src_mbox, mail->transaction->view, mail->seq,
-			      &rec.map_uid) < 0)
+			      &rec.map_uid) < 0) {
+		index_save_context_free(_ctx);
 		return -1;
+	}
 
 	mail_index_lookup_ext(mail->transaction->view, mail->seq,
 			      src_mbox->guid_ext_id, &guid_data, &expunged);
@@ -461,5 +463,6 @@ int mdbox_copy(struct mail_save_context *_ctx, struct mail *mail)
 
 	if (_ctx->dest_mail != NULL)
 		mail_set_seq_saving(_ctx->dest_mail, ctx->ctx.seq);
+	index_save_context_free(_ctx);
 	return 0;
 }

