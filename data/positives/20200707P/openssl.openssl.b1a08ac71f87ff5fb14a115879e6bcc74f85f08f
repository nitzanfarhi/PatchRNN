commit b1a08ac71f87ff5fb14a115879e6bcc74f85f08f
Author: Jonas Maebe <jonas.maebe@elis.ugent.be>
Date:   Sun Dec 8 23:05:56 2013 +0100

    capi_get_key: check for NULL after allocating key
    
    Signed-off-by: Kurt Roeckx <kurt@roeckx.be>
    Reviewed-by: Richard Levitte <levitte@openssl.org>

diff --git a/engines/e_capi.c b/engines/e_capi.c
index edcebf1a3f..f7876f3bab 100644
--- a/engines/e_capi.c
+++ b/engines/e_capi.c
@@ -1498,6 +1498,8 @@ static CAPI_KEY *capi_get_key(CAPI_CTX *ctx, const TCHAR *contname, TCHAR *provn
 	CAPI_KEY *key;
 	DWORD dwFlags = 0; 
 	key = OPENSSL_malloc(sizeof(CAPI_KEY));
+	if (key == NULL)
+		return NULL;
 	if (sizeof(TCHAR)==sizeof(char))
 		CAPI_trace(ctx, "capi_get_key, contname=%s, provname=%s, type=%d\n",
 						contname, provname, ptype);

