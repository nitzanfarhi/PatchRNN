commit fe3c094abc2365a226184554501fe0df87fe8271
Author: Samuel Ortiz <sameo@linux.intel.com>
Date:   Thu Jul 5 17:43:08 2012 +0200

    NFC: Check for llcp_sock and its device from llcp_sock_getname
    
    They both can potentially be NULL.
    
    Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>

diff --git a/net/nfc/llcp/sock.c b/net/nfc/llcp/sock.c
index 6152d05f8378..ddeb9aa398f0 100644
--- a/net/nfc/llcp/sock.c
+++ b/net/nfc/llcp/sock.c
@@ -294,6 +294,9 @@ static int llcp_sock_getname(struct socket *sock, struct sockaddr *uaddr,
 	struct nfc_llcp_sock *llcp_sock = nfc_llcp_sock(sk);
 	DECLARE_SOCKADDR(struct sockaddr_nfc_llcp *, llcp_addr, uaddr);
 
+	if (llcp_sock == NULL || llcp_sock->dev == NULL)
+		return -EBADFD;
+
 	pr_debug("%p %d %d %d\n", sk, llcp_sock->target_idx,
 		 llcp_sock->dsap, llcp_sock->ssap);
 

