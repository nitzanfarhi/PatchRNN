commit a5d46235f3f70f0b620f8e54649ece45ecc5b170
Author: Laurent Aimar <fenrir@videolan.org>
Date:   Sat Oct 1 00:45:01 2011 +0200

    Check for out of bound reads in the Electronic Arts CMV decoder.
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/eacmv.c b/libavcodec/eacmv.c
index 3ac9cdaecb..20ec0a2265 100644
--- a/libavcodec/eacmv.c
+++ b/libavcodec/eacmv.c
@@ -158,6 +158,9 @@ static int cmv_decode_frame(AVCodecContext *avctx,
     CmvContext *s = avctx->priv_data;
     const uint8_t *buf_end = buf + buf_size;
 
+    if (buf_end - buf < EA_PREAMBLE_SIZE)
+        return AVERROR_INVALIDDATA;
+
     if (AV_RL32(buf)==MVIh_TAG||AV_RB32(buf)==MVIh_TAG) {
         cmv_process_header(s, buf+EA_PREAMBLE_SIZE, buf_end);
         return buf_size;

