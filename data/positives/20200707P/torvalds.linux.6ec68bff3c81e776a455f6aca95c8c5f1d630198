commit 6ec68bff3c81e776a455f6aca95c8c5f1d630198
Author: Andi Kleen <andi@firstfloor.org>
Date:   Thu Feb 12 13:39:26 2009 +0100

    x86, mce: reinitialize per cpu features on resume
    
    Impact: Bug fix
    
    This fixes a long standing bug in the machine check code. On resume the
    boot CPU wouldn't get its vendor specific state like thermal handling
    reinitialized. This means the boot cpu wouldn't ever get any thermal
    events reported again.
    
    Call the respective initialization functions on resume
    
    v2: Remove ancient init because they don't have a resume device anyways.
        Pointed out by Thomas Gleixner.
    v3: Now fix the Subject too to reflect v2 change
    
    Signed-off-by: Andi Kleen <ak@linux.intel.com>
    Acked-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

diff --git a/arch/x86/kernel/cpu/mcheck/mce_64.c b/arch/x86/kernel/cpu/mcheck/mce_64.c
index 1c838032fd37..1f184efb6bc2 100644
--- a/arch/x86/kernel/cpu/mcheck/mce_64.c
+++ b/arch/x86/kernel/cpu/mcheck/mce_64.c
@@ -734,6 +734,7 @@ __setup("mce=", mcheck_enable);
 static int mce_resume(struct sys_device *dev)
 {
 	mce_init(NULL);
+	mce_cpu_features(&current_cpu_data);
 	return 0;
 }
 

