commit 794e64d5e9c7f088378e093a48eb36a30091d82d
Author: Neil Brown <neilb@suse.de>
Date:   Mon Dec 10 15:49:30 2007 -0800

    Fix NULL dereference in umem.c
    
    Fix NULL dereference in umem.c
    
    Signed-off-by: Neil Brown <neilb@suse.de>
    Tested-by: Dave Chinner <dgc@sgi.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/block/umem.c b/drivers/block/umem.c
index 99806f9ee4ce..5f5095afb06b 100644
--- a/drivers/block/umem.c
+++ b/drivers/block/umem.c
@@ -484,7 +484,8 @@ static void process_page(unsigned long data)
 		page->idx++;
 		if (page->idx >= bio->bi_vcnt) {
 			page->bio = bio->bi_next;
-			page->idx = page->bio->bi_idx;
+			if (page->bio)
+				page->idx = page->bio->bi_idx;
 		}
 
 		pci_unmap_page(card->dev, desc->data_dma_handle,

