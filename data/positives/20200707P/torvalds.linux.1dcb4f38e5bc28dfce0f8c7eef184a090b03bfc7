commit 1dcb4f38e5bc28dfce0f8c7eef184a090b03bfc7
Author: Axel Lin <axel.lin@gmail.com>
Date:   Mon Dec 6 16:48:03 2010 +0800

    ASoC: Hold client_mutex while calling snd_soc_instantiate_cards()
    
    As the comments of snd_soc_instantiate_cards() said,
    snd_soc_instantiate_cards() must be called with client_mutex.
    
    Signed-off-by: Axel Lin <axel.lin@gmail.com>
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>

diff --git a/sound/soc/soc-core.c b/sound/soc/soc-core.c
index 441285ade024..02ae7bea3b50 100644
--- a/sound/soc/soc-core.c
+++ b/sound/soc/soc-core.c
@@ -3072,7 +3072,9 @@ int snd_soc_register_dais(struct device *dev,
 		pr_debug("Registered DAI '%s'\n", dai->name);
 	}
 
+	mutex_lock(&client_mutex);
 	snd_soc_instantiate_cards();
+	mutex_unlock(&client_mutex);
 	return 0;
 
 err:

