commit effbc2a7b613c4a0083fbf0f15757c454dbb7e75
Author: nils <nils@c6295689-39f2-0310-b995-f0e70906c6a9>
Date:   Sun Apr 18 18:42:47 2004 +0000

    remove pointer to freed secret object
    Patch supplied by Victor Tarasov
    
    
    git-svn-id: https://www.opensc-project.org/svnp/opensc/trunk@1771 c6295689-39f2-0310-b995-f0e70906c6a9

diff --git a/src/pkcs15init/keycache.c b/src/pkcs15init/keycache.c
index a63e42b7..4a433b7e 100644
--- a/src/pkcs15init/keycache.c
+++ b/src/pkcs15init/keycache.c
@@ -324,6 +324,8 @@ sc_keycache_forget_key(const sc_path_t *path, int type, int ref)
 	while ((s = *prev) != NULL) {
 		if (__match_entry(s, type, ref, path, 1)) {
 			*prev = s->next;
+			if (s->named_pin != -1 && s->ref == -1)
+				named_pin[s->named_pin] = NULL;
 			memset(s, 0, sizeof(*s));
 			free(s);
 		} else {

