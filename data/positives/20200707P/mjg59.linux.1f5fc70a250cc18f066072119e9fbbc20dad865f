commit 1f5fc70a250cc18f066072119e9fbbc20dad865f
Author: Jiri Slaby <jirislaby@gmail.com>
Date:   Sat Jun 20 12:31:11 2009 +0200

    Wireless: nl80211, fix lock imbalance
    
    Don't forget to unlock cfg80211_mutex in one fail path of
    nl80211_set_wiphy.
    
    Signed-off-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.c
index 241bddd0b4f1..43bdb1372cae 100644
--- a/net/wireless/nl80211.c
+++ b/net/wireless/nl80211.c
@@ -447,6 +447,7 @@ static int nl80211_set_wiphy(struct sk_buff *skb, struct genl_info *info)
 
 	rdev = __cfg80211_drv_from_info(info);
 	if (IS_ERR(rdev)) {
+		mutex_unlock(&cfg80211_mutex);
 		result = PTR_ERR(rdev);
 		goto unlock;
 	}

