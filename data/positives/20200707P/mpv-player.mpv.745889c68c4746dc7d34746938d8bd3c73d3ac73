commit 745889c68c4746dc7d34746938d8bd3c73d3ac73
Author: wm4 <wm4@nowhere>
Date:   Fri Jun 20 19:20:59 2014 +0200

    vo_vaapi: fix reference counting when using software decoding
    
    Recent regression.

diff --git a/video/out/vo_vaapi.c b/video/out/vo_vaapi.c
index caf383c3f4..16218dd98c 100644
--- a/video/out/vo_vaapi.c
+++ b/video/out/vo_vaapi.c
@@ -284,7 +284,8 @@ static void draw_image(struct vo *vo, struct mp_image *mpi)
             return;
         }
         mp_image_copy_attributes(dst, mpi);
-        mpi = dst;
+        talloc_free(mpi);
+        mpi = mp_image_new_ref(dst);
     }
 
     talloc_free(p->output_surfaces[p->output_surface]);

