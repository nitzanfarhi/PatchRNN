commit c1be973ae1135588ed77b365bfd3bf063bac78ae
Author: Michael S. Tsirkin <mst@redhat.com>
Date:   Tue Jun 21 20:34:17 2011 +0300

    vhost: fix double free on device stop
    
    vhost dev stop failed to clear the log field.
    Typically not an issue as dev start overwrites this field,
    but if logging gets disabled before the following start,
    it doesn't so this causes a double free.
    
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>

diff --git a/hw/vhost.c b/hw/vhost.c
index 80f771e448..c3d88214fe 100644
--- a/hw/vhost.c
+++ b/hw/vhost.c
@@ -784,5 +784,6 @@ void vhost_dev_stop(struct vhost_dev *hdev, VirtIODevice *vdev)
 
     hdev->started = false;
     qemu_free(hdev->log);
+    hdev->log = NULL;
     hdev->log_size = 0;
 }

