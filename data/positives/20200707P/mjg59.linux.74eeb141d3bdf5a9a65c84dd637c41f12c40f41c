commit 74eeb141d3bdf5a9a65c84dd637c41f12c40f41c
Author: Takashi Iwai <tiwai@suse.de>
Date:   Mon Jan 9 18:26:05 2012 +0100

    ALSA: asihpi - Fix potential Oops in snd_asihpi_cmode_info()
    
    Dan Carpenter reported that setting 0 to uinfo->value.enumerated.items
    in snd_asihpi_cmode_info() may lead to Oops.  This function should
    return an error immediately in such a case instead.
    
    Cc: Dan Carpenter <dan.carpenter@oracle.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/asihpi/asihpi.c b/sound/pci/asihpi/asihpi.c
index fd3926fb0a08..e8de831f98bc 100644
--- a/sound/pci/asihpi/asihpi.c
+++ b/sound/pci/asihpi/asihpi.c
@@ -2259,6 +2259,9 @@ static int snd_asihpi_cmode_info(struct snd_kcontrol *kcontrol,
 			valid_modes++;
 			}
 
+	if (!valid_modes)
+		return -EINVAL;
+
 	uinfo->type = SNDRV_CTL_ELEM_TYPE_ENUMERATED;
 	uinfo->count = 1;
 	uinfo->value.enumerated.items = valid_modes;

