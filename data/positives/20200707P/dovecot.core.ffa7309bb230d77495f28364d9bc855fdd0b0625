commit ffa7309bb230d77495f28364d9bc855fdd0b0625
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Nov 19 18:00:08 2009 -0500

    master: Create base_dir with 0755 permissions, not 0777.
    
    --HG--
    branch : HEAD

diff --git a/src/master/master-settings.c b/src/master/master-settings.c
index 1fbd489d2..698dad58c 100644
--- a/src/master/master-settings.c
+++ b/src/master/master-settings.c
@@ -471,7 +471,7 @@ bool master_settings_do_fixes(const struct master_settings *set)
 
 	/* since base dir is under /var/run by default, it may have been
 	   deleted. */
-	if (mkdir_parents(set->base_dir, 0777) < 0 && errno != EEXIST) {
+	if (mkdir_parents(set->base_dir, 0755) < 0 && errno != EEXIST) {
 		i_error("mkdir(%s) failed: %m", set->base_dir);
 		return FALSE;
 	}
@@ -484,6 +484,14 @@ bool master_settings_do_fixes(const struct master_settings *set)
 		i_error("%s is not a directory", set->base_dir);
 		return FALSE;
 	}
+	if ((st.st_mode & 0777) == 0777) {
+		/* FIXME: backwards compatibility: v1.2 was creating
+		   base_dir with 0777 permissions.. */
+		i_warning("Fixing permissions of %s to be world-readable",
+			  set->base_dir);
+		if (chmod(set->base_dir, 0755) < 0)
+			i_error("chmod(%s) failed: %m", set->base_dir);
+	}
 
 	/* Make sure our permanent state directory exists */
 	if (mkdir_parents(PKG_STATEDIR, 0750) < 0 && errno != EEXIST) {

