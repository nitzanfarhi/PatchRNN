commit 805aa1058452157c60d8f6fb55bf7e1af9535576
Author: aland <aland>
Date:   Wed Aug 18 13:44:03 1999 +0000

            return error messages on recvfrom() socket error

diff --git a/src/lib/radius.c b/src/lib/radius.c
index 15dd511f0..e841c0e9f 100644
--- a/src/lib/radius.c
+++ b/src/lib/radius.c
@@ -291,6 +291,13 @@ RADIUS_PACKET *rad_recv(int fd)
 	salen = sizeof(saremote);
 	packet->data_len = recvfrom(fd, packet->data, PACKET_DATA_LEN,
 		0, (struct sockaddr *)&saremote, &salen);
+	if (packet->data_len < 0) {
+		free(packet->data);
+		free(packet);
+		librad_log("Error receiving packet: %s", strerror(errno));
+		return NULL;
+	}
+
 	if (packet->data_len < 20) {
 		free(packet->data);
 		free(packet);

