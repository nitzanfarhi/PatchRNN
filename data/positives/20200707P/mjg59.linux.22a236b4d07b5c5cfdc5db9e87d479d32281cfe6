commit 22a236b4d07b5c5cfdc5db9e87d479d32281cfe6
Author: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
Date:   Sun Nov 2 12:04:41 2014 +0530

    ASoC: Intel: fix missing mutex
    
    on error in block prepare, we were returning the error code while still
    holding the mutex. We are releasing the mutex in this patch before
    return.
    
    Signed-off-by: Sudip Mukherjee <sudip@vectorindia.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/sound/soc/intel/sst-firmware.c b/sound/soc/intel/sst-firmware.c
index c451398b058c..4a5bde9c686b 100644
--- a/sound/soc/intel/sst-firmware.c
+++ b/sound/soc/intel/sst-firmware.c
@@ -1120,6 +1120,7 @@ int sst_block_alloc_scratch(struct sst_dsp *dsp)
 	ret = block_list_prepare(dsp, &dsp->scratch_block_list);
 	if (ret < 0) {
 		dev_err(dsp->dev, "error: scratch block prepare failed\n");
+		mutex_unlock(&dsp->mutex);
 		return ret;
 	}
 

