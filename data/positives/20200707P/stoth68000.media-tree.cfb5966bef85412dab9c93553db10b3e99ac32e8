commit cfb5966bef85412dab9c93553db10b3e99ac32e8
Author: Li Zefan <lizefan@huawei.com>
Date:   Tue Mar 12 10:28:39 2013 +0800

    cpuset: fix RCU lockdep splat in cpuset_print_task_mems_allowed()
    
    Sasha reported a lockdep warning when OOM was triggered. The reason
    is cgroup_name() should be called with rcu_read_lock() held.
    
    Reported-by: Sasha Levin <sasha.levin@oracle.com>
    Signed-off-by: Li Zefan <lizefan@huawei.com>
    Signed-off-by: Tejun Heo <tj@kernel.org>

diff --git a/kernel/cpuset.c b/kernel/cpuset.c
index ace5bfcdcb30..efbfca7a33e4 100644
--- a/kernel/cpuset.c
+++ b/kernel/cpuset.c
@@ -2599,6 +2599,7 @@ void cpuset_print_task_mems_allowed(struct task_struct *tsk)
 
 	struct cgroup *cgrp = task_cs(tsk)->css.cgroup;
 
+	rcu_read_lock();
 	spin_lock(&cpuset_buffer_lock);
 
 	nodelist_scnprintf(cpuset_nodelist, CPUSET_NODELIST_LEN,
@@ -2607,6 +2608,7 @@ void cpuset_print_task_mems_allowed(struct task_struct *tsk)
 	       tsk->comm, cgroup_name(cgrp), cpuset_nodelist);
 
 	spin_unlock(&cpuset_buffer_lock);
+	rcu_read_unlock();
 }
 
 /*

