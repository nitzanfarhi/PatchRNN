commit d696f1181448619e72bc50818c72e3ffb3778a9f
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Sun Sep 25 13:26:30 2005 +0000

    MFH: Fixed bug #34321 (Possible crash in filter code).

diff --git a/ext/standard/filters.c b/ext/standard/filters.c
index adad37cf61..36218ea3bf 100644
--- a/ext/standard/filters.c
+++ b/ext/standard/filters.c
@@ -868,7 +868,7 @@ static php_conv_err_t php_conv_qprint_encode_convert(php_conv_qprint_encode *ins
 				CONSUME_CHAR(ps, icnt, lb_ptr, lb_cnt);
 			}
 		} else if ((!(opts & PHP_CONV_QPRINT_OPT_FORCE_ENCODE_FIRST) || line_ccnt < inst->line_len) && ((c >= 33 && c <= 60) || (c >= 62 && c <= 126))) { 
-			if (line_ccnt < 2) {
+			if (line_ccnt < 2 && inst->lbchars != NULL) {
 				if (ocnt < inst->lbchars_len + 1) {
 					err = PHP_CONV_ERR_TOO_BIG;
 					break;

