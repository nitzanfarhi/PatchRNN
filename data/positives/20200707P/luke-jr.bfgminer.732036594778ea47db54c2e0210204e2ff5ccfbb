commit 732036594778ea47db54c2e0210204e2ff5ccfbb
Author: Luke Dashjr <luke-jr+git@utopios.org>
Date:   Sun Dec 16 20:46:53 2012 +0000

    Bugfix: Free shares discarded before beginning submission

diff --git a/miner.c b/miner.c
index d9a269b1..762be5b3 100644
--- a/miner.c
+++ b/miner.c
@@ -3709,8 +3709,10 @@ static void *submit_work_thread(__maybe_unused void *userdata)
 				}
 				++wip;
 			}
-			else
+			else {
 				--total_submitting;
+				free_work(work);
+			}
 		}
 		if (unlikely(shutting_down && !wip))
 			break;

