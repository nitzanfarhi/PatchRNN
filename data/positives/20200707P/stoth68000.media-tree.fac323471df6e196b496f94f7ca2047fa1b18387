commit fac323471df6e196b496f94f7ca2047fa1b18387
Author: Roger Quadros <rogerq@ti.com>
Date:   Mon Apr 3 15:20:29 2017 +0300

    usb: udc: allow adding and removing the same gadget device
    
    allow usb_del_gadget_udc() and usb add_gadget_udc() to be called
    repeatedly on the same gadget->dev structure.
    
    We need to clear the gadget->dev structure so that kobject_init()
    doesn't complain about already initialized object.
    
    Signed-off-by: Roger Quadros <rogerq@ti.com>
    Signed-off-by: Felipe Balbi <felipe.balbi@linux.intel.com>

diff --git a/drivers/usb/gadget/udc/core.c b/drivers/usb/gadget/udc/core.c
index d685d82dcf48..efce68e9a8e0 100644
--- a/drivers/usb/gadget/udc/core.c
+++ b/drivers/usb/gadget/udc/core.c
@@ -1273,6 +1273,7 @@ void usb_del_gadget_udc(struct usb_gadget *gadget)
 	flush_work(&gadget->work);
 	device_unregister(&udc->dev);
 	device_unregister(&gadget->dev);
+	memset(&gadget->dev, 0x00, sizeof(gadget->dev));
 }
 EXPORT_SYMBOL_GPL(usb_del_gadget_udc);
 

