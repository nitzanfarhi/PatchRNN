commit f5bafd6711be412ad077cf943de56a6085472ea7
Author: Vic Lee <llyzs@163.com>
Date:   Wed May 30 11:24:39 2012 +0800

    libfreerdp-core: fix server crash in case rdp key file is not provided.

diff --git a/libfreerdp-core/nego.c b/libfreerdp-core/nego.c
index 34a0850c2..b7ddbf0c3 100644
--- a/libfreerdp-core/nego.c
+++ b/libfreerdp-core/nego.c
@@ -606,6 +606,8 @@ boolean nego_send_negotiation_response(rdpNego* nego)
 				settings->encryption_method = ENCRYPTION_METHOD_40BIT | ENCRYPTION_METHOD_128BIT | ENCRYPTION_METHOD_FIPS;
 				settings->encryption_level = ENCRYPTION_LEVEL_CLIENT_COMPATIBLE;
 			}
+			if (settings->encryption && settings->server_key == NULL && settings->rdp_key_file == NULL)
+				return false;
 		}
 		else if (settings->selected_protocol == PROTOCOL_TLS)
 		{

