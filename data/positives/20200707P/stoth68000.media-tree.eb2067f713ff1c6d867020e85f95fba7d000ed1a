commit eb2067f713ff1c6d867020e85f95fba7d000ed1a
Author: Dave Jones <davej@redhat.com>
Date:   Tue Jul 30 13:42:17 2013 -0400

    Fix leak in __btrfs_map_block error path
    
    If we bail out when the stripe alloc fails, we need to undo the
    earlier allocation of raid_map.
    
    Signed-off-by: Dave Jones <davej@redhat.com>
    Signed-off-by: Josef Bacik <jbacik@fusionio.com>
    Signed-off-by: Chris Mason <chris.mason@fusionio.com>

diff --git a/fs/btrfs/volumes.c b/fs/btrfs/volumes.c
index 93f39b1e7173..44abd151132a 100644
--- a/fs/btrfs/volumes.c
+++ b/fs/btrfs/volumes.c
@@ -4673,6 +4673,7 @@ static int __btrfs_map_block(struct btrfs_fs_info *fs_info, int rw,
 	}
 	bbio = kzalloc(btrfs_bio_size(num_alloc_stripes), GFP_NOFS);
 	if (!bbio) {
+		kfree(raid_map);
 		ret = -ENOMEM;
 		goto out;
 	}

