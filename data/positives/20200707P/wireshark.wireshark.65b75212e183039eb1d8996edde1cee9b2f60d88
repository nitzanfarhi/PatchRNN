commit 65b75212e183039eb1d8996edde1cee9b2f60d88
Author: Michael Mann <mmann78@netscape.net>
Date:   Tue Jun 24 14:07:10 2014 -0400

    Ensure proto_item from subtree is initialized
    
    bug:10223
    Change-Id: I40ed92bcf436723ad3927a93181f7c732cf4690f
    Reviewed-on: https://code.wireshark.org/review/2623
    Reviewed-by: Michael Mann <mmann78@netscape.net>
    Reviewed-by: Evan Huus <eapache@gmail.com>

diff --git a/epan/proto.c b/epan/proto.c
index 08bbf01168..cabc70b155 100644
--- a/epan/proto.c
+++ b/epan/proto.c
@@ -1142,6 +1142,10 @@ proto_tree_add_subtree_format(proto_tree *tree, tvbuff_t *tvb, gint start, gint
 	va_list		ap;
 	header_field_info *hfinfo;
 
+    /* Make sure pi is initialized in case TRY_TO_FAKE_THIS_ITEM bails */
+	if (tree_item != NULL)
+		*tree_item = NULL;
+
 	TRY_TO_FAKE_THIS_ITEM(tree, hf_text_only, hfinfo);
 
 	pi = proto_tree_add_text_node(tree, tvb, start, length);

