commit 5d5da114b39d3cf187a69dcf5eaca7eaf886c041
Author: Liu Yuan <namei.unix@gmail.com>
Date:   Tue Jun 17 13:45:35 2014 +0800

    sheepdog: fix NULL dereference in sd_create
    
    Following command
    
    qemu-img create -f qcow2 sheepdog:test 20g
    
    will cause core dump because aio_context is NULL in sd_create. We should
    initialize it by qemu_get_aio_context() to avoid NULL dereference.
    
    Cc: qemu-devel@nongnu.org
    Cc: Kevin Wolf <kwolf@redhat.com>
    Cc: Stefan Hajnoczi <stefanha@redhat.com>
    Signed-off-by: Liu Yuan <namei.unix@gmail.com>
    Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>

diff --git a/block/sheepdog.c b/block/sheepdog.c
index 2dcc5959f4..8d9350c26d 100644
--- a/block/sheepdog.c
+++ b/block/sheepdog.c
@@ -1756,6 +1756,7 @@ static int sd_create(const char *filename, QemuOpts *opts,
         bdrv_unref(bs);
     }
 
+    s->aio_context = qemu_get_aio_context();
     ret = do_sd_create(s, &vid, 0, errp);
     if (ret) {
         goto out;

