commit d82aa4a8f2e8df9673ddb099262355da4c9b99b1
Author: Lars-Peter Clausen <lars@metafoo.de>
Date:   Tue Oct 18 16:54:04 2016 +0200

    gpio: GPIOHANDLE_GET_LINE_VALUES_IOCTL: Fix information leak
    
    The GPIOHANDLE_GET_LINE_VALUES_IOCTL handler allocates a gpiohandle_data
    struct on the stack and then passes it to copy_to_user(). But only the
    first element of the values array in the struct is set, which leaves the
    struct partially initialized.
    
    This exposes the previous, potentially sensitive, stack content to the
    issuing userspace application. To avoid this make sure that the struct is
    fully initialized.
    
    Cc: stable@vger.kernel.org
    Fixes: 61f922db7221 ("gpio: userspace ABI for reading GPIO line events")
    Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>

diff --git a/drivers/gpio/gpiolib.c b/drivers/gpio/gpiolib.c
index d287cb4e97c4..4ed26bcf054c 100644
--- a/drivers/gpio/gpiolib.c
+++ b/drivers/gpio/gpiolib.c
@@ -628,6 +628,8 @@ static long lineevent_ioctl(struct file *filep, unsigned int cmd,
 	if (cmd == GPIOHANDLE_GET_LINE_VALUES_IOCTL) {
 		int val;
 
+		memset(&ghd, 0, sizeof(ghd));
+
 		val = gpiod_get_value_cansleep(le->desc);
 		if (val < 0)
 			return val;

