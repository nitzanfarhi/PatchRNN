commit ba41d30636c89a31e4bf9f13929cb23ae1bb8ec6
Author: Steinar H. Gunderson <steinar.gunderson@oracle.com>
Date:   Tue Sep 5 12:01:18 2017 +0200

    Bug #26696147: REMOVE MY_SNPRINTF
    
    Post-push fix: Fix a stack overflow. (This was masked earlier, since
    my_snprintf returned a nonstandard value on overflow.)
    
    Change-Id: Ic6fbe4fc58e02f2d50a3f39dc5f9d52340ed85b2

diff --git a/sql/log.cc b/sql/log.cc
index 2289e52fce5..9951539d42f 100644
--- a/sql/log.cc
+++ b/sql/log.cc
@@ -1321,6 +1321,8 @@ bool Query_logger::general_log_print(THD *thd, enum_server_command command,
     message_buff_len= vsnprintf(message_buff, sizeof(message_buff),
                                    format, args);
     va_end(args);
+
+    message_buff_len= std::min(message_buff_len, sizeof(message_buff) - 1);
   }
   else
     message_buff[0]= '\0';

