commit 0b43fcdff6495958c39e3575848edef4b685ddef
Author: Jarod Wilson <jarod@redhat.com>
Date:   Tue May 24 16:44:54 2011 -0300

    [media] mceusb: plug memory leak on data transmit
    
    Hans Petter Selasky pointed out to me that we're leaking urbs when
    mce_async_out is called. Its used both for configuring the hardware and
    for transmitting IR data. In the tx case, mce_request_packet actually
    allocates both a urb and the transfer buffer, neither of which was being
    torn down. Do that in the tx callback.
    
    CC: Hans Petter Selasky <hselasky@c2i.net>
    Signed-off-by: Jarod Wilson <jarod@redhat.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/rc/mceusb.c b/drivers/media/rc/mceusb.c
index 6cf22012079a..06dfe0957b5e 100644
--- a/drivers/media/rc/mceusb.c
+++ b/drivers/media/rc/mceusb.c
@@ -621,6 +621,9 @@ static void mce_async_callback(struct urb *urb, struct pt_regs *regs)
 		mceusb_dev_printdata(ir, urb->transfer_buffer, 0, len, true);
 	}
 
+	/* the transfer buffer and urb were allocated in mce_request_packet */
+	kfree(urb->transfer_buffer);
+	usb_free_urb(urb);
 }
 
 /* request incoming or send outgoing usb packet - used to initialize remote */

