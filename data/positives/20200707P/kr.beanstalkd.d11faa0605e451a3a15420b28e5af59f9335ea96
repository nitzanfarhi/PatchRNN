commit d11faa0605e451a3a15420b28e5af59f9335ea96
Author: Graham Barr <gbarr@pobox.com>
Date:   Tue Nov 17 09:23:09 2009 -0600

    Avoid EOF warnings when reading binlogs
    
    unused free space at the end of a binlog file can cause unexpected EOF warnings
    when restarting beanstalkd. Avoid such warnings by truncating free space
    when closing a binlog file

diff --git a/binlog.c b/binlog.c
index 2bf7646..72bbe5d 100644
--- a/binlog.c
+++ b/binlog.c
@@ -261,6 +261,7 @@ binlog_close(binlog b)
 {
     if (!b) return;
     if (b->fd < 0) return;
+    if (b->free) ftruncate(b->fd, lseek(b->fd, b->free, SEEK_END));
     close(b->fd);
     b->fd = -1;
     binlog_dref(b);

