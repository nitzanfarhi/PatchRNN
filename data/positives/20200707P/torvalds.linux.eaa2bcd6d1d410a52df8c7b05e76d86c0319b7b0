commit eaa2bcd6d1d410a52df8c7b05e76d86c0319b7b0
Author: Phil Turnbull <phil.turnbull@oracle.com>
Date:   Fri May 27 13:34:04 2016 -0400

    netfilter: nf_tables: validate NFTA_SET_TABLE parameter
    
    If the NFTA_SET_TABLE parameter is missing and the NLM_F_DUMP flag is
    not set, then a NULL pointer dereference is triggered in
    nf_tables_set_lookup because ctx.table is NULL.
    
    Signed-off-by: Phil Turnbull <phil.turnbull@oracle.com>
    Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

diff --git a/net/netfilter/nf_tables_api.c b/net/netfilter/nf_tables_api.c
index 2011977cd79d..6947e255cdd8 100644
--- a/net/netfilter/nf_tables_api.c
+++ b/net/netfilter/nf_tables_api.c
@@ -2641,6 +2641,8 @@ static int nf_tables_getset(struct net *net, struct sock *nlsk,
 	/* Only accept unspec with dump */
 	if (nfmsg->nfgen_family == NFPROTO_UNSPEC)
 		return -EAFNOSUPPORT;
+	if (!nla[NFTA_SET_TABLE])
+		return -EINVAL;
 
 	set = nf_tables_set_lookup(ctx.table, nla[NFTA_SET_NAME]);
 	if (IS_ERR(set))

