commit f71bed08caa6956fa3231900e70eaec6161ad33e
Author: Michael Widenius <monty@mariadb.org>
Date:   Mon Jun 19 06:37:43 2017 +0300

    Safety fix: lock binlog_end_pos before calling signal_update
    
    The mutex is needed to ensure that sql thread should not not miss the error
    signal.

diff --git a/sql/rpl_parallel.cc b/sql/rpl_parallel.cc
index 5797b82d8fe..b274824a33b 100644
--- a/sql/rpl_parallel.cc
+++ b/sql/rpl_parallel.cc
@@ -256,7 +256,9 @@ signal_error_to_sql_driver_thread(THD *thd, rpl_group_info *rgi, int err)
   rgi->rli->stop_for_until= false;
   mysql_mutex_lock(rgi->rli->relay_log.get_log_lock());
   mysql_mutex_unlock(rgi->rli->relay_log.get_log_lock());
+  rgi->rli->relay_log.lock_binlog_end_pos();
   rgi->rli->relay_log.signal_update();
+  rgi->rli->relay_log.unlock_binlog_end_pos();
 }
 
 

