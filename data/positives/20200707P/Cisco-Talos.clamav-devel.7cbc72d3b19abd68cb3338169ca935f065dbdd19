commit 7cbc72d3b19abd68cb3338169ca935f065dbdd19
Author: aCaB <acab@clamav.net>
Date:   Tue Nov 9 15:15:53 2010 +0100

    c4w: error path engine leak

diff --git a/libclamav/bytecode.c b/libclamav/bytecode.c
index aec614a1e..44e94d0cf 100644
--- a/libclamav/bytecode.c
+++ b/libclamav/bytecode.c
@@ -2411,6 +2411,11 @@ int cli_bytecode_prepare2(struct cl_engine *engine, struct cli_all_bc *bcs, unsi
     int rc;
     struct cli_bc_ctx *ctx;
 
+    if (!bcs->count) {
+	cli_dbgmsg("No bytecodes loaded, not running builtin test\n");
+	return CL_SUCCESS;
+    }
+
     cli_detect_environment(&bcs->env);
     switch (bcs->env.arch) {
 	case arch_i386:
diff --git a/libclamav/mpool.c b/libclamav/mpool.c
index 46288db4e..3f3044f57 100644
--- a/libclamav/mpool.c
+++ b/libclamav/mpool.c
@@ -434,6 +434,7 @@ void mpool_flush(struct MP *mp) {
 	mp->u.mpm.size = mused - sizeof(*mp);
     }
     used += mp->u.mpm.size;
+    cli_dbgmsg("pool memory used: %.3f MB\n", used/(1024*1024.0));
     spam("Map flushed @%p, in use: %lu\n", mp, used);
 }
 

