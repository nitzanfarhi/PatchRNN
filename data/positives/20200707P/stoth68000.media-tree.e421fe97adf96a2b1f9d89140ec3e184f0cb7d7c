commit e421fe97adf96a2b1f9d89140ec3e184f0cb7d7c
Author: Johan Hovold <jhovold@gmail.com>
Date:   Wed May 19 00:01:34 2010 +0200

    USB: ir-usb: fix incorrect write-buffer length
    
    Returned length should include header length.
    
    Signed-off-by: Johan Hovold <jhovold@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/usb/serial/ir-usb.c b/drivers/usb/serial/ir-usb.c
index e7087f9fe479..ccbce4066d04 100644
--- a/drivers/usb/serial/ir-usb.c
+++ b/drivers/usb/serial/ir-usb.c
@@ -307,6 +307,7 @@ static int ir_prepare_write_buffer(struct usb_serial_port *port,
 						void *dest, size_t size)
 {
 	unsigned char *buf = dest;
+	int count;
 
 	/*
 	 * The first byte of the packet we send to the device contains an
@@ -317,8 +318,9 @@ static int ir_prepare_write_buffer(struct usb_serial_port *port,
 	 */
 	*buf = ir_xbof | ir_baud;
 
-	return kfifo_out_locked(&port->write_fifo, buf + 1, size - 1,
+	count = kfifo_out_locked(&port->write_fifo, buf + 1, size - 1,
 								&port->lock);
+	return count + 1;
 }
 
 static void ir_process_read_urb(struct urb *urb)

