commit d62f85d1e22e537192ce494c89540e1ac0d8bfc7
Author: Chase Douglas <chase.douglas@canonical.com>
Date:   Tue Jun 15 12:29:15 2010 -0400

    tracing/function-graph: Use correct string size for snprintf
    
    The nsecs_str string is a local variable defined as:
    
    char nsecs_str[5];
    
    It is possible for the snprintf call to use a size value larger than the
    size of the string. This should not cause a buffer overrun as it is
    written now due to the value for the string format "%03lu" can not be
    larger than 1000. However, this change makes it correct. By making the
    size correct we guard against potential future changes that could actually
    cause a buffer overrun.
    
    Signed-off-by: Chase Douglas <chase.douglas@canonical.com>
    LKML-Reference: <1276619355-18116-1-git-send-email-chase.douglas@canonical.com>
    
    [ added 'UL' to number 8 to fix gcc warning comparing it to sizeof() ]
    
    Signed-off-by: Steven Rostedt <rostedt@goodmis.org>

diff --git a/kernel/trace/trace_functions_graph.c b/kernel/trace/trace_functions_graph.c
index 79f4bac99a94..6bff23625781 100644
--- a/kernel/trace/trace_functions_graph.c
+++ b/kernel/trace/trace_functions_graph.c
@@ -641,7 +641,8 @@ trace_print_graph_duration(unsigned long long duration, struct trace_seq *s)
 
 	/* Print nsecs (we don't want to exceed 7 numbers) */
 	if (len < 7) {
-		snprintf(nsecs_str, 8 - len, "%03lu", nsecs_rem);
+		snprintf(nsecs_str, min(sizeof(nsecs_str), 8UL - len), "%03lu",
+			 nsecs_rem);
 		ret = trace_seq_printf(s, ".%s", nsecs_str);
 		if (!ret)
 			return TRACE_TYPE_PARTIAL_LINE;

