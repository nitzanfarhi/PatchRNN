commit 943b33564e78130014ca91b575181becc828179e
Author: Richard Weinberger <richard@nod.at>
Date:   Mon Oct 6 14:57:18 2014 +0200

    UBI: Fastmap: Notify user in case of an ubi_update_fastmap() failure
    
    If ubi_update_fastmap() fails notify the user.
    This is not a hard error as ubi_update_fastmap() makes sure that upon failure
    the current on-flash fastmap will no be used upon next UBI attach.
    
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/drivers/mtd/ubi/wl.c b/drivers/mtd/ubi/wl.c
index 11e0d7523d14..b9b7f97db837 100644
--- a/drivers/mtd/ubi/wl.c
+++ b/drivers/mtd/ubi/wl.c
@@ -654,7 +654,11 @@ again:
 	 * refill the WL pool synchronous. */
 	if (pool->used == pool->size || wl_pool->used == wl_pool->size) {
 		spin_unlock(&ubi->wl_lock);
-		ubi_update_fastmap(ubi);
+		ret = ubi_update_fastmap(ubi);
+		if (ret) {
+			ubi_msg(ubi, "Unable to write a new fastmap: %i", ret);
+			return -ENOSPC;
+		}
 		spin_lock(&ubi->wl_lock);
 	}
 

