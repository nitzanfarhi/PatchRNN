commit 137b4aa0d7b65aaafd34fe19e71460651165b253
Author: yuusuke <yusk.iida@gmail.com>
Date:   Thu Feb 27 20:18:08 2014 +0900

    Fix: memory leak found by valgrind was corrected.

diff --git a/cib/messages.c b/cib/messages.c
index 4d53da5f6..119640871 100644
--- a/cib/messages.c
+++ b/cib/messages.c
@@ -223,6 +223,8 @@ cib_process_ping(const char *op, int options, const char *section, xmlNode * req
 
     crm_info("Reporting our current digest to %s: %s (%d)", host, digest, cs && cs->targets);
 
+    free(digest);
+
     return pcmk_ok;
 #endif
 }
diff --git a/lib/common/xml.c b/lib/common/xml.c
index 402c87f55..5b53f851f 100644
--- a/lib/common/xml.c
+++ b/lib/common/xml.c
@@ -800,9 +800,10 @@ xml_create_patchset(int format, xmlNode *source, xmlNode *target, bool *config_c
     }
 
     if(patch && with_digest) {
-        const char *digest = calculate_xml_versioned_digest(target, FALSE, TRUE, version);
+        char *digest = calculate_xml_versioned_digest(target, FALSE, TRUE, version);
 
         crm_xml_add(patch, XML_ATTR_DIGEST, digest);
+        free(digest);
     }
     return patch;
 }
@@ -1355,7 +1356,9 @@ __xml_find_path(xmlNode *top, const char *key)
 
     free(remainder);
     free(current);
+    free(section);
     free(tag);
+    free(id);
     return target;
 }
 
@@ -1559,6 +1562,7 @@ xml_apply_patchset(xmlNode *xml, xmlNode *patchset, bool check_version)
             crm_trace("Digest matched: expected %s, calculated %s", digest, new_digest);
         }
         free(new_digest);
+        free(version);
     }
     free_xml(old);
     return rc;

