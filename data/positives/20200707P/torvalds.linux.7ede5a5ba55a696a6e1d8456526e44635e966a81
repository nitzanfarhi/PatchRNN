commit 7ede5a5ba55a696a6e1d8456526e44635e966a81
Author: Herbert Xu <herbert@gondor.apana.org.au>
Date:   Thu Jul 9 11:34:06 2009 +0800

    crypto: api - Fix crypto_drop_spawn crash on blank spawns
    
    This patch allows crypto_drop_spawn to be called on spawns that
    have not been initialised or have failed initialisation.  This
    fixes potential crashes during initialisation without adding
    special case code.
    
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

diff --git a/crypto/algapi.c b/crypto/algapi.c
index 2154815201a7..6a98076d9d2a 100644
--- a/crypto/algapi.c
+++ b/crypto/algapi.c
@@ -507,6 +507,9 @@ EXPORT_SYMBOL_GPL(crypto_init_spawn2);
 
 void crypto_drop_spawn(struct crypto_spawn *spawn)
 {
+	if (!spawn->alg)
+		return;
+
 	down_write(&crypto_alg_sem);
 	list_del(&spawn->list);
 	up_write(&crypto_alg_sem);

