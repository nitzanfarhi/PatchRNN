commit 69b8d83ecf5f6deb9ad94bdaa816aa205430d3e9
Author: Stefano Sabatini <stefano.sabatini-lala@poste.it>
Date:   Sun Dec 19 13:02:05 2010 +0000

    Fix crash in gradfun:end_frame() when inpic == outpic, so it has to be
    freed just once.
    
    Originally committed as revision 26058 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavfilter/vf_gradfun.c b/libavfilter/vf_gradfun.c
index 1cbf8d8c2..3a400a04e 100644
--- a/libavfilter/vf_gradfun.c
+++ b/libavfilter/vf_gradfun.c
@@ -228,7 +228,8 @@ static void end_frame(AVFilterLink *inlink)
     avfilter_draw_slice(outlink, 0, inlink->h, 1);
     avfilter_end_frame(outlink);
     avfilter_unref_buffer(inpic);
-    avfilter_unref_buffer(outpic);
+    if (outpic != inpic)
+        avfilter_unref_buffer(outpic);
 }
 
 AVFilter avfilter_vf_gradfun = {

