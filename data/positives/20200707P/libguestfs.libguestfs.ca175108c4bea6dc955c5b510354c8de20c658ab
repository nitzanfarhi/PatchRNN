commit ca175108c4bea6dc955c5b510354c8de20c658ab
Author: Pino Toscano <ptoscano@redhat.com>
Date:   Fri Nov 3 17:10:02 2017 +0100

    diff: avoid potential null pointer dereference on error
    
    If visit_guest() fails, then it returns a null pointer; later on,
    free_tree() is called unconditionally on the variables, thus
    dereferencing null pointers.
    
    As a solution, make free_tree() behave like free(), i.e. become no-op
    with null pointers.

diff --git a/diff/diff.c b/diff/diff.c
index 5851a1c9c..d32e9b092 100644
--- a/diff/diff.c
+++ b/diff/diff.c
@@ -424,6 +424,9 @@ free_tree (struct tree *t)
 {
   size_t i;
 
+  if (t == NULL)
+    return;
+
   for (i = 0; i < t->nr_files; ++i) {
     free (t->files[i].path);
     guestfs_free_statns (t->files[i].stat);

