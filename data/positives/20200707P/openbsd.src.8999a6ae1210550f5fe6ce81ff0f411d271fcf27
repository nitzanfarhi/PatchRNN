commit 8999a6ae1210550f5fe6ce81ff0f411d271fcf27
Author: tedu <tedu@openbsd.org>
Date:   Sat Jun 5 22:38:40 2004 +0000

    retval may be NULL in fork1, take 2

diff --git a/sys/kern/kern_fork.c b/sys/kern/kern_fork.c
index a3b887a9ca9..becb63288a8 100644
--- a/sys/kern/kern_fork.c
+++ b/sys/kern/kern_fork.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: kern_fork.c,v 1.66 2004/05/24 02:51:22 deraadt Exp $	*/
+/*	$OpenBSD: kern_fork.c,v 1.67 2004/06/05 22:38:40 tedu Exp $	*/
 /*	$NetBSD: kern_fork.c,v 1.29 1996/02/09 18:59:34 christos Exp $	*/
 
 /*
@@ -371,8 +371,10 @@ fork1(struct proc *p1, int exitsig, int flags, void *stack, size_t stacksize,
 	 * Return child pid to parent process,
 	 * marking us as parent via retval[1].
 	 */
-	retval[0] = p2->p_pid;
-	retval[1] = 0;
+	if (retval != NULL) {
+		retval[0] = p2->p_pid;
+		retval[1] = 0;
+	}
 	return (0);
 }
 

