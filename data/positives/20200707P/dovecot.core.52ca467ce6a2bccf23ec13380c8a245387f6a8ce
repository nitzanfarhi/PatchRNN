commit 52ca467ce6a2bccf23ec13380c8a245387f6a8ce
Author: Dmitry Yakunin <d.yakunin@rambler-co.ru>
Date:   Tue Apr 4 23:33:51 2017 +0300

    imapc: Fix memory leak in disconnected state

diff --git a/src/lib-imap-client/imapc-connection.c b/src/lib-imap-client/imapc-connection.c
index fc5cd4348..f12b3ca21 100644
--- a/src/lib-imap-client/imapc-connection.c
+++ b/src/lib-imap-client/imapc-connection.c
@@ -382,6 +382,9 @@ static void imapc_connection_set_state(struct imapc_connection *conn,
 
 		conn->selecting_box = NULL;
 		conn->selected_box = NULL;
+
+		i_free(conn->ips);
+		conn->ips_count = 0;
 		break;
 	default:
 		break;

