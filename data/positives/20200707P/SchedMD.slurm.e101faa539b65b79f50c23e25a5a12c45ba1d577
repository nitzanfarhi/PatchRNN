commit e101faa539b65b79f50c23e25a5a12c45ba1d577
Author: Morris Jette <jette@schedmd.com>
Date:   Tue Nov 21 08:29:54 2017 -0700

    Fix for illegal memory reference
    
    Fix for bug introduced in commit 9e0b976a291c88bedeb61
    bug 4400

diff --git a/src/slurmctld/job_scheduler.c b/src/slurmctld/job_scheduler.c
index 9dacecdbb7..76719b1984 100644
--- a/src/slurmctld/job_scheduler.c
+++ b/src/slurmctld/job_scheduler.c
@@ -2097,8 +2097,19 @@ skip_start:
 			fail_by_part = false;
 
 fail_this_part:	if (fail_by_part) {
-		 	/* do not schedule more jobs in this partition or on
-			 * nodes in this partition */
+			/* Search for duplicates */
+			for (i = 0; i < failed_part_cnt; i++) {
+				if (failed_parts[i] == job_ptr->part_ptr) {
+					fail_by_part = false;
+					break;
+				}
+			}
+		}
+		if (fail_by_part) {
+			/*
+			 * Do not schedule more jobs in this partition or on
+			 * nodes in this partition
+			 */
 			failed_parts[failed_part_cnt++] = job_ptr->part_ptr;
 			bit_and_not(avail_node_bitmap,
 				job_ptr->part_ptr->node_bitmap);

