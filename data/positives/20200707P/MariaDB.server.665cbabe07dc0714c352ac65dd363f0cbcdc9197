commit 665cbabe07dc0714c352ac65dd363f0cbcdc9197
Author: gluh@mysql.com <>
Date:   Thu May 5 12:24:10 2005 +0500

    Bug #5843: Server code does not check whether PID file was successfully written

diff --git a/sql/mysqld.cc b/sql/mysqld.cc
index 682733abd89..8ade81401aa 100644
--- a/sql/mysqld.cc
+++ b/sql/mysqld.cc
@@ -6749,9 +6749,15 @@ static void create_pid_file()
     char buff[21], *end;
     end= int10_to_str((long) getpid(), buff, 10);
     *end++= '\n';
-    (void) my_write(file, (byte*) buff, (uint) (end-buff),MYF(MY_WME));
+    if (!my_write(file, (byte*) buff, (uint) (end-buff), MYF(MY_WME | MY_NABP)))
+    {
+      (void) my_close(file, MYF(0));
+      return;
+    }
     (void) my_close(file, MYF(0));
   }
+  sql_perror("Can't start server: can't create PID file");
+  exit(1);  
 }
 
 

