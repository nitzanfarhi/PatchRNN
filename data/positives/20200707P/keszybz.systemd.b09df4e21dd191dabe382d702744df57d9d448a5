commit b09df4e21dd191dabe382d702744df57d9d448a5
Author: Lennart Poettering <lennart@poettering.net>
Date:   Thu Jun 16 22:46:44 2016 +0200

    process-util: fix two bugs in get_process_cmdline() (#3555)
    
    See:
    
    https://github.com/systemd/systemd/pull/3529#issuecomment-226421007

diff --git a/src/basic/process-util.c b/src/basic/process-util.c
index b5b068ad3..20768b715 100644
--- a/src/basic/process-util.c
+++ b/src/basic/process-util.c
@@ -161,6 +161,8 @@ int get_process_cmdline(pid_t pid, size_t max_length, bool comm_fallback, char *
 
                 if (len > 0)
                         r[len] = 0;
+                else
+                        r = mfree(r);
 
         } else {
                 bool dotdotdot = false;
@@ -214,7 +216,7 @@ int get_process_cmdline(pid_t pid, size_t max_length, bool comm_fallback, char *
                         }
 
                         strncpy(k, "...", left-1);
-                        k[left] = 0;
+                        k[left-1] = 0;
                 } else
                         *k = 0;
         }

