commit 79a0ec1af4817bb7b989803b9f460d1e4acaf7b7
Author: Mina Nagy Zaki <mnzaki@gmail.com>
Date:   Wed Jun 8 19:24:25 2011 +0300

    lavfi: avfilter_merge_formats: handle case where inputs are same
    
    This fixes a double-free crash if lists are the same due to the two
    merge_ref() calls at the end of the (useless) merging that happens.

diff --git a/libavfilter/formats.c b/libavfilter/formats.c
index ec7fca3817..58593fcce0 100644
--- a/libavfilter/formats.c
+++ b/libavfilter/formats.c
@@ -44,6 +44,8 @@ AVFilterFormats *avfilter_merge_formats(AVFilterFormats *a, AVFilterFormats *b)
     AVFilterFormats *ret;
     unsigned i, j, k = 0;
 
+    if (a == b) return a;
+
     ret = av_mallocz(sizeof(AVFilterFormats));
 
     /* merge list of formats */

