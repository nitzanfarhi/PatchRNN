commit bf738120454d27d9c2ac4f939ab79e4be60a2259
Author: relan <relan@users.noreply.github.com>
Date:   Mon May 20 16:41:35 2013 +0000

    Update volume label in struct exfat on exfat_set_label().

diff --git a/libexfat/node.c b/libexfat/node.c
index 3295299..c34452a 100644
--- a/libexfat/node.c
+++ b/libexfat/node.c
@@ -389,7 +389,7 @@ static int readdir(struct exfat* ef, const struct exfat_node* parent,
 				goto error;
 			}
 			if (utf16_to_utf8(ef->label, label->name,
-						sizeof(ef->label), EXFAT_ENAME_MAX) != 0)
+						sizeof(ef->label) - 1, EXFAT_ENAME_MAX) != 0)
 				goto error;
 			break;
 
@@ -1051,5 +1051,6 @@ int exfat_set_label(struct exfat* ef, const char* label)
 
 	exfat_pwrite(ef->dev, &entry, sizeof(struct exfat_entry_label),
 			co2o(ef, cluster, offset));
+	strcpy(ef->label, label);
 	return 0;
 }

