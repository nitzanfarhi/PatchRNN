commit 287f00730c6567834d4da5d90e7cf74b910e2016
Author: David.Zhao <david.zhao@oracle.com>
Date:   Thu Jan 29 20:52:07 2015 +0800

    Bug#20381330 VALGRIND: MEMORY LEAK WHEN DOING SPATIAL OPERATIONS ON GEOMETRYCOLLECTIONS
    
    Only create the m_geo_vect array in constructor of Gis_wkb_vector<T> if given
    a valid WKB pointer (ptr != NULL).

diff --git a/sql/spatial.h b/sql/spatial.h
index 5a8b0237591..69bab71124c 100644
--- a/sql/spatial.h
+++ b/sql/spatial.h
@@ -2452,7 +2452,8 @@ Gis_wkb_vector(const void *ptr, size_t nbytes, const Flags_t &flags,
 
   wkbType geotype= get_geotype();
   // Points don't need it, polygon creates it when parsing.
-  if (geotype != Geometry::wkb_point && geotype != Geometry::wkb_polygon)
+  if (geotype != Geometry::wkb_point &&
+      geotype != Geometry::wkb_polygon && ptr != NULL)
     guard.reset(m_geo_vect= new Geo_vector());
   // For polygon parsing to work
   if (geotype == Geometry::wkb_polygon)

