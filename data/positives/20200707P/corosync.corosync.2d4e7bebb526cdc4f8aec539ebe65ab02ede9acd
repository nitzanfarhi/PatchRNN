commit 2d4e7bebb526cdc4f8aec539ebe65ab02ede9acd
Author: Jan Friesse <jfriesse@redhat.com>
Date:   Wed Nov 7 16:56:33 2012 +0100

    Handle segfault in backlog_get
    
    If instance->memb_state is not OPERATION or RECOVERY, we was passing NULL
    to cs_queue_used call.
    
    Signed-off-by: Jan Friesse <jfriesse@redhat.com>
    Reviewed-by: Fabio M. Di Nitto <fdinitto@redhat.com>

diff --git a/exec/totemsrp.c b/exec/totemsrp.c
index b0a05606..7fcee9bd 100644
--- a/exec/totemsrp.c
+++ b/exec/totemsrp.c
@@ -3414,7 +3414,10 @@ static unsigned int backlog_get (struct totemsrp_instance *instance)
 	if (instance->memb_state == MEMB_STATE_RECOVERY) {
 		queue_use = &instance->retrans_message_queue;
 	}
-	backlog = cs_queue_used (queue_use);
+
+	if (queue_use != NULL) {
+		backlog = cs_queue_used (queue_use);
+	}
 
 	instance->stats.token[instance->stats.latest_token].backlog_calc = backlog;
 	return (backlog);

