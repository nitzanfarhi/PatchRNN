commit a2c4b4ab96aea5192d2cd06108bf112f2af7b92c
Author: Ken <knielson@adaptivecomputing.com>
Date:   Thu Oct 3 16:56:31 2013 -0600

    Fixed a memory leak in set_nodes where host_info was not
    getting freed. TRQ-1599

diff --git a/src/server/node_manager.c b/src/server/node_manager.c
index 13288e7b1..cf3ce2c67 100644
--- a/src/server/node_manager.c
+++ b/src/server/node_manager.c
@@ -4202,7 +4202,20 @@ int add_multi_reqs_to_job(
   return(PBSE_NONE);
   } /* END add_multi_reqs_to_job() */
 
+int free_hostinfo(
 
+    std::vector<job_reservation_info *>  &host_info) /* O */
+
+  {
+  for (unsigned int i = 0; i < host_info.size(); i++)
+    {
+    job_reservation_info *host_single = host_info[i];
+
+    if (host_single != NULL)
+      free(host_single);
+    }
+  return(PBSE_NONE);
+  }
 
 
 /*
@@ -4324,6 +4337,7 @@ int set_nodes(
     {
     free_nodes(pjob);
     free_alps_req_data_array(ard_array, num_reqs);
+    free_hostinfo(host_info);
     return(rc);
     }
 
@@ -4331,6 +4345,7 @@ int set_nodes(
     {
     free_nodes(pjob);
     free_alps_req_data_array(ard_array, num_reqs);
+    free_hostinfo(host_info);
     return(rc);
     }
 
@@ -4349,6 +4364,7 @@ int set_nodes(
     
     free_alps_req_data_array(ard_array, num_reqs);
 
+    free_hostinfo(host_info);
     return(PBSE_RESCUNAV);
     }  /* END if (host_info.size() == 0) */
 
@@ -4364,6 +4380,7 @@ int set_nodes(
   if (rc != PBSE_NONE)
     {
     free_alps_req_data_array(ard_array, num_reqs);
+    free_hostinfo(host_info);
     return(rc);
     }
 
@@ -4388,7 +4405,10 @@ int set_nodes(
   if (mic_list != NULL)
     {
     if ((rc = translate_howl_to_string(mic_list, EMsg, &NCount, &mic_str, NULL, FALSE)) != PBSE_NONE)
+      {
+      free_hostinfo(host_info);
       return(rc);
+      }
 
     job_attr_def[JOB_ATR_exec_mics].at_free(
       &pjob->ji_wattr[JOB_ATR_exec_mics]);
@@ -4408,6 +4428,7 @@ int set_nodes(
     if ((rc = translate_howl_to_string(gpu_list, EMsg, &NCount, &gpu_str, NULL, FALSE)) != PBSE_NONE)
       {
       free_alps_req_data_array(ard_array, num_reqs);
+      free_hostinfo(host_info);
       return(rc);
       }
 
@@ -4457,6 +4478,7 @@ int set_nodes(
 
   add_multi_reqs_to_job(pjob, num_reqs, ard_array);
   free_alps_req_data_array(ard_array, num_reqs);
+  free_hostinfo(host_info);
 
   /* SUCCESS */
 

