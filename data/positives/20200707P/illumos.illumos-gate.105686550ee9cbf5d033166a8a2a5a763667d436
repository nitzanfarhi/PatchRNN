commit 105686550ee9cbf5d033166a8a2a5a763667d436
Author: Yuri Pankov <yuri.pankov@nexenta.com>
Date:   Fri Jan 13 09:06:59 2017 -0800

    7730 libzfs`add_config() leaks config nvl when reading spare/l2cache devices
    Reviewed by: Matthew Ahrens <mahrens@delphix.com>
    Reviewed by: Serapheim Dimitropoulos <serapheim@delphix.com>
    Approved by: Robert Mustacchi <rm@joyent.com>

diff --git a/usr/src/lib/libzfs/common/libzfs_import.c b/usr/src/lib/libzfs/common/libzfs_import.c
index b73a71e94c..3b6a6d468e 100644
--- a/usr/src/lib/libzfs/common/libzfs_import.c
+++ b/usr/src/lib/libzfs/common/libzfs_import.c
@@ -237,9 +237,12 @@ add_config(libzfs_handle_t *hdl, pool_list_t *pl, const char *path,
 			free(ne);
 			return (-1);
 		}
+
 		ne->ne_guid = vdev_guid;
 		ne->ne_next = pl->names;
 		pl->names = ne;
+
+		nvlist_free(config);
 		return (0);
 	}
 

