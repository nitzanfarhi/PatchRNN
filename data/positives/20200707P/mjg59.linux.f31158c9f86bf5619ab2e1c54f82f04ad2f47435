commit f31158c9f86bf5619ab2e1c54f82f04ad2f47435
Author: Diego Calleja <diegocg@gmail.com>
Date:   Sat Oct 18 16:53:37 2008 +0200

    Staging: Fix leak in drivers/staging/at76_usb.c
    
    Fix leak in at76_usb as reported in:
    http://bugzilla.kernel.org/show_bug.cgi?id=11778
    
    
    Reported-by: Daniel Marjam√§ki <danielm77@spray.se>
    Signed-off-by: Diego Calleja <diegocg@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/staging/at76_usb/at76_usb.c b/drivers/staging/at76_usb/at76_usb.c
index 52df0c665183..174e2bec9223 100644
--- a/drivers/staging/at76_usb/at76_usb.c
+++ b/drivers/staging/at76_usb/at76_usb.c
@@ -2319,9 +2319,11 @@ static int at76_iw_handler_get_scan(struct net_device *netdev,
 	if (!iwe)
 		return -ENOMEM;
 
-	if (priv->scan_state != SCAN_COMPLETED)
+	if (priv->scan_state != SCAN_COMPLETED) {
 		/* scan not yet finished */
+		kfree(iwe);
 		return -EAGAIN;
+	}
 
 	spin_lock_irqsave(&priv->bss_list_spinlock, flags);
 

