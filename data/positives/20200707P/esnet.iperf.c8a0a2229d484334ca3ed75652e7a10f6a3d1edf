commit c8a0a2229d484334ca3ed75652e7a10f6a3d1edf
Author: Jef Poskanzer <jef@mail.acme.com>
Date:   Thu Dec 12 08:15:15 2013 -0800

    Added a check for malloc fail.
    
    Eventually we need to add a whole bunch more of these.

diff --git a/src/iperf_api.c b/src/iperf_api.c
index 67ad967..aa056ef 100644
--- a/src/iperf_api.c
+++ b/src/iperf_api.c
@@ -1363,6 +1363,11 @@ iperf_new_test()
     memset(test, 0, sizeof(struct iperf_test));
 
     test->settings = (struct iperf_settings *) malloc(sizeof(struct iperf_settings));
+    if (!test->settings) {
+        free(test);
+	i_errno = IENEWTEST;
+	return NULL;
+    }
     memset(test->settings, 0, sizeof(struct iperf_settings));
 
     return test;

