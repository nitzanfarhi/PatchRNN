commit ad49e07df28aeb3c5074640ece8fb67eafd9bdbc
Author: Alexander V. Lukyanov <lavv17f@gmail.com>
Date:   Tue May 10 16:42:55 2016 +0300

    mirror: don't remove src dir if it ends with a slash (fix #233)

diff --git a/src/MirrorJob.cc b/src/MirrorJob.cc
index a67e63e8..93cc75ea 100644
--- a/src/MirrorJob.cc
+++ b/src/MirrorJob.cc
@@ -1215,7 +1215,7 @@ int   MirrorJob::Do()
 	 break;
 
       // all jobs finished.
-      if(remove_source_dirs) {
+      if(remove_source_dirs && source_dir.last_char()!='/') {
 	 // remove source directory once.
 	 remove_source_dirs=false;
 	 if(script)
diff --git a/src/xstring.h b/src/xstring.h
index b1e016ff..2d9742ee 100644
--- a/src/xstring.h
+++ b/src/xstring.h
@@ -145,6 +145,7 @@ public:
    bool eq_nc(const char *s) const { return !xstrcasecmp(buf,s); }
    size_t length() const { return xstrlen(buf); }
    void set_length(size_t n) { if(buf) buf[n]=0; }
+   char last_char() const { size_t len=length(); return len>0?buf[len-1]:0; }
 
    void unset() { xfree(buf); buf=0; }
    void _set(const char *s) { buf=xstrdup(s); }

