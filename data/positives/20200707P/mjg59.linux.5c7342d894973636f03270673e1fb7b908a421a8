commit 5c7342d894973636f03270673e1fb7b908a421a8
Author: Josef Whiter <jwhiter@redhat.com>
Date:   Wed Mar 7 17:09:10 2007 -0500

    [GFS2] fix bz 231369, gfs2 will oops if you specify an invalid mount option
    
    If you specify an invalid mount option when trying to mount a gfs2 filesystem,
    gfs2 will oops.  The attached patch resolves this problem.
    
    Signed-off-by: Josef Whiter <jwhiter@redhat.com>
    Signed-off-by: Steven Whitehouse <swhiteho@redhat.com>

diff --git a/fs/gfs2/glock.c b/fs/gfs2/glock.c
index 9f203ef4da61..a3a24f2e99d2 100644
--- a/fs/gfs2/glock.c
+++ b/fs/gfs2/glock.c
@@ -2217,7 +2217,7 @@ int gfs2_create_debugfs_file(struct gfs2_sbd *sdp)
 
 void gfs2_delete_debugfs_file(struct gfs2_sbd *sdp)
 {
-	if (sdp->debugfs_dentry)
+	if (sdp && sdp->debugfs_dentry)
 		debugfs_remove(sdp->debugfs_dentry);
 }
 

