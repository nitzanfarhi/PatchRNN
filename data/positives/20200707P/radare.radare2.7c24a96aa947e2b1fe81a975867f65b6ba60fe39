commit 7c24a96aa947e2b1fe81a975867f65b6ba60fe39
Author: Giovanni <wargio@libero.it>
Date:   Thu Aug 24 13:36:19 2017 +0200

    fixed memory leak on p_cache (#8296)

diff --git a/libr/io/p_cache.c b/libr/io/p_cache.c
index 76a40ab85..48eedb3f4 100644
--- a/libr/io/p_cache.c
+++ b/libr/io/p_cache.c
@@ -182,6 +182,15 @@ beach:
 	return amount;
 }
 
+static void __riocache_free(void *user) {
+	RIOCache *cache = (RIOCache *) user;
+	if (cache) {
+		free (cache->data);
+		free (cache->odata);
+	}
+	free (cache);
+}
+
 static int __desc_cache_list_cb(void *user, const char *k, const char *v) {
 	RList *writes = (RList *)user;
 	RIODescCache *dcache;
@@ -215,6 +224,7 @@ static int __desc_cache_list_cb(void *user, const char *k, const char *v) {
 		} else if (cache) {
 			ut8 *data = realloc (cache->data, i);
 			if (!data) {
+				__riocache_free ((void *) cache);
 				return false;
 			}
 			cache->data = data;
@@ -233,15 +243,6 @@ static int __desc_cache_list_cb(void *user, const char *k, const char *v) {
 	return true;
 }
 
-static void __riocache_free(void *user) {
-	RIOCache *cache = (RIOCache *)user;
-	if (cache) {
-		free (cache->data);
-		free (cache->odata);
-	}
-	free (cache);
-}
-
 R_API RList *r_io_desc_cache_list(RIODesc *desc) {
 	RList *writes;
 	RIODesc *current;

