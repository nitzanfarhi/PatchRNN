commit c80da27e868f6ffbe1c6588937aa4e7aeab21dec
Author: Johan Hedberg <johan.hedberg@intel.com>
Date:   Wed Feb 22 15:38:48 2012 +0200

    Bluetooth: mgmt: Fix clearing of hdev->eir
    
    The hdev->eir buffer needs to be cleared when clearing the EIR data.
    Otherwise subsequent attempts at setting the EIR to something valid
    again may fail because the code thinks that the EIR hasn't changed.
    
    Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
    Acked-by: Marcel Holtmann <marcel@holtmann.org>

diff --git a/net/bluetooth/mgmt.c b/net/bluetooth/mgmt.c
index bdaadb278ce7..08c657df7f8c 100644
--- a/net/bluetooth/mgmt.c
+++ b/net/bluetooth/mgmt.c
@@ -3400,6 +3400,8 @@ static int clear_eir(struct hci_dev *hdev)
 	if (!(hdev->features[6] & LMP_EXT_INQ))
 		return 0;
 
+	memset(hdev->eir, 0, sizeof(hdev->eir));
+
 	memset(&cp, 0, sizeof(cp));
 
 	return hci_send_cmd(hdev, HCI_OP_WRITE_EIR, sizeof(cp), &cp);

