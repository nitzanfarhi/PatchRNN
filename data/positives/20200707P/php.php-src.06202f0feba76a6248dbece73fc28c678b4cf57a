commit 06202f0feba76a6248dbece73fc28c678b4cf57a
Author: Anatol Belski <ab@php.net>
Date:   Mon Nov 27 21:18:08 2017 +0100

    Fix allocation

diff --git a/ext/standard/basic_functions.c b/ext/standard/basic_functions.c
index 76d194106c..5ab301aeb2 100644
--- a/ext/standard/basic_functions.c
+++ b/ext/standard/basic_functions.c
@@ -4098,7 +4098,7 @@ PHP_FUNCTION(getenv)
 				RETURN_EMPTY_STRING();
 		}
 
-		valw = emalloc(size);
+		valw = emalloc((size + 1) * sizeof(wchar_t));
 		size = GetEnvironmentVariableW(keyw, valw, size);
 		if (size == 0) {
 				/* has been removed between the two calls */

