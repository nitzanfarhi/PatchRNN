commit d8370f7eff14ef646ba4a81eb9642800518a7324
Author: Roel Kluin <roel.kluin@gmail.com>
Date:   Fri Sep 18 20:33:27 2009 -0300

    V4L/DVB (13017): gspca: kmalloc failure ignored in sd_start()
    
    Prevent NULL dereference if kmalloc() fails.
    
    Cc: Jean-Francois Moine <moinejf@free.fr>
    Signed-off-by: Roel Kluin <roel.kluin@gmail.com>
    Signed-off-by: Douglas Schilling Landgraf <dougsland@redhat.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/video/gspca/jeilinj.c b/drivers/media/video/gspca/jeilinj.c
index dbfa3ed6e8ef..a11c97ebeb0f 100644
--- a/drivers/media/video/gspca/jeilinj.c
+++ b/drivers/media/video/gspca/jeilinj.c
@@ -312,6 +312,8 @@ static int sd_start(struct gspca_dev *gspca_dev)
 
 	/* create the JPEG header */
 	dev->jpeg_hdr = kmalloc(JPEG_HDR_SZ, GFP_KERNEL);
+	if (dev->jpeg_hdr == NULL)
+		return -ENOMEM;
 	jpeg_define(dev->jpeg_hdr, gspca_dev->height, gspca_dev->width,
 			0x21);          /* JPEG 422 */
 	jpeg_set_qual(dev->jpeg_hdr, dev->quality);

