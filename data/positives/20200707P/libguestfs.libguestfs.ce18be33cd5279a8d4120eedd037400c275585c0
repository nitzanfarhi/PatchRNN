commit ce18be33cd5279a8d4120eedd037400c275585c0
Author: Richard W.M. Jones <rjones@redhat.com>
Date:   Tue Aug 23 19:50:11 2011 +0100

    Coverity: fix memory leak along error path.

diff --git a/src/appliance.c b/src/appliance.c
index 9f8695406..836e67922 100644
--- a/src/appliance.c
+++ b/src/appliance.c
@@ -402,6 +402,12 @@ check_for_cached_appliance (guestfs_h *g,
   /* Releases the lock on checksum. */
   if (close (fd) == -1) {
     perrorf (g, "close");
+    /* Allocated in hard_link_to_cached_appliance above, must be
+     * freed along this error path.
+     */
+    free (*kernel);
+    free (*initrd);
+    free (*appliance);
     return -1;
   }
 
@@ -540,6 +546,12 @@ build_supermin_appliance (guestfs_h *g,
   /* Releases the lock on checksum. */
   if (close (fd) == -1) {
     perrorf (g, "close");
+    /* Allocated in hard_link_to_cached_appliance above, must be
+     * freed along this error path.
+     */
+    free (*kernel);
+    free (*initrd);
+    free (*appliance);
     return -1;
   }
 

