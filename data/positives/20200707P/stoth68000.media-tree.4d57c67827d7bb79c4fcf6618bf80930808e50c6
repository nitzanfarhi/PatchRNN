commit 4d57c67827d7bb79c4fcf6618bf80930808e50c6
Author: Felix Fietkau <nbd@openwrt.org>
Date:   Tue Oct 6 00:16:53 2015 +0200

    mac80211: add missing struct ieee80211_txq tid field initialization
    
    Signed-off-by: Felix Fietkau <nbd@openwrt.org>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/mac80211/util.c b/net/mac80211/util.c
index 60c4dbf92625..fb6e511ee0be 100644
--- a/net/mac80211/util.c
+++ b/net/mac80211/util.c
@@ -3301,9 +3301,11 @@ void ieee80211_init_tx_queue(struct ieee80211_sub_if_data *sdata,
 	if (sta) {
 		txqi->txq.sta = &sta->sta;
 		sta->sta.txq[tid] = &txqi->txq;
+		txqi->txq.tid = tid;
 		txqi->txq.ac = ieee802_1d_to_ac[tid & 7];
 	} else {
 		sdata->vif.txq = &txqi->txq;
+		txqi->txq.tid = 0;
 		txqi->txq.ac = IEEE80211_AC_BE;
 	}
 }

