commit 5a7164249e9ae47a5b5b96f7b44ed4e918e79d03
Author: Gerald Combs <gerald@wireshark.org>
Date:   Mon Aug 15 20:28:04 2005 +0000

    When we create a new tvb, make sure the memory is freed at some point.
    
    svn path=/trunk/; revision=15361

diff --git a/epan/dissectors/packet-telnet.c b/epan/dissectors/packet-telnet.c
index 5057bb1254..b47056ca8c 100644
--- a/epan/dissectors/packet-telnet.c
+++ b/epan/dissectors/packet-telnet.c
@@ -707,9 +707,6 @@ unescape_and_tvbuffify_telnet_option(packet_info *pinfo, tvbuff_t *tvb, int offs
 		return NULL;
 
 	spos=tvb_get_ptr(tvb, offset, len);
-	/* XXX we never g_free() this one.  This is done automagically
-	   when the parent tvb is destroyed?
-        */
 	buf=g_malloc(len);
 	dpos=buf;
 	skip=0;
@@ -726,6 +723,7 @@ unescape_and_tvbuffify_telnet_option(packet_info *pinfo, tvbuff_t *tvb, int offs
 		l--;
 	}
 	krb5_tvb = tvb_new_real_data(buf, len-skip, len-skip); 
+	tvb_set_free_cb(krb5_tvb, g_free);
 	tvb_set_child_real_data_tvbuff(tvb, krb5_tvb);
 	add_new_data_source(pinfo, krb5_tvb, "Unpacked Telnet Uption");
 

