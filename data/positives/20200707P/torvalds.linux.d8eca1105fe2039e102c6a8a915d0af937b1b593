commit d8eca1105fe2039e102c6a8a915d0af937b1b593
Author: Axel Lin <axel.lin@gmail.com>
Date:   Tue Jun 29 11:09:47 2010 +0800

    asus-laptop: fix a memory leak in asus_laptop_get_info error path
    
    The callers of write_acpi_int_ret() pass ACPI_ALLOCATE_BUFFER,
    the caller must kfree the returned buffer if AE_OK is returned.
    
    This patch adds a missing kfree(buffer.pointer) before return -ENOMEM
    if kstrdup fail.
    
    Signed-off-by: Axel Lin <axel.lin@gmail.com>
    Acked-by: Corentin Chary <corentincj@iksaif.net>
    Signed-off-by: Matthew Garrett <mjg@redhat.com>

diff --git a/drivers/platform/x86/asus-laptop.c b/drivers/platform/x86/asus-laptop.c
index efe8f6388906..4af5709f8317 100644
--- a/drivers/platform/x86/asus-laptop.c
+++ b/drivers/platform/x86/asus-laptop.c
@@ -1397,8 +1397,10 @@ static int asus_laptop_get_info(struct asus_laptop *asus)
 		}
 	}
 	asus->name = kstrdup(string, GFP_KERNEL);
-	if (!asus->name)
+	if (!asus->name) {
+		kfree(buffer.pointer);
 		return -ENOMEM;
+	}
 
 	if (*string)
 		pr_notice("  %s model detected\n", string);

