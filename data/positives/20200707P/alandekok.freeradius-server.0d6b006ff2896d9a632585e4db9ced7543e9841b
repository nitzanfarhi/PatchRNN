commit 0d6b006ff2896d9a632585e4db9ced7543e9841b
Author: fcusack <fcusack>
Date:   Fri Aug 30 02:29:49 2002 +0000

            don't close a nonexistent connection (null dereference)

diff --git a/src/modules/rlm_sql/drivers/rlm_sql_mysql/sql_mysql.c b/src/modules/rlm_sql/drivers/rlm_sql_mysql/sql_mysql.c
index 831b9df0f..b503286be 100644
--- a/src/modules/rlm_sql/drivers/rlm_sql_mysql/sql_mysql.c
+++ b/src/modules/rlm_sql/drivers/rlm_sql_mysql/sql_mysql.c
@@ -317,7 +317,8 @@ static int sql_close(SQLSOCK * sqlsocket, SQL_CONFIG *config) {
 
 	rlm_sql_mysql_sock *mysql_sock = sqlsocket->conn;
 
-	mysql_close(mysql_sock->sock);
+	if (mysql_sock->sock)
+		mysql_close(mysql_sock->sock);
 	mysql_sock->sock = NULL;
 
 	return 0;

