commit adcfc8281c10d74c0ca940a607e85fe5e1e9234d
Author: Bron Gondwana <brong@fastmail.fm>
Date:   Mon Nov 14 09:50:57 2016 +1100

    propcmp: don't crash if property has no string value

diff --git a/imap/http_caldav_sched.c b/imap/http_caldav_sched.c
index cfa67ad9c..046a056e4 100644
--- a/imap/http_caldav_sched.c
+++ b/imap/http_caldav_sched.c
@@ -1977,19 +1977,19 @@ static unsigned propcmp(icalcomponent *oldical, icalcomponent *newical,
 
         do {
             str = icalproperty_get_value_as_string(oldprop);
-            old_crc ^= crc32_cstring(str);
+            if (str) old_crc ^= crc32_cstring(str);
         } while ((oldprop = icalcomponent_get_next_property(oldical, kind)));
 
         do {
             str = icalproperty_get_value_as_string(newprop);
-            new_crc ^= crc32_cstring(str);
+            if (str) new_crc ^= crc32_cstring(str);
         } while ((newprop = icalcomponent_get_next_property(newical, kind)));
 
         return (old_crc != new_crc);
     }
     else {
-        return (strcmp(icalproperty_get_value_as_string(oldprop),
-                       icalproperty_get_value_as_string(newprop)) != 0);
+        return (strcmpsafe(icalproperty_get_value_as_string(oldprop),
+                           icalproperty_get_value_as_string(newprop)) != 0);
     }
 }
 

