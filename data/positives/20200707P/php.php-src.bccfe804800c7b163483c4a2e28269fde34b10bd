commit bccfe804800c7b163483c4a2e28269fde34b10bd
Author: foobar <sniper@php.net>
Date:   Mon Apr 1 23:02:16 2002 +0000

    Prevent crashing with some bogus POSTs.

diff --git a/main/rfc1867.c b/main/rfc1867.c
index 780e25c379..5c997cda6a 100644
--- a/main/rfc1867.c
+++ b/main/rfc1867.c
@@ -704,10 +704,17 @@ SAPI_API SAPI_POST_HANDLER_FUNC(rfc1867_post_handler)
 			/* If file_uploads=off, skip the file part */
 			if (!PG(file_uploads)) {
 				efree(filename);
-				efree(param);
+				if (param) efree(param);
 				continue;
 			}
 
+			/* Return with an error if the posted data is garbled */
+			if (!param) {
+				sapi_module.sapi_error(E_WARNING, "File Upload Mime headers garbled");
+				efree(filename);
+				SAFE_RETURN;
+			}
+
 			/* Handle file */
 			fp = php_open_temporary_file(PG(upload_tmp_dir), "php", &temp_filename TSRMLS_CC);
 			if (!fp) {

