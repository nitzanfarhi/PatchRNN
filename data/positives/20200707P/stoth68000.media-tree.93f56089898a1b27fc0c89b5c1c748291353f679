commit 93f56089898a1b27fc0c89b5c1c748291353f679
Author: Dave Jones <davej@redhat.com>
Date:   Thu Mar 9 10:21:27 2006 -0500

    [SCSI] fix two leaks in scsi_alloc_sdev failure paths
    
    If the scsi_alloc_queue or the slave_alloc calls in scsi_alloc_device fail,
    we forget to release the locally allocated sdev on the failure path.
    
    Coverity #609
    
    Signed-off-by: Dave Jones <davej@redhat.com>
    Signed-off-by: James Bottomley <James.Bottomley@SteelEye.com>

diff --git a/drivers/scsi/scsi_scan.c b/drivers/scsi/scsi_scan.c
index be14f9d82fde..5d4ca87af3df 100644
--- a/drivers/scsi/scsi_scan.c
+++ b/drivers/scsi/scsi_scan.c
@@ -251,6 +251,7 @@ static struct scsi_device *scsi_alloc_sdev(struct scsi_target *starget,
 		/* release fn is set up in scsi_sysfs_device_initialise, so
 		 * have to free and put manually here */
 		put_device(&starget->dev);
+		kfree(sdev);
 		goto out;
 	}
 

