commit 463b6153c3128cc74978d1ded9f12d3433e36135
Author: Sage Weil <sage@newdream.net>
Date:   Mon Nov 3 15:55:59 2008 -0800

    osd: avoid locking multiple pgs at once
    
    This is just to satisfy lockdep.

diff --git a/src/osd/OSD.cc b/src/osd/OSD.cc
index fd05132bd5..3964483baf 100644
--- a/src/osd/OSD.cc
+++ b/src/osd/OSD.cc
@@ -2270,14 +2270,17 @@ void OSD::handle_pg_create(MOSDPGCreate *m)
 	query_map[*p][pgid] = PG::Query(PG::Query::INFO, history);
     
     PG *pg = try_create_pg(pgid, t);
-    if (pg)
+    if (pg) {
       to_peer.push_back(pg);
+      pg->unlock();
+    }
   }
 
   store->apply_transaction(t);
 
   for (vector<PG*>::iterator p = to_peer.begin(); p != to_peer.end(); p++) {
     PG *pg = *p;
+    pg->lock();
     wake_pg_waiters(pg->info.pgid);
     pg->peer(t, query_map, &info_map);
     pg->update_stats();

