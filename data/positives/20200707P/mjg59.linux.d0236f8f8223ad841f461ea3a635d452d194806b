commit d0236f8f8223ad841f461ea3a635d452d194806b
Author: Akinobu Mita <akinobu.mita@gmail.com>
Date:   Tue Jul 15 02:09:53 2008 -0700

    iucv: fix memory leak in cpu hotplug error path.
    
    Fix memory leak in error path in CPU_UP_PREPARE notifier.
    
    Signed-off-by: Akinobu Mita <akinobu.mita@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/iucv/iucv.c b/net/iucv/iucv.c
index 531a206ce7a6..d8e0635aace0 100644
--- a/net/iucv/iucv.c
+++ b/net/iucv/iucv.c
@@ -567,8 +567,11 @@ static int __cpuinit iucv_cpu_notify(struct notifier_block *self,
 			return NOTIFY_BAD;
 		iucv_param[cpu] = kmalloc_node(sizeof(union iucv_param),
 				     GFP_KERNEL|GFP_DMA, cpu_to_node(cpu));
-		if (!iucv_param[cpu])
+		if (!iucv_param[cpu]) {
+			kfree(iucv_irq_data[cpu]);
+			iucv_irq_data[cpu] = NULL;
 			return NOTIFY_BAD;
+		}
 		break;
 	case CPU_UP_CANCELED:
 	case CPU_UP_CANCELED_FROZEN:

