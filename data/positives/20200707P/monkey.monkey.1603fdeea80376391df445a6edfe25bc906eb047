commit 1603fdeea80376391df445a6edfe25bc906eb047
Author: Eduardo Silva <edsiper@gmail.com>
Date:   Sat Jun 19 19:32:59 2010 -0400

    Do not free CR before check KeepAlive

diff --git a/src/connection.c b/src/connection.c
index 790d218e..3e93e7f3 100644
--- a/src/connection.c
+++ b/src/connection.c
@@ -140,8 +140,13 @@ int mk_conn_write(int socket)
         return -1;
     }
     else if (ret == 0) {
-        mk_request_free_list(cr);
-        return mk_http_request_end(socket);
+        if (mk_http_request_end(socket) < 0) {
+            mk_request_free_list(cr);
+            return -1;
+        }
+        else {
+            return 0;
+        }
     }
     else if (ret > 0) {
         return 0;

