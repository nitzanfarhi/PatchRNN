commit d352f332247e98b1a125af1d139806c1898b3a0c
Author: Jan Kundr√°t <jkt@flaska.net>
Date:   Fri Apr 20 18:24:16 2012 +0200

    Fix possible assert crash

diff --git a/src/Imap/Model/SubtreeModel.cpp b/src/Imap/Model/SubtreeModel.cpp
index de2a1b6b..d3c51c0a 100644
--- a/src/Imap/Model/SubtreeModel.cpp
+++ b/src/Imap/Model/SubtreeModel.cpp
@@ -182,6 +182,13 @@ void SubtreeModel::handleRowsRemoved(const QModelIndex &parent, int first, int l
 {
     Q_UNUSED(first);
     Q_UNUSED(last);
+
+    if (!m_rootIndex.isValid()) {
+        // Everything got replaced, apparently
+        reset();
+        return;
+    }
+
     if (!isVisibleIndex(parent))
         return;
     endRemoveRows();
@@ -198,6 +205,7 @@ void SubtreeModel::handleRowsInserted(const QModelIndex &parent, int first, int
 {
     Q_UNUSED(first);
     Q_UNUSED(last);
+
     if (!isVisibleIndex(parent))
         return;
     endInsertRows();

