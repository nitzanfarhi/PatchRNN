commit 522b702cf6c7838237569ecb65ec04997c8c7e76
Author: sunny <Unknown>
Date:   Sun Oct 5 23:44:30 2008 +0000

    branches/zip: Check for autoinc next value overflow explicitly when offset
    is > 1. This is safer and easier to understand.

diff --git a/handler/ha_innodb.cc b/handler/ha_innodb.cc
index 7388f5af9db..7e118f0f660 100644
--- a/handler/ha_innodb.cc
+++ b/handler/ha_innodb.cc
@@ -1144,7 +1144,7 @@ innobase_next_autoinc(
 		} else {
 			next_value = current + increment;
 		}
-	} else {
+	} else if (max_value > current) {
 		if (current > offset) {
 			next_value = ((current - offset) / increment) + 1;
 		} else {
@@ -1168,6 +1168,8 @@ innobase_next_autoinc(
 				next_value += offset;
 			}
 		}
+	} else {
+		next_value = max_value;
 	}
 
 	ut_a(next_value <= max_value);

