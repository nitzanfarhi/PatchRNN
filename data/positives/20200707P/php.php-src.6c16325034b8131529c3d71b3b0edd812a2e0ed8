commit 6c16325034b8131529c3d71b3b0edd812a2e0ed8
Author: Xinchen Hui <laruence@gmail.com>
Date:   Sun Mar 30 17:50:42 2014 +0800

    Fixed smart_str_setl

diff --git a/ext/standard/php_smart_str.h b/ext/standard/php_smart_str.h
index e11eb734ed..a518fbfddf 100644
--- a/ext/standard/php_smart_str.h
+++ b/ext/standard/php_smart_str.h
@@ -185,8 +185,8 @@ static inline char *smart_str_print_unsigned(char *buf, long num) {
 	smart_str_appendl_ex((dest), ((smart_str *)(src))->s->val, 		\
 		((smart_str *)(src))->s->len, (what));
 
-
 #define smart_str_setl(dest, src, nlen) do {						\
+	smart_str_free((dest));											\
 	smart_str_appendl_ex((dest), (src), (nlen), 0);					\
 } while (0)
 

