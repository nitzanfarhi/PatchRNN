commit 4f11c631c052bae519d37f1e2185229349f6a716
Author: Thomas Roessler <roessler@does-not-exist.org>
Date:   Thu Aug 16 12:42:30 2001 +0000

    Mutt's detection of overly long lines would fail with text files
    when the long line is the last one, and is not finished by a newline
    character.  This can, for instance, happen when you send out
    macintosh-generated HTML files.
    
    (And, apparently, we hit some boundary somewhere in the PGP code
    with that - I had some truncated attachments today.)

diff --git a/sendlib.c b/sendlib.c
index 42e3980f8..1930818b2 100644
--- a/sendlib.c
+++ b/sendlib.c
@@ -552,6 +552,9 @@ static void update_content_info (CONTENT *info, CONTENT_STATE *s, char *d, size_
   {
     if (was_cr)
       info->binary = 1;
+    if (linelen > info->linemax)
+      info->linemax = linelen;
+
     return;
   }
 
@@ -641,6 +644,7 @@ static void update_content_info (CONTENT *info, CONTENT_STATE *s, char *d, size_
   s->dot = dot;
   s->linelen = linelen;
   s->was_cr = was_cr;
+  
 }
 
 /* Define as 1 if iconv sometimes returns -1(EILSEQ) instead of transcribing. */

