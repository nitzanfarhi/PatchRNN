commit f21f17259538b7fb803847765eaa37bdd3e9b45a
Author: Yehuda Sadeh <yehuda@hq.newdream.net>
Date:   Mon Dec 22 13:13:20 2008 -0800

    osd: gracefully exit when create_object_store() returns NULL

diff --git a/src/osd/OSD.cc b/src/osd/OSD.cc
index 36dad35ca9..832ec3fc27 100644
--- a/src/osd/OSD.cc
+++ b/src/osd/OSD.cc
@@ -220,6 +220,8 @@ int OSD::mkfs(const char *dev, ceph_fsid fsid, int whoami)
 int OSD::peek_super(const char *dev, nstring& magic, ceph_fsid& fsid, int& whoami)
 {
   ObjectStore *store = create_object_store(dev);
+  if (!store)
+	return -ENODEV;
   int err = store->mount();
   if (err < 0) 
     return err;

