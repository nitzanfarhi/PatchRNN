commit bb98d9d1d2e791f368295c9c09c9a03fe3ac0e62
Author: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
Date:   Thu Sep 18 23:33:49 2014 +0400

    mmc: tmio: prevent endless loop in tmio_mmc_set_clock()
    
    I spent a couple of days with the driver just hanging due to me forgetting to
    specify the external crystal frequency,  so that clk_get_rate() returned 0 and
    thus the loop in tmio_mmc_set_clock() never ended. I don't think that's an
    acceptable behavior, so I suggest that the minimum frequency is checked for 0
    in tmio_mmc_host_probe().
    
    Signed-off-by: Sergei Shtylyov <sergei.shtylyov@cogentembedded.com>
    Acked-by: Ian Molton <ian.molton@codethink.co.uk>
    Cc: stable@vger.kernel.org
    Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>

diff --git a/drivers/mmc/host/tmio_mmc_pio.c b/drivers/mmc/host/tmio_mmc_pio.c
index 692e578cf4d7..e487ba4bb01a 100644
--- a/drivers/mmc/host/tmio_mmc_pio.c
+++ b/drivers/mmc/host/tmio_mmc_pio.c
@@ -1121,6 +1121,15 @@ int tmio_mmc_host_probe(struct tmio_mmc_host **host,
 		mmc->f_min = mmc->f_max / 512;
 	}
 
+	/*
+	 * Check the sanity of mmc->f_min to prevent tmio_mmc_set_clock() from
+	 * looping forever...
+	 */
+	if (mmc->f_min == 0) {
+		ret = -EINVAL;
+		goto host_free;
+	}
+
 	/*
 	 * While using internal tmio hardware logic for card detection, we need
 	 * to ensure it stays powered for it to work.

