commit b9456371a73871d001e67b5f4eac118c2c278e1c
Author: David Howells <dhowells@redhat.com>
Date:   Thu Jan 8 11:18:31 2009 +0000

    CRED: Fix commit_creds() on a process that has no mm
    
    Fix commit_creds()'s handling of a process that has no mm (such as one that is
    calling or has called daemonize()).  commit_creds() should check to see if
    task->mm is not NULL before calling set_dumpable() on it.
    
    Reported-by: Jiri Slaby <jirislaby@gmail.com>
    Signed-off-by: David Howells <dhowells@redhat.com>
    Signed-off-by: James Morris <jmorris@namei.org>

diff --git a/kernel/cred.c b/kernel/cred.c
index ff7bc071991c..480a61aec805 100644
--- a/kernel/cred.c
+++ b/kernel/cred.c
@@ -372,7 +372,8 @@ int commit_creds(struct cred *new)
 	    old->fsuid != new->fsuid ||
 	    old->fsgid != new->fsgid ||
 	    !cap_issubset(new->cap_permitted, old->cap_permitted)) {
-		set_dumpable(task->mm, suid_dumpable);
+		if (task->mm)
+			set_dumpable(task->mm, suid_dumpable);
 		task->pdeath_signal = 0;
 		smp_wmb();
 	}

