commit 8bbd90ce80d39d372857235f00c7abb208bd9e4f
Author: Márton Németh <nm127@freemail.hu>
Date:   Fri Mar 27 11:13:57 2009 -0300

    V4L/DVB (11293): uvcvideo: Add zero fill for VIDIOC_ENUM_FMT
    
    When enumerating formats with VIDIOC_ENUM_FMT the uvcvideo driver does not
    fill the reserved fields of the struct v4l2_fmtdesc with zeros as required by
    V4L2 API revision 0.24 [1]. Add the missing initializations.
    
    The patch was tested with v4l-test 0.10 [2] with CNF7129 webcam found on EeePC
    901.
    
    References:
    [1] V4L2 API specification, revision 0.24
        http://v4l2spec.bytesex.org/spec/r8367.htm
    
    [2] v4l-test: Test environment for Video For Linux Two API
        http://v4l-test.sourceforge.net/
    
    Signed-off-by: Márton Németh <nm127@freemail.hu>
    Signed-off-by: Laurent Pinchart <laurent.pinchart@skynet.be>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/video/uvc/uvc_v4l2.c b/drivers/media/video/uvc/uvc_v4l2.c
index 30781b82b6b5..2a80caa54fb4 100644
--- a/drivers/media/video/uvc/uvc_v4l2.c
+++ b/drivers/media/video/uvc/uvc_v4l2.c
@@ -673,11 +673,17 @@ static long uvc_v4l2_do_ioctl(struct file *file, unsigned int cmd, void *arg)
 	{
 		struct v4l2_fmtdesc *fmt = arg;
 		struct uvc_format *format;
+		enum v4l2_buf_type type = fmt->type;
+		__u32 index = fmt->index;
 
 		if (fmt->type != video->streaming->type ||
 		    fmt->index >= video->streaming->nformats)
 			return -EINVAL;
 
+		memset(fmt, 0, sizeof(*fmt));
+		fmt->index = index;
+		fmt->type = type;
+
 		format = &video->streaming->format[fmt->index];
 		fmt->flags = 0;
 		if (format->flags & UVC_FMT_FLAG_COMPRESSED)

