commit db22adf7fdbca178a9d803c2eb716d983e9e0e27
Author: kettenis <kettenis@openbsd.org>
Date:   Sat Oct 27 22:37:03 2007 +0000

    Grab kernel lock before calling interrupt handlers.
    
    ok miod@, deraadt@

diff --git a/sys/arch/macppc/dev/openpic.c b/sys/arch/macppc/dev/openpic.c
index 7a93112979e..f3be80fe373 100644
--- a/sys/arch/macppc/dev/openpic.c
+++ b/sys/arch/macppc/dev/openpic.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: openpic.c,v 1.40 2007/05/29 18:10:43 miod Exp $	*/
+/*	$OpenBSD: openpic.c,v 1.41 2007/10/27 22:37:03 kettenis Exp $	*/
 
 /*-
  * Copyright (c) 1995 Per Fogelstrom
@@ -650,8 +650,10 @@ ext_intr_openpic()
 			while (ih) {
 				ppc_intr_enable(1);
 
+				KERNEL_LOCK();
 				if ((*ih->ih_fun)(ih->ih_arg))
 					ih->ih_count.ec_count++;
+				KERNEL_UNLOCK();
 
 				(void)ppc_intr_disable();
 				ih = ih->ih_next;

