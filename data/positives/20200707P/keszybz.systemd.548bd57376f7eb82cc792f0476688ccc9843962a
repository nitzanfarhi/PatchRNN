commit 548bd57376f7eb82cc792f0476688ccc9843962a
Author: Evgeny Vereshchagin <evvers@ya.ru>
Date:   Thu Oct 20 09:01:45 2016 +0000

    basic: fallback to the fstat if we don't have access to the /proc/self/fdinfo
    
    https://github.com/systemd/systemd/pull/4372#discussion_r83354107:
    I get `open("/proc/self/fdinfo/13", O_RDONLY|O_CLOEXEC) = -1 EACCES (Permission denied)`
    
    327   mkdir("/proc", 0755 <unfinished ...>
    327   <... mkdir resumed> )             = -1 EEXIST (File exists)
    327   stat("/proc",  <unfinished ...>
    327   <... stat resumed> {st_dev=makedev(8, 1), st_ino=28585, st_mode=S_IFDIR|0755, st_nlink=2, st_uid=0, st_gid=0, st_blksize=1024, st_blocks=4, st_size=1024, st_atime=2016/10/14-02:55:32, st_mtime=2016/
    327   mount("proc", "/proc", "proc", MS_NOSUID|MS_NODEV|MS_NOEXEC, NULL <unfinished ...>
    327   <... mount resumed> )             = 0
    327   lstat("/proc",  <unfinished ...>
    327   <... lstat resumed> {st_dev=makedev(0, 34), st_ino=1, st_mode=S_IFDIR|0555, st_nlink=75, st_uid=65534, st_gid=65534, st_blksize=1024, st_blocks=0, st_size=0, st_atime=2016/10/14-03:13:35.971031263,
    327   lstat("/proc/sys", {st_dev=makedev(0, 34), st_ino=4026531855, st_mode=S_IFDIR|0555, st_nlink=1, st_uid=65534, st_gid=65534, st_blksize=1024, st_blocks=0, st_size=0, st_atime=2016/10/14-03:13:39.1630
    327   openat(AT_FDCWD, "/proc", O_RDONLY|O_DIRECTORY|O_CLOEXEC|O_PATH) = 11</proc>
    327   name_to_handle_at(11</proc>, "sys", {handle_bytes=128}, 0x7ffe3a238604, AT_SYMLINK_FOLLOW) = -1 EOPNOTSUPP (Operation not supported)
    327   name_to_handle_at(11</proc>, "", {handle_bytes=128}, 0x7ffe3a238608, AT_EMPTY_PATH) = -1 EOPNOTSUPP (Operation not supported)
    327   openat(11</proc>, "sys", O_RDONLY|O_CLOEXEC|O_PATH) = 13</proc/sys>
    327   open("/proc/self/fdinfo/13", O_RDONLY|O_CLOEXEC) = -1 EACCES (Permission denied)
    327   close(13</proc/sys> <unfinished ...>
    327   <... close resumed> )             = 0
    327   close(11</proc> <unfinished ...>
    327   <... close resumed> )             = 0
    
    -bash-4.3# ls -ld /proc/
    dr-xr-xr-x 76 65534 65534 0 Oct 14 02:57 /proc/
    
    -bash-4.3# ls -ld /proc/1
    dr-xr-xr-x 9 root root 0 Oct 14 02:57 /proc/1
    
    -bash-4.3# ls -ld /proc/1/fdinfo
    dr-x------ 2 65534 65534 0 Oct 14 03:00 /proc/1/fdinfo

diff --git a/src/basic/mount-util.c b/src/basic/mount-util.c
index 0ef00676e..2985cc475 100644
--- a/src/basic/mount-util.c
+++ b/src/basic/mount-util.c
@@ -162,7 +162,7 @@ int fd_is_mount_point(int fd, const char *filename, int flags) {
 
 fallback_fdinfo:
         r = fd_fdinfo_mnt_id(fd, filename, flags, &mount_id);
-        if (r == -EOPNOTSUPP)
+        if (IN_SET(r, -EOPNOTSUPP, -EACCES))
                 goto fallback_fstat;
         if (r < 0)
                 return r;

