commit 5854a32e6cb672d182ce378c69f0f7470137a062
Author: Johannes Berg <johannes@sipsolutions.net>
Date:   Mon Jun 2 09:38:04 2008 +0200

    mac80211: fix rate control initialisation
    
    In commit 2e92e6f2c50b4baf85cca968f0e6f1b5c0df7d39 ("mac80211: use rate
    index in TX control") I forgot to initialise a few new variables to -1 which
    means that the rate control algorithm is never triggered and 0 is used as
    the only rate index, effectively fixing the transmit bitrate at the lowest
    supported.
    
    This patch adds the missing initialisation.
    
    Signed-off-by: Johannes Berg <johannes@sipsolutions.net>
    Bisected-by: Sitsofe Wheeler <sitsofe@yahoo.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/mac80211/tx.c b/net/mac80211/tx.c
index 16af30811f98..332ddcb1068a 100644
--- a/net/mac80211/tx.c
+++ b/net/mac80211/tx.c
@@ -947,6 +947,8 @@ __ieee80211_tx_prepare(struct ieee80211_tx_data *tx,
 	tx->local = local;
 	tx->sdata = IEEE80211_DEV_TO_SUB_IF(dev);
 	tx->channel = local->hw.conf.channel;
+	tx->rate_idx = -1;
+	tx->last_frag_rate_idx = -1;
 	/*
 	 * Set this flag (used below to indicate "automatic fragmentation"),
 	 * it will be cleared/left by radiotap as desired.

