commit a0909cc574a94213423d45ffa12df2564e78679f
Author: Boris Brezillon <boris.brezillon@free-electrons.com>
Date:   Wed Jun 1 18:03:37 2016 +0200

    drm/atomic: Handle funcs->best_encoder == NULL case
    
    Fallback drm_atomic_helper_best_encoder() is funcs->best_encoder() is NULL
    so that DRM drivers can leave this hook unassigned if they know they want
    to use drm_atomic_helper_best_encoder().
    
    Signed-off-by: Boris Brezillon <boris.brezillon@free-electrons.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Link: http://patchwork.freedesktop.org/patch/msgid/20160601180337.28e0917b@bbrezillon

diff --git a/drivers/gpu/drm/drm_atomic_helper.c b/drivers/gpu/drm/drm_atomic_helper.c
index 939df900dcaa..599842ca0c64 100644
--- a/drivers/gpu/drm/drm_atomic_helper.c
+++ b/drivers/gpu/drm/drm_atomic_helper.c
@@ -110,8 +110,10 @@ static int handle_conflicting_encoders(struct drm_atomic_state *state,
 
 		if (funcs->atomic_best_encoder)
 			new_encoder = funcs->atomic_best_encoder(connector, conn_state);
-		else
+		else if (funcs->best_encoder)
 			new_encoder = funcs->best_encoder(connector);
+		else
+			new_encoder = drm_atomic_helper_best_encoder(connector);
 
 		if (new_encoder) {
 			if (encoder_mask & (1 << drm_encoder_index(new_encoder))) {

