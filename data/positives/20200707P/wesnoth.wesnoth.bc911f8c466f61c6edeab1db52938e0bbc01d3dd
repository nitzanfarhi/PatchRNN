commit bc911f8c466f61c6edeab1db52938e0bbc01d3dd
Author: Jyrki Vesterinen <sandgtx@gmail.com>
Date:   Sat Sep 23 17:43:19 2017 +0300

    Fix another crash on startup with SDL 2.0.6
    
    Caused by the same commit. SDL freed the old framebuffer even though we had
    a reference to it, and when we passed it to SDL_FreeSurface(), it attempted
    to free it again. It resulted in a crash depending on the C standard
    library implementation and optimization level.

diff --git a/src/sdl/surface.hpp b/src/sdl/surface.hpp
index 8139bf7d68..b45c6487bd 100644
--- a/src/sdl/surface.hpp
+++ b/src/sdl/surface.hpp
@@ -54,6 +54,9 @@ public:
 		return *this;
 	}
 
+	// Intended to be used when SDL has already freed the surface
+	void clear_without_free() { surface_ = nullptr; }
+
 	operator SDL_Surface*() const { return surface_; }
 
 	SDL_Surface* get() const { return surface_; }
diff --git a/src/video.cpp b/src/video.cpp
index edd4d402cb..5be0e524be 100644
--- a/src/video.cpp
+++ b/src/video.cpp
@@ -196,6 +196,9 @@ void CVideo::update_framebuffer()
 	if(!frameBuffer) {
 		frameBuffer = fb;
 	} else {
+		// Because SDL has already freed the old framebuffer,
+		// ensure that we won't attempt to free it.
+		frameBuffer.clear_without_free();
 		frameBuffer.assign(fb);
 	}
 }

