commit 34ec83f4c1dc0d6bf4b056f89841706907a06255
Author: Devendra Naga <devendra.aaru@gmail.com>
Date:   Thu Oct 25 02:11:51 2012 -0400

    staging: slicoss: fix a leak when kzalloc fail
    
    slic_card_locate does a kzalloc of physcard, and if it fails,
    in my previous patch i returned -ENOMEM, but left the driver leak
    the memory if card_hostid == SLIC_HOSTID_DEFAULT,
    
    fix this memory leak if the above condition is true
    
    Signed-off-by: Devendra Naga <devendra.aaru@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/slicoss/slicoss.c b/drivers/staging/slicoss/slicoss.c
index f08f4593b186..ee0f0e4e41ad 100644
--- a/drivers/staging/slicoss/slicoss.c
+++ b/drivers/staging/slicoss/slicoss.c
@@ -3657,8 +3657,11 @@ static u32 slic_card_locate(struct adapter *adapter)
 	if (!physcard) {
 		/* no structure allocated for this physical card yet */
 		physcard = kzalloc(sizeof(struct physcard), GFP_ATOMIC);
-		if (!physcard)
+		if (!physcard) {
+			if (card_hostid == SLIC_HOSTID_DEFAULT)
+				kfree(card);
 			return -ENOMEM;
+		}
 
 		physcard->next = slic_global.phys_card;
 		slic_global.phys_card = physcard;

