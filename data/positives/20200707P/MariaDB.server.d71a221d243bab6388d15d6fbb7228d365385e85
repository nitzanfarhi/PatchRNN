commit d71a221d243bab6388d15d6fbb7228d365385e85
Author: unknown <jonas@perch.ndb.mysql.com>
Date:   Mon Apr 2 09:07:15 2007 +0200

    ndb - bug#27581
      make sure not to leave partially initialized pagerage-records
    
    
    ndb/src/kernel/blocks/dbtup/DbtupPageMap.cpp:
      make sure not to leave partially initialized pagerage-records

diff --git a/ndb/src/kernel/blocks/dbtup/DbtupPageMap.cpp b/ndb/src/kernel/blocks/dbtup/DbtupPageMap.cpp
index 0bb7c8a1e41..e227ac8b5bf 100644
--- a/ndb/src/kernel/blocks/dbtup/DbtupPageMap.cpp
+++ b/ndb/src/kernel/blocks/dbtup/DbtupPageMap.cpp
@@ -453,6 +453,13 @@ Uint32 Dbtup::leafPageRangeFull(Fragrecord*  const regFragPtr, PageRangePtr curr
       ptrCheckGuard(parentPageRangePtr, cnoOfPageRangeRec, pageRange);
       if (parentPageRangePtr.p->currentIndexPos < 3) {
         ljam();
+
+        if (c_noOfFreePageRanges < tiprNoLevels) 
+        {
+          ljam();
+          return RNIL;
+        }//if
+	
 /* ---------------------------------------------------------------- */
 /*       WE HAVE FOUND AN EMPTY ENTRY IN A PAGE RANGE RECORD.       */
 /*       ALLOCATE A NEW PAGE RANGE RECORD, FILL IN THE START RANGE, */

