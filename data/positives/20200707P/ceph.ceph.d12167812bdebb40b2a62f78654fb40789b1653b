commit d12167812bdebb40b2a62f78654fb40789b1653b
Author: Yan, Zheng <zheng.z.yan@intel.com>
Date:   Fri Apr 4 20:50:41 2014 +0800

    client: fix null pointer dereference in Client::unlink
    
    Signed-off-by: Yan, Zheng <zheng.z.yan@intel.com>

diff --git a/src/client/Client.cc b/src/client/Client.cc
index 7623e173cc..51e9cd0cad 100644
--- a/src/client/Client.cc
+++ b/src/client/Client.cc
@@ -758,7 +758,7 @@ Dentry *Client::insert_dentry_inode(Dir *dir, const string& dname, LeaseStat *dl
   
   if (!dn || dn->inode == 0) {
     in->get();
-    if (old_dentry)
+    if (old_dentry && old_dentry->dir)
       unlink(old_dentry, dir == old_dentry->dir);  // keep dir open if its the same dir
     dn = link(dir, dname, in, dn);
     put_inode(in);

