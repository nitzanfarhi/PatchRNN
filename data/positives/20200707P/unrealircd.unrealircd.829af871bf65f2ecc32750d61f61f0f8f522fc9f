commit 829af871bf65f2ecc32750d61f61f0f8f522fc9f
Author: Bram Matthys <syzop@vulnscan.org>
Date:   Wed Dec 16 13:13:09 2015 +0100

    Fix empty hostname issue. This off-by-one was caused by "security enhancements" from nenofrienfrien. Thank you very much.

diff --git a/src/modules/m_nick.c b/src/modules/m_nick.c
index c8d342db..f5ae951a 100644
--- a/src/modules/m_nick.c
+++ b/src/modules/m_nick.c
@@ -1263,7 +1263,7 @@ int _register_user(aClient *cptr, aClient *sptr, char *nick, char *username, cha
 			}
 			else {
 				*user->username = '~';
-				strlcpy((user->username + 1), temp, USERLEN+1);
+				strlcpy((user->username + 1), temp, sizeof(user->username)-1);
 #ifdef HOSTILENAME
 				noident = 1;
 #endif
@@ -1313,7 +1313,7 @@ int _register_user(aClient *cptr, aClient *sptr, char *nick, char *username, cha
 			}
 
 			strlcpy(olduser, user->username + noident, USERLEN+1);
-			strlcpy(user->username + 1, stripuser, USERLEN+1);
+			strlcpy(user->username + 1, stripuser, sizeof(user->username)-1);
 			user->username[0] = '~';
 			user->username[USERLEN] = '\0';
 		}

