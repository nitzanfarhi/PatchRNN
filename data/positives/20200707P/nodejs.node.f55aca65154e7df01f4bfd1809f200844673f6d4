commit f55aca65154e7df01f4bfd1809f200844673f6d4
Author: Ben Noordhuis <info@bnoordhuis.nl>
Date:   Fri Aug 16 16:49:00 2013 +0200

    crypto: fix memory leak in randomBytes() error path
    
    This is the conceptual back-port of commit ec54873 from the master
    branch.

diff --git a/src/node_crypto.cc b/src/node_crypto.cc
index 02b0660ef0..409be357ce 100644
--- a/src/node_crypto.cc
+++ b/src/node_crypto.cc
@@ -4011,7 +4011,9 @@ void RandomBytesCheck(RandomBytesRequest* req, Local<Value> argv[2]) {
     Buffer* buffer = Buffer::New(req->data_, req->size_, RandomBytesFree, NULL);
     argv[0] = Local<Value>::New(Null());
     argv[1] = Local<Object>::New(buffer->handle_);
+    req->data_ = NULL;
   }
+  free(req->data_);
 }
 
 

