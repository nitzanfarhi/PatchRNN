commit 5f6b1ea41b46bc63f667f9b30d939b49734c20b0
Author: David S. Miller <davem@davemloft.net>
Date:   Tue May 6 00:00:16 2008 -0700

    Revert "atm: Do not free already unregistered net device."
    
    This reverts commit 65e4113684e50cee75357ce10dc9026b0929e4e9.
    
    Unlike the other cases Pavel fixed, this case did not
    setup a netdev->destructor of free_netdev, therefore this
    change was not correct.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/atm/br2684.c b/net/atm/br2684.c
index 13858e2675c5..9d52ebfc1962 100644
--- a/net/atm/br2684.c
+++ b/net/atm/br2684.c
@@ -350,6 +350,7 @@ static void br2684_push(struct atm_vcc *atmvcc, struct sk_buff *skb)
 			list_del(&brdev->br2684_devs);
 			write_unlock_irq(&devs_lock);
 			unregister_netdev(net_dev);
+			free_netdev(net_dev);
 		}
 		return;
 	}
@@ -770,6 +771,7 @@ static void __exit br2684_exit(void)
 
 		list_del(&brdev->br2684_devs);
 		unregister_netdev(net_dev);
+		free_netdev(net_dev);
 	}
 }
 

