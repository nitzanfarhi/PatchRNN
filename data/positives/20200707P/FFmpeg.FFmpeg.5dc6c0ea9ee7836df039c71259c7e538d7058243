commit 5dc6c0ea9ee7836df039c71259c7e538d7058243
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Thu Sep 26 16:43:55 2013 +0200

    avformat/mpegts: check avio_tell() return code before using it
    
    Fixes Ticket2962
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavformat/mpegts.c b/libavformat/mpegts.c
index 37bb5d8d82..67e94fb39e 100644
--- a/libavformat/mpegts.c
+++ b/libavformat/mpegts.c
@@ -1862,8 +1862,10 @@ static int handle_packet(MpegTSContext *ts, const uint8_t *packet)
         return 0;
 
     pos = avio_tell(ts->stream->pb);
-    av_assert0(pos >= TS_PACKET_SIZE);
-    ts->pos47_full = pos - TS_PACKET_SIZE;
+    if (pos >= 0) {
+        av_assert0(pos >= TS_PACKET_SIZE);
+        ts->pos47_full = pos - TS_PACKET_SIZE;
+    }
 
     if (tss->type == MPEGTS_SECTION) {
         if (is_start) {

