commit d2d979c628e4b2c4a3cb71a31841875795c79043
Author: Nick Thomas <nick@bytemark.co.uk>
Date:   Thu Apr 28 16:20:01 2011 +0100

    NBD: Avoid leaking a couple of strings when the NBD device is closed
    
    Signed-off-by: Nick Thomas <nick@bytemark.co.uk>
    Signed-off-by: Kevin Wolf <kwolf@redhat.com>

diff --git a/block/nbd.c b/block/nbd.c
index 1d6b22561b..7a52f62e7e 100644
--- a/block/nbd.c
+++ b/block/nbd.c
@@ -239,6 +239,10 @@ static int nbd_write(BlockDriverState *bs, int64_t sector_num,
 
 static void nbd_close(BlockDriverState *bs)
 {
+    BDRVNBDState *s = bs->opaque;
+    qemu_free(s->export_name);
+    qemu_free(s->host_spec);
+
     nbd_teardown_connection(bs);
 }
 

