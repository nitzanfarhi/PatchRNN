commit 17aafccab4352b422aa01fa6ebf82daff693a5b3
Author: Michel Dänzer <daenzer@vmware.com>
Date:   Fri Jan 22 09:20:00 2010 +0100

    drm/radeon/kms: Fix oops after radeon_cs_parser_init() failure.
    
    If radeon_cs_parser_init() fails, radeon_cs_ioctl() calls
    radeon_cs_parser_fini() with the non-zero error value. The latter dereferenced
    parser->ib which hasn't been initialized yet -> boom. Add a test for parser->ib
    being non-NULL before dereferencing it.
    
    Signed-off-by: Michel Dänzer <daenzer@vmware.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>

diff --git a/drivers/gpu/drm/radeon/radeon_cs.c b/drivers/gpu/drm/radeon/radeon_cs.c
index 1496cb8658ef..1190148cf5e6 100644
--- a/drivers/gpu/drm/radeon/radeon_cs.c
+++ b/drivers/gpu/drm/radeon/radeon_cs.c
@@ -189,7 +189,7 @@ static void radeon_cs_parser_fini(struct radeon_cs_parser *parser, int error)
 {
 	unsigned i;
 
-	if (error) {
+	if (error && parser->ib) {
 		radeon_bo_list_unvalidate(&parser->validated,
 						parser->ib->fence);
 	} else {

