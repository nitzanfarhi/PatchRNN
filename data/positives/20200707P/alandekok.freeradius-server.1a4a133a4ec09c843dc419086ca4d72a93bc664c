commit 1a4a133a4ec09c843dc419086ca4d72a93bc664c
Author: aland <aland>
Date:   Fri Apr 11 08:58:52 2008 +0000

            Don't leak memory on catastrophic conditions.  Closes #538

diff --git a/src/main/threads.c b/src/main/threads.c
index 8eab7a207..45d8e9df2 100644
--- a/src/main/threads.c
+++ b/src/main/threads.c
@@ -365,6 +365,8 @@ static int request_dequeue(REQUEST **request, RAD_REQUEST_FUNP *fun)
 		entry = fr_fifo_pop(thread_pool.fifo[i]);
 		rad_assert(entry != NULL);
 		entry->request->child_state = REQUEST_DONE;
+		thread_pool.num_queued--;
+		free(entry);
 	}
 
 	start = 0;

