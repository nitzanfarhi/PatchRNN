commit bbb73af95ae147e6f5704996ef544fed4cd06323
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Mon Aug 21 18:57:48 2006 +0200

    Memory leak fixes from Kevin Jamieson
    
    Mercurial revision: e8350236f995e17af3390371c1d20eecc99deb50

diff --git a/crm/tengine/actions.c b/crm/tengine/actions.c
index 1fea29145..2a9b53cfc 100644
--- a/crm/tengine/actions.c
+++ b/crm/tengine/actions.c
@@ -371,7 +371,7 @@ send_rsc_command(crm_action_t *action)
 {
 	HA_Message *cmd = NULL;
 	crm_data_t *rsc_op  = NULL;
-	char *counter = crm_itoa(transition_graph->id);
+	char *counter = NULL;
 
 	const char *task    = NULL;
 	const char *value   = NULL;
diff --git a/crm/tengine/events.c b/crm/tengine/events.c
index 1341ac75c..da847280e 100644
--- a/crm/tengine/events.c
+++ b/crm/tengine/events.c
@@ -310,12 +310,14 @@ match_graph_event(
 		crm_err("Detected action %s initiated outside of a transition",
 			this_event);
 		crm_log_message(LOG_ERR, event);
+		crm_free(update_te_uuid);
 		return -2;
 		
 	} else if(safe_str_neq(update_te_uuid, te_uuid)) {
 		crm_info("Detected action %s from a different transitioner:"
 			 " %s vs. %s", this_event, update_te_uuid, te_uuid);
 		crm_log_message(LOG_INFO, event);
+		crm_free(update_te_uuid);
 		return -3;
 		
 	} else if(transition_graph->id != transition_i) {
@@ -323,8 +325,11 @@ match_graph_event(
 			 " %d vs. %d", this_event, transition_i,
 			 transition_graph->id);
 		crm_log_message(LOG_INFO, event);
+		crm_free(update_te_uuid);
 		return -4;
 	}
+
+	crm_free(update_te_uuid);
 	
 	/* stop this event's timer if it had one */
 	stop_te_timer(action->timer);

