commit 93a398a012993fa3ee6ee374fa8409a3b578ddd6
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Jun 15 21:03:08 2009 -0400

    auth: Don't assert-crash if trying to log in as master user but with empty login username.
    
    --HG--
    branch : HEAD

diff --git a/src/auth/auth-request.c b/src/auth/auth-request.c
index 4565df25c..093578beb 100644
--- a/src/auth/auth-request.c
+++ b/src/auth/auth-request.c
@@ -822,6 +822,11 @@ bool auth_request_set_username(struct auth_request *request,
 			/* it does, set it. */
 			login_username = t_strdup_until(username, p);
 
+			if (*login_username == '\0') {
+				*error_r = "Empty login username";
+				return FALSE;
+			}
+
 			/* username is the master user */
 			username = p + 1;
 		}

