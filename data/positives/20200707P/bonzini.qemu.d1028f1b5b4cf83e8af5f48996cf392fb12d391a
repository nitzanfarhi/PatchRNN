commit d1028f1b5b4cf83e8af5f48996cf392fb12d391a
Author: Christian Borntraeger <borntraeger@de.ibm.com>
Date:   Wed Feb 12 16:17:35 2014 +0100

    s390-ccw.img: Fix sporadic reboot hangs: Initialize next_idx
    
    The current code does not initialize next_idx in the virtio ring.
    As the ccw bios will always use guest memory at a fixed location,
    this queue might != 0 after a reboot.
    Lets make the initialization explicit.
    
    Signed-off-by: Christian Borntraeger <borntraeger@de.ibm.com>
    Reviewed-by: Cornelia Huck <cornelia.huck@de.ibm.com>

diff --git a/pc-bios/s390-ccw/virtio.c b/pc-bios/s390-ccw/virtio.c
index 4d6e48fcbe..a46914dd68 100644
--- a/pc-bios/s390-ccw/virtio.c
+++ b/pc-bios/s390-ccw/virtio.c
@@ -124,6 +124,7 @@ static void vring_init(struct vring *vr, unsigned int num, void *p,
     vr->used->flags = VRING_USED_F_NO_NOTIFY;
     vr->used->idx = 0;
     vr->used_idx = 0;
+    vr->next_idx = 0;
 
     debug_print_addr("init vr", vr);
 }

