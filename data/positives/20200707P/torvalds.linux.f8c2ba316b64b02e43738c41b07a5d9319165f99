commit f8c2ba316b64b02e43738c41b07a5d9319165f99
Author: Daniel Vetter <daniel.vetter@ffwll.ch>
Date:   Wed Jul 29 08:32:43 2015 +0200

    drm: Fixup locking WARNINGs in drm_mode_config_reset
    
    With
    
    commit 7a3f3d6667f5f9ffd1517f6b21d64bbf5312042c
    Author: Daniel Vetter <daniel.vetter@ffwll.ch>
    Date:   Thu Jul 9 23:44:28 2015 +0200
    
        drm: Check locking in drm_for_each_connector
    
    we started checking the locking in drm_for_each_connector but somehow
    I totally missed drm_mode_config_reset. There's no problem there since
    this function should only be called in single-threaded contexts
    (driver load or resume), so just wrap the loop with the right lock.
    
    v2: Drink coffee and all that ...
    
    Cc: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Reported-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Tested-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@intel.com>

diff --git a/drivers/gpu/drm/drm_crtc.c b/drivers/gpu/drm/drm_crtc.c
index dfac394d0602..7d02e32b4e94 100644
--- a/drivers/gpu/drm/drm_crtc.c
+++ b/drivers/gpu/drm/drm_crtc.c
@@ -5273,12 +5273,14 @@ void drm_mode_config_reset(struct drm_device *dev)
 		if (encoder->funcs->reset)
 			encoder->funcs->reset(encoder);
 
+	mutex_lock(&dev->mode_config.mutex);
 	drm_for_each_connector(connector, dev) {
 		connector->status = connector_status_unknown;
 
 		if (connector->funcs->reset)
 			connector->funcs->reset(connector);
 	}
+	mutex_unlock(&dev->mode_config.mutex);
 }
 EXPORT_SYMBOL(drm_mode_config_reset);
 

