commit 41bdecf17e6dba92256c65972ec79a482d978be5
Author: stephen hemminger <shemminger@vyatta.com>
Date:   Wed Nov 11 07:39:27 2009 +0000

    decnet: add RTNL lock when reading address list
    
    Add missing locking in the case of auto binding to the
    default device. The address list might change while this code is looking
    at the list.
    
    Compile tested only, I am not a decnet user.
    
    Signed-off-by: Stephen Hemminger <shemminger@vyatta.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/decnet/dn_dev.c b/net/decnet/dn_dev.c
index b5ef237c8a74..5790d660bc7d 100644
--- a/net/decnet/dn_dev.c
+++ b/net/decnet/dn_dev.c
@@ -828,13 +828,17 @@ static int dn_dev_get_first(struct net_device *dev, __le16 *addr)
 	struct dn_dev *dn_db = (struct dn_dev *)dev->dn_ptr;
 	struct dn_ifaddr *ifa;
 	int rv = -ENODEV;
+
 	if (dn_db == NULL)
 		goto out;
+
+	rtnl_lock();
 	ifa = dn_db->ifa_list;
 	if (ifa != NULL) {
 		*addr = ifa->ifa_local;
 		rv = 0;
 	}
+	rtnl_unlock();
 out:
 	return rv;
 }

