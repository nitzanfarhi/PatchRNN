commit 4eb8b9031a0314539605733597b1e30222d4da70
Author: YOSHIFUJI Hideaki / 吉藤英明 <yoshfuji@linux-ipv6.org>
Date:   Sun Apr 25 08:59:07 2010 +0000

    bridge br_multicast: Ensure to initialize BR_INPUT_SKB_CB(skb)->mrouters_only.
    
    Even with commit 32dec5dd0233ebffa9cae25ce7ba6daeb7df4467 ("bridge
    br_multicast: Don't refer to BR_INPUT_SKB_CB(skb)->mrouters_only
    without IGMP snooping."), BR_INPUT_SKB_CB(skb)->mrouters_only is
    not appropriately initialized if IGMP snooping support is
    compiled and disabled, so we can see garbage.
    
    Signed-off-by: YOSHIFUJI Hideaki <yoshfuji@linux-ipv6.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/bridge/br_multicast.c b/net/bridge/br_multicast.c
index 386c15369d91..eaa0e1bae49b 100644
--- a/net/bridge/br_multicast.c
+++ b/net/bridge/br_multicast.c
@@ -957,9 +957,6 @@ static int br_multicast_ipv4_rcv(struct net_bridge *br,
 	unsigned offset;
 	int err;
 
-	BR_INPUT_SKB_CB(skb)->igmp = 0;
-	BR_INPUT_SKB_CB(skb)->mrouters_only = 0;
-
 	/* We treat OOM as packet loss for now. */
 	if (!pskb_may_pull(skb, sizeof(*iph)))
 		return -EINVAL;
@@ -1049,6 +1046,9 @@ static int br_multicast_ipv4_rcv(struct net_bridge *br,
 int br_multicast_rcv(struct net_bridge *br, struct net_bridge_port *port,
 		     struct sk_buff *skb)
 {
+	BR_INPUT_SKB_CB(skb)->igmp = 0;
+	BR_INPUT_SKB_CB(skb)->mrouters_only = 0;
+
 	if (br->multicast_disabled)
 		return 0;
 

