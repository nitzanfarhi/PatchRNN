commit f98b69fec1b012b09e6d1eefd53527b3c5b35729
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Nov 5 12:15:53 2010 +0000

    lib-auth: Don't crash in auth_master_*() lookups if caller hasn't created ioloop.

diff --git a/src/lib-auth/auth-master.c b/src/lib-auth/auth-master.c
index 2f5455189..b197ca35a 100644
--- a/src/lib-auth/auth-master.c
+++ b/src/lib-auth/auth-master.c
@@ -370,7 +370,8 @@ static int auth_master_run_cmd(struct auth_master_connection *conn,
 		io_loop_run(conn->ioloop);
 	}
 
-	auth_master_unset_io(conn, prev_ioloop);
+	if (prev_ioloop != NULL)
+		auth_master_unset_io(conn, prev_ioloop);
 	if (conn->aborted) {
 		conn->aborted = FALSE;
 		auth_connection_close(conn);

