commit 2575f8be0e7f187ff4c2c7b8aa85dc3b38b7a692
Author: Luke Dashjr <luke-jr+git@utopios.org>
Date:   Tue Jul 23 21:05:17 2013 +0000

    Bugfix: setup_stratum_curl: Hold stratum lock until connection completes, to avoid potential races

diff --git a/util.c b/util.c
index c2157820..1a7ba0f8 100644
--- a/util.c
+++ b/util.c
@@ -1979,7 +1979,6 @@ static bool setup_stratum_curl(struct pool *pool)
 		quit(1, "Failed to curl_easy_init in initiate_stratum");
 	if (pool->sockbuf)
 		pool->sockbuf[0] = '\0';
-	mutex_unlock(&pool->stratum_lock);
 
 	curl = pool->stratum_curl;
 
@@ -2038,6 +2037,8 @@ static bool setup_stratum_curl(struct pool *pool)
 	pool->cgminer_pool_stats.times_sent++;
 	pool->cgminer_pool_stats.times_received++;
 
+	mutex_unlock(&pool->stratum_lock);
+	
 	return true;
 }
 

