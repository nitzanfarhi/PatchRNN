commit 0357dfbc10da50e0b83c51c7fc46292cf0ac1414
Author: Tomas Sykora <tosykora@redhat.com>
Date:   Mon Nov 28 07:07:43 2016 -0500

    Fix segfault after stopping rsyslog service when imjournal and imuxsock
    are loaded and $OmitLocalLogging is on.
    
    Imuxsock tries to close socket on index 0 which ends with segfault.

diff --git a/plugins/imuxsock/imuxsock.c b/plugins/imuxsock/imuxsock.c
index c24f6e163..3fe9267aa 100644
--- a/plugins/imuxsock/imuxsock.c
+++ b/plugins/imuxsock/imuxsock.c
@@ -1507,6 +1507,11 @@ BEGINafterRun
 	int i;
 CODESTARTafterRun
 	/* do cleanup here */
+        if(startIndexUxLocalSockets == 1 && nfd == 1) {
+                /* No sockets were configured, no cleanup needed. */
+                return RS_RET_OK;
+        }
+
 	/* Close the UNIX sockets. */
        for (i = 0; i < nfd; i++)
 		if (listeners[i].fd != -1)

