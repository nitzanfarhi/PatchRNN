commit 29bb0c9dd3d3b31a212b5e561583d392e924b0a7
Author: Antony Dovgal <tony2001@php.net>
Date:   Thu Jul 24 14:30:58 2008 +0000

    drop freeing of uninitialized variable
    add missing return
    nuke unused variable

diff --git a/ext/fileinfo/libmagic/apprentice.c b/ext/fileinfo/libmagic/apprentice.c
index 60e8f8b9f1..3ebab46fcb 100644
--- a/ext/fileinfo/libmagic/apprentice.c
+++ b/ext/fileinfo/libmagic/apprentice.c
@@ -351,7 +351,6 @@ file_apprentice(struct magic_set *ms, const char *fn, int action)
 	if (fn == NULL) {
 #ifdef PHP_BUNDLE
 		if ((mlist = malloc(sizeof(*mlist))) == NULL) {
-			free(mfn);
 			file_oomem(ms, sizeof(*mlist));
 			return NULL;
 		}
@@ -583,6 +582,7 @@ set_test_type(struct magic *mstart, struct magic *m)
 		/* invalid search type, but no need to complain here */
 		break;
 	}
+	return 1;
 }
 
 /*
diff --git a/ext/fileinfo/libmagic/funcs.c b/ext/fileinfo/libmagic/funcs.c
index d9e84fa6da..ef3d3e7dac 100644
--- a/ext/fileinfo/libmagic/funcs.c
+++ b/ext/fileinfo/libmagic/funcs.c
@@ -48,7 +48,6 @@ protected int
 file_printf(struct magic_set *ms, const char *fmt, ...)
 {
 	va_list ap;
-	size_t size;
 	int len;
 	char *buf, *newstr;
 

