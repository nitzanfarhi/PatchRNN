commit dd9c8272c26fec44b336db49047c4e35889f8fd2
Author: Stephen Henson <drh@apache.org>
Date:   Thu Apr 1 18:47:27 2010 +0000

    Free surrounding PKCS7 structure to avoid a leak.
    
    
    git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/trunk@930063 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/modules/ssl/ssl_util.c b/modules/ssl/ssl_util.c
index bdd5a88f18..912e8bb642 100644
--- a/modules/ssl/ssl_util.c
+++ b/modules/ssl/ssl_util.c
@@ -302,10 +302,14 @@ STACK_OF(X509) *ssl_read_pkcs7(server_rec *s, const char *pkcs7)
     switch (OBJ_obj2nid(p7->type)) {
     case NID_pkcs7_signed:
         certs = p7->d.sign->cert;
+        p7->d.sign->cert = NULL;
+        PKCS7_free(p7);
         break;
 
     case NID_pkcs7_signedAndEnveloped:
         certs = p7->d.signed_and_enveloped->cert;
+        p7->d.signed_and_enveloped->cert = NULL;
+        PKCS7_free(p7);
         break;
 
     default:

