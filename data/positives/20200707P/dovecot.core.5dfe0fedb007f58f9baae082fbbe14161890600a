commit 5dfe0fedb007f58f9baae082fbbe14161890600a
Author: Timo Sirainen <timo.sirainen@dovecot.fi>
Date:   Mon Dec 18 14:04:48 2017 +0200

    lib-smtp: smtp_server_connection_pending_command_data() - don't crash if smtp_parser is NULL

diff --git a/src/lib-smtp/smtp-server-connection.c b/src/lib-smtp/smtp-server-connection.c
index 6789dfef0..6f871714d 100644
--- a/src/lib-smtp/smtp-server-connection.c
+++ b/src/lib-smtp/smtp-server-connection.c
@@ -579,6 +579,8 @@ static void smtp_server_connection_input(struct connection *_conn)
 bool smtp_server_connection_pending_command_data(
 	struct smtp_server_connection *conn)
 {
+	if (conn->smtp_parser == NULL)
+		return FALSE;
 	return smtp_command_parser_pending_data(conn->smtp_parser);
 }
 

