commit 5bf0da7dd0ae193e072412519cba1d77b6196c61
Author: Nicolas Morey-Chaisemartin <nicolas.morey-chaisemartin@ext.bull.net>
Date:   Tue Apr 21 10:11:06 2009 -0700

    mlx4_core: Fix memory leak in mlx4_enable_msi_x()
    
    When the msi_x option is enabled but pci_enable_msix() fails (not
    enough vectors are available etc), the entries array was not freed on
    the error path.
    
    Signed-off-by: Nicolas Morey-Chaisemartin <nicolas.morey-chaisemartin@ext.bull.net>
    Signed-off-by: Roland Dreier <rolandd@cisco.com>

diff --git a/drivers/net/mlx4/main.c b/drivers/net/mlx4/main.c
index 102bac90a302..30bea9689694 100644
--- a/drivers/net/mlx4/main.c
+++ b/drivers/net/mlx4/main.c
@@ -976,7 +976,7 @@ static void mlx4_enable_msi_x(struct mlx4_dev *dev)
 				nreq = err;
 				goto retry;
 			}
-
+			kfree(entries);
 			goto no_msi;
 		}
 

