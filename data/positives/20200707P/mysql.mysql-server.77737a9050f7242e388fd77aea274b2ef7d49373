commit 77737a9050f7242e388fd77aea274b2ef7d49373
Author: Sunny Bains <Sunny.Bains@Oracle.Com>
Date:   Sat Oct 30 10:29:21 2010 +1100

    Acquire the trx_sys_t::lock before traversing the trx list.

diff --git a/storage/innobase/lock/lock0lock.c b/storage/innobase/lock/lock0lock.c
index 26ef2c57955..ef51eca2885 100644
--- a/storage/innobase/lock/lock0lock.c
+++ b/storage/innobase/lock/lock0lock.c
@@ -6088,6 +6088,8 @@ lock_table_locks_check(
 	ut_a(table != NULL);
 	ut_ad(lock_mutex_own());
 
+	rw_lock_s_lock(&trx_sys->lock);
+
 	for (trx = UT_LIST_GET_FIRST(trx_sys->trx_list);
 	     trx != NULL;
 	     trx = UT_LIST_GET_NEXT(trx_list, trx)) {
@@ -6110,6 +6112,8 @@ lock_table_locks_check(
 		}
 	}
 
+	rw_lock_s_unlock(&trx_sys->lock);
+
 	return(NULL);
 }
 #endif /* UNIV_DEBUG */

