commit ba62bafe942b159a6109cbec780d36496e06b6c5
Author: Zhouyi Zhou <yizhouzhou@ict.ac.cn>
Date:   Wed Jun 8 15:33:53 2016 -0700

    kernel/relay.c: fix potential memory leak
    
    When relay_open_buf() fails in relay_open(), code will goto free_bufs,
    but chan is nowhere freed.
    
    Link: http://lkml.kernel.org/r/1464777927-19675-1-git-send-email-yizhouzhou@ict.ac.cn
    Signed-off-by: Zhouyi Zhou <zhouzhouyi@gmail.com>
    Cc: Jens Axboe <axboe@kernel.dk>
    Cc: Al Viro <viro@zeniv.linux.org.uk>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/kernel/relay.c b/kernel/relay.c
index 074994bcfa9b..04d7cf3ef8cf 100644
--- a/kernel/relay.c
+++ b/kernel/relay.c
@@ -614,6 +614,7 @@ struct rchan *relay_open(const char *base_filename,
 
 	kref_put(&chan->kref, relay_destroy_channel);
 	mutex_unlock(&relay_channels_mutex);
+	kfree(chan);
 	return NULL;
 }
 EXPORT_SYMBOL_GPL(relay_open);

