commit 1775b92fee43f0527e2f5892a5a30450fa929722
Author: Laurent Aimar <fenrir@elivagar.org>
Date:   Thu Oct 6 22:53:41 2011 +0200

    segafilm: Check for memory allocation failures in segafilm demuxer.
    
    Signed-off-by: Janne Grunau <janne-libav@jannau.net>

diff --git a/libavformat/segafilm.c b/libavformat/segafilm.c
index ea464f29fd..4bbacc5fa6 100644
--- a/libavformat/segafilm.c
+++ b/libavformat/segafilm.c
@@ -257,6 +257,10 @@ static int film_read_packet(AVFormatContext *s,
             av_free(film->stereo_buffer);
             film->stereo_buffer_size = sample->sample_size;
             film->stereo_buffer = av_malloc(film->stereo_buffer_size);
+            if (!film->stereo_buffer) {
+                film->stereo_buffer_size = 0;
+                return AVERROR(ENOMEM);
+            }
         }
 
         pkt->pos= avio_tell(pb);

