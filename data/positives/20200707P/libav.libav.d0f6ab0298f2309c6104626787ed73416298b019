commit d0f6ab0298f2309c6104626787ed73416298b019
Author: Laurent Aimar <fenrir@videolan.org>
Date:   Sat Sep 17 23:43:58 2011 +0200

    rv34: Avoid NULL dereference on corrupted bitstream
    
    rv34_decode_slice() can return without allocating any pictures.
    
    Signed-off-by: Martin Storsj√∂ <martin@martin.st>

diff --git a/libavcodec/rv34.c b/libavcodec/rv34.c
index 90ff51d8f..aa52a93db 100644
--- a/libavcodec/rv34.c
+++ b/libavcodec/rv34.c
@@ -1533,7 +1533,7 @@ int ff_rv34_decode_frame(AVCodecContext *avctx,
             break;
     }
 
-    if(last){
+    if(last && s->current_picture_ptr){
         if(r->loop_filter)
             r->loop_filter(r, s->mb_height - 1);
         ff_er_frame_end(s);

