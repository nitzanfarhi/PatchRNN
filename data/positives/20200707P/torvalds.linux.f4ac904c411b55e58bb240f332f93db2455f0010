commit f4ac904c411b55e58bb240f332f93db2455f0010
Author: Dan Carpenter <error27@gmail.com>
Date:   Fri Aug 5 14:19:00 2011 +0000

    btrfs: memory leak in btrfs_add_inode_defrag()
    
    We don't use the defrag struct on this path.
    
    Signed-off-by: Dan Carpenter <error27@gmail.com>
    Signed-off-by: Chris Mason <chris.mason@oracle.com>

diff --git a/fs/btrfs/file.c b/fs/btrfs/file.c
index 010aec8be824..0705d15542c6 100644
--- a/fs/btrfs/file.c
+++ b/fs/btrfs/file.c
@@ -150,6 +150,8 @@ int btrfs_add_inode_defrag(struct btrfs_trans_handle *trans,
 	spin_lock(&root->fs_info->defrag_inodes_lock);
 	if (!BTRFS_I(inode)->in_defrag)
 		__btrfs_add_inode_defrag(inode, defrag);
+	else
+		kfree(defrag);
 	spin_unlock(&root->fs_info->defrag_inodes_lock);
 	return 0;
 }

