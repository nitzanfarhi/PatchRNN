commit cc8f79dd3d2ed687d5336674ad80a68d49b88650
Author: jsing <jsing@openbsd.org>
Date:   Sun Dec 7 16:01:03 2014 +0000

    Fix a memory leak in tls_check_subject_altname() by calling
    sk_GENERAL_NAME_pop_free() instead of sk_GENERAL_NAME_free(). The latter
    only frees the stack itself and does not free the items.
    
    From Basskrapfen on github.

diff --git a/lib/libtls/tls_verify.c b/lib/libtls/tls_verify.c
index 35a18202a9f..ddc403fb10d 100644
--- a/lib/libtls/tls_verify.c
+++ b/lib/libtls/tls_verify.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: tls_verify.c,v 1.3 2014/12/07 15:48:02 bcook Exp $ */
+/* $OpenBSD: tls_verify.c,v 1.4 2014/12/07 16:01:03 jsing Exp $ */
 /*
  * Copyright (c) 2014 Jeremie Courreges-Anglas <jca@openbsd.org>
  *
@@ -155,7 +155,7 @@ tls_check_subject_altname(X509 *cert, const char *host)
 		}
 	}
 
-	sk_GENERAL_NAME_free(altname_stack);
+	sk_GENERAL_NAME_pop_free(altname_stack, GENERAL_NAME_free);
 	return rv;
 }
 

