commit 7df6d0467a8b9178e4c2ffa22429d7c4fa23af0e
Author: mj162486 <none@none>
Date:   Tue Jun 5 07:59:53 2007 -0700

    6541095 login denied when CA is expired and authentication method is set to "NS_LDAP_AUTH=tls:simple;simple

diff --git a/usr/src/lib/libsldap/common/ns_connect.c b/usr/src/lib/libsldap/common/ns_connect.c
index b2f3fda6f1..c46352e598 100644
--- a/usr/src/lib/libsldap/common/ns_connect.c
+++ b/usr/src/lib/libsldap/common/ns_connect.c
@@ -2784,6 +2784,11 @@ __s_api_getConnection(
 				sessionId, timeoutSec, errorp,
 				fail_if_new_pwd_reqd,
 				nopasswd_acct_mgmt, flags, &badSrvrs);
+			/* not using bad server if credentials were supplied */
+			if (badSrvrs && *badSrvrs) {
+				__s_api_free2dArray(badSrvrs);
+				badSrvrs = NULL;
+			}
 			if (rc == NS_LDAP_SUCCESS ||
 				rc == NS_LDAP_SUCCESS_WITH_INFO) {
 				*session = con;

