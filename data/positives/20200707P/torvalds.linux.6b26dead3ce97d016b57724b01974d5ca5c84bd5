commit 6b26dead3ce97d016b57724b01974d5ca5c84bd5
Author: Pavel Roskin <proski@gnu.org>
Date:   Tue Aug 4 17:48:16 2009 -0400

    rt2x00: fix memory corruption in rf cache, add a sanity check
    
    Change rt2x00_rf_read() and rt2x00_rf_write() to subtract 1 from the rf
    register number.  This is needed because the rf registers are enumerated
    starting with one.  The size of the rf register cache is just enough to
    hold all registers, so writing to the highest register was corrupting
    memory.  Add a check to make sure that the rf register number is valid.
    
    Signed-off-by: Pavel Roskin <proski@gnu.org>
    Cc: stable@kernel.org
    Acked-by: Ivo van Doorn <IvDoorn@gmail.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/rt2x00/rt2x00.h b/drivers/net/wireless/rt2x00/rt2x00.h
index a498dde024e1..49c9e2c1433d 100644
--- a/drivers/net/wireless/rt2x00/rt2x00.h
+++ b/drivers/net/wireless/rt2x00/rt2x00.h
@@ -849,13 +849,15 @@ struct rt2x00_dev {
 static inline void rt2x00_rf_read(struct rt2x00_dev *rt2x00dev,
 				  const unsigned int word, u32 *data)
 {
-	*data = rt2x00dev->rf[word];
+	BUG_ON(word < 1 || word > rt2x00dev->ops->rf_size / sizeof(u32));
+	*data = rt2x00dev->rf[word - 1];
 }
 
 static inline void rt2x00_rf_write(struct rt2x00_dev *rt2x00dev,
 				   const unsigned int word, u32 data)
 {
-	rt2x00dev->rf[word] = data;
+	BUG_ON(word < 1 || word > rt2x00dev->ops->rf_size / sizeof(u32));
+	rt2x00dev->rf[word - 1] = data;
 }
 
 /*

