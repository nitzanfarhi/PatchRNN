commit 47de87a234aac8b2121557f3903bb16bb678af67
Author: Rabin Vincent <rabin.vincent@stericsson.com>
Date:   Wed Feb 22 15:58:00 2012 +0530

    staging: logger: hold mutex while removing reader
    
    The readers list is traversed under the log->mutex lock
    (for example from fix_up_readers()), but the deletion of
    elements from this list is not being done under this lock.
    
    Cc: Brian Swetland <swetland@google.com>
    Cc: Dima Zavin <dima@android.com>
    Signed-off-by: Rabin Vincent <rabin.vincent@stericsson.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/android/logger.c b/drivers/staging/android/logger.c
index 0d2367f2c15f..ea69b6a77dac 100644
--- a/drivers/staging/android/logger.c
+++ b/drivers/staging/android/logger.c
@@ -459,7 +459,12 @@ static int logger_release(struct inode *ignored, struct file *file)
 {
 	if (file->f_mode & FMODE_READ) {
 		struct logger_reader *reader = file->private_data;
+		struct logger_log *log = reader->log;
+
+		mutex_lock(&log->mutex);
 		list_del(&reader->list);
+		mutex_unlock(&log->mutex);
+
 		kfree(reader);
 	}
 

