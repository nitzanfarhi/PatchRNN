commit a1ce383f16de276c0d763bfe00aa24358059ac3a
Author: naddy <>
Date:   Tue Jun 29 04:09:34 2010 +0000

    Make unsetenv(NULL) and unsetenv("") give EINVAL, per POSIX.  ok deraadt@

diff --git a/src/lib/libc/stdlib/setenv.c b/src/lib/libc/stdlib/setenv.c
index 2e882cdbe..89d1e8891 100644
--- a/src/lib/libc/stdlib/setenv.c
+++ b/src/lib/libc/stdlib/setenv.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: setenv.c,v 1.11 2009/06/04 20:39:13 millert Exp $ */
+/*	$OpenBSD: setenv.c,v 1.12 2010/06/29 04:09:34 naddy Exp $ */
 /*
  * Copyright (c) 1987 Regents of the University of California.
  * All rights reserved.
@@ -145,6 +145,10 @@ unsetenv(const char *name)
 	const char *np;
 	int offset;
 
+	if (!name || !*name) {
+		errno = EINVAL;
+		return (-1);
+	}
 	for (np = name; *np && *np != '='; ++np)
 		;
 	if (*np) {

