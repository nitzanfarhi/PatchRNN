commit 4809537f0c5a2e1cee9559ec842cc869884d2cb7
Author: Timo Sirainen <tss@iki.fi>
Date:   Tue Jun 18 18:56:15 2013 +0300

    lib-storage: Fixed crash with some autocreated (e.g. shared) namespaces.

diff --git a/src/lib-storage/mailbox-list.c b/src/lib-storage/mailbox-list.c
index 03e5fec70..70f4d002d 100644
--- a/src/lib-storage/mailbox-list.c
+++ b/src/lib-storage/mailbox-list.c
@@ -808,7 +808,7 @@ int mailbox_list_get_storage(struct mailbox_list **list, const char *vname,
 		return (*list)->v.get_storage(list, vname, storage_r);
 
 	set = mailbox_settings_find((*list)->ns->user, vname);
-	if (set != NULL && set->driver[0] != '\0') {
+	if (set != NULL && set->driver != NULL && set->driver[0] != '\0') {
 		return mailbox_list_get_storage_driver(*list, set->driver,
 						       storage_r);
 	}

