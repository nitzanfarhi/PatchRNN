commit cee4fd2712a3db21f432bdff14e59aed160453b2
Author: Kalle Valo <kalle.valo@nokia.com>
Date:   Fri Jun 12 14:16:20 2009 +0300

    wl12xx: protect wl12xx_op_set_rts_threshold()
    
    The function doesn't lock the mutex before sending the acx.
    
    Signed-off-by: Kalle Valo <kalle.valo@nokia.com>
    Reviewed-by: Vidhya Govindan <vidhya.govindan@nokia.com>
    Signed-off-by: Luciano Coelho <luciano.coelho@nokia.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/wl12xx/main.c b/drivers/net/wireless/wl12xx/main.c
index 8feba36ff48d..7ec174992787 100644
--- a/drivers/net/wireless/wl12xx/main.c
+++ b/drivers/net/wireless/wl12xx/main.c
@@ -957,11 +957,15 @@ static int wl12xx_op_set_rts_threshold(struct ieee80211_hw *hw, u32 value)
 	struct wl12xx *wl = hw->priv;
 	int ret;
 
+	mutex_lock(&wl->mutex);
+
 	ret = wl12xx_acx_rts_threshold(wl, (u16) value);
 
 	if (ret < 0)
 		wl12xx_warning("wl12xx_op_set_rts_threshold failed: %d", ret);
 
+	mutex_unlock(&wl->mutex);
+
 	return ret;
 }
 

