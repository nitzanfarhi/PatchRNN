commit b0bb3aa6233dccfccd040793d0d9ce838e4890e1
Author: Takashi Iwai <tiwai@suse.de>
Date:   Fri Jul 3 23:25:37 2009 +0200

    ALSA: hda - Don't override maxbps for FLOAT sharing with linear formats
    
    When FLOAT PCM format is available but together with other linear
    PCM formats, don't override maxbps value.  For FLOAT format, it's always
    32, thus it can be better checked in snd_hda_calc_stream_format().
    Otherwise the maxbps 32 might be used wrongly even if the linear PCM
    doesn't support it.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/hda_codec.c b/sound/pci/hda/hda_codec.c
index 263d124de611..fb5760c64e74 100644
--- a/sound/pci/hda/hda_codec.c
+++ b/sound/pci/hda/hda_codec.c
@@ -2563,7 +2563,7 @@ unsigned int snd_hda_calc_stream_format(unsigned int rate,
 	case 20:
 	case 24:
 	case 32:
-		if (maxbps >= 32)
+		if (maxbps >= 32 || format == SNDRV_PCM_FORMAT_FLOAT_LE)
 			val |= 0x40;
 		else if (maxbps >= 24)
 			val |= 0x30;
@@ -2692,7 +2692,8 @@ static int snd_hda_query_supported_pcm(struct hda_codec *codec, hda_nid_t nid,
 		}
 		if (streams & AC_SUPFMT_FLOAT32) {
 			formats |= SNDRV_PCM_FMTBIT_FLOAT_LE;
-			bps = 32;
+			if (!bps)
+				bps = 32;
 		}
 		if (streams == AC_SUPFMT_AC3) {
 			/* should be exclusive */

