commit 13a232b533ceddfb57c5f0e108edad10a4fce643
Author: Kevin Lin <klin@sourcefire.com>
Date:   Tue Feb 24 21:52:08 2015 -0500

    fixed memory issues in sigopts handler

diff --git a/libclamav/readdb.c b/libclamav/readdb.c
index b80d60036..92be72823 100644
--- a/libclamav/readdb.c
+++ b/libclamav/readdb.c
@@ -134,8 +134,10 @@ static int sigopts_handler(struct cli_matcher *root, const char *virname, const
         if (sigopts & ACPATT_OPTION_FULLWORD) {
             char *rechar;
             char *hexovr = cli_calloc(strlen(hexcpy)+7, sizeof(char));
-            if (!hexovr)
+            if (!hexovr) {
+                free(hexcpy);
                 return CL_EMEM;
+            }
 
             snprintf(hexovr, strlen(hexcpy)+7, "(W)%s(W)", hexcpy);
 
@@ -146,6 +148,8 @@ static int sigopts_handler(struct cli_matcher *root, const char *virname, const
 
                 if (!(rechar = strchr(rechar, ']'))) {
                     cli_errmsg("cli_parse_add: unmatched '[' in signature %s\n", virname);
+                    free(hexcpy);
+                    free(hexovr);
                     return CL_EMALFDB;
                 }
                 *rechar = '}';
@@ -161,8 +165,10 @@ static int sigopts_handler(struct cli_matcher *root, const char *virname, const
         if (sigopts & ACPATT_OPTION_WIDE) {
             size_t ovrlen = 2*strlen(hexcpy)+1;
             char *hexovr = cli_calloc(ovrlen, sizeof(char));
-            if (!hexovr)
+            if (!hexovr) {
+                free(hexcpy);
                 return CL_EMEM;
+            }
 
             /* clamav-specific wildcards need to be handled here! */
             for (i = 0; i < strlen(hexcpy); ++i) {
@@ -194,6 +200,8 @@ static int sigopts_handler(struct cli_matcher *root, const char *virname, const
                         ++len; ++i;
                         hexovr[len++] = hexcpy[i++];
                         if (hexcpy[i] != ')') {
+                            free(hexcpy);
+                            free(hexovr);
                             return CL_EMALFDB;
                         }
                         hexovr[len] = hexcpy[i];
@@ -207,6 +215,7 @@ static int sigopts_handler(struct cli_matcher *root, const char *virname, const
 
             /* NOCASE sigopt is handled in cli_ac_addsig */
             ret = cli_parse_add(root, virname, hexovr, sigopts, rtype, type, offset, target, lsigid, options);
+            free(hexovr);
             if (ret != CL_SUCCESS || !(sigopts & ACPATT_OPTION_ASCII)) {
                 free(hexcpy);
                 return ret;

