commit 845f85fa1597c72609bd10a37b9586b445c13d49
Author: Amit Shah <amit.shah@redhat.com>
Date:   Wed Jul 27 14:00:32 2011 +0530

    virtio: Plug memleak by freeing vdev
    
    virtio_common_init() allocates RAM for the vdev struct (and any
    additional memory, depending on the size passed to the function).  This
    memory wasn't being freed until now.
    
    Signed-off-by: Amit Shah <amit.shah@redhat.com>
    Signed-off-by: Michael S. Tsirkin <mst@redhat.com>

diff --git a/hw/virtio.c b/hw/virtio.c
index a8f4940da2..93dfb1e359 100644
--- a/hw/virtio.c
+++ b/hw/virtio.c
@@ -834,6 +834,7 @@ void virtio_cleanup(VirtIODevice *vdev)
     if (vdev->config)
         qemu_free(vdev->config);
     qemu_free(vdev->vq);
+    qemu_free(vdev);
 }
 
 static void virtio_vmstate_change(void *opaque, int running, int reason)

