commit 7ac020366b0a436d726408841160b5dc32c19214
Author: Peng Fan <van.freenix@gmail.com>
Date:   Mon Jun 22 11:41:23 2015 +0800

    mmc: sdhci check parameters before call dma_free_coherent
    
    We should not call dma_free_coherent if host->adma_table is NULL,
    otherwise may trigger panic.
    
    Fixes: d1e49f77d7c7 ("mmc: sdhci: convert ADMA descriptors to a...")
    Signed-off-by: Peng Fan <van.freenix@gmail.com>
    Acked-by: Adrian Hunter <adrian.hunter@intel.com>
    Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>

diff --git a/drivers/mmc/host/sdhci.c b/drivers/mmc/host/sdhci.c
index bc1445238fb3..655900f55244 100644
--- a/drivers/mmc/host/sdhci.c
+++ b/drivers/mmc/host/sdhci.c
@@ -2978,8 +2978,11 @@ int sdhci_add_host(struct sdhci_host *host)
 						      GFP_KERNEL);
 		host->align_buffer = kmalloc(host->align_buffer_sz, GFP_KERNEL);
 		if (!host->adma_table || !host->align_buffer) {
-			dma_free_coherent(mmc_dev(mmc), host->adma_table_sz,
-					  host->adma_table, host->adma_addr);
+			if (host->adma_table)
+				dma_free_coherent(mmc_dev(mmc),
+						  host->adma_table_sz,
+						  host->adma_table,
+						  host->adma_addr);
 			kfree(host->align_buffer);
 			pr_warn("%s: Unable to allocate ADMA buffers - falling back to standard DMA\n",
 				mmc_hostname(mmc));

