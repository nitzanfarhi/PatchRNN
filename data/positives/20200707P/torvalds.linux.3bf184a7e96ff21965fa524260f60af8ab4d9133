commit 3bf184a7e96ff21965fa524260f60af8ab4d9133
Author: Joe Gunn <armadefuego@yahoo.com>
Date:   Tue Mar 15 08:41:19 2011 -0700

    orinoco: Maintain lock until entry removed from list
    
    Removing an entry from the scan_list should be performed while holding
    the lock.
    
    Signed-off-by: Joseph J. Gunn <armadefuego@yahoo.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/orinoco/main.c b/drivers/net/wireless/orinoco/main.c
index f3d396e7544b..62c6b2b37dbe 100644
--- a/drivers/net/wireless/orinoco/main.c
+++ b/drivers/net/wireless/orinoco/main.c
@@ -1376,13 +1376,13 @@ static void orinoco_process_scan_results(struct work_struct *work)
 
 	spin_lock_irqsave(&priv->scan_lock, flags);
 	list_for_each_entry_safe(sd, temp, &priv->scan_list, list) {
-		spin_unlock_irqrestore(&priv->scan_lock, flags);
 
 		buf = sd->buf;
 		len = sd->len;
 		type = sd->type;
 
 		list_del(&sd->list);
+		spin_unlock_irqrestore(&priv->scan_lock, flags);
 		kfree(sd);
 
 		if (len > 0) {

