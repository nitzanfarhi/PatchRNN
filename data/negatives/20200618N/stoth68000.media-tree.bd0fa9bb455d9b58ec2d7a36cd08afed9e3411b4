commit bd0fa9bb455d9b58ec2d7a36cd08afed9e3411b4
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Tue Feb 25 14:29:44 2014 +0530

    cpufreq: Return error if ->get() failed in cpufreq_update_policy()
    
    cpufreq_update_policy() calls cpufreq_driver->get() to get current
    frequency of a CPU and it is not supposed to fail or return zero.
    Return error in case that happens.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/cpufreq.c b/drivers/cpufreq/cpufreq.c
index 5815af50d3de..56b7b1be352d 100644
--- a/drivers/cpufreq/cpufreq.c
+++ b/drivers/cpufreq/cpufreq.c
@@ -2139,6 +2139,11 @@ int cpufreq_update_policy(unsigned int cpu)
 	 */
 	if (cpufreq_driver->get) {
 		new_policy.cur = cpufreq_driver->get(cpu);
+		if (WARN_ON(!new_policy.cur)) {
+			ret = -EIO;
+			goto no_policy;
+		}
+
 		if (!policy->cur) {
 			pr_debug("Driver did not initialize current freq");
 			policy->cur = new_policy.cur;

