commit 0edb74c6986be2973183949a5a4bbd9aaaff85e5
Author: Roland Pallai <dap78@magex.hu>
Date:   Sun Mar 5 22:54:28 2017 +0100

    Colorize tagged messages in the message list
    
    Change-Id: I1bef8c1dfebd6bfc107e7465064dc230414faa54

diff --git a/src/Gui/Window.cpp b/src/Gui/Window.cpp
index 7c51b7e6..4d6c4618 100644
--- a/src/Gui/Window.cpp
+++ b/src/Gui/Window.cpp
@@ -863,7 +863,7 @@ void MainWindow::setupModels()
     prettyMboxModel->setObjectName(QStringLiteral("prettyMboxModel"));
     connect(realThreadingModel, &Imap::Mailbox::ThreadingMsgListModel::sortingFailed,
             msgListWidget, &MessageListWidget::slotSortingFailed);
-    prettyMsgListModel = new Imap::Mailbox::PrettyMsgListModel(this);
+    prettyMsgListModel = new Imap::Mailbox::PrettyMsgListModel(this, m_favoriteTags);
     prettyMsgListModel->setSourceModel(m_imapAccess->threadingMsgListModel());
     prettyMsgListModel->setObjectName(QStringLiteral("prettyMsgListModel"));
 
diff --git a/src/Imap/Model/PrettyMsgListModel.cpp b/src/Imap/Model/PrettyMsgListModel.cpp
index 2fea3139..41cbd9c0 100644
--- a/src/Imap/Model/PrettyMsgListModel.cpp
+++ b/src/Imap/Model/PrettyMsgListModel.cpp
@@ -19,8 +19,9 @@
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
-#include "PrettyMsgListModel.h"
+#include <QBrush>
 #include <QFont>
+#include "PrettyMsgListModel.h"
 #include "ItemRoles.h"
 #include "MsgListModel.h"
 #include "ThreadingMsgListModel.h"
@@ -34,7 +35,8 @@ namespace Imap
 namespace Mailbox
 {
 
-PrettyMsgListModel::PrettyMsgListModel(QObject *parent): QSortFilterProxyModel(parent), m_hideRead(false)
+PrettyMsgListModel::PrettyMsgListModel(QObject *parent, FavoriteTagsModel *m_favoriteTagsModel):
+    QSortFilterProxyModel(parent), m_favoriteTagsModel(m_favoriteTagsModel), m_hideRead(false)
 {
     setDynamicSortFilter(true);
 }
@@ -198,6 +200,19 @@ QVariant PrettyMsgListModel::data(const QModelIndex &index, int role) const
 
         return font;
     }
+
+    case Qt::ForegroundRole: {
+        // These items should definitely *not* be rendered in color
+        if (!translated.data(RoleIsFetched).toBool())
+            return QVariant();
+
+        QVariant messageFlags = translated.data(RoleMessageFlags);
+        auto color = m_favoriteTagsModel->findBestColorForTags(messageFlags.toStringList());
+        if (color.isValid())
+            return QBrush(color);
+        return QVariant();
+    }
+
     }
 
     return QSortFilterProxyModel::data(index, role);
diff --git a/src/Imap/Model/PrettyMsgListModel.h b/src/Imap/Model/PrettyMsgListModel.h
index 07257b33..bbe471ec 100644
--- a/src/Imap/Model/PrettyMsgListModel.h
+++ b/src/Imap/Model/PrettyMsgListModel.h
@@ -24,6 +24,7 @@
 
 #include <QSortFilterProxyModel>
 #include "Imap/Model/MailboxModel.h"
+#include "Imap/Model/FavoriteTagsModel.h"
 
 namespace Imap
 {
@@ -36,12 +37,14 @@ class PrettyMsgListModel: public QSortFilterProxyModel
 {
     Q_OBJECT
 public:
-    explicit PrettyMsgListModel(QObject *parent=0);
+    explicit PrettyMsgListModel(QObject *parent, FavoriteTagsModel *m_favoriteTagsModel);
     virtual QVariant data(const QModelIndex &index, int role) const;
     void setHideRead(bool value);
     virtual bool filterAcceptsRow(int source_row, const QModelIndex &source_parent) const;
     virtual void sort(int column, Qt::SortOrder order);
 
+    FavoriteTagsModel *m_favoriteTagsModel;
+
 signals:
     void sortingPreferenceChanged(int column, Qt::SortOrder order);
 

