commit 035b2398264d4b8838d66a8360ca6091f1a107e9
Author: Richard Henderson <rth@twiddle.net>
Date:   Thu Mar 6 16:06:24 2014 -0800

    tcg-sparc: Fix small 32-bit movi
    
    We tested imm13 before discarding garbage high bits.
    
    Signed-off-by: Richard Henderson <rth@twiddle.net>

diff --git a/tcg/sparc/tcg-target.c b/tcg/sparc/tcg-target.c
index a977c57d2b..1526f2c2e7 100644
--- a/tcg/sparc/tcg-target.c
+++ b/tcg/sparc/tcg-target.c
@@ -432,6 +432,11 @@ static void tcg_out_movi(TCGContext *s, TCGType type,
 {
     tcg_target_long hi, lo = (int32_t)arg;
 
+    /* Make sure we test 32-bit constants for imm13 properly.  */
+    if (type == TCG_TYPE_I32) {
+        arg = lo;
+    }
+
     /* A 13-bit constant sign-extended to 64-bits.  */
     if (check_fit_tl(arg, 13)) {
         tcg_out_movi_imm13(s, ret, arg);

