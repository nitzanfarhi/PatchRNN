commit dd4198ecc9c81a6a15771a59292fecc2785a04f4
Author: kkalev <kkalev>
Date:   Fri Aug 30 14:28:46 2002 +0000

    Move an sql_finish_select_query in the correct place in rlm_sql_checksimul

diff --git a/src/modules/rlm_sql/rlm_sql.c b/src/modules/rlm_sql/rlm_sql.c
index 4fe70df3d..4ce96848e 100644
--- a/src/modules/rlm_sql/rlm_sql.c
+++ b/src/modules/rlm_sql/rlm_sql.c
@@ -786,19 +786,21 @@ static int rlm_sql_checksimul(void *instance, REQUEST * request) {
 	if (ret == 0) {
 		row = sqlsocket->row;
 	}
-	(inst->module->sql_finish_select_query)(sqlsocket, inst->config);
 
 	if (ret) {
+		(inst->module->sql_finish_select_query)(sqlsocket, inst->config);
 		sql_release_socket(inst, sqlsocket);
 		return RLM_MODULE_FAIL;
 	}
 
 	if (row == NULL) {
+		(inst->module->sql_finish_select_query)(sqlsocket, inst->config);
 		sql_release_socket(inst, sqlsocket);
 		return RLM_MODULE_FAIL;
 	}
 
 	request->simul_count = atoi(row[0]);
+	(inst->module->sql_finish_select_query)(sqlsocket, inst->config);
 
 	if(request->simul_count < request->simul_max) {
 		sql_release_socket(inst, sqlsocket);

