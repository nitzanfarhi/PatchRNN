commit f4a6374ba46132896154397ce3c559ccb0d15e60
Author: Tony Nguyen <anthony.l.nguyen@intel.com>
Date:   Wed Mar 1 11:52:09 2017 -0800

    ixgbe: add check for VETO bit when configuring link for KR
    
    We did not have a check in place for MMNGC.MNG_VETO when setting up link
    on X550EM_X KR devices which resulted in link loss for the BMC when
    loading the driver.
    
    This patch adds a check for ixgbe_check_reset_blocked() in setup_link()
    since in that case there is no PHY reset function.
    
    Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>

diff --git a/drivers/net/ethernet/intel/ixgbe/ixgbe_x550.c b/drivers/net/ethernet/intel/ixgbe/ixgbe_x550.c
index 04d6c744b936..2658394599e4 100644
--- a/drivers/net/ethernet/intel/ixgbe/ixgbe_x550.c
+++ b/drivers/net/ethernet/intel/ixgbe/ixgbe_x550.c
@@ -2526,6 +2526,9 @@ static s32 ixgbe_setup_kr_x550em(struct ixgbe_hw *hw)
 	if (hw->phy.autoneg_advertised & IXGBE_LINK_SPEED_2_5GB_FULL)
 		return 0;
 
+	if (ixgbe_check_reset_blocked(hw))
+		return 0;
+
 	return ixgbe_setup_kr_speed_x550em(hw, hw->phy.autoneg_advertised);
 }
 

