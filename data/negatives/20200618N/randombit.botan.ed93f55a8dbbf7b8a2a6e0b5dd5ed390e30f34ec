commit ed93f55a8dbbf7b8a2a6e0b5dd5ed390e30f34ec
Author: lloyd <lloyd@randombit.net>
Date:   Tue Jul 17 20:47:24 2012 +0000

    Add check for out of range DH keys

diff --git a/src/pubkey/dh/dh.cpp b/src/pubkey/dh/dh.cpp
index 956a98ba4..956552c7d 100644
--- a/src/pubkey/dh/dh.cpp
+++ b/src/pubkey/dh/dh.cpp
@@ -87,6 +87,9 @@ secure_vector<byte> DH_KA_Operation::agree(const byte w[], size_t w_len)
    {
    BigInt input = BigInt::decode(w, w_len);
 
+   if(input <= 1 || input >= p - 1)
+      throw Invalid_Argument("DH agreement - invalid key provided");
+
    BigInt r = blinder.unblind(powermod_x_p(blinder.blind(input)));
 
    return BigInt::encode_1363(r, p.bytes());

