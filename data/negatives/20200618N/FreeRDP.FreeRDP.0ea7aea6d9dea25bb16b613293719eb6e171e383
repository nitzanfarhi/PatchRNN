commit 0ea7aea6d9dea25bb16b613293719eb6e171e383
Author: Armin Novak <armin.novak@thincast.com>
Date:   Wed Mar 2 19:02:01 2016 +0100

    Remember filter log level.

diff --git a/winpr/libwinpr/utils/wlog/wlog.c b/winpr/libwinpr/utils/wlog/wlog.c
index 87739e9d3..5a1742c8c 100644
--- a/winpr/libwinpr/utils/wlog/wlog.c
+++ b/winpr/libwinpr/utils/wlog/wlog.c
@@ -538,9 +538,11 @@ BOOL WLog_ParseFilters(void)
 LONG WLog_GetFilterLogLevel(wLog* log)
 {
 	DWORD i, j;
-	LONG iLevel = -1;
 	BOOL match = FALSE;
 
+	if (log->FilterLevel >= 0)
+		return log->FilterLevel;
+
 	for (i = 0; i < g_FilterCount; i++)
 	{
 		for (j = 0; j < g_Filters[i].NameCount; j++)
@@ -569,9 +571,11 @@ LONG WLog_GetFilterLogLevel(wLog* log)
 	}
 
 	if (match)
-		iLevel = (int) g_Filters[i].Level;
+		log->FilterLevel = g_Filters[i].Level;
+	else
+		log->FilterLevel = log->Level;
 
-	return iLevel;
+	return log->FilterLevel;
 }
 
 BOOL WLog_ParseName(wLog* log, LPCSTR name)
@@ -636,6 +640,7 @@ wLog* WLog_New(LPCSTR name, wLog* rootLogger)
 	log->Parent = rootLogger;
 	log->ChildrenCount = 0;
 	log->ChildrenSize = 16;
+	log->FilterLevel = -1;
 
 	if (!(log->Children = (wLog**) calloc(log->ChildrenSize, sizeof(wLog*))))
 		goto out_fail;
diff --git a/winpr/libwinpr/utils/wlog/wlog.h b/winpr/libwinpr/utils/wlog/wlog.h
index c3cc83e70..596005d96 100644
--- a/winpr/libwinpr/utils/wlog/wlog.h
+++ b/winpr/libwinpr/utils/wlog/wlog.h
@@ -63,6 +63,7 @@ struct _wLogAppender
 struct _wLog
 {
 	LPSTR Name;
+	LONG FilterLevel;
 	DWORD Level;
 
 	BOOL IsRoot;

