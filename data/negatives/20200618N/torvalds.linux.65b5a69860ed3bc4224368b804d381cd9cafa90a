commit 65b5a69860ed3bc4224368b804d381cd9cafa90a
Author: Bob Copeland <me@bobcopeland.com>
Date:   Mon Jul 13 21:57:39 2009 -0400

    ath5k: temporarily disable crypto for AP mode
    
    Pavel Roskin reported some issues with using AP mode without
    nohwcrypt=1.  Most likely this is similar to the problem fixed
    some time ago in ath9k by 3f53dd64f192450cb331c0fecfc26ca952fb242f,
    "ath9k: Fix hw crypto configuration for TKIP in AP mode."
    
    That only affects TKIP but it's easiest to just disable that and
    WEP too until we get a proper fix in.
    
    Signed-off-by: Bob Copeland <me@bobcopeland.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/ath/ath5k/base.c b/drivers/net/wireless/ath/ath5k/base.c
index ea045151f953..029c1bc7468f 100644
--- a/drivers/net/wireless/ath/ath5k/base.c
+++ b/drivers/net/wireless/ath/ath5k/base.c
@@ -2970,6 +2970,9 @@ ath5k_set_key(struct ieee80211_hw *hw, enum set_key_cmd cmd,
 	if (modparam_nohwcrypt)
 		return -EOPNOTSUPP;
 
+	if (sc->opmode == NL80211_IFTYPE_AP)
+		return -EOPNOTSUPP;
+
 	switch (key->alg) {
 	case ALG_WEP:
 	case ALG_TKIP:

