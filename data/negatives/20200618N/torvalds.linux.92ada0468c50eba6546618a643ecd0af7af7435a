commit 92ada0468c50eba6546618a643ecd0af7af7435a
Author: Thomas Pedersen <c_tpeder@qca.qualcomm.com>
Date:   Fri Apr 20 11:33:07 2012 -0700

    ath6kl: unblock fwlog_block_read() on exit
    
    Complete the waiting fwlog_block_read on debugfs cleanup, otherwise
    userspace and module unload might softlock.
    
    Signed-off-by: Thomas Pedersen <c_tpeder@qca.qualcomm.com>
    Signed-off-by: Kalle Valo <kvalo@qca.qualcomm.com>

diff --git a/drivers/net/wireless/ath/ath6kl/debug.c b/drivers/net/wireless/ath/ath6kl/debug.c
index acb6430d8e7e..ced6c6fe5470 100644
--- a/drivers/net/wireless/ath/ath6kl/debug.c
+++ b/drivers/net/wireless/ath/ath6kl/debug.c
@@ -1824,6 +1824,7 @@ int ath6kl_debug_init_fs(struct ath6kl *ar)
 void ath6kl_debug_cleanup(struct ath6kl *ar)
 {
 	skb_queue_purge(&ar->debug.fwlog_queue);
+	complete(&ar->debug.fwlog_completion);
 	kfree(ar->debug.roam_tbl);
 }
 

