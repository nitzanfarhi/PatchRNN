commit baf8ead86fcad253e6406420d540eae6b1ab4a58
Author: Adam Pridgen <adam.pridgen@thecoverofnight.com>
Date:   Mon May 5 22:07:01 2014 -0500

    Update bin info for binfile being set in the environment

diff --git a/libr/bin/bin.c b/libr/bin/bin.c
index dcf8fc2c9..998fdf210 100644
--- a/libr/bin/bin.c
+++ b/libr/bin/bin.c
@@ -377,7 +377,7 @@ R_API int r_bin_load_io_at_offset_as(RBin *bin, RIODesc *desc, ut64 baseaddr, ut
 		// <xtr_name>:<bin_type_name>
 		r_list_foreach (bin->binxtrs, it, xtr) {
 			if (xtr->check && xtr->check_bytes (buf_bytes, sz)) {
-				if (xtr && (xtr->extract_from_bytes || xtr->extract_from_bytes))
+				if (xtr && (xtr->extract_from_bytes || xtr->extractall_from_bytes))
 					return r_bin_file_xtr_load_bytes (bin, xtr, desc->name, buf_bytes, sz, baseaddr, loadaddr, xtr_idx, desc->fd, rawstr);
 				xtr = NULL;
 			}
diff --git a/libr/core/bin.c b/libr/core/bin.c
index 206423dc7..ae971c5e2 100644
--- a/libr/core/bin.c
+++ b/libr/core/bin.c
@@ -35,6 +35,8 @@ R_API int r_core_bin_set_env (RCore *r, RBinFile *binfile) {
 		r_config_set_i (r->config, "bin.baddr", baseaddr);
 		r_config_set_i (r->config, "asm.bits", bits);
 		r_config_set (r->config, "asm.arch", arch);
+		r_config_set (r->config, "anal.arch", arch);
+		r_config_set (r->config, "anal.cpu", arch);
 		r_asm_use (r->assembler, arch);
 		r_core_bin_info (r, R_CORE_BIN_ACC_ALL, R_CORE_BIN_SET, va, NULL, baseaddr);
 		r_core_bin_bind (r, binfile);

