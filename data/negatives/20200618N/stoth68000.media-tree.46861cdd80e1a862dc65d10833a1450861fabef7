commit 46861cdd80e1a862dc65d10833a1450861fabef7
Author: Nicholas Bellinger <nab@linux-iscsi.org>
Date:   Tue Apr 25 13:52:45 2017 -0700

    target: Don't force session reset if queue_depth does not change
    
    Keeping in the idempotent nature of target_core_fabric_configfs.c,
    if a queue_depth value is set and it's the same as the existing
    value, don't attempt to force session reinstatement.
    
    Reported-by: Raghu Krishnamurthy <rk@datera.io>
    Cc: Raghu Krishnamurthy <rk@datera.io>
    Tested-by: Gary Guo <ghg@datera.io>
    Cc: Gary Guo <ghg@datera.io>
    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>

diff --git a/drivers/target/target_core_tpg.c b/drivers/target/target_core_tpg.c
index dfaef4d3b2d2..310d9e55c6eb 100644
--- a/drivers/target/target_core_tpg.c
+++ b/drivers/target/target_core_tpg.c
@@ -397,6 +397,13 @@ int core_tpg_set_initiator_node_queue_depth(
 {
 	struct se_portal_group *tpg = acl->se_tpg;
 
+	/*
+	 * Allow the setting of se_node_acl queue_depth to be idempotent,
+	 * and not force a session shutdown event if the value is not
+	 * changing.
+	 */
+	if (acl->queue_depth == queue_depth)
+		return 0;
 	/*
 	 * User has requested to change the queue depth for a Initiator Node.
 	 * Change the value in the Node's struct se_node_acl, and call

