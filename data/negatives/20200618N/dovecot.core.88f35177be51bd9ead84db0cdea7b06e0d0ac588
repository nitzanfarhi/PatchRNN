commit 88f35177be51bd9ead84db0cdea7b06e0d0ac588
Author: Timo Sirainen <tss@iki.fi>
Date:   Tue Aug 16 18:27:40 2011 +0300

    lib-storage: Fixed assert-crash caused by previous stats change.

diff --git a/src/lib-storage/index/index-search.c b/src/lib-storage/index/index-search.c
index 8c675becc..46150bf9f 100644
--- a/src/lib-storage/index/index-search.c
+++ b/src/lib-storage/index/index-search.c
@@ -1184,8 +1184,12 @@ int index_storage_search_deinit(struct mail_search_context *_ctx)
 	array_free(&ctx->mail_ctx.results);
 	array_free(&ctx->mail_ctx.module_contexts);
 
-	array_foreach_modifiable(&ctx->mails, mailp)
+	array_foreach_modifiable(&ctx->mails, mailp) {
+		struct index_mail *imail = (struct index_mail *)*mailp;
+
+		imail->search_mail = FALSE;
 		mail_free(mailp);
+	}
 	array_free(&ctx->mails);
 	i_free(ctx);
 	return ret;

