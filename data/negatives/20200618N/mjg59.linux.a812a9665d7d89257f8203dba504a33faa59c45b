commit a812a9665d7d89257f8203dba504a33faa59c45b
Author: Tomasz Stanislawski <t.stanislaws@samsung.com>
Date:   Tue Oct 9 14:07:41 2012 -0300

    [media] v4l: vb2-dma-contig: align buffer size to PAGE_SIZE
    
    Most operations on DMA and DMABUF framework require the size of a buffer to be
    page aligned. This patch guarantees the requirement is satisfied for all
    vb2-dma-contig buffers.
    
    Signed-off-by: Tomasz Stanislawski <t.stanislaws@samsung.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/v4l2-core/videobuf2-dma-contig.c b/drivers/media/v4l2-core/videobuf2-dma-contig.c
index 27de1bb731db..10beaee7f0ae 100644
--- a/drivers/media/v4l2-core/videobuf2-dma-contig.c
+++ b/drivers/media/v4l2-core/videobuf2-dma-contig.c
@@ -162,6 +162,9 @@ static void *vb2_dc_alloc(void *alloc_ctx, unsigned long size)
 	if (!buf)
 		return ERR_PTR(-ENOMEM);
 
+	/* align image size to PAGE_SIZE */
+	size = PAGE_ALIGN(size);
+
 	buf->vaddr = dma_alloc_coherent(dev, size, &buf->dma_addr, GFP_KERNEL);
 	if (!buf->vaddr) {
 		dev_err(dev, "dma_alloc_coherent of size %ld failed\n", size);

