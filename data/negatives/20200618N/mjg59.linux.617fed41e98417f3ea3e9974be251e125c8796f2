commit 617fed41e98417f3ea3e9974be251e125c8796f2
Author: Gabor Juhos <juhosg@openwrt.org>
Date:   Sun Feb 3 09:58:37 2013 +0000

    MIPS: ath79: allow to specify bus number in PCI IRQ maps
    
    This is needed for multiple PCI bus support.
    
    Signed-off-by: Gabor Juhos <juhosg@openwrt.org>
    Patchwork: http://patchwork.linux-mips.org/patch/4913/
    Signed-off-by: John Crispin <blogic@openwrt.org>

diff --git a/arch/mips/ath79/pci.c b/arch/mips/ath79/pci.c
index c94bcec169ab..d90e07136383 100644
--- a/arch/mips/ath79/pci.c
+++ b/arch/mips/ath79/pci.c
@@ -75,7 +75,9 @@ int __init pcibios_map_irq(const struct pci_dev *dev, uint8_t slot, uint8_t pin)
 		const struct ath79_pci_irq *entry;
 
 		entry = &ath79_pci_irq_map[i];
-		if (entry->slot == slot && entry->pin == pin) {
+		if (entry->bus == dev->bus->number &&
+		    entry->slot == slot &&
+		    entry->pin == pin) {
 			irq = entry->irq;
 			break;
 		}
diff --git a/arch/mips/ath79/pci.h b/arch/mips/ath79/pci.h
index 51c6625dcc6d..1d00a3803c37 100644
--- a/arch/mips/ath79/pci.h
+++ b/arch/mips/ath79/pci.h
@@ -14,6 +14,7 @@
 #define _ATH79_PCI_H
 
 struct ath79_pci_irq {
+	int	bus;
 	u8	slot;
 	u8	pin;
 	int	irq;

