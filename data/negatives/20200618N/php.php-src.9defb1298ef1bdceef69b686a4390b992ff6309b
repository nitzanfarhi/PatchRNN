commit 9defb1298ef1bdceef69b686a4390b992ff6309b
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Wed Dec 14 03:36:58 2005 +0000

    MFB51: Fixed bug #35571 (Fixed crash in Apache 2 SAPI when more then one php
    script is loaded via SSI include). (Ilia)

diff --git a/sapi/apache2handler/sapi_apache2.c b/sapi/apache2handler/sapi_apache2.c
index 354e2b9c60..0a9ab08ac8 100644
--- a/sapi/apache2handler/sapi_apache2.c
+++ b/sapi/apache2handler/sapi_apache2.c
@@ -471,7 +471,7 @@ static int php_handler(request_rec *r)
 
 	/* apply_config() needs r in some cases, so allocate server_context early */
 	ctx = SG(server_context);
-	if (ctx == NULL) {
+	if (ctx == NULL || (ctx && ctx->request_processed && !strcmp(r->protocol, "INCLUDED"))) {
 normal:
 		ctx = SG(server_context) = apr_pcalloc(r->pool, sizeof(*ctx));
 		/* register a cleanup so we clear out the SG(server_context)

