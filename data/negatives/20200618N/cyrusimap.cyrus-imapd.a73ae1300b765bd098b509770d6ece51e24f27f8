commit a73ae1300b765bd098b509770d6ece51e24f27f8
Author: Bron Gondwana <brong@opera.com>
Date:   Fri Oct 21 14:04:17 2011 +0200

    sync: don't count EXPUNGED record annotations in CRC

diff --git a/imap/sync_support.c b/imap/sync_support.c
index b9796ddc1..32c664bdd 100644
--- a/imap/sync_support.c
+++ b/imap/sync_support.c
@@ -2220,6 +2220,10 @@ int sync_crc_calc(struct mailbox *mailbox, char *buf, int maxlen)
 	if (mailbox_read_index_record(mailbox, recno, &record))
 	    continue;
 
+	/* always skip EXPUNGED flags, so we don't count the annots */
+	if (record.system_flags & FLAG_EXPUNGED)
+	    continue;
+
 	sync_crc_algorithm->addrecord(mailbox, &record, sync_crc_covers);
 	if ((sync_crc_covers & SYNC_CRC_ANNOTATIONS) && user_annot_db) {
 	    r = read_annotations(mailbox, &record, &annots);

