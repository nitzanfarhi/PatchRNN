commit e0a465829f30c2ae964ed4d0cfa5a0e92c7be50d
Author: Bron Gondwana <brong@fastmail.fm>
Date:   Fri Nov 24 11:40:55 2017 +1100

    sequence: handle adding the same number twice
    
    There are some cases in Xapian where we want to initialise a range,
    even though the first message we see might be the start of that range.
    
    It's much easier to check at this level than to pass "I already noted
    this UID" through the layers

diff --git a/imap/sequence.c b/imap/sequence.c
index fd218739d..00b9a2c81 100644
--- a/imap/sequence.c
+++ b/imap/sequence.c
@@ -92,6 +92,12 @@ EXPORTED void seqset_add(struct seqset *seq, unsigned num, int ismember)
 {
     if (!seq) return;
 
+    /* there are some cases where we want to make sure something is added
+     * as an initial value and then re-add it again later, so if we get
+     * the same number multiple times, that's OK */
+    if (ismember && num == seq->prev && seq->len && seq->set[seq->len-1].high == num)
+        return;
+
     if (num <= seq->prev)
         fatal("numbers out of order", EC_SOFTWARE);
 

