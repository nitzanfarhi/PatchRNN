commit 731a5c51040042a0f344752fee1117701efa3cfd
Author: Remi Collet <remi@php.net>
Date:   Tue Apr 2 16:31:36 2013 +0200

    keep previous test to avoid any behavior change

diff --git a/main/streams/streams.c b/main/streams/streams.c
index 7bc4c9ddb5..cb80e9a16b 100644
--- a/main/streams/streams.c
+++ b/main/streams/streams.c
@@ -1535,8 +1535,10 @@ PHPAPI int _php_stream_copy_to_stream_ex(php_stream *src, php_stream *dest, size
 
 			*len = didwrite;
 
-			/* read bytes match written */
-			if (mapped == didwrite) {
+			/* we've got at least 1 byte to read
+			 * less than 1 is an error
+			 * AND read bytes match written */
+			if (mapped > 0 && mapped == didwrite) {
 				return SUCCESS;
 			}
 			return FAILURE;

