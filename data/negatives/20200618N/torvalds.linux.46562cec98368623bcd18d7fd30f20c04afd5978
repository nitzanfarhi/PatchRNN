commit 46562cec98368623bcd18d7fd30f20c04afd5978
Author: Chris Mason <chris.mason@oracle.com>
Date:   Wed Sep 23 20:23:16 2009 -0400

    Btrfs: Fix test_range_bit for whole file extents
    
    If test_range_bit finds an extent that goes all the way to (u64)-1, it
    can incorrectly wrap the u64 instead of treaing it like the end of
    the address space.
    
    This just adds a check for the highest possible offset so we don't wrap.
    
    Signed-off-by: Chris Mason <chris.mason@oracle.com>

diff --git a/fs/btrfs/extent_io.c b/fs/btrfs/extent_io.c
index b9506548853b..dcce98d0ec4f 100644
--- a/fs/btrfs/extent_io.c
+++ b/fs/btrfs/extent_io.c
@@ -1564,6 +1564,10 @@ int test_range_bit(struct extent_io_tree *tree, u64 start, u64 end,
 			bitset = 0;
 			break;
 		}
+
+		if (state->end == (u64)-1)
+			break;
+
 		start = state->end + 1;
 		if (start > end)
 			break;

