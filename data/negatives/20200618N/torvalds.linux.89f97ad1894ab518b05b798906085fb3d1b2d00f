commit 89f97ad1894ab518b05b798906085fb3d1b2d00f
Author: Mike Miller <mike.miller@hp.com>
Date:   Mon Dec 18 10:59:39 2006 +0100

    [PATCH] cciss: set default raid level when reading geometry fails
    
    This patch sets a default raid level on a volume that either does not support
    reading the geometry or reports an invalid geometry for whatever reason. We
    were always setting some values for heads and sectors but never set a raid
    level. This caused lots of problems on some buggy firmware. Please consider
    this for inclusion.
    
    Thanks,
    mikem
    
    Signed-off-by: Mike Miller <mike.miller@hp.com>
    Signed-off-by: Jens Axboe <jens.axboe@oracle.com>

diff --git a/drivers/block/cciss.c b/drivers/block/cciss.c
index d719a5d8f435..67a6d4a9343a 100644
--- a/drivers/block/cciss.c
+++ b/drivers/block/cciss.c
@@ -1907,6 +1907,7 @@ static void cciss_geometry_inquiry(int ctlr, int logvol,
 			       "does not support reading geometry\n");
 			drv->heads = 255;
 			drv->sectors = 32;	// Sectors per track
+			drv->raid_level = RAID_UNKNOWN;
 		} else {
 			drv->heads = inq_buff->data_byte[6];
 			drv->sectors = inq_buff->data_byte[7];

