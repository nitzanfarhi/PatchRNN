commit 96d8549c08f3b5fa9c6247022e4f9ec48630af1b
Author: Wouter Verhelst <w@uter.be>
Date:   Thu Nov 5 14:33:21 2015 +0100

    Add cowdir to test suite and dup_serve()

diff --git a/nbdsrv.c b/nbdsrv.c
index 245fb2d..e939b88 100644
--- a/nbdsrv.c
+++ b/nbdsrv.c
@@ -179,6 +179,9 @@ SERVER* dup_serve(const SERVER *const s) {
 	if(s->servename)
 		serve->servename = g_strdup(s->servename);
 
+	if(s->cowdir)
+		serve->cowdir = g_strdup(s->cowdir);
+
 	serve->max_connections = s->max_connections;
 
 	return serve;
diff --git a/tests/code/dup.c b/tests/code/dup.c
index b67e8de..c5c1a92 100644
--- a/tests/code/dup.c
+++ b/tests/code/dup.c
@@ -32,6 +32,7 @@ int main(void) {
 		.servename = "test",
 		.max_connections = 0,
 		.transactionlog = "/etc/foo",
+		.cowdir = "/tmp",
 	};
 
 	srvd = dup_serve(&srvs);
@@ -49,4 +50,5 @@ int main(void) {
 	count_assert(stringcmp(srvs.servename, srvd->servename) == 0);
 	count_assert(srvs.max_connections == srvd->max_connections);
 	count_assert(stringcmp(srvs.transactionlog, srvd->transactionlog) == 0);
+	count_assert(stringcmp(srvs.cowdir, srvd->cowdir) == 0);
 }

