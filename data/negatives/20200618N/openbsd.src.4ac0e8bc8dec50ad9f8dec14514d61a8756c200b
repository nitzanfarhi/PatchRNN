commit 4ac0e8bc8dec50ad9f8dec14514d61a8756c200b
Author: espie <espie@openbsd.org>
Date:   Sat Nov 3 11:42:41 2007 +0000

    do the silent/ignore check in Job_CheckCommands, so that make -j4 -s works

diff --git a/usr.bin/make/compat.c b/usr.bin/make/compat.c
index 8fc82f13a6f..12c8c3bd5a3 100644
--- a/usr.bin/make/compat.c
+++ b/usr.bin/make/compat.c
@@ -1,5 +1,5 @@
 /*	$OpenPackages$ */
-/*	$OpenBSD: compat.c,v 1.63 2007/11/02 17:27:24 espie Exp $	*/
+/*	$OpenBSD: compat.c,v 1.64 2007/11/03 11:42:41 espie Exp $	*/
 /*	$NetBSD: compat.c,v 1.14 1996/11/06 17:59:01 christos Exp $	*/
 
 /*
@@ -128,14 +128,6 @@ CompatMake(void *gnp,	/* The node to make */
 		 * variable using Make_DoAllVar().  */
 		Make_DoAllVar(gn);
 
-		/* Alter our type to tell if errors should be ignored or things
-		 * should not be printed so CompatRunCommand knows what to do.
-		 */
-		if (Targ_Ignore(gn))
-			gn->type |= OP_IGNORE;
-		if (Targ_Silent(gn))
-			gn->type |= OP_SILENT;
-
 		if (Job_CheckCommands(gn, Fatal)) {
 			/* Our commands are ok, but we still have to worry
 			 * about the -t flag...	*/
diff --git a/usr.bin/make/engine.c b/usr.bin/make/engine.c
index f49d9845937..bdb18083521 100644
--- a/usr.bin/make/engine.c
+++ b/usr.bin/make/engine.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: engine.c,v 1.10 2007/11/02 17:27:24 espie Exp $ */
+/*	$OpenBSD: engine.c,v 1.11 2007/11/03 11:42:41 espie Exp $ */
 /*
  * Copyright (c) 1988, 1989, 1990 The Regents of the University of California.
  * Copyright (c) 1988, 1989 by Adam de Boor
@@ -76,6 +76,14 @@ static void handle_compat_interrupts(GNode *);
 bool
 Job_CheckCommands(GNode *gn, void (*abortProc)(char *, ...))
 {
+	/* Alter our type to tell if errors should be ignored or things
+	 * should not be printed so CompatRunCommand knows what to do.
+	 */
+	if (Targ_Ignore(gn))
+		gn->type |= OP_IGNORE;
+	if (Targ_Silent(gn))
+		gn->type |= OP_SILENT;
+
 	if (OP_NOP(gn->type) && Lst_IsEmpty(&gn->commands) &&
 	    (gn->type & (OP_NODEFAULT | OP_LIB)) == 0) {
 		/*

