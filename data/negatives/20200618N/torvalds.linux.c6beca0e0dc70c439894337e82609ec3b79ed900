commit c6beca0e0dc70c439894337e82609ec3b79ed900
Author: Marcel Holtmann <marcel@holtmann.org>
Date:   Mon Feb 17 09:21:19 2014 -0800

    Bluetooth: Allow HCI User Channel usage for controllers without address
    
    Trying to setup HCI User Channel usage for LE only controllers without
    a public address or configured static address will fail with an error
    saying that no address is available.
    
    In case of HCI User Channel the requirement for a valid address is not
    needed. So allow skipping this extra validation step.
    
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
    Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>

diff --git a/net/bluetooth/hci_core.c b/net/bluetooth/hci_core.c
index 58d2f9bf241f..b40d52446f8f 100644
--- a/net/bluetooth/hci_core.c
+++ b/net/bluetooth/hci_core.c
@@ -1937,10 +1937,15 @@ static int hci_dev_do_open(struct hci_dev *hdev)
 		 * be able to determine if there is a public address
 		 * or not.
 		 *
+		 * In case of user channel usage, it is not important
+		 * if a public address or static random address is
+		 * available.
+		 *
 		 * This check is only valid for BR/EDR controllers
 		 * since AMP controllers do not have an address.
 		 */
-		if (hdev->dev_type == HCI_BREDR &&
+		if (!test_bit(HCI_USER_CHANNEL, &hdev->dev_flags) &&
+		    hdev->dev_type == HCI_BREDR &&
 		    !bacmp(&hdev->bdaddr, BDADDR_ANY) &&
 		    !bacmp(&hdev->static_addr, BDADDR_ANY)) {
 			ret = -EADDRNOTAVAIL;

