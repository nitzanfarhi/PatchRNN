commit 2aa9e85c4634100cd10b1a052b0d6e22e1ce5911
Author: Yonit Halperin <yhalperi@redhat.com>
Date:   Wed Feb 15 11:22:16 2012 +0200

    qxl: make sure primary surface is saved on migration also in compat mode
    
    RHBZ #790083
    
    Signed-off-by: Yonit Halperin <yhalperi@redhat.com>
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

diff --git a/hw/qxl.c b/hw/qxl.c
index b544f31052..5c6b5565dc 100644
--- a/hw/qxl.c
+++ b/hw/qxl.c
@@ -1471,7 +1471,7 @@ static void qxl_dirty_surfaces(PCIQXLDevice *qxl)
     intptr_t vram_start;
     int i;
 
-    if (qxl->mode != QXL_MODE_NATIVE) {
+    if (qxl->mode != QXL_MODE_NATIVE && qxl->mode != QXL_MODE_COMPAT) {
         return;
     }
 

