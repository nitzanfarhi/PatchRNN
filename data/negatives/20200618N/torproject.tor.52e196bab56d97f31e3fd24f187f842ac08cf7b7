commit 52e196bab56d97f31e3fd24f187f842ac08cf7b7
Author: Nick Mathewson <nickm@torproject.org>
Date:   Wed Nov 30 13:10:35 2016 -0500

    Don't make $hexid nicknames persistent.
    
    (That's asking for trouble, and also totally completely redundant.)

diff --git a/src/or/entrynodes.c b/src/or/entrynodes.c
index 1f6d562fd..78257ca84 100644
--- a/src/or/entrynodes.c
+++ b/src/or/entrynodes.c
@@ -2420,7 +2420,7 @@ entry_guard_encode_for_state(entry_guard_t *guard)
                            fmt_and_decorate_addr(&guard->bridge_addr->addr),
                            guard->bridge_addr->port);
   }
-  if (strlen(guard->nickname)) {
+  if (strlen(guard->nickname) && is_legal_nickname(guard->nickname)) {
     smartlist_add_asprintf(result, "nickname=%s", guard->nickname);
   }
 

