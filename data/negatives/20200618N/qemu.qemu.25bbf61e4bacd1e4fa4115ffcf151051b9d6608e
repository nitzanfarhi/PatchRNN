commit 25bbf61e4bacd1e4fa4115ffcf151051b9d6608e
Author: Gerd Hoffmann <kraxel@redhat.com>
Date:   Thu Jan 3 14:23:03 2013 +0100

    pty: unbreak libvirt
    
    Commit 586502189edf9fd0f89a83de96717a2ea826fdb0 breaks libvirt pty
    support because it tried to figure the pts name from stderr output.
    
    Fix this by moving the label to the end of the line, this way the
    libvirt parser does still recognise the message.  libvirt looks
    for "char device redirected to ${ptsname}<whitespace>".
    
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
    Signed-off-by: Anthony Liguori <aliguori@us.ibm.com>

diff --git a/qemu-char.c b/qemu-char.c
index 331ad5c087..f41788c9ef 100644
--- a/qemu-char.c
+++ b/qemu-char.c
@@ -1012,10 +1012,11 @@ static CharDriverState *qemu_chr_open_pty(QemuOpts *opts)
     qemu_opt_set(opts, "path", q_ptsname(master_fd));
 
     label = qemu_opts_id(opts);
-    fprintf(stderr, "char device%s%s redirected to %s\n",
-            label ? " " : "",
-            label ?: "",
-            q_ptsname(master_fd));
+    fprintf(stderr, "char device redirected to %s%s%s%s\n",
+            q_ptsname(master_fd),
+            label ? " (label " : "",
+            label ? label      : "",
+            label ? ")"        : "");
 
     s = g_malloc0(sizeof(PtyCharDriver));
     chr->opaque = s;

