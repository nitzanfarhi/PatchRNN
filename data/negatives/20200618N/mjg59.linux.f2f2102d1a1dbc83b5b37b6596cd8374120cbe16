commit f2f2102d1a1dbc83b5b37b6596cd8374120cbe16
Author: David S. Miller <davem@sunset.davemloft.net>
Date:   Tue Feb 6 14:32:42 2007 -0800

    [XFRM]: Fix missed error setting in xfrm4_policy.c
    
    When we can't find the afinfo we should return EAFNOSUPPORT.
    GCC warned about the uninitialized 'err' for this path as well.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/ipv4/xfrm4_policy.c b/net/ipv4/xfrm4_policy.c
index 011136a95809..699f27ce62ad 100644
--- a/net/ipv4/xfrm4_policy.c
+++ b/net/ipv4/xfrm4_policy.c
@@ -175,6 +175,7 @@ __xfrm4_bundle_create(struct xfrm_policy *policy, struct xfrm_state **xfrm, int
 		afinfo = xfrm_state_get_afinfo(dst_prev->xfrm->props.family);
 		if (!afinfo) {
 			dst = *dst_p;
+			err = -EAFNOSUPPORT;
 			goto error;
 		}
 		dst_prev->output = afinfo->output;

