commit 02d24cc512caa92d37884ef020d95fb389de12ce
Author: Dmitry Stogov <dmitry@php.net>
Date:   Wed May 2 10:16:48 2007 +0000

    Fixed bug #41192 (Per Directory Values only work for one key)

diff --git a/win32/registry.c b/win32/registry.c
index 9c674c0819..cdeb85f21d 100644
--- a/win32/registry.c
+++ b/win32/registry.c
@@ -135,11 +135,12 @@ static int LoadDirectory(HashTable *directories, HKEY key, char *path, int path_
 							new_path[path_len] = '/';
 							memcpy(new_path+path_len+1, name, name_len+1);
 							zend_str_tolower(new_path, path_len+name_len+1);
+							name_len += path_len+1;
 						} else {
 							memcpy(new_path, name, name_len+1);
 							zend_str_tolower(new_path, name_len);
 						}
-						if (LoadDirectory(directories, subkey, new_path, path_len+name_len, ht)) {
+						if (LoadDirectory(directories, subkey, new_path, name_len, ht)) {
 							ret = 1;
 						}
 						RegCloseKey(subkey);

