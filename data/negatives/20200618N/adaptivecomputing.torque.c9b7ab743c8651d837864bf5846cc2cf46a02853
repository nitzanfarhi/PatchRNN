commit c9b7ab743c8651d837864bf5846cc2cf46a02853
Author: jrosenquist <jrosenquist@8f940c70-5916-0410-ac46-d1fa2fa6ea29>
Date:   Wed Sep 21 15:37:04 2011 +0000

    added no fork with PBSDEBUG set option

diff --git a/src/daemon_client/trq_auth_daemon.c b/src/daemon_client/trq_auth_daemon.c
index 275573d74..e3c32515b 100644
--- a/src/daemon_client/trq_auth_daemon.c
+++ b/src/daemon_client/trq_auth_daemon.c
@@ -79,30 +79,35 @@ int daemonize_trqauthd(char *server_ip, int server_port, void *(*process_meth)(v
     return(1);
     }
 
-  pid = fork();
-  if(pid)
+  if (getenv("PBSDEBUG") == NULL)
     {
-    /* parent. We are done */
-    return(0);
-    }
-
-  if(pid < 0)
-    {
-    /* something went wrong */
-    fprintf(stderr, "fork failed. errno = %d\n", errno);
-    return(PBSE_RMSYSTEM);
+    pid = fork();
+    if(pid > 0)
+      {
+      /* parent. We are done */
+      return(0);
+      }
+    else if (pid < 0)
+      {
+      /* something went wrong */
+      fprintf(stderr, "fork failed. errno = %d\n", errno);
+      return(PBSE_RMSYSTEM);
+      }
+    else
+      {
+      fprintf(stdout, "trqauthd daemonized\n");
+      /* If I made it here I am the child */
+      fclose(stdin);
+      fclose(stdout);
+      fclose(stderr);
+      /* We closed 0 (stdin), 1 (stdout), and 2 (stderr). fopen should give us
+         0, 1 and 2 in that order. this is a UNIX practice */
+      fd = fopen("/dev/null", "r");
+      fd = fopen("/dev/null", "r");
+      fd = fopen("/dev/null", "r");
+      }
     }
 
-    /* If I made it here I am the child */
-    fclose(stdin);
-    fclose(stdout);
-    fclose(stderr);
-    /* We closed 0 (stdin), 1 (stdout), and 2 (stderr). fopen should give us
-       0, 1 and 2 in that order. this is a UNIX practice */
-    fd = fopen("/dev/null", "r");
-    fd = fopen("/dev/null", "r");
-    fd = fopen("/dev/null", "r");
-
     /* start the listener */
     rc = start_listener(server_ip, server_port, process_meth);
     if(rc != PBSE_NONE)

