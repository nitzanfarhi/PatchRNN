commit aa431098414dd7e5f74874395ea63bad46a3b462
Author: magnus.blaudd@oracle.com <>
Date:   Fri May 31 10:42:45 2013 +0200

    Bug#14849574 MYSQL_SHUTDOWN() RETURNS NO ERROR BUT NOTHING HAPPENS IN MYSQLD
    
     - make also the "waiting for cluster started" loop in  binlog thread check if THD
       has been killed

diff --git a/sql/ha_ndbcluster_binlog.cc b/sql/ha_ndbcluster_binlog.cc
index f33ea22bea9..3f7380fe058 100644
--- a/sql/ha_ndbcluster_binlog.cc
+++ b/sql/ha_ndbcluster_binlog.cc
@@ -6982,6 +6982,19 @@ restart_cluster_failure:
         pthread_mutex_unlock(&injector_mutex);
         goto err;
       }
+      if (thd->killed == THD::KILL_CONNECTION)
+      {
+        /*
+          Since the ndb binlog thread adds itself to the "global thread list"
+          it need to look at the "killed" flag and stop the thread to avoid
+          that the server hangs during shutdown while waiting for the "global
+          thread list" to be emtpy.
+        */
+        sql_print_information("NDB Binlog: Server shutdown detected while "
+                              "waiting for ndbcluster to start...");
+        pthread_mutex_unlock(&injector_mutex);
+        goto err;
+      }
     }
     pthread_mutex_unlock(&injector_mutex);
 

