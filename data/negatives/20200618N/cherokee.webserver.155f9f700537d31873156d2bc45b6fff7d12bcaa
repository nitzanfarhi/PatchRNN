commit 155f9f700537d31873156d2bc45b6fff7d12bcaa
Author: Alvaro Lopez Ortega <alvaro@alobbs.com>
Date:   Thu Oct 13 13:40:01 2011 +0200

    Fixes a regression introduced by Cherokee 1.2.100. The proxy handler
    could no longer launch Information Sources.

diff --git a/cherokee/handler_proxy.c b/cherokee/handler_proxy.c
index cd9be50a..675bc230 100644
--- a/cherokee/handler_proxy.c
+++ b/cherokee/handler_proxy.c
@@ -994,7 +994,7 @@ cherokee_handler_proxy_init (cherokee_handler_proxy_t *hdl)
 				return ret_eagain;
 			case ret_deny:
 				/* Multiple IPs on a single source */
-				if (hdl->pconn->addr_current < hdl->pconn->addr_total) {
+				if (hdl->pconn->addr_current < hdl->pconn->addr_total - 1) {
 					hdl->pconn->addr_current += 1;
 					cherokee_socket_close (&hdl->pconn->socket);
 					cherokee_socket_clean (&hdl->pconn->socket);
@@ -1013,16 +1013,15 @@ cherokee_handler_proxy_init (cherokee_handler_proxy_t *hdl)
 
 					/* Spawn a new process
 					 */
-					ret = cherokee_virtual_server_get_error_log (CONN_VSRV(conn),
-										     &error_writer);
+					ret = cherokee_virtual_server_get_error_log (CONN_VSRV(conn), &error_writer);
 					if (ret != ret_ok) {
 						return ret_error;
 					}
 
-					ret = cherokee_source_interpreter_spawn (SOURCE_INT(hdl->src_ref),
-										 error_writer);
+					ret = cherokee_source_interpreter_spawn (SOURCE_INT(hdl->src_ref), error_writer);
 					switch (ret) {
 					case ret_ok:
+						hdl->pconn->addr_current = 0;
 						break;
 					case ret_eagain:
 						return ret_eagain;

