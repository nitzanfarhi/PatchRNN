commit 2df2921fd3164b4541dcc8e5d6006edde5b4bf17
Author: Kevin McCarthy <kevin@8t8.us>
Date:   Sat Mar 18 14:39:12 2017 -0700

    Fix mutt_envlist_set() for the case that envlist is null. (see #3922)

diff --git a/init.c b/init.c
index 7e027c66e..953e5c8bf 100644
--- a/init.c
+++ b/init.c
@@ -1879,16 +1879,15 @@ void mutt_envlist_set (const char *name, const char *value)
   snprintf (work, sizeof(work), "%s=%s", NONULL (name), NONULL (value));
 
   /* If slot found, overwrite */
-  if (*envp)
+  if (envp && *envp)
     *envp = safe_strdup (work);
 
   /* If not found, add new slot */
   else
   {
-    *envp = safe_strdup (work);
-    count++;
-    safe_realloc (&envlist, sizeof(char *) * (count + 1));
-    envlist[count] = NULL;
+    safe_realloc (&envlist, sizeof(char *) * (count + 2));
+    envlist[count] = safe_strdup (work);
+    envlist[count + 1] = NULL;
   }
 }
 

