commit 9fd3d3a4307283a1d85d9a383223055954b7135f
Author: Edward Cree <ecree@solarflare.com>
Date:   Mon Nov 3 14:14:35 2014 +0000

    sfc: don't BUG_ON efx->max_channels == 0 in probe
    
    efx_ef10_probe() was BUGging out if the BAR2 size was 0.  This is
     unnecessarily violent; instead we should just fail to probe the device.
    Kept a WARN_ON as this problem indicates a broken or misconfigured NIC.
    
    Signed-off-by: Edward Cree <ecree@solarflare.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/ethernet/sfc/ef10.c b/drivers/net/ethernet/sfc/ef10.c
index 002d4cdc319f..a77f05ce8325 100644
--- a/drivers/net/ethernet/sfc/ef10.c
+++ b/drivers/net/ethernet/sfc/ef10.c
@@ -180,7 +180,8 @@ static int efx_ef10_probe(struct efx_nic *efx)
 		      EFX_MAX_CHANNELS,
 		      resource_size(&efx->pci_dev->resource[EFX_MEM_BAR]) /
 		      (EFX_VI_PAGE_SIZE * EFX_TXQ_TYPES));
-	BUG_ON(efx->max_channels == 0);
+	if (WARN_ON(efx->max_channels == 0))
+		return -EIO;
 
 	nic_data = kzalloc(sizeof(*nic_data), GFP_KERNEL);
 	if (!nic_data)

