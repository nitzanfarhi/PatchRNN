commit 30e68bcc67e41ab6dab4e4e1efc7ea8ca893c0af
Author: Namhyung Kim <namhyung.kim@lge.com>
Date:   Mon Feb 20 10:47:26 2012 +0900

    perf evlist: Return first evsel for non-sample event on old kernel
    
    On old kernels that don't support sample_id_all feature,
    perf_evlist__id2evsel() returns NULL for non-sampling events.
    
    This breaks perf top when multiple events are given on command line. Fix
    it by using first evsel in the evlist. This will also prevent getting
    the same (potential) problem in such new tool/ old kernel combo.
    
    Suggested-by: Arnaldo Carvalho de Melo <acme@ghostprotocols.net>
    Cc: Ingo Molnar <mingo@elte.hu>
    Cc: Paul Mackerras <paulus@samba.org>
    Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Link: http://lkml.kernel.org/r/1329702447-25045-1-git-send-email-namhyung.kim@lge.com
    Signed-off-by: Namhyung Kim <namhyung.kim@lge.com>
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/perf/util/evlist.c b/tools/perf/util/evlist.c
index 3f16e08a5c8d..ea32a061f1c8 100644
--- a/tools/perf/util/evlist.c
+++ b/tools/perf/util/evlist.c
@@ -349,6 +349,10 @@ struct perf_evsel *perf_evlist__id2evsel(struct perf_evlist *evlist, u64 id)
 	hlist_for_each_entry(sid, pos, head, node)
 		if (sid->id == id)
 			return sid->evsel;
+
+	if (!perf_evlist__sample_id_all(evlist))
+		return list_entry(evlist->entries.next, struct perf_evsel, node);
+
 	return NULL;
 }
 

