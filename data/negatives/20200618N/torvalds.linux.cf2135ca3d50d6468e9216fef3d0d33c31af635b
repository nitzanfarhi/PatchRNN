commit cf2135ca3d50d6468e9216fef3d0d33c31af635b
Author: Chuanxiao Dong <chuanxiao.dong@intel.com>
Date:   Thu Mar 9 23:07:12 2017 +0800

    drm/i915/gvt: add enable_execlists check before enable gvt
    
    The GVT-g needs execlists to be enabled otherwise gvt should be
    disabled. Add a check for enable_execlists before enabling gvt.
    
    v2: use DRM_INFO in response to the user action
    
    Signed-off-by: Chuanxiao Dong <chuanxiao.dong@intel.com>
    Signed-off-by: Zhenyu Wang <zhenyuw@linux.intel.com>

diff --git a/drivers/gpu/drm/i915/intel_gvt.c b/drivers/gpu/drm/i915/intel_gvt.c
index d23c0fcff751..8c04eca84351 100644
--- a/drivers/gpu/drm/i915/intel_gvt.c
+++ b/drivers/gpu/drm/i915/intel_gvt.c
@@ -77,6 +77,11 @@ int intel_gvt_init(struct drm_i915_private *dev_priv)
 		goto bail;
 	}
 
+	if (!i915.enable_execlists) {
+		DRM_INFO("GPU guest virtualisation [GVT-g] disabled due to disabled execlist submission [i915.enable_execlists module parameter]\n");
+		goto bail;
+	}
+
 	/*
 	 * We're not in host or fail to find a MPT module, disable GVT-g
 	 */

