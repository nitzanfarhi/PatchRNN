commit 274a1bdf62036012295643f041c89bafc5956f58
Author: Rob Siemborski <rjs3@andrew.cmu.edu>
Date:   Mon Dec 16 16:26:08 2002 +0000

    set close on exec for pidfile

diff --git a/master/master.c b/master/master.c
index a91e63ffe..f2b39200a 100644
--- a/master/master.c
+++ b/master/master.c
@@ -39,7 +39,7 @@
  * OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
  */
 
-/* $Id: master.c,v 1.72 2002/12/10 15:47:49 rjs3 Exp $ */
+/* $Id: master.c,v 1.73 2002/12/16 16:26:08 rjs3 Exp $ */
 
 #include <config.h>
 
@@ -1307,6 +1307,15 @@ int main(int argc, char **argv)
 	if(lock_nonblocking(pidfd)) {
 	    fatal("cannot get exclusive lock on pidfile (is another master still running?)", EX_OSERR);
 	} else {
+	    int pidfd_flags = fcntl(pidfd, F_GETFD, 0);
+	    if (pidfd_flags != -1)
+		pidfd_flags = fcntl(pidfd, F_SETFD, 
+				    pidfd_flags | FD_CLOEXEC);
+	    if (pidfd_flags == -1) {
+		fatal("unable to set close-on-exec for pidfile: %m", 1);
+	    }
+	    
+	    /* Write PID */
 	    snprintf(buf, sizeof(buf), "%d\n", getpid());
 	    write(pidfd, buf, strlen(buf));
 	    fsync(pidfd);

