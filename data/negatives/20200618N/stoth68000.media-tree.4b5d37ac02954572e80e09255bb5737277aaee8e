commit 4b5d37ac02954572e80e09255bb5737277aaee8e
Author: Giancarlo Formicuccia <giancarlo.formicuccia@gmail.com>
Date:   Fri Sep 9 13:01:22 2005 -0700

    [PATCH] Clear task_struct->fs_excl on fork()
    
    An oversight.  We don't want to carry the IO scheduler's "we hold exclusive fs
    resources" hint over to the child across fork().
    
    Acked-by: Jens Axboe <axboe@suse.de>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/kernel/fork.c b/kernel/fork.c
index 7e1ead9a6ba4..dfeadf466f18 100644
--- a/kernel/fork.c
+++ b/kernel/fork.c
@@ -176,6 +176,7 @@ static struct task_struct *dup_task_struct(struct task_struct *orig)
 
 	/* One for us, one for whoever does the "release_task()" (usually parent) */
 	atomic_set(&tsk->usage,2);
+	atomic_set(&tsk->fs_excl, 0);
 	return tsk;
 }
 

