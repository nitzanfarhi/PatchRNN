commit 3a9db563fdd883d179aae7573d2b997b57a917bc
Author: Armin Novak <armin.novak@thincast.com>
Date:   Wed Jul 1 16:05:11 2015 +0200

    NLA: Fixed length check.

diff --git a/libfreerdp/core/nla.c b/libfreerdp/core/nla.c
index c2c742df3..88192b916 100644
--- a/libfreerdp/core/nla.c
+++ b/libfreerdp/core/nla.c
@@ -929,9 +929,12 @@ BOOL nla_read_ts_password_creds(rdpNla* nla, wStream* s)
 	nla->identity->Password = NULL;
 	nla->identity->PasswordLength = (UINT32) 0;
 
+	if (!ber_read_sequence_tag(s, &length))
+		return FALSE;
+
 	/* The sequence is empty, return early,
 	 * TSPasswordCreds (SEQUENCE) is optional. */
-	if (!ber_read_sequence_tag(s, &length))
+	if (length == 0)
 		return TRUE;
 
 	/* [0] domainName (OCTET STRING) */

