commit 46e6c6be50a33c54127ea4f6364efdd23f738c02
Author: Benety Goh <benety@mongodb.com>
Date:   Thu Sep 17 15:59:34 2015 -0400

    SERVER-20473 ReplicationCoordinator::setMaintenanceMode() should fail if the node is currently running for election

diff --git a/src/mongo/db/repl/replication_coordinator_impl.cpp b/src/mongo/db/repl/replication_coordinator_impl.cpp
index 291b591ab3..a1b9e55694 100644
--- a/src/mongo/db/repl/replication_coordinator_impl.cpp
+++ b/src/mongo/db/repl/replication_coordinator_impl.cpp
@@ -1677,6 +1677,11 @@ void ReplicationCoordinatorImpl::_setMaintenanceMode_helper(
         return;
     }
 
+    if (_topCoord->getRole() == TopologyCoordinator::Role::candidate) {
+        *result = Status(ErrorCodes::NotMaster, "currently running for election");
+        return;
+    }
+
     stdx::unique_lock<stdx::mutex> lk(_mutex);
     if (_getMemberState_inlock().primary()) {
         *result = Status(ErrorCodes::NotSecondary, "primaries can't modify maintenance mode");

