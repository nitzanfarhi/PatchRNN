commit 8b5869ad85f703ffeb25e656eab826f6b85b984c
Author: Paul Mackerras <paulus@samba.org>
Date:   Mon Oct 15 01:20:50 2012 +0000

    KVM: PPC: Book3S HV: Fix thinko in try_lock_hpte()
    
    This fixes an error in the inline asm in try_lock_hpte() where we
    were erroneously using a register number as an immediate operand.
    The bug only affects an error path, and in fact the code will still
    work as long as the compiler chooses some register other than r0
    for the "bits" variable.  Nevertheless it should still be fixed.
    
    Signed-off-by: Paul Mackerras <paulus@samba.org>
    Signed-off-by: Alexander Graf <agraf@suse.de>

diff --git a/arch/powerpc/include/asm/kvm_book3s_64.h b/arch/powerpc/include/asm/kvm_book3s_64.h
index 0dd1d86d3e31..1472a5b4e4e3 100644
--- a/arch/powerpc/include/asm/kvm_book3s_64.h
+++ b/arch/powerpc/include/asm/kvm_book3s_64.h
@@ -60,7 +60,7 @@ static inline long try_lock_hpte(unsigned long *hpte, unsigned long bits)
 		     "	ori	%0,%0,%4\n"
 		     "  stdcx.	%0,0,%2\n"
 		     "	beq+	2f\n"
-		     "	li	%1,%3\n"
+		     "	mr	%1,%3\n"
 		     "2:	isync"
 		     : "=&r" (tmp), "=&r" (old)
 		     : "r" (hpte), "r" (bits), "i" (HPTE_V_HVLOCK)

