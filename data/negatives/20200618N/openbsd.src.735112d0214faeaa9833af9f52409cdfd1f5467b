commit 735112d0214faeaa9833af9f52409cdfd1f5467b
Author: bluhm <bluhm@openbsd.org>
Date:   Tue Jan 3 13:32:51 2017 +0000

    Take the neighbor solicitation's source address from the packet to
    send if the mbuf contains the complete IPv6 header.  The old check
    was wrong, it required one additional octet after the header.  So
    the source address selection was depending on the layout of the
    mbuf chain.
    OK mpi@

diff --git a/sys/netinet6/nd6_nbr.c b/sys/netinet6/nd6_nbr.c
index b0d1793b3fa..d937598bbca 100644
--- a/sys/netinet6/nd6_nbr.c
+++ b/sys/netinet6/nd6_nbr.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: nd6_nbr.c,v 1.113 2016/12/22 13:39:32 mpi Exp $	*/
+/*	$OpenBSD: nd6_nbr.c,v 1.114 2017/01/03 13:32:51 bluhm Exp $	*/
 /*	$KAME: nd6_nbr.c,v 1.61 2001/02/10 16:06:14 jinmei Exp $	*/
 
 /*
@@ -453,8 +453,7 @@ nd6_ns_output(struct ifnet *ifp, struct in6_addr *daddr6,
 
 		if (ln && ln->ln_hold) {
 			hip6 = mtod(ln->ln_hold, struct ip6_hdr *);
-			/* XXX pullup? */
-			if (sizeof(*hip6) < ln->ln_hold->m_len)
+			if (sizeof(*hip6) <= ln->ln_hold->m_len)
 				saddr6 = &hip6->ip6_src;
 			else
 				saddr6 = NULL;

