commit 6fbf1c3b8d5de4b80b99a779cbe904eabe57faed
Author: Timo Sirainen <timo.sirainen@dovecot.fi>
Date:   Mon Apr 16 14:01:37 2018 +0300

    lib-master: Add log_core_filter setting to core dump on matching filter

diff --git a/src/lib-master/master-service-settings.c b/src/lib-master/master-service-settings.c
index f24ba8b33..6feac9d2f 100644
--- a/src/lib-master/master-service-settings.c
+++ b/src/lib-master/master-service-settings.c
@@ -44,6 +44,7 @@ static const struct setting_define master_service_setting_defines[] = {
 	DEF(SET_STR, debug_log_path),
 	DEF(SET_STR, log_timestamp),
 	DEF(SET_STR, log_debug),
+	DEF(SET_STR, log_core_filter),
 	DEF(SET_STR, syslog_facility),
 	DEF(SET_STR, import_environment),
 	DEF(SET_STR, stats_writer_socket_path),
@@ -79,6 +80,7 @@ static const struct master_service_settings master_service_default_settings = {
 	.debug_log_path = "",
 	.log_timestamp = DEFAULT_FAILURE_STAMP_FORMAT,
 	.log_debug = "",
+	.log_core_filter = "",
 	.syslog_facility = "mail",
 	.import_environment = "TZ CORE_OUTOFMEM CORE_ERROR" ENV_SYSTEMD ENV_GDB,
 	.stats_writer_socket_path = "stats-writer",
@@ -168,6 +170,16 @@ master_service_settings_check(void *_set, pool_t pool ATTR_UNUSED,
 #endif
 		event_filter_unref(&filter);
 	}
+
+	if (!log_filter_parse("log_core_filter", set->log_core_filter,
+			      &filter, error_r))
+		return FALSE;
+	if (filter != NULL) {
+#ifndef CONFIG_BINARY
+		event_set_global_core_log_filter(filter);
+#endif
+		event_filter_unref(&filter);
+	}
 	return TRUE;
 }
 /* </settings checks> */
diff --git a/src/lib-master/master-service-settings.h b/src/lib-master/master-service-settings.h
index 3097ca6a4..e85c1245e 100644
--- a/src/lib-master/master-service-settings.h
+++ b/src/lib-master/master-service-settings.h
@@ -15,6 +15,7 @@ struct master_service_settings {
 	const char *debug_log_path;
 	const char *log_timestamp;
 	const char *log_debug;
+	const char *log_core_filter;
 	const char *syslog_facility;
 	const char *import_environment;
 	const char *stats_writer_socket_path;

