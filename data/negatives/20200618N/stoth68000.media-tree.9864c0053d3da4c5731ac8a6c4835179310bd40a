commit 9864c0053d3da4c5731ac8a6c4835179310bd40a
Author: 马建朋 <majianpeng@gmail.com>
Date:   Thu Jun 9 11:42:48 2011 +1000

    md: Using poll  /proc/mdstat can monitor the events of adding a spare disks
    
    Signed-off-by: majianpeng <majianpeng@gmail.com>
    Signed-off-by: NeilBrown <neilb@suse.de>

diff --git a/drivers/md/md.c b/drivers/md/md.c
index 9160463b5f68..734bc0996390 100644
--- a/drivers/md/md.c
+++ b/drivers/md/md.c
@@ -5274,6 +5274,8 @@ static int add_new_disk(mddev_t * mddev, mdu_disk_info_t *info)
 		if (mddev->degraded)
 			set_bit(MD_RECOVERY_RECOVER, &mddev->recovery);
 		set_bit(MD_RECOVERY_NEEDED, &mddev->recovery);
+		if (!err)
+			md_new_event(mddev);
 		md_wakeup_thread(mddev->thread);
 		return err;
 	}

