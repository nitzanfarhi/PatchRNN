commit 0dd2ddd2bc71bb180811eae73ecc15c526520144
Author: reimar <reimar@b3059339-0415-0410-9bf9-f77b7e298cf2>
Date:   Fri May 21 17:19:01 2010 +0000

    Change WAV header updating in ao_pcm to allow to up to almost 4GB size.
    Patch by Rob McMullen [robm users sourceforge net]
    
    
    git-svn-id: svn://svn.mplayerhq.hu/mplayer/trunk@31189 b3059339-0415-0410-9bf9-f77b7e298cf2

diff --git a/libao2/ao_pcm.c b/libao2/ao_pcm.c
index 10ee82a0e2..d7c0e39d07 100644
--- a/libao2/ao_pcm.c
+++ b/libao2/ao_pcm.c
@@ -210,9 +210,11 @@ static void uninit(int immed){
 #endif
         if (broken_seek || fseek(fp, 0, SEEK_SET) != 0)
             mp_msg(MSGT_AO, MSGL_ERR, "Could not seek to start, WAV size headers not updated!\n");
-        else if (data_length > 0x7ffff000)
-            mp_msg(MSGT_AO, MSGL_ERR, "File larger than allowed for WAV files, may play truncated!\n");
         else {
+            if (data_length > 0xfffff000) {
+                mp_msg(MSGT_AO, MSGL_ERR, "File larger than allowed for WAV files, may play truncated!\n");
+                data_length = 0xfffff000;
+            }
             write_wave_header(fp, data_length);
         }
     }

