commit 7eae20db6adf721d0c14ad2a37208278ce4f11dc
Author: Majd Dibbiny <majd@mellanox.com>
Date:   Tue Jan 6 13:56:01 2015 +0200

    IB/mlx5: Update the dev in reg_create
    
    When we create an MR using reg_create, the mlx5_ib_dev pointer is not
    updated on the new MR. This results in a kernel panics for ODP MRs
    while handling page faults, when the mlx5_ib_update_mtt function uses
    the invalid device pointer.
    
    Signed-off-by: Majd Dibbiny <majd@mellanox.com>
    Signed-off-by: Haggai Eran <haggaie@mellanox.com>
    Signed-off-by: Roland Dreier <roland@purestorage.com>

diff --git a/drivers/infiniband/hw/mlx5/mr.c b/drivers/infiniband/hw/mlx5/mr.c
index 32a28bd50b20..cd9822eeacae 100644
--- a/drivers/infiniband/hw/mlx5/mr.c
+++ b/drivers/infiniband/hw/mlx5/mr.c
@@ -1012,6 +1012,7 @@ static struct mlx5_ib_mr *reg_create(struct ib_pd *pd, u64 virt_addr,
 		goto err_2;
 	}
 	mr->umem = umem;
+	mr->dev = dev;
 	mr->live = 1;
 	kvfree(in);
 

