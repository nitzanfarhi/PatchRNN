commit b9c0e2834af38dbac0ab8a4a621c9609e2524037
Author: Jan Kundr√°t <jkt@gentoo.org>
Date:   Sat Jun 5 01:04:16 2010 +0200

    Use SQL transactions

diff --git a/src/Imap/Model/SQLCache.cpp b/src/Imap/Model/SQLCache.cpp
index 2d0995d1..82cdddb1 100644
--- a/src/Imap/Model/SQLCache.cpp
+++ b/src/Imap/Model/SQLCache.cpp
@@ -196,6 +196,7 @@ bool SQLCache::childMailboxesFresh( const QString& mailbox ) const
 
 void SQLCache::setChildMailboxes( const QString& mailbox, const QList<MailboxMetadata>& data )
 {
+    TransactionHelper txn(&db);
     QString myMailbox = mailbox.isEmpty() ? QString::fromAscii("") : mailbox;
     QVariantList mailboxFields, parentFields, separatorFields, flagsFelds;
     Q_FOREACH( const MailboxMetadata& item, data ) {
@@ -220,6 +221,7 @@ void SQLCache::setChildMailboxes( const QString& mailbox, const QList<MailboxMet
         emitError( tr("Query querySetChildMailboxesFresh failed"), querySetChildMailboxesFresh );
         return;
     }
+    txn.commit();
 }
 
 void SQLCache::forgetChildMailboxes( const QString& mailbox )

