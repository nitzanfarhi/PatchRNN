commit 2c26f25a151dd504b2664b1721c6a2cc75f3243a
Author: Kees Monshouwer <mind04@monshouwer.org>
Date:   Mon Jul 21 22:56:32 2014 +0200

    sign with the right TSIG key if there are multiple algorithms available

diff --git a/pdns/tcpreceiver.cc b/pdns/tcpreceiver.cc
index ccc8d6584..2fad9907f 100644
--- a/pdns/tcpreceiver.cc
+++ b/pdns/tcpreceiver.cc
@@ -581,7 +581,10 @@ int TCPNameserver::doAXFR(const string &target, shared_ptr<DNSPacket> q, int out
   q->getTSIGDetails(&trc, &tsigkeyname, 0);
 
   if(!tsigkeyname.empty()) {
-    string tsig64, algorithm;
+    string tsig64;
+    string algorithm=toLowerCanonic(trc.d_algoName);
+    if (algorithm == "hmac-md5.sig-alg.reg.int")
+      algorithm = "hmac-md5";
     Lock l(&s_plock);
     s_P->getBackend()->getTSIGKey(tsigkeyname, &algorithm, &tsig64);
     B64Decode(tsig64, tsigsecret);

