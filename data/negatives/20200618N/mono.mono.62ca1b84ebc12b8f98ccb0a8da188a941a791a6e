commit 62ca1b84ebc12b8f98ccb0a8da188a941a791a6e
Author: Paolo Molaro <lupus@oddwiz.org>
Date:   Wed Jul 28 17:31:54 2010 +0200

    Ensure the Monitor.Enter() fastpath doesn't apply to Enter(o,ref taken).

diff --git a/mono/mini/method-to-ir.c b/mono/mini/method-to-ir.c
index 62c17e91726..537480bee53 100644
--- a/mono/mini/method-to-ir.c
+++ b/mono/mini/method-to-ir.c
@@ -4256,7 +4256,7 @@ mini_emit_inst_for_method (MonoCompile *cfg, MonoMethod *cmethod, MonoMethodSign
 		}
 	} else if (cmethod->klass == mono_defaults.monitor_class) {
 #if defined(MONO_ARCH_MONITOR_OBJECT_REG)
-		if (strcmp (cmethod->name, "Enter") == 0) {
+		if (strcmp (cmethod->name, "Enter") == 0 && fsig->param_count == 1) {
 			MonoCallInst *call;
 
 			if (COMPILE_LLVM (cfg)) {
@@ -4296,7 +4296,7 @@ mini_emit_inst_for_method (MonoCompile *cfg, MonoMethod *cmethod, MonoMethodSign
 				 strcmp (cfg->method->name, "FastMonitorExit") == 0))
 			return NULL;
 
-		if (strcmp (cmethod->name, "Enter") == 0 ||
+		if ((strcmp (cmethod->name, "Enter") == 0 && fsig->param_count == 1) ||
 				strcmp (cmethod->name, "Exit") == 0)
 			fast_method = mono_monitor_get_fast_path (cmethod);
 		if (!fast_method)

