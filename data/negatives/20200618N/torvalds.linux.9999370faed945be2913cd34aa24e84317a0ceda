commit 9999370faed945be2913cd34aa24e84317a0ceda
Author: Cyrill Gorcunov <gorcunov@openvz.org>
Date:   Wed Nov 2 15:36:32 2016 +0300

    net: ip, raw_diag -- Use jump for exiting from nested loop
    
    I managed to miss that sk_for_each is called under "for"
    cycle so need to use goto here to return matching socket.
    
    CC: David S. Miller <davem@davemloft.net>
    CC: Eric Dumazet <eric.dumazet@gmail.com>
    CC: David Ahern <dsa@cumulusnetworks.com>
    CC: Andrey Vagin <avagin@openvz.org>
    CC: Stephen Hemminger <stephen@networkplumber.org>
    Signed-off-by: Cyrill Gorcunov <gorcunov@openvz.org>
    Acked-by: David Ahern <dsa@cumulusnetworks.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/ipv4/raw_diag.c b/net/ipv4/raw_diag.c
index bf0b8842bf31..e1a51ca68d23 100644
--- a/net/ipv4/raw_diag.c
+++ b/net/ipv4/raw_diag.c
@@ -79,10 +79,11 @@ static struct sock *raw_sock_get(struct net *net, const struct inet_diag_req_v2
 				 * hashinfo->lock here.
 				 */
 				sock_hold(sk);
-				break;
+				goto out_unlock;
 			}
 		}
 	}
+out_unlock:
 	read_unlock(&hashinfo->lock);
 
 	return sk ? sk : ERR_PTR(-ENOENT);

