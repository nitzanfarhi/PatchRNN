commit 806d053b69f759a97875f9fa0a2203b740c20e18
Author: Luke Dashjr <luke-jr+git@utopios.org>
Date:   Fri Sep 20 01:48:33 2013 +0000

    bitfury: Check that the previous nonce still matches, to detect response corruption

diff --git a/driver-bitfury.c b/driver-bitfury.c
index 606139c8..4af362cd 100644
--- a/driver-bitfury.c
+++ b/driver-bitfury.c
@@ -448,6 +448,14 @@ void bitfury_do_io(struct thr_info *thr)
 	memcpy(&newbuf[0x10 - bitfury->active], &inp[0], 4 * bitfury->active);
 	newjob = inp[0x10];
 	
+	if (newbuf[0xf] != oldbuf[0xf])
+	{
+		inc_hw_errors2(thr, NULL, NULL);
+		applog(LOG_DEBUG, "%"PRIpreprv": Previous nonce mismatch, ignoring response",
+		       proc->proc_repr);
+		goto out;
+	}
+	
 	if (bitfury->oldjob != newjob && thr->next_work)
 	{
 		mt_job_transition(thr);

