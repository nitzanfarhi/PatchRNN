commit d2a65db338e5b53478f02c0743bed61ba9abde71
Author: nicm <nicm@openbsd.org>
Date:   Tue Jun 30 13:40:30 2009 +0000

    When unlocking the server, don't try to clear the prompt on clients without a
    prompt (such as the one issuing the unlock request).
    
    This caused the server to die if the wrong password was entered when unlocking
    from the command line with -U (nasty).

diff --git a/usr.bin/tmux/server-fn.c b/usr.bin/tmux/server-fn.c
index 9449842a544..e6003d98607 100644
--- a/usr.bin/tmux/server-fn.c
+++ b/usr.bin/tmux/server-fn.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: server-fn.c,v 1.2 2009/06/25 06:15:04 nicm Exp $ */
+/* $OpenBSD: server-fn.c,v 1.3 2009/06/30 13:40:30 nicm Exp $ */
 
 /*
  * Copyright (c) 2007 Nicholas Marriott <nicm@users.sourceforge.net>
@@ -214,7 +214,7 @@ server_unlock(const char *s)
 wrong:
 	for (i = 0; i < ARRAY_LENGTH(&clients); i++) {
 		c = ARRAY_ITEM(&clients, i);
-		if (c == NULL)
+                if (c == NULL || c->prompt_buffer == NULL)
 			continue;
 
 		*c->prompt_buffer = '\0';

