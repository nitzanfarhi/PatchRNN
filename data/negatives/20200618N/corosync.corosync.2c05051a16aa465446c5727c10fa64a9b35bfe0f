commit 2c05051a16aa465446c5727c10fa64a9b35bfe0f
Author: Jan Friesse <jfriesse@redhat.com>
Date:   Tue Apr 5 17:59:51 2016 +0200

    qdevice: Add public prealloc function to dynar
    
    Signed-off-by: Jan Friesse <jfriesse@redhat.com>

diff --git a/qdevices/dynar.c b/qdevices/dynar.c
index b299a4e9..8b0967cf 100644
--- a/qdevices/dynar.c
+++ b/qdevices/dynar.c
@@ -112,7 +112,7 @@ dynar_realloc(struct dynar *array, size_t new_array_size)
 }
 
 int
-dynar_cat(struct dynar *array, const void *src, size_t size)
+dynar_prealloc(struct dynar *array, size_t size)
 {
 	size_t new_size;
 
@@ -131,6 +131,17 @@ dynar_cat(struct dynar *array, const void *src, size_t size)
 		}
 	}
 
+	return (0);
+}
+
+int
+dynar_cat(struct dynar *array, const void *src, size_t size)
+{
+
+	if (dynar_prealloc(array, size) != 0) {
+		return (-1);
+	}
+
 	memmove(array->data + array->size, src, size);
 	array->size += size;
 
diff --git a/qdevices/dynar.h b/qdevices/dynar.h
index 766343aa..d0b770e3 100644
--- a/qdevices/dynar.h
+++ b/qdevices/dynar.h
@@ -68,6 +68,7 @@ extern char	*dynar_data(const struct dynar *array);
 
 extern int	 dynar_cat(struct dynar *array, const void *src, size_t size);
 
+extern int	 dynar_prealloc(struct dynar *array, size_t size);
 
 #ifdef __cplusplus
 }

