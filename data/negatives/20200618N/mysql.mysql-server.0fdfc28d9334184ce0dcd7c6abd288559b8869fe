commit 0fdfc28d9334184ce0dcd7c6abd288559b8869fe
Author: marko <>
Date:   Tue Feb 9 09:02:37 2010 +0000

    branches/zip: ha_innobase::add_index(): Check for !innodb_table.

diff --git a/handler/handler0alter.cc b/handler/handler0alter.cc
index 47999ae37f8..fbbcfd6149b 100644
--- a/handler/handler0alter.cc
+++ b/handler/handler0alter.cc
@@ -656,6 +656,11 @@ ha_innobase::add_index(
 	innodb_table = indexed_table
 		= dict_table_get(prebuilt->table->name, FALSE);
 
+	if (UNIV_UNLIKELY(!innodb_table)) {
+		error = HA_ERR_NO_SUCH_TABLE;
+		goto err_exit;
+	}
+
 	/* Check if the index name is reserved. */
 	if (innobase_index_name_is_reserved(trx, key_info, num_of_keys)) {
 		error = -1;

