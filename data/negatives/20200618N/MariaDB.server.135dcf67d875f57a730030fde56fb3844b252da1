commit 135dcf67d875f57a730030fde56fb3844b252da1
Author: Rik Prohaska <prohaska7@gmail.com>
Date:   Thu Feb 26 13:22:50 2015 -0500

    DB-805 DB-806 the tokudb loader requires a transaction

diff --git a/storage/tokudb/ha_tokudb.cc b/storage/tokudb/ha_tokudb.cc
index b348b3bd599..7c24cc1da2f 100644
--- a/storage/tokudb/ha_tokudb.cc
+++ b/storage/tokudb/ha_tokudb.cc
@@ -3236,7 +3236,7 @@ void ha_tokudb::start_bulk_insert(ha_rows rows) {
     lock_count = 0;
     
     if ((rows == 0 || rows > 1) && share->try_table_lock) {
-        if (get_prelock_empty(thd) && may_table_be_empty(transaction)) {
+        if (get_prelock_empty(thd) && may_table_be_empty(transaction) && transaction != NULL) {
             if (using_ignore || is_insert_ignore(thd) || thd->lex->duplicates != DUP_ERROR) {
                 acquire_table_lock(transaction, lock_write);
             }

