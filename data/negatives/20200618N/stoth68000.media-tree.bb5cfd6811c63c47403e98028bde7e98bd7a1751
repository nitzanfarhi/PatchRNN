commit bb5cfd6811c63c47403e98028bde7e98bd7a1751
Author: Felipe Balbi <balbi@ti.com>
Date:   Wed Jan 18 20:18:45 2012 +0200

    usb: dwc3: ep0: move to CONFIGURED also on delayed status
    
    Mass Storage gadget will take some time to handle
    the SetConfiguration request, but even on those
    cases we should move to CONFIGURED state.
    
    Signed-off-by: Felipe Balbi <balbi@ti.com>

diff --git a/drivers/usb/dwc3/ep0.c b/drivers/usb/dwc3/ep0.c
index 5eb7095e4005..e90ebb9dd3e8 100644
--- a/drivers/usb/dwc3/ep0.c
+++ b/drivers/usb/dwc3/ep0.c
@@ -457,7 +457,7 @@ static int dwc3_ep0_set_config(struct dwc3 *dwc, struct usb_ctrlrequest *ctrl)
 	case DWC3_ADDRESS_STATE:
 		ret = dwc3_ep0_delegate_req(dwc, ctrl);
 		/* if the cfg matches and the cfg is non zero */
-		if (!ret && cfg)
+		if (cfg && (!ret || (ret == USB_GADGET_DELAYED_STATUS)))
 			dwc->dev_state = DWC3_CONFIGURED_STATE;
 		break;
 

