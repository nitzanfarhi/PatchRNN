commit 688f5212ceac9105848cc8b62a6912da924f4d2e
Author: Ken Murchison <murch@andrew.cmu.edu>
Date:   Fri May 22 10:51:36 2015 -0400

    http_dav.c: be more paranoid about finding 'filename' param on Content-Disposition header

diff --git a/imap/http_dav.c b/imap/http_dav.c
index 09e0074e4..f2c0f841f 100644
--- a/imap/http_dav.c
+++ b/imap/http_dav.c
@@ -5381,8 +5381,9 @@ int report_sync_col(struct transaction_t *txn,
 	    continue;
 
 	/* Get resource filename from Content-Disposition header */
-	if ((p = index_getheader(&istate, msgno, "Content-Disposition"))) {
-	    resource = strstr(p, "filename=") + 9;
+	if ((p = index_getheader(&istate, msgno, "Content-Disposition")) &&
+	    (p = strstr(p, "filename="))) {
+	    resource = p + 9;
 	}
 	if (!resource) continue;  /* No filename */
 

