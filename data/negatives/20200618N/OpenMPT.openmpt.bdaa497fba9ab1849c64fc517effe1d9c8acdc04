commit bdaa497fba9ab1849c64fc517effe1d9c8acdc04
Author: JÃ¶rn Heusipp <manxorist@users.sourceforge.net>
Date:   Sat Apr 11 14:22:54 2015 +0000

    [Ref] Assert that charset availability has been tested when converting strings.
    
    git-svn-id: https://source.openmpt.org/svn/openmpt/trunk/OpenMPT@4925 56274372-70c3-4bfc-bfc3-4c3a0b034d27

diff --git a/common/mptString.cpp b/common/mptString.cpp
index 6d0e4db26..98ffe3624 100644
--- a/common/mptString.cpp
+++ b/common/mptString.cpp
@@ -672,6 +672,7 @@ static bool TestCodePage(UINT cp)
 
 #ifdef MODPLUG_TRACKER
 
+static bool CharsetsInitialized = false;
 static bool HasCharsetUTF8 = true;
 static bool HasCharsetASCII = true;
 static bool HasCharsetISO8859_1 = true;
@@ -687,10 +688,12 @@ void InitCharsets()
 	HasCharsetISO8859_15 = TestCodePage(28605);
 	HasCharsetCP437 = TestCodePage(437);
 	HasCharsetWindows1252 = TestCodePage(1252);
+	CharsetsInitialized = true;
 }
 
 static bool HasCharset(Charset charset)
 {
+	MPT_ASSERT(CharsetsInitialized);
 	switch(charset)
 	{
 		case CharsetUTF8:        return HasCharsetUTF8;        break;

