commit 3d638b4de6f9eed8f20fed2693fc6d33b7697d83
Author: Assar Westerlund <assar@sics.se>
Date:   Sun May 25 13:49:00 1997 +0000

    (retrieve): file must exist to apply a command to it.
    
    
    git-svn-id: svn://svn.h5l.se/heimdal/trunk/heimdal@1771 ec53bebd-3082-4978-b11e-865c3cabbd6b

diff --git a/appl/ftp/ftpd/ftpd.c b/appl/ftp/ftpd/ftpd.c
index 24fe7a5d7..ae532107c 100644
--- a/appl/ftp/ftpd/ftpd.c
+++ b/appl/ftp/ftpd/ftpd.c
@@ -946,14 +946,16 @@ retrieve(char *cmd, char *name)
 		    struct cmds *p;
 		    for(p = cmds; p->ext; p++){
 			char *tail = name + strlen(name) - strlen(p->ext);
+			char c = *tail;
 			
-			if(strcmp(tail, p->ext) == 0){
-			    char c = *tail;
-			    *tail  = 0;
+			if(strcmp(tail, p->ext) == 0 &&
+			   (*tail  = 0) == 0 &&
+			   access(name, R_OK) == 0){
 			    snprintf (line, sizeof(line), p->cmd, name);
 			    *tail  = c;
 			    break;
 			}
+			*tail = c;
 		    }
 		    if(p->ext){
 			fin = ftpd_popen(line, "r", 0, 0);

