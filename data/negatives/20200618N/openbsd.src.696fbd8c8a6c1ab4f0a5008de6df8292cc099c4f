commit 696fbd8c8a6c1ab4f0a5008de6df8292cc099c4f
Author: guenther <guenther@openbsd.org>
Date:   Sat Sep 12 15:18:40 2015 +0000

    Wrap <assert.h> so that __assert2() goes direct

diff --git a/lib/libc/gen/assert.c b/lib/libc/gen/assert.c
index 816b050cfaf..a1dbb2b26d7 100644
--- a/lib/libc/gen/assert.c
+++ b/lib/libc/gen/assert.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: assert.c,v 1.8 2005/08/08 08:05:33 espie Exp $ */
+/*	$OpenBSD: assert.c,v 1.9 2015/09/12 15:18:40 guenther Exp $ */
 /*-
  * Copyright (c) 1992, 1993
  *	The Regents of the University of California.  All rights reserved.
@@ -52,3 +52,4 @@ __assert2(const char *file, int line, const char *func, const char *failedexpr)
 	abort();
 	/* NOTREACHED */
 }
+DEF_STRONG(__assert2);
diff --git a/lib/libc/hidden/assert.h b/lib/libc/hidden/assert.h
new file mode 100644
index 00000000000..c1d5fec49d3
--- /dev/null
+++ b/lib/libc/hidden/assert.h
@@ -0,0 +1,27 @@
+/*	$OpenBSD: assert.h,v 1.1 2015/09/12 15:18:40 guenther Exp $	*/
+/*
+ * Copyright (c) 2015 Philip Guenther <guenther@openbsd.org>
+ *
+ * Permission to use, copy, modify, and distribute this software for any
+ * purpose with or without fee is hereby granted, provided that the above
+ * copyright notice and this permission notice appear in all copies.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
+ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
+ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
+ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
+ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
+ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
+ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
+ */
+
+/* outside the conditional for changes in NDEBUG */
+#include_next <assert.h>
+
+#ifndef _LIBC_ASSERT_H_
+#define _LIBC_ASSERT_H_
+
+PROTO_STD_DEPRECATED(__assert);
+PROTO_NORMAL(__assert2);
+
+#endif /* _LIBC_ASSERT_H_ */

