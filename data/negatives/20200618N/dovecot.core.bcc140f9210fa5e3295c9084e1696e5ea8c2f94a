commit bcc140f9210fa5e3295c9084e1696e5ea8c2f94a
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Jan 29 18:06:13 2010 +0200

    dsync: Small optimization.
    
    --HG--
    branch : HEAD

diff --git a/src/dsync/dsync-brain-msgs-new.c b/src/dsync/dsync-brain-msgs-new.c
index e40f35649..318220439 100644
--- a/src/dsync/dsync-brain-msgs-new.c
+++ b/src/dsync/dsync-brain-msgs-new.c
@@ -228,6 +228,14 @@ dsync_brain_msg_sync_add_new_msgs(struct dsync_brain_msg_iter *iter)
 	while (iter->mailbox_idx < array_count(&iter->sync->mailboxes)) {
 		mailbox = array_idx(&iter->sync->mailboxes, iter->mailbox_idx);
 		mailbox_guid = &mailbox->box.mailbox_guid;
+
+		if (array_count(&iter->new_msgs) == 0) {
+			/* optimization: don't even bother selecting the
+			   mailbox */
+			iter->mailbox_idx++;
+			continue;
+		}
+
 		dsync_worker_select_mailbox(iter->worker, &mailbox->box);
 
 		if (dsync_brain_mailbox_add_new_msgs(iter, mailbox_guid)) {

