commit c5bab5e94d148aee2c852450374143c89aa56511
Author: Wolfgang Grandegger <wg@denx.de>
Date:   Thu Jan 14 01:05:48 2010 +0000

    can: mscan-mpc5xxx: fix broken support for the MPC5200
    
    Due to an invalid "#ifdef CONFIG_PPC_MPC5200", the real clock setup
    function was not called for the MPC5200.
    
    Signed-off-by: Wolfgang Grandegger <wg@denx.de>
    Acked-by: Wolfram Sang <w.sang@pengutronix.de>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/can/mscan/mpc5xxx_can.c b/drivers/net/can/mscan/mpc5xxx_can.c
index f73487f723b8..03e7c48465a2 100644
--- a/drivers/net/can/mscan/mpc5xxx_can.c
+++ b/drivers/net/can/mscan/mpc5xxx_can.c
@@ -43,7 +43,7 @@ struct mpc5xxx_can_data {
 			 int *mscan_clksrc);
 };
 
-#ifdef CONFIG_PPC_MPC5200
+#ifdef CONFIG_PPC_MPC52xx
 static struct of_device_id __devinitdata mpc52xx_cdm_ids[] = {
 	{ .compatible = "fsl,mpc5200-cdm", },
 	{}
@@ -84,7 +84,7 @@ static u32 __devinit mpc52xx_can_get_clock(struct of_device *ofdev,
 	/* Determine SYS_XTAL_IN frequency from the clock domain settings */
 	np_cdm = of_find_matching_node(NULL, mpc52xx_cdm_ids);
 	if (!np_cdm) {
-		dev_err(&of->dev, "can't get clock node!\n");
+		dev_err(&ofdev->dev, "can't get clock node!\n");
 		return 0;
 	}
 	cdm = of_iomap(np_cdm, 0);
@@ -101,14 +101,14 @@ static u32 __devinit mpc52xx_can_get_clock(struct of_device *ofdev,
 
 	return freq;
 }
-#else /* !CONFIG_PPC_MPC5200 */
+#else /* !CONFIG_PPC_MPC52xx */
 static u32 __devinit mpc52xx_can_get_clock(struct of_device *ofdev,
 					   const char *clock_name,
 					   int *mscan_clksrc)
 {
 	return 0;
 }
-#endif /* CONFIG_PPC_MPC5200 */
+#endif /* CONFIG_PPC_MPC52xx */
 
 #ifdef CONFIG_PPC_MPC512x
 struct mpc512x_clockctl {

