commit 263812e496623810f7c57d9a0755ad50307979a9
Author: marko <>
Date:   Tue Oct 24 11:54:01 2006 +0000

    branches/zip: lock_update_discard(): Fix a bug introduced in r949:
    Compare heap_no against PAGE_HEAP_NO_SUPREMUM instead of
    PAGE_NEW_SUPREMUM or PAGE_OLD_SUPREMUM.

diff --git a/lock/lock0lock.c b/lock/lock0lock.c
index ebf0ec0d393..fd65f70a540 100644
--- a/lock/lock0lock.c
+++ b/lock/lock0lock.c
@@ -3217,7 +3217,7 @@ lock_update_discard(
 			lock_rec_reset_and_release_wait(block, heap_no);
 
 			rec = page + rec_get_next_offs(rec, TRUE);
-		} while (heap_no != PAGE_NEW_SUPREMUM);
+		} while (heap_no != PAGE_HEAP_NO_SUPREMUM);
 	} else {
 		rec = page + PAGE_OLD_INFIMUM;
 
@@ -3230,7 +3230,7 @@ lock_update_discard(
 			lock_rec_reset_and_release_wait(block, heap_no);
 
 			rec = page + rec_get_next_offs(rec, FALSE);
-		} while (heap_no != PAGE_OLD_SUPREMUM);
+		} while (heap_no != PAGE_HEAP_NO_SUPREMUM);
 	}
 
 	lock_rec_free_all_from_discard_page(block);

