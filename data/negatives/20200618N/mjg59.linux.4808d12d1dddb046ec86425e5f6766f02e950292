commit 4808d12d1dddb046ec86425e5f6766f02e950292
Author: Takashi Iwai <tiwai@suse.de>
Date:   Tue Jan 10 15:16:02 2012 +0100

    ALSA: hda - Fix the detection of "Loopback Mixing" control for VIA codecs
    
    Currently the driver checks only the out_mix_path[] for the primary
    output route for judging whether to create the loopback-mixing control
    or not.  But, there are cases where aamix-routing is available only on
    headphone or speaker paths but not on the primary output path.  So, the
    driver ignores such cases inappropriately.
    
    This patch fixes the check of the loopback-mixing control by testing
    all mix-routing paths.
    
    Cc: <stable@kernel.org>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>

diff --git a/sound/pci/hda/patch_via.c b/sound/pci/hda/patch_via.c
index ab56866cc94e..03e63fed9caf 100644
--- a/sound/pci/hda/patch_via.c
+++ b/sound/pci/hda/patch_via.c
@@ -2208,7 +2208,10 @@ static int via_auto_create_loopback_switch(struct hda_codec *codec)
 {
 	struct via_spec *spec = codec->spec;
 
-	if (!spec->aa_mix_nid || !spec->out_mix_path.depth)
+	if (!spec->aa_mix_nid)
+		return 0; /* no loopback switching available */
+	if (!(spec->out_mix_path.depth || spec->hp_mix_path.depth ||
+	      spec->speaker_path.depth))
 		return 0; /* no loopback switching available */
 	if (!via_clone_control(spec, &via_aamix_ctl_enum))
 		return -ENOMEM;

