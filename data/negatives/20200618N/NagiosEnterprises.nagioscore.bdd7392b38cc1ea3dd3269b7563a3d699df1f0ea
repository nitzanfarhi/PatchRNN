commit bdd7392b38cc1ea3dd3269b7563a3d699df1f0ea
Author: Ethan Galstad <egalstad@nagios.org>
Date:   Fri Feb 24 01:34:45 2006 +0000

    IPC bug fixes
    
    
    git-svn-id: https://nagios.svn.sourceforge.net/svnroot/nagios/nagioscore/trunk@642 5f96b256-904b-4d8d-8c98-d829582c6739

diff --git a/base/utils.c b/base/utils.c
index 3ae99ce6..3a24534d 100644
--- a/base/utils.c
+++ b/base/utils.c
@@ -3986,8 +3986,13 @@ int read_check_output_from_file(char *fname, char **short_output, char **long_ou
 
 	/* open the file for reading */
 	if((thefile=mmap_fopen(fname))==NULL){
+
 		if(short_output)
 			*short_output=strdup("(Cannot read check result file (file may be empty) - no plugin output!)");
+
+		/* try removing the file - zero length files can't be mmap()'ed, so it might exist */
+		unlink(fname);
+
 		return ERROR;
 	        }
 
@@ -4023,7 +4028,7 @@ int read_check_output_from_file(char *fname, char **short_output, char **long_ou
 	mmap_fclose(thefile);
 
 	/* remove the file */
-	/*unlink(fname);*/
+	unlink(fname);
 
 	return OK;
         }

