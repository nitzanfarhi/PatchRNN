commit 0fbcc7b95f877f2db93530d7d5f0fd62e6377c08
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri May 15 13:06:15 2009 -0400

    APPEND: Don't assert-crash if message size parameter isn't given.
    
    --HG--
    branch : HEAD

diff --git a/src/imap/cmd-append.c b/src/imap/cmd-append.c
index 51b928009..b37252e6f 100644
--- a/src/imap/cmd-append.c
+++ b/src/imap/cmd-append.c
@@ -254,6 +254,11 @@ static bool cmd_append_continue_parsing(struct client_command_context *cmd)
 			cmd_append_finish(ctx);
 			return TRUE;
 		}
+		if (ctx->count == 0) {
+			client_send_tagline(cmd, "BAD Missing message size.");
+			cmd_append_finish(ctx);
+			return TRUE;
+		}
 
 		ret = mailbox_transaction_commit_get_uids(&ctx->t,
 							  &uid_validity,

