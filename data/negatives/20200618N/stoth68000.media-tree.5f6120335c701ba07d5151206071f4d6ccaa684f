commit 5f6120335c701ba07d5151206071f4d6ccaa684f
Author: Abhijeet Kolekar <abhijeet.kolekar@intel.com>
Date:   Wed Jan 13 13:23:14 2010 -0800

    cfg80211: fix channel setting for wext
    
    Patch fixes the bug at
    http://bugzilla.intellinuxwireless.org/show_bug.cgi?id=2139
    
    Currently we cannot set the channel using wext extension
    if we have already associated and disconnected. As
    cfg80211_mgd_wext_siwfreq will not switch the channel if ssid is set.
    This fixes it by clearing the ssid.
    Following is the sequence which it tries to fix.
    modprobe iwlagn
    iwconfig wlan0 essid ""
    ifconfig wlan0 down
    iwconfig wlan0 chan X
    
    wext is marked as deprecate.If we use nl80211 we can easily play with
    setting the channel.
    
    Signed-off-by: Abhijeet Kolekar <abhijeet.kolekar@intel.com>
    Acked-by: Samuel Ortiz <sameo@linux.intel.com>
    cc: stable@kernel.org
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/wireless/sme.c b/net/wireless/sme.c
index 2333d78187e4..dc0fc4989d54 100644
--- a/net/wireless/sme.c
+++ b/net/wireless/sme.c
@@ -655,6 +655,7 @@ void __cfg80211_disconnected(struct net_device *dev, const u8 *ie,
 	memset(&wrqu, 0, sizeof(wrqu));
 	wrqu.ap_addr.sa_family = ARPHRD_ETHER;
 	wireless_send_event(dev, SIOCGIWAP, &wrqu, NULL);
+	wdev->wext.connect.ssid_len = 0;
 #endif
 }
 

