commit 9d254c7c7b715d7fe1206e9b228e9c5b23b99f28
Author: Timo Sirainen <tss@iki.fi>
Date:   Sun Oct 21 03:09:33 2007 +0300

    Log a nice warning if using maildir++ quota without maildir storages.
    
    --HG--
    branch : HEAD

diff --git a/src/plugins/quota/quota-maildir.c b/src/plugins/quota/quota-maildir.c
index b8b770400..aa1338c3d 100644
--- a/src/plugins/quota/quota-maildir.c
+++ b/src/plugins/quota/quota-maildir.c
@@ -537,8 +537,17 @@ static int maildirquota_refresh(struct maildir_quota_root *root)
 {
 	int ret;
 
-	if (!root->limits_initialized)
+	if (!root->limits_initialized) {
 		maildirquota_init_limits(root);
+		if (root->maildirsize_path == NULL) {
+			i_warning("quota maildir: No maildir storages, "
+				  "ignoring quota.");
+			return 0;
+		}
+	} else {
+		if (root->maildirsize_path == NULL)
+			return 0;
+	}
 
 	ret = maildirsize_read(root);
 	if (ret == 0) {

