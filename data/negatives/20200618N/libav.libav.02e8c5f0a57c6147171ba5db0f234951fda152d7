commit 02e8c5f0a57c6147171ba5db0f234951fda152d7
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Fri Feb 12 23:28:33 2010 +0000

    Dont drop B frames without last_picture.
    Fixes issue1722
    
    Originally committed as revision 21783 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavcodec/h264.c b/libavcodec/h264.c
index dfe618b44..60cf39546 100644
--- a/libavcodec/h264.c
+++ b/libavcodec/h264.c
@@ -1715,11 +1715,6 @@ static int decode_slice_header(H264Context *h, H264Context *h0){
     h->slice_type_nos= slice_type & 3;
 
     s->pict_type= h->slice_type; // to make a few old functions happy, it's wrong though
-    if (s->pict_type == FF_B_TYPE && s0->last_picture_ptr == NULL) {
-        av_log(h->s.avctx, AV_LOG_ERROR,
-               "B picture before any references, skipping\n");
-        return -1;
-    }
 
     pps_id= get_ue_golomb(&s->gb);
     if(pps_id>=MAX_PPS_COUNT){

