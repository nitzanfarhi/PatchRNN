commit 0aba1c7376ad325202f328211ab6dfcae94c7f2a
Author: Aurelien Jarno <aurelien@aurel32.net>
Date:   Tue Sep 18 19:11:32 2012 +0200

    tcg/optimize: optimize "op r, a, a => mov r, a"
    
    Now that we can easily detect all copies, we can optimize the
    "op r, a, a => mov r, a" case a bit more.
    
    Reviewed-by: Richard Henderson <rth@twiddle.net>
    Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>

diff --git a/tcg/optimize.c b/tcg/optimize.c
index aeb2225f2a..b9a7da920f 100644
--- a/tcg/optimize.c
+++ b/tcg/optimize.c
@@ -524,7 +524,7 @@ static TCGArg *tcg_constant_folding(TCGContext *s, uint16_t *tcg_opc_ptr,
         switch (op) {
         CASE_OP_32_64(or):
         CASE_OP_32_64(and):
-            if (args[1] == args[2]) {
+            if (temps_are_copies(args[1], args[2])) {
                 if (temps_are_copies(args[0], args[1])) {
                     gen_opc_buf[op_index] = INDEX_op_nop;
                 } else {

