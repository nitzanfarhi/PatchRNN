commit 53370b78ecfe3fdff89a8dd7db73a0a95aefc14f
Author: Gerd Hoffmann <kraxel@redhat.com>
Date:   Thu Feb 23 13:45:26 2012 +0100

    suspend: add qmp events
    
    Send qmp events on suspend and wakeup so libvirt
    has a chance to track the vm state.
    
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
    Signed-off-by: Anthony Liguori <aliguori@us.ibm.com>

diff --git a/monitor.c b/monitor.c
index 03beab3cdd..953e7482b7 100644
--- a/monitor.c
+++ b/monitor.c
@@ -488,6 +488,12 @@ void monitor_protocol_event(MonitorEvent event, QObject *data)
         case QEVENT_DEVICE_TRAY_MOVED:
              event_name = "DEVICE_TRAY_MOVED";
             break;
+        case QEVENT_SUSPEND:
+            event_name = "SUSPEND";
+            break;
+        case QEVENT_WAKEUP:
+            event_name = "WAKEUP";
+            break;
         default:
             abort();
             break;
diff --git a/monitor.h b/monitor.h
index b6f700fde9..0d498006f8 100644
--- a/monitor.h
+++ b/monitor.h
@@ -39,6 +39,8 @@ typedef enum MonitorEvent {
     QEVENT_BLOCK_JOB_COMPLETED,
     QEVENT_BLOCK_JOB_CANCELLED,
     QEVENT_DEVICE_TRAY_MOVED,
+    QEVENT_SUSPEND,
+    QEVENT_WAKEUP,
     QEVENT_MAX,
 } MonitorEvent;
 
diff --git a/vl.c b/vl.c
index 90baa2a62b..e1a1e89fa6 100644
--- a/vl.c
+++ b/vl.c
@@ -1416,6 +1416,7 @@ static void qemu_system_suspend(void)
 {
     pause_all_vcpus();
     notifier_list_notify(&suspend_notifiers, NULL);
+    monitor_protocol_event(QEVENT_SUSPEND, NULL);
     is_suspended = true;
 }
 
@@ -1442,6 +1443,7 @@ void qemu_system_wakeup_request(WakeupReason reason)
     if (!(wakeup_reason_mask & (1 << reason))) {
         return;
     }
+    monitor_protocol_event(QEVENT_WAKEUP, NULL);
     notifier_list_notify(&wakeup_notifiers, &reason);
     reset_requested = 1;
     qemu_notify_event();

