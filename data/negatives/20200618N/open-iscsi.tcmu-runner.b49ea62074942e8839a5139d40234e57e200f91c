commit b49ea62074942e8839a5139d40234e57e200f91c
Author: Prasanna Kumar Kalever <prasanna.kalever@redhat.com>
Date:   Wed Aug 30 17:26:53 2017 +0530

    logger: logdir path setting via Env variable 'TCMU_LOGDIR'
    
    $ export TCMU_LOGDIR="/var/log/mylogdir/"
    $ ./tcmu-runner
    
    or
    
    one can pass 'TCMU_LOGDIR' to list of systemd Env variables and
    be able to run via systemd unit
    
    Signed-off-by: Prasanna Kumar Kalever <prasanna.kalever@redhat.com>

diff --git a/libtcmu_config.c b/libtcmu_config.c
index 4660243..df466b5 100644
--- a/libtcmu_config.c
+++ b/libtcmu_config.c
@@ -156,8 +156,9 @@ static void tcmu_conf_set_options(struct tcmu_config *cfg, bool reloading)
 		/*
 		 * The priority of the logdir setting is:
 		 * 1, --tcmu_log_dir/-l LOG_DIR_PATH
-		 * 2, tcmu.conf
-		 * 3, default /var/log/
+		 * 2, export TCMU_LOGDIR="/var/log/mychoice/"
+		 * 3, tcmu.conf
+		 * 4, default /var/log/
 		 */
 		if (!tcmu_get_logdir())
 			tcmu_logdir_create(cfg->log_dir_path);
diff --git a/libtcmu_log.c b/libtcmu_log.c
index d33c13b..903aee6 100644
--- a/libtcmu_log.c
+++ b/libtcmu_log.c
@@ -88,6 +88,23 @@ unsigned int tcmu_get_log_level(void)
 	return tcmu_log_level;
 }
 
+bool tcmu_logdir_getenv(void)
+{
+	char *log_path;
+
+	if (tcmu_get_logdir())
+		return true;
+
+	log_path = getenv("TCMU_LOGDIR");
+	if (!log_path)
+		return true;
+
+	if (!tcmu_logdir_create(log_path))
+		return false;
+
+	return true;
+}
+
 void tcmu_set_log_level(int level)
 {
 	/* set the default log level to info */
diff --git a/libtcmu_log.h b/libtcmu_log.h
index 3773cfd..681a3f0 100644
--- a/libtcmu_log.h
+++ b/libtcmu_log.h
@@ -63,6 +63,7 @@ void tcmu_dbg_scsi_cmd_message(struct tcmu_device *dev, const char *funcname, in
 
 char *tcmu_get_logdir(void);
 void tcmu_logdir_destroy(void);
+bool tcmu_logdir_getenv(void);
 bool tcmu_logdir_create(const char *path);
 int tcmu_make_absolute_logfile(char *path, const char *filename);
 
diff --git a/main.c b/main.c
index 6714c75..a14897b 100644
--- a/main.c
+++ b/main.c
@@ -955,6 +955,9 @@ int main(int argc, char **argv)
 		}
 	}
 
+	if (!tcmu_logdir_getenv())
+		goto free_opt;
+
 	/*
 	 * The order of setting up config and logger is important, because
 	 * the log directory may be configured via the system config file

