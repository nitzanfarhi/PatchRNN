commit 4a0c718418cdca70dd65b4a538d102f7d72bb78c
Author: Tim Kientzle <kientzle@gmail.com>
Date:   Mon Apr 13 21:29:55 2009 -0400

    ARCHIVE_EOF is positive.  I'm going to change this in libarchive 3.0.
    Until then, use an explicit -1 here to flag EOF, to distinguish it
    from a valid code return.
    
    SVN-Revision: 989

diff --git a/libarchive/archive_read_support_compression_compress.c b/libarchive/archive_read_support_compression_compress.c
index f6c15795..752ddda3 100644
--- a/libarchive/archive_read_support_compression_compress.c
+++ b/libarchive/archive_read_support_compression_compress.c
@@ -278,7 +278,7 @@ compress_filter_read(struct archive_read_filter *self, const void **pblock)
 			*p++ = *--state->stackp;
 		} else {
 			ret = next_code(self);
-			if (ret == ARCHIVE_EOF)
+			if (ret == -1)
 				state->end_of_stream = ret;
 			else if (ret != ARCHIVE_OK)
 				return (ret);
@@ -424,7 +424,7 @@ getbits(struct archive_read_filter *self, int n)
 			    = __archive_read_filter_ahead(self->upstream,
 				1, &ret);
 			if (ret == 0)
-				return (ARCHIVE_EOF);
+				return (-1);
 			if (ret < 0 || state->next_in == NULL)
 				return (ARCHIVE_FATAL);
 			state->avail_in = ret;

