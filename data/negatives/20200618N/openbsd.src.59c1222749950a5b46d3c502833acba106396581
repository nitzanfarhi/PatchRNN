commit 59c1222749950a5b46d3c502833acba106396581
Author: deraadt <deraadt@openbsd.org>
Date:   Thu May 30 16:19:25 2013 +0000

    If ACPI is not compiled in, pci_min_powerstate() has no facts to support
    is should return D3.  It should return the current power state.
    ok kettenis mlarkin

diff --git a/sys/arch/amd64/pci/pci_machdep.c b/sys/arch/amd64/pci/pci_machdep.c
index 7c22fb665e0..b6afa739d27 100644
--- a/sys/arch/amd64/pci/pci_machdep.c
+++ b/sys/arch/amd64/pci/pci_machdep.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: pci_machdep.c,v 1.56 2012/10/16 13:57:46 mikeb Exp $	*/
+/*	$OpenBSD: pci_machdep.c,v 1.57 2013/05/30 16:19:25 deraadt Exp $	*/
 /*	$NetBSD: pci_machdep.c,v 1.3 2003/05/07 21:33:58 fvdl Exp $	*/
 
 /*-
@@ -685,6 +685,6 @@ pci_min_powerstate(pci_chipset_tag_t pc, pcitag_t tag)
 #if NACPI > 0
 	return acpi_pci_min_powerstate(pc, tag);
 #else
-	return PCI_PMCSR_STATE_D3;
+	return pci_get_powerstate(pc, tag);
 #endif
 }
diff --git a/sys/arch/i386/pci/pci_machdep.c b/sys/arch/i386/pci/pci_machdep.c
index c2331b1f39e..4eeeb6b88fb 100644
--- a/sys/arch/i386/pci/pci_machdep.c
+++ b/sys/arch/i386/pci/pci_machdep.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: pci_machdep.c,v 1.74 2013/05/16 19:26:04 kettenis Exp $	*/
+/*	$OpenBSD: pci_machdep.c,v 1.75 2013/05/30 16:19:25 deraadt Exp $	*/
 /*	$NetBSD: pci_machdep.c,v 1.28 1997/06/06 23:29:17 thorpej Exp $	*/
 
 /*-
@@ -959,6 +959,6 @@ pci_min_powerstate(pci_chipset_tag_t pc, pcitag_t tag)
 #if NACPI > 0
 	return acpi_pci_min_powerstate(pc, tag);
 #else
-	return PCI_PMCSR_STATE_D3;
+	return pci_get_powerstate(pc, tag);
 #endif
 }

