commit c09bf905df7891e3f91e2c16704b1df80eb2c1e0
Author: Timo Sirainen <tss@iki.fi>
Date:   Sun May 8 12:38:36 2005 +0300

    If we couldn't fetch header MD5/filename for UIDL, abort instead of giving
    invalid UIDL.
    
    --HG--
    branch : HEAD

diff --git a/src/pop3/commands.c b/src/pop3/commands.c
index 6d61a60b8..9259edb69 100644
--- a/src/pop3/commands.c
+++ b/src/pop3/commands.c
@@ -514,11 +514,21 @@ static int list_uids_iter(struct client *client, struct cmd_uidl_context *ctx)
 		if ((uidl_keymask & UIDL_MD5) != 0) {
 			tab[2].value = mail_get_special(ctx->mail,
 							MAIL_FETCH_HEADER_MD5);
+			if (tab[2].value == NULL) {
+				/* broken */
+				t_pop();
+				break;
+			}
 		}
 		if ((uidl_keymask & UIDL_FILE_NAME) != 0) {
 			tab[3].value =
 				mail_get_special(ctx->mail,
 						 MAIL_FETCH_UIDL_FILE_NAME);
+			if (tab[3].value == NULL) {
+				/* broken */
+				t_pop();
+				break;
+			}
 		}
 
 		str_truncate(str, 0);

