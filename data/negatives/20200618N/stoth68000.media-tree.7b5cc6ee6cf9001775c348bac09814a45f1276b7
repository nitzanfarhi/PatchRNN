commit 7b5cc6ee6cf9001775c348bac09814a45f1276b7
Author: Karol Swietlicki <magotari@gmail.com>
Date:   Mon Feb 4 22:31:04 2008 -0800

    uml: fix mconsole stop
    
    Bring back the functionality of stopping user mode linux with the help of
    mconsole.
    
    [jdike - the bug being fixed is that the mconsole file descriptor is already
    set O_NONBLOCK or not, depending on whether we want no blocking (the normal
    case) or we want blocking (when an mconsole stop is in effect), so the
    MSG_DONTWAIT is redundant in the normal case, and wrong when we want to
    block.]
    
    Signed-off-by: Karol Swietlicki <magotari@gmail.com>
    Signed-off-by: Jeff Dike <jdike@linux.intel.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/arch/um/drivers/mconsole_user.c b/arch/um/drivers/mconsole_user.c
index 430c024a19b0..13af2f03ed84 100644
--- a/arch/um/drivers/mconsole_user.c
+++ b/arch/um/drivers/mconsole_user.c
@@ -83,9 +83,8 @@ int mconsole_get_request(int fd, struct mc_request *req)
 	int len;
 
 	req->originlen = sizeof(req->origin);
-	req->len = recvfrom(fd, &req->request, sizeof(req->request),
-			    MSG_DONTWAIT, (struct sockaddr *) req->origin,
-			    &req->originlen);
+	req->len = recvfrom(fd, &req->request, sizeof(req->request), 0,
+			    (struct sockaddr *) req->origin, &req->originlen);
 	if (req->len < 0)
 		return 0;
 

