commit d9bdf62f7089dee095b762e0ab5ab6e96e36ce6e
Author: Gordon Williams <gw@pur3.co.uk>
Date:   Fri Jun 13 17:38:23 2014 +0100

    Add Error.toString - not working yet because of issue with overloading of builtin functions

diff --git a/src/jsparse.h b/src/jsparse.h
index 64cb0d86..48838e71 100644
--- a/src/jsparse.h
+++ b/src/jsparse.h
@@ -99,7 +99,7 @@ typedef enum  {
   EXEC_PARSE_FUNCTION_DECL = 4096,
 
   EXEC_RUN_MASK = EXEC_YES|EXEC_BREAK|EXEC_CONTINUE|EXEC_INTERRUPTED|EXEC_EXCEPTION,
-  EXEC_ERROR_MASK = EXEC_INTERRUPTED|EXEC_ERROR,
+  EXEC_ERROR_MASK = EXEC_INTERRUPTED|EXEC_ERROR|EXEC_EXCEPTION|EXEC_ERROR_LINE_REPORTED,
   EXEC_SAVE_RESTORE_MASK = EXEC_YES|EXEC_IN_LOOP|EXEC_IN_SWITCH, // the things JSP_SAVE/RESTORE_EXECUTE should keep track of
   EXEC_CTRL_C_MASK = EXEC_CTRL_C | EXEC_CTRL_C_WAIT, // Ctrl-C was pressed at some point
 } JsExecFlags;
diff --git a/src/jswrap_error.c b/src/jswrap_error.c
index 13d20028..1987fac5 100644
--- a/src/jswrap_error.c
+++ b/src/jswrap_error.c
@@ -26,11 +26,34 @@
         "name" : "Error",
         "generate" : "jswrap_error_constructor",
         "description" : [ "Creates an Error object" ],
+        "params" : [ [ "message", "JsVar", "An optional message string"] ],
         "return" : ["JsVar", "An Error object"]
 }*/
-JsVar *jswrap_error_constructor() {
+JsVar *jswrap_error_constructor(JsVar *msg) {
   JsVar *d = jspNewObject(0,"Error");
   if (!d) return 0;
 
+  if (msg) {
+    msg = jsvAsString(msg, false);
+    jsvUnLock(jsvObjectSetChild(d, "msg", msg));
+  }
+
   return d;
 }
+
+/*JSON{ "type":"method",
+        "class" : "Error", "name" : "toString",
+        "generate" : "jswrap_error_toString",
+        "return" : ["JsVar", "A String"]
+}*/
+JsVar *jswrap_error_toString(JsVar *parent) {
+  JsVar *str = jsvNewFromString("Error");
+
+  JsVar *msg = jsvObjectGetChild(parent, "msg", 0);
+  if (msg) {
+    jsvAppendPrintf(str, ": %v", msg);
+    jsvUnLock(msg);
+  }
+
+  return str;
+}
diff --git a/src/jswrap_error.h b/src/jswrap_error.h
index 5f28d1fe..daa863ce 100644
--- a/src/jswrap_error.h
+++ b/src/jswrap_error.h
@@ -14,3 +14,4 @@
 #include "jsvar.h"
 
 JsVar *jswrap_error_constructor();
+JsVar *jswrap_error_toString(JsVar *parent);

