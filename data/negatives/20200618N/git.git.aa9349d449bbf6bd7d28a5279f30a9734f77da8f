commit aa9349d449bbf6bd7d28a5279f30a9734f77da8f
Author: Marius Storm-Olsen <marius@trolltech.com>
Date:   Fri May 30 14:38:35 2008 +0200

    Add shortcut in refresh_cache_ent() for marked entries.
    
    When a cache entry has been marked as CE_VALID, the user has
    promised us that any change in the work tree does not matter.
    Just mark the entry as up-to-date, and continue.
    
    Signed-off-by: Marius Storm-Olsen <marius@trolltech.com>
    Signed-off-by: Junio C Hamano <gitster@pobox.com>

diff --git a/read-cache.c b/read-cache.c
index ac9a8e7e3..8e5fbb619 100644
--- a/read-cache.c
+++ b/read-cache.c
@@ -893,6 +893,15 @@ static struct cache_entry *refresh_cache_ent(struct index_state *istate,
 	if (ce_uptodate(ce))
 		return ce;
 
+	/*
+	 * CE_VALID means the user promised us that the change to
+	 * the work tree does not matter and told us not to worry.
+	 */
+	if (!ignore_valid && (ce->ce_flags & CE_VALID)) {
+		ce_mark_uptodate(ce);
+		return ce;
+	}
+
 	if (lstat(ce->name, &st) < 0) {
 		if (err)
 			*err = errno;

