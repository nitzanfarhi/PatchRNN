commit 3e6e145705a17b4dc3e24f6d32bc71e1b1b90efe
Author: castaglia <castaglia>
Date:   Mon Nov 9 03:51:51 2009 +0000

    In the pre-APPE handler, make sure to exclude files which match any configured
    QuotaExcludeFilter before checking the quota limits/tallies; if a file is
    excluded by the filter, it shouldn't run afoul of those limits/tallies.

diff --git a/contrib/mod_quotatab.c b/contrib/mod_quotatab.c
index 87783e646..b05c9fd75 100644
--- a/contrib/mod_quotatab.c
+++ b/contrib/mod_quotatab.c
@@ -28,7 +28,7 @@
  * ftp://pooh.urbanrage.com/pub/c/.  This module, however, has been written
  * from scratch to implement quotas in a different way.
  *
- * $Id: mod_quotatab.c,v 1.52 2009-11-09 03:47:51 castaglia Exp $
+ * $Id: mod_quotatab.c,v 1.53 2009-11-09 03:51:51 castaglia Exp $
  */
 
 #include "mod_quotatab.h"
@@ -1499,6 +1499,12 @@ MODRET quotatab_pre_appe(cmd_rec *cmd) {
   if (!use_quotas)
     return PR_DECLINED(cmd);
 
+  if (quotatab_ignore_path(cmd->tmp_pool, cmd->arg)) {
+    quotatab_log("%s: path '%s' matched QuotaExcludeFilter '%s', ignoring",
+      cmd->argv[0], cmd->arg, quota_exclude_filter);
+    return PR_DECLINED(cmd);
+  }
+
   /* Refresh the tally */
   QUOTATAB_TALLY_READ
 

