commit d457ef1c591b013f78ed8a34fcfeeef81c1fbe7e
Author: aland <aland>
Date:   Sun Dec 16 08:37:56 2007 +0000

            Catch and deny multiple levels of TLS nesting

diff --git a/src/modules/rlm_eap/eap.c b/src/modules/rlm_eap/eap.c
index cfcec53c4..27fb0d366 100644
--- a/src/modules/rlm_eap/eap.c
+++ b/src/modules/rlm_eap/eap.c
@@ -208,6 +208,14 @@ int eaptype_select(rlm_eap_t *inst, EAP_HANDLER *handler)
 		return EAP_INVALID;
 	}
 
+	/*
+	 *	Multiple levels of nesting are invalid.
+	 */
+	if (handler->request->parent && handler->request->parent->parent) {
+		DEBUG2(" rlm_eap: Multiple levels of TLS nesting is invalid.");
+		return EAP_INVALID;
+	}
+
 	/*
 	 *	Figure out what to do.
 	 */

