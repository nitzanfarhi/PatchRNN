commit b758cf7343d169afaa79a62b8a47af9ced04be27
Author: Justin Ruggles <justin.ruggles@gmail.com>
Date:   Tue Feb 7 14:31:49 2012 -0500

    avcodec: set avpkt->size to 0 if encode2() did not output a packet

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index 9dded6ae0..de3816b27 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -881,6 +881,8 @@ int attribute_align_arg avcodec_encode_audio2(AVCodecContext *avctx,
                                                avctx->time_base);
             }
             avpkt->dts = avpkt->pts;
+        } else {
+            avpkt->size = 0;
         }
     } else {
         /* for compatibility with encoders not supporting encode2(), we need to

