commit ba0991ebb2b74070d9a9c0eea54a728de597b40a
Author: William Pitcock <nenolod@dereferenced.org>
Date:   Mon Nov 7 00:57:30 2011 -0600

    nickserv/vhost: follow user_t state changes

diff --git a/modules/nickserv/vhost.c b/modules/nickserv/vhost.c
index ed6e46a59..4d8b78960 100644
--- a/modules/nickserv/vhost.c
+++ b/modules/nickserv/vhost.c
@@ -42,7 +42,10 @@ static void do_sethost(user_t *u, char *host)
 {
 	if (!strcmp(u->vhost, host))
 		return;
-	mowgli_strlcpy(u->vhost, host, HOSTLEN);
+
+	strshare_unref(u->vhost);
+	u->vhost = strshare_get(host);
+
 	user_sethost(nicksvs.me->me, u, u->vhost);
 }
 

