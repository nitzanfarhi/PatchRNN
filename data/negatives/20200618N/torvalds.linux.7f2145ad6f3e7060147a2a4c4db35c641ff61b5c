commit 7f2145ad6f3e7060147a2a4c4db35c641ff61b5c
Author: Izik Eidus <izike@qumranet.com>
Date:   Sun Sep 23 12:30:19 2007 +0200

    KVM: MMU: Set shadow pte atomically in mmu_pte_write_zap_pte()
    
    Setting shadow page table entry should be set atomicly using set_shadow_pte().
    
    Signed-off-by: Izik Eidus <izike@qumranet.com>
    Signed-off-by: Avi Kivity <avi@qumranet.com>

diff --git a/drivers/kvm/mmu.c b/drivers/kvm/mmu.c
index 6d84d30f5ed0..71716182d59d 100644
--- a/drivers/kvm/mmu.c
+++ b/drivers/kvm/mmu.c
@@ -1088,7 +1088,7 @@ static void mmu_pte_write_zap_pte(struct kvm_vcpu *vcpu,
 			mmu_page_remove_parent_pte(child, spte);
 		}
 	}
-	*spte = 0;
+	set_shadow_pte(spte, 0);
 	kvm_flush_remote_tlbs(vcpu->kvm);
 }
 

