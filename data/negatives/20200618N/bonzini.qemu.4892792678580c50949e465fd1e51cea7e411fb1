commit 4892792678580c50949e465fd1e51cea7e411fb1
Author: pbrook <pbrook@c046a42c-6fe2-441c-8c8c-71466251a162>
Date:   Tue Jan 20 04:15:47 2009 +0000

    Fix NAND flash save/restore.
    
    
    git-svn-id: svn://svn.savannah.nongnu.org/qemu/trunk@6370 c046a42c-6fe2-441c-8c8c-71466251a162

diff --git a/hw/nand.c b/hw/nand.c
index 11f8efca28..e73a1b8a80 100644
--- a/hw/nand.c
+++ b/hw/nand.c
@@ -492,6 +492,9 @@ struct nand_flash_s *nand_init(int manf_id, int chip_id)
     if (pagesize)
         s->storage = (uint8_t *) memset(qemu_malloc(s->pages * pagesize),
                         0xff, s->pages * pagesize);
+    /* Give s->ioaddr a sane value in case we save state before it
+       is used.  */
+    s->ioaddr = s->io;
 
     register_savevm("nand", -1, 0, nand_save, nand_load, s);
 

