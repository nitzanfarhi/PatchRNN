commit 880897d4c9eedd69b33b9905a6919e3e4f58eae8
Author: Arman Uguray <armansito@chromium.org>
Date:   Sat Mar 28 12:39:00 2015 -0700

    Bluetooth: Update adv. parameters when conn. setting changes
    
    This patch fixes a bug where the advertising parameters weren't updated
    after a call to "Set Connectable" if the HCI_ADVERTISING_INSTANCE
    setting was set.
    
    Signed-off-by: Arman Uguray <armansito@chromium.org>
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

diff --git a/net/bluetooth/mgmt.c b/net/bluetooth/mgmt.c
index 2d84fc16e108..29cbd98f4649 100644
--- a/net/bluetooth/mgmt.c
+++ b/net/bluetooth/mgmt.c
@@ -2113,7 +2113,8 @@ static int set_connectable(struct sock *sk, struct hci_dev *hdev, void *data,
 
 no_scan_update:
 	/* Update the advertising parameters if necessary */
-	if (hci_dev_test_flag(hdev, HCI_ADVERTISING))
+	if (hci_dev_test_flag(hdev, HCI_ADVERTISING) ||
+	    hci_dev_test_flag(hdev, HCI_ADVERTISING_INSTANCE))
 		enable_advertising(&req);
 
 	err = hci_req_run(&req, set_connectable_complete);

