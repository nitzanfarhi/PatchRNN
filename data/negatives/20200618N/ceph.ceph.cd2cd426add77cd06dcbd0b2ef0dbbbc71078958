commit cd2cd426add77cd06dcbd0b2ef0dbbbc71078958
Author: Sage Weil <sage@newdream.net>
Date:   Thu Nov 6 19:15:32 2008 -0800

    msgr: fix problem with forced stop of pipe

diff --git a/src/msg/SimpleMessenger.cc b/src/msg/SimpleMessenger.cc
index 944d63d022..84c2cba7c4 100644
--- a/src/msg/SimpleMessenger.cc
+++ b/src/msg/SimpleMessenger.cc
@@ -1308,8 +1308,9 @@ void Rank::Pipe::fault(bool onconnect)
 
   if (!onconnect) dout(2) << "fault " << errno << ": " << strerror(errno) << dendl;
 
-  if (state == STATE_CLOSED) {
-    dout(10) << "fault already closed" << dendl;
+  if (state == STATE_CLOSED ||
+      state == STATE_CLOSING) {
+    dout(10) << "fault already closed|closing" << dendl;
     return;
   }
 

