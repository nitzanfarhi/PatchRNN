commit 0ce8737f195603819ceabc1236c05bece80a0776
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Tue Aug 7 06:55:52 2007 +0000

    When vcl_miss() take error action, remember to discard backend request.
    
    Ticket: 139
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@1807 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/cache_center.c b/bin/varnishd/cache_center.c
index 91cc1b09b..e7cc5341c 100644
--- a/bin/varnishd/cache_center.c
+++ b/bin/varnishd/cache_center.c
@@ -567,6 +567,8 @@ cnt_miss(struct sess *sp)
 		HSH_Unbusy(sp->obj);
 		HSH_Deref(sp->obj);
 		sp->obj = NULL;
+		vbe_free_bereq(sp->bereq);
+		sp->bereq = NULL;
 		sp->step = STP_ERROR;
 		return (0);
 	}

