commit dba95ebbf88a8b8f10f4691946b4406e4acc4f0f
Author: Greg Kurz <groug@kaod.org>
Date:   Tue Jul 25 19:59:18 2017 +0200

    spapr_pci: parent the MSI memory region to the PHB
    
    This memory region should be owned by the PHB. This ensures the PHB
    cannot be finalized as long as the the region is guest visible, or
    used by a CPU or a device.
    
    Signed-off-by: Greg Kurz <groug@kaod.org>
    Signed-off-by: David Gibson <david@gibson.dropbear.id.au>

diff --git a/hw/ppc/spapr_pci.c b/hw/ppc/spapr_pci.c
index d258bc08d5..d7880f257a 100644
--- a/hw/ppc/spapr_pci.c
+++ b/hw/ppc/spapr_pci.c
@@ -1703,7 +1703,7 @@ static void spapr_phb_realize(DeviceState *dev, Error **errp)
     }
 #endif
 
-    memory_region_init_io(&sphb->msiwindow, NULL, &spapr_msi_ops, spapr,
+    memory_region_init_io(&sphb->msiwindow, OBJECT(sphb), &spapr_msi_ops, spapr,
                           "msi", msi_window_size);
     memory_region_add_subregion(&sphb->iommu_root, SPAPR_PCI_MSI_WINDOW,
                                 &sphb->msiwindow);

