commit d2e77863aad0be496224284dec7699a2639a1be4
Author: Kevin Lin <klin@sourcefire.com>
Date:   Mon Jun 8 16:20:36 2015 -0400

    sigopts: fixed incorrect checks for AC_WORD_MARKER_RIGHT

diff --git a/libclamav/matcher-ac.c b/libclamav/matcher-ac.c
index 41517811c..e59377cfb 100644
--- a/libclamav/matcher-ac.c
+++ b/libclamav/matcher-ac.c
@@ -1110,12 +1110,12 @@ static int ac_findmatch_branch(const unsigned char *buffer, uint32_t offset, uin
             if(bp == length)
                 match = !match;
             /* 'wide' characters need a 'wider' check */
-            else if(pattern->sigopts & ACPATT_OPTION_WIDE) {
+            else if((pattern->sigopts & ACPATT_OPTION_WIDE) && (bp+1 < length)) {
                 if(!(isalnum(buffer[bp]) && buffer[bp + 1] == '\0'))
                     match = !match;
             }
             /* 'normal' characters */
-            else if(!isalnum(buffer[offset - 1]))
+            else if(!isalnum(buffer[bp]))
                 match = !match;
         }
 

