commit c74e3f8e5aa2c60c7bf03dd20a436e64b311b7f6
Author: markus <markus@openbsd.org>
Date:   Mon Jan 5 19:20:18 2004 +0000

    support NOTE_EOF; from marius aamodt eriksen; ok tedu, millert

diff --git a/lib/libevent/kqueue.c b/lib/libevent/kqueue.c
index e4a8a51b081..0e9ee45f0b2 100644
--- a/lib/libevent/kqueue.c
+++ b/lib/libevent/kqueue.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: kqueue.c,v 1.10 2003/07/09 10:54:38 markus Exp $	*/
+/*	$OpenBSD: kqueue.c,v 1.11 2004/01/05 19:20:18 markus Exp $	*/
 
 /*
  * Copyright 2000-2002 Niels Provos <provos@citi.umich.edu>
@@ -293,6 +293,8 @@ kq_add(void *arg, struct event *ev)
 		kev.ident = ev->ev_fd;
 		kev.filter = EVFILT_READ;
 		kev.flags = EV_ADD;
+		/* Make it behave like select() and poll() */
+		kev.fflags = NOTE_EOF;
 		if (!(ev->ev_events & EV_PERSIST))
 			kev.flags |= EV_ONESHOT;
 		kev.udata = INTPTR(ev);

