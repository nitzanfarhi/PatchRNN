commit 2f1dffa88e1b120add4f0b3a794fbca65aa7768d
Author: Matt Caswell <matt@openssl.org>
Date:   Tue Jun 10 23:24:28 2014 +0100

    Fixed incorrect return code handling in ssl3_final_finish_mac

diff --git a/ssl/s3_enc.c b/ssl/s3_enc.c
index f1b2641853..6c103a042f 100644
--- a/ssl/s3_enc.c
+++ b/ssl/s3_enc.c
@@ -663,10 +663,18 @@ int ssl3_cert_verify_mac(SSL *s, int md_nid, unsigned char *p)
 int ssl3_final_finish_mac(SSL *s, 
 	     const char *sender, int len, unsigned char *p)
 	{
-	int ret;
+	int ret, sha1len;
 	ret=ssl3_handshake_mac(s,NID_md5,sender,len,p);
+	if(ret == 0)
+		return 0;
+
 	p+=ret;
-	ret+=ssl3_handshake_mac(s,NID_sha1,sender,len,p);
+
+	sha1len=ssl3_handshake_mac(s,NID_sha1,sender,len,p);
+	if(sha1len == 0)
+		return 0;
+
+	ret+=sha1len;
 	return(ret);
 	}
 static int ssl3_handshake_mac(SSL *s, int md_nid,

