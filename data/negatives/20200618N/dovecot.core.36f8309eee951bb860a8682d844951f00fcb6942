commit 36f8309eee951bb860a8682d844951f00fcb6942
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Aug 27 15:46:23 2015 +0200

    dsync: Fixed running with tcp/tcps destination.

diff --git a/src/doveadm/doveadm-dsync.c b/src/doveadm/doveadm-dsync.c
index 053d60b5f..39c804074 100644
--- a/src/doveadm/doveadm-dsync.c
+++ b/src/doveadm/doveadm-dsync.c
@@ -626,14 +626,19 @@ cmd_dsync_run(struct doveadm_mail_cmd_context *_ctx, struct mail_user *user)
 	brain = dsync_brain_master_init(user, ibc, ctx->sync_type,
 					brain_flags, &set);
 
-	if (ctx->run_type == DSYNC_RUN_TYPE_LOCAL) {
+	switch (ctx->run_type) {
+	case DSYNC_RUN_TYPE_LOCAL:
 		if (cmd_dsync_run_local(ctx, user, brain, ibc2,
 					&changes_during_sync, &mail_error) < 0)
 			ret = -1;
-	} else {
+		break;
+	case DSYNC_RUN_TYPE_CMD:
 		ctx->child_wait = child_wait_new_with_pid(ctx->remote_pid,
 			cmd_dsync_remote_exited, ctx);
+		/* fall through */
+	case DSYNC_RUN_TYPE_STREAM:
 		cmd_dsync_run_remote(user);
+		break;
 	}
 
 	if (ctx->state_input != NULL) {

