commit 03d3a482dc4a76982f29043ecf58c419c2c8755e
Author: Morris Jette <jette@schedmd.com>
Date:   Wed Aug 29 08:18:20 2012 -0700

    switch/nrt: handle running job's initial state being PES_INIT

diff --git a/src/plugins/switch/nrt/nrt.c b/src/plugins/switch/nrt/nrt.c
index cf1048b227..de6bfd17fc 100644
--- a/src/plugins/switch/nrt/nrt.c
+++ b/src/plugins/switch/nrt/nrt.c
@@ -4440,7 +4440,12 @@ static int _wait_job(nrt_job_key_t job_key, preemption_state_t want_state,
 		if (i)
 			usleep(100000);
 		curr_state = _job_preempt_state(job_key);
-		if (curr_state == want_state) {
+		/* Job's state is initially PES_INIT, even when running.
+		 * It only goes to state PES_JOB_RUNNING after suspend and
+		 * resume. */
+		if ((curr_state == want_state) ||
+		    ((curr_state == PES_INIT) &&
+		     (want_state == PES_JOB_RUNNING))) {
 			debug("switch/nrt: Desired job state in %d msec",
 			      (100 * i));
 			return 0;

