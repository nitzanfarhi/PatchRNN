commit 4d5d26fb82abe7c540d6d6b6c42670ce8cc765d5
Author: David Goldblatt <davidgoldblatt@fb.com>
Date:   Mon Mar 26 08:40:10 2018 -0700

    HHVM: Change empty string handling.
    
    Summary:
    The current logic has the effect of asserting that the first string the callback sees is nonempty. From jemalloc's point of view, emitting an empty string is a valid way to emit no output. This combination breaks on a recent jemalloc stats refactoring.
    
    Instead, we special case empty output strings.
    
    Reviewed By: markw65
    
    Differential Revision: D7374772
    
    fbshipit-source-id: 0039dc6a6ca4acde60cf6e330af70ec9da9cf14a

diff --git a/hphp/runtime/server/admin-request-handler.cpp b/hphp/runtime/server/admin-request-handler.cpp
index a94b530676..f07f2a4587 100644
--- a/hphp/runtime/server/admin-request-handler.cpp
+++ b/hphp/runtime/server/admin-request-handler.cpp
@@ -136,7 +136,7 @@ static void malloc_write_cb(void *cbopaque, const char *s) {
   malloc_write* mw = (malloc_write*)cbopaque;
   size_t slen = strlen(s);
 
-  if (mw->oom) {
+  if (mw->oom || slen == 0) {
     return;
   }
 
@@ -898,7 +898,7 @@ void AdminRequestHandler::handleRequest(Transport *transport) {
           break;
         }
 
-        transport->sendString(mwo.s);
+        transport->sendString(mwo.s == nullptr ? "" : mwo.s);
         malloc_write_fini(&mwo);
         break;
       }

