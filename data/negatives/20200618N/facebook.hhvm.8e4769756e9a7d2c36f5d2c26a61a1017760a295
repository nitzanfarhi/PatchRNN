commit 8e4769756e9a7d2c36f5d2c26a61a1017760a295
Author: Drew Paroski <andrewparoski@fb.com>
Date:   Mon Sep 23 17:19:07 2013 -0700

    Fix Set::toKeysArray() and Set::toValuesArray()
    
    Reviewed By: @elgenie
    
    Differential Revision: D981442

diff --git a/hphp/runtime/ext/ext_collections.cpp b/hphp/runtime/ext/ext_collections.cpp
index a01626ef69..30e1ea2fcb 100644
--- a/hphp/runtime/ext/ext_collections.cpp
+++ b/hphp/runtime/ext/ext_collections.cpp
@@ -3635,11 +3635,18 @@ Array c_Set::t_toarray() {
 }
 
 Array c_Set::t_tokeysarray() {
-  return toArrayImpl();
+  return t_tovaluesarray();
 }
 
 Array c_Set::t_tovaluesarray() {
-  return toArrayImpl();
+  PackedArrayInit ai(m_size);
+  for (uint i = 0; i <= m_nLastSlot; ++i) {
+    Bucket& p = m_data[i];
+    if (p.validValue()) {
+      ai.append(tvAsCVarRef(&p.data));
+    }
+  }
+  return ai.create();
 }
 
 Object c_Set::t_getiterator() {

