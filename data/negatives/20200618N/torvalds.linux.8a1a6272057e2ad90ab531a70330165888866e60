commit 8a1a6272057e2ad90ab531a70330165888866e60
Author: David Woodhouse <David.Woodhouse@intel.com>
Date:   Mon Oct 20 09:26:16 2008 +0100

    Revert "[MTD] m25p80.c code cleanup"
    
    This reverts commit 75d0ee2202b5740e94e913d8a52f91c6557c4c81.
    
    Although it seems ObviouslyCorrectâ„¢, the spi_write() call uses DMA,
    while spi_write_then_read() does not. Since our buffer is on the stack,
    we must use the latter even though we don't actually want to read
    anything back.
    
    Pointed out by David Brownell <david-b@pacbell.net>
    
    Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>

diff --git a/drivers/mtd/devices/m25p80.c b/drivers/mtd/devices/m25p80.c
index 697a3a217837..76a76751da36 100644
--- a/drivers/mtd/devices/m25p80.c
+++ b/drivers/mtd/devices/m25p80.c
@@ -134,7 +134,7 @@ static inline int write_enable(struct m25p *flash)
 {
 	u8	code = OPCODE_WREN;
 
-	return spi_write(flash->spi, &code, 1);
+	return spi_write_then_read(flash->spi, &code, 1, NULL, 0);
 }
 
 

