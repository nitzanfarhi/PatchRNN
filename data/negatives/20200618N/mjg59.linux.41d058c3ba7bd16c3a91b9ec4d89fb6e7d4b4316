commit 41d058c3ba7bd16c3a91b9ec4d89fb6e7d4b4316
Author: Trond Myklebust <Trond.Myklebust@netapp.com>
Date:   Sat Sep 7 17:49:05 2013 -0400

    NFSv4: Disallow security negotiation for lookups when 'sec=' is specified
    
    Ensure that nfs4_proc_lookup_common respects the NFS_MOUNT_SECFLAVOUR
    flag.
    
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>

diff --git a/fs/nfs/nfs4proc.c b/fs/nfs/nfs4proc.c
index 68551ea0b673..122b9340e6ef 100644
--- a/fs/nfs/nfs4proc.c
+++ b/fs/nfs/nfs4proc.c
@@ -3154,7 +3154,9 @@ static int nfs4_proc_lookup_common(struct rpc_clnt **clnt, struct inode *dir,
 			err = -EPERM;
 			if (client != *clnt)
 				goto out;
-
+			/* No security negotiation if the user specified 'sec=' */
+			if (NFS_SERVER(dir)->flags & NFS_MOUNT_SECFLAVOUR)
+				goto out;
 			client = nfs4_create_sec_client(client, dir, name);
 			if (IS_ERR(client))
 				return PTR_ERR(client);

