commit 7c101971155964c3ad1e74743c089f55be6f7be3
Author: Lubos Kardos <lkardos@redhat.com>
Date:   Wed Apr 6 09:44:27 2016 +0200

    Show a warning for macro expansion in comments again
    
    Fix regresion from ddf9ec7befe83ba1a12453a56e4e471aa9bcf4d3

diff --git a/build/parseSpec.c b/build/parseSpec.c
index 595e5c478..103218924 100644
--- a/build/parseSpec.c
+++ b/build/parseSpec.c
@@ -192,13 +192,9 @@ static int expandMacrosInSpecBuf(rpmSpec spec, int strip)
 	return 1;
     }
 
-    free(spec->lbuf);
-    spec->lbuf = lbuf;
-    spec->lbufSize = strlen(spec->lbuf) + 1;
-
     if (strip & STRIP_COMMENTS && isComment) {
-	char *bufA = lbuf;
-	char *bufB = spec->lbuf;
+	char *bufA = spec->lbuf;
+	char *bufB = lbuf;
 
 	while (*bufA != '\0' && *bufB != '\0') {
 	    if (*bufA == '%' && *(bufA + 1) == '%')
@@ -214,9 +210,13 @@ static int expandMacrosInSpecBuf(rpmSpec spec, int strip)
 	if (*bufA != '\0' || *bufB != '\0')
 	    rpmlog(RPMLOG_WARNING,
 		_("Macro expanded in comment on line %d: %s\n"),
-		spec->lineNum, lbuf);
+		spec->lineNum, bufA);
     }
 
+    free(spec->lbuf);
+    spec->lbuf = lbuf;
+    spec->lbufSize = strlen(spec->lbuf) + 1;
+
     return 0;
 }
 

