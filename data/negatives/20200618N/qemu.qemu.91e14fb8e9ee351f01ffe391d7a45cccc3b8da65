commit 91e14fb8e9ee351f01ffe391d7a45cccc3b8da65
Author: Peter Xu <peterx@redhat.com>
Date:   Thu Jan 4 22:18:33 2018 +0800

    chardev: use backend chr context when watch for fe
    
    In commit 6bbb6c0644 ("chardev: use per-dev context for
    io_add_watch_poll", 2017-09-22) all the chardev watches are converted to
    use per-chardev gcontext to support chardev to be run outside default
    main thread.  However that's still missing one call from the frontend
    code.  Touch that up.
    
    Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
    Reviewed-by: Marc-Andr√© Lureau <marcandre.lureau@redhat.com>
    Signed-off-by: Peter Xu <peterx@redhat.com>
    Message-Id: <20180104141835.17987-2-peterx@redhat.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

diff --git a/chardev/char-fe.c b/chardev/char-fe.c
index ee6d596100..c611b3fa3e 100644
--- a/chardev/char-fe.c
+++ b/chardev/char-fe.c
@@ -356,7 +356,7 @@ guint qemu_chr_fe_add_watch(CharBackend *be, GIOCondition cond,
     }
 
     g_source_set_callback(src, (GSourceFunc)func, user_data, NULL);
-    tag = g_source_attach(src, NULL);
+    tag = g_source_attach(src, s->gcontext);
     g_source_unref(src);
 
     return tag;

