commit 8aa43a80b8e38045dde7d91854843befbf8c2262
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Tue Jun 17 10:11:44 2008 +0000

    Fix another corner case in teardown of the event manager.
    
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@2723 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/mgt_event.c b/bin/varnishd/mgt_event.c
index 6577e6396..2ce303133 100644
--- a/bin/varnishd/mgt_event.c
+++ b/bin/varnishd/mgt_event.c
@@ -381,6 +381,8 @@ ev_compact_pfd(struct evbase *evb)
 		DBG(evb, "...[%d] fd = %d\n", u, p->fd);
 		if (p->fd >= 0)
 			continue;
+		if (u == evb->lpfd - 1)
+			break;
 		lfd = evb->pfd[evb->lpfd - 1].fd;
 		VTAILQ_FOREACH(ep, &evb->events, __list)
 			if (ep->fd == lfd)

