commit 46a41b512f6800b531e94bdf5f1ca0e226492d91
Author: Wei Yongjun <weiyongjun1@huawei.com>
Date:   Wed Sep 21 15:12:05 2016 +0000

    HID: alps: fix error return code in alps_input_configured()
    
    Fix to return a negative error code from the error handling
    case instead of 0, as done elsewhere in this function.
    
    While at it, remove redundant input_free_device(NULL) call.
    
    [jkosina@suse.cz: ammend changelog]
    Signed-off-by: Wei Yongjun <weiyongjun1@huawei.com>
    Reviewed-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
    Signed-off-by: Jiri Kosina <jkosina@suse.cz>

diff --git a/drivers/hid/hid-alps.c b/drivers/hid/hid-alps.c
index 048befde295a..0c18d473a5d8 100644
--- a/drivers/hid/hid-alps.c
+++ b/drivers/hid/hid-alps.c
@@ -383,7 +383,7 @@ static int alps_input_configured(struct hid_device *hdev, struct hid_input *hi)
 
 		input2 = input_allocate_device();
 		if (!input2) {
-			input_free_device(input2);
+			ret = -ENOMEM;
 			goto exit;
 		}
 
@@ -425,7 +425,8 @@ static int alps_input_configured(struct hid_device *hdev, struct hid_input *hi)
 		__set_bit(INPUT_PROP_POINTER, input2->propbit);
 		__set_bit(INPUT_PROP_POINTING_STICK, input2->propbit);
 
-		if (input_register_device(data->input2)) {
+		ret = input_register_device(data->input2);
+		if (ret) {
 			input_free_device(input2);
 			goto exit;
 		}

