commit 0517587e5896cef1d5f99d3b24f5f2ca15d952ad
Author: Greg Kroah-Hartman <gregkh@suse.de>
Date:   Thu Jun 22 13:29:52 2006 -0700

    [PATCH] USB: get USB suspend to work again
    
    Yeah, it's a hack, but it is only temporary until Alan's patches
    reworking this area make it in.  We really should not care what devices
    below us are doing, especially when we do not really know what type of
    devices they are.  This patch relies on the fact that the endpoint
    devices do not have a driver assigned to us.
    
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/usb/core/usb.c b/drivers/usb/core/usb.c
index 515310751303..fb488c8a860c 100644
--- a/drivers/usb/core/usb.c
+++ b/drivers/usb/core/usb.c
@@ -991,6 +991,8 @@ void usb_buffer_unmap_sg (struct usb_device *dev, unsigned pipe,
 
 static int verify_suspended(struct device *dev, void *unused)
 {
+	if (dev->driver == NULL)
+		return 0;
 	return (dev->power.power_state.event == PM_EVENT_ON) ? -EBUSY : 0;
 }
 

