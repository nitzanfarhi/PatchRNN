commit f714d3e7668c44f27cd6c093c2276d6f1b968814
Author: Greg Banks <gnb@fastmail.fm>
Date:   Sat Jun 2 23:30:01 2012 +1000

    Commit, don't abort, annotation in sync server
    
    What a difference a ! makes.

diff --git a/imap/sync_support.c b/imap/sync_support.c
index 969818cc5..1afff2989 100644
--- a/imap/sync_support.c
+++ b/imap/sync_support.c
@@ -1835,7 +1835,7 @@ int apply_annotations(struct mailbox *mailbox,
 out:
     if (!record) {
 	/* need to manage our own txn for the global db */
-	if (r)
+	if (!r)
 	    r = annotate_state_commit(&astate);
 	else
 	    annotate_state_abort(&astate);

