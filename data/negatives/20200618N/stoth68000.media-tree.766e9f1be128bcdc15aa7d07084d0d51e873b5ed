commit 766e9f1be128bcdc15aa7d07084d0d51e873b5ed
Author: Eric Dumazet <eric.dumazet@gmail.com>
Date:   Tue Jan 17 12:45:36 2012 +0000

    ipv6: fix per device IP snmp counters
    
    In commit 4ce3c183fca (snmp: 64bit ipstats_mib for all arches), I forgot
    to change the /proc/net/dev_snmp6/xxx output for IP counters.
    
    percpu array is 64bit per counter but the folding still used the 'long'
    variant, and output garbage on 32bit arches.
    
    Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/ipv6/proc.c b/net/ipv6/proc.c
index fdeb6d03da81..da2e92d05c15 100644
--- a/net/ipv6/proc.c
+++ b/net/ipv6/proc.c
@@ -237,8 +237,8 @@ static int snmp6_dev_seq_show(struct seq_file *seq, void *v)
 	struct inet6_dev *idev = (struct inet6_dev *)seq->private;
 
 	seq_printf(seq, "%-32s\t%u\n", "ifIndex", idev->dev->ifindex);
-	snmp6_seq_show_item(seq, (void __percpu **)idev->stats.ipv6, NULL,
-			    snmp6_ipstats_list);
+	snmp6_seq_show_item64(seq, (void __percpu **)idev->stats.ipv6,
+			    snmp6_ipstats_list, offsetof(struct ipstats_mib, syncp));
 	snmp6_seq_show_item(seq, NULL, idev->stats.icmpv6dev->mibs,
 			    snmp6_icmp6_list);
 	snmp6_seq_show_icmpv6msg(seq, idev->stats.icmpv6msgdev->mibs);

