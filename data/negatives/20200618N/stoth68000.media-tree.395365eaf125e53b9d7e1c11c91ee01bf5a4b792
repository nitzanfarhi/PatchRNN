commit 395365eaf125e53b9d7e1c11c91ee01bf5a4b792
Author: Marcel Holtmann <marcel@holtmann.org>
Date:   Sun Jul 13 17:22:25 2014 +0200

    Bluetooth: Allocate struct inquiry_entry with GFP_KERNEL
    
    The allocation of inquiry cache entries is triggered as a result of
    processing HCI events. Since the processing is done in the context
    of a workqueue, there is no needed to allocate with GFP_ATOMIC in
    that case. Switch it to GFP_KERNEL.
    
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
    Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>

diff --git a/net/bluetooth/hci_core.c b/net/bluetooth/hci_core.c
index 188bfd3d7c43..172041e2b15a 100644
--- a/net/bluetooth/hci_core.c
+++ b/net/bluetooth/hci_core.c
@@ -2088,7 +2088,7 @@ u32 hci_inquiry_cache_update(struct hci_dev *hdev, struct inquiry_data *data,
 	}
 
 	/* Entry not in the cache. Add new one. */
-	ie = kzalloc(sizeof(struct inquiry_entry), GFP_ATOMIC);
+	ie = kzalloc(sizeof(struct inquiry_entry), GFP_KERNEL);
 	if (!ie) {
 		flags |= MGMT_DEV_FOUND_CONFIRM_NAME;
 		goto done;

