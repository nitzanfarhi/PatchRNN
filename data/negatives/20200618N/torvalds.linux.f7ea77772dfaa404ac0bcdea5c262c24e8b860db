commit f7ea77772dfaa404ac0bcdea5c262c24e8b860db
Author: Vinod Koul <vinod.koul@intel.com>
Date:   Fri Mar 24 23:10:28 2017 +0530

    ASoC: Intel: Skylake: Don't unload module when in use
    
    A module may have multiple instances in DSP, so unload only when usage
    count is zero.
    
    Signed-off-by: Vinod Koul <vinod.koul@intel.com>
    Signed-off-by: Jeeja KP <jeeja.kp@intel.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/sound/soc/intel/skylake/skl-sst.c b/sound/soc/intel/skylake/skl-sst.c
index 39d4aaac73bf..539529729e3f 100644
--- a/sound/soc/intel/skylake/skl-sst.c
+++ b/sound/soc/intel/skylake/skl-sst.c
@@ -417,6 +417,11 @@ static int skl_unload_module(struct sst_dsp *ctx, u16 mod_id)
 		dev_err(ctx->dev, "Module bad usage cnt!:%d\n", usage_cnt);
 		return -EIO;
 	}
+
+	/* if module is used by others return, no need to unload */
+	if (usage_cnt > 0)
+		return 0;
+
 	ret = skl_ipc_unload_modules(&skl->ipc,
 			SKL_NUM_MODULES, &mod_id);
 	if (ret < 0) {

