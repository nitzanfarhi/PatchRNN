commit 49682864b0270a0578b8321ed2686dc471ec37f1
Author: Valentine Barshak <vbarshak@ru.mvista.com>
Date:   Mon Oct 5 03:27:56 2009 +0000

    pasemi_mac: ethtool get settings fix
    
    Not all pasemi mac interfaces can have a phy attached.
    For example, XAUI has no phy and phydev is NULL for it.
    In this case ethtool get settings causes kernel crash.
    Fix it by returning -EOPNOTSUPP if there's no PHY attached.
    
    Signed-off-by: Valentine Barshak <vbarshak@ru.mvista.com>
    Acked-by: Olof Johansson <olof@lixom.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/pasemi_mac_ethtool.c b/drivers/net/pasemi_mac_ethtool.c
index 064a4fe1dd90..28a86224879d 100644
--- a/drivers/net/pasemi_mac_ethtool.c
+++ b/drivers/net/pasemi_mac_ethtool.c
@@ -71,6 +71,9 @@ pasemi_mac_ethtool_get_settings(struct net_device *netdev,
 	struct pasemi_mac *mac = netdev_priv(netdev);
 	struct phy_device *phydev = mac->phydev;
 
+	if (!phydev)
+		return -EOPNOTSUPP;
+
 	return phy_ethtool_gset(phydev, cmd);
 }
 

