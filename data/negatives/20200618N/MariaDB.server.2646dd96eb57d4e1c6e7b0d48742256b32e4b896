commit 2646dd96eb57d4e1c6e7b0d48742256b32e4b896
Author: Marko Mäkelä <marko.makela@oracle.com>
Date:   Tue May 17 15:15:55 2011 +0300

    Bug#12543706 - innodb-fast-shutdown=2: Assert
    node->modification_counter == node->flush_counter
    
    This bug (an assertion failure during a crash-like shutdown)
    was introduced by the fix of
    Bug#12323643 Clean up the InnoDB thread shutdown and assertions (WL#5136).
    
    fil_node_close_file(): Relax the failing assertion
    when innodb_fast_shutdown=2.

diff --git a/storage/innobase/fil/fil0fil.c b/storage/innobase/fil/fil0fil.c
index 0d9846fdbf8..196f4bd3f42 100644
--- a/storage/innobase/fil/fil0fil.c
+++ b/storage/innobase/fil/fil0fil.c
@@ -856,7 +856,8 @@ fil_node_close_file(
 	ut_a(node->open);
 	ut_a(node->n_pending == 0);
 	ut_a(node->n_pending_flushes == 0);
-	ut_a(node->modification_counter == node->flush_counter);
+	ut_a(node->modification_counter == node->flush_counter
+	     || srv_fast_shutdown == 2);
 
 	ret = os_file_close(node->handle);
 	ut_a(ret);

