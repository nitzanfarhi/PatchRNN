commit d3134dbf2046076b6e52b05890e812442d5257fb
Author: Jan Kiszka <jan.kiszka@siemens.com>
Date:   Wed Oct 23 14:40:31 2013 +0100

    KVM: nVMX: Report 2MB EPT pages as supported
    
    As long as the hardware provides us 2MB EPT pages, we can also expose
    them to the guest because our shadow EPT code already supports this
    feature.
    
    Signed-off-by: Jan Kiszka <jan.kiszka@siemens.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

diff --git a/arch/x86/kvm/vmx.c b/arch/x86/kvm/vmx.c
index 06fd7629068a..feef3a1e45d3 100644
--- a/arch/x86/kvm/vmx.c
+++ b/arch/x86/kvm/vmx.c
@@ -2261,7 +2261,8 @@ static __init void nested_vmx_setup_ctls_msrs(void)
 		/* nested EPT: emulate EPT also to L1 */
 		nested_vmx_secondary_ctls_high |= SECONDARY_EXEC_ENABLE_EPT;
 		nested_vmx_ept_caps = VMX_EPT_PAGE_WALK_4_BIT |
-			 VMX_EPTP_WB_BIT | VMX_EPT_INVEPT_BIT;
+			 VMX_EPTP_WB_BIT | VMX_EPT_2MB_PAGE_BIT |
+			 VMX_EPT_INVEPT_BIT;
 		nested_vmx_ept_caps &= vmx_capability.ept;
 		/*
 		 * Since invept is completely emulated we support both global

