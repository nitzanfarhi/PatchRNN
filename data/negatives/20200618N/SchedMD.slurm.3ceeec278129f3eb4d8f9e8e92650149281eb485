commit 3ceeec278129f3eb4d8f9e8e92650149281eb485
Author: Mark Grondona <mgrondona@llnl.gov>
Date:   Mon Sep 29 23:32:54 2003 +0000

     o Do not close input stream when output buffer is full (gnats:294)

diff --git a/src/srun/io.c b/src/srun/io.c
index 880ded5d0f..1befb1a38f 100644
--- a/src/srun/io.c
+++ b/src/srun/io.c
@@ -674,12 +674,25 @@ _do_task_output(int *fd, FILE *out, cbuf_t buf, int tasknum)
 	int len = 0;
 	int dropped = 0;
 
+    again:
 	if ((len = cbuf_write_from_fd(buf, *fd, -1, &dropped)) < 0) {
+
+		/*
+		 *  If output buffer is full, flush all output to
+		 *   output stream
+		 */
+		if (errno == ENOSPC) {
+			cbuf_read_to_fd(buf, fileno(out), -1);
+			goto again;
+		} 
+		
 		if (errno == EAGAIN)
 			return 0;
+
 		error("Error task %d IO: %m", tasknum);
 		_close_stream(fd, out, tasknum);
 		return len;
+
 	} else if (len == 0) {
 		_close_stream(fd, out, tasknum);
 		return len;

