commit 3ae69b91668e3d9b65af4007eb5871397cf0b0ab
Author: Janne Grunau <janne-libav@jannau.net>
Date:   Wed Nov 28 17:31:35 2012 +0100

    flashsv: make sure data for zlib priming is available
    
    Fixes a segfault in the fuzzed sample resolutionchange.flv_s314809.
    
    CC: libav-stable@libav.org

diff --git a/libavcodec/flashsv.c b/libavcodec/flashsv.c
index ac57f9f68a..d12e2342c1 100644
--- a/libavcodec/flashsv.c
+++ b/libavcodec/flashsv.c
@@ -401,6 +401,11 @@ static int flashsv_decode_frame(AVCodecContext *avctx, void *data,
                     av_log_missing_feature(avctx, "zlibprime_curr", 1);
                     return AVERROR_PATCHWELCOME;
                 }
+                if (!s->blocks && (s->zlibprime_curr || s->zlibprime_prev)) {
+                    av_log(avctx, AV_LOG_ERROR, "no data available for zlib "
+                           "priming\n");
+                    return AVERROR_INVALIDDATA;
+                }
                 size--; // account for flags byte
             }
 

