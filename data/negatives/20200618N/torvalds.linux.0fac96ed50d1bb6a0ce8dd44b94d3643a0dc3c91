commit 0fac96ed50d1bb6a0ce8dd44b94d3643a0dc3c91
Author: Brian Masney <masneyb@onstation.org>
Date:   Tue Jan 17 04:25:01 2017 -0500

    staging: iio: isl29028: only set ALS scale when ALS/IR sensing is enabled
    
    isl29028_chip_init_and_power_on() calls isl29028_set_als_scale() and
    this is not needed until the user actually needs to take a reading from
    the ALS/IR sensor. This patch moves the isl29028_set_als_scale() call
    from isl29028_chip_init_and_power_on() to isl29028_set_als_ir_mode().
    This sets the stage for faster resume times from runtime power
    management if the user is only querying the proximity sensor.
    
    Signed-off-by: Brian Masney <masneyb@onstation.org>
    Signed-off-by: Jonathan Cameron <jic23@kernel.org>

diff --git a/drivers/staging/iio/light/isl29028.c b/drivers/staging/iio/light/isl29028.c
index fa58d083906e..598a5a5a8641 100644
--- a/drivers/staging/iio/light/isl29028.c
+++ b/drivers/staging/iio/light/isl29028.c
@@ -146,11 +146,15 @@ static int isl29028_set_als_scale(struct isl29028_chip *chip, int lux_scale)
 static int isl29028_set_als_ir_mode(struct isl29028_chip *chip,
 				    enum isl29028_als_ir_mode mode)
 {
-	int ret = 0;
+	int ret;
 
 	if (chip->als_ir_mode == mode)
 		return 0;
 
+	ret = isl29028_set_als_scale(chip, chip->lux_scale);
+	if (ret < 0)
+		return ret;
+
 	switch (mode) {
 	case ISL29028_MODE_ALS:
 		ret = regmap_update_bits(chip->regmap, ISL29028_REG_CONFIGURE,
@@ -453,7 +457,7 @@ static int isl29028_chip_init_and_power_on(struct isl29028_chip *chip)
 		return ret;
 	}
 
-	return isl29028_set_als_scale(chip, chip->lux_scale);
+	return ret;
 }
 
 static bool isl29028_is_volatile_reg(struct device *dev, unsigned int reg)

