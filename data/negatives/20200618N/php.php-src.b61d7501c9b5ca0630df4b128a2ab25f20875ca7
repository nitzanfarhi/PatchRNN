commit b61d7501c9b5ca0630df4b128a2ab25f20875ca7
Author: Andrey Hristov <andrey@php.net>
Date:   Mon May 31 17:09:13 2010 +0000

    Bail if allocation fails

diff --git a/ext/mysqlnd/mysqlnd_loaddata.c b/ext/mysqlnd/mysqlnd_loaddata.c
index 267c3b8b7e..1885cbc6d0 100644
--- a/ext/mysqlnd/mysqlnd_loaddata.c
+++ b/ext/mysqlnd/mysqlnd_loaddata.c
@@ -53,7 +53,12 @@ int mysqlnd_local_infile_init(void **ptr, char *filename, void **userdata TSRMLS
 
 	DBG_ENTER("mysqlnd_local_infile_init");
 
-	*ptr = info = ((MYSQLND_INFILE_INFO *)mnd_ecalloc(1, sizeof(MYSQLND_INFILE_INFO)));
+	info = ((MYSQLND_INFILE_INFO *)mnd_ecalloc(1, sizeof(MYSQLND_INFILE_INFO)));
+	if (!info) {
+		DBG_RETURN(1);
+	}
+	
+	*ptr = info;
 
 	/* check open_basedir */
 	if (PG(open_basedir)) {

