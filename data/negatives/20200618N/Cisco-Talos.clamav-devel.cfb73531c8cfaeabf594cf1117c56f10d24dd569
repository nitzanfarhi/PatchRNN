commit cfb73531c8cfaeabf594cf1117c56f10d24dd569
Author: Steve Morgan <smorgan@sourcefire.com>
Date:   Mon Dec 17 15:47:12 2012 -0800

    fix loop in cab file processing: ensure window position within frame

diff --git a/libclamav/mspack.c b/libclamav/mspack.c
index c07bc73db..7db5259e0 100644
--- a/libclamav/mspack.c
+++ b/libclamav/mspack.c
@@ -1881,6 +1881,10 @@ int qtm_decompress(struct qtm_stream *qtm, uint32_t out_bytes) {
     if ((frame_start + QTM_FRAME_SIZE) < frame_end) {
       frame_end = frame_start + QTM_FRAME_SIZE;
     }
+    if (frame_end < window_posn) {
+	cli_dbgmsg("qtm_decompress: window position beyond end of frame\n");
+	return qtm->error = CL_EFORMAT;
+    }
 
     while (window_posn < frame_end) {
       QTM_GET_SYMBOL(qtm->model7, selector);

