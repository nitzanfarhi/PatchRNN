commit abe08ee647c1b5fda1564dd4c6020b55cb9f0c92
Author: dron <dron>
Date:   Wed Mar 12 14:05:05 2003 +0000

    Added library version reporting to all tools.

diff --git a/tools/fax2ps.c b/tools/fax2ps.c
index fb885e2f..c31b942a 100644
--- a/tools/fax2ps.c
+++ b/tools/fax2ps.c
@@ -425,6 +425,7 @@ usage(int code)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(code);
diff --git a/tools/fax2tiff.c b/tools/fax2tiff.c
index 2cdfe021..c0e80dcc 100644
--- a/tools/fax2tiff.c
+++ b/tools/fax2tiff.c
@@ -420,6 +420,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(EXIT_FAILURE);
diff --git a/tools/gif2tiff.c b/tools/gif2tiff.c
index 74a262ca..624a554b 100644
--- a/tools/gif2tiff.c
+++ b/tools/gif2tiff.c
@@ -88,6 +88,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/pal2rgb.c b/tools/pal2rgb.c
index 99d9b1b9..726ee7ba 100644
--- a/tools/pal2rgb.c
+++ b/tools/pal2rgb.c
@@ -380,6 +380,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/ppm2tiff.c b/tools/ppm2tiff.c
index ae78baec..34ae8478 100644
--- a/tools/ppm2tiff.c
+++ b/tools/ppm2tiff.c
@@ -241,6 +241,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/ras2tiff.c b/tools/ras2tiff.c
index de400b18..2201e991 100644
--- a/tools/ras2tiff.c
+++ b/tools/ras2tiff.c
@@ -261,6 +261,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/raw2tiff.c b/tools/raw2tiff.c
index c19dce5a..a72fbde1 100644
--- a/tools/raw2tiff.c
+++ b/tools/raw2tiff.c
@@ -378,6 +378,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/rgb2ycbcr.c b/tools/rgb2ycbcr.c
index 3c604d5d..e84c7886 100644
--- a/tools/rgb2ycbcr.c
+++ b/tools/rgb2ycbcr.c
@@ -53,7 +53,7 @@ float	ycbcrCoeffs[3] = { .299, .587, .114 };
 float	refBlackWhite[6] = { 0., 255., 128., 255., 128., 255. };
 
 static	int tiffcvt(TIFF* in, TIFF* out);
-static	void usage(void);
+static	void usage(int code);
 static	void setupLumaTables(void);
 
 int
@@ -78,7 +78,7 @@ main(int argc, char* argv[])
 			else if (streq(optarg, "zip"))
 			    compression = COMPRESSION_ADOBE_DEFLATE;
 			else
-			    usage();
+			    usage(-1);
 			break;
 		case 'h':
 			horizSubSampling = atoi(optarg);
@@ -98,11 +98,11 @@ main(int argc, char* argv[])
 			refBlackWhite[5] = 240.;
 			break;
 		case '?':
-			usage();
+			usage(0);
 			/*NOTREACHED*/
 		}
 	if (argc - optind < 2)
-		usage();
+		usage(-1);
 	out = TIFFOpen(argv[argc-1], "w");
 	if (out == NULL)
 		return (-2);
@@ -319,7 +319,7 @@ tiffcvt(TIFF* in, TIFF* out)
 	return (cvtRaster(out, raster, width, height));
 }
 
-static char* usageMsg[] = {
+char* stuff[] = {
     "usage: rgb2ycbcr [-c comp] [-r rows] [-h N] [-v N] input... output\n",
     "where comp is one of the following compression algorithms:\n",
     " jpeg\t\tJPEG encoding\n",
@@ -336,10 +336,15 @@ static char* usageMsg[] = {
 };
 
 static void
-usage(void)
+usage(int code)
 {
+	char buf[BUFSIZ];
 	int i;
-	for (i = 0; usageMsg[i]; i++)
-		fprintf(stderr, "%s", usageMsg[i]);
-	exit(-1);
+
+	setbuf(stderr, buf);
+       
+ fprintf(stderr, "%s\n\n", TIFFGetVersion());
+	for (i = 0; stuff[i] != NULL; i++)
+		fprintf(stderr, "%s\n", stuff[i]);
+	exit(code);
 }
diff --git a/tools/thumbnail.c b/tools/thumbnail.c
index d8488346..5257ed82 100644
--- a/tools/thumbnail.c
+++ b/tools/thumbnail.c
@@ -566,6 +566,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/tiff2bw.c b/tools/tiff2bw.c
index 12d39010..72e9e00c 100644
--- a/tools/tiff2bw.c
+++ b/tools/tiff2bw.c
@@ -395,6 +395,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/tiff2ps.c b/tools/tiff2ps.c
index ea9bf531..db5fe67b 100644
--- a/tools/tiff2ps.c
+++ b/tools/tiff2ps.c
@@ -1960,6 +1960,7 @@ usage(int code)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(code);
diff --git a/tools/tiff2rgba.c b/tools/tiff2rgba.c
index db65ef8c..e2b3a6f3 100644
--- a/tools/tiff2rgba.c
+++ b/tools/tiff2rgba.c
@@ -46,7 +46,7 @@ int     no_alpha = 0;
 
 
 static	int tiffcvt(TIFF* in, TIFF* out);
-static	void usage(void);
+static	void usage(int code);
 
 int
 main(int argc, char* argv[])
@@ -74,7 +74,7 @@ main(int argc, char* argv[])
             else if (streq(optarg, "zip"))
                 compression = COMPRESSION_DEFLATE;
             else
-                usage();
+                usage(-1);
             break;
 
           case 'r':
@@ -90,12 +90,12 @@ main(int argc, char* argv[])
             break;
             
           case '?':
-            usage();
+            usage(0);
             /*NOTREACHED*/
         }
 
     if (argc - optind < 2)
-        usage();
+        usage(-1);
 
     out = TIFFOpen(argv[argc-1], "w");
     if (out == NULL)
@@ -473,7 +473,7 @@ tiffcvt(TIFF* in, TIFF* out)
             return( cvt_whole_image( in, out ) );
 }
 
-static char* usageMsg[] = {
+static char* stuff[] = {
     "usage: tiff2rgba [-c comp] [-r rows] [-b] input... output\n",
     "where comp is one of the following compression algorithms:\n",
     " jpeg\t\tJPEG encoding\n",
@@ -490,10 +490,14 @@ static char* usageMsg[] = {
 };
 
 static void
-usage(void)
+usage(int code)
 {
+	char buf[BUFSIZ];
 	int i;
-	for (i = 0; usageMsg[i]; i++)
-		fprintf(stderr, "%s", usageMsg[i]);
-	exit(-1);
+
+	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
+	for (i = 0; stuff[i] != NULL; i++)
+		fprintf(stderr, "%s\n", stuff[i]);
+	exit(code);
 }
diff --git a/tools/tiffcp.c b/tools/tiffcp.c
index 06750b87..b0063acf 100644
--- a/tools/tiffcp.c
+++ b/tools/tiffcp.c
@@ -402,6 +402,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/tiffdither.c b/tools/tiffdither.c
index e6ade210..f4451c1f 100644
--- a/tools/tiffdither.c
+++ b/tools/tiffdither.c
@@ -308,6 +308,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/tiffinfo.c b/tools/tiffinfo.c
index ad8ab119..1a7f809c 100644
--- a/tools/tiffinfo.c
+++ b/tools/tiffinfo.c
@@ -155,6 +155,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);
diff --git a/tools/tiffmedian.c b/tools/tiffmedian.c
index c103e1e1..2c6dc5eb 100644
--- a/tools/tiffmedian.c
+++ b/tools/tiffmedian.c
@@ -332,6 +332,7 @@ usage(void)
 	int i;
 
 	setbuf(stderr, buf);
+        fprintf(stderr, "%s\n\n", TIFFGetVersion());
 	for (i = 0; stuff[i] != NULL; i++)
 		fprintf(stderr, "%s\n", stuff[i]);
 	exit(-1);

