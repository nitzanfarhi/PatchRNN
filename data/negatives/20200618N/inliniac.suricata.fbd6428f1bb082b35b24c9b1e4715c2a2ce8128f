commit fbd6428f1bb082b35b24c9b1e4715c2a2ce8128f
Author: Eric Leblond <eric@regit.org>
Date:   Tue May 12 17:56:59 2015 +0200

    smtp-layer: add MAIL FROM parsing test in unittest

diff --git a/src/app-layer-smtp.c b/src/app-layer-smtp.c
index d95bc738..0731442a 100644
--- a/src/app-layer-smtp.c
+++ b/src/app-layer-smtp.c
@@ -4538,6 +4538,16 @@ int SMTPParserTest14(void)
         SCMutexUnlock(&f.m);
         goto end;
     }
+
+    if ((smtp_state->curr_tx->mail_from_len != 14) ||
+        strncmp("asdff@asdf.com", (char *)smtp_state->curr_tx->mail_from, 14)) {
+        printf("incorrect parsing of MAIL FROM field '%s' (%d)\n",
+               smtp_state->curr_tx->mail_from,
+               smtp_state->curr_tx->mail_from_len);
+        SCMutexUnlock(&f.m);
+        goto end;
+    }
+
     SCMutexUnlock(&f.m);
     if (smtp_state->input_len != 0 ||
             smtp_state->cmds_cnt != 0 ||

