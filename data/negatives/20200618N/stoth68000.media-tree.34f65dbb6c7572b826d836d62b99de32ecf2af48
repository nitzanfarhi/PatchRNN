commit 34f65dbb6c7572b826d836d62b99de32ecf2af48
Author: Richard Alpe <richard.alpe@ericsson.com>
Date:   Thu Mar 3 14:20:43 2016 +0100

    tipc: make sure required IPv6 addresses are scoped
    
    Make sure the user has provided a scope for multicast and link local
    addresses used locally by a UDP bearer.
    
    Signed-off-by: Richard Alpe <richard.alpe@ericsson.com>
    Acked-by: Jon Maloy <jon.maloy@ericsson.com>
    Reviewed-by: Erik Hugne <erik.hugne@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/tipc/udp_media.c b/net/tipc/udp_media.c
index 6fe8740a226f..fb2f7ec68eef 100644
--- a/net/tipc/udp_media.c
+++ b/net/tipc/udp_media.c
@@ -310,9 +310,14 @@ static int parse_options(struct nlattr *attrs[], struct udp_bearer *ub,
 
 #if IS_ENABLED(CONFIG_IPV6)
 	} else if ((sa_local.ss_family & sa_remote.ss_family) == AF_INET6) {
+		int atype;
 		struct sockaddr_in6 *ip6;
 
 		ip6 = (struct sockaddr_in6 *)&sa_local;
+		atype = ipv6_addr_type(&ip6->sin6_addr);
+		if (__ipv6_addr_needs_scope_id(atype) && !ip6->sin6_scope_id)
+			return -EINVAL;
+
 		local->proto = htons(ETH_P_IPV6);
 		local->udp_port = ip6->sin6_port;
 		memcpy(&local->ipv6, &ip6->sin6_addr, sizeof(struct in6_addr));

