commit 2c31cd513b58bc280c3e392d4a11d0c2b80ed7dc
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Wed Jun 3 12:39:50 2009 +0000

    Fixed bug #46386 (Digest authentication with SOAP module fails against MSSQL
    SOAP services)
    
    #original patch by lordelph at gmail dot com

diff --git a/ext/soap/php_http.c b/ext/soap/php_http.c
index 42c939bdb2..563087a31d 100644
--- a/ext/soap/php_http.c
+++ b/ext/soap/php_http.c
@@ -612,6 +612,11 @@ try_again:
 						smart_str_append_const(&soap_headers, "\", opaque=\"");
 						smart_str_appendl(&soap_headers, Z_STRVAL_PP(tmp), Z_STRLEN_PP(tmp));
 					}
+					if (zend_hash_find(Z_ARRVAL_PP(digest), "algorithm", sizeof("algorithm"), (void **)&tmp) == SUCCESS &&
+						Z_TYPE_PP(tmp) == IS_STRING) {
+						smart_str_append_const(&soap_headers, "\", algorithm=\"");
+						smart_str_appendl(&soap_headers, Z_STRVAL_PP(tmp), Z_STRLEN_PP(tmp));
+					}
 					smart_str_append_const(&soap_headers, "\"\r\n");
 				}
 			} else {

