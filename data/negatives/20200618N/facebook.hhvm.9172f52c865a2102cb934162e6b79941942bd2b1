commit 9172f52c865a2102cb934162e6b79941942bd2b1
Author: Daniel Sloof <goapsychadelic@gmail.com>
Date:   Fri Oct 24 13:22:07 2014 -0700

    backport PHP bugfix #43540
    
    Summary: We need to properly set newlength.
    
    See:
    - https://github.com/php/php-src/commit/898ff10dc0f799ecf997cb3c64a96f2751884187
    - https://bugs.php.net/bug.php?id=43540
    Closes https://github.com/facebook/hhvm/pull/4014
    
    Reviewed By: @ptarjan
    
    Differential Revision: D1626102
    
    Pulled By: @fredemmott

diff --git a/hphp/runtime/server/upload.cpp b/hphp/runtime/server/upload.cpp
index 07b5cb3089..ac21ff0fbc 100644
--- a/hphp/runtime/server/upload.cpp
+++ b/hphp/runtime/server/upload.cpp
@@ -800,7 +800,7 @@ void rfc1867PostHandler(Transport* transport,
         new_val_len = value_len;
         if (php_rfc1867_callback != nullptr) {
           multipart_event_formdata event_formdata;
-          size_t newlength = 0;
+          size_t newlength = new_val_len;
 
           event_formdata.post_bytes_processed = mbuff->read_post_bytes;
           event_formdata.name = param;

