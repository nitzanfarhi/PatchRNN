commit a996cca2f2af79c1792ad82d1f557c0e305fde4c
Author: Paul Wouters <paul@libreswan.org>
Date:   Mon Aug 20 17:35:25 2012 -0400

    * Support reading NSS password from file
    
    Slightly modified from Avesh's patch to keep consistency of configdir
    location (i.e. when configdir != /etc/ipsec.d/)

diff --git a/programs/rsasigkey/rsasigkey.c b/programs/rsasigkey/rsasigkey.c
index 4fd09ab9a..827de2e49 100644
--- a/programs/rsasigkey/rsasigkey.c
+++ b/programs/rsasigkey/rsasigkey.c
@@ -526,15 +526,16 @@ rsasigkey(int nbits, char *configdir, char *password)
     mpz_init(n);
     mpz_init(e);
 
-    pwdata.source = password ? PW_PLAINTEXT : PW_NONE;
-    pwdata.data = password ? password : NULL;
-
     do {
 	if (!configdir) {
 		fprintf(stderr, "%s: configdir is required\n", me);
 		return;
 	}
 
+	snprintf(buf, sizeof(buf), "%s/nsspassword",configdir);
+	pwdata.source = password ? (strcmp(password, buf)? PW_PLAINTEXT: PW_FROMFILE) : PW_NONE;
+	pwdata.data = password ? password : NULL;
+
 	PR_Init(PR_USER_THREAD, PR_PRIORITY_NORMAL, 1);
 	snprintf(buf, sizeof(buf), "%s",configdir);
 	if ((rv = NSS_InitReadWrite(buf)) != SECSuccess) {

