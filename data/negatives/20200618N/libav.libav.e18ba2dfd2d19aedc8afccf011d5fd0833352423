commit e18ba2dfd2d19aedc8afccf011d5fd0833352423
Author: Anton Khirnov <anton@khirnov.net>
Date:   Mon Nov 7 14:12:17 2016 +0100

    hwcontext_dxva2: make sure the sw frame format is the right one during transfer

diff --git a/libavutil/hwcontext_dxva2.c b/libavutil/hwcontext_dxva2.c
index 3fe19a6b6..ccf03c8e9 100644
--- a/libavutil/hwcontext_dxva2.c
+++ b/libavutil/hwcontext_dxva2.c
@@ -315,6 +315,9 @@ static int dxva2_transfer_data_to(AVHWFramesContext *ctx, AVFrame *dst,
     AVFrame *map;
     int ret;
 
+    if (src->format != ctx->sw_format)
+        return AVERROR(ENOSYS);
+
     map = av_frame_alloc();
     if (!map)
         return AVERROR(ENOMEM);
@@ -339,6 +342,9 @@ static int dxva2_transfer_data_from(AVHWFramesContext *ctx, AVFrame *dst,
     ptrdiff_t src_linesize[4], dst_linesize[4];
     int ret, i;
 
+    if (dst->format != ctx->sw_format)
+        return AVERROR(ENOSYS);
+
     map = av_frame_alloc();
     if (!map)
         return AVERROR(ENOMEM);

