commit 43504796252dc8c399f490927008fcbf7d97b27b
Author: Richard Jones <rjones@redhat.com>
Date:   Thu Feb 4 16:31:09 2010 +0000

    hivexsh: cd command: fix error handling
    
    The error behaviour of hivex_node_get_child is subtle, so the 'cd'
    command wouldn't always report errors correctly.  This fixes it.

diff --git a/hivex/hivexsh.c b/hivex/hivexsh.c
index ceb115362..39ca634aa 100644
--- a/hivex/hivexsh.c
+++ b/hivex/hivexsh.c
@@ -559,10 +559,14 @@ cmd_cd (char *path)
       continue;
     }
 
+    errno = 0;
     new_cwd = hivex_node_get_child (h, new_cwd, elem);
     if (new_cwd == 0) {
-      fprintf (stderr, _("hivexsh: cd: subkey '%s' not found\n"),
-               elem);
+      if (errno)
+        perror ("hivexsh: cd");
+      else
+        fprintf (stderr, _("hivexsh: cd: subkey '%s' not found\n"),
+                 elem);
       return -1;
     }
   }

