commit 420150d9dcc40733a2df851023a331ccfdcee3e3
Author: xie xingguo <xie.xingguo@zte.com.cn>
Date:   Mon Sep 5 16:42:12 2016 +0800

    os/bluestore: don't dirty onode if its size is already at desired offset
    
    for truncate operation.
    
    Signed-off-by: xie xingguo <xie.xingguo@zte.com.cn>

diff --git a/src/os/bluestore/BlueStore.cc b/src/os/bluestore/BlueStore.cc
index f09b22faea..25f4885540 100644
--- a/src/os/bluestore/BlueStore.cc
+++ b/src/os/bluestore/BlueStore.cc
@@ -7585,6 +7585,9 @@ int BlueStore::_do_truncate(
 	   << " 0x" << std::hex << offset << std::dec << dendl;
   _dump_onode(o, 30);
 
+  if (offset == o->onode.size)
+    return 0;
+
   if (offset < o->onode.size) {
     // ensure any wal IO has completed before we truncate off any extents
     // they may touch.

