commit 7a4f59d1210fb39fd6abadf2f8af5d34e520b924
Author: Vincent Povirk <vincent@codeweavers.com>
Date:   Fri Oct 4 13:26:32 2013 -0500

    For module handles, only check that rva's are within the image size.
    
    This commit licensed as MIT/X11.

diff --git a/mono/metadata/image.c b/mono/metadata/image.c
index 5b40a125c11..7140a630bad 100644
--- a/mono/metadata/image.c
+++ b/mono/metadata/image.c
@@ -151,7 +151,16 @@ mono_image_rva_map (MonoImage *image, guint32 addr)
 	const int top = iinfo->cli_section_count;
 	MonoSectionTable *tables = iinfo->cli_section_tables;
 	int i;
-	
+
+#ifdef HOST_WIN32
+	if (image->is_module_handle) {
+		if (addr && addr < image->raw_data_len)
+			return image->raw_data + addr;
+		else
+			return NULL;
+	}
+#endif
+
 	for (i = 0; i < top; i++){
 		if ((addr >= tables->st_virtual_address) &&
 		    (addr < tables->st_virtual_address + tables->st_raw_data_size)){
@@ -159,10 +168,6 @@ mono_image_rva_map (MonoImage *image, guint32 addr)
 				if (!mono_image_ensure_section_idx (image, i))
 					return NULL;
 			}
-#ifdef HOST_WIN32
-			if (image->is_module_handle)
-				return image->raw_data + addr;
-#endif
 			return (char*)iinfo->cli_sections [i] +
 				(addr - tables->st_virtual_address);
 		}

