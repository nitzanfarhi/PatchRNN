commit 9a6dbaa452cbab650c7f88e8f70e3c8b7dce09d0
Author: craig.p.drummond <craig.p.drummond@b1e49159-3266-923f-9c3e-04f16369770a>
Date:   Sat Apr 6 07:43:35 2013 +0000

    Check if current is not set

diff --git a/models/playqueuemodel.cpp b/models/playqueuemodel.cpp
index 08e9d33b..0e5c7d30 100644
--- a/models/playqueuemodel.cpp
+++ b/models/playqueuemodel.cpp
@@ -266,7 +266,7 @@ QVariant PlayQueueModel::data(const QModelIndex &index, int role) const
                 case MPDState_Playing: return (int)(stopAfterCurrent ? GroupedView::State_StopAfter : GroupedView::State_Playing);
                 case MPDState_Paused:  return (int)GroupedView::State_Paused;
                 }
-            }  else if (s.id==stopAfterTrackId) {
+            }  else if (-1!=s.id && s.id==stopAfterTrackId) {
                 return GroupedView::State_StopAfterTrack;
             }
         }
@@ -281,7 +281,7 @@ QVariant PlayQueueModel::data(const QModelIndex &index, int role) const
             case MPDState_Playing: return (int)(stopAfterCurrent ? GroupedView::State_StopAfter : GroupedView::State_Playing);
             case MPDState_Paused:  return (int)GroupedView::State_Paused;
             }
-        } else if (id==stopAfterTrackId) {
+        } else if (-1!=id && id==stopAfterTrackId) {
             return GroupedView::State_StopAfterTrack;
         }
         return (int)GroupedView::State_Default;
@@ -383,7 +383,7 @@ QVariant PlayQueueModel::data(const QModelIndex &index, int role) const
                 case MPDState_Playing: return Icon(stopAfterCurrent ? "media-playback-stop" : "media-playback-start");
                 case MPDState_Paused:  return Icon("media-playback-pause");
                 }
-            } else if (id==stopAfterTrackId) {
+            } else if (-1!=id && id==stopAfterTrackId) {
                 return Icon("media-playback-stop");
             }
         }
@@ -636,7 +636,7 @@ void PlayQueueModel::updateCurrentSong(quint32 id)
     currentSongRowNum=getRowById(currentSongId);
     emit dataChanged(index(currentSongRowNum, 0), index(currentSongRowNum, columnCount(QModelIndex())-1));
 
-    if (stopAfterTrackId==currentSongId) {
+    if (-1!=currentSongId && stopAfterTrackId==currentSongId) {
         stopAfterTrackId=-1;
         emit stop(true);
     }

