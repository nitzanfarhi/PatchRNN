commit fcf59764b99c7daa9b0876fe65d1393e6b759673
Author: Philipp Zabel <p.zabel@pengutronix.de>
Date:   Tue Aug 5 14:00:12 2014 -0300

    [media] coda: skip calling coda_find_codec in encoder try_fmt_vid_out
    
    We know that it will return NULL in this case, so we can just as well
    skip it altogether.
    
    Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>
    Signed-off-by: Kamil Debski <k.debski@samsung.com>
    Signed-off-by: Mauro Carvalho Chehab <m.chehab@samsung.com>

diff --git a/drivers/media/platform/coda/coda-common.c b/drivers/media/platform/coda/coda-common.c
index 6760e346f969..4e85e387f905 100644
--- a/drivers/media/platform/coda/coda-common.c
+++ b/drivers/media/platform/coda/coda-common.c
@@ -426,14 +426,15 @@ static int coda_try_fmt_vid_out(struct file *file, void *priv,
 				struct v4l2_format *f)
 {
 	struct coda_ctx *ctx = fh_to_ctx(priv);
-	const struct coda_codec *codec;
+	const struct coda_codec *codec = NULL;
 
 	/* Determine codec by encoded format, returns NULL if raw or invalid */
-	codec = coda_find_codec(ctx->dev, f->fmt.pix.pixelformat,
-				V4L2_PIX_FMT_YUV420);
-	if (!codec && ctx->inst_type == CODA_INST_DECODER) {
-		codec = coda_find_codec(ctx->dev, V4L2_PIX_FMT_H264,
+	if (ctx->inst_type == CODA_INST_DECODER) {
+		codec = coda_find_codec(ctx->dev, f->fmt.pix.pixelformat,
 					V4L2_PIX_FMT_YUV420);
+		if (!codec)
+			codec = coda_find_codec(ctx->dev, V4L2_PIX_FMT_H264,
+						V4L2_PIX_FMT_YUV420);
 		if (!codec)
 			return -EINVAL;
 	}

