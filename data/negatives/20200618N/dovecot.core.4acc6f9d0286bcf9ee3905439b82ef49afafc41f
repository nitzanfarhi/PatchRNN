commit 4acc6f9d0286bcf9ee3905439b82ef49afafc41f
Author: Timo Sirainen <tss@iki.fi>
Date:   Sat Sep 13 14:09:59 2008 +0300

    Transaction view: One more try at really fixing lookup_ext()..
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mail-index-transaction-view.c b/src/lib-index/mail-index-transaction-view.c
index da3aacb0f..d62597ec7 100644
--- a/src/lib-index/mail-index-transaction-view.c
+++ b/src/lib-index/mail-index-transaction-view.c
@@ -224,7 +224,7 @@ tview_return_updated_ext(struct mail_index_view_transaction *tview,
 		}
 	}
 
-	if (ext->record_align <= sizeof(uint32_t)) {
+	if (record_align <= sizeof(uint32_t)) {
 		/* data is 32bit aligned already */
 		return data;
 	} else {
@@ -233,10 +233,9 @@ tview_return_updated_ext(struct mail_index_view_transaction *tview,
 		if (tview->lookup_return_data == NULL) {
 			tview->lookup_return_data =
 				buffer_create_dynamic(default_pool,
-						      ext->record_size + 64);
+						      record_size + 64);
 		}
-		buffer_write(tview->lookup_return_data,
-			     0, data, ext->record_size);
+		buffer_write(tview->lookup_return_data, 0, data, record_size);
 		return tview->lookup_return_data->data;
 	}
 }

