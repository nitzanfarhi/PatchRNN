commit 847ea6059211b1ce104207584a57badf830103d6
Author: Samuel Just <sam.just@inktank.com>
Date:   Fri Oct 25 10:47:28 2013 -0700

    PGLog::read_log: don't add items past backfill line to missing
    
    Fixes: #6574
    Signed-off-by: Samuel Just <sam.just@inktank.com>
    Reviewed-by: Sage Weil <sage@inktank.com>
    Reviewed-by: David Zafman <david.zafman@inktank.com>

diff --git a/src/osd/PGLog.cc b/src/osd/PGLog.cc
index 1949c96fd5..130a8e0778 100644
--- a/src/osd/PGLog.cc
+++ b/src/osd/PGLog.cc
@@ -694,6 +694,7 @@ bool PGLog::read_log(ObjectStore *store, coll_t coll, hobject_t log_oid,
 	 i != log.log.rend();
 	 ++i) {
       if (i->version <= info.last_complete) break;
+      if (i->soid > info.last_backfill) continue;
       if (did.count(i->soid)) continue;
       did.insert(i->soid);
       
@@ -717,6 +718,7 @@ bool PGLog::read_log(ObjectStore *store, coll_t coll, hobject_t log_oid,
 	 i != divergent_priors.rend();
 	 ++i) {
       if (i->first <= info.last_complete) break;
+      if (i->second > info.last_backfill) continue;
       if (did.count(i->second)) continue;
       did.insert(i->second);
       bufferlist bv;

