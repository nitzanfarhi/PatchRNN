commit 47cd974ae539c838b138561f597808baf9181186
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Sun Mar 1 03:13:04 2009 +0000

    Do not set low_delay if has_b_frames has been set before init()
    this will be needed once the parser can figure out has_b_frames
    in av_find_stream_info().
    
    Originally committed as revision 17673 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavcodec/h264.c b/libavcodec/h264.c
index b1c1f7054d..91f20c9867 100644
--- a/libavcodec/h264.c
+++ b/libavcodec/h264.c
@@ -2188,6 +2188,7 @@ static av_cold int decode_init(AVCodecContext *avctx){
     // set defaults
 //    s->decode_mb= ff_h263_decode_mb;
     s->quarter_sample = 1;
+    if(!avctx->has_b_frames)
     s->low_delay= 1;
 
     if(s->avctx->codec->capabilities&CODEC_CAP_HWACCEL_VDPAU)

