commit 4fabe129cc25fb73a8b8bd8f821e11e07048b79f
Author: aland <aland>
Date:   Fri Feb 14 20:39:19 2003 +0000

            If the 'authorize' section has decided to reject the request,
            then don't bother proxying it.  Instead, log a debug message
            saying that the proxy was cancelled.

diff --git a/src/main/proxy.c b/src/main/proxy.c
index b58ba7b9c..a09bfdf22 100644
--- a/src/main/proxy.c
+++ b/src/main/proxy.c
@@ -273,6 +273,15 @@ int proxy_send(REQUEST *request)
 		return RLM_MODULE_NOOP;
 	}
 
+	/*
+	 *	If the server has already decided to reject the request,
+	 *	then don't try to proxy it.
+	 */
+	if (request->reply->code == PW_AUTHENTICATION_REJECT) {
+		DEBUG2("Cancelling proxy as request was already rejected");
+		return RLM_MODULE_REJECT;
+	}
+
 	/*
 	 *	Length == 0 means it exists, but there's no realm.
 	 *	Don't proxy it.

