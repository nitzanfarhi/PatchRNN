commit d4f0f2d1e80b76260eb6b9cdde472ac069dfda56
Author: Anton Khirnov <anton@khirnov.net>
Date:   Fri Nov 29 20:16:07 2013 +0100

    lavc: use buf[0] instead of data[0] as the indicator of an allocated frame
    
    data[0] may be NULL for valid frames with hwaccel pixel formats.

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index 37f4979f6..d1a151085 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -1416,7 +1416,7 @@ int attribute_align_arg avcodec_decode_video2(AVCodecContext *avctx, AVFrame *pi
 
         emms_c(); //needed to avoid an emms_c() call before every return;
 
-        if (ret < 0 && picture->data[0])
+        if (ret < 0 && picture->buf[0])
             av_frame_unref(picture);
 
         if (*got_picture_ptr) {

