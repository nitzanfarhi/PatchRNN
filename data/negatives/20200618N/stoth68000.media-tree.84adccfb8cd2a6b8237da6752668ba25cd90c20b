commit 84adccfb8cd2a6b8237da6752668ba25cd90c20b
Author: Viresh Kumar <viresh.kumar@st.com>
Date:   Thu Mar 24 11:32:15 2011 +0530

    dmaengine/dw_dmac fix: dwc_scan_descriptors must compare first desc address also with llp
    
    dwc_scan_descriptors scans all descriptors from active_list in case transfer is
    not completed.  It compares first_desc->lli.llp, and then all childrens of its
    tx_list. But it doesn't compare its own address, i.e. first_desc->txd.phys, as
    this is what we have initially programmed into the controller register. So this
    causes dma to stop and finish a transfer, which was never started. And thus
    fail.
    
    Signed-off-by: Viresh Kumar <viresh.kumar@st.com>
    Signed-off-by: Vinod Koul <vinod.koul@intel.com>

diff --git a/drivers/dma/dw_dmac.c b/drivers/dma/dw_dmac.c
index 9c25c7d099e4..b15c32ca0efa 100644
--- a/drivers/dma/dw_dmac.c
+++ b/drivers/dma/dw_dmac.c
@@ -304,6 +304,11 @@ static void dwc_scan_descriptors(struct dw_dma *dw, struct dw_dma_chan *dwc)
 	dev_vdbg(chan2dev(&dwc->chan), "scan_descriptors: llp=0x%x\n", llp);
 
 	list_for_each_entry_safe(desc, _desc, &dwc->active_list, desc_node) {
+		/* check first descriptors addr */
+		if (desc->txd.phys == llp)
+			return;
+
+		/* check first descriptors llp */
 		if (desc->lli.llp == llp)
 			/* This one is currently in progress */
 			return;

