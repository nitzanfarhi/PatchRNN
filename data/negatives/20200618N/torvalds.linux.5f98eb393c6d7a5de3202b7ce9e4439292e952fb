commit 5f98eb393c6d7a5de3202b7ce9e4439292e952fb
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Fri Apr 13 10:16:13 2012 +0200

    ab8500_fg: Harden platform data check
    
    If no platform data at all is supplied the driver crashes,
    extend the checks to be more careful so we can compile in the
    driver and boot also without platform data present.
    
    Acked-by: Arun Murthy <arun.murthy@stericsson.com>
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>

diff --git a/drivers/power/ab8500_fg.c b/drivers/power/ab8500_fg.c
index c22f2f05657e..0ebea39e73fe 100644
--- a/drivers/power/ab8500_fg.c
+++ b/drivers/power/ab8500_fg.c
@@ -2462,12 +2462,12 @@ static int __devinit ab8500_fg_probe(struct platform_device *pdev)
 
 	/* get fg specific platform data */
 	plat_data = pdev->dev.platform_data;
-	di->pdata = plat_data->fg;
-	if (!di->pdata) {
+	if (!plat_data || !plat_data->fg) {
 		dev_err(di->dev, "no fg platform data supplied\n");
 		ret = -EINVAL;
 		goto free_device_info;
 	}
+	di->pdata = plat_data->fg;
 
 	/* get battery specific platform data */
 	di->bat = plat_data->battery;

