commit 31915ab4cbf507aadab40847cf9989da5e88b090
Author: Heiko Carstens <heiko.carstens@de.ibm.com>
Date:   Thu Sep 16 14:42:25 2010 +0200

    sched: Remove branch hints within context_switch()
    
    With 710390d9 "sched: Optimize branch hint in context_switch()"
    the branch hint logic within context_switch() got inversed.
    
    In fact the hints "if (likely(!mm))" and "if (likely(!prev->mm))"
    mean that it is likely that the previous and next task are kernel
    threads.
    
    That assumption is certainly counter intuitive, but Tim has shown
    that at least with his workload this is true. Nevertheless the
    truth is: it depends on the current workload. So just remove the
    annotations which also improves readability.
    
    Reported-by: Tim Blechmann <tim@klingt.org>
    Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
    Cc: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Cc: Mike Galbraith <efault@gmx.de>
    LKML-Reference: <20100916124225.GA2209@osiris.boeblingen.de.ibm.com>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/kernel/sched.c b/kernel/sched.c
index b40b82e33590..16a1129f51ec 100644
--- a/kernel/sched.c
+++ b/kernel/sched.c
@@ -2845,14 +2845,14 @@ context_switch(struct rq *rq, struct task_struct *prev,
 	 */
 	arch_start_context_switch(prev);
 
-	if (likely(!mm)) {
+	if (!mm) {
 		next->active_mm = oldmm;
 		atomic_inc(&oldmm->mm_count);
 		enter_lazy_tlb(oldmm, next);
 	} else
 		switch_mm(oldmm, mm, next);
 
-	if (likely(!prev->mm)) {
+	if (!prev->mm) {
 		prev->active_mm = NULL;
 		rq->prev_mm = oldmm;
 	}

