commit 24101488ded13ef7ddcb2c1a25a4452b8b4d581b
Author: Anders Persson <Anders.Persson@Sun.COM>
Date:   Wed Oct 21 19:52:57 2009 -0700

    6861029 sctp retains hold on sockparams in case of peeloff failure

diff --git a/usr/src/uts/common/inet/sockmods/socksctp.c b/usr/src/uts/common/inet/sockmods/socksctp.c
index 581f45e245..cad47ebe14 100644
--- a/usr/src/uts/common/inet/sockmods/socksctp.c
+++ b/usr/src/uts/common/inet/sockmods/socksctp.c
@@ -1693,6 +1693,7 @@ sosctp_ioctl(struct sonode *so, int cmd, intptr_t arg, int mode,
 		 */
 		if ((nfd = ufalloc(0)) == -1) {
 			eprintsoline(so, EMFILE);
+			SOCKPARAMS_DEC_REF(sp);
 			return (EMFILE);
 		}
 
@@ -1782,6 +1783,7 @@ sosctp_ioctl(struct sonode *so, int cmd, intptr_t arg, int mode,
 		return (0);
 
 err:
+		SOCKPARAMS_DEC_REF(sp);
 		setf(nfd, NULL);
 		eprintsoline(so, error);
 		return (error);

