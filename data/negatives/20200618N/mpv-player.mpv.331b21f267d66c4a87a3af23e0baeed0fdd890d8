commit 331b21f267d66c4a87a3af23e0baeed0fdd890d8
Author: wm4 <wm4@nowhere>
Date:   Mon Mar 23 17:41:50 2015 +0100

    encode: make --audio-channels=auto work
    
    Basically requested. Not that anyone cares.

diff --git a/player/main.c b/player/main.c
index b85813a2f7..b3fb14ef10 100644
--- a/player/main.c
+++ b/player/main.c
@@ -444,8 +444,10 @@ int mp_initialize(struct MPContext *mpctx, char **options)
         m_config_set_option0(mpctx->mconfig, "osc", "no");
         m_config_set_option0(mpctx->mconfig, "framedrop", "no");
         // never use auto
-        if (!opts->audio_output_channels.num)
-            m_config_set_option0(mpctx->mconfig, "audio-channels", "stereo");
+        if (!opts->audio_output_channels.num) {
+            m_config_set_option_ext(mpctx->mconfig, bstr0("audio-channels"),
+                                    bstr0("stereo"), M_SETOPT_PRESERVE_CMDLINE);
+        }
         mp_input_enable_section(mpctx->input, "encode", MP_INPUT_EXCLUSIVE);
     }
 #endif

