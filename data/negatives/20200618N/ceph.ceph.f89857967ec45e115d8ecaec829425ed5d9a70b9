commit f89857967ec45e115d8ecaec829425ed5d9a70b9
Author: Mykola Golub <mgolub@mirantis.com>
Date:   Sun Jan 29 22:07:53 2017 +0100

    librbd: add create_async_context_callback helper
    
    Signed-off-by: Mykola Golub <mgolub@mirantis.com>

diff --git a/src/librbd/Utils.h b/src/librbd/Utils.h
index d03da84072..c7cf89e973 100644
--- a/src/librbd/Utils.h
+++ b/src/librbd/Utils.h
@@ -156,6 +156,12 @@ Context *create_async_context_callback(I &image_ctx, Context *on_finish) {
       image_ctx.op_work_queue, on_finish);
 }
 
+template <typename WQ>
+Context *create_async_context_callback(WQ *work_queue, Context *on_finish) {
+  // use async callback to acquire a clean lock context
+  return new detail::C_AsyncCallback<WQ>(work_queue, on_finish);
+}
+
 // TODO: temporary until AioCompletion supports templated ImageCtx
 inline ImageCtx *get_image_ctx(ImageCtx *image_ctx) {
   return image_ctx;

