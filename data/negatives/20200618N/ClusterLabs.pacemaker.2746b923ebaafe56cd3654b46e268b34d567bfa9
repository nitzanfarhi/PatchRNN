commit 2746b923ebaafe56cd3654b46e268b34d567bfa9
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Wed Feb 23 12:20:08 2005 +0000

    Dont accept a DC that has since quit.
    
    CVS patchset: 5139
    CVS date: 2005/02/23 12:20:08
    
    Mercurial revision: 9c856fb9f8b8496a388836c6d5f04691e937c864

diff --git a/crm/crmd/join_client.c b/crm/crmd/join_client.c
index 5bdd6a4fc..f09170080 100644
--- a/crm/crmd/join_client.c
+++ b/crm/crmd/join_client.c
@@ -218,7 +218,14 @@ do_cl_join_result(long long action,
 	if(AM_I_DC == FALSE && safe_str_eq(welcome_from, fsa_our_uname)) {
 		crm_warn("Discarding our own welcome - we're no longer the DC");
 		return I_NULL;
-
+		
+	} else if(g_hash_table_lookup(
+			  fsa_membership_copy->members, welcome_from) == NULL){
+		crm_warn("Discarding welcome from %s."
+			 "  They are no longer part of the cluster",
+			 welcome_from);
+		return I_NULL;
+		
 	} else if(fsa_our_dc == NULL) {
 		crm_info("Set DC to %s", welcome_from);
 		fsa_our_dc = crm_strdup(welcome_from);

