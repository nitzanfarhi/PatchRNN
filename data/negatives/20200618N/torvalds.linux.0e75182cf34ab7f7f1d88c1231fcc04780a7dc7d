commit 0e75182cf34ab7f7f1d88c1231fcc04780a7dc7d
Author: Clemens Ladisch <clemens@ladisch.de>
Date:   Fri Aug 10 09:41:07 2007 +0200

    [ALSA] seq_midi_event: fix parsing of F9/FD bytes
    
    Check for a valid event type when encoding a system real-time message to
    prevent the bytes F9 or FD resulting in an empty sequencer message.
    
    Signed-off-by: Clemens Ladisch <clemens@ladisch.de>
    Signed-off-by: Jaroslav Kysela <perex@suse.cz>

diff --git a/sound/core/seq/seq_midi_event.c b/sound/core/seq/seq_midi_event.c
index a15f5e68e0b6..46416771c9b3 100644
--- a/sound/core/seq/seq_midi_event.c
+++ b/sound/core/seq/seq_midi_event.c
@@ -252,7 +252,7 @@ int snd_midi_event_encode_byte(struct snd_midi_event *dev, int c,
 		ev->type = status_event[ST_SPECIAL + c - 0xf0].event;
 		ev->flags &= ~SNDRV_SEQ_EVENT_LENGTH_MASK;
 		ev->flags |= SNDRV_SEQ_EVENT_LENGTH_FIXED;
-		return 1;
+		return ev->type != SNDRV_SEQ_EVENT_NONE;
 	}
 
 	spin_lock_irqsave(&dev->lock, flags);

