commit 05eff35ac6d64b11f7cdc99740dd26e52cf4f701
Author: Nick Mathewson <nickm@torproject.org>
Date:   Thu Jun 29 11:17:36 2006 +0000

    Harmless: Z_OK is not an acceptable answer to Z_FINISH.
    
    
    svn:r6701

diff --git a/src/common/torgzip.c b/src/common/torgzip.c
index aca8386cc..ec0287077 100644
--- a/src/common/torgzip.c
+++ b/src/common/torgzip.c
@@ -352,7 +352,7 @@ tor_zlib_process(tor_zlib_state_t *state,
         return Z_OK;
       return TOR_ZLIB_BUF_FULL;
     case Z_OK:
-      if (state->stream.avail_out == 0)
+      if (state->stream.avail_out == 0 || finish)
         return TOR_ZLIB_BUF_FULL;
       return TOR_ZLIB_OK;
     default:

