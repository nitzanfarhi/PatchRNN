commit 06e3c077daa08c0a616e9507eb737401883ab645
Author: Aurelien Jarno <aurelien@aurel32.net>
Date:   Mon Jun 15 17:57:03 2015 +0200

    target-s390x: fix setcc in TCG mode
    
    In TCG mode we should store the CC value in env->cc_op. However do it
    inconditionnaly because:
    - the tcg_enabled function is not inlined
    - it's probably faster to always store the value, especially given it
      is likely in the same cache line than env->psw.mask.
    
    Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>
    Signed-off-by: Alexander Graf <agraf@suse.de>

diff --git a/target-s390x/cpu.h b/target-s390x/cpu.h
index c20ef05136..66bd63900a 100644
--- a/target-s390x/cpu.h
+++ b/target-s390x/cpu.h
@@ -709,6 +709,7 @@ static inline void setcc(S390CPU *cpu, uint64_t cc)
 
     env->psw.mask &= ~(3ull << 44);
     env->psw.mask |= (cc & 3) << 44;
+    env->cc_op = cc;
 }
 
 typedef struct LowCore

