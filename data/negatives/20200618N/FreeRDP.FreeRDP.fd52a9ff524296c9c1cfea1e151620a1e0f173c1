commit fd52a9ff524296c9c1cfea1e151620a1e0f173c1
Author: David PHAM-VAN <d.phamvan@inuvika.com>
Date:   Tue Apr 25 11:50:28 2017 -0700

    Bugfix: wrong test regarding the first GetPrinter. This first call will always return FALSE because the goal of this call is to know the size needed.

diff --git a/channels/printer/client/printer_win.c b/channels/printer/client/printer_win.c
index 002d44d2e..665a8519d 100644
--- a/channels/printer/client/printer_win.c
+++ b/channels/printer/client/printer_win.c
@@ -184,7 +184,7 @@ static rdpPrinter* printer_win_new_printer(rdpWinPrinterDriver* win_driver,
 	const WCHAR* name, const WCHAR* drivername, BOOL is_default)
 {
 	rdpWinPrinter* win_printer;
-	DWORD needed;
+	DWORD needed = 0;
 	int status;
 	PRINTER_INFO_2 *prninfo=NULL;
 
@@ -217,7 +217,9 @@ static rdpPrinter* printer_win_new_printer(rdpWinPrinterDriver* win_driver,
 		return NULL;
 	}
 
-	if (!GetPrinter(win_printer->hPrinter, 2, (LPBYTE) prninfo, 0, &needed))
+	/* How many memory should be allocated for printer data */
+	GetPrinter(win_printer->hPrinter, 2, (LPBYTE) prninfo, 0, &needed);
+	if (needed == 0)
 	{
 		free(win_printer->printer.name);
 		free(win_printer);

