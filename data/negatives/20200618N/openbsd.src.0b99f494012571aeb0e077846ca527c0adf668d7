commit 0b99f494012571aeb0e077846ca527c0adf668d7
Author: jfb <jfb@openbsd.org>
Date:   Tue Nov 16 21:03:43 2004 +0000

    more correct error checking, from Joris Vink <amni at pandora dot be>

diff --git a/usr.bin/cvs/proto.c b/usr.bin/cvs/proto.c
index 1acfb788f42..3ebbde34314 100644
--- a/usr.bin/cvs/proto.c
+++ b/usr.bin/cvs/proto.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: proto.c,v 1.26 2004/11/15 04:16:33 jfb Exp $	*/
+/*	$OpenBSD: proto.c,v 1.27 2004/11/16 21:03:43 jfb Exp $	*/
 /*
  * Copyright (c) 2004 Jean-Francois Brousseau <jfb@openbsd.org>
  * All rights reserved.
@@ -440,9 +440,12 @@ cvs_req_getvalid(void)
 
 	len = cvs_buf_size(buf);
 	vrstr = (char *)malloc(len);
+	if (vrstr == NULL) {
+		cvs_buf_free(buf);
+		return (NULL);
+	}
 
 	cvs_buf_copy(buf, 0, vrstr, len);
-
 	cvs_buf_free(buf);
 
 	return (vrstr);
@@ -522,6 +525,10 @@ cvs_resp_getvalid(void)
 
 	len = cvs_buf_size(buf);
 	vrstr = (char *)malloc(len);
+	if (vrstr == NULL) {
+		cvs_buf_free(buf);
+		return (NULL);
+	}
 
 	cvs_buf_copy(buf, 0, vrstr, len);
 	cvs_buf_free(buf);

