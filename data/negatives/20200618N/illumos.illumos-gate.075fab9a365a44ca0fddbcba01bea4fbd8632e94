commit 075fab9a365a44ca0fddbcba01bea4fbd8632e94
Author: Bryan Cantrill <bryan@joyent.com>
Date:   Fri May 16 16:45:10 2014 +0000

    6353 POLLHUP not generated for disconnected Unix domain sockets
    Reviewed by: Gordon Ross <gwr@nexenta.com>
    Reviewed by: Dan McDonald <danmcd@omniti.com>
    Approved by: Garrett D'Amore <garrett@damore.org>

diff --git a/usr/src/uts/common/fs/sockfs/socktpi.c b/usr/src/uts/common/fs/sockfs/socktpi.c
index d33f53f7a6..485e73eb02 100644
--- a/usr/src/uts/common/fs/sockfs/socktpi.c
+++ b/usr/src/uts/common/fs/sockfs/socktpi.c
@@ -6272,6 +6272,13 @@ sotpi_poll(
 	if (sti->sti_conn_ind_head != NULL)
 		*reventsp |= (POLLIN|POLLRDNORM) & events;
 
+	if (so->so_state & SS_CANTRCVMORE) {
+		*reventsp |= POLLRDHUP & events;
+
+		if (so->so_state & SS_CANTSENDMORE)
+			*reventsp |= POLLHUP;
+	}
+
 	if (so->so_state & SS_OOBPEND)
 		*reventsp |= POLLRDBAND & events;
 

