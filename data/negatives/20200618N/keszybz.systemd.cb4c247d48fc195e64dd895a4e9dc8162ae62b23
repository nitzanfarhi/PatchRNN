commit cb4c247d48fc195e64dd895a4e9dc8162ae62b23
Author: Lennart Poettering <lennart@poettering.net>
Date:   Wed Nov 11 16:22:25 2015 +0100

    core: change default deps of services to require sysinit.target instead of basic.target
    
    With this change services by default will no longer require
    basic.target, but instead only after it it via After=basic.target.
    However, they will still Require= on sysinit.target.
    
    This has the benefit that when booting into emergency mode it is
    relatively safe to actviate individual services, as this will not pull
    the entirety of basic.target anymore, thus avoid everything listed in
    sockets.target and suchlike. However, during the usual boot no change
    should be noticed.

diff --git a/src/core/service.c b/src/core/service.c
index 74bbadd3f..a19b98dc5 100644
--- a/src/core/service.c
+++ b/src/core/service.c
@@ -518,12 +518,32 @@ static int service_add_default_dependencies(Service *s) {
         /* Add a number of automatic dependencies useful for the
          * majority of services. */
 
-        /* First, pull in base system */
-        r = unit_add_two_dependencies_by_name(UNIT(s), UNIT_AFTER, UNIT_REQUIRES, SPECIAL_BASIC_TARGET, NULL, true);
+        if (UNIT(s)->manager->running_as == MANAGER_SYSTEM) {
+                /* First, pull in the really early boot stuff, and
+                 * require it, so that we fail if we can't acquire
+                 * it. */
+
+                r = unit_add_two_dependencies_by_name(UNIT(s), UNIT_AFTER, UNIT_REQUIRES, SPECIAL_SYSINIT_TARGET, NULL, true);
+                if (r < 0)
+                        return r;
+        } else {
+
+                /* In the --user instance there's no sysinit.target,
+                 * in that case require basic.target instead. */
+
+                r = unit_add_dependency_by_name(UNIT(s), UNIT_REQUIRES, SPECIAL_BASIC_TARGET, NULL, true);
+                if (r < 0)
+                        return r;
+        }
+
+        /* Second, if the rest of the base system is in the same
+         * transaction, order us after it, but do not pull it in or
+         * even require it. */
+        r = unit_add_dependency_by_name(UNIT(s), UNIT_AFTER, SPECIAL_BASIC_TARGET, NULL, true);
         if (r < 0)
                 return r;
 
-        /* Second, activate normal shutdown */
+        /* Third, add us in for normal shutdown. */
         return unit_add_two_dependencies_by_name(UNIT(s), UNIT_BEFORE, UNIT_CONFLICTS, SPECIAL_SHUTDOWN_TARGET, NULL, true);
 }
 

