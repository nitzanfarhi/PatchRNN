commit 5051f76883897ea3d3d034c92e7b84236da2ec57
Author: Wengang Wang <wen.gang.wang@oracle.com>
Date:   Fri Feb 26 18:18:25 2010 +0800

    ocfs2: send SIGXFSZ if new filesize exceeds limit -v2
    
    This patch makes ocfs2 send SIGXFSZ if new file size exceeds the rlimit.
    Processes may get SIGXFSZ on one node (in the cluster) while others will
    not on another if file size limits are different on the two nodes.
    
    Signed-off-by: Wengang Wang <wen.gang.wang@oracle.com>
    Signed-off-by: Joel Becker <joel.becker@oracle.com>

diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.c
index c8a4a2939e55..5b52547d6299 100644
--- a/fs/ocfs2/file.c
+++ b/fs/ocfs2/file.c
@@ -993,10 +993,9 @@ int ocfs2_setattr(struct dentry *dentry, struct iattr *attr)
 	}
 
 	if (size_change && attr->ia_size != i_size_read(inode)) {
-		if (attr->ia_size > sb->s_maxbytes) {
-			status = -EFBIG;
+		status = inode_newsize_ok(inode, attr->ia_size);
+		if (status)
 			goto bail_unlock;
-		}
 
 		if (i_size_read(inode) > attr->ia_size) {
 			if (ocfs2_should_order_data(inode)) {

