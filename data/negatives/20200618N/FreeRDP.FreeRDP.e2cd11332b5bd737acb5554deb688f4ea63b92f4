commit e2cd11332b5bd737acb5554deb688f4ea63b92f4
Author: Armin Novak <anovak@thinstuff.com>
Date:   Wed Aug 28 17:44:35 2013 +0200

    Fixed coverity issue 1047599

diff --git a/winpr/libwinpr/sspi/NTLM/ntlm.c b/winpr/libwinpr/sspi/NTLM/ntlm.c
index 271a51023..4809935d0 100644
--- a/winpr/libwinpr/sspi/NTLM/ntlm.c
+++ b/winpr/libwinpr/sspi/NTLM/ntlm.c
@@ -43,20 +43,21 @@ char* NTLM_PACKAGE_NAME = "NTLM";
 
 void ntlm_SetContextWorkstation(NTLM_CONTEXT* context, char* Workstation)
 {
+	char *ws = Workstation;
 	DWORD nSize = 0;
 
 	if (!Workstation)
 	{
 		GetComputerNameExA(ComputerNameNetBIOS, NULL, &nSize);
-		Workstation = malloc(nSize);
+		ws = malloc(nSize);
 		GetComputerNameExA(ComputerNameNetBIOS, Workstation, &nSize);
 	}
 
 	context->Workstation.Length = ConvertToUnicode(CP_UTF8, 0,
-			Workstation, -1, &context->Workstation.Buffer, 0) - 1;
+			ws, -1, &context->Workstation.Buffer, 0) - 1;
 	context->Workstation.Length *= 2;
 
-	if (nSize > 0)
+	if (!Workstation)
 		free(Workstation);
 }
 

