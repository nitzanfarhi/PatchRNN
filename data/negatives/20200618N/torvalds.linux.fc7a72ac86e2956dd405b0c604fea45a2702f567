commit fc7a72ac86e2956dd405b0c604fea45a2702f567
Author: nikolay@redhat.com <nikolay@redhat.com>
Date:   Thu Apr 18 07:33:37 2013 +0000

    bonding: disable netpoll on enslave failure
    
    slave_disable_netpoll() is not called upon enslave failure which would
    lead to a memory leak. Call slave_disable_netpoll() after err_detach as
    that's the first error path after enabling netpoll on that slave.
    
    Signed-off-by: Nikolay Aleksandrov <nikolay@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/bonding/bond_main.c b/drivers/net/bonding/bond_main.c
index 1137d5eac450..ae35b28a39e4 100644
--- a/drivers/net/bonding/bond_main.c
+++ b/drivers/net/bonding/bond_main.c
@@ -1920,6 +1920,7 @@ int bond_enslave(struct net_device *bond_dev, struct net_device *slave_dev)
 		write_unlock_bh(&bond->curr_slave_lock);
 		read_unlock(&bond->lock);
 	}
+	slave_disable_netpoll(new_slave);
 
 err_close:
 	slave_dev->priv_flags &= ~IFF_BONDING;

