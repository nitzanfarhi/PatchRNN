commit 8488ae6b57e27e0ed3004982bf3781e8afe4988a
Author: Jonas Oreland <jonas@mysql.com>
Date:   Tue Oct 6 16:03:45 2009 +0200

    ndb - bug#47816 - handle api-fail-req with nodeid > 49

diff --git a/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp b/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp
index ac9cd18481e..3734a6331d0 100644
--- a/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp
+++ b/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp
@@ -3549,9 +3549,9 @@ void Qmgr::handleApiCloseComConf(Signal* signal)
   CloseComReqConf * const closeCom = (CloseComReqConf *)&signal->theData[0];
 
   /* Api failure special case */
-  for(Uint32 nodeId = 0; nodeId < MAX_NDB_NODES; nodeId ++)
+  for(Uint32 nodeId = 0; nodeId < MAX_NODES; nodeId ++)
   {
-    if(NdbNodeBitmask::get(closeCom->theNodes, nodeId))
+    if (NodeBitmask::get(closeCom->theNodes, nodeId))
     {
       jam();
       /* Check that *only* 1 *API* node is included in
@@ -3559,8 +3559,8 @@ void Qmgr::handleApiCloseComConf(Signal* signal)
        */
       ndbrequire(getNodeInfo(nodeId).getType() != NodeInfo::DB);
       ndbrequire(closeCom->noOfNodes == 1);
-      NdbNodeBitmask::clear(closeCom->theNodes, nodeId);
-      ndbrequire(NdbNodeBitmask::isclear(closeCom->theNodes));
+      NodeBitmask::clear(closeCom->theNodes, nodeId);
+      ndbrequire(NodeBitmask::isclear(closeCom->theNodes));
       
       /* Now that we know communication from the failed Api has
        * ceased, we can send the required API_FAILREQ signals

