commit cd94c8bbef8d4b796a7ed4c551355a334604fd36
Author: Eric Paris <eparis@redhat.com>
Date:   Sun Aug 16 21:51:49 2009 -0400

    inotify: tail drop inotify q_overflow events
    
    In f44aebcc the tail drop logic of events with no file backing
    (q_overflow and in_ignored) was reversed so IN_IGNORED events would
    never be tail dropped.  This now means that Q_OVERFLOW events are NOT
    tail dropped.  The fix is to not tail drop IN_IGNORED, but to tail drop
    Q_OVERFLOW.
    
    Signed-off-by: Eric Paris <eparis@redhat.com>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/fs/notify/notification.c b/fs/notify/notification.c
index 74b3cf30bc6b..3816d5750dd5 100644
--- a/fs/notify/notification.c
+++ b/fs/notify/notification.c
@@ -153,6 +153,10 @@ static bool event_compare(struct fsnotify_event *old, struct fsnotify_event *new
 				return true;
 			break;
 		case (FSNOTIFY_EVENT_NONE):
+			if (old->mask & FS_Q_OVERFLOW)
+				return true;
+			else if (old->mask & FS_IN_IGNORED)
+				return false;
 			return false;
 		};
 	}

