commit 3055addadbe9bfb2365006a1c13fd342a8d30d52
Author: Dimitri Sivanich <sivanich@sgi.com>
Date:   Fri Mar 31 02:31:20 2006 -0800

    [PATCH] hrtimer: call get_softirq_time() only when necessary in run_hrtimer_queue()
    
    It seems that run_hrtimer_queue() is calling get_softirq_time() more
    often than it needs to.
    
    With this patch, it only calls get_softirq_time() if there's a
    pending timer.
    
    Signed-off-by: Dimitri Sivanich <sivanich@sgi.com>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/kernel/hrtimer.c b/kernel/hrtimer.c
index 49cbf7cffebd..f181ff4dd32e 100644
--- a/kernel/hrtimer.c
+++ b/kernel/hrtimer.c
@@ -606,6 +606,9 @@ static inline void run_hrtimer_queue(struct hrtimer_base *base)
 {
 	struct rb_node *node;
 
+	if (!base->first)
+		return;
+
 	if (base->get_softirq_time)
 		base->softirq_time = base->get_softirq_time();
 

