commit 43c0364551d3ca0042f6f6a3da701edf1143d62f
Author: Lars-Peter Clausen <lars@metafoo.de>
Date:   Wed Nov 2 09:40:00 2011 +0100

    staging:iio: Make write_event_value callback optional
    
    Some devices have fixed thresholds which can not be modified so make the
    write_event_value callback optional, so the drivers for these devices do not
    have to implement a boilerplate no-op callback.
    
    Signed-off-by: Lars-Peter Clausen <lars@metafoo.de>
    Acked-by: Jonathan Cameron <jic23@cam.ac.uk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/staging/iio/industrialio-core.c b/drivers/staging/iio/industrialio-core.c
index dc2339ae63d0..0b671663b55d 100644
--- a/drivers/staging/iio/industrialio-core.c
+++ b/drivers/staging/iio/industrialio-core.c
@@ -790,6 +790,9 @@ static ssize_t iio_ev_value_store(struct device *dev,
 	unsigned long val;
 	int ret;
 
+	if (!indio_dev->info->write_event_value)
+		return -EINVAL;
+
 	ret = strict_strtoul(buf, 10, &val);
 	if (ret)
 		return ret;

