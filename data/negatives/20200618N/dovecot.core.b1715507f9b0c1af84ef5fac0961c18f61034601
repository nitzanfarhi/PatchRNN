commit b1715507f9b0c1af84ef5fac0961c18f61034601
Author: Timo Sirainen <tss@iki.fi>
Date:   Wed Aug 28 22:09:47 2002 +0300

    Don't fsck mbox every time it's opened.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mbox/mbox-sync.c b/src/lib-index/mbox/mbox-sync.c
index aec3f06ee..bf3009da4 100644
--- a/src/lib-index/mbox/mbox-sync.c
+++ b/src/lib-index/mbox/mbox-sync.c
@@ -126,11 +126,19 @@ int mbox_index_sync(MailIndex *index)
 	if (index->file_sync_stamp == st.st_mtime)
 		return TRUE;
 
-	index->file_sync_stamp = st.st_mtime;
-
 	if (index->mbox_size == 0 && st.st_size != 0)
 		index->mbox_size = get_indexed_mbox_size(index);
 
+	if (index->file_sync_stamp == 0 &&
+	    index->mbox_size == (uoff_t)st.st_size) {
+		/* just opened the mailbox, and the file size is same as
+		   we expected. don't bother checking it any further. */
+		index->file_sync_stamp = st.st_mtime;
+		return TRUE;
+	}
+
+	index->file_sync_stamp = st.st_mtime;
+
 	/* file has been modified. */
 	if (index->mbox_size > (uoff_t)st.st_size) {
 		/* file was grown, hopefully just new mail */

