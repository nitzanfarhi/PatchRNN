commit add46edf33a72b5b3d3af3761d7b372d16769911
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Sun Dec 14 01:36:29 2014 +0100

    avformat/utils: use r_frame_rate only in the demuxer for ff_compute_frame_duration()
    
    This is primarly to maintain current behavior when r_frame_rate is set for muxers
    and could be reverted if it has some advantage
    
    Fixes Ticket3629 part1
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavformat/utils.c b/libavformat/utils.c
index 80e6be9fce..9328d6b0b7 100644
--- a/libavformat/utils.c
+++ b/libavformat/utils.c
@@ -745,7 +745,7 @@ void ff_compute_frame_duration(AVFormatContext *s, int *pnum, int *pden, AVStrea
     *pden = 0;
     switch (st->codec->codec_type) {
     case AVMEDIA_TYPE_VIDEO:
-        if (st->r_frame_rate.num && !pc) {
+        if (st->r_frame_rate.num && !pc && s->iformat) {
             *pnum = st->r_frame_rate.den;
             *pden = st->r_frame_rate.num;
         } else if (st->time_base.num * 1000LL > st->time_base.den) {

