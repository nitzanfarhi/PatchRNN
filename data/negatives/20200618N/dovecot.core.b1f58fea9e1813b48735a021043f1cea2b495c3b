commit b1f58fea9e1813b48735a021043f1cea2b495c3b
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Jun 14 02:11:17 2007 +0300

    Cache decisions weren't updated when doing header lookups.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mail-cache-lookup.c b/src/lib-index/mail-cache-lookup.c
index 2acd14988..cfc1ab146 100644
--- a/src/lib-index/mail-cache-lookup.c
+++ b/src/lib-index/mail-cache-lookup.c
@@ -485,6 +485,9 @@ int mail_cache_lookup_headers(struct mail_cache_view *view, string_t *dest,
 		}
 	}
 
+	for (i = 0; i < fields_count; i++)
+		mail_cache_decision_lookup(view, seq, fields[i]);
+
 	data = buffer_get_modifiable_data(ctx.data, &size);
 	size /= sizeof(*data);
 	qsort(data, size, sizeof(*data), header_lookup_data_cmp);

