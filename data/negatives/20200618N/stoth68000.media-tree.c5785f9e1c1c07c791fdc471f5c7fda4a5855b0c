commit c5785f9e1c1c07c791fdc471f5c7fda4a5855b0c
Author: Nathan Fontenot <nfont@austin.ibm.com>
Date:   Mon Mar 9 00:00:00 2009 +0000

    powerpc/pseries: Failed reconfig notifier chain call cleanup
    
    The return code from invoking the notifier chain when updating the
    ibm,dynamic-memory property is not handled properly. In failure
    cases (rc == NOTIFY_BAD) we should be restoring the original value
    of the property.  In success (rc == NOTIFY_OK) we should be returning
    zero from the calling routine.
    
    Signed-off-by: Nathan Fontenot <nfont@austin.ibm.com>
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>

diff --git a/arch/powerpc/platforms/pseries/reconfig.c b/arch/powerpc/platforms/pseries/reconfig.c
index c591a25b0b0d..b6f1b137d427 100644
--- a/arch/powerpc/platforms/pseries/reconfig.c
+++ b/arch/powerpc/platforms/pseries/reconfig.c
@@ -468,9 +468,13 @@ static int do_update_property(char *buf, size_t bufsize)
 
 		rc = blocking_notifier_call_chain(&pSeries_reconfig_chain,
 						  action, value);
+		if (rc == NOTIFY_BAD) {
+			rc = prom_update_property(np, oldprop, newprop);
+			return -ENOMEM;
+		}
 	}
 
-	return rc;
+	return 0;
 }
 
 /**

