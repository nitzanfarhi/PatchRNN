commit bf3d3e2bb7ae2d3854be57f28dd1403c8f7e4c3c
Author: Michal Schmidt <mschmidt@redhat.com>
Date:   Mon Oct 13 18:14:07 2014 +0200

    hashmap: hashmap_move_one() should return -ENOENT when 'other' is NULL
    
    -ENOENT is the same return value as if 'other' were an allocated hashmap
    that does not contain the key. A NULL hashmap is a possible way of
    expressing a hashmap that contains no key.

diff --git a/src/shared/hashmap.c b/src/shared/hashmap.c
index 4c517059f..c4fde898f 100644
--- a/src/shared/hashmap.c
+++ b/src/shared/hashmap.c
@@ -886,15 +886,15 @@ int hashmap_move_one(Hashmap *h, Hashmap *other, const void *key) {
         unsigned h_hash, other_hash;
         struct hashmap_entry *e;
 
-        if (!other)
-                return 0;
-
         assert(h);
 
         h_hash = bucket_hash(h, key);
         if (hash_scan(h, h_hash, key))
                 return -EEXIST;
 
+        if (!other)
+                return -ENOENT;
+
         other_hash = bucket_hash(other, key);
         e = hash_scan(other, other_hash, key);
         if (!e)

