commit 23df0b731954502a9391e739b92927cee4360343
Author: Arik Nemtsov <arik@wizery.com>
Date:   Sun Jul 21 16:36:48 2013 +0300

    regulatory: use correct regulatory initiator on wiphy register
    
    The current regdomain was not always set by the core. This causes
    cards with a custom regulatory domain to ignore user initiated changes
    if done before the card was registered.
    
    Signed-off-by: Arik Nemtsov <arik@wizery.com>
    Acked-by: Luis R. Rodriguez <mcgrof@do-not-panic.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/wireless/reg.c b/net/wireless/reg.c
index 5a950f36bae4..de06d5d1287f 100644
--- a/net/wireless/reg.c
+++ b/net/wireless/reg.c
@@ -2247,10 +2247,13 @@ int reg_device_uevent(struct device *dev, struct kobj_uevent_env *env)
 
 void wiphy_regulatory_register(struct wiphy *wiphy)
 {
+	struct regulatory_request *lr;
+
 	if (!reg_dev_ignore_cell_hint(wiphy))
 		reg_num_devs_support_basehint++;
 
-	wiphy_update_regulatory(wiphy, NL80211_REGDOM_SET_BY_CORE);
+	lr = get_last_request();
+	wiphy_update_regulatory(wiphy, lr->initiator);
 }
 
 void wiphy_regulatory_deregister(struct wiphy *wiphy)

