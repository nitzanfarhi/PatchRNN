commit 053ab702cc2702f25a97ead087ed344b864785b7
Author: Keith Busch <keith.busch@intel.com>
Date:   Tue Apr 30 11:19:38 2013 -0600

    NVMe: Do not cancel command multiple times
    
    Cancelling an already cancelled command does not do anything, so check
    the command context before cancelling it, continuing if had already been
    cancelled so we do not log the same problem every second if a device
    stops responding.
    
    Signed-off-by: Keith Busch <keith.busch@intel.com>
    Signed-off-by: Matthew Wilcox <matthew.r.wilcox@intel.com>

diff --git a/drivers/block/nvme-core.c b/drivers/block/nvme-core.c
index d783f15e0fc5..42abf72d3884 100644
--- a/drivers/block/nvme-core.c
+++ b/drivers/block/nvme-core.c
@@ -978,6 +978,8 @@ static void nvme_cancel_ios(struct nvme_queue *nvmeq, bool timeout)
 
 		if (timeout && !time_after(now, info[cmdid].timeout))
 			continue;
+		if (info[cmdid].ctx == CMD_CTX_CANCELLED)
+			continue;
 		dev_warn(nvmeq->q_dmadev, "Cancelling I/O %d\n", cmdid);
 		ctx = cancel_cmdid(nvmeq, cmdid, &fn);
 		fn(nvmeq->dev, ctx, &cqe);

