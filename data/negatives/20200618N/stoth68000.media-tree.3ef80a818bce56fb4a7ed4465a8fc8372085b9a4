commit 3ef80a818bce56fb4a7ed4465a8fc8372085b9a4
Author: Ben Widawsky <benjamin.widawsky@intel.com>
Date:   Tue Aug 13 18:09:08 2013 -0700

    drm: WARN when removing unallocated node
    
    The conditional is usually a recoverable driver bug, and so WARNing, and
    preventing the drm_mm code from doing potential damage (BUG) is
    desirable.
    
    This issue was hit and fixed twice while developing the i915 multiple
    address space code. The first fix is the patch just before this, and is
    hit on an not frequently occuring error path. Another was fixed during
    patch iteration, so it's hard to see from the patch:
    
    commit c6cfb325677ea6305fb19acf3a4d14ea267f923e
    Author: Ben Widawsky <ben@bwidawsk.net>
    Date:   Fri Jul 5 14:41:06 2013 -0700
    
        drm/i915: Embed drm_mm_node in i915 gem obj
    
    From the intel-gfx mailing list, we discussed this:
    References: <20130705191235.GA3057@bwidawsk.net>
    
    Cc: Dave Airlie <airlied@redhat.com>
    CC: <dri-devel@lists.freedesktop.org>
    Acked-by: Chris Wilson <chris@chris-wilson.co.uk>
    Signed-off-by: Ben Widawsky <ben@bwidawsk.net>
    Acked-by: Dave Airlie <airlied@redhat.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

diff --git a/drivers/gpu/drm/drm_mm.c b/drivers/gpu/drm/drm_mm.c
index fe304f903b13..feb267f37e21 100644
--- a/drivers/gpu/drm/drm_mm.c
+++ b/drivers/gpu/drm/drm_mm.c
@@ -346,6 +346,9 @@ void drm_mm_remove_node(struct drm_mm_node *node)
 	struct drm_mm *mm = node->mm;
 	struct drm_mm_node *prev_node;
 
+	if (WARN_ON(!node->allocated))
+		return;
+
 	BUG_ON(node->scanned_block || node->scanned_prev_free
 				   || node->scanned_next_free);
 

