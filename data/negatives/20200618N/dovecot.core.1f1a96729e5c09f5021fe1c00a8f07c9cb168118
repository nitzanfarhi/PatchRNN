commit 1f1a96729e5c09f5021fe1c00a8f07c9cb168118
Author: Timo Sirainen <timo.sirainen@dovecot.fi>
Date:   Fri Jan 27 21:36:14 2017 +0200

    lib: io_loop_set_current() - do nothing if ioloop doesn't change
    
    There's no need to call the switch callbacks if the ioloop doesn't change.

diff --git a/src/lib/ioloop.c b/src/lib/ioloop.c
index 214d3c468..98ae5d28a 100644
--- a/src/lib/ioloop.c
+++ b/src/lib/ioloop.c
@@ -779,6 +779,9 @@ void io_loop_set_current(struct ioloop *ioloop)
 	io_switch_callback_t *const *callbackp;
 	struct ioloop *prev_ioloop = current_ioloop;
 
+	if (ioloop == current_ioloop)
+		return;
+
 	current_ioloop = ioloop;
 	if (array_is_created(&io_switch_callbacks)) {
 		array_foreach(&io_switch_callbacks, callbackp)

