commit a5ea952fdd7131309ba2bd52e8f7727b30588d4c
Author: Ali El Gariani <alinkmaze@gmail.com>
Date:   Wed Apr 11 04:32:20 2007 +0000

    Fix a nasty healing bug,
    
    if current HP > max HP, healing removed HP (see mage of test scenario)

diff --git a/src/actions.cpp b/src/actions.cpp
index a07751461e..87f983fd13 100644
--- a/src/actions.cpp
+++ b/src/actions.cpp
@@ -1461,6 +1461,10 @@ void calculate_healing(display& disp, const gamemap& map,
 
 		int pos_max = i->second.max_hitpoints() - i->second.hitpoints();
 		int neg_max = -(i->second.hitpoints() - 1);
+		if(healing > 0 && pos_max <= 0) {
+			// Do not try to "heal" if HP >= max HP
+			continue;
+		}
 		if(healing > pos_max) {
 			healing = pos_max;
 		} else if(healing < neg_max) {

