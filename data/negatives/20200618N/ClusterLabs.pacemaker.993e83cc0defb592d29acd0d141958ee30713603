commit 993e83cc0defb592d29acd0d141958ee30713603
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Tue Mar 16 10:29:45 2004 +0000

    * Deal with the result of "store" operations correctly (make sure they get
      distributed properly)
    
    CVS patchset: 2572
    CVS date: 2004/03/16 10:29:45
    
    Mercurial revision: 6c9655597b06a0f6220306930c5799ee422e9ee5

diff --git a/crm/crmd/fsa.c b/crm/crmd/fsa.c
index 50cbc1ec6..baf1de9a9 100644
--- a/crm/crmd/fsa.c
+++ b/crm/crmd/fsa.c
@@ -996,23 +996,22 @@ handle_message(xmlNodePtr stored_msg)
 			send_request(NULL, data, "store",
 				     NULL, CRM_SYSTEM_CRMD);
 
-		} else if (strcmp(op, "store") == 0) {
+		} else if (AM_I_DC && strcmp(op, "store") == 0) {
 
-			if(AM_I_DC == FALSE) {
-				
-				/* we need to merge these results back
-				 * into the DC
-				 */
-				xmlNodePtr data =
-					find_xml_node(stored_msg,
-						      XML_TAG_FRAGMENT);
-				
-				if(data != NULL) {
-					send_request(NULL, data, "update",
-						     NULL, CRM_SYSTEM_CIB);
-				}
+			/* if there was any result, we need to merge it back
+			 * into our (the DC) copy of the CIB
+			 */
+			xmlNodePtr data = find_xml_node(stored_msg,
+							XML_TAG_FRAGMENT);
+
+			if(data != NULL) {
+				send_request(NULL, data, "update",
+					     NULL, CRM_SYSTEM_CIB);
+				send_request(NULL, NULL, "bump",
+					     NULL, CRM_SYSTEM_CIB);
 			}
 
+
 		} else if(strcmp(sys_from, CRM_SYSTEM_CIB) == 0
 		   && strcmp(op, "forward") == 0
 		   && AM_I_DC) {
@@ -1047,6 +1046,7 @@ handle_message(xmlNodePtr stored_msg)
 			       "Unexpected (response) operation %s", op);
 		}
 	} else {
+		cl_log(LOG_ERR, "Unexpected message type %s", type);
 			
 	}
 		

