commit b7ee3be2d9765ed40f10557f62a151e4426f1e3c
Author: Vic Lee <llyzs@163.com>
Date:   Tue Aug 23 20:37:08 2011 +0800

    server: add server update callback registration.

diff --git a/libfreerdp-core/peer.c b/libfreerdp-core/peer.c
index 2e122732..8493977b 100644
--- a/libfreerdp-core/peer.c
+++ b/libfreerdp-core/peer.c
@@ -242,6 +242,8 @@ freerdp_peer* freerdp_peer_new(int sockfd)
 	client->input = peer->rdp->input;
 	client->update = peer->rdp->update;
 
+	update_register_server_callbacks(client->update);
+
 	transport_attach(peer->rdp->transport, sockfd);
 
 	peer->rdp->transport->recv_callback = peer_recv_callback;
diff --git a/libfreerdp-core/update.c b/libfreerdp-core/update.c
index e3f9d98a..54163639 100644
--- a/libfreerdp-core/update.c
+++ b/libfreerdp-core/update.c
@@ -216,6 +216,21 @@ void update_reset_state(rdpUpdate* update)
 	update->order_info.orderType = ORDER_TYPE_PATBLT;
 }
 
+static void update_begin_paint(rdpUpdate* update)
+{
+	update_reset_state(update);
+}
+
+static void update_end_paint(rdpUpdate* update)
+{
+}
+
+void update_register_server_callbacks(rdpUpdate* update)
+{
+	update->BeginPaint = update_begin_paint;
+	update->EndPaint = update_end_paint;
+}
+
 rdpUpdate* update_new(rdpRdp* rdp)
 {
 	rdpUpdate* update;
diff --git a/libfreerdp-core/update.h b/libfreerdp-core/update.h
index debe664d..5ddef6ac 100644
--- a/libfreerdp-core/update.h
+++ b/libfreerdp-core/update.h
@@ -43,4 +43,6 @@ void update_read_bitmap(rdpUpdate* update, STREAM* s, BITMAP_UPDATE* bitmap_upda
 void update_read_palette(rdpUpdate* update, STREAM* s, PALETTE_UPDATE* palette_update);
 void update_recv(rdpUpdate* update, STREAM* s);
 
+void update_register_server_callbacks(rdpUpdate* update);
+
 #endif /* __UPDATE_H */

