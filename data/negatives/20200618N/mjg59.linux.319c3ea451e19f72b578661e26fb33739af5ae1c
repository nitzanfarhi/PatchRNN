commit 319c3ea451e19f72b578661e26fb33739af5ae1c
Author: Oliver Neukum <oliver@neukum.org>
Date:   Wed Dec 16 19:43:59 2009 +0100

    USB: xhci: No GFP_KERNEL in block error handling
    
    xhci_add_endpoint() is used in the reset path. It must
    use GFP_NOIO to avoid a possible deadlock.
    
    Signed-off-by: Oliver Neukum <oliver@neukum.org>
    Acked-by: Sarah Sharp <sarah.a.sharp@intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/usb/host/xhci-hcd.c b/drivers/usb/host/xhci-hcd.c
index c8573f874ec4..4cb69e0af834 100644
--- a/drivers/usb/host/xhci-hcd.c
+++ b/drivers/usb/host/xhci-hcd.c
@@ -1007,7 +1007,7 @@ int xhci_add_endpoint(struct usb_hcd *hcd, struct usb_device *udev,
 	 * for usb_set_interface() and usb_set_configuration() claim).
 	 */
 	if (xhci_endpoint_init(xhci, xhci->devs[udev->slot_id],
-				udev, ep, GFP_KERNEL) < 0) {
+				udev, ep, GFP_NOIO) < 0) {
 		dev_dbg(&udev->dev, "%s - could not initialize ep %#x\n",
 				__func__, ep->desc.bEndpointAddress);
 		return -ENOMEM;

