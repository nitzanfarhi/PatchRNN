commit f2dda43c9ed4fda9cfa87362514985ee79e0ae15
Author: Sage Weil <sage@inktank.com>
Date:   Wed Mar 27 12:59:41 2013 -0700

    osd: EINVAL when rmw_flags is 0
    
    A broken client (e.g., v0.56) can send a request that ends up with an
    rmw_flags of 0.  Treat this as invalid and return EINVAL.
    
    Fixes: #4556
    Signed-off-by: Sage Weil <sage@inktank.com>

diff --git a/src/osd/OSD.cc b/src/osd/OSD.cc
index 5212377121..6b90579949 100644
--- a/src/osd/OSD.cc
+++ b/src/osd/OSD.cc
@@ -6532,5 +6532,8 @@ int OSD::init_op_flags(OpRequestRef op)
     }
   }
 
+  if (op->rmw_flags == 0)
+    return -EINVAL;
+
   return 0;
 }

