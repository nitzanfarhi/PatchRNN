commit 0c5e3c8850158df63ede0ed8c79998b8997ebf7a
Author: Tim Wickberg <tim@schedmd.com>
Date:   Tue Oct 10 22:34:14 2017 -0600

    Use copy_gids() everywhere else as well.

diff --git a/src/common/group_cache.c b/src/common/group_cache.c
index 8b68d6cda2..23fded2518 100644
--- a/src/common/group_cache.c
+++ b/src/common/group_cache.c
@@ -171,8 +171,7 @@ static int _group_cache_lookup_internal(gids_cache_needle_t *needle, gid_t **gid
 
 out:
 	ngids = entry->ngids;
-	*gids = xmalloc(ngids * sizeof(gid_t));
-	memcpy(*gids, entry->gids, ngids * sizeof(gid_t));
+	*gids = copy_gids(entry->ngids, entry->gids);
 
 	slurm_mutex_unlock(&gids_mutex);
 
diff --git a/src/slurmd/slurmd/req.c b/src/slurmd/slurmd/req.c
index 13b5d7d56a..9ec91bcd23 100644
--- a/src/slurmd/slurmd/req.c
+++ b/src/slurmd/slurmd/req.c
@@ -965,8 +965,7 @@ static int _check_job_credential(launch_tasks_request_msg_t *req,
 	xfree(req->gids);
 	if (arg.ngids) {
 		req->ngids = arg.ngids;
-		req->gids = xmalloc(req->ngids * sizeof(gid_t));
-		memcpy(req->gids, arg.gids, req->ngids * sizeof(gid_t));
+		req->gids = copy_gids(arg.ngids, arg.gids);
 	} else {
 		/*
 		 * The gids were not sent in the cred, or dealing with an older
diff --git a/src/slurmd/slurmstepd/slurmstepd_job.c b/src/slurmd/slurmstepd/slurmstepd_job.c
index e33802074f..3c6af3093e 100644
--- a/src/slurmd/slurmstepd/slurmstepd_job.c
+++ b/src/slurmd/slurmstepd/slurmstepd_job.c
@@ -49,6 +49,7 @@
 #include "src/common/eio.h"
 #include "src/common/fd.h"
 #include "src/common/gres.h"
+#include "src/common/group_cache.h"
 #include "src/common/log.h"
 #include "src/common/macros.h"
 #include "src/common/node_select.h"
@@ -282,8 +283,7 @@ extern stepd_step_rec_t *stepd_step_rec_create(launch_tasks_request_msg_t *msg,
 	job->gid	= (gid_t) msg->gid;
 	job->user_name	= xstrdup(msg->user_name);
 	job->ngids = (int) msg->ngids;
-	job->gids = xmalloc(job->ngids * sizeof(gid_t));
-	memcpy(job->gids, msg->gids, job->ngids * sizeof(gid_t));
+	job->gids = copy_gids(msg->ngids, msg->gids);
 
 	job->cwd	= xstrdup(msg->cwd);
 	job->task_dist	= msg->task_dist;
@@ -492,8 +492,7 @@ batch_stepd_step_rec_create(batch_job_launch_msg_t *msg)
 	job->gid	= (gid_t) msg->gid;
 	job->user_name	= xstrdup(msg->user_name);
 	job->ngids = (int) msg->ngids;
-	job->gids = xmalloc(job->ngids * sizeof(gid_t));
-	memcpy(job->gids, msg->gids, job->ngids * sizeof(gid_t));
+	job->gids = copy_gids(msg->ngids, msg->gids);
 
 	job->profile    = msg->profile;
 

