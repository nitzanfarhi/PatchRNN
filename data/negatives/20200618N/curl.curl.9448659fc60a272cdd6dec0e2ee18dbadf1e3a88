commit 9448659fc60a272cdd6dec0e2ee18dbadf1e3a88
Author: Gunter Knauf <gk@gknw.de>
Date:   Mon Sep 21 22:52:59 2009 +0000

    added support for new SQLite cert database format: added a runtime check for version 3.12.0, and depending on the result add 'sql:' prefix to cert database directory so that newer SQLIte database format works.

diff --git a/lib/nss.c b/lib/nss.c
index dbb9a57fa..d6f3fcd89 100644
--- a/lib/nss.c
+++ b/lib/nss.c
@@ -991,8 +991,11 @@ CURLcode Curl_nss_connect(struct connectdata *conn, int sockindex)
         rv = NSS_NoDB_Init(NULL);
       }
       else {
-        rv = NSS_Initialize(certDir, NULL, NULL, "secmod.db",
-                            NSS_INIT_READONLY);
+        char *certpath = PR_smprintf("%s%s",
+                         NSS_VersionCheck("3.12.0") ? "sql:" : "",
+                         certDir);
+        rv = NSS_Initialize(certpath, "", "", "", NSS_INIT_READONLY);
+        PR_smprintf_free(certpath);
       }
       if(rv != SECSuccess) {
         infof(conn->data, "Unable to initialize NSS database\n");

