commit e41cafa9b624d88eb299a446691efcd7a1f6c77d
Author: Timo Sirainen <tss@iki.fi>
Date:   Sat Sep 1 03:14:11 2007 +0300

    When initial index build wrote dovecot.index file, we assert-crashed.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mail-index.c b/src/lib-index/mail-index.c
index b8b585bd8..192ec5484 100644
--- a/src/lib-index/mail-index.c
+++ b/src/lib-index/mail-index.c
@@ -419,6 +419,7 @@ static bool mail_index_open_files(struct mail_index *index,
 		if (index->indexid == 0) {
 			/* create a new indexid for us */
 			index->indexid = ioloop_time;
+			index->map->hdr.indexid = index->indexid;
 		}
 
 		ret = mail_transaction_log_create(index->log);

