commit 7e246feaaeafbd6a16dec735102823058db21e24
Author: Steve Lime <sdlime@gmail.com>
Date:   Tue Sep 2 02:57:48 2008 +0000

    Added check after malloc/realloc in msAddLineDirectly().
    
    git-svn-id: http://svn.osgeo.org/mapserver/trunk@7893 7532c77e-422f-0410-93f4-f0b67bdd69e2

diff --git a/mapprimitive.c b/mapprimitive.c
index 0b2fc270..90954c3f 100644
--- a/mapprimitive.c
+++ b/mapprimitive.c
@@ -1,5 +1,5 @@
 /******************************************************************************
- * $Id:$
+ * $Id$
  *
  * Project:  MapServer
  * Purpose:  Implementations for rectObj, pointObj, lineObj, shapeObj, etc.
@@ -322,7 +322,12 @@ int msAddLineDirectly(shapeObj *p, lineObj *new_line)
     p->line = (lineObj *) malloc(sizeof(lineObj));
   else
     p->line = (lineObj *) realloc(p->line, (p->numlines+1)*sizeof(lineObj));
-  
+
+  if(!p->line) {
+    msSetError(MS_MEMERR, NULL, "msAddLineDirectly()");
+    return(MS_FAILURE);
+  }
+
   /* Copy the new line onto the end of the extended line array */
   c= p->numlines;
   p->line[c].numpoints = new_line->numpoints;  
@@ -1247,7 +1252,7 @@ labelPathObj* msPolylineLabelPath(shapeObj *p, int min_length, fontSetObj *fonts
   segment_index = line_index = 0;
   total_length = max_line_length = 0.0;
   
-  /* determine longest line */
+  /* determine longest line segment */
   segment_lengths = (double **) malloc(sizeof(double *) * p->numlines);
   for(i=0; i<p->numlines; i++) {
     

