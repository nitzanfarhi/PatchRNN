commit faa2f98f856e89d1afb6e4a91707284d242e816e
Author: Li Zefan <lizf@cn.fujitsu.com>
Date:   Tue Nov 4 16:20:23 2008 +0800

    sched: add sanity check in partition_sched_domains()
    
    Impact: cleanup, add debug check
    
    It's wrong to make dattr_new = NULL if doms_new == NULL, it introduces
    memory leak if dattr_new != NULL. Fortunately dattr_new is always NULL
    in this case. So remove the code and add a sanity check.
    
    Signed-off-by: Li Zefan <lizf@cn.fujitsu.com>
    Acked-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/kernel/sched.c b/kernel/sched.c
index 3cb94fad33ca..213cad5e50aa 100644
--- a/kernel/sched.c
+++ b/kernel/sched.c
@@ -7767,7 +7767,7 @@ match1:
 		ndoms_cur = 0;
 		doms_new = &fallback_doms;
 		cpus_andnot(doms_new[0], cpu_online_map, cpu_isolated_map);
-		dattr_new = NULL;
+		WARN_ON_ONCE(dattr_new);
 	}
 
 	/* Build new domains */

