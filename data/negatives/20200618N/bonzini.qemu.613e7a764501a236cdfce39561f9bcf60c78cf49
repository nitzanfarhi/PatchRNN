commit 613e7a764501a236cdfce39561f9bcf60c78cf49
Author: Bharata B Rao <bharata@linux.vnet.ibm.com>
Date:   Thu Jul 30 20:25:15 2015 +0530

    spapr: Provide an error message when migration fails due to htab_shift mismatch
    
    Include an error message when migration fails due to mismatch in
    htab_shift values at source and target. This should provide a bit more
    verbose message in addition to the current migration failure message
    that reads like:
    
    qemu-system-ppc64: error while loading state for instance 0x0 of device 'spapr/htab'
    
    After this patch, the failure message will look like this:
    
    qemu-system-ppc64: htab_shift mismatch: source 29 target 24
    qemu-system-ppc64: error while loading state for instance 0x0 of device 'spapr/htab'
    
    Signed-off-by: Bharata B Rao <bharata@linux.vnet.ibm.com>
    Signed-off-by: David Gibson <david@gibson.dropbear.id.au>

diff --git a/hw/ppc/spapr.c b/hw/ppc/spapr.c
index 05926a3eb2..dd58eb433a 100644
--- a/hw/ppc/spapr.c
+++ b/hw/ppc/spapr.c
@@ -1329,6 +1329,8 @@ static int htab_load(QEMUFile *f, void *opaque, int version_id)
     if (section_hdr) {
         /* First section, just the hash shift */
         if (spapr->htab_shift != section_hdr) {
+            error_report("htab_shift mismatch: source %d target %d",
+                         section_hdr, spapr->htab_shift);
             return -EINVAL;
         }
         return 0;

