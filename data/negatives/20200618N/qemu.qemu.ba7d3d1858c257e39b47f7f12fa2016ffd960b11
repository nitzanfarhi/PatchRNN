commit ba7d3d1858c257e39b47f7f12fa2016ffd960b11
Author: Alex Bennée <alex.bennee@linaro.org>
Date:   Thu Jan 12 15:02:50 2017 +0000

    cpu_common_reset: wrap TCG specific code in tcg_enabled()
    
    Both the cpu->tb_jmp_cache and SoftMMU TLB structures are only used
    when running TCG code so we might as well skip them for anything else.
    
    Signed-off-by: Alex Bennée <alex.bennee@linaro.org>
    Reviewed-by: Eduardo Habkost <ehabkost@redhat.com>

diff --git a/qom/cpu.c b/qom/cpu.c
index cc51de2a8c..61ee0cb88c 100644
--- a/qom/cpu.c
+++ b/qom/cpu.c
@@ -270,13 +270,15 @@ static void cpu_common_reset(CPUState *cpu)
     cpu->exception_index = -1;
     cpu->crash_occurred = false;
 
-    for (i = 0; i < TB_JMP_CACHE_SIZE; ++i) {
-        atomic_set(&cpu->tb_jmp_cache[i], NULL);
-    }
+    if (tcg_enabled()) {
+        for (i = 0; i < TB_JMP_CACHE_SIZE; ++i) {
+            atomic_set(&cpu->tb_jmp_cache[i], NULL);
+        }
 
 #ifdef CONFIG_SOFTMMU
-    tlb_flush(cpu, 0);
+        tlb_flush(cpu, 0);
 #endif
+    }
 }
 
 static bool cpu_common_has_work(CPUState *cs)

