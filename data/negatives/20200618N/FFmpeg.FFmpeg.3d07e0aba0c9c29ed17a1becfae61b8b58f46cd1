commit 3d07e0aba0c9c29ed17a1becfae61b8b58f46cd1
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Fri Dec 16 18:55:52 2011 +0100

    h264: return the consumed amountg in case of Q264
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/h264.c b/libavcodec/h264.c
index 8a1784f94f..efeadb6b9d 100644
--- a/libavcodec/h264.c
+++ b/libavcodec/h264.c
@@ -4113,7 +4113,7 @@ not_extra:
     if(!(s->flags2 & CODEC_FLAG2_CHUNKS) && !s->current_picture_ptr){
         if (avctx->skip_frame >= AVDISCARD_NONREF ||
             buf_size >= 4 && !memcmp("Q264", buf, 4))
-            return 0;
+            return buf_size;
         av_log(avctx, AV_LOG_ERROR, "no frame!\n");
         return -1;
     }

