commit 5fd992231b0fe47149f5a12d70f48a136ce589db
Author: Luke Dashjr <luke-jr+git@utopios.org>
Date:   Mon May 12 22:46:53 2014 +0000

    bifury: Measure hashes done by nonces found since we cannot tell what generation chip is in use

diff --git a/driver-bifury.c b/driver-bifury.c
index 3eddb151..4293117a 100644
--- a/driver-bifury.c
+++ b/driver-bifury.c
@@ -403,6 +403,7 @@ void bifury_handle_cmd(struct cgpu_info * const dev, const char * const cmd)
 		{
 			const uint32_t work_ntime = be32toh(*(uint32_t*)&work->data[68]);
 			submit_noffset_nonce(thr, work, nonce, ntime - work_ntime);
+			hashes_done2(thr, 0x100000000, NULL);
 		}
 		else
 		if (!jobid)
@@ -439,12 +440,7 @@ void bifury_handle_cmd(struct cgpu_info * const dev, const char * const cmd)
 		HASH_FIND(hh, master_thr->work_list, &jobid, sizeof(jobid), work);
 		if (likely(work))
 		{
-			if (likely(proc))
-			{
-				thr = proc->thr[0];
-				hashes_done2(thr, 0xbd000000, NULL);
-			}
-			else
+			if (unlikely(!proc))
 				applog(LOG_DEBUG, "%s: Unknown chip id: %s",
 				       dev->dev_repr, cmd);
 			if (state->free_after_job)

