commit af71e0fa2e2156bc680893c7f28a01851b055181
Author: Sergey Popov <loonycyborg@gmail.com>
Date:   Thu Jun 23 16:29:05 2011 +0000

    Change network_asio::connection::bytes_to_read_'s type to plain size_t
    
    Since using boost::optional is kinda overkill.

diff --git a/src/gui/dialogs/network_transmission.cpp b/src/gui/dialogs/network_transmission.cpp
index 1a11aa3713..3156ea4433 100644
--- a/src/gui/dialogs/network_transmission.cpp
+++ b/src/gui/dialogs/network_transmission.cpp
@@ -38,7 +38,7 @@ void tnetwork_transmission::pump_monitor::process(events::pump_info&)
 		window_.get().set_retval(twindow::OK);
 	} else {
 		if(connection_.bytes_to_read()) {
-			size_t total = connection_.bytes_to_read().get();
+			size_t total = connection_.bytes_to_read();
 			size_t completed = connection_.bytes_read();
 			find_widget<tprogress_bar>(&(window_.get()), "progress", false)
 				.set_percentage((completed*100)/total);
diff --git a/src/network_asio.cpp b/src/network_asio.cpp
index cb754584f2..f968e7a592 100644
--- a/src/network_asio.cpp
+++ b/src/network_asio.cpp
@@ -31,7 +31,7 @@ connection::connection(const std::string& host, const std::string& service)
 	, write_buf_()
 	, read_buf_()
 	, handshake_response_()
-	, bytes_to_read_()
+	, bytes_to_read_(0)
 	, bytes_read_(0)
 {
 	resolver_.async_resolve(
@@ -142,9 +142,9 @@ std::size_t connection::is_read_complete(
 			bytes_to_read_ = ntohl(data_size.num) + 4;
 		}
 #if BOOST_VERSION >= 103700
-		return bytes_to_read_.get() - bytes_transferred;
+		return bytes_to_read_ - bytes_transferred;
 #else
-		return bytes_to_read_.get() == bytes_transferred;
+		return bytes_to_read_ == bytes_transferred;
 #endif
 	}
 }
@@ -156,7 +156,7 @@ void connection::handle_read(
 	)
 {
 	std::cout << "Read " << bytes_transferred << " bytes.\n";
-	bytes_to_read_.reset();
+	bytes_to_read_ = 0;
 	done_ = true;
 	if(ec && ec != boost::asio::error::eof)
 		throw error(ec);
diff --git a/src/network_asio.hpp b/src/network_asio.hpp
index e0de96729a..7d9570570b 100644
--- a/src/network_asio.hpp
+++ b/src/network_asio.hpp
@@ -75,7 +75,7 @@ class connection
 		std::size_t bytes_transferred,
 		config& response
 		);
-	boost::optional<std::size_t> bytes_to_read_;
+	std::size_t bytes_to_read_;
 	std::size_t bytes_read_;
 
 	public:
@@ -108,7 +108,7 @@ class connection
 	/** True if connected and no high-level operation is in progress */
 	bool done() const { return done_; }
 
-	const boost::optional<std::size_t>& bytes_to_read() const
+	std::size_t bytes_to_read() const
 	{
 		return bytes_to_read_;
 	}

