commit fbaa5e098fbf7ce5d6a0a1beae5081b6c8d79e66
Author: Bert Hubert <bert.hubert@netherlabs.nl>
Date:   Mon Apr 23 18:04:24 2012 +0000

    combine two calls to write() when doing outgoing AXFR, possibly making Microsoft DNS happy.
    
    
    git-svn-id: svn://svn.powerdns.com/pdns/trunk/pdns@2575 d19b8d6e-7fed-0310-83ef-9ca221ded41b

diff --git a/pdns/tcpreceiver.cc b/pdns/tcpreceiver.cc
index a1b550b8e..e1a2fd366 100644
--- a/pdns/tcpreceiver.cc
+++ b/pdns/tcpreceiver.cc
@@ -175,9 +175,9 @@ void connectWithTimeout(int fd, struct sockaddr* remote, size_t socklen)
 
 void TCPNameserver::sendPacket(shared_ptr<DNSPacket> p, int outsock)
 {
-  const string buffer = p->getString();
-  uint16_t len=htons(buffer.length());
-  writenWithTimeout(outsock, &len, 2);
+  uint16_t len=htons(p->getString().length());
+  string buffer((const char*)&len, 2);
+  buffer.append(p->getString());
   writenWithTimeout(outsock, buffer.c_str(), buffer.length());
 }
 

