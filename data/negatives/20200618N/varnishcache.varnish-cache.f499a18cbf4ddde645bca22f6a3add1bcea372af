commit f499a18cbf4ddde645bca22f6a3add1bcea372af
Author: Martin Blix Grydeland <martin@varnish-software.com>
Date:   Thu Jan 9 14:59:22 2014 +0100

    varnishncsa: Don't output ESI subrequests

diff --git a/bin/varnishncsa/varnishncsa.c b/bin/varnishncsa/varnishncsa.c
index a651393e1..1a6900308 100644
--- a/bin/varnishncsa/varnishncsa.c
+++ b/bin/varnishncsa/varnishncsa.c
@@ -739,6 +739,10 @@ dispatch_f(struct VSL_data *vsl, struct VSL_transaction * const pt[],
 	for (t = pt[0]; t != NULL; t = *++pt) {
 		CTX.gen++;
 		if (t->type != VSL_t_req)
+			/* Only look at client requests */
+			continue;
+		if (t->reason == VSL_r_esi)
+			/* Skip ESI requests */
 			continue;
 		CTX.hitmiss = "-";
 		CTX.handling = "-";

