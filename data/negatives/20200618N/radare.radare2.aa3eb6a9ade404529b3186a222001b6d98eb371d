commit aa3eb6a9ade404529b3186a222001b6d98eb371d
Author: pancake <pancake@nopcode.org>
Date:   Wed Sep 20 16:42:28 2017 +0200

    Fix #8573 - Detect D's main

diff --git a/libr/bin/format/mach0/mach0.c b/libr/bin/format/mach0/mach0.c
index 9e1354e35..eb2fe92e0 100644
--- a/libr/bin/format/mach0/mach0.c
+++ b/libr/bin/format/mach0/mach0.c
@@ -2309,6 +2309,10 @@ ut64 MACH0_(get_main)(struct MACH0_(obj_t)* bin) {
 	}
 	for (i = 0; !symbols[i].last; i++) {
 		const char *name = symbols[i].name;
+		if (!strcmp (name, "__Dmain")) {
+			addr = symbols[i].addr;
+			break;
+		}
 		if (strstr (name, "4main") && !strstr (name, "STATIC")) {
 			addr = symbols[i].addr;
 			break;
diff --git a/libr/bin/p/bin_mach0.c b/libr/bin/p/bin_mach0.c
index 34eaea5a3..348902856 100644
--- a/libr/bin/p/bin_mach0.c
+++ b/libr/bin/p/bin_mach0.c
@@ -744,8 +744,9 @@ static RBinAddr* binsym(RBinFile *arch, int sym) {
 	switch (sym) {
 	case R_BIN_SYM_MAIN:
 		addr = MACH0_(get_main) (arch->o->bin_obj);
-		if (!addr || !(ret = R_NEW0 (RBinAddr)))
+		if (!addr || !(ret = R_NEW0 (RBinAddr))) {
 			return NULL;
+		}
 		//if (arch->o->info && arch->o->info->bits == 16) {
 		// align for thumb
 		ret->vaddr = ((addr >>1)<<1);

