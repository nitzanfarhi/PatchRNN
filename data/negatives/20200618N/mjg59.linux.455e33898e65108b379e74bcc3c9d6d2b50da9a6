commit 455e33898e65108b379e74bcc3c9d6d2b50da9a6
Author: Markku Kylanpaa <ext-markku.kylanpaa@nokia.com>
Date:   Wed Apr 20 13:34:55 2011 +0300

    crypto: omap-sham - fix concurrent sha1 calculations
    
    SHA1 accelerator can also be busy. Add -EBUSY status return option and
    return busy status from omap_sham_finup().
    
    Signed-off-by: Markku Kylanpaa <ext-markku.kylanpaa@nokia.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

diff --git a/drivers/crypto/omap-sham.c b/drivers/crypto/omap-sham.c
index 465cde3e4f60..e36032bac2e5 100644
--- a/drivers/crypto/omap-sham.c
+++ b/drivers/crypto/omap-sham.c
@@ -835,7 +835,7 @@ static int omap_sham_finup(struct ahash_request *req)
 	ctx->flags |= FLAGS_FINUP;
 
 	err1 = omap_sham_update(req);
-	if (err1 == -EINPROGRESS)
+	if (err1 == -EINPROGRESS || err1 == -EBUSY)
 		return err1;
 	/*
 	 * final() has to be always called to cleanup resources

