commit cb9efcc588abf3060d194bf4a1da42d54c974a74
Author: Thomas Klausner <wiz@danbala.tuwien.ac.at>
Date:   Sun Apr 23 13:06:06 2006 +0000

    Test idx argument validity.
    
    --HG--
    branch : HEAD

diff --git a/lib/zip_set_file_comment.c b/lib/zip_set_file_comment.c
index f6a7b13..24329fb 100644
--- a/lib/zip_set_file_comment.c
+++ b/lib/zip_set_file_comment.c
@@ -1,5 +1,5 @@
 /*
-  $NiH$
+  $NiH: zip_set_file_comment.c,v 1.1 2006/04/23 00:40:48 wiz Exp $
 
   zip_set_file_comment.c -- set comment for file in archive
   Copyright (C) 2006 Dieter Baron and Thomas Klausner
@@ -45,6 +45,11 @@ zip_set_file_comment(struct zip *za, int idx, const char *comment, int len)
 {
     char *tmpcom;
 
+    if (idx < 0 || idx >= za->nentry) {
+	_zip_error_set(&za->error, ZIP_ER_INVAL, 0);
+	return -1;
+    }
+
     if (len < 0 || len > MAXCOMLEN) {
 	_zip_error_set(&za->error, ZIP_ER_INVAL, 0);
 	return -1;

