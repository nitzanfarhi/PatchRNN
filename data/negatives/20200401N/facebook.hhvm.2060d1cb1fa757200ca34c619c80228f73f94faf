commit 2060d1cb1fa757200ca34c619c80228f73f94faf
Author: hzhao <hzhao@facebook.com>
Date:   Wed Aug 18 16:46:10 2010 -0700

    adding Content-Length for HEAD request
    
    Test Plan:
    [hzhao@dev327 src]$ GET -m HEAD -ed
    "http://www.dev327.snc1.facebook.com/fbplugin/win32/install/Install_Facebook_Plug-In_1.0.4.exe"
      200 OK
      Cache-Control: max-age=2592000
      Connection: close
      Date: Wed, 18 Aug 2010 23:45:54 GMT
      Accept-Ranges: bytes
      Content-Length: 1690032
      Content-Type: application/x-msdownload
      Expires: Fri, 17 Sep 2010 23:45:54 GMT
      Last-Modified: Mon, 05 Jul 2010 15:01:53 GMT
      Client-Date: Wed, 18 Aug 2010 23:45:54 GMT
      Client-Peer: 10.20.9.194:80
      Client-Response-Num: 1
      Content-Disposition: attachment
    
    DiffCamp Revision: 147604
    Reviewed By: macvicar
    Commenters: qixin
    CC: hphp-diffs@lists, macvicar, qixin
    Revert Plan:
    OK

diff --git a/src/runtime/base/server/libevent_transport.cpp b/src/runtime/base/server/libevent_transport.cpp
index 9aa9761342..66eb67186d 100644
--- a/src/runtime/base/server/libevent_transport.cpp
+++ b/src/runtime/base/server/libevent_transport.cpp
@@ -250,6 +250,10 @@ void LibEventTransport::sendImpl(const void *data, int size, int code,
   } else {
     if (m_method != HEAD) {
       evbuffer_add(m_request->output_buffer, data, size);
+    } else {
+      char buf[11];
+      snprintf(buf, sizeof(buf), "%d", size);
+      addHeaderImpl("Content-Length", buf);
     }
     m_server->onResponse(m_workerId, m_request, code);
     m_sendEnded = true;

