commit 8c0f8e2c392c7ab470007881e4fb903011b69110
Author: dtucker <dtucker@openbsd.org>
Date:   Fri Mar 10 02:59:51 2017 +0000

    Validate digest arg in ssh_digest_final; from jjelen at redhat.com via
    bz#2687, ok djm@

diff --git a/usr.bin/ssh/digest-openssl.c b/usr.bin/ssh/digest-openssl.c
index 9346cb7905f..cb02e31edf3 100644
--- a/usr.bin/ssh/digest-openssl.c
+++ b/usr.bin/ssh/digest-openssl.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: digest-openssl.c,v 1.5 2014/12/21 22:27:56 djm Exp $ */
+/* $OpenBSD: digest-openssl.c,v 1.6 2017/03/10 02:59:51 dtucker Exp $ */
 /*
  * Copyright (c) 2013 Damien Miller <djm@mindrot.org>
  *
@@ -141,7 +141,7 @@ ssh_digest_final(struct ssh_digest_ctx *ctx, u_char *d, size_t dlen)
 	const struct ssh_digest *digest = ssh_digest_by_alg(ctx->alg);
 	u_int l = dlen;
 
-	if (dlen > UINT_MAX)
+	if (digest == NULL || dlen > UINT_MAX)
 		return SSH_ERR_INVALID_ARGUMENT;
 	if (dlen < digest->digest_len) /* No truncation allowed */
 		return SSH_ERR_INVALID_ARGUMENT;

