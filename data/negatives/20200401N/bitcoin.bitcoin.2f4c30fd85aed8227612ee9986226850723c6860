commit 2f4c30fd85aed8227612ee9986226850723c6860
Author: Gavin Andresen <gavinandresen@gmail.com>
Date:   Thu Sep 1 18:40:18 2011 -0400

    Fix bad merge: getaccountaddress was broken for new accounts

diff --git a/src/rpc.cpp b/src/rpc.cpp
index ec2bb2a97..4f4342770 100644
--- a/src/rpc.cpp
+++ b/src/rpc.cpp
@@ -379,14 +379,11 @@ CBitcoinAddress GetAccountAddress(string strAccount, bool bForceNew=false)
     // Generate a new key
     if (account.vchPubKey.empty() || bForceNew || bKeyUsed)
     {
-        if (pwalletMain->GetKeyPoolSize() < 1)
-        {
-            if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))
-                throw JSONRPCError(-12, "Error: Keypool ran out, please call keypoolrefill first");
+        if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))
+            throw JSONRPCError(-12, "Error: Keypool ran out, please call keypoolrefill first");
 
-            pwalletMain->SetAddressBookName(CBitcoinAddress(account.vchPubKey), strAccount);
-            walletdb.WriteAccount(strAccount, account);
-        }
+        pwalletMain->SetAddressBookName(CBitcoinAddress(account.vchPubKey), strAccount);
+        walletdb.WriteAccount(strAccount, account);
     }
 
     return CBitcoinAddress(account.vchPubKey);

