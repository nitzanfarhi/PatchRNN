commit d7a28fcd1e8f148e25aa2dee7c4353dd8caba363
Author: Deomid Ryabkov <rojer@cesanta.com>
Date:   Sun Nov 1 01:10:43 2015 +0100

    Fix TCP segmentation bug in LWIP
    
        PUBLISHED_FROM=86e7f8687da3420c58f6b340a4c35b540f49ea1e

diff --git a/platforms/esp8266/lwip/src/core/tcp_out.c b/platforms/esp8266/lwip/src/core/tcp_out.c
index 2d4f55cc..71e348d1 100644
--- a/platforms/esp8266/lwip/src/core/tcp_out.c
+++ b/platforms/esp8266/lwip/src/core/tcp_out.c
@@ -459,7 +459,7 @@ tcp_write(struct tcp_pcb *pcb, const void *arg, u16_t len, u8_t apiflags)
     if (oversize > 0) {
       LWIP_ASSERT("inconsistent oversize vs. space", oversize_used <= space);
       seg = last_unsent;
-      oversize_used = oversize < len ? oversize : len;
+      oversize_used = LWIP_MIN(space, LWIP_MIN(oversize, len));
       pos += oversize_used;
       oversize -= oversize_used;
       space -= oversize_used;

