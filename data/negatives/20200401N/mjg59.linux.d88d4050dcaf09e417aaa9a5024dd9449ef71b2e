commit d88d4050dcaf09e417aaa9a5024dd9449ef71b2e
Author: Jiri Slaby <jslaby@suse.cz>
Date:   Sat Apr 10 22:28:56 2010 +0200

    PM / Hibernate: user.c, fix SNAPSHOT_SET_SWAP_AREA handling
    
    When CONFIG_DEBUG_BLOCK_EXT_DEVT is set we decode the device
    improperly by old_decode_dev and it results in an error while
    hibernating with s2disk.
    
    All users already pass the new device number, so switch to
    new_decode_dev().
    
    Signed-off-by: Jiri Slaby <jslaby@suse.cz>
    Reported-and-tested-by: Jiri Kosina <jkosina@suse.cz>
    Signed-off-by: "Rafael J. Wysocki" <rjw@sisk.pl>

diff --git a/kernel/power/user.c b/kernel/power/user.c
index 4d2289626a84..a8c96212bc1b 100644
--- a/kernel/power/user.c
+++ b/kernel/power/user.c
@@ -420,7 +420,7 @@ static long snapshot_ioctl(struct file *filp, unsigned int cmd,
 			 * User space encodes device types as two-byte values,
 			 * so we need to recode them
 			 */
-			swdev = old_decode_dev(swap_area.dev);
+			swdev = new_decode_dev(swap_area.dev);
 			if (swdev) {
 				offset = swap_area.offset;
 				data->swap = swap_type_of(swdev, offset, NULL);

