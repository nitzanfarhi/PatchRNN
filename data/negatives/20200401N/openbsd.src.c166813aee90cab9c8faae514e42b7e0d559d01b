commit c166813aee90cab9c8faae514e42b7e0d559d01b
Author: aaron <aaron@openbsd.org>
Date:   Tue Oct 17 16:08:52 2000 +0000

    Undo the incorrect fix for my ASIX 88141. Instead of just relying on tx_cnt,
    now we check the TX state in the ISR to make sure we are not transmitting
    when we run mii_tick(). Based on a suggestion by Bill Paul. The dc driver
    should now be ready for some heavy pre-2.8 testing.

diff --git a/sys/dev/ic/dc.c b/sys/dev/ic/dc.c
index 349951abe0b..f82b972653c 100644
--- a/sys/dev/ic/dc.c
+++ b/sys/dev/ic/dc.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: dc.c,v 1.15 2000/10/16 17:08:07 aaron Exp $	*/
+/*	$OpenBSD: dc.c,v 1.16 2000/10/17 16:08:52 aaron Exp $	*/
 
 /*
  * Copyright (c) 1997, 1998, 1999
@@ -1919,7 +1919,8 @@ void dc_tick(xsc)
 		} else {
 			r = CSR_READ_4(sc, DC_ISR);
 			if ((r & DC_ISR_RX_STATE) == DC_RXSTATE_WAIT &&
-			    sc->dc_cdata.dc_tx_prod == 0)
+			    (r & DC_ISR_TX_STATE) == DC_TXSTATE_RESET &&
+			    sc->dc_cdata.dc_tx_cnt == 0)
 				mii_tick(mii);
 			if (!(mii->mii_media_status & IFM_ACTIVE))
 				sc->dc_link = 0;

