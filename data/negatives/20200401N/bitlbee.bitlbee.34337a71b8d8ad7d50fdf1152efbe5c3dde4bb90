commit 34337a71b8d8ad7d50fdf1152efbe5c3dde4bb90
Author: Wilmer van der Gaast <wilmer@gaast.net>
Date:   Sun Feb 18 22:46:21 2007 +0000

    Fixed a possible issue with corrupted .nicks files in text_load().

diff --git a/storage_text.c b/storage_text.c
index 3a11facf..7c29d95a 100644
--- a/storage_text.c
+++ b/storage_text.c
@@ -97,7 +97,7 @@ static storage_status_t text_load ( const char *my_nick, const char* password, i
 	if( !fp ) return STORAGE_NO_SUCH_USER;
 	while( fscanf( fp, "%s %d %s", s, &proto, nick ) > 0 )
 	{
-		if( ( acc = acc_lookup[proto] ) == NULL )
+		if( proto < 0 || proto > 8 || ( acc = acc_lookup[proto] ) == NULL )
 			continue;
 		
 		http_decode( s );

