commit 48f11240b112caa519c23380b6b20723596ec85d
Author: Charles Dang <exodia339@gmail.com>
Date:   Mon Mar 30 22:19:37 2015 +1100

    Fixup d9a63b1c3097
    
    Turns out we want to invalidate both before and after handling shroud

diff --git a/src/scripting/game_lua_kernel.cpp b/src/scripting/game_lua_kernel.cpp
index deb08584ee..6338cd41a6 100644
--- a/src/scripting/game_lua_kernel.cpp
+++ b/src/scripting/game_lua_kernel.cpp
@@ -3501,6 +3501,8 @@ int game_lua_kernel::intf_redraw(lua_State *L)
 		vconfig cfg(luaW_checkvconfig(L, 1));
 		bool clear_shroud(luaW_toboolean(L, 2));
 
+		// We do this twice so any applicable redraws happen both before and after
+		// any events caused by redrawing shroud are fired
 		bool result = screen.maybe_rebuild();
 		if (!result) {
 			screen.invalidate_all();
@@ -3514,6 +3516,11 @@ int game_lua_kernel::intf_redraw(lua_State *L)
 			screen.recalculate_minimap();
 		}
 
+		result = screen.maybe_rebuild();
+		if (!result) {
+			screen.invalidate_all();
+		}
+
 		screen.draw(true,true);
 	}
 	return 0;

