commit a057082cd1df8fcf58d43b5783ba5bfce3a61184
Author: Shawn Webb <swebb@sourcefire.com>
Date:   Tue Nov 20 10:39:37 2012 -0500

    bb1636 - utf-16be detection

diff --git a/libclamav/textdet.c b/libclamav/textdet.c
index b9361f42b..4df50ad4e 100644
--- a/libclamav/textdet.c
+++ b/libclamav/textdet.c
@@ -142,7 +142,7 @@ static int td_isutf8(const unsigned char *buf, unsigned int len)
 
 static int td_isutf16(const unsigned char *buf, unsigned int len)
 {
-	unsigned int be = 1, nobom = 0, i, c, bad = 0;
+	unsigned int be = 1, nobom = 0, i, c, bad = 0, high = 0;
 
 
     if(len < 2)
@@ -169,9 +169,14 @@ static int td_isutf16(const unsigned char *buf, unsigned int len)
 		return 0;
 	    else
 		bad++;
-	}
+	} else if (c >= 128) {
+        high++;
+    }
     }
 
+    if (nobom && high >= len / 4)
+        return 0;
+
     if(!nobom && bad >= len / 2)
 	return 0;
 

