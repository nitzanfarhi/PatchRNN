commit 78342da3682ec843e3e6301af5c723c88a46c408
Author: Vasu Dev <vasu.dev@intel.com>
Date:   Fri Feb 27 10:54:46 2009 -0800

    [SCSI] libfc: handle RRQ exch timeout
    
    Cleanup exchange held due to RRQ when RRQ exch times out, in this case the
    ABTS is already done causing RRQ req therefore proceeding with cleanup in
    fc_exch_rrq_resp should be okay to restore exch resource.
    
    Signed-off-by: Vasu Dev <vasu.dev@intel.com>
    Signed-off-by: Robert Love <robert.w.love@intel.com>
    Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>

diff --git a/drivers/scsi/libfc/fc_exch.c b/drivers/scsi/libfc/fc_exch.c
index a09416fd843c..e874e77b740c 100644
--- a/drivers/scsi/libfc/fc_exch.c
+++ b/drivers/scsi/libfc/fc_exch.c
@@ -1608,7 +1608,7 @@ static void fc_exch_rrq_resp(struct fc_seq *sp, struct fc_frame *fp, void *arg)
 	if (IS_ERR(fp)) {
 		int err = PTR_ERR(fp);
 
-		if (err == -FC_EX_CLOSED)
+		if (err == -FC_EX_CLOSED || err == -FC_EX_TIMEOUT)
 			goto cleanup;
 		FC_DBG("Cannot process RRQ, because of frame error %d\n", err);
 		return;

