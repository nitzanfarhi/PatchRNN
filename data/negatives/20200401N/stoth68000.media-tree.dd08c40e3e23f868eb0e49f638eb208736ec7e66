commit dd08c40e3e23f868eb0e49f638eb208736ec7e66
Author: Christoph Lameter <clameter@sgi.com>
Date:   Sat Jun 16 10:15:57 2007 -0700

    SLUB slab validation: Alloc while interrupts are disabled must use GFP_ATOMIC
    
    The data structure to manage the information gathered about functions
    allocating and freeing objects is allocated when the list_lock has already
    been taken.  We need to allocate with GFP_ATOMIC instead of GFP_KERNEL.
    
    Signed-off-by: Christoph Lameter <clameter@sgi.com>
    Cc: Mel Gorman <mel@csn.ul.ie>
    Cc: Andy Whitcroft <apw@shadowen.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/mm/slub.c b/mm/slub.c
index c9ab68881b43..2a1338c516fc 100644
--- a/mm/slub.c
+++ b/mm/slub.c
@@ -2867,7 +2867,7 @@ static int alloc_loc_track(struct loc_track *t, unsigned long max)
 
 	order = get_order(sizeof(struct location) * max);
 
-	l = (void *)__get_free_pages(GFP_KERNEL, order);
+	l = (void *)__get_free_pages(GFP_ATOMIC, order);
 
 	if (!l)
 		return 0;

