commit 46333e375f3228196e8cb741d817165f9793b46c
Author: David Woodhouse <David.Woodhouse@intel.com>
Date:   Mon Mar 10 20:01:21 2014 -0700

    iommu/vt-d: Remove to_pci_dev() in intel_map_page()
    
    It might not be...
    
    Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>

diff --git a/drivers/iommu/intel-iommu.c b/drivers/iommu/intel-iommu.c
index 37ce54b188f3..0a8e166a57b0 100644
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@ -3023,7 +3023,7 @@ static dma_addr_t intel_map_page(struct device *dev, struct page *page,
 				 struct dma_attrs *attrs)
 {
 	return __intel_map_single(dev, page_to_phys(page) + offset, size,
-				  dir, to_pci_dev(dev)->dma_mask);
+				  dir, *dev->dma_mask);
 }
 
 static void flush_unmaps(void)

