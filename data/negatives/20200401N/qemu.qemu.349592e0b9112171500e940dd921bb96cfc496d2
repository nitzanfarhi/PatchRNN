commit 349592e0b9112171500e940dd921bb96cfc496d2
Author: Jeff Cody <jcody@redhat.com>
Date:   Wed Aug 6 15:54:57 2014 -0400

    block: vhdx - add error check
    
    This add an error check for an invalid descriptor entry signature,
    when flushing the log descriptor entries.
    
    Signed-off-by: Jeff Cody <jcody@redhat.com>
    Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
    Signed-off-by: Kevin Wolf <kwolf@redhat.com>

diff --git a/block/vhdx-log.c b/block/vhdx-log.c
index a77c040ee0..7c2630d659 100644
--- a/block/vhdx-log.c
+++ b/block/vhdx-log.c
@@ -435,6 +435,11 @@ static int vhdx_log_flush_desc(BlockDriverState *bs, VHDXLogDescriptor *desc,
         /* write 'count' sectors of sector */
         memset(buffer, 0, VHDX_LOG_SECTOR_SIZE);
         count = desc->zero_length / VHDX_LOG_SECTOR_SIZE;
+    } else {
+        error_report("Invalid VHDX log descriptor entry signature 0x%" PRIx32,
+                      desc->signature);
+        ret = -EINVAL;
+        goto exit;
     }
 
     file_offset = desc->file_offset;

