commit a5c3034fa7089ae680b3b95da33936870f7b493f
Author: Lennart Poettering <lennart@poettering.net>
Date:   Fri Aug 24 23:00:13 2012 +0200

    swap: refuse start/stop of swaps in container

diff --git a/src/core/swap.c b/src/core/swap.c
index cd4d9ab3d..41ece2708 100644
--- a/src/core/swap.c
+++ b/src/core/swap.c
@@ -39,6 +39,7 @@
 #include "exit-status.h"
 #include "def.h"
 #include "path-util.h"
+#include "virt.h"
 
 static const UnitActiveState state_translation_table[_SWAP_STATE_MAX] = {
         [SWAP_DEAD] = UNIT_INACTIVE,
@@ -797,6 +798,9 @@ static int swap_start(Unit *u) {
 
         assert(s->state == SWAP_DEAD || s->state == SWAP_FAILED);
 
+        if (detect_container(NULL) > 0)
+                return -EPERM;
+
         s->result = SWAP_SUCCESS;
         swap_enter_activating(s);
         return 0;
@@ -817,6 +821,9 @@ static int swap_stop(Unit *u) {
         assert(s->state == SWAP_ACTIVATING ||
                s->state == SWAP_ACTIVE);
 
+        if (detect_container(NULL) > 0)
+                return -EPERM;
+
         swap_enter_deactivating(s);
         return 0;
 }

