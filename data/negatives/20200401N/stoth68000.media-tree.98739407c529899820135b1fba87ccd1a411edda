commit 98739407c529899820135b1fba87ccd1a411edda
Author: Christoph Hellwig <hch@lst.de>
Date:   Wed May 16 16:58:00 2007 -0500

    spidernet: node-aware skbuff allocation
    
    Spidernet was the driver I original did all the node-aware netdevice
    allocation for, but after a year it still hasn't hit mainline.
    
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Linas Vepstas <linas@austin.ibm.com>
    Signed-off-by: Jeff Garzik <jeff@garzik.org>

diff --git a/drivers/net/spider_net.c b/drivers/net/spider_net.c
index 108adbf5b5eb..c3964c3d89d9 100644
--- a/drivers/net/spider_net.c
+++ b/drivers/net/spider_net.c
@@ -430,7 +430,8 @@ spider_net_prepare_rx_descr(struct spider_net_card *card,
 	/* and we need to have it 128 byte aligned, therefore we allocate a
 	 * bit more */
 	/* allocate an skb */
-	descr->skb = dev_alloc_skb(bufsize + SPIDER_NET_RXBUF_ALIGN - 1);
+	descr->skb = netdev_alloc_skb(card->netdev,
+				      bufsize + SPIDER_NET_RXBUF_ALIGN - 1);
 	if (!descr->skb) {
 		if (netif_msg_rx_err(card) && net_ratelimit())
 			pr_err("Not enough memory to allocate rx buffer\n");

