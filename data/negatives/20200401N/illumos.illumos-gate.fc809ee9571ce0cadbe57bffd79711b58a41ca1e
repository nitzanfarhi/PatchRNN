commit fc809ee9571ce0cadbe57bffd79711b58a41ca1e
Author: Paul Wernau <Paul.Wernau@Sun.COM>
Date:   Thu Apr 9 13:42:51 2009 -0400

    6821108 DR and "showdevices" don't work after XSCF reboot

diff --git a/usr/src/uts/common/inet/ip/sadb.c b/usr/src/uts/common/inet/ip/sadb.c
index eff4dfc0f8..ca9f8b5cbd 100644
--- a/usr/src/uts/common/inet/ip/sadb.c
+++ b/usr/src/uts/common/inet/ip/sadb.c
@@ -2794,7 +2794,8 @@ sadb_delget_sa(mblk_t *mp, keysock_in_t *ksi, sadbp_t *spp,
 		}
 		if (ipsapp->ipsap_psa_ptr != NULL) {
 			mutex_enter(&ipsapp->ipsap_psa_ptr->ipsa_lock);
-			if (sadb_msg_type == SADB_X_DELPAIR) {
+			if (sadb_msg_type == SADB_X_DELPAIR ||
+			    ipsapp->ipsap_psa_ptr->ipsa_haspeer) {
 				if (ipsapp->ipsap_psa_ptr->ipsa_flags &
 				    IPSA_F_INBOUND) {
 					sadb_delete_cluster(

