commit bea1e03135852a4c62e6f378832a49a241c3297e
Author: Sage Weil <sage@inktank.com>
Date:   Thu May 24 14:07:36 2012 -0700

    filestore: verify that op_seq is nonzero
    
    If we get zero from commit_op_seq something is very wrong, and we should
    not continue.  Broken mkfs or something deleted commit_op_seq file.
    
    Signed-off-by: Sage Weil <sage@inktank.com>

diff --git a/src/os/FileStore.cc b/src/os/FileStore.cc
index aee914787b..330adfd5df 100644
--- a/src/os/FileStore.cc
+++ b/src/os/FileStore.cc
@@ -1799,6 +1799,11 @@ int FileStore::mount()
   }
 
   dout(5) << "mount op_seq is " << initial_op_seq << dendl;
+  if (initial_op_seq == 0) {
+    derr << "mount initial op seq is 0; something is wrong" << dendl;
+    ret = -EINVAL;
+    goto close_current_fd;
+  }
 
   if (!btrfs_stable_commits) {
     // mark current/ as non-snapshotted so that we don't rollback away

