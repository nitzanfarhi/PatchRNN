commit 2a0c9bd0e79d9d36f3656bd980283786d32432ff
Author: Bill Qu <bill.qu@Oracle.com>
Date:   Mon Jan 28 13:44:26 2013 +0800

    wl#6501  Resolved assertion failure recv_sys->n_addrs > 0 in file buf0rea.cc

diff --git a/storage/innobase/buf/buf0dblwr.cc b/storage/innobase/buf/buf0dblwr.cc
index fb853fe1543..15fa4ee686b 100644
--- a/storage/innobase/buf/buf0dblwr.cc
+++ b/storage/innobase/buf/buf0dblwr.cc
@@ -451,12 +451,16 @@ buf_dblwr_init_or_restore_pages(
 
 		} else if (!fil_check_adress_in_tablespace(space_id,
 							   page_no)) {
-			ib_logf(IB_LOG_LEVEL_WARN,
-				"A page in the doublewrite buffer is not "
-				"within space bounds; space id %lu "
-				"page number %lu, page %lu in "
-				"doublewrite buf.",
-				(ulong) space_id, (ulong) page_no, (ulong) i);
+			/* Do not report the warning if the tablespace is
+			truncated as it's reasonable */
+			if (!fil_space_is_truncated(space_id)) {
+				ib_logf(IB_LOG_LEVEL_WARN,
+					"A page in the doublewrite buffer is "
+					"not within space bounds; space id %lu "
+					"page number %lu, page %lu in "
+					"doublewrite buf.",
+					(ulong) space_id, (ulong) page_no, (ulong) i);
+			}
 
 		} else if (space_id == TRX_SYS_SPACE
 			   && ((page_no >= block1
diff --git a/storage/innobase/buf/buf0rea.cc b/storage/innobase/buf/buf0rea.cc
index 0c097a9372a..af961636886 100644
--- a/storage/innobase/buf/buf0rea.cc
+++ b/storage/innobase/buf/buf0rea.cc
@@ -201,10 +201,12 @@ buf_read_page_low(
 			truncated tablespace bounds when recovering
 			from a crash happened during a truncation */
 			buf_read_page_handle_error(bpage);
-			mutex_enter(&recv_sys->mutex);
-			ut_ad(recv_sys->n_addrs > 0);
-			recv_sys->n_addrs--;
-			mutex_exit(&recv_sys->mutex);
+			if (recv_recovery_on) {
+				mutex_enter(&recv_sys->mutex);
+				ut_ad(recv_sys->n_addrs > 0);
+				recv_sys->n_addrs--;
+				mutex_exit(&recv_sys->mutex);
+			}
 			return(0);
 		} else if (ignore_nonexistent_pages
 			   || *err == DB_TABLESPACE_DELETED) {

