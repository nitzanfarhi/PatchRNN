commit 8382f5f0018b715a884c5e6a87f32a3617d84740
Author: Johan Danielsson <joda@pdc.kth.se>
Date:   Thu Jun 21 14:55:51 2001 +0000

    add generation number code
    
    
    git-svn-id: svn://svn.h5l.se/heimdal/trunk/heimdal@10161 ec53bebd-3082-4978-b11e-865c3cabbd6b

diff --git a/lib/hdb/common.c b/lib/hdb/common.c
index 55e07c10b..d68aab4a9 100644
--- a/lib/hdb/common.c
+++ b/lib/hdb/common.c
@@ -125,6 +125,17 @@ _hdb_store(krb5_context context, HDB *db, unsigned flags, hdb_entry *entry)
     krb5_data key, value;
     int code;
 
+    if(entry->generation == NULL) {
+	struct timeval t;
+	entry->generation = malloc(sizeof(*entry->generation));
+	if(entry->generation == NULL)
+	    return ENOMEM;
+	gettimeofday(&t, NULL);
+	entry->generation->time = t.tv_sec;
+	entry->generation->usec = t.tv_usec;
+	entry->generation->gen = 0;
+    } else
+	entry->generation->gen++;
     hdb_principal2key(context, entry->principal, &key);
     code = hdb_seal_keys(context, db, entry);
     if (code) {

