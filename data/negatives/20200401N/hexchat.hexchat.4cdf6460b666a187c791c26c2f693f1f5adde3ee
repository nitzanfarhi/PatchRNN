commit 4cdf6460b666a187c791c26c2f693f1f5adde3ee
Author: Patrick Griffis <tingping@tingping.se>
Date:   Fri Jan 19 04:29:07 2018 -0500

    xtext: Fix invalid utf-8 from truncation

diff --git a/src/fe-gtk/xtext.c b/src/fe-gtk/xtext.c
index 1798647e..fef00c51 100644
--- a/src/fe-gtk/xtext.c
+++ b/src/fe-gtk/xtext.c
@@ -4718,10 +4718,8 @@ gtk_xtext_append (xtext_buffer *buf, unsigned char *text, int len, time_t stamp)
 
 	ent = g_malloc (len + 1 + sizeof (textentry));
 	ent->str = (unsigned char *) ent + sizeof (textentry);
-	ent->str_len = len;
-	if (len)
-		memcpy (ent->str, text, len);
-	ent->str[len] = 0;
+	safe_strcpy (ent->str, text, len);
+	ent->str_len = strlen (ent->str); /* Possibly truncated */
 	ent->indent = 0;
 	ent->left_len = -1;
 

