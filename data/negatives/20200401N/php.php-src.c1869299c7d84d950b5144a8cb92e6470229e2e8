commit c1869299c7d84d950b5144a8cb92e6470229e2e8
Author: Marcus Boerger <helly@php.net>
Date:   Mon Nov 7 19:12:37 2005 +0000

    - heredoc handling in -a mode

diff --git a/sapi/cli/php_cli_readline.c b/sapi/cli/php_cli_readline.c
index 53d062be2d..1abc5bc93f 100644
--- a/sapi/cli/php_cli_readline.c
+++ b/sapi/cli/php_cli_readline.c
@@ -217,8 +217,11 @@ int cli_is_valid_code(char *code, int len, char **prompt TSRMLS_DC)
 				}
 				break;
 			case heredoc:
-				if (code[i - (heredoc_len + 1)] == '\n' && !strncmp(code + i - heredoc_len, heredoc_tag, heredoc_len)) {
+				if (code[i - (heredoc_len + 1)] == '\n' && !strncmp(code + i - heredoc_len, heredoc_tag, heredoc_len) && code[i] == '\n') {
 					code_type = body;
+				} else if (code[i - (heredoc_len + 2)] == '\n' && !strncmp(code + i - heredoc_len - 1, heredoc_tag, heredoc_len) && code[i-1] == ';' && code[i] == '\n') {
+					code_type = body;
+					valid_end = 1;
 				}
 				break;
 			case outside:

