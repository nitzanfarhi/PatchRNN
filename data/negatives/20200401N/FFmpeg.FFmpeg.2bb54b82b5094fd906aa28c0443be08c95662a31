commit 2bb54b82b5094fd906aa28c0443be08c95662a31
Author: Michael Niedermayer <michael@niedermayer.cc>
Date:   Fri Aug 21 02:49:21 2015 +0200

    avcodec/h264_mp4toannexb_bsf: Reorder operations in nal_size check
    
    Fixes Ticket4778
    
    Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>

diff --git a/libavcodec/h264_mp4toannexb_bsf.c b/libavcodec/h264_mp4toannexb_bsf.c
index 1693989977..a5da84a7af 100644
--- a/libavcodec/h264_mp4toannexb_bsf.c
+++ b/libavcodec/h264_mp4toannexb_bsf.c
@@ -201,7 +201,7 @@ static int h264_mp4toannexb_filter(AVBitStreamFilterContext *bsfc,
         buf      += ctx->length_size;
         unit_type = *buf & 0x1f;
 
-        if (buf + nal_size > buf_end || nal_size < 0)
+        if (nal_size > buf_end - buf || nal_size < 0)
             goto fail;
 
         if (unit_type == 7)

