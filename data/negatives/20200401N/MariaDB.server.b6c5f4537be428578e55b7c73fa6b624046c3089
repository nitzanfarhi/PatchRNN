commit b6c5f4537be428578e55b7c73fa6b624046c3089
Author: Sunny Bains <Sunny.Bains@Oracle.Com>
Date:   Fri Aug 20 12:55:52 2010 +1000

    Fix bug#55699 - Assertion failure in innodb plugin with large number of threads
    
    Fix a debug assertion that was missed in svnrev:2380 (fix for Bug# 35352).
    
    Approved by Marko on IRC

diff --git a/storage/innodb_plugin/trx/trx0undo.c b/storage/innodb_plugin/trx/trx0undo.c
index 3bb1b1cdf6c..eb5112c4d31 100644
--- a/storage/innodb_plugin/trx/trx0undo.c
+++ b/storage/innodb_plugin/trx/trx0undo.c
@@ -1938,7 +1938,8 @@ trx_undo_update_cleanup(
 
 		UT_LIST_ADD_FIRST(undo_list, rseg->update_undo_cached, undo);
 	} else {
-		ut_ad(undo->state == TRX_UNDO_TO_PURGE);
+		ut_ad(undo->state == TRX_UNDO_TO_PURGE
+		      || undo->state == TRX_UNDO_TO_FREE);
 
 		trx_undo_mem_free(undo);
 	}

