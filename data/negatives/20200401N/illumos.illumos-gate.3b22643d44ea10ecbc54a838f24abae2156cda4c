commit 3b22643d44ea10ecbc54a838f24abae2156cda4c
Author: Jan Setje-Eilers <Jan.Setje-Eilers@Sun.COM>
Date:   Sat Nov 15 10:53:41 2008 -0800

    6771858 sd/cmdk: devid is not published until reboot if initial label is created with DKIOCSEXTVTOC

diff --git a/usr/src/uts/common/io/scsi/targets/sd.c b/usr/src/uts/common/io/scsi/targets/sd.c
index 559eda7861..3896784792 100644
--- a/usr/src/uts/common/io/scsi/targets/sd.c
+++ b/usr/src/uts/common/io/scsi/targets/sd.c
@@ -21468,7 +21468,8 @@ skip_ready_valid:
 		if ((err == 0) &&
 		    ((cmd == DKIOCSETEFI) ||
 		    (un->un_f_pkstats_enabled) &&
-		    (cmd == DKIOCSAPART || cmd == DKIOCSVTOC))) {
+		    (cmd == DKIOCSAPART || cmd == DKIOCSVTOC ||
+		    cmd == DKIOCSEXTVTOC))) {
 
 			tmprval = cmlb_validate(un->un_cmlbhandle, CMLB_SILENT,
 			    (void *)SD_PATH_DIRECT);
@@ -21480,7 +21481,7 @@ skip_ready_valid:
 			}
 		}
 
-		if ((cmd == DKIOCSVTOC) ||
+		if ((cmd == DKIOCSVTOC || cmd == DKIOCSEXTVTOC) ||
 		    ((cmd == DKIOCSETEFI) && (tmprval == 0))) {
 
 			mutex_enter(SD_MUTEX(un));
diff --git a/usr/src/uts/intel/io/dktp/disk/cmdk.c b/usr/src/uts/intel/io/dktp/disk/cmdk.c
index 29f4c9e23c..99b56bab67 100644
--- a/usr/src/uts/intel/io/dktp/disk/cmdk.c
+++ b/usr/src/uts/intel/io/dktp/disk/cmdk.c
@@ -998,7 +998,7 @@ cmdkioctl(dev_t dev, int cmd, intptr_t arg, int flag, cred_t *credp, int *rvalp)
 
 		rc = cmlb_ioctl(dkp->dk_cmlbhandle, dev, cmd, arg, flag,
 		    credp, rvalp, 0);
-		if (cmd == DKIOCSVTOC)
+		if (cmd == DKIOCSVTOC || cmd == DKIOCSEXTVTOC)
 			cmdk_devid_setup(dkp);
 		return (rc);
 	}

