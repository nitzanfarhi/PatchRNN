commit c406c3cd0634a01de380b92c55bb7ceb8f4a0fb5
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Wed Jul 5 13:19:14 2006 +0000

    Send "Connection: close" if not HTTP/1.1
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@329 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/cache_acceptor.c b/bin/varnishd/cache_acceptor.c
index 22d7c49be..6402aafb9 100644
--- a/bin/varnishd/cache_acceptor.c
+++ b/bin/varnishd/cache_acceptor.c
@@ -102,6 +102,8 @@ vca_write_obj(struct worker *w, struct sess *sp)
 		sp->obj->age + sp->t_req - sp->obj->entered);
 	sbuf_printf(w->sb, "Via: 1.1 varnish\r\n");
 	sbuf_printf(w->sb, "X-Varnish: xid %u\r\n", sp->obj->xid);
+	if (http_GetProto(sp->http, &r) && strcmp(r, "HTTP/1.1")) 
+		sbuf_printf(w->sb, "Connection: close\r\n");
 	sbuf_printf(w->sb, "\r\n");
 	sbuf_finish(w->sb);
 	vca_write(sp, sbuf_data(w->sb), sbuf_len(w->sb));

