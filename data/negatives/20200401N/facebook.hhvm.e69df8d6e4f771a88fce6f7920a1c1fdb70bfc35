commit e69df8d6e4f771a88fce6f7920a1c1fdb70bfc35
Author: Franck STAUFFER <franck.stauffer@rbs.fr>
Date:   Wed Oct 23 07:15:59 2013 -0700

    row_count properly set on INSERT/UPDATES
    
    Fixes bug due to variable shadowing
    
    Closes #364
    
    Reviewed By: @JoelMarcey
    
    Differential Revision: D1021780
    
    Pulled By: @scannell

diff --git a/hphp/runtime/ext/pdo_mysql.cpp b/hphp/runtime/ext/pdo_mysql.cpp
index 2e00b726c2..5234262d8d 100644
--- a/hphp/runtime/ext/pdo_mysql.cpp
+++ b/hphp/runtime/ext/pdo_mysql.cpp
@@ -919,8 +919,8 @@ bool PDOMySqlStatement::executer() {
     return false;
   }
 
-  my_ulonglong row_count = mysql_affected_rows(m_server);
-  if (row_count == (my_ulonglong)-1) {
+  my_ulonglong affected_count = mysql_affected_rows(m_server);
+  if (affected_count == (my_ulonglong)-1) {
     /* we either have a query that returned a result set or an error occured
        lets see if we have access to a result set */
     if (!m_conn->buffered()) {
@@ -938,6 +938,9 @@ bool PDOMySqlStatement::executer() {
     m_fields = mysql_fetch_fields(m_result);
 
   }
+  else {
+    row_count = affected_count;
+  }
 
   return true;
 }

