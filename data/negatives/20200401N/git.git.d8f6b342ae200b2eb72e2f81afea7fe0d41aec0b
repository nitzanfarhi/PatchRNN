commit d8f6b342ae200b2eb72e2f81afea7fe0d41aec0b
Author: Linus Torvalds <torvalds@osdl.org>
Date:   Wed Jan 25 17:00:37 2006 -0500

    Make git-rev-list and git-rev-parse argument parsing stricter
    
    If you pass it a filename without the "--" marker to separate it from
    revision information and flags, we now require that the file in question
    actually exists. This makes mis-typed revision information not be silently
    just considered a strange filename.
    
    With the "--" marker, you can continue to pass in filenames that do not
    actually exists - useful for querying what happened to a file that you
    no longer have in the repository.
    
    [ All scripts should use the "--" format regardless, to make things
      unambiguous. So this change should not affect any existing tools ]
    
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>
    Signed-off-by: Junio C Hamano <junkio@cox.net>

diff --git a/rev-list.c b/rev-list.c
index d0609666a..e00e6fc76 100644
--- a/rev-list.c
+++ b/rev-list.c
@@ -844,8 +844,12 @@ int main(int argc, const char **argv)
 			arg++;
 			limited = 1;
 		}
-		if (get_sha1(arg, sha1) < 0)
+		if (get_sha1(arg, sha1) < 0) {
+			struct stat st;
+			if (lstat(arg, &st) < 0)
+				die("'%s': %s", arg, strerror(errno));
 			break;
+		}
 		commit = get_commit_reference(arg, sha1, flags);
 		handle_one_commit(commit, &list);
 	}
diff --git a/rev-parse.c b/rev-parse.c
index 0c951af0d..7abad35de 100644
--- a/rev-parse.c
+++ b/rev-parse.c
@@ -154,6 +154,7 @@ int main(int argc, char **argv)
 	const char *prefix = setup_git_directory();
 	
 	for (i = 1; i < argc; i++) {
+		struct stat st;
 		char *arg = argv[i];
 		char *dotdot;
 	
@@ -293,6 +294,8 @@ int main(int argc, char **argv)
 		}
 		if (verify)
 			die("Needed a single revision");
+		if (lstat(arg, &st) < 0)
+			die("'%s': %s", arg, strerror(errno));
 		as_is = 1;
 		show_file(arg);
 	}

