commit 71518342bfdfbe508ee325ab5e20984ba2da7de2
Author: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
Date:   Sat Jan 26 20:13:04 2008 +0100

    ide: add hwif->chipset fixup to ide_device_add()
    
    Add hwif->chipset fixup identical to the one in ideprobe_init()
    to ide_device_add().
    
    Acked-by: Sergei Shtylyov <sshtylyov@ru.mvista.com>
    Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>

diff --git a/drivers/ide/ide-probe.c b/drivers/ide/ide-probe.c
index 817564fba820..a7a1cd85f15d 100644
--- a/drivers/ide/ide-probe.c
+++ b/drivers/ide/ide-probe.c
@@ -1405,8 +1405,12 @@ int ide_device_add(u8 idx[4])
 
 		hwif = &ide_hwifs[idx[i]];
 
-		if (hwif->present)
+		if (hwif->present) {
+			if (hwif->chipset == ide_unknown ||
+			    hwif->chipset == ide_forced)
+				hwif->chipset = ide_generic;
 			hwif_register_devices(hwif);
+		}
 	}
 
 	for (i = 0; i < 4; i++) {

