commit bda144319385c95291e0566f927994f98a7a0ee4
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Jan 22 14:10:20 2007 +0200

    If message had one invalid X-UID and another valid X-UID, we still marked
    the valid one with uid_broken=TRUE.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-storage/index/mbox/mbox-sync-parse.c b/src/lib-storage/index/mbox/mbox-sync-parse.c
index 93410f378..f4bbf524c 100644
--- a/src/lib-storage/index/mbox/mbox-sync-parse.c
+++ b/src/lib-storage/index/mbox/mbox-sync-parse.c
@@ -383,6 +383,9 @@ static bool parse_x_uid(struct mbox_sync_mail_context *ctx,
 
 	ctx->sync_ctx->prev_msg_uid = value;
 	ctx->mail.uid = value;
+	/* if we had multiple X-UID headers, we could have
+	   uid_broken=TRUE here. */
+	ctx->mail.uid_broken = FALSE;
 
 	if (ctx->sync_ctx->dest_first_mail && ctx->seq != 1) {
 		/* if we're expunging the first mail, delete this header since

