commit 57682827b9a5edb52e33af0be9082b51bffcd5c7
Author: Andrew Murray <amurray@mpc-data.co.uk>
Date:   Wed Aug 4 16:38:35 2010 +0900

    sh: Use __GFP_ZERO for dma_generic_alloc_coherent().
    
    This follows the x86 change off of memset() and on to an unconditional
    __GFP_ZERO for wrapping in to optimized page clearing by way of
    clear_highpage().
    
    Signed-off-by: Andrew Murray <amurray@mpc-data.co.uk>
    Signed-off-by: Paul Mundt <lethal@linux-sh.org>

diff --git a/arch/sh/mm/consistent.c b/arch/sh/mm/consistent.c
index c86a08540258..038793286990 100644
--- a/arch/sh/mm/consistent.c
+++ b/arch/sh/mm/consistent.c
@@ -38,11 +38,12 @@ void *dma_generic_alloc_coherent(struct device *dev, size_t size,
 	void *ret, *ret_nocache;
 	int order = get_order(size);
 
+	gfp |= __GFP_ZERO;
+
 	ret = (void *)__get_free_pages(gfp, order);
 	if (!ret)
 		return NULL;
 
-	memset(ret, 0, size);
 	/*
 	 * Pages from the page allocator may have data present in
 	 * cache. So flush the cache before using uncached memory.

