commit 7db0d7054048da140798d8bfdd7fff5f74f85abf
Author: Christoph Lameter <cl@linux.com>
Date:   Tue Aug 9 16:12:23 2011 -0500

    slub: Remove useless statements in __slab_alloc
    
    Two statements in __slab_alloc() do not have any effect.
    
    1. c->page is already set to NULL by deactivate_slab() called right before.
    
    2. gfpflags are masked in new_slab() before being passed to the page
       allocator. There is no need to mask gfpflags in __slab_alloc in particular
       since most frequent processing in __slab_alloc does not require the use of a
       gfpmask.
    
    Cc: torvalds@linux-foundation.org
    Signed-off-by: Christoph Lameter <cl@linux.com>
    Signed-off-by: Pekka Enberg <penberg@kernel.org>

diff --git a/mm/slub.c b/mm/slub.c
index 30c4558acc8b..d4b76bea5dba 100644
--- a/mm/slub.c
+++ b/mm/slub.c
@@ -2064,9 +2064,6 @@ static void *__slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,
 	c = this_cpu_ptr(s->cpu_slab);
 #endif
 
-	/* We handle __GFP_ZERO in the caller */
-	gfpflags &= ~__GFP_ZERO;
-
 	page = c->page;
 	if (!page)
 		goto new_slab;
@@ -2163,7 +2160,6 @@ static void *__slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,
 
 	c->freelist = get_freepointer(s, object);
 	deactivate_slab(s, c);
-	c->page = NULL;
 	c->node = NUMA_NO_NODE;
 	local_irq_restore(flags);
 	return object;

