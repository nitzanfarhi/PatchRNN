commit 41c4f318bf58ca0b7edb613d344ca208414eb1c9
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Apr 29 19:02:59 2010 +0300

    lib-index: Another fix attempt for handling atomic inc with INT_MAX.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mail-index-sync-ext.c b/src/lib-index/mail-index-sync-ext.c
index ffaa0c76e..6ce046e18 100644
--- a/src/lib-index/mail-index-sync-ext.c
+++ b/src/lib-index/mail-index-sync-ext.c
@@ -752,7 +752,7 @@ mail_index_sync_ext_atomic_inc(struct mail_index_sync_map_ctx *ctx,
 			ext->record_size);
 		return -1;
 	}
-	if (u->diff < 0 && (uint64_t)(-u->diff) > orig_num) {
+	if (u->diff < 0 && (uint64_t)(-(int64_t)u->diff) > orig_num) {
 		mail_index_sync_set_corrupted(ctx,
 			"Extension record inc drops number below zero "
 			"(uid=%u, diff=%d, orig=%llu)",

