commit 962e7aa105282edb9dc5b5485bdd54d8b6c5e9c7
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Mon Oct 8 16:57:03 2007 +0200

    Medium: ais: Use the node's uname and send out membership updates
    
    Mercurial revision: 365c2cd2e1f31b1dade2e7662c693783dfb0d0df

diff --git a/crm/ais/plugin.c b/crm/ais/plugin.c
index ffb0b75ed..695b4efbc 100644
--- a/crm/ais/plugin.c
+++ b/crm/ais/plugin.c
@@ -537,6 +537,7 @@ void ais_cluster_id_swab(void *msg)
 
 void ais_cluster_id_callback (void *message, unsigned int nodeid)
 {
+    int changed = 0;
     struct crm_identify_msg_s *msg = message;
     if(nodeid != msg->id) {
 	ais_err("Invalid message: Node %u claimed to be node %d",
@@ -544,8 +545,12 @@ void ais_cluster_id_callback (void *message, unsigned int nodeid)
 	return;
     }
     ais_debug("Node update");
-    update_member(
-	nodeid, membership_seq, msg->votes, msg->processes, NULL, NULL);
+    changed = update_member(
+	nodeid, membership_seq, msg->votes, msg->processes, msg->uname, NULL);
+
+    if(changed) {
+	send_member_notification();
+    }
 }
 
 /* local callbacks */

