commit c69465fa977a4da926b484aa6bb4e01e0ea81cf9
Author: sageweil <sageweil@29311d96-e01e-0410-9327-a35deaab8ce9>
Date:   Mon Dec 17 22:39:11 2007 +0000

    fixed non-root rooted path issue
    
    git-svn-id: https://ceph.svn.sf.net/svnroot/ceph@2216 29311d96-e01e-0410-9327-a35deaab8ce9

diff --git a/trunk/ceph/mds/Server.cc b/trunk/ceph/mds/Server.cc
index d99c82a4e2..8887236dd2 100644
--- a/trunk/ceph/mds/Server.cc
+++ b/trunk/ceph/mds/Server.cc
@@ -1091,7 +1091,7 @@ CInode* Server::rdlock_path_pin_ref(MDRequest *mdr, bool want_auth)
   // open ref inode
   CInode *ref = 0;
   if (trace.empty())
-    ref = mdcache->get_root();
+    ref = mdcache->get_inode(refpath.get_ino());
   else {
     CDentry *dn = trace[trace.size()-1];
 

