commit 54aff3e5e75b1f43c1c216a1b42757b536b6192c
Author: Robin H. Johnson <robbat2@gentoo.org>
Date:   Sun Jun 14 19:26:39 2015 +0000

    Optimize website detection differently.
    
    Signed-off-by: Robin H. Johnson <robbat2@gentoo.org>

diff --git a/src/rgw/rgw_rest_s3.cc b/src/rgw/rgw_rest_s3.cc
index df89972283..aebc174637 100644
--- a/src/rgw/rgw_rest_s3.cc
+++ b/src/rgw/rgw_rest_s3.cc
@@ -2668,6 +2668,8 @@ int RGWHandler_ObjStore_S3Website::retarget(RGWOp *op, RGWOp **new_op) {
   if(!is_website_bucket(s)) {
       return 0;
   }*/
+  if(!(s->prot_flags & RGW_PROTO_WEBSITE))
+    return 0;
 
   RGWObjectCtx& obj_ctx = *static_cast<RGWObjectCtx *>(s->obj_ctx);
   int ret = store->get_bucket_info(obj_ctx, s->bucket_name_str, s->bucket_info, NULL, &s->bucket_attrs);

