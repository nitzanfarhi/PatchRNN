commit 83609e21bb3c2cb8e5fd715743389f500e2ccadc
Author: Stefan BÃ¼hler <stbuehler@web.de>
Date:   Sat Jul 13 13:37:27 2013 +0200

    SOA-EDIT: fix INCEPTION-INCREMENT handling

diff --git a/pdns/serialtweaker.cc b/pdns/serialtweaker.cc
index 32ec01cc2..f824f87cf 100644
--- a/pdns/serialtweaker.cc
+++ b/pdns/serialtweaker.cc
@@ -62,10 +62,11 @@ uint32_t calculateEditSoa(SOAData sd, const string& kind) {
     uint32_t inception_serial = localtime_format_YYYYMMDDSS(inception, 1);
     uint32_t dont_increment_after = localtime_format_YYYYMMDDSS(inception + 2*86400, 99);
 
-    if(sd.serial <= dont_increment_after)
-      return (sd.serial + 2); /* "day00" and "day01" are reserved for inception increasing, so increment sd.serial by two */
-    else if(sd.serial < inception_serial) 
-      return inception_serial;
+    if(sd.serial < inception_serial - 1) { /* less than <inceptionday>00 */
+      return inception_serial; /* return <inceptionday>01   (skipping <inceptionday>00 as possible value) */
+    } else if(sd.serial <= dont_increment_after) { /* >= <inceptionday>00 but <= <inceptionday+2>99 */
+      return (sd.serial + 2); /* "<inceptionday>00" and "<inceptionday>01" are reserved for inception increasing, so increment sd.serial by two */
+    }
   }
   else if(pdns_iequals(kind,"INCEPTION-WEEK")) {
     time_t inception = getStartOfWeek();

