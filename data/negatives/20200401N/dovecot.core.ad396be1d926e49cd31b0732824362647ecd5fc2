commit ad396be1d926e49cd31b0732824362647ecd5fc2
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Aug 29 13:22:11 2014 +0900

    fs layout: Absolute paths as mailbox names shouldn't return index with INDEX=MEMORY

diff --git a/src/lib-storage/list/mailbox-list-fs.c b/src/lib-storage/list/mailbox-list-fs.c
index bb1124a6b..b19474f05 100644
--- a/src/lib-storage/list/mailbox-list-fs.c
+++ b/src/lib-storage/list/mailbox-list-fs.c
@@ -75,6 +75,9 @@ fs_list_get_path(struct mailbox_list *_list, const char *name,
 	i_assert(mailbox_list_is_valid_name(_list, name, &error));
 
 	if (mailbox_list_try_get_absolute_path(_list, &name)) {
+		if (type == MAILBOX_LIST_PATH_TYPE_INDEX &&
+		    *set->index_dir == '\0')
+			return 0;
 		*path_r = name;
 		return 1;
 	}

