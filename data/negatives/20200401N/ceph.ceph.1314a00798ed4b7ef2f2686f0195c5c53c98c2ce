commit 1314a00798ed4b7ef2f2686f0195c5c53c98c2ce
Author: Sage Weil <sage@inktank.com>
Date:   Sat May 19 14:56:49 2012 -0700

    filestore: do not test xattrs on fsid file
    
    This is sufficient to break our fcntl lock, which breaks the check for
    other running daemons.
    
    Broken by f03dc34f7e2fc1707fa00339b917c0d2c93dbdd3
    
    Fixes: #2452
    Backport: dho
    Signed-off-by: Sage Weil <sage@inktank.com>

diff --git a/src/os/FileStore.cc b/src/os/FileStore.cc
index 3b8171b598..c144fd2121 100644
--- a/src/os/FileStore.cc
+++ b/src/os/FileStore.cc
@@ -1312,7 +1312,7 @@ int FileStore::_detect_fs()
   char fn[PATH_MAX];
   int x = rand();
   int y = x+1;
-  snprintf(fn, sizeof(fn), "%s/fsid", basedir.c_str());
+  snprintf(fn, sizeof(fn), "%s/whoami", basedir.c_str());
   int ret = do_setxattr(fn, "user.test", &x, sizeof(x));
   if (ret >= 0)
     ret = do_getxattr(fn, "user.test", &y, sizeof(y));

