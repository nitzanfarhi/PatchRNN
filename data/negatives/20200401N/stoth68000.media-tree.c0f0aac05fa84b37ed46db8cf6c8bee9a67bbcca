commit c0f0aac05fa84b37ed46db8cf6c8bee9a67bbcca
Author: Johannes Berg <johannes@sipsolutions.net>
Date:   Thu Apr 30 20:09:56 2009 +0200

    cfg80211: fix truncated IEs
    
    Another bug in the "cfg80211: do not replace BSS structs" patch,
    a forgotten length update leads to bogus data being stored and
    passed to userspace, often truncated.
    
    Signed-off-by: Johannes Berg <johannes@sipsolutions.net>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/wireless/scan.c b/net/wireless/scan.c
index 2ae65b39b529..1f260c40b6ca 100644
--- a/net/wireless/scan.c
+++ b/net/wireless/scan.c
@@ -395,6 +395,7 @@ cfg80211_bss_update(struct cfg80211_registered_device *dev,
 					memcpy(ies, res->pub.information_elements, ielen);
 					found->ies_allocated = true;
 					found->pub.information_elements = ies;
+					found->pub.len_information_elements = ielen;
 				}
 			}
 		}

