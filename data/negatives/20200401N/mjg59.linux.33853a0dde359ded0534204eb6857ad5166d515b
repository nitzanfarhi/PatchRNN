commit 33853a0dde359ded0534204eb6857ad5166d515b
Author: Yongqiang Yang <xiaoqiangnk@gmail.com>
Date:   Mon Aug 1 06:32:19 2011 -0400

    ext4: use the correct error exit path in ext4_init_inode_table()
    
    This patch lets ext4_init_inode_table() handle errors right.
    ext4_init_inode_table() should down_write() alloc_sem which
    has been up_write()ed and stop the started journal handle.
    
    Signed-off-by: Yongqiang Yang <xiaoqiangnk@gmail.com>
    Signed-off-by: "Theodore Ts'o" <tytso@mit.edu>

diff --git a/fs/ext4/ialloc.c b/fs/ext4/ialloc.c
index 21bb2f61e502..9c63f273b550 100644
--- a/fs/ext4/ialloc.c
+++ b/fs/ext4/ialloc.c
@@ -1287,7 +1287,7 @@ extern int ext4_init_inode_table(struct super_block *sb, ext4_group_t group,
 			   group, used_blks,
 			   ext4_itable_unused_count(sb, gdp));
 		ret = 1;
-		goto out;
+		goto err_out;
 	}
 
 	blk = ext4_inode_table(sb, gdp) + used_blks;

