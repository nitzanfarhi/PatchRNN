commit adc4633c86f3358fce676b6c7ce75055e395123a
Author: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Date:   Wed Oct 24 23:53:01 2012 -0700

    Input: fix sparse warning in __input_release_device()
    
    This fixes the following warning:
    drivers/input/input.c:538:23: error: incompatible types in comparison expression (different address spaces)
    
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>

diff --git a/drivers/input/input.c b/drivers/input/input.c
index 53a0ddee7872..f1be1a77edf3 100644
--- a/drivers/input/input.c
+++ b/drivers/input/input.c
@@ -534,8 +534,11 @@ EXPORT_SYMBOL(input_grab_device);
 static void __input_release_device(struct input_handle *handle)
 {
 	struct input_dev *dev = handle->dev;
+	struct input_handle *grabber;
 
-	if (dev->grab == handle) {
+	grabber = rcu_dereference_protected(dev->grab,
+					    lockdep_is_held(&dev->mutex));
+	if (grabber == handle) {
 		rcu_assign_pointer(dev->grab, NULL);
 		/* Make sure input_pass_event() notices that grab is gone */
 		synchronize_rcu();

