commit e62fe2f02d38958516026ce9042c3d1542b6c0a6
Author: Nick Mathewson <nickm@torproject.org>
Date:   Thu Sep 24 16:51:25 2015 -0400

    Put braces around reject-lines for IPv6 addrs
    
    Fixes bug 17149; bug not in any released Tor.

diff --git a/src/or/policies.c b/src/or/policies.c
index 86eedd2c1..9c858ec1b 100644
--- a/src/or/policies.c
+++ b/src/or/policies.c
@@ -1037,7 +1037,7 @@ policies_parse_exit_policy_internal(config_line_t *cfg, smartlist_t **dest,
                  "address", fmt_addr(ipv6_local_address));
       } else {
         char buf6[POLICY_BUF_LEN];
-        tor_snprintf(buf6, sizeof(buf6), "reject %s:*",
+        tor_snprintf(buf6, sizeof(buf6), "reject [%s]:*",
                      fmt_addr(ipv6_local_address));
         append_exit_policy_string(dest, buf6);
         log_info(LD_CONFIG, "Adding a reject ExitPolicy '%s' for our "
@@ -1075,7 +1075,7 @@ policies_parse_exit_policy_internal(config_line_t *cfg, smartlist_t **dest,
            * address */
           if (ipv6_local_address == NULL
               || !tor_addr_eq(ipv6_local_address, a)) {
-            tor_snprintf(bufif, sizeof(bufif), "reject6 %s:*",
+            tor_snprintf(bufif, sizeof(bufif), "reject6 [%s]:*",
                          fmt_addr(a));
             append_exit_policy_string(dest, bufif);
             log_info(LD_CONFIG, "Adding a reject ExitPolicy '%s' for a local "

