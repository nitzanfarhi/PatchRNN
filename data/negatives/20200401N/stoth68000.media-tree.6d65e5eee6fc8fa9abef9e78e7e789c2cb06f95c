commit 6d65e5eee6fc8fa9abef9e78e7e789c2cb06f95c
Author: Michio Honda <micchie@sfc.wide.ad.jp>
Date:   Fri Jun 10 16:42:14 2011 +0900

    sctp: kzalloc() error handling on deleting last address
    
    Signed-off-by: Michio Honda <micchie@sfc.wide.ad.jp>
    Acked-by: Wei Yongjun <yjwei@cn.fujitsu.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/sctp/socket.c b/net/sctp/socket.c
index e7e1b142875c..60038fef3ba1 100644
--- a/net/sctp/socket.c
+++ b/net/sctp/socket.c
@@ -786,6 +786,10 @@ static int sctp_send_asconf_del_ip(struct sock		*sk,
 				continue;
 			asoc->asconf_addr_del_pending =
 			    kzalloc(sizeof(union sctp_addr), GFP_ATOMIC);
+			if (asoc->asconf_addr_del_pending == NULL) {
+				retval = -ENOMEM;
+				goto out;
+			}
 			asoc->asconf_addr_del_pending->sa.sa_family =
 				    addrs->sa_family;
 			asoc->asconf_addr_del_pending->v4.sin_port =

