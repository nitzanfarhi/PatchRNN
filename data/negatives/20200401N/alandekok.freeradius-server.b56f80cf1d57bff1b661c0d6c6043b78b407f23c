commit b56f80cf1d57bff1b661c0d6c6043b78b407f23c
Author: aland <aland>
Date:   Fri Feb 9 13:09:35 2007 +0000

            request->password is User-Password or CHAP-Password.
            That's probably a bad idea

diff --git a/src/modules/rlm_perl/rlm_perl.c b/src/modules/rlm_perl/rlm_perl.c
index 92f3a5de5..606c32343 100644
--- a/src/modules/rlm_perl/rlm_perl.c
+++ b/src/modules/rlm_perl/rlm_perl.c
@@ -1053,6 +1053,9 @@ static int rlmperl_call(void *instance, REQUEST *request, char *function_name)
 					     PW_USER_NAME);
 		request->password = pairfind(request->packet->vps,
 					     PW_USER_PASSWORD);
+		if (!request->password)
+			request->password = pairfind(request->packet->vps,
+						     PW_CHAP_PASSWORD);
 	}
 
 	if ((get_hv_content(rad_reply_hv, &vp)) > 0 ) {

