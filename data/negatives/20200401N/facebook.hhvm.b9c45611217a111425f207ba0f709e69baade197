commit b9c45611217a111425f207ba0f709e69baade197
Author: jdelong <jdelong@fb.com>
Date:   Tue Oct 23 19:51:32 2012 -0700

    Move thread prefixed logging inside mutex
    
    This is probably what it was supposed to be.

diff --git a/src/util/trace.cpp b/src/util/trace.cpp
index 6e7c45b6df..7f4038e335 100644
--- a/src/util/trace.cpp
+++ b/src/util/trace.cpp
@@ -147,9 +147,9 @@ void vtrace(const char *fmt, va_list ap) {
   if (moduleEnabledRelease(Trace::ringbuffer, 1)) {
     vtraceRingbuffer(fmt, ap);
   } else {
-    vfprintf(out, fmt, ap);
     ONTRACE(1, pthread_mutex_lock(&mtx));
     ONTRACE(1, fprintf(out, "t%#08x: ", int((int64)pthread_self() & 0xFFFFFFFF)));
+    vfprintf(out, fmt, ap);
     ONTRACE(1, pthread_mutex_unlock(&mtx));
     flush();
   }

