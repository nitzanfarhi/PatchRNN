commit 0c2a95543bcbfd5558d17018ca167b5ff70b4d4a
Author: Deomid Ryabkov <rojer@cesanta.com>
Date:   Tue Apr 18 13:26:46 2017 +0100

    Fix mg_socket_if_get_conn_addr for UDP sockets
    
    Remote address is not associated with an outgoing UDP socket.
    Instead, it is stored in mg_connection.sa
    
    PUBLISHED_FROM=16f82ee8a69b995d684ec96b8db6b5591cd400db

diff --git a/mongoose/mongoose.c b/mongoose/mongoose.c
index 7840a264..7c40cb9c 100644
--- a/mongoose/mongoose.c
+++ b/mongoose/mongoose.c
@@ -3792,6 +3792,10 @@ void mg_sock_to_str(sock_t sock, char *buf, size_t len, int flags) {
 
 void mg_socket_if_get_conn_addr(struct mg_connection *nc, int remote,
                                 union socket_address *sa) {
+  if ((nc->flags & MG_F_UDP) && remote) {
+    memcpy(sa, &nc->sa, sizeof(*sa));
+    return;
+  }
   mg_sock_get_addr(nc->sock, remote, sa);
 }
 

