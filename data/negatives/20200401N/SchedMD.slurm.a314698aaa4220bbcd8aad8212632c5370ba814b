commit a314698aaa4220bbcd8aad8212632c5370ba814b
Author: Morris Jette <jette@schedmd.com>
Date:   Wed Jul 19 09:05:51 2017 -0600

    Fix a problems reported by CLANG

diff --git a/src/api/step_launch.c b/src/api/step_launch.c
index e6d030efa7..9a2f4e981c 100644
--- a/src/api/step_launch.c
+++ b/src/api/step_launch.c
@@ -551,10 +551,14 @@ extern int slurm_step_launch_add(slurm_step_ctx_t *ctx,
 			 sizeof(int) * ctx->step_req->num_tasks);
 	}
 
-	launch.num_resp_port = first_ctx->launch_state->num_resp_port;
-	launch.resp_port = xmalloc(sizeof(uint16_t) * launch.num_resp_port);
-	memcpy(launch.resp_port, first_ctx->launch_state->resp_port,
-	       (sizeof(uint16_t) * launch.num_resp_port));
+	if (first_ctx->launch_state->num_resp_port &&
+	    first_ctx->launch_state->resp_port) {
+		launch.num_resp_port = first_ctx->launch_state->num_resp_port;
+		launch.resp_port = xmalloc(sizeof(uint16_t) *
+					  launch.num_resp_port);
+		memcpy(launch.resp_port, first_ctx->launch_state->resp_port,
+		       (sizeof(uint16_t) * launch.num_resp_port));
+	}
 
 	rc = _launch_tasks(ctx, &launch, params->msg_timeout,
 			   node_list, start_nodeid);
diff --git a/src/slurmctld/proc_req.c b/src/slurmctld/proc_req.c
index adc50e381e..8f87fe7489 100644
--- a/src/slurmctld/proc_req.c
+++ b/src/slurmctld/proc_req.c
@@ -3034,15 +3034,8 @@ static void _slurm_rpc_job_pack_alloc_info(slurm_msg_t * msg)
 	if (!job_ptr->pack_job_list) {
 		resp = list_create(_pack_alloc_list_del);
 		job_info_resp_msg = build_job_info_resp(job_ptr);
-		if (working_cluster_rec) {
-			job_info_resp_msg->working_cluster_rec =
-				working_cluster_rec;
-		} else {
-			set_remote_working_response(job_info_resp_msg,
-					job_ptr, job_info_msg->req_cluster);
-			working_cluster_rec =
-				job_info_resp_msg->working_cluster_rec;
-		}
+		set_remote_working_response(job_info_resp_msg, job_ptr,
+					    job_info_msg->req_cluster);
 		list_append(resp, job_info_resp_msg);
 	} else {
 		resp = list_create(_pack_alloc_list_del);

