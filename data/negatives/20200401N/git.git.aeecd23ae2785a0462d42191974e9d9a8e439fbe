commit aeecd23ae2785a0462d42191974e9d9a8e439fbe
Author: Junio C Hamano <junkio@cox.net>
Date:   Tue Feb 28 20:19:47 2006 -0800

    diffcore-break: micro-optimize by avoiding delta between identical files.
    
    We did not check if we have the same file on both sides when
    computing break score.  This is usually not a problem, but if
    the user said --find-copies-harde with -B, we ended up trying a
    delta between the same data even when we know the SHA1 hash of
    both sides match.
    
    Signed-off-by: Junio C Hamano <junkio@cox.net>

diff --git a/diffcore-break.c b/diffcore-break.c
index c57513a4f..95b5eb492 100644
--- a/diffcore-break.c
+++ b/diffcore-break.c
@@ -58,6 +58,10 @@ static int should_break(struct diff_filespec *src,
 	if (!S_ISREG(src->mode) || !S_ISREG(dst->mode))
 		return 0; /* leave symlink rename alone */
 
+	if (src->sha1_valid && dst->sha1_valid &&
+	    !memcmp(src->sha1, dst->sha1, 20))
+		return 0; /* they are the same */
+
 	if (diff_populate_filespec(src, 0) || diff_populate_filespec(dst, 0))
 		return 0; /* error but caught downstream */
 

