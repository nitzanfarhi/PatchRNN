commit e060fdbd35ffc4431f82f300e98c2320373b68a9
Author: Alan T. DeKok <aland@freeradius.org>
Date:   Mon Jul 4 19:08:12 2011 +0200

    Get peer id on new socket, not old one

diff --git a/src/main/command.c b/src/main/command.c
index 8eba59a9c..2e4334db8 100644
--- a/src/main/command.c
+++ b/src/main/command.c
@@ -2425,7 +2425,7 @@ static int command_domain_accept(rad_listen_t *listener)
 		uid_t uid;
 		gid_t gid;
 
-		if (getpeereid(listener->fd, &uid, &gid) < 0) {
+		if (getpeereid(newfd, &uid, &gid) < 0) {
 			radlog(L_ERR, "Failed getting peer credentials for %s: %s",
 			       sock->path, strerror(errno));
 			close(newfd);

