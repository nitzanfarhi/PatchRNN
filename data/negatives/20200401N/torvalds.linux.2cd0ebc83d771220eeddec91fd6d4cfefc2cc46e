commit 2cd0ebc83d771220eeddec91fd6d4cfefc2cc46e
Author: Francesco VIRLINZI <francesco.virlinzi@st.com>
Date:   Wed Oct 15 11:58:24 2008 +0200

    sh: Fixed the TMU0 reload value on resume
    
    This patch fixes the TMU0 interrupt frequency on suspend/resume.
    During the resume the kernel reprograms the TMU0.ClockEvent mode
    but if the mode is periodic than the TMU0.TCOR is updated with
    a random wrong value without taking care latest valid saved value.
    
    There was no problem with No_HZ system where TMU0.TCOR isn't used.
    
    Signed-off-by: Francesco M. Virlinzi <francesco.virlinzi@st.com>
    Signed-off-by: Stuart Menefy <stuart.menefy@st.com>
    Signed-off-by: Paul Mundt <lethal@linux-sh.org>

diff --git a/arch/sh/kernel/timers/timer-tmu.c b/arch/sh/kernel/timers/timer-tmu.c
index aaaf90d06b85..3c61ddd4d43e 100644
--- a/arch/sh/kernel/timers/timer-tmu.c
+++ b/arch/sh/kernel/timers/timer-tmu.c
@@ -120,7 +120,7 @@ static void tmu_set_mode(enum clock_event_mode mode,
 {
 	switch (mode) {
 	case CLOCK_EVT_MODE_PERIODIC:
-		ctrl_outl(ctrl_inl(TMU0_TCNT), TMU0_TCOR);
+		ctrl_outl(tmu_latest_interval[TMU0], TMU0_TCOR);
 		break;
 	case CLOCK_EVT_MODE_ONESHOT:
 		ctrl_outl(0, TMU0_TCOR);

