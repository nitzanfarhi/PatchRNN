commit 1bb314945e50b90e450d4fa1de2d5f5937f35e07
Author: pekka@mysql.com <>
Date:   Thu Nov 11 14:32:52 2004 +0100

    ndb: wl-2066 small fix

diff --git a/ndb/src/kernel/blocks/dbacc/DbaccMain.cpp b/ndb/src/kernel/blocks/dbacc/DbaccMain.cpp
index 26216d310ff..eee61d03702 100644
--- a/ndb/src/kernel/blocks/dbacc/DbaccMain.cpp
+++ b/ndb/src/kernel/blocks/dbacc/DbaccMain.cpp
@@ -4555,7 +4555,12 @@ void Dbacc::getElement(Signal* signal)
   tgeResult = ZFALSE;
   tgeCompareLen = fragrecptr.p->keyLength;
   const Uint32 isAccLockReq = operationRecPtr.p->isAccLockReq; // wl-2066 remove
-  const bool  compareLocalKey =
+  /*
+   * The value seached is
+   * - table key for ACCKEYREQ, stored in TUP
+   * - local key (1 word) for ACC_LOCKREQ and UNDO, stored in ACC
+   */
+  const bool compareLocalKey =
     operationRecPtr.p->isAccLockReq || operationRecPtr.p->isUndoLogReq;
 
   ndbrequire(TelemLen == ZELEM_HEAD_SIZE + fragrecptr.p->localkeylen);
@@ -10448,11 +10453,15 @@ void Dbacc::srDoUndoLab(Signal* signal)
 	       ((fragrecptr.p->keyLength != 0) &&
 		(fragrecptr.p->keyLength == tkeylen)));
     
-    // Read keydata from undo page
+    // Read localkey1 from undo page
+    signal->theData[7 + 0] = undopageptr.p->undoword[tmpindex];
+    tmpindex = tmpindex + 1;
+#if 0 // wl-2066 remove
     for (Uint32 tmp = 0; tmp < tkeylen; tmp++) {
       signal->theData[7+tmp] = undopageptr.p->undoword[tmpindex];
       tmpindex = tmpindex + 1;
     }//for
+#endif
     arrGuard((tmpindex - 1), 8192);
     getElement(signal);
     if (tgeResult != ZTRUE) {

