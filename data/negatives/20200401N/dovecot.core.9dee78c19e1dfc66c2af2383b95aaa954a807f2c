commit 9dee78c19e1dfc66c2af2383b95aaa954a807f2c
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Jun 6 12:20:54 2013 +0300

    lib-imap-client: Don't start another DNS lookup if there's already one ongoing.

diff --git a/src/lib-imap-client/imapc-connection.c b/src/lib-imap-client/imapc-connection.c
index 886e7b9d8..b5e769bc0 100644
--- a/src/lib-imap-client/imapc-connection.c
+++ b/src/lib-imap-client/imapc-connection.c
@@ -1374,7 +1374,7 @@ void imapc_connection_connect(struct imapc_connection *conn,
 	unsigned int ips_count;
 	int ret;
 
-	if (conn->fd != -1) {
+	if (conn->fd != -1 || conn->dns_lookup != NULL) {
 		i_assert(login_callback == NULL);
 		return;
 	}

