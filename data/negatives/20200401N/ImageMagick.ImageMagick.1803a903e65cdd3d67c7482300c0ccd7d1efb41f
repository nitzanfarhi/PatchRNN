commit 1803a903e65cdd3d67c7482300c0ccd7d1efb41f
Author: cristy <urban-warrior@git.imagemagick.org>
Date:   Sat Jan 4 21:01:24 2014 +0000

diff --git a/coders/jp2.c b/coders/jp2.c
index b1d887b31..e9b117ebe 100644
--- a/coders/jp2.c
+++ b/coders/jp2.c
@@ -809,6 +809,32 @@ static MagickBooleanType WriteJP2Image(const ImageInfo *image_info,Image *image,
       parameters.tcp_numlayers=i;
       parameters.cp_disto_alloc=OPJ_TRUE;
     }
+#if defined(BUGINOPENJPEG)
+  if ((image->depth == 12) &&
+      ((image->columns == 2048) || (image->rows == 1080) ||
+       (image->columns == 4096) || (image->rows == 2160)))
+    {
+      /*
+        Digital Cinema profile compliance.
+      */
+      if ((image->columns == 2048) || (image->rows == 1080))
+        {
+          /*
+            Digital Cinema 2K.
+          */
+          parameters.cp_cinema=OPJ_CINEMA2K_48;
+          parameters.cp_rsiz=OPJ_CINEMA2K;
+        }
+      if ((image->columns == 4096) || (image->rows == 2160))
+        {
+          /*
+            Digital Cinema 4K.
+          */
+          parameters.cp_cinema=OPJ_CINEMA4K_24;
+          parameters.cp_rsiz=OPJ_CINEMA4K;
+        }
+    }
+#endif
   value=GetImageProperty(image,"comment",exception);
   if (value != (const char *) NULL)
     parameters.cp_comment=ConstantString(value);

