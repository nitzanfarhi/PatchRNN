commit 243aaea5176106a04160b53a628954a8c3451250
Author: Spencer T Brody <spencer@10gen.com>
Date:   Tue Oct 4 16:53:48 2011 -0400

    Don't send queries to non-ok master.

diff --git a/client/dbclient_rs.cpp b/client/dbclient_rs.cpp
index 6d39f58fbc..8a03d77fd8 100644
--- a/client/dbclient_rs.cpp
+++ b/client/dbclient_rs.cpp
@@ -261,7 +261,7 @@ namespace mongo {
             }
         }
 
-        if( _master >= 0 ) { 
+        if( _master >= 0 && _nodes[_master].ok ) {
             assert( static_cast<unsigned>(_master) < _nodes.size() );
             LOG(2) << "dbclient_rs getSlave no member in secondary state found, returning primary " << _nodes[ _master ] << endl;
             return _nodes[_master].addr;

