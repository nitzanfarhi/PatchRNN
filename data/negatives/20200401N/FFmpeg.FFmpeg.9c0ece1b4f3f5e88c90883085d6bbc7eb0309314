commit 9c0ece1b4f3f5e88c90883085d6bbc7eb0309314
Author: Anton Khirnov <anton@khirnov.net>
Date:   Sun Oct 27 10:02:26 2013 +0100

    sunrast: stop using deprecated avcodec_set_dimensions

diff --git a/libavcodec/sunrast.c b/libavcodec/sunrast.c
index 4147cf0b82..ffa685c19f 100644
--- a/libavcodec/sunrast.c
+++ b/libavcodec/sunrast.c
@@ -61,10 +61,6 @@ static int sunrast_decode_frame(AVCodecContext *avctx, void *data,
         av_log(avctx, AV_LOG_ERROR, "invalid (compression) type\n");
         return AVERROR_INVALIDDATA;
     }
-    if (av_image_check_size(w, h, 0, avctx)) {
-        av_log(avctx, AV_LOG_ERROR, "invalid image size\n");
-        return AVERROR_INVALIDDATA;
-    }
     if (maptype == RMT_RAW) {
         avpriv_request_sample(avctx, "Unknown colormap type");
         return AVERROR_PATCHWELCOME;
@@ -90,8 +86,10 @@ static int sunrast_decode_frame(AVCodecContext *avctx, void *data,
             return AVERROR_INVALIDDATA;
     }
 
-    if (w != avctx->width || h != avctx->height)
-        avcodec_set_dimensions(avctx, w, h);
+    ret = ff_set_dimensions(avctx, w, h);
+    if (ret < 0)
+        return ret;
+
     if ((ret = ff_get_buffer(avctx, p, 0)) < 0) {
         av_log(avctx, AV_LOG_ERROR, "get_buffer() failed\n");
         return ret;

