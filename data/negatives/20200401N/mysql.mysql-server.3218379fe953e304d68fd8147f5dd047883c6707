commit 3218379fe953e304d68fd8147f5dd047883c6707
Author: Thirunarayanan Balathandayuthapani <thirunarayanan.balathandayuth@oracle.com>
Date:   Thu May 18 13:53:27 2017 +0530

    Bug #24961167   CONCURRENT INSERT FAILS IF TABLE DOES REBUILD
    
    Analysis:
    =========
       During alter table rebuild, InnoDB fails to apply concurrent insert log.
    If the insert log record is present across the blocks then apply phase
    trying to access the next block without fetching it.
    
    Fix:
    ====
    During virtual column parsing, check whether the record is present
    across the blocks before accessing the virtual column information.
    
    Reviewed-by: Jimmy Yang <jimmy.yang@oracle.com>
    RB: 16243

diff --git a/storage/innobase/row/row0log.cc b/storage/innobase/row/row0log.cc
index e1cfd15399c..c8a56b25d0c 100644
--- a/storage/innobase/row/row0log.cc
+++ b/storage/innobase/row/row0log.cc
@@ -2420,6 +2420,9 @@ row_log_table_apply_op(
 		next_mrec = mrec + rec_offs_data_size(offsets);
 
 		if (log->table->n_v_cols) {
+			if (next_mrec + 2 > mrec_end) {
+				return(NULL);
+			}
 			next_mrec += mach_read_from_2(next_mrec);
 		}
 

