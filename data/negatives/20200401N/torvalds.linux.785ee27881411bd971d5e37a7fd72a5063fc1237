commit 785ee27881411bd971d5e37a7fd72a5063fc1237
Author: Prarit Bhargava <prarit@redhat.com>
Date:   Fri Nov 20 18:47:57 2015 -0500

    cpufreq: intel_pstate: Fix limits->max_perf rounding error
    
    A rounding error was found in the calculation of limits->max_perf
    in intel_pstate_set_policy(), which is used to calculate the max and min
    pstate values in intel_pstate_get_min_max().  In that code,
    limits->max_perf is truncated to 2 hex digits such that, for example,
    0x169 was incorrectly calculated to 0x16 instead of 0x17.  This resulted in
    the pstate being set one level too low.  This patch rounds the value of
    limits->max_perf up instead of down so that the correct max pstate can
    be reached.
    
    Signed-off-by: Prarit Bhargava <prarit@redhat.com>
    Acked-by: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
    Acked-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/intel_pstate.c b/drivers/cpufreq/intel_pstate.c
index eb75053f1371..8ad1f958ffe4 100644
--- a/drivers/cpufreq/intel_pstate.c
+++ b/drivers/cpufreq/intel_pstate.c
@@ -1121,6 +1121,7 @@ static int intel_pstate_set_policy(struct cpufreq_policy *policy)
 				   limits->max_sysfs_pct);
 	limits->max_perf_pct = max(limits->min_policy_pct,
 				   limits->max_perf_pct);
+	limits->max_perf = round_up(limits->max_perf, 8);
 
 	/* Make sure min_perf_pct <= max_perf_pct */
 	limits->min_perf_pct = min(limits->max_perf_pct, limits->min_perf_pct);

