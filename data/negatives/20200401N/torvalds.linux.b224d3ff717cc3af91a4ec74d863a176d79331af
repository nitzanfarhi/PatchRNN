commit b224d3ff717cc3af91a4ec74d863a176d79331af
Author: Marcel Holtmann <marcel@holtmann.org>
Date:   Sat Oct 3 12:01:08 2015 +0200

    Bluetooth: btbcm: Send HCI Reset before sending Apple specific commands
    
    The commit 7bee8b08c428 allows the Read Verbose Config Info to fail
    gracefully and not cause the controller setup to abort. It seems the
    reason that command failed in the first place was the missing HCI Reset
    to bring the controller in full Bluetooth mode.
    
    Apple Bluetooth controllers start out in HID mode and when in that mode
    the Read Verbose Config Info command is not allowed. Sending HCI Reset
    switches the controller into full HCI mode.
    
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
    Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>

diff --git a/drivers/bluetooth/btbcm.c b/drivers/bluetooth/btbcm.c
index 02ed816a18f9..ad7371da5aaa 100644
--- a/drivers/bluetooth/btbcm.c
+++ b/drivers/bluetooth/btbcm.c
@@ -475,12 +475,18 @@ EXPORT_SYMBOL_GPL(btbcm_setup_patchram);
 int btbcm_setup_apple(struct hci_dev *hdev)
 {
 	struct sk_buff *skb;
+	int err;
+
+	/* Reset */
+	err = btbcm_reset(hdev);
+	if (err)
+		return err;
 
 	/* Read Verbose Config Version Info */
 	skb = btbcm_read_verbose_config(hdev);
 	if (!IS_ERR(skb)) {
-		BT_INFO("%s: BCM: chip id %u build %4.4u", hdev->name, skb->data[1],
-			get_unaligned_le16(skb->data + 5));
+		BT_INFO("%s: BCM: chip id %u build %4.4u", hdev->name,
+			skb->data[1], get_unaligned_le16(skb->data + 5));
 		kfree_skb(skb);
 	}
 

