commit 8676942c47f7d0f788eefb5f917eac7f7891d0f6
Author: Thomas Roessler <roessler@does-not-exist.org>
Date:   Thu Sep 7 21:03:20 2000 +0000

    Detect pure 7bit data and don't encode them.  This helps a bit in
    situations where mutt believes it has some really strange us-ascii
    alias as the character set.

diff --git a/rfc2231.c b/rfc2231.c
index 673a21919..f2d01bd57 100644
--- a/rfc2231.c
+++ b/rfc2231.c
@@ -308,9 +308,20 @@ int rfc2231_encode_string (char **pd)
   char *charset, *s, *t, *e, *d = 0;
   size_t slen, dlen = 0;
 
-  if (!*pd)
+  /* 
+   * A shortcut to detect pure 7bit data.
+   * 
+   * This should prevent the worst when character set handling
+   * is flawed.
+   */
+
+  for (s = *pd; *s; s++)
+    if (*s & 0x80)
+      break;
+  
+  if (!*s)
     return 0;
-
+  
   if (!Charset || !SendCharset ||
       !(charset = mutt_choose_charset (Charset, SendCharset,
 				  *pd, strlen (*pd), &d, &dlen)))

