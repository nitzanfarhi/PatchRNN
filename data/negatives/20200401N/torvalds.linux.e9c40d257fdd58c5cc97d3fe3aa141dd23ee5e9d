commit e9c40d257fdd58c5cc97d3fe3aa141dd23ee5e9d
Author: Minfei Huang <mnfhuang@gmail.com>
Date:   Tue Oct 6 02:35:55 2015 +0800

    x86/kexec: Remove obsolete 'in_crash_kexec' flag
    
    Previously, UV NMI used the 'in_crash_kexec' flag to determine whether
    we are in a kdump kernel or not:
    
      5edd19af18a36a4 ("x86, UV: Make kdump avoid stack dumps")
    
    But this flags was removed in the following commit:
    
      9c48f1c629ecfa1 ("x86, nmi: Wire up NMI handlers to new routines")
    
    Since it isn't used any more, remove it.
    
    Signed-off-by: Minfei Huang <mnfhuang@gmail.com>
    Acked-by: Don Zickus <dzickus@redhat.com>
    Cc: H. Peter Anvin <hpa@zytor.com>
    Cc: Linus Torvalds <torvalds@linux-foundation.org>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Thomas Gleixner <tglx@linutronix.de>
    Cc: cpw@sgi.com
    Cc: kexec@lists.infradead.org
    Cc: mhuang@redhat.com
    Link: http://lkml.kernel.org/r/1444070155-17934-1-git-send-email-mhuang@redhat.com
    Signed-off-by: Ingo Molnar <mingo@kernel.org>

diff --git a/arch/x86/include/asm/kdebug.h b/arch/x86/include/asm/kdebug.h
index b130d59406fb..e5f5dc9787d5 100644
--- a/arch/x86/include/asm/kdebug.h
+++ b/arch/x86/include/asm/kdebug.h
@@ -29,11 +29,5 @@ extern void show_trace(struct task_struct *t, struct pt_regs *regs,
 extern void __show_regs(struct pt_regs *regs, int all);
 extern unsigned long oops_begin(void);
 extern void oops_end(unsigned long, struct pt_regs *, int signr);
-#ifdef CONFIG_KEXEC_CORE
-extern int in_crash_kexec;
-#else
-/* no crash dump is ever in progress if no crash kernel can be kexec'd */
-#define in_crash_kexec 0
-#endif
 
 #endif /* _ASM_X86_KDEBUG_H */
diff --git a/arch/x86/kernel/crash.c b/arch/x86/kernel/crash.c
index 74ca2fe7a0b3..2c1910f6717e 100644
--- a/arch/x86/kernel/crash.c
+++ b/arch/x86/kernel/crash.c
@@ -75,8 +75,6 @@ struct crash_memmap_data {
 	unsigned int type;
 };
 
-int in_crash_kexec;
-
 /*
  * This is used to VMCLEAR all VMCSs loaded on the
  * processor. And when loading kvm_intel module, the
@@ -132,7 +130,6 @@ static void kdump_nmi_callback(int cpu, struct pt_regs *regs)
 
 static void kdump_nmi_shootdown_cpus(void)
 {
-	in_crash_kexec = 1;
 	nmi_shootdown_cpus(kdump_nmi_callback);
 
 	disable_local_APIC();

