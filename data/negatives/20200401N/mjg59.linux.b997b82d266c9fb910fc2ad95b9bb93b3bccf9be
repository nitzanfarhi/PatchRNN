commit b997b82d266c9fb910fc2ad95b9bb93b3bccf9be
Author: Jonathan Brassow <jbrassow@redhat.com>
Date:   Wed May 9 02:33:08 2007 -0700

    dm raid1: switch rh_in_sync to blocking in do_reads
    
    The call to rh_in_sync() in do_reads() should be allowed to block.  It is in
    the mirror worker thread which already permits blocking operations.  This will
    be needed to support clustered mirroring which will perform network
    operations.
    
    Signed-off-by: Jonathan Brassow <jbrassow@redhat.com>
    Signed-off-by: Alasdair G Kergon <agk@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/md/dm-raid1.c b/drivers/md/dm-raid1.c
index 85d254edd9be..ef124b71ccc8 100644
--- a/drivers/md/dm-raid1.c
+++ b/drivers/md/dm-raid1.c
@@ -741,7 +741,7 @@ static void do_reads(struct mirror_set *ms, struct bio_list *reads)
 		/*
 		 * We can only read balance if the region is in sync.
 		 */
-		if (rh_in_sync(&ms->rh, region, 0))
+		if (rh_in_sync(&ms->rh, region, 1))
 			m = choose_mirror(ms, bio->bi_sector);
 		else
 			m = ms->default_mirror;

