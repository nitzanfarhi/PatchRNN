commit 4b40fd60f0a514557c1de24dc608a1a2e74f0c1f
Author: henry <henry@b3059339-0415-0410-9bf9-f77b7e298cf2>
Date:   Thu Aug 25 19:57:32 2005 +0000

    set the nearest number of channels, return(0) upon errors
    
    
    git-svn-id: svn://svn.mplayerhq.hu/mplayer/trunk@16309 b3059339-0415-0410-9bf9-f77b7e298cf2

diff --git a/libao2/ao_alsa.c b/libao2/ao_alsa.c
index 361590ee30..f5d3c18aaa 100644
--- a/libao2/ao_alsa.c
+++ b/libao2/ao_alsa.c
@@ -548,13 +548,15 @@ static int init(int rate_hz, int channels, int format, int flags)
 	{
 	  mp_msg(MSGT_AO,MSGL_ERR,"alsa-init: unable to set format: %s\n",
 		 snd_strerror(err));
+	  return(0);
 	}
 
-      if ((err = snd_pcm_hw_params_set_channels(alsa_handler, alsa_hwparams,
-						ao_data.channels)) < 0)
+      if ((err = snd_pcm_hw_params_set_channels_near(alsa_handler, alsa_hwparams,
+						     &ao_data.channels)) < 0)
 	{
 	  mp_msg(MSGT_AO,MSGL_ERR,"alsa-init: unable to set channels: %s\n",
 		 snd_strerror(err));
+	  return(0);
 	}
 
       if ((err = snd_pcm_hw_params_set_rate_near(alsa_handler, alsa_hwparams, 

