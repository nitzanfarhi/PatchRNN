commit e037aa5caee0cf40731444760bd89f2fc3ffe9f6
Author: Bradley C. Kuszmaul <bradley@tokutek.com>
Date:   Fri Mar 7 02:06:15 2008 +0000

    Get DUPSORT dbs with logging to work without assertion failures.  Recovery stlll is broken, however.  Addresses #482.  Fixes #442.
    
    git-svn-id: file:///svn/tokudb@2602 c7de825b-a66e-492c-adef-691d508d4ae1

diff --git a/newbrt/brt.c b/newbrt/brt.c
index 75e6a621a2f..71b800ab4c6 100644
--- a/newbrt/brt.c
+++ b/newbrt/brt.c
@@ -651,9 +651,9 @@ static int handle_split_of_child (BRT t, BRTNODE node, int childnum,
 	for (cnum=node->u.n.n_children-1; cnum>childnum; cnum--) {
 	    node->u.n.childkeys[cnum] = node->u.n.childkeys[cnum-1];
 	}
-	if (logger) assert((t->flags&TOKU_DB_DUPSORT)==0); // none of this works for dupsort databases. The size is wrong. The setpivot is wrong.
+	//if (logger) assert((t->flags&TOKU_DB_DUPSORT)==0); // the setpivot is wrong for TOKU_DB_DUPSORT, so recovery will be broken.
 	node->u.n.childkeys[childnum]= pivot;
-	node->u.n.totalchildkeylens += childsplitk->size;
+	node->u.n.totalchildkeylens += toku_brt_pivot_key_len(t, pivot);
     }
 
     node->u.n.n_children++;

