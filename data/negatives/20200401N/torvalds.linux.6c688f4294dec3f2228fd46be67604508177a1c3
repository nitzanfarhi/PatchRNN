commit 6c688f4294dec3f2228fd46be67604508177a1c3
Author: Sathya Narayanan <sathyan@teamf1.com>
Date:   Tue Jul 1 10:58:19 2008 +0200

    ibm_newemac: Fixes entry of short packets
    
    Short packets has to be discarded by the driver. So this patch addresses the
    issue of discarding the short packets of size lesser then ethernet header
    size.
    
    Signed-off-by: Sathya Narayanan <sathyan@teamf1.com>
    Signed-off-by: Stefan Roese <sr@denx.de>
    Signed-off-by: Jeff Garzik <jgarzik@redhat.com>

diff --git a/drivers/net/ibm_newemac/core.c b/drivers/net/ibm_newemac/core.c
index ca63fa000ee7..babc79ad490b 100644
--- a/drivers/net/ibm_newemac/core.c
+++ b/drivers/net/ibm_newemac/core.c
@@ -1636,6 +1636,12 @@ static int emac_poll_rx(void *param, int budget)
 			goto next;
 		}
 
+		if (len < ETH_HLEN) {
+			++dev->estats.rx_dropped_stack;
+			emac_recycle_rx_skb(dev, slot, len);
+			goto next;
+		}
+
 		if (len && len < EMAC_RX_COPY_THRESH) {
 			struct sk_buff *copy_skb =
 			    alloc_skb(len + EMAC_RX_SKB_HEADROOM + 2, GFP_ATOMIC);

