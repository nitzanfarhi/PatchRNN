commit 36e220cb416a70e36f4bd402d8c3acbb67d2cae2
Author: James Cassell <code@james.cassell.me>
Date:   Tue Oct 7 18:58:54 2014 -0400

    Revert "[sieve] update sieve_fileinto() and sieve_keep() to use :flags parameter"
    
    This removes the actionflags parameter that we added earlier on in
    implementing the imap4flags sieve extension.  Since we have removed
    dependence on this parameter, we can remove it from the functions that
    previously used it.

diff --git a/imap/lmtp_sieve.c b/imap/lmtp_sieve.c
index b677fdaf2..c99b60609 100644
--- a/imap/lmtp_sieve.c
+++ b/imap/lmtp_sieve.c
@@ -500,19 +500,11 @@ static int sieve_fileinto(void *ac,
 						   fc->mailbox,
 						   sd->username, namebuf);
     if (!ret) {
-	if(fc->actionflags) {
-	ret = deliver_mailbox(md->f, mdata->content, mdata->stage, md->size,
-			      fc->actionflags,
-			      (char *) sd->username, sd->authstate, md->id,
-			      sd->username, mdata->notifyheader,
-			      namebuf, md->date, quotaoverride, 0);
-	} else {
 	ret = deliver_mailbox(md->f, mdata->content, mdata->stage, md->size,
 			      fc->imapflags,
 			      (char *) sd->username, sd->authstate, md->id,
 			      sd->username, mdata->notifyheader,
 			      namebuf, md->date, quotaoverride, 0);
-	}
     }
 
     if (ret == IMAP_MAILBOX_NONEXISTENT) {
@@ -520,21 +512,12 @@ static int sieve_fileinto(void *ac,
 	ret = autosieve_createfolder(sd->username, sd->authstate, namebuf);
 
 	/* Try to deliver the mail again. */
-	if (!ret) {
-	    if(fc->actionflags) {
-	    ret = deliver_mailbox(md->f, mdata->content, mdata->stage, md->size,
-				  fc->actionflags,
-				  (char *) sd->username, sd->authstate, md->id,
-				  sd->username, mdata->notifyheader,
-				  namebuf, md->date, quotaoverride, 0);
-	    } else {
+	if (!ret)
 	    ret = deliver_mailbox(md->f, mdata->content, mdata->stage, md->size,
 				  fc->imapflags,
 				  (char *) sd->username, sd->authstate, md->id,
 				  sd->username, mdata->notifyheader,
 				  namebuf, md->date, quotaoverride, 0);
-	    }
-	}
     }
 
     if (!ret) {
@@ -555,13 +538,8 @@ static int sieve_keep(void *ac,
     deliver_data_t *mydata = (deliver_data_t *) mc;
     int ret;
 
-    if(kc->actionflags) {
-    ret = deliver_local(mydata, kc->actionflags,
-			(char *) sd->username, sd->mailboxname);
-    } else {
     ret = deliver_local(mydata, kc->imapflags,
 			(char *) sd->username, sd->mailboxname);
-    }
 
     if (!ret) {
 	snmp_increment(SIEVE_KEEP, 1);
diff --git a/sieve/script.c b/sieve/script.c
index e5bc84505..107671414 100644
--- a/sieve/script.c
+++ b/sieve/script.c
@@ -634,7 +634,6 @@ static int do_sieve_error(int ret,
 	sieve_keep_context_t keep_context;
 	int keep_ret;
 	keep_context.imapflags = imapflags;
-	keep_context.actionflags = NULL;
  
 	lastaction = ACTION_KEEP;
 	keep_ret = interp->keep(&keep_context, interp->interp_context,
diff --git a/sieve/test.c b/sieve/test.c
index c5776dfc9..b3d0c79ef 100644
--- a/sieve/test.c
+++ b/sieve/test.c
@@ -374,13 +374,6 @@ static int fileinto(void *ac, void *ic, void *sc __attribute__((unused)),
 
     printf("filing message '%s' into '%s'\n", m->name, fc->mailbox);
 
-    if (fc->actionflags && fc->actionflags->count) {
-	char *s = strarray_join(fc->actionflags, "' '");
-	if (s) {
-	    printf("\twith flags '%s'\n", s);
-	    free(s);
-	}
-    } else
     if (fc->imapflags->count) {
 	char *s = strarray_join(fc->imapflags, "' '");
 	if (s) {
@@ -400,13 +393,6 @@ static int keep(void *ac, void *ic, void *sc __attribute__((unused)),
     int *force_fail = (int*) ic;
 
     printf("keeping message '%s'\n", m->name);
-    if (kc->actionflags && kc->actionflags->count) {
-	char *s = strarray_join(kc->actionflags, "' '");
-	if (s) {
-	    printf("\twith flags '%s'\n", s);
-	    free(s);
-	}
-    } else
     if (kc->imapflags->count) {
 	char *s = strarray_join(kc->imapflags, "' '");
 	if (s) {

