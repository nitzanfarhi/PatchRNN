commit 15101695192490079e35c0a1e9513b93ed355ebe
Author: Kees Monshouwer <mind04@monshouwer.org>
Date:   Tue Mar 29 09:39:49 2016 +0200

    don't add nsec3 records for insecure delegations in optout zones

diff --git a/pdns/pdnsutil.cc b/pdns/pdnsutil.cc
index 1b25b8a7c..926f4b477 100644
--- a/pdns/pdnsutil.cc
+++ b/pdns/pdnsutil.cc
@@ -267,7 +267,7 @@ bool rectifyZone(DNSSECKeeper& dk, const DNSName& zone)
         sd.db->updateDNSSECOrderNameAndAuth(sd.domain_id, zone, qname, ordername, true, QType::DS);
       if (!auth || nsset.count(qname)) {
         ordername.clear();
-        if(isOptOut)
+        if(isOptOut && !dsnames.count(qname))
           sd.db->updateDNSSECOrderNameAndAuth(sd.domain_id, zone, qname, ordername, false, QType::NS);
         sd.db->updateDNSSECOrderNameAndAuth(sd.domain_id, zone, qname, ordername, false, QType::A);
         sd.db->updateDNSSECOrderNameAndAuth(sd.domain_id, zone, qname, ordername, false, QType::AAAA);

