commit 9a56220167d02bbcb66a81b7553f4eb4da939945
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Sep 24 17:02:08 2010 +0100

    maildir: Added extra asserts.

diff --git a/src/lib-storage/index/maildir/maildir-save.c b/src/lib-storage/index/maildir/maildir-save.c
index eae063251..9bbee8498 100644
--- a/src/lib-storage/index/maildir/maildir-save.c
+++ b/src/lib-storage/index/maildir/maildir-save.c
@@ -76,6 +76,9 @@ static int maildir_file_move(struct maildir_save_context *ctx,
 	struct mail_storage *storage = &ctx->mbox->storage->storage;
 	const char *tmp_path, *new_path;
 
+	i_assert(*destname != '\0');
+	i_assert(*mf->tmp_name != '\0');
+
 	/* if we have flags, we'll move it to cur/ directly, because files in
 	   new/ directory can't have flags. alternative would be to write it
 	   in new/ and set the flags dirty in index file, but in that case
diff --git a/src/lib-storage/index/maildir/maildir-sync-index.c b/src/lib-storage/index/maildir/maildir-sync-index.c
index c7e4d4402..bd62d1be5 100644
--- a/src/lib-storage/index/maildir/maildir-sync-index.c
+++ b/src/lib-storage/index/maildir/maildir-sync-index.c
@@ -120,6 +120,8 @@ static int maildir_sync_flags(struct maildir_mailbox *mbox, const char *path,
 	fname++;
 	dir = t_strdup_until(path, fname);
 
+	i_assert(*fname != '\0');
+
 	/* get the current flags and keywords */
 	maildir_filename_get_flags(ctx->keywords_sync_ctx,
 				   fname, &ctx->flags, &ctx->keywords);
diff --git a/src/lib-storage/index/maildir/maildir-sync.c b/src/lib-storage/index/maildir/maildir-sync.c
index 64f245a2c..f257958c5 100644
--- a/src/lib-storage/index/maildir/maildir-sync.c
+++ b/src/lib-storage/index/maildir/maildir-sync.c
@@ -429,6 +429,8 @@ maildir_scan_dir(struct maildir_sync_context *ctx, bool new_dir, bool final)
 
 		flags = 0;
 		if (move_new) {
+			i_assert(dp->d_name[0] != '\0');
+
 			str_truncate(src, 0);
 			str_truncate(dest, 0);
 			str_printfa(src, "%s/%s", ctx->new_dir, dp->d_name);

