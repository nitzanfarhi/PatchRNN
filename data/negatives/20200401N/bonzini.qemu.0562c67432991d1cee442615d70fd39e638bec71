commit 0562c67432991d1cee442615d70fd39e638bec71
Author: Kusanagi Kouichi <slash@ac.auone-net.jp>
Date:   Sat Oct 30 11:52:39 2010 +0900

    virtio-9p: Check the return value of llistxattr.
    
    If llistxattr returned 0, qemu aborts.
    
    Signed-off-by: Kusanagi Kouichi <slash@ac.auone-net.jp>
    Signed-off-by: Venkateswararao Jujjuri <jvrao@linux.vnet.ibm.com>

diff --git a/hw/virtio-9p-xattr.c b/hw/virtio-9p-xattr.c
index 175f372c39..1aab081de2 100644
--- a/hw/virtio-9p-xattr.c
+++ b/hw/virtio-9p-xattr.c
@@ -73,6 +73,9 @@ ssize_t v9fs_list_xattr(FsContext *ctx, const char *path,
 
     /* Get the actual len */
     xattr_len = llistxattr(rpath(ctx, path), value, 0);
+    if (xattr_len <= 0) {
+        return xattr_len;
+    }
 
     /* Now fetch the xattr and find the actual size */
     orig_value = qemu_malloc(xattr_len);

