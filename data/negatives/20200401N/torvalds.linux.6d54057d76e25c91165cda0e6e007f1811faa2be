commit 6d54057d76e25c91165cda0e6e007f1811faa2be
Author: Steven Rostedt <srostedt@redhat.com>
Date:   Thu Jan 27 22:33:26 2011 -0500

    tracing/filter: Have no filter return a match
    
    The n_preds field of a file can change at anytime, and even can become
    zero, just as the filter is about to be processed by an event.
    In the case that is zero on entering the filter, return 1, telling
    the caller the event matchs and should be trace.
    
    Also use a variable and assign it with ACCESS_ONCE() such that the
    count stays consistent within the function.
    
    Cc: Tom Zanussi <tzanussi@gmail.com>
    Signed-off-by: Steven Rostedt <rostedt@goodmis.org>

diff --git a/kernel/trace/trace_events_filter.c b/kernel/trace/trace_events_filter.c
index 36d40104b17f..7275f0310ed8 100644
--- a/kernel/trace/trace_events_filter.c
+++ b/kernel/trace/trace_events_filter.c
@@ -383,9 +383,14 @@ int filter_match_preds(struct event_filter *filter, void *rec)
 	int match, top = 0, val1 = 0, val2 = 0;
 	int stack[MAX_FILTER_PRED];
 	struct filter_pred *pred;
+	int n_preds = ACCESS_ONCE(filter->n_preds);
 	int i;
 
-	for (i = 0; i < filter->n_preds; i++) {
+	/* no filter is considered a match */
+	if (!n_preds)
+		return 1;
+
+	for (i = 0; i < n_preds; i++) {
 		pred = filter->preds[i];
 		if (!pred->pop_n) {
 			match = pred->fn(pred, rec, val1, val2);

