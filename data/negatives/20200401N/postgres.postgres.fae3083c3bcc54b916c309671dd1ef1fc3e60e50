commit fae3083c3bcc54b916c309671dd1ef1fc3e60e50
Author: Andrew Dunstan <andrew@dunslane.net>
Date:   Fri Feb 20 02:57:21 2009 +0000

    Reconnect to the right database when using parallel restore with -C. Fixes bug reported by Olivier Prenant

diff --git a/src/bin/pg_dump/pg_backup_archiver.c b/src/bin/pg_dump/pg_backup_archiver.c
index 076bb0bf6f..0b46e1097b 100644
--- a/src/bin/pg_dump/pg_backup_archiver.c
+++ b/src/bin/pg_dump/pg_backup_archiver.c
@@ -15,7 +15,7 @@
  *
  *
  * IDENTIFICATION
- *		$PostgreSQL: pgsql/src/bin/pg_dump/pg_backup_archiver.c,v 1.162 2009/02/02 20:07:36 adunstan Exp $
+ *		$PostgreSQL: pgsql/src/bin/pg_dump/pg_backup_archiver.c,v 1.163 2009/02/20 02:57:21 adunstan Exp $
  *
  *-------------------------------------------------------------------------
  */
@@ -487,6 +487,7 @@ restore_toc_entry(ArchiveHandle *AH, TocEntry *te,
 		{
 			ahlog(AH, 1, "connecting to new database \"%s\"\n", te->tag);
 			_reconnectToDB(AH, te->tag);
+			ropt->dbname = strdup(te->tag);
 		}
 	}
 

