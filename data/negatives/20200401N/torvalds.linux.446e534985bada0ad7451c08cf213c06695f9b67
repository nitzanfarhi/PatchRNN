commit 446e534985bada0ad7451c08cf213c06695f9b67
Author: Trond Myklebust <Trond.Myklebust@netapp.com>
Date:   Wed Oct 3 15:58:38 2007 -0400

    NFS: Fix a bug in nfs_open_revalidate()
    
    We want to set the verifier when the call to nfs4_open_revalidate()
    _succeeds_.
    
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>

diff --git a/fs/nfs/dir.c b/fs/nfs/dir.c
index 166a833be661..d58bfb81354e 100644
--- a/fs/nfs/dir.c
+++ b/fs/nfs/dir.c
@@ -1078,7 +1078,7 @@ static int nfs_open_revalidate(struct dentry *dentry, struct nameidata *nd)
 	lock_kernel();
 	verifier = nfs_save_change_attribute(dir);
 	ret = nfs4_open_revalidate(dir, dentry, openflags, nd);
-	if (!ret)
+	if (ret == 1)
 		nfs_set_verifier(dentry, verifier);
 	unlock_kernel();
 out:

