commit a61acc3c78df14bb9b7bfefb2cc771fcda15b8fe
Author: Brian Foster <bfoster@redhat.com>
Date:   Tue Jul 24 13:43:08 2018 -0700

    xfs: use ->t_dfops in log recovery intent processing
    
    xlog_finish_defer_ops() processes the deferred operations collected
    over the entire intent recovery sequence. We can't xfs_defer_init()
    here because the dfops is already populated. Attach it manually and
    eliminate the last caller of xfs_defer_finish() that doesn't pass
    ->t_dfops.
    
    Signed-off-by: Brian Foster <bfoster@redhat.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Reviewed-by: Bill O'Donnell <billodo@redhat.com>
    Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
    Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>

diff --git a/fs/xfs/xfs_log_recover.c b/fs/xfs/xfs_log_recover.c
index cbac943896f4..3289811eb076 100644
--- a/fs/xfs/xfs_log_recover.c
+++ b/fs/xfs/xfs_log_recover.c
@@ -4854,6 +4854,8 @@ xlog_finish_defer_ops(
 			0, XFS_TRANS_RESERVE, &tp);
 	if (error)
 		return error;
+	/* dfops is already populated so assign it manually */
+	tp->t_dfops = dfops;
 
 	error = xfs_defer_finish(&tp, dfops);
 	if (error)

