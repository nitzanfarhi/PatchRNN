commit e658c6027bb50d3b1cd43ce1e208c18ddcf8af5d
Author: Wolfgang Bumiller <w.bumiller@proxmox.com>
Date:   Thu Jan 7 12:59:54 2016 +0100

    cgfs: fix dorealloc's batch allocation
    
    The initial check should use real lengths as with modulo a
    new required length of eg. 52 would be considered smaller
    than an old length of 48 (2 < 48).
    
    To get the 'batches' count 'newlen' must be divided and not
    taken modulo BATCH_SIZE. Otherwise '101', which would need a
    3rd batch to reach 150, would end up with two (2*50 = 100
    bytes) and thereby be truncated instead.
    
    Signed-off-by: Wolfgang Bumiller <w.bumiller@proxmox.com>
    Signed-off-by: Serge Hallyn <serge.hallyn@ubuntu.com>

diff --git a/cgfs.c b/cgfs.c
index 0659e9e..681a478 100644
--- a/cgfs.c
+++ b/cgfs.c
@@ -75,9 +75,9 @@ static inline void drop_trailing_newlines(char *s)
 static void dorealloc(char **mem, size_t oldlen, size_t newlen)
 {
 	int batches;
-	if (newlen % BATCH_SIZE <= oldlen % BATCH_SIZE)
+	if (newlen <= oldlen)
 		return;
-	batches = (newlen % BATCH_SIZE) + 1;
+	batches = (newlen / BATCH_SIZE) + 1;
 	if (!*mem) {
 		do {
 			*mem = malloc(batches * BATCH_SIZE);

