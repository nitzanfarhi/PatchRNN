commit aaad077638be1a25871bcae5e43952d6b63abfca
Author: Rafael J. Wysocki <rjw@sisk.pl>
Date:   Fri Dec 5 01:07:51 2008 +0100

    ACPI: Fix ACPI battery regression introduced by commit 558073
    
    Commit 558073dd56707864f09d563b64e7c37c021e89d2 ("ACPI: battery: Convert
    discharge energy rate to current properly") caused the battery subsystem
    to report wrong values of the remaining time on battery power and the
    time until fully charged on Toshiba Portege R500 (and presumably on
    other boxes too).
    
    Fix the issue by correcting the conversion from mW to mA.
    
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/acpi/battery.c b/drivers/acpi/battery.c
index a0a178dd189c..4fb3c12ac1d8 100644
--- a/drivers/acpi/battery.c
+++ b/drivers/acpi/battery.c
@@ -173,14 +173,17 @@ static int acpi_battery_get_property(struct power_supply *psy,
 		val->intval = battery->voltage_now * 1000;
 		break;
 	case POWER_SUPPLY_PROP_CURRENT_NOW:
-		val->intval = battery->current_now * 1000;
-		/* if power units are mW, convert to mA by
-		   dividing by current voltage (mV/1000) */
-		if (!battery->power_unit) {
-			if (battery->voltage_now) {
+		val->intval = battery->current_now;
+		if (battery->power_unit) {
+			val->intval *= 1000;
+		} else {
+			/*
+			 * If power units are mW, convert to mA by dividing by
+			 * current voltage.
+			 */
+			if (battery->voltage_now)
 				val->intval /= battery->voltage_now;
-				val->intval *= 1000;
-			} else
+			else
 				val->intval = -1;
 		}
 		break;

