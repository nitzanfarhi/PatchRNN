commit af0f7f8871b488972358996cff2f050373d3ae15
Author: Gerardo Ganis <Gerardo.Ganis@cern.ch>
Date:   Wed Aug 25 10:31:23 2010 +0000

    Import fixes 34988 and 34989 from the vendor branch
    
    
    git-svn-id: http://root.cern.ch/svn/root/trunk@34990 27541ba8-7e3a-0410-8455-c3a389f83636

diff --git a/net/xrootd/src/xrootd/src/XrdCms/XrdCmsPrepare.cc b/net/xrootd/src/xrootd/src/XrdCms/XrdCmsPrepare.cc
index 02e757b2df..ffd9be19d2 100644
--- a/net/xrootd/src/xrootd/src/XrdCms/XrdCmsPrepare.cc
+++ b/net/xrootd/src/xrootd/src/XrdCms/XrdCmsPrepare.cc
@@ -354,7 +354,7 @@ int XrdCmsPrepare::setParms(int rcnt, int stime, int deco)
 
 int XrdCmsPrepare::setParms(const char *ifpgm, char *ifmsg)
 {if (ifpgm)
-    {char *Slash = (char *) rindex(ifpgm, '/');
+    {const char *Slash = rindex(ifpgm, '/');
      if (prepif) free(prepif);
      if (Slash && !strcmp(Slash+1, "frm_xfragent")) ifpgm = "";
      prepif = strdup(ifpgm);
diff --git a/net/xrootd/src/xrootd/src/XrdCrypto/XrdCryptosslAux.cc b/net/xrootd/src/xrootd/src/XrdCrypto/XrdCryptosslAux.cc
index 0bce81875b..53ddfa8beb 100644
--- a/net/xrootd/src/xrootd/src/XrdCrypto/XrdCryptosslAux.cc
+++ b/net/xrootd/src/xrootd/src/XrdCrypto/XrdCryptosslAux.cc
@@ -228,6 +228,9 @@ XrdSutBucket *XrdCryptosslX509ExportChain(XrdCryptoX509Chain *chain,
             BIO_free(bmem);
             return bck;
          }
+      } else {
+         DEBUG("Encountered self-signed CA in chain; breaking.  Subject: " << c->Subject());
+         break;
       }
    }
 
diff --git a/net/xrootd/src/xrootd/src/XrdSecgsi/XrdSecProtocolgsi.cc b/net/xrootd/src/xrootd/src/XrdSecgsi/XrdSecProtocolgsi.cc
index 10fa5d6554..75a98e231e 100644
--- a/net/xrootd/src/xrootd/src/XrdSecgsi/XrdSecProtocolgsi.cc
+++ b/net/xrootd/src/xrootd/src/XrdSecgsi/XrdSecProtocolgsi.cc
@@ -1628,7 +1628,6 @@ int XrdSecProtocolgsi::Authenticate(XrdSecCredentials *cred,
                   if (name.find(',') != STR_NPOS) name.erase(name.find(','));
                   PRINT("WARNING: grid map lookup ok, but the requested user is not"
                         " authorized ("<<user<<"). Instead, mapped as " << name << ".");
-                  break;
                }
             } else {
                // No username requested: we default to the first found (to be Globus compliant)

