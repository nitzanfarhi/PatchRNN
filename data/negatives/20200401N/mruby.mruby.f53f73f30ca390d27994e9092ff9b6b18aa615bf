commit f53f73f30ca390d27994e9092ff9b6b18aa615bf
Author: Yukihiro "Matz" Matsumoto <matz@ruby-lang.org>
Date:   Fri Jan 6 14:25:01 2017 +0900

    Should not deallocate shared string referring static; fix #3373

diff --git a/src/string.c b/src/string.c
index ae2e5ccc..d011f60c 100644
--- a/src/string.c
+++ b/src/string.c
@@ -669,7 +669,7 @@ mrb_str_modify(mrb_state *mrb, struct RString *s)
   if (RSTR_SHARED_P(s)) {
     mrb_shared_string *shared = s->as.heap.aux.shared;
 
-    if (shared->refcnt == 1 && s->as.heap.ptr == shared->ptr) {
+    if (shared->nofree == 0 && shared->refcnt == 1 && s->as.heap.ptr == shared->ptr) {
       s->as.heap.ptr = shared->ptr;
       s->as.heap.aux.capa = shared->len;
       RSTR_PTR(s)[s->as.heap.len] = '\0';

