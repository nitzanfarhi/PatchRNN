commit c35de1a131b7d6bd2701b749ebbf91b4bd55d87d
Author: David Conrad <lessen42@gmail.com>
Date:   Wed Sep 5 00:25:29 2007 +0000

    Check that the seekheads were created
    
    Originally committed as revision 10369 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavformat/matroskaenc.c b/libavformat/matroskaenc.c
index d7726bcd2..484a004a9 100644
--- a/libavformat/matroskaenc.c
+++ b/libavformat/matroskaenc.c
@@ -632,6 +632,8 @@ static int mkv_write_header(AVFormatContext *s)
     // currently defined level 1 element
     mkv->main_seekhead    = mkv_start_seekhead(pb, mkv->segment_offset, 10);
     mkv->cluster_seekhead = mkv_start_seekhead(pb, mkv->segment_offset, 0);
+    if (mkv->main_seekhead == NULL || mkv->cluster_seekhead == NULL)
+        return AVERROR(ENOMEM);
 
     if (mkv_add_seekhead_entry(mkv->main_seekhead, MATROSKA_ID_INFO, url_ftell(pb)) < 0)
         return -1;

