commit 58d8be5b7532d45a4537e21e9fec5607fe65b8a3
Author: aland <aland>
Date:   Tue Dec 27 17:43:47 2005 +0000

            No query, die

diff --git a/src/modules/rlm_sqlcounter/rlm_sqlcounter.c b/src/modules/rlm_sqlcounter/rlm_sqlcounter.c
index 2e7787bcb..1c6d79b0a 100644
--- a/src/modules/rlm_sqlcounter/rlm_sqlcounter.c
+++ b/src/modules/rlm_sqlcounter/rlm_sqlcounter.c
@@ -448,6 +448,14 @@ static int sqlcounter_instantiate(CONF_SECTION *conf, void **instance)
 		return -1;
 	}
 
+	/*
+	 *	No query, die.
+	 */
+	if (data->query == NULL) {
+		radlog(L_ERR, "rlm_sqlcounter: 'query' must be set.");
+		return -1;
+	}
+
 	/*
 	 *	Safe characters list for sql queries. Everything else is
 	 *	replaced with their mime-encoded equivalents.

