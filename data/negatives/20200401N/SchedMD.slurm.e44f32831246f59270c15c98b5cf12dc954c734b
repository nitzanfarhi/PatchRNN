commit e44f32831246f59270c15c98b5cf12dc954c734b
Author: Danny Auble <da@llnl.gov>
Date:   Wed Mar 2 01:52:50 2011 +0000

    fix for checking if the block is freeing so we don't remove it

diff --git a/src/plugins/select/bluegene/plugin/dynamic_block.c b/src/plugins/select/bluegene/plugin/dynamic_block.c
index fdb9ea2661..698aec554d 100644
--- a/src/plugins/select/bluegene/plugin/dynamic_block.c
+++ b/src/plugins/select/bluegene/plugin/dynamic_block.c
@@ -316,8 +316,9 @@ extern List create_dynamic_block(List block_list,
 	itr = list_iterator_create(block_list);
 	itr2 = list_iterator_create(block_list);
 	while ((bg_record = (bg_record_t *) list_next(itr)) != NULL) {
-		/* never check a block with a job running */
-		if (bg_record->job_running != NO_JOB_RUNNING)
+		/* never check a block being deleted or with a job running */
+		if (bg_record->free_cnt
+		    || bg_record->job_running != NO_JOB_RUNNING)
 			continue;
 
 		/* Here we are only looking for the first

