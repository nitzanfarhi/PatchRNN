commit 8826f2e64c32a46ae2d7fe2561fd2fdc73cf679c
Author: Bron Gondwana <brong@fastmail.fm>
Date:   Fri Aug 23 11:37:15 2013 +1000

    imap: xmeid command
    
    takes a single atom, i.e.
    
    TAG XMEID MYID
    
    And sets that ID for mboxevents

diff --git a/imap/imapd.c b/imap/imapd.c
index b3c4a2dc6..4cfb5eff7 100644
--- a/imap/imapd.c
+++ b/imap/imapd.c
@@ -425,6 +425,7 @@ static void cmd_enable(char* tag);
 
 static void cmd_xkillmy(const char *tag, const char *cmdname);
 static void cmd_xforever(const char *tag);
+static void cmd_xmeid(const char *tag, const char *id);
 
 static int parsecreateargs(struct dlist **extargs);
 
@@ -2273,6 +2274,14 @@ static void cmdloop(void)
 		if (c != '\n') goto extraargs;
 		cmd_xforever(tag.s);
 	    }
+	    else if (!strcmp(cmd.s, "Xmeid")) {
+		if (c != ' ') goto missingargs;
+		c = getastring(imapd_in, imapd_out, &arg1);
+		if (c == EOF) goto missingargs;
+		if (c == '\r') c = prot_getc(imapd_in);
+		if (c != '\n') goto extraargs;
+		cmd_xmeid(tag.s, arg1.s);
+	    }
 
 	    else goto badcmd;
 	    break;
@@ -12956,9 +12965,6 @@ static void cmd_enable(char *tag)
 		error_message(IMAP_OK_COMPLETED));
 }
 
-/*
- * Perform a GETQUOTAROOT command
- */
 static void cmd_xkillmy(const char *tag, const char *cmdname)
 {
     char *cmd = xstrdup(cmdname);
@@ -12993,3 +12999,11 @@ static void cmd_xforever(const char *tag)
 
     prot_printf(imapd_out, "%s OK %s\r\n", tag, error_message(r));
 }
+
+static void cmd_xmeid(const char *tag, const char *id)
+{
+    mboxevent_set_client_id(id);
+
+    prot_printf(imapd_out, "%s OK %s\r\n", tag,
+		error_message(IMAP_OK_COMPLETED));
+}

