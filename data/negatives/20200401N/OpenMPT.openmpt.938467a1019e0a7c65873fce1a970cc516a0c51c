commit 938467a1019e0a7c65873fce1a970cc516a0c51c
Author: Johannes Schultz <saga-games@users.sourceforge.net>
Date:   Sat Nov 17 16:32:02 2012 +0000

    [Fix] FT2 Compatibility: lxx/rxx shouldn't set the effect memory of Pxx (test case: PanSlideMem.xm).
    [Mod] OpenMPT: Version is now 1.20.04.04
    
    git-svn-id: https://source.openmpt.org/svn/openmpt/trunk/OpenMPT@1431 56274372-70c3-4bfc-bfc3-4c3a0b034d27

diff --git a/mptrack/version.h b/mptrack/version.h
index 7e1f68e5a..ce0941015 100644
--- a/mptrack/version.h
+++ b/mptrack/version.h
@@ -19,7 +19,7 @@
 #define VER_MAJORMAJOR				1
 #define VER_MAJOR					20
 #define VER_MINOR					04
-#define VER_MINORMINOR				03
+#define VER_MINORMINOR				04
 
 //Creates version number from version parts that appears in version string.
 //For example MAKE_VERSION_NUMERIC(1,17,02,28) gives version number of 
diff --git a/soundlib/Snd_fx.cpp b/soundlib/Snd_fx.cpp
index e4f0b0937..5074c6599 100644
--- a/soundlib/Snd_fx.cpp
+++ b/soundlib/Snd_fx.cpp
@@ -2039,11 +2039,11 @@ BOOL CSoundFile::ProcessEffects()
 					break;
 
 				case VOLCMD_PANSLIDELEFT:
-					PanningSlide(pChn, vol);
+					PanningSlide(pChn, vol, !IsCompatibleMode(TRK_FASTTRACKER2));
 					break;
 
 				case VOLCMD_PANSLIDERIGHT:
-					PanningSlide(pChn, vol << 4);
+					PanningSlide(pChn, vol << 4, !IsCompatibleMode(TRK_FASTTRACKER2));
 					break;
 
 				case VOLCMD_PORTAUP:
@@ -3074,13 +3074,18 @@ void CSoundFile::VolumeSlide(ModChannel *pChn, UINT param)
 }
 
 
-void CSoundFile::PanningSlide(ModChannel *pChn, UINT param)
-//---------------------------------------------------------
+void CSoundFile::PanningSlide(ModChannel *pChn, UINT param, bool memory)
+//----------------------------------------------------------------------
 {
-	if (param)
-		pChn->nOldPanSlide = param;
-	else
-		param = pChn->nOldPanSlide;
+	if(memory)
+	{
+		// FT2 compatibility: Use effect memory (lxx and rxx in XM shouldn't use effect memory).
+		// Test case: PanSlideMem.xm
+		if(param)
+			pChn->nOldPanSlide = param;
+		else
+			param = pChn->nOldPanSlide;
+	}
 
 	if((GetType() & (MOD_TYPE_XM | MOD_TYPE_MT2)))
 	{
diff --git a/soundlib/Sndfile.h b/soundlib/Sndfile.h
index ad888b109..76f8f2e21 100644
--- a/soundlib/Sndfile.h
+++ b/soundlib/Sndfile.h
@@ -568,7 +568,7 @@ protected:
 	void Vibrato(ModChannel *pChn, UINT param);
 	void FineVibrato(ModChannel *pChn, UINT param);
 	void VolumeSlide(ModChannel *pChn, UINT param);
-	void PanningSlide(ModChannel *pChn, UINT param);
+	void PanningSlide(ModChannel *pChn, UINT param, bool memory = true);
 	void ChannelVolSlide(ModChannel *pChn, UINT param);
 	void FineVolumeUp(ModChannel *pChn, UINT param);
 	void FineVolumeDown(ModChannel *pChn, UINT param);

