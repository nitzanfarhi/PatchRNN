commit 8df127456f29c719eb2b458018298b1980f1218e
Author: Jon Hunter <jonathanh@nvidia.com>
Date:   Thu Jun 30 11:56:26 2016 +0100

    soc/tegra: pmc: Enable XUSB partitions on boot
    
    The Tegra XHCI driver does not currently manage the Tegra XUSB power
    partitions and so it these partitions have not been enabled by the
    bootloader then the system will crash when probing the XHCI device.
    
    While proper support for managing the power partitions is being
    developed to the XHCI driver for Tegra, for now power on all the XUSB
    partitions for USB host and super-speed on boot if the XHCI driver is
    enabled.
    
    Signed-off-by: Jon Hunter <jonathanh@nvidia.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>

diff --git a/drivers/soc/tegra/pmc.c b/drivers/soc/tegra/pmc.c
index 7199726198e1..71c834f3847e 100644
--- a/drivers/soc/tegra/pmc.c
+++ b/drivers/soc/tegra/pmc.c
@@ -837,6 +837,18 @@ static void tegra_powergate_add(struct tegra_pmc *pmc, struct device_node *np)
 	if (!IS_ENABLED(CONFIG_PM_GENERIC_DOMAINS))
 		goto power_on_cleanup;
 
+	/*
+	 * FIXME: If XHCI is enabled for Tegra, then power-up the XUSB
+	 * host and super-speed partitions. Once the XHCI driver
+	 * manages the partitions itself this code can be removed. Note
+	 * that we don't register these partitions with the genpd core
+	 * to avoid it from powering down the partitions as they appear
+	 * to be unused.
+	 */
+	if (IS_ENABLED(CONFIG_USB_XHCI_TEGRA) &&
+	    (id == TEGRA_POWERGATE_XUSBA || id == TEGRA_POWERGATE_XUSBC))
+		goto power_on_cleanup;
+
 	pm_genpd_init(&pg->genpd, NULL, off);
 
 	err = of_genpd_add_provider_simple(np, &pg->genpd);

