commit 5966f2ddcda452455f8ab518b7cba221b5234a94
Author: Eliad Peller <eliad@wizery.com>
Date:   Tue Jul 19 12:57:13 2011 +0300

    cfg80211: enter psm when working as p2p_cli
    
    cfg80211_netdev_notifier_call() is configuring psm in case
    of NL80211_IFTYPE_STATION interface type (on NETDEV_UP).
    do the same for NL80211_IFTYPE_P2P_CLIENT interface type.
    
    Signed-off-by: Eliad Peller <eliad@wizery.com>
    Reviewed-by: Johannes Berg <johannes@sipsolutions.net>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/wireless/core.c b/net/wireless/core.c
index 112959d5256a..645437cfc464 100644
--- a/net/wireless/core.c
+++ b/net/wireless/core.c
@@ -922,7 +922,8 @@ static int cfg80211_netdev_notifier_call(struct notifier_block * nb,
 		 * Configure power management to the driver here so that its
 		 * correctly set also after interface type changes etc.
 		 */
-		if (wdev->iftype == NL80211_IFTYPE_STATION &&
+		if ((wdev->iftype == NL80211_IFTYPE_STATION ||
+		     wdev->iftype == NL80211_IFTYPE_P2P_CLIENT) &&
 		    rdev->ops->set_power_mgmt)
 			if (rdev->ops->set_power_mgmt(wdev->wiphy, dev,
 						      wdev->ps,

