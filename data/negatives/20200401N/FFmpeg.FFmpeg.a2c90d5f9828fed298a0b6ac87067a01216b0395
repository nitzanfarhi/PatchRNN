commit a2c90d5f9828fed298a0b6ac87067a01216b0395
Author: Michael Niedermayer <michael@niedermayer.cc>
Date:   Wed Jul 13 19:08:45 2016 +0200

    avformat/mux: Apply auto bsfs in av_write_frame() too
    
    Reviewed-by: Steven Liu <lingjiujianke@gmail.com>
    Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>

diff --git a/libavformat/mux.c b/libavformat/mux.c
index 5cb0ca7482..d674bd4a76 100644
--- a/libavformat/mux.c
+++ b/libavformat/mux.c
@@ -893,6 +893,10 @@ int av_write_frame(AVFormatContext *s, AVPacket *pkt)
         return 1;
     }
 
+    ret = do_packet_auto_bsf(s, pkt);
+    if (ret <= 0)
+        return ret;
+
 #if FF_API_COMPUTE_PKT_FIELDS2 && FF_API_LAVF_AVCTX
     ret = compute_muxer_pkt_fields(s, s->streams[pkt->stream_index], pkt);
 

