commit 28d88746e436c79870a7f5b06e9b0ddd442dd2a0
Author: Victor Julien <victor@inliniac.net>
Date:   Thu Feb 23 17:43:53 2012 +0100

    Fix compiler warning and silence complaining unittests.

diff --git a/src/detect-engine-mpm.c b/src/detect-engine-mpm.c
index 52f3521a..b08c6dd3 100644
--- a/src/detect-engine-mpm.c
+++ b/src/detect-engine-mpm.c
@@ -170,13 +170,19 @@ uint32_t PacketPatternSearchWithStreamCtx(DetectEngineThreadCtx *det_ctx,
 {
     SCEnter();
 
-    uint32_t ret;
+    uint32_t ret = 0;
+
+    if (p->flowflags & FLOW_PKT_TOSERVER) {
+        if (det_ctx->sgh->mpm_stream_ctx_ts == NULL)
+            SCReturnInt(0);
 
-    if (p->flowflags & FLOW_PKT_TOSERVER && det_ctx->sgh->mpm_stream_ctx_ts != NULL) {
         ret = mpm_table[det_ctx->sgh->mpm_stream_ctx_ts->mpm_type].
             Search(det_ctx->sgh->mpm_stream_ctx_ts, &det_ctx->mtc, &det_ctx->pmq,
                    p->payload, p->payload_len);
-    } else if (p->flowflags & FLOW_PKT_TOCLIENT && det_ctx->sgh->mpm_stream_ctx_tc != NULL) {
+    } else {
+        if (det_ctx->sgh->mpm_stream_ctx_tc == NULL)
+            SCReturnInt(0);
+
         ret = mpm_table[det_ctx->sgh->mpm_stream_ctx_tc->mpm_type].
             Search(det_ctx->sgh->mpm_stream_ctx_tc, &det_ctx->mtc, &det_ctx->pmq,
                    p->payload, p->payload_len);

