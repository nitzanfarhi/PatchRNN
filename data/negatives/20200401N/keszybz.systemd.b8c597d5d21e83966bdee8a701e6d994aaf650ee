commit b8c597d5d21e83966bdee8a701e6d994aaf650ee
Author: Lennart Poettering <lennart@poettering.net>
Date:   Thu Apr 8 03:48:52 2010 +0200

    service: verify PID is valid when reading it from PID file

diff --git a/service.c b/service.c
index 3d840cbd9..832c7b326 100644
--- a/service.c
+++ b/service.c
@@ -839,7 +839,13 @@ static int service_load_pid_file(Service *s) {
         if ((unsigned long) (pid_t) p != p)
                 return -ERANGE;
 
-        s->main_pid = p;
+        if (kill((pid_t) p, 0) < 0 && errno != EPERM) {
+                log_warning("PID %llu read from file %s does not exist. Your service or init script might be broken.",
+                            (unsigned long long) p, s->pid_file);
+                return -ESRCH;
+        }
+
+        s->main_pid = (pid_t) p;
         s->main_pid_known = true;
 
         return 0;

