commit 920f8bf7f366ed20935669f782ffcb5a36d5df8f
Author: Grygorii Strashko <grygorii.strashko@ti.com>
Date:   Wed Nov 30 10:53:51 2016 -0600

    soc: ti: qmss: fix the case when !SMP
    
    The irq_set_affinity_hint() will always fail when !SMP and
    Networking will fail on Keystone 2 devices in this case.
    Hence, fix by ignoring IRQ affinity settings when !SMP.
    
    Signed-off-by: Grygorii Strashko <grygorii.strashko@ti.com>
    Acked-by: Santosh Shilimkar <ssantosh@kernel.org>
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>

diff --git a/drivers/soc/ti/knav_qmss_queue.c b/drivers/soc/ti/knav_qmss_queue.c
index b73e3534f67b..eacad57f2977 100644
--- a/drivers/soc/ti/knav_qmss_queue.c
+++ b/drivers/soc/ti/knav_qmss_queue.c
@@ -1228,7 +1228,7 @@ static int knav_setup_queue_range(struct knav_device *kdev,
 
 		range->num_irqs++;
 
-		if (oirq.args_count == 3)
+		if (IS_ENABLED(CONFIG_SMP) && oirq.args_count == 3)
 			range->irqs[i].cpu_map =
 				(oirq.args[2] & 0x0000ff00) >> 8;
 	}

