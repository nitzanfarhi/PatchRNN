commit 123df01e8e046d6065089e1bff29aa3fc48d4420
Author: Paul Mundt <lethal@linux-sh.org>
Date:   Thu May 24 19:24:18 2012 +0900

    sh: intc: Allocate subgroup virq backing desc directly.
    
    This switches to using irq_alloc_desc() directly for subgroup IRQs.
    We still need to call activate_irq() on these in order to make them
    requestable, at least up until these get moved in to their own irq
    domain..
    
    Signed-off-by: Paul Mundt <lethal@linux-sh.org>

diff --git a/drivers/sh/intc/virq.c b/drivers/sh/intc/virq.c
index 93cec21e788b..f30ac9354ff2 100644
--- a/drivers/sh/intc/virq.c
+++ b/drivers/sh/intc/virq.c
@@ -219,12 +219,14 @@ restart:
 		if (radix_tree_deref_retry(entry))
 			goto restart;
 
-		irq = create_irq();
+		irq = irq_alloc_desc(numa_node_id());
 		if (unlikely(irq < 0)) {
 			pr_err("no more free IRQs, bailing..\n");
 			break;
 		}
 
+		activate_irq(irq);
+
 		pr_info("Setting up a chained VIRQ from %d -> %d\n",
 			irq, entry->pirq);
 

