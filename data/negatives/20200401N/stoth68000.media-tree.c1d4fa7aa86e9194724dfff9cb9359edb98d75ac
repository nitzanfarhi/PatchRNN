commit c1d4fa7aa86e9194724dfff9cb9359edb98d75ac
Author: Johan Hedberg <johan.hedberg@intel.com>
Date:   Thu Jul 17 15:14:50 2014 +0300

    Bluetooth: Fix resetting remote authentication requirement after pairing
    
    When a new hci_conn object is created the remote SSP authentication
    requirement is set to the invalid value 0xff to indicate that it is
    unknown. Once pairing completes however the code was leaving it as-is.
    In case a new pairing happens over the same connection it is important
    that we reset the value back to unknown so that the pairing code doesn't
    make false assumptions about the requirements.
    
    Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

diff --git a/net/bluetooth/hci_event.c b/net/bluetooth/hci_event.c
index 1bd4de7e74fc..495d6d5c1146 100644
--- a/net/bluetooth/hci_event.c
+++ b/net/bluetooth/hci_event.c
@@ -3870,6 +3870,9 @@ static void hci_simple_pair_complete_evt(struct hci_dev *hdev,
 	if (!conn)
 		goto unlock;
 
+	/* Reset the authentication requirement to unknown */
+	conn->remote_auth = 0xff;
+
 	/* To avoid duplicate auth_failed events to user space we check
 	 * the HCI_CONN_AUTH_PEND flag which will be set if we
 	 * initiated the authentication. A traditional auth_complete

