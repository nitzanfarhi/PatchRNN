commit ee68371f41def2fff7ef92f715c858bbe1b36c2f
Author: Nick Mathewson <nickm@torproject.org>
Date:   Sat Feb 28 04:25:54 2004 +0000

    Stop answering "end" with "end"
    
    
    svn:r1150

diff --git a/src/or/connection_edge.c b/src/or/connection_edge.c
index 3a8f81b1d..08cf97144 100644
--- a/src/or/connection_edge.c
+++ b/src/or/connection_edge.c
@@ -308,7 +308,9 @@ int connection_edge_process_relay_cell(cell_t *cell, circuit_t *circ, connection
         connection_mark_for_close(conn, END_STREAM_REASON_DONE);
       }
 #else
-      connection_mark_for_close(conn, END_STREAM_REASON_DONE);
+      /* We just *got* an end; no reason to send one. */
+      conn->has_sent_end = 1;
+      connection_mark_for_close(conn, 0);
 #endif
       return 0;
     case RELAY_COMMAND_EXTEND:

