commit 52501a330b7c29d19cde32fa0bbd6bb11ae9d27e
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Wed May 11 17:42:24 2005 +0000

    Filter out some TE actions
    
    CVS patchset: 6230
    CVS date: 2005/05/11 17:42:24
    
    Mercurial revision: d7a8c036094e60f79e473f8bfdb46486c478e50a

diff --git a/crm/crmd/tengine.c b/crm/crmd/tengine.c
index 265d16752..6398509e8 100644
--- a/crm/crmd/tengine.c
+++ b/crm/crmd/tengine.c
@@ -104,7 +104,18 @@ do_te_invoke(long long action,
 	HA_Message *cmd = NULL;
 	
 
-	if(is_set(fsa_input_register, R_TE_CONNECTED) == FALSE){
+	if(AM_I_DC == FALSE) {
+		crm_debug("Not DC: No need to invoke the TE (anymore): %s",
+			  fsa_action2string(action));
+		return I_NULL;
+		
+	} else if(fsa_state != S_TRANSITION_ENGINE && action ^ A_TE_CANCEL) {
+		crm_debug("No need to invoke the TE (%s) in state %s",
+			  fsa_action2string(action),
+			  fsa_state2string(fsa_state));
+		return I_NULL;
+		
+	} else if(is_set(fsa_input_register, R_TE_CONNECTED) == FALSE) {
 		if(te_subsystem->pid > 0) {
 			int pid_status = -1;
 			int rc = waitpid(

