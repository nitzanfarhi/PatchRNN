commit b101c36f30a1d205c8b8b59ee0cf273937ed4d18
Author: dirk <dirk@git.imagemagick.org>
Date:   Fri Oct 7 11:21:33 2016 +0200

    Some fixes for connected-components:area-threshold.

diff --git a/MagickCore/vision.c b/MagickCore/vision.c
index 22209b87f..e9880e1f7 100644
--- a/MagickCore/vision.c
+++ b/MagickCore/vision.c
@@ -496,6 +496,7 @@ MagickExport Image *ConnectedComponentsImage(const Image *image,
             j=(ssize_t) GetPixelIndex(component_image,p);
             if (j != i)
               object[j].census++;
+            p+=GetPixelChannels(component_image);
           }
         }
         census=0;
@@ -527,7 +528,7 @@ MagickExport Image *ConnectedComponentsImage(const Image *image,
           for (x=0; x < (ssize_t) bounding_box.width; x++)
           {
             if ((ssize_t) GetPixelIndex(component_image,q) == i)
-              SetPixelIndex(image,(Quantum) id,q);
+              SetPixelIndex(component_image,(Quantum) id,q);
             q+=GetPixelChannels(component_image);
           }
           if (SyncCacheViewAuthenticPixels(component_view,exception) == MagickFalse)

