commit 06460aeaa26ed4a86b92c8451365d3f48abd3786
Author: Tejun Heo <htejun@gmail.com>
Date:   Wed Aug 17 13:08:52 2005 +0900

    [PATCH] sil24: add testing for PCI fault
    
    03_sil24_add-pci-fault-check.patch
    
            On entry to interrupt handler, PORT_SLOT_STAT register is read
            first.  Check if PCI fault or device removal has occurred by
            testing the value for 0xffffffff.
    
    Signed-off-by: Tejun Heo <htejun@gmail.com>
    
     sata_sil24.c |    6 ++++++
     1 files changed, 6 insertions(+)
    Signed-off-by: Jeff Garzik <jgarzik@pobox.com>

diff --git a/drivers/scsi/sata_sil24.c b/drivers/scsi/sata_sil24.c
index 0f810cdd3cc2..c9318bda46a3 100644
--- a/drivers/scsi/sata_sil24.c
+++ b/drivers/scsi/sata_sil24.c
@@ -527,6 +527,12 @@ static irqreturn_t sil24_interrupt(int irq, void *dev_instance, struct pt_regs *
 
 	status = readl(hpriv->host_base + HOST_IRQ_STAT);
 
+	if (status == 0xffffffff) {
+		printk(KERN_ERR DRV_NAME ": IRQ status == 0xffffffff, "
+		       "PCI fault or device removal?\n");
+		goto out;
+	}
+
 	if (!(status & IRQ_STAT_4PORTS))
 		goto out;
 

