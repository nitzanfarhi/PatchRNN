commit 725b812c839643639d6135b1f7fb41e48de465a4
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Fri Apr 10 14:02:08 2015 +0200

    mac80211: extend fast-xmit to driver fragmentation
    
    If the driver handles fragmentation then it wouldn't
    be done in software so we can still use the fast-xmit
    path in that case.
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/mac80211/tx.c b/net/mac80211/tx.c
index 160e1927323d..d983683a8a13 100644
--- a/net/mac80211/tx.c
+++ b/net/mac80211/tx.c
@@ -2450,7 +2450,8 @@ void ieee80211_check_fast_xmit(struct sta_info *sta)
 		goto out;
 
 	/* fast-xmit doesn't handle fragmentation at all */
-	if (local->hw.wiphy->frag_threshold != (u32)-1)
+	if (local->hw.wiphy->frag_threshold != (u32)-1 &&
+	    !local->ops->set_frag_threshold)
 		goto out;
 
 	rcu_read_lock();

