commit 691da91d106b9cee94f0cd3a16518d5286dc3070
Author: Love Hörnquist Åstrand <lha@kth.se>
Date:   Thu Dec 11 04:50:10 2008 +0000

    pass back header/trailer sizes
    
    git-svn-id: svn://svn.h5l.se/heimdal/trunk/heimdal@24056 ec53bebd-3082-4978-b11e-865c3cabbd6b

diff --git a/lib/gssapi/krb5/aeap.c b/lib/gssapi/krb5/aeap.c
index e2d8a7353..65392e9ae 100644
--- a/lib/gssapi/krb5/aeap.c
+++ b/lib/gssapi/krb5/aeap.c
@@ -225,10 +225,14 @@ _gk_wrap_iov_length(OM_uint32 * minor_status,
 	    size += iov[i].buffer.length;
 	    break;
 	case GSS_IOV_BUFFER_TYPE_HEADER:
-	    size += krb5_crypto_length(context, crypto, KRB5_CRYPTO_TYPE_HEADER);
+	    iov[i].buffer.length =
+	      krb5_crypto_length(context, crypto, KRB5_CRYPTO_TYPE_HEADER);
+	    size += iov[i].buffer.length;
 	    break;
 	case GSS_IOV_BUFFER_TYPE_TRAILER:
-	    size += krb5_crypto_length(context, crypto, KRB5_CRYPTO_TYPE_TRAILER);
+	    iov[i].buffer.length =
+	      krb5_crypto_length(context, crypto, KRB5_CRYPTO_TYPE_TRAILER);
+	    size += iov[i].buffer.length;
 	    break;
 	case GSS_IOV_BUFFER_TYPE_PADDING:
 	    if (padding != NULL) {

