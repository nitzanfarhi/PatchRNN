commit 5402c5938de925996a43b157994c6e5dfaec02c7
Author: Khairul Kasmiran <kazarmy@gmail.com>
Date:   Tue Jan 9 23:11:38 2018 +0800

    Fixed cases where hash+space in quoted string is treated as comment

diff --git a/libr/core/cmd.c b/libr/core/cmd.c
index b946f3a6e..51e3eb5a7 100644
--- a/libr/core/cmd.c
+++ b/libr/core/cmd.c
@@ -1559,8 +1559,7 @@ static int r_core_cmd_subst(RCore *core, char *cmd) {
 	if (!icmd || (cmd[0] == '#' && cmd[1] != '!' && cmd[1] != '?')) {
 		goto beach;
 	}
-	cmt = *icmd ? strchr (icmd + 1, '#'): NULL;
-	// TODO must honor "
+	cmt = *icmd ? (char *)r_str_firstbut (icmd + 1, '#', "\""): NULL;
 	if (cmt && (cmt[1] == ' ' || cmt[1] == '\t')) {
 		*cmt = 0;
 	}
@@ -1835,10 +1834,9 @@ static int r_core_cmd_subst_i(RCore *core, char *cmd, char *colon) {
 	}
 
 // TODO must honor `
-// must honor "
 	/* comments */
 	if (*cmd != '#') {
-		ptr = (char *)r_str_lastbut (cmd, '#', quotestr);
+		ptr = (char *)r_str_firstbut (cmd, '#', "`\""); // TODO: use quotestr here
 		if (ptr && (ptr[1] == ' ' || ptr[1] == '\t')) {
 			*ptr = '\0';
 		}

