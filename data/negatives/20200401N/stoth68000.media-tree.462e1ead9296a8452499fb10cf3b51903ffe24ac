commit 462e1ead9296a8452499fb10cf3b51903ffe24ac
Author: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
Date:   Thu Jul 2 05:48:17 2015 -0700

    bridge: vlan: fix usage of vlan 0 and 4095 again
    
    Vlan ids 0 and 4095 were disallowed by commit:
    8adff41c3d25 ("bridge: Don't use VID 0 and 4095 in vlan filtering")
    but then the check was removed when vlan ranges were introduced by:
    bdced7ef7838 ("bridge: support for multiple vlans and vlan ranges in setlink and dellink requests")
    So reintroduce the vlan range check.
    Before patch:
    [root@testvm ~]# bridge vlan add vid 0 dev eth0 master
    (succeeds)
    After Patch:
    [root@testvm ~]# bridge vlan add vid 0 dev eth0 master
    RTNETLINK answers: Invalid argument
    
    Signed-off-by: Nikolay Aleksandrov <nikolay@cumulusnetworks.com>
    Fixes: bdced7ef7838 ("bridge: support for multiple vlans and vlan ranges in setlink and dellink requests")
    Acked-by: Toshiaki Makita <toshiaki.makita1@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/bridge/br_netlink.c b/net/bridge/br_netlink.c
index 6b67ed3831de..364bdc98bd9b 100644
--- a/net/bridge/br_netlink.c
+++ b/net/bridge/br_netlink.c
@@ -457,6 +457,8 @@ static int br_afspec(struct net_bridge *br,
 		if (nla_len(attr) != sizeof(struct bridge_vlan_info))
 			return -EINVAL;
 		vinfo = nla_data(attr);
+		if (!vinfo->vid || vinfo->vid >= VLAN_VID_MASK)
+			return -EINVAL;
 		if (vinfo->flags & BRIDGE_VLAN_INFO_RANGE_BEGIN) {
 			if (vinfo_start)
 				return -EINVAL;

