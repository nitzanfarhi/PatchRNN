commit af927baabb5d860a820bcd6138af872fdc666f4c
Author: jrosenquist <jrosenquist@8f940c70-5916-0410-ac46-d1fa2fa6ea29>
Date:   Wed Jan 11 18:04:53 2012 +0000

    moved sublock inside master lock

diff --git a/src/server/svr_task.c b/src/server/svr_task.c
index 5d6bbfbbd..d3ef8e28a 100644
--- a/src/server/svr_task.c
+++ b/src/server/svr_task.c
@@ -343,13 +343,13 @@ work_task *next_task(
   pthread_mutex_lock(at->alltasks_mutex);
 
   wt = next_thing(at->ra,iter);
+  if (wt != NULL)
+    pthread_mutex_lock(wt->wt_mutex);
 
   pthread_mutex_unlock(at->alltasks_mutex);
 
   if (wt != NULL)
     {
-    pthread_mutex_lock(wt->wt_mutex);
-
     if (wt->wt_being_recycled == TRUE)
       {
       pthread_mutex_unlock(wt->wt_mutex);

