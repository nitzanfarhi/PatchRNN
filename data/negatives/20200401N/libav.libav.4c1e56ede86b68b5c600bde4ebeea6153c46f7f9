commit 4c1e56ede86b68b5c600bde4ebeea6153c46f7f9
Author: Mans Rullgard <mans@mansr.com>
Date:   Wed Jun 1 17:30:28 2011 +0100

    oma: check avio_read() return value

diff --git a/libavformat/oma.c b/libavformat/oma.c
index 6dd56cf70..6fdf75f17 100644
--- a/libavformat/oma.c
+++ b/libavformat/oma.c
@@ -80,6 +80,8 @@ static int oma_read_header(AVFormatContext *s,
 
     ff_id3v2_read(s, ID3v2_EA3_MAGIC);
     ret = avio_read(s->pb, buf, EA3_HEADER_SIZE);
+    if (ret < EA3_HEADER_SIZE)
+        return -1;
 
     if (memcmp(buf, ((const uint8_t[]){'E', 'A', '3'}),3) || buf[4] != 0 || buf[5] != EA3_HEADER_SIZE) {
         av_log(s, AV_LOG_ERROR, "Couldn't find the EA3 header !\n");

