commit 7224e89638ea8d3ec6e4f705f57c168efbe1aca8
Author: Baptiste Coudurier <baptiste.coudurier@gmail.com>
Date:   Wed Dec 13 10:18:38 2006 +0000

    dont segv is ap->device is not set, display error message
    
    Originally committed as revision 7312 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavformat/x11grab.c b/libavformat/x11grab.c
index e0e40184c..4b237f6c2 100644
--- a/libavformat/x11grab.c
+++ b/libavformat/x11grab.c
@@ -101,6 +101,11 @@ x11grab_read_header(AVFormatContext *s1, AVFormatParameters *ap)
         return AVERROR_IO;
     }
 
+    if (!ap->device) {
+        av_log(s1, AV_LOG_ERROR, "AVParameters don't specify any device. Use -vd.\n");
+        return AVERROR_IO;
+    }
+
     sscanf(ap->device, "x11:%d,%d", &x_off, &y_off);
     av_log(s1, AV_LOG_INFO, "device: %s -> x: %d y: %d width: %d height: %d\n", ap->device, x_off, y_off, ap->width, ap->height);
 

