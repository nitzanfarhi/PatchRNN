commit 6c80b49e0083d674a1cdaa10ee2dd0caa3f4c7ef
Author: Ken Murchison <murch@fastmail.com>
Date:   Fri Mar 23 12:34:56 2018 -0400

    http_h2.c: make sure we have an active h2 session before checking for WS context

diff --git a/imap/http_h2.c b/imap/http_h2.c
index 7323af172..bc5855c5b 100644
--- a/imap/http_h2.c
+++ b/imap/http_h2.c
@@ -584,7 +584,7 @@ HIDDEN void http2_output(struct transaction_t *txn)
     struct transaction_t *strm_txn =
         nghttp2_session_get_stream_user_data(ctx->session, stream_id);
 
-    if (strm_txn->ws_ctx) {
+    if (strm_txn && strm_txn->ws_ctx) {
         /* WebSocket output */
         ws_output(strm_txn);
     }

