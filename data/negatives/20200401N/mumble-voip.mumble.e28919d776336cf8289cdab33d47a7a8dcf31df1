commit e28919d776336cf8289cdab33d47a7a8dcf31df1
Author: Benjamin Jemlich <pcgod@users.sourceforge.net>
Date:   Tue Jan 19 01:02:22 2010 +0100

    Fix log time coloring & text object too large text object error message

diff --git a/src/mumble/Log.cpp b/src/mumble/Log.cpp
index f30875a2..753f7b6c 100644
--- a/src/mumble/Log.cpp
+++ b/src/mumble/Log.cpp
@@ -394,8 +394,15 @@ QString Log::validHtml(const QString &html, bool allowReplacement, QTextCursor *
 		qtd.adjustSize();
 		s = qtd.size();
 
-		if ((s.width() > qr.width()) || (s.height() > qr.height()))
-			return tr("[[ Text object too large to display ]]");
+		if ((s.width() > qr.width()) || (s.height() > qr.height())) {
+			QString errorMessage = tr("[[ Text object too large to display ]]");
+			if (tc) {
+				tc->insertText(errorMessage);
+				return QString();
+			} else {
+				return errorMessage;
+			}
+		}
 	}
 
 	if (tc) {
@@ -443,7 +450,8 @@ void Log::log(MsgType mt, const QString &console, const QString &terse) {
 		} else if (! g.mw->qteLog->document()->isEmpty()) {
 			tc.insertBlock();
 		}
-		validHtml(QString::fromLatin1("[%2] %1\n").arg(console, Log::msgColor(dt.time().toString(Qt::DefaultLocaleShortDate), Log::Time)), true, &tc);
+		tc.insertHtml(Log::msgColor(QString::fromLatin1("[%1] ").arg(dt.time().toString(Qt::DefaultLocaleShortDate)), Log::Time));
+		validHtml(console, true, &tc);
 		tc.movePosition(QTextCursor::End);
 		g.mw->qteLog->setTextCursor(tc);
 		g.mw->qteLog->ensureCursorVisible();

