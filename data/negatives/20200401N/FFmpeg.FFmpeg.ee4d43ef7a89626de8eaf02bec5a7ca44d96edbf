commit ee4d43ef7a89626de8eaf02bec5a7ca44d96edbf
Author: Oana Stratulat <oanaandreeastratulat@gmail.com>
Date:   Fri Jan 6 02:02:50 2012 +0100

    ffmpeg: check if number of input and output channels are valid.
    
    Fix Ticket887.

diff --git a/ffmpeg.c b/ffmpeg.c
index e23ea6505c..5bef906c36 100644
--- a/ffmpeg.c
+++ b/ffmpeg.c
@@ -1096,8 +1096,14 @@ need_realloc:
                 av_opt_set_int(ost->swr, "icl", av_get_default_channel_layout(ost->audio_channels_mapped), 0);
                 av_opt_set_int(ost->swr, "uch", ost->audio_channels_mapped, 0);
             }
-            av_opt_set_int(ost->swr, "ich", dec->channels, 0);
-            av_opt_set_int(ost->swr, "och", enc->channels, 0);
+            if (av_opt_set_int(ost->swr, "ich", dec->channels, 0) < 0) {
+                av_log(NULL, AV_LOG_FATAL, "Unsupported number of input channels\n");
+                exit_program(1);
+            }
+            if (av_opt_set_int(ost->swr, "och", enc->channels, 0) < 0) {
+                av_log(NULL, AV_LOG_FATAL, "Unsupported number of output channels\n");
+                exit_program(1);
+            }
             if(audio_sync_method>1) av_opt_set_int(ost->swr, "flags", SWR_FLAG_RESAMPLE, 0);
             if(ost->swr && swr_init(ost->swr) < 0){
                 av_log(NULL, AV_LOG_FATAL, "swr_init() failed\n");

