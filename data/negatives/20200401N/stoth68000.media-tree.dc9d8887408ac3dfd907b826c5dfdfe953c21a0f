commit dc9d8887408ac3dfd907b826c5dfdfe953c21a0f
Author: Adam Thomson <Adam.Thomson.Opensource@diasemi.com>
Date:   Thu Apr 3 14:50:18 2014 -0700

    drivers/rtc/rtc-da9055.c: remove use of regmap_irq_get_virq()
    
    Using platform_get_irq_byname() to retrieve the IRQ number returns the
    VIRQ number rather than the local IRQ number for the device.  Passing that
    value then into regmap_irq_get_virq() causes a failure because the
    function is expecting the local IRQ number (e.g.  0, 1, 2, 3, etc).
    
    This patch removes use of regmap_irq_get_virq() to prevent this failure
    from happening
    
    Signed-off-by: Adam Thomson <Adam.Thomson.Opensource@diasemi.com>
    Cc: Alessandro Zummo <a.zummo@towertech.it>
    Cc: Dmitry Torokhov <dmitry.torokhov@gmail.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/rtc/rtc-da9055.c b/drivers/rtc/rtc-da9055.c
index 48cb2ac3bd3e..a825491331c8 100644
--- a/drivers/rtc/rtc-da9055.c
+++ b/drivers/rtc/rtc-da9055.c
@@ -302,7 +302,9 @@ static int da9055_rtc_probe(struct platform_device *pdev)
 	}
 
 	alm_irq = platform_get_irq_byname(pdev, "ALM");
-	alm_irq = regmap_irq_get_virq(rtc->da9055->irq_data, alm_irq);
+	if (alm_irq < 0)
+		return alm_irq;
+
 	ret = devm_request_threaded_irq(&pdev->dev, alm_irq, NULL,
 					da9055_rtc_alm_irq,
 					IRQF_TRIGGER_HIGH | IRQF_ONESHOT,

