commit 71a2ee37e8851f430d72daea0722908512d57f79
Author: Mauro Carvalho Chehab <mchehab@infradead.org>
Date:   Thu Nov 22 12:19:37 2007 -0300

    V4L/DVB (6660): Allow fully configuring xc3028 during xc2028_attach
    
    xc3028 can be used on some DTV only designs (for example, DVB-S boards). Before
    this patch, a DTV only board would need to call set_tuner_config callback.
    
    This patch allows to optionally pass a xc3028_ctrl parameter, via xc3028_config
    struct, fully initializing the driver for DTV.
    
    Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>

diff --git a/drivers/media/video/tuner-xc2028.c b/drivers/media/video/tuner-xc2028.c
index 6a6642ea48ce..c231e7a74ffb 100644
--- a/drivers/media/video/tuner-xc2028.c
+++ b/drivers/media/video/tuner-xc2028.c
@@ -1061,7 +1061,7 @@ void *xc2028_attach(struct dvb_frontend *fe, struct xc2028_config *cfg)
 	if (debug)
 		printk(KERN_DEBUG PREFIX ": Xcv2028/3028 init called!\n");
 
-	if (NULL == cfg->video_dev)
+	if (NULL == cfg || NULL == cfg->video_dev)
 		return NULL;
 
 	if (!fe) {
@@ -1106,6 +1106,9 @@ void *xc2028_attach(struct dvb_frontend *fe, struct xc2028_config *cfg)
 
 	tuner_info("type set to %s\n", "XCeive xc2028/xc3028 tuner");
 
+	if (cfg->ctrl)
+		xc2028_set_config(fe, cfg->ctrl);
+
 	mutex_unlock(&xc2028_list_mutex);
 
 	return fe;
diff --git a/drivers/media/video/tuner-xc2028.h b/drivers/media/video/tuner-xc2028.h
index f24fb2a00f6f..a59d00fb2a36 100644
--- a/drivers/media/video/tuner-xc2028.h
+++ b/drivers/media/video/tuner-xc2028.h
@@ -23,6 +23,7 @@ struct xc2028_config {
 	struct i2c_adapter *i2c_adap;
 	u8 		   i2c_addr;
 	void               *video_dev;
+	struct xc2028_ctrl *ctrl;
 	int                (*callback) (void *dev, int command, int arg);
 };
 

