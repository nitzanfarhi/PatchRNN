commit 0fba999f13b7480278946be4b51db4a1035e7f4f
Author: Antti Palosaari <crope@iki.fi>
Date:   Sat Jun 9 21:37:11 2012 -0300

    [media] dvb_usb_v2: I2C adapter cleanup changes
    
    Signed-off-by: Antti Palosaari <crope@iki.fi>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/dvb/dvb-usb/dvb_usb_init.c b/drivers/media/dvb/dvb-usb/dvb_usb_init.c
index c98712a29133..5759d8e2f8ef 100644
--- a/drivers/media/dvb/dvb-usb/dvb_usb_init.c
+++ b/drivers/media/dvb/dvb-usb/dvb_usb_init.c
@@ -70,10 +70,12 @@ err:
 
 int dvb_usbv2_i2c_init(struct dvb_usb_device *d)
 {
-	int ret = 0;
+	int ret;
 
-	if (!d->props.i2c_algo)
-		return 0;
+	if (!d->props.i2c_algo) {
+		ret = 0;
+		goto err;
+	}
 
 	strlcpy(d->i2c_adap.name, d->name, sizeof(d->i2c_adap.name));
 	d->i2c_adap.algo = d->props.i2c_algo;
@@ -83,11 +85,16 @@ int dvb_usbv2_i2c_init(struct dvb_usb_device *d)
 	i2c_set_adapdata(&d->i2c_adap, d);
 
 	ret = i2c_add_adapter(&d->i2c_adap);
-	if (ret < 0)
-		pr_err("%s: could not add i2c adapter\n", KBUILD_MODNAME);
+	if (ret < 0) {
+		pr_err("%s: i2c_add_adapter() failed\n", KBUILD_MODNAME);
+		goto err;
+	}
 
 	d->state |= DVB_USB_STATE_I2C;
 
+	return 0;
+err:
+	pr_debug("%s: failed=%d\n", __func__, ret);
 	return ret;
 }
 
@@ -95,7 +102,9 @@ int dvb_usbv2_i2c_exit(struct dvb_usb_device *d)
 {
 	if (d->state & DVB_USB_STATE_I2C)
 		i2c_del_adapter(&d->i2c_adap);
+
 	d->state &= ~DVB_USB_STATE_I2C;
+
 	return 0;
 }
 

