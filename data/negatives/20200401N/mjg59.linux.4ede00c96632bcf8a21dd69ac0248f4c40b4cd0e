commit 4ede00c96632bcf8a21dd69ac0248f4c40b4cd0e
Author: Dan Carpenter <error27@gmail.com>
Date:   Sat Jul 10 16:30:04 2010 +0200

    vmwgfx: return -EFAULT if copy_to_user fails
    
    copy_to_user() returns the number of bytes remaining to be copied, but
    we want to return a negative error code.  This gets copied to user
    space.
    
    Signed-off-by: Dan Carpenter <error27@gmail.com>
    Signed-off-by: Dave Airlie <airlied@redhat.com>

diff --git a/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c b/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c
index f1d626112415..437ac786277a 100644
--- a/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c
+++ b/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c
@@ -972,6 +972,7 @@ int vmw_kms_update_layout_ioctl(struct drm_device *dev, void *data,
 	ret = copy_from_user(rects, user_rects, rects_size);
 	if (unlikely(ret != 0)) {
 		DRM_ERROR("Failed to get rects.\n");
+		ret = -EFAULT;
 		goto out_free;
 	}
 

