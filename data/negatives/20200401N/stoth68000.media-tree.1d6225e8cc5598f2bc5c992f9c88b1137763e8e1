commit 1d6225e8cc5598f2bc5c992f9c88b1137763e8e1
Author: Cliff Wickman <cpw@sgi.com>
Date:   Mon Aug 9 16:11:22 2010 -0500

    x86, UV: Make kdump avoid stack dumps - fix !CONFIG_KEXEC breakage
    
    This replaces Version 1 of this patch, which broke the build when
    CONFIG_KEXEC and CONFIG_CRASH_DUMP were configured off.  In that case
    the storage for the 'in_crash_kexec' flag was never built.
    
    This version defines that flag as 0 if CONFIG_KEXEC is not set.
    The patch is tested with all combinations of those two options.
    
    Signed-off-by: Cliff Wickman <cpw@sgi.com>
    Cc: Andrew Morton <akpm@linux-foundation.org>
    LKML-Reference: <E1OiZcw-0001Hb-2g@eag09.americas.sgi.com>
    Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>

diff --git a/arch/x86/include/asm/kdebug.h b/arch/x86/include/asm/kdebug.h
index 7a2910b3512b..5bdfca86581b 100644
--- a/arch/x86/include/asm/kdebug.h
+++ b/arch/x86/include/asm/kdebug.h
@@ -33,6 +33,11 @@ extern void __show_regs(struct pt_regs *regs, int all);
 extern void show_regs(struct pt_regs *regs);
 extern unsigned long oops_begin(void);
 extern void oops_end(unsigned long, struct pt_regs *, int signr);
+#ifdef CONFIG_KEXEC
 extern int in_crash_kexec;
+#else
+/* no crash dump is ever in progress if no crash kernel can be kexec'd */
+#define in_crash_kexec 0
+#endif
 
 #endif /* _ASM_X86_KDEBUG_H */

