commit cf48fb6a2bf2e59990e1438d0dedc706df911996
Author: Bjorn Helgaas <bhelgaas@google.com>
Date:   Fri Mar 16 17:47:59 2012 -0600

    PCI: fix bridge I/O window bus-to-resource conversion
    
    In 5bfa14ed9f3c, I forgot to initialize res2.flags before calling
    pcibios_bus_to_resource(), which depends on the resource type to locate the
    correct aperture.  This bug won't hurt x86, which currently never has an
    offset between bus and CPU addresses, but will affect other architectures.
    
    Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
    Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>

diff --git a/drivers/pci/probe.c b/drivers/pci/probe.c
index 944e05a66b97..5e1ca3c58a7d 100644
--- a/drivers/pci/probe.c
+++ b/drivers/pci/probe.c
@@ -367,6 +367,7 @@ static void __devinit pci_read_bridge_io(struct pci_bus *child)
 
 	if (base && base <= limit) {
 		res->flags = (io_base_lo & PCI_IO_RANGE_TYPE_MASK) | IORESOURCE_IO;
+		res2.flags = res->flags;
 		region.start = base;
 		region.end = limit + 0xfff;
 		pcibios_bus_to_resource(dev, &res2, &region);

