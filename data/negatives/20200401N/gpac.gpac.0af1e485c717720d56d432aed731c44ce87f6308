commit 0af1e485c717720d56d432aed731c44ce87f6308
Author: Jean Le Feuvre <jeanlf@users.sourceforge.net>
Date:   Mon Aug 24 16:29:20 2009 +0000

    Fixed bug in YUV scaling
    
    
    git-svn-id: http://svn.code.sf.net/p/gpac/code/trunk/gpac@1347 63c20433-aa62-49bd-875c-5a186b69a8fb

diff --git a/modules/dx_hw/copy_pixels.c b/modules/dx_hw/copy_pixels.c
index 94227096d..2ff2cf4f8 100644
--- a/modules/dx_hw/copy_pixels.c
+++ b/modules/dx_hw/copy_pixels.c
@@ -85,13 +85,19 @@ static void VR_write_yv12_to_yuv(GF_VideoSurface *vs,  unsigned char *src, u32 s
 								 u32 src_width, u32 src_height, const GF_Window *src_wnd)
 {
 	unsigned char *pY, *pU, *pV;
+	u32 start_y;
 	pY = src;
 	pU = src + src_stride * src_height;
 	pV = src + 5*src_stride * src_height/4;
 
+	start_y = src_wnd->y;
+	/*because of U and V downsampling by 2x2, working with odd Y offset will lead to a half-line shift between Y and UV components. We
+	therefore force an even Y offset for U and V planes.*/
+	if (start_y % 2) start_y--;
+
 	pY = pY + src_stride * src_wnd->y + src_wnd->x;
-	pU = pU + (src_stride * src_wnd->y / 2 + src_wnd->x) / 2;
-	pV = pV + (src_stride * src_wnd->y / 2 + src_wnd->x) / 2;
+	pU = pU + ((src_stride * start_y) / 2 + src_wnd->x) / 2;
+	pV = pV + ((src_stride * start_y) / 2 + src_wnd->x) / 2;
 
 
 	if (is_planar_yuv(vs->pixel_format)) {

