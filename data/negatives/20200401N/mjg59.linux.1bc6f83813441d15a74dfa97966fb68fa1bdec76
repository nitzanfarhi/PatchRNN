commit 1bc6f83813441d15a74dfa97966fb68fa1bdec76
Author: Joerg Roedel <joerg.roedel@amd.com>
Date:   Thu Jul 2 18:32:05 2009 +0200

    amd-iommu: set evt_buf_size correctly
    
    The setting of this variable got lost during the suspend/resume
    implementation.  But keeping this variable zero causes a divide-by-zero
    error in the interrupt handler. This patch fixes this.
    
    Signed-off-by: Joerg Roedel <joerg.roedel@amd.com>

diff --git a/arch/x86/kernel/amd_iommu_init.c b/arch/x86/kernel/amd_iommu_init.c
index ec72c7779d6b..c1b17e97252e 100644
--- a/arch/x86/kernel/amd_iommu_init.c
+++ b/arch/x86/kernel/amd_iommu_init.c
@@ -472,6 +472,8 @@ static u8 * __init alloc_event_buffer(struct amd_iommu *iommu)
 	if (iommu->evt_buf == NULL)
 		return NULL;
 
+	iommu->evt_buf_size = EVT_BUFFER_SIZE;
+
 	return iommu->evt_buf;
 }
 

