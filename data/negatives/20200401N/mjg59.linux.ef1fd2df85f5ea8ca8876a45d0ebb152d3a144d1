commit ef1fd2df85f5ea8ca8876a45d0ebb152d3a144d1
Author: Prabhakar Kushwaha <prabhakar@freescale.com>
Date:   Thu Mar 31 12:31:09 2011 +0530

    powerpc/85xx: Don't add disabled PCIe devices
    
    PCIe nodes with the property status="disabled" are not usable and so
    avoid adding "disabled" PCIe bridge with the system.
    
    Signed-off-by: Prabhakar Kushwaha <prabhakar@freescale.com>
    Signed-off-by: Kumar Gala <galak@kernel.crashing.org>

diff --git a/arch/powerpc/sysdev/fsl_pci.c b/arch/powerpc/sysdev/fsl_pci.c
index f8f7f28c6343..68ca9290df94 100644
--- a/arch/powerpc/sysdev/fsl_pci.c
+++ b/arch/powerpc/sysdev/fsl_pci.c
@@ -324,6 +324,11 @@ int __init fsl_add_bridge(struct device_node *dev, int is_primary)
 	struct resource rsrc;
 	const int *bus_range;
 
+	if (!of_device_is_available(dev)) {
+		pr_warning("%s: disabled\n", dev->full_name);
+		return -ENODEV;
+	}
+
 	pr_debug("Adding PCI host bridge %s\n", dev->full_name);
 
 	/* Fetch host bridge registers address */

