commit c39e6aee82997d9174252ca963c5ad7ecf3e3cb4
Author: Anton Kochkov <anton.kochkov@gmail.com>
Date:   Sun Jul 7 01:03:47 2013 +0400

    Added local labels reference display

diff --git a/libr/core/disasm.c b/libr/core/disasm.c
index db84153be..64692e62b 100644
--- a/libr/core/disasm.c
+++ b/libr/core/disasm.c
@@ -846,13 +846,40 @@ toro:
 			case R_ANAL_OP_TYPE_JMP:
 			case R_ANAL_OP_TYPE_CJMP:
 			case R_ANAL_OP_TYPE_CALL:
+				{
 				f = r_anal_fcn_find (core->anal,
 					analop.jump, R_ANAL_FCN_TYPE_NULL);
+				RAnalFunction *cf = r_anal_fcn_find (core->anal, /* current function */
+					at, R_ANAL_FCN_TYPE_NULL);
 				if (f && !strstr (opstr, f->name)) {
+					if (f->locals != NULL) {
+						RAnalFcnLocal *l;
+						RListIter *iter;
+						r_list_foreach (f->locals, iter, l) {
+							if (analop.jump == l->addr) {
+								if ((cf != NULL) && (f == cf)) {
+									r_cons_strcat (color_label);
+									r_cons_printf (" ; (%s)", l->name);
+									r_cons_strcat (Color_RESET);
+									break;
+								} else {
+									r_cons_strcat (color_fname);
+									r_cons_printf ("; (%s", f->name);
+									r_cons_strcat (Color_RESET);
+									r_cons_strcat (color_label);
+									r_cons_printf (".%s)", l->name);
+									r_cons_strcat (Color_RESET);
+									break;
+								}
+							}
+						}
+					}
+
 					r_cons_strcat (color_fname);
 					r_cons_printf (" ; (%s)", f->name);
 					r_cons_strcat (Color_RESET);
 				}
+				}
 				break;
 			}
 		}

