commit c29960fb757b0ae784d8c83214e3cb5af16517ad
Author: Gilles Boccon-Gibod <bok@bok.net>
Date:   Sat Jun 4 10:01:09 2016 -0700

    fixed invalid sidx timescale when non default

diff --git a/Source/C++/Apps/Mp4Encrypt/Mp4Encrypt.cpp b/Source/C++/Apps/Mp4Encrypt/Mp4Encrypt.cpp
index 4f60b9d..3ffb331 100644
--- a/Source/C++/Apps/Mp4Encrypt/Mp4Encrypt.cpp
+++ b/Source/C++/Apps/Mp4Encrypt/Mp4Encrypt.cpp
@@ -39,7 +39,7 @@
 +---------------------------------------------------------------------*/
 #define BANNER "MP4 Encrypter - Version 1.6\n"\
                "(Bento4 Version " AP4_VERSION_STRING ")\n"\
-               "(c) 2002-2015 Axiomatic Systems, LLC"
+               "(c) 2002-2016 Axiomatic Systems, LLC"
 
 /*----------------------------------------------------------------------
 |   PrintUsageAndExit
diff --git a/Source/C++/Apps/Mp4Fragment/Mp4Fragment.cpp b/Source/C++/Apps/Mp4Fragment/Mp4Fragment.cpp
index 3a292f1..e4a1c1c 100644
--- a/Source/C++/Apps/Mp4Fragment/Mp4Fragment.cpp
+++ b/Source/C++/Apps/Mp4Fragment/Mp4Fragment.cpp
@@ -703,7 +703,7 @@ Fragment(AP4_File&                input_file,
     output_stream.Tell(sidx_position);
     if (create_segment_index) {
         sidx = new AP4_SidxAtom(index_cursor->m_Track->GetId(),
-                                index_cursor->m_Track->GetMediaTimeScale(),
+                                timescale?timescale:index_cursor->m_Track->GetMediaTimeScale(),
                                 0,
                                 0);
         // reserve space for the entries now, but they will be computed and updated later
@@ -1007,7 +1007,7 @@ main(int argc, char** argv)
     bool         auto_detect_fragment_duration = true;
     bool         create_segment_index          = false;
     bool         quiet                         = false;
-    AP4_UI32     timescale = 0;
+    AP4_UI32     timescale                     = 0;
     AP4_Result   result;
 
     Options.verbosity          = 1;

