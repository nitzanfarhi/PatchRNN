commit 4537c8c8bc1ece123f22f10a43b5b9a2a8c77cd4
Author: Panu Matilainen <pmatilai@redhat.com>
Date:   Thu Nov 24 11:16:19 2011 +0200

    Log an error on attempt to sign V3 packages (RhBug:517818 & others)
    
    - We haven't been able to sign V3 packages in the last decade or so,
      might as well spit out an error on it instead of silently failing.

diff --git a/lib/signature.c b/lib/signature.c
index a1293cb4f..f5c80c984 100644
--- a/lib/signature.c
+++ b/lib/signature.c
@@ -310,6 +310,9 @@ static int makeHDRDigest(Header sigh, const char * file, rpmTagVal sigTag)
 	    (void) rpmDigestUpdate(ctx, utd.data, utd.count);
 	    (void) rpmDigestFinal(ctx, (void **)&SHA1, NULL, 1);
 	    rpmtdFreeData(&utd);
+	} else {
+	    rpmlog(RPMLOG_ERR, _("Cannot sign RPM v3 packages\n"));
+	    goto exit;
 	}
 
 	if (SHA1 == NULL)

