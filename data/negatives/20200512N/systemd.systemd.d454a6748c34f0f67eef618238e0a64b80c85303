commit d454a6748c34f0f67eef618238e0a64b80c85303
Author: Umut Tezduyar Lindskog <umut.tezduyar@axis.com>
Date:   Sun Mar 30 19:09:14 2014 +0200

    sd-dhcp: check for udp packets
    
    Do not try to parse ICMP packets
    
    [tomegun: slightly tweaked debug message]

diff --git a/src/libsystemd-network/dhcp-packet.c b/src/libsystemd-network/dhcp-packet.c
index bed942fd8..9779cbd51 100644
--- a/src/libsystemd-network/dhcp-packet.c
+++ b/src/libsystemd-network/dhcp-packet.c
@@ -157,6 +157,11 @@ int dhcp_packet_verify_headers(DHCPPacket *packet, size_t len, bool checksum) {
 
         /* UDP */
 
+        if (packet->ip.protocol != IPPROTO_UDP) {
+                log_dhcp_client(client, "ignoring packet: not UDP");
+                return -EINVAL;
+        }
+
         if (len < DHCP_IP_UDP_SIZE) {
                 log_dhcp_client(client, "ignoring packet: packet (%zu bytes) "
                                 " smaller than IP+UDP header (%u bytes)", len,

