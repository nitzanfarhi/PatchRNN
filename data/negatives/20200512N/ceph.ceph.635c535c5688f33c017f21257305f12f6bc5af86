commit 635c535c5688f33c017f21257305f12f6bc5af86
Author: Colin Patrick McCabe <cmccabe@alumni.cmu.edu>
Date:   Thu Feb 10 06:43:35 2011 -0800

    os/FileStore.cc: use safe_write
    
    Signed-off-by: Colin McCabe <colin.mccabe@dreamhost.com>

diff --git a/src/os/FileStore.cc b/src/os/FileStore.cc
index ceae3a7fa8..4e49ba2e78 100644
--- a/src/os/FileStore.cc
+++ b/src/os/FileStore.cc
@@ -690,9 +690,8 @@ int FileStore::mkfs()
   // fsid
   srand(time(0) + getpid());
   fsid = rand();
-  if (TEMP_FAILURE_RETRY(::write(fsid_fd, &fsid, sizeof(fsid)))
-	!= sizeof(fsid)) {
-    ret = errno;
+  ret = safe_write(fsid_fd, &fsid, sizeof(fsid));
+  if (ret) {
     derr << "FileStore::mkfs: failed to write fsid: "
 	 << cpp_strerror(ret) << dendl;
     goto close_fsid_fd;
@@ -2337,7 +2336,7 @@ int FileStore::_do_clone_range(int from, int to, uint64_t off, uint64_t len)
     }
     int op = 0;
     while (op < r) {
-      int r2 = ::write(to, buf+op, r-op);
+      int r2 = safe_write(to, buf+op, r-op);
       dout(25) << " write to " << to << "~" << (r-op) << " got " << r2 << dendl;      
       if (r2 < 0) {
 	r = r2;

