commit eea3f8911f34001d2450a272c2d02f175279b53c
Author: Juha Yrjölä <juha.yrjola@solidboot.com>
Date:   Thu Aug 3 19:06:25 2006 +0300

    sysfs: Make poll behaviour consistent
    
    When no events have been reported by sysfs_notify(), sd->s_events
    was previously set to zero.  The initial value for new readers is
    also zero, so poll was blocking, regardless of whether the attribute
    was read by the process or not.
    
    Make poll behave consistently by setting the initial value of
    sd->s_events to non-zero.
    
    Signed-off-by: Juha Yrjola <juha.yrjola@solidboot.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/fs/sysfs/dir.c b/fs/sysfs/dir.c
index 61c42430cba3..5f3d725d1125 100644
--- a/fs/sysfs/dir.c
+++ b/fs/sysfs/dir.c
@@ -43,7 +43,7 @@ static struct sysfs_dirent * sysfs_new_dirent(struct sysfs_dirent * parent_sd,
 
 	memset(sd, 0, sizeof(*sd));
 	atomic_set(&sd->s_count, 1);
-	atomic_set(&sd->s_event, 0);
+	atomic_set(&sd->s_event, 1);
 	INIT_LIST_HEAD(&sd->s_children);
 	list_add(&sd->s_sibling, &parent_sd->s_children);
 	sd->s_element = element;

