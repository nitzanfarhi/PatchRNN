commit 6fd7145020da6ef21c0d393c2eed1875d3a6edf5
Author: tjsaunders <tjsaunders@blackpearlsystems.com>
Date:   Sun Oct 12 17:37:33 2014 -0700

    If we have an error reading the salt, then don't proceed to trying to
    manipulate the buffer containing said salt.

diff --git a/contrib/mod_sql_passwd.c b/contrib/mod_sql_passwd.c
index 329706e97..38a59430e 100644
--- a/contrib/mod_sql_passwd.c
+++ b/contrib/mod_sql_passwd.c
@@ -1221,16 +1221,19 @@ static int sql_passwd_sess_init(void) {
 
         (void) close(fd);
 
-        /* If the very last byte in the buffer is a newline, trim it.  This
-         * is to deal with cases where the SaltFile may have been written
-         * with an editor (e.g. vi) which automatically adds a trailing newline.
-         */
-        if (sql_passwd_salt[sql_passwd_salt_len-1] == '\n') {
-          sql_passwd_salt[sql_passwd_salt_len-1] = '\0';
-          sql_passwd_salt_len--;
-        }
+        if (sql_passwd_salt != NULL) {
+          /* If the very last byte in the buffer is a newline, trim it.  This
+           * is to deal with cases where the SaltFile may have been written
+           * with an editor (e.g. vi) which automatically adds a trailing
+           * newline.
+           */
+          if (sql_passwd_salt[sql_passwd_salt_len-1] == '\n') {
+            sql_passwd_salt[sql_passwd_salt_len-1] = '\0';
+            sql_passwd_salt_len--;
+          }
 
-        sql_passwd_salt_flags = salt_flags;
+          sql_passwd_salt_flags = salt_flags;
+        }
 
       } else {
         pr_log_debug(DEBUG1, MOD_SQL_PASSWD_VERSION

