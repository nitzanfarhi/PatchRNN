commit d419caf24cdf6bd0a6fc4e68fe5f70d307cdb29d
Author: Charles Dang <exodia339@gmail.com>
Date:   Wed Sep 13 12:40:53 2017 +1100

    Mouse Handler Base: fix right-click behavior regression from c5dc04c900 (fixes #1967)
    
    The above commit moved context menu handling from right_click to right_mouse_up. However, that removed
    the early-exit if right_click_show_menu returned false. It seems some areas of the code (in this case,
    the editor in editor_controller::right_click - don't ask me exactly how this leads to editor_controller::mouse_motion
    where the codepath that caused the exception in the above bug is actually called, I didn't bother to trace it)
    relied on that early exit to control behavior.
    
    Making right_click return the value of right_click_show_menu by default fixes things.

diff --git a/src/mouse_handler_base.hpp b/src/mouse_handler_base.hpp
index dc9c1eeeb2..480f895c13 100644
--- a/src/mouse_handler_base.hpp
+++ b/src/mouse_handler_base.hpp
@@ -135,9 +135,9 @@ public:
 	 * @returns true when the click should not process the event further.
 	 * This means do not treat the call as a start of drag movement.
 	 */
-	virtual bool right_click(int /*x*/, int /*y*/, const bool /*browse*/)
+	virtual bool right_click(int x, int y, const bool browse)
 	{
-		return true;
+		return right_click_show_menu(x, y, browse);
 	}
 
 	/**

