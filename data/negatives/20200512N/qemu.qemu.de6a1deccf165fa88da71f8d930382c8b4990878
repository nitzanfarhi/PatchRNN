commit de6a1deccf165fa88da71f8d930382c8b4990878
Author: Dmitry Ilyevsky <ilyevsky@gmail.com>
Date:   Fri Mar 26 03:25:36 2010 +0300

    target-ppc: generic PowerPC TBL
    
    Time base SPRs TBL/TBU should be accessible in user/priv modes for reading
    as specified in POWER ISA documentation. Therefore SPRs permissions were
    changed in gen_tbl function.
    
    Signed-off-by: Dmitry Ilyevsky <ilyevsky@gmail.com>
    Acked-by: Alexander Graf <agraf@suse.de>
    Signed-off-by: Aurelien Jarno <aurelien@aurel32.net>

diff --git a/target-ppc/translate_init.c b/target-ppc/translate_init.c
index db4dc172b1..e8eadf48aa 100644
--- a/target-ppc/translate_init.c
+++ b/target-ppc/translate_init.c
@@ -777,16 +777,16 @@ static void gen_tbl (CPUPPCState *env)
                  &spr_read_tbl, SPR_NOACCESS,
                  0x00000000);
     spr_register(env, SPR_TBL,   "TBL",
-                 SPR_NOACCESS, SPR_NOACCESS,
-                 SPR_NOACCESS, &spr_write_tbl,
+                 &spr_read_tbl, SPR_NOACCESS,
+                 &spr_read_tbl, &spr_write_tbl,
                  0x00000000);
     spr_register(env, SPR_VTBU,  "TBU",
                  &spr_read_tbu, SPR_NOACCESS,
                  &spr_read_tbu, SPR_NOACCESS,
                  0x00000000);
     spr_register(env, SPR_TBU,   "TBU",
-                 SPR_NOACCESS, SPR_NOACCESS,
-                 SPR_NOACCESS, &spr_write_tbu,
+                 &spr_read_tbu, SPR_NOACCESS,
+                 &spr_read_tbu, &spr_write_tbu,
                  0x00000000);
 }
 

