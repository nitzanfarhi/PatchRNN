commit 1844a1a31fb45fcdeb09c86ff5619ab986df9664
Author: Jan Kundrát <jkt@flaska.net>
Date:   Mon Oct 22 18:50:03 2012 +0200

    Add fancy formatting for signatures

diff --git a/src/Composer/PlainTextFormatter.cpp b/src/Composer/PlainTextFormatter.cpp
index 0be99968..5f216850 100644
--- a/src/Composer/PlainTextFormatter.cpp
+++ b/src/Composer/PlainTextFormatter.cpp
@@ -50,6 +50,8 @@ QStringList plainTextToHtml(const QString &plaintext, const FlowedFormat flowed)
     int quoteLevel = 0;
     QStringList plain(plaintext.split('\n'));
     QStringList markup;
+    // have we seen the signature separator and should we therefore explicitly close that block later?
+    bool shallCloseSignature = false;
     for (int i = 0; i < plain.count(); ++i) {
         QString &line = plain[i];
 
@@ -109,11 +111,17 @@ QStringList plainTextToHtml(const QString &plaintext, const FlowedFormat flowed)
             ++cQuoteLevel;
         }
 
+        if (!shallCloseSignature && line == QLatin1String("-- ")) {
+            // Only recognize the first signature separator
+            shallCloseSignature = true;
+            line.prepend(QLatin1String("<span class=\"signature\">"));
+        }
+
         // appaned or join the line
         if (markup.isEmpty()) {
             markup << line;
         } else if (flowed == FORMAT_FLOWED) {
-            if (markup.last().endsWith(QLatin1Char(' ')) && markup.last() != QLatin1String("-- "))
+            if (markup.last().endsWith(QLatin1Char(' ')) && markup.last() != QLatin1String("<span class=\"signature\">-- "))
                 markup.last().append(line);
             else
                 markup << line;
@@ -121,17 +129,21 @@ QStringList plainTextToHtml(const QString &plaintext, const FlowedFormat flowed)
             markup << line;
         }
     }
+    // close any open elements
+    QString closer;
+    if (shallCloseSignature)
+        closer = QLatin1String("</span>");
     // close open blockquotes
     // (bottom quoters, we're unfortunately -yet- not permittet to shoot them, so we need to deal with them ;-)
-    QString quoteCloser;
     while (quoteLevel > 0) {
-        quoteCloser.append("</blockquote>");
+        closer.append("</blockquote>");
         --quoteLevel;
     }
-    if (!quoteCloser.isEmpty()) {
+    if (!closer.isEmpty()) {
         Q_ASSERT(!markup.isEmpty());
-        markup.last().append(quoteCloser);
+        markup.last().append(closer);
     }
+
     return markup;
 }
 
diff --git a/src/Gui/SimplePartWidget.cpp b/src/Gui/SimplePartWidget.cpp
index 98e2a8fc..d7ee21ac 100644
--- a/src/Gui/SimplePartWidget.cpp
+++ b/src/Gui/SimplePartWidget.cpp
@@ -64,6 +64,7 @@ void SimplePartWidget::slotMarkupPlainText() {
         "pre{word-wrap: break-word; white-space: pre-wrap;}"
         ".quotemarks{color:transparent;font-size:0px;}"
         "blockquote{font-size:90%; margin: 4pt 0 4pt 0; padding: 0 0 0 1em; border-left: 2px solid blue;}"
+        ".signature{opacity: 0.6;}"
     );
 
     // build stylesheet and html header
diff --git a/tests/tests/test_Composer_responses/test_Composer_responses.cpp b/tests/tests/test_Composer_responses/test_Composer_responses.cpp
index 90e323e1..4936c377 100644
--- a/tests/tests/test_Composer_responses/test_Composer_responses.cpp
+++ b/tests/tests/test_Composer_responses/test_Composer_responses.cpp
@@ -151,8 +151,8 @@ void ComposerResponsesTest::testPlainTextFormatting_data()
                                                         "threads get executed and suspended all the time, sometimes migrating between "
                                                         "processors. That adds overhead.\n"
                                                         "\n"
-                                                        "-- \n"
-                                                        "Thiago's name goes here.\n")
+                                                        "<span class=\"signature\">-- \n"
+                                                        "Thiago's name goes here.\n</span>")
                                    << QString::fromUtf8("On quinta-feira, 4 de outubro de 2012 15.46.57, André Somers wrote:\n"
                                                         "<blockquote><span class=\"quotemarks\">&gt; </span>If you think that running 21 threads on an 8 core system will run make \n"
                                                         "your task go faster, then Thiago is right: you don't understand your \n"
@@ -165,8 +165,8 @@ void ComposerResponsesTest::testPlainTextFormatting_data()
                                                         "That means threads get executed and suspended all the time, sometimes \n"
                                                         "migrating between processors. That adds overhead.\n"
                                                         "\n"
-                                                        "-- \n"
-                                                        "Thiago's name goes here.\n");
+                                                        "<span class=\"signature\">-- \n"
+                                                        "Thiago's name goes here.\n</span>");
 
     QTest::newRow("quoted-no-spacing") << QString::fromUtf8("> foo\nbar\n> baz")
                                        << QString::fromUtf8("<blockquote><span class=\"quotemarks\">&gt; </span>foo</blockquote>\n"

