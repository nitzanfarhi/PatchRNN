commit 4ecd1974377ffb4d6d72874ba14fcd23965b1792
Author: Tom Lane <tgl@sss.pgh.pa.us>
Date:   Tue Nov 15 16:48:12 2016 -0500

    Check that result tupdesc has exactly 1 column in return_next scalar case.
    
    This should always be true, but since we're relying on a tuple descriptor
    passed from outside pltcl itself, let's check.  Per a gripe from Coverity.

diff --git a/src/pl/tcl/pltcl.c b/src/pl/tcl/pltcl.c
index b0d9e419bb..5cb4ee85e0 100644
--- a/src/pl/tcl/pltcl.c
+++ b/src/pl/tcl/pltcl.c
@@ -2192,6 +2192,10 @@ pltcl_returnnext(ClientData cdata, Tcl_Interp *interp,
 		Datum		retval;
 		bool		isNull = false;
 
+		/* for paranoia's sake, check that tupdesc has exactly one column */
+		if (call_state->ret_tupdesc->natts != 1)
+			elog(ERROR, "wrong result type supplied in return_next");
+
 		retval = InputFunctionCall(&prodesc->result_in_func,
 								   utf_u2e((char *) Tcl_GetString(objv[1])),
 								   prodesc->result_typioparam,

