commit c94145242f95e15583001c5510500b8abbe48fb4
Author: pancake <pancake@nopcode.org>
Date:   Mon May 16 23:17:03 2016 +0200

    Fix #4739 - Do not run cmd.bp twice

diff --git a/libr/core/cmd_debug.c b/libr/core/cmd_debug.c
index 480f7ce43..ccef61bf6 100644
--- a/libr/core/cmd_debug.c
+++ b/libr/core/cmd_debug.c
@@ -1585,11 +1585,16 @@ static int checkbpcallback(RCore *core) {
 	ut64 pc = r_debug_reg_get (core->dbg, "PC");
 	RBreakpointItem *bpi = r_bp_get_at (core->dbg->bp, pc);
 	if (bpi) {
+		// r_core_debug_breakpoint_hit (core, bpi);
+#if 0
 		const char *cmdbp = r_config_get (core->config, "cmd.bp");
-		if (bpi->data)
+		if (bpi->data && bpi->data[0]) {
 			r_core_cmd (core, bpi->data, 0);
-		if (cmdbp && *cmdbp)
+		}
+		if (cmdbp && *cmdbp) {
 			r_core_cmd (core, cmdbp, 0);
+		}
+#endif
 		return true;
 	}
 	return false;
diff --git a/libr/core/core.c b/libr/core/core.c
index de86a697c..d417ac54a 100644
--- a/libr/core/core.c
+++ b/libr/core/core.c
@@ -84,13 +84,15 @@ static int on_fcn_rename(void *_anal, void* _user, RAnalFunction *fcn, const cha
 }
 
 static void r_core_debug_breakpoint_hit(RCore *core, RBreakpointItem *bpi) {
-	const char *cmdbp;
-	int oecho = core->cons->echo; // should be configurable by user?
-	core->cons->echo = 1; // should be configurable by user?
-	cmdbp = r_config_get (core->config, "cmd.bp");
-	if (cmdbp && *cmdbp)
+	bool oecho = core->cons->echo;
+	const char *cmdbp = r_config_get (core->config, "cmd.bp");
+	core->cons->echo = true;
+	if (cmdbp && *cmdbp) {
 		r_core_cmd0 (core, cmdbp);
-	r_core_cmd0 (core, bpi->data);
+	}
+	if (bpi->data && bpi->data[0]) {
+		r_core_cmd0 (core, bpi->data);
+	}
 	core->cons->echo = oecho;
 }
 

