commit 112f1fc08d0b3f81c594af617d88c0db6ce0873c
Author: Chen Gong <gong.chen@linux.intel.com>
Date:   Fri Dec 7 11:50:02 2012 -0800

    ACPI, APEI, EINJ: Add missed ACPI5 support for error trigger table
    
    To handle error trigger table correctly, memory region must be
    removed from request region. We had a series of patches to do this
    culminating in:
            commit b4e008dc5
            ACPI, APEI, EINJ, Refine the fix of resource conflict
    
    but when ACPI5 support was added, we missed updating this area. So
    when using EINJ table on an ACPI5 enabled machine, we get following error:
    
    APEI: Can not request [mem 0x526b80000-0x526b80007] for APEI EINJ
    Trigger registers
    
    Fix this by checking for the acpi5 case and using the same code
    that was added earlier.
    
    Signed-off-by: Chen Gong <gong.chen@linux.intel.com>
    Signed-off-by: Tony Luck <tony.luck@intel.com>

diff --git a/drivers/acpi/apei/einj.c b/drivers/acpi/apei/einj.c
index 8e1793649ec0..8d457b55c55a 100644
--- a/drivers/acpi/apei/einj.c
+++ b/drivers/acpi/apei/einj.c
@@ -367,7 +367,7 @@ static int __einj_error_trigger(u64 trigger_paddr, u32 type,
 	 * This will cause resource conflict with regular memory.  So
 	 * remove it from trigger table resources.
 	 */
-	if (param_extension && (type & 0x0038) && param2) {
+	if ((param_extension || acpi5) && (type & 0x0038) && param2) {
 		struct apei_resources addr_resources;
 		apei_resources_init(&addr_resources);
 		trigger_param_region = einj_get_trigger_parameter_region(

