commit 780dbcd0eedec6528d777b668019dabb36badf1a
Author: Zhang, Yang Z <yang.z.zhang@intel.com>
Date:   Tue May 22 08:40:16 2012 +0000

    xen/pci: Check for PCI bridge before using it.
    
    Some SR-IOV devices may use more than one bus number, but there is no real bridges
    because that have internal routing mechanism. So need to check whether the bridge is
    existing before using it.
    
    Signed-off-by: Yang Zhang <yang.z.zhang@Intel.com>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

diff --git a/drivers/xen/pci.c b/drivers/xen/pci.c
index b84bf0b6cc34..18fff88254eb 100644
--- a/drivers/xen/pci.c
+++ b/drivers/xen/pci.c
@@ -59,7 +59,7 @@ static int xen_add_device(struct device *dev)
 
 #ifdef CONFIG_ACPI
 		handle = DEVICE_ACPI_HANDLE(&pci_dev->dev);
-		if (!handle)
+		if (!handle && pci_dev->bus->bridge)
 			handle = DEVICE_ACPI_HANDLE(pci_dev->bus->bridge);
 #ifdef CONFIG_PCI_IOV
 		if (!handle && pci_dev->is_virtfn)

