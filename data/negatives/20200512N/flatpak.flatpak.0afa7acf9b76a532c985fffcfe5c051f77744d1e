commit 0afa7acf9b76a532c985fffcfe5c051f77744d1e
Author: Philip Withnall <withnall@endlessm.com>
Date:   Wed Dec 20 12:19:38 2017 +0000

    common/dir: Donâ€™t ignore errors replacing a file on undeploy
    
    Emit a warning about them rather than ignoring them entirely.
    
    Coverity CID: 1376554
    
    Signed-off-by: Philip Withnall <withnall@endlessm.com>
    
    Closes: #1267
    Approved by: alexlarsson

diff --git a/common/flatpak-dir.c b/common/flatpak-dir.c
index ed42403a..fbb3ae4b 100644
--- a/common/flatpak-dir.c
+++ b/common/flatpak-dir.c
@@ -7157,6 +7157,7 @@ flatpak_dir_undeploy (FlatpakDir   *self,
   g_autofree char *tmpname = g_strdup_printf ("removed-%s-XXXXXX", active_id);
   g_autofree char *current_active = NULL;
   g_autoptr(GFile) change_file = NULL;
+  g_autoptr(GError) child_error = NULL;
   int i;
 
   g_assert (ref != NULL);
@@ -7219,8 +7220,14 @@ flatpak_dir_undeploy (FlatpakDir   *self,
     change_file = g_file_resolve_relative_path (removed_subdir, "files/.updated");
   else
     change_file = g_file_resolve_relative_path (removed_subdir, "files/.removed");
-  g_file_replace_contents (change_file, "", 0, NULL, FALSE,
-                           G_FILE_CREATE_REPLACE_DESTINATION, NULL, NULL, NULL);
+
+  if (!g_file_replace_contents (change_file, "", 0, NULL, FALSE,
+                                G_FILE_CREATE_REPLACE_DESTINATION, NULL, NULL, &child_error))
+    {
+      g_autofree gchar *path = g_file_get_path (change_file);
+      g_warning ("Unable to clear %s: %s", path, child_error->message);
+      g_clear_error (&child_error);
+    }
 
   if (force_remove || !dir_is_locked (removed_subdir))
     {

