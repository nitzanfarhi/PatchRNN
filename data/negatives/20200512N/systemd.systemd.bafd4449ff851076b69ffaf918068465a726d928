commit bafd4449ff851076b69ffaf918068465a726d928
Author: Lennart Poettering <lennart@poettering.net>
Date:   Mon Jun 27 23:07:28 2011 +0200

    logind: properly detect whether we got the bus name

diff --git a/src/logind.c b/src/logind.c
index 25773209e..863b1636d 100644
--- a/src/logind.c
+++ b/src/logind.c
@@ -764,8 +764,15 @@ static int manager_connect_bus(Manager *m) {
                 goto fail;
         }
 
-        if (dbus_bus_request_name(m->bus, "org.freedesktop.login1", DBUS_NAME_FLAG_DO_NOT_QUEUE, &error) < 0) {
-                log_error("Failed to register name on bus: %s", error.message);
+        r = dbus_bus_request_name(m->bus, "org.freedesktop.login1", DBUS_NAME_FLAG_DO_NOT_QUEUE, &error);
+        if (dbus_error_is_set(&error)) {
+                log_error("Failed to register name on bus: %s", bus_error_message(&error));
+                r = -EIO;
+                goto fail;
+        }
+
+        if (r != DBUS_REQUEST_NAME_REPLY_PRIMARY_OWNER)  {
+                log_error("Failed to acquire name.");
                 r = -EEXIST;
                 goto fail;
         }

