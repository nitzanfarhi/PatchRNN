commit 264bc938e956288ec7a2a43417c01c3a3ce840fd
Author: Timo Sirainen <tss@iki.fi>
Date:   Sun Jan 16 20:41:58 2005 +0200

    Added asserts
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mail-index-sync-ext.c b/src/lib-index/mail-index-sync-ext.c
index 12aeee1e6..dccd9b912 100644
--- a/src/lib-index/mail-index-sync-ext.c
+++ b/src/lib-index/mail-index-sync-ext.c
@@ -306,6 +306,7 @@ sync_ext_resize(const struct mail_transaction_ext_intro *u, uint32_t ext_id,
 		modified = TRUE;
 
 	if (modified) {
+		i_assert((map->hdr_copy_buf->used % sizeof(uint64_t)) == 0);
 		map->hdr_base = map->hdr_copy_buf->data;
 		map->hdr.header_size = map->hdr_copy_buf->used;
 
@@ -412,6 +413,7 @@ int mail_index_sync_ext_intro(struct mail_index_sync_map_ctx *ctx,
 		MAIL_INDEX_HEADER_SIZE_ALIGN(ext->hdr_size));
 	i_assert(hdr_buf->used ==
 		 hdr_offset + MAIL_INDEX_HEADER_SIZE_ALIGN(ext->hdr_size));
+	i_assert((hdr_buf->used % sizeof(uint64_t)) == 0);
 
 	map->hdr.header_size = hdr_buf->used;
 	map->hdr_base = map->hdr_copy_buf->data;
diff --git a/src/lib-index/mail-index.c b/src/lib-index/mail-index.c
index 3517ff37e..95d81df73 100644
--- a/src/lib-index/mail-index.c
+++ b/src/lib-index/mail-index.c
@@ -1162,6 +1162,8 @@ static void mail_index_header_init(struct mail_index_header *hdr)
 {
 	time_t now = time(NULL);
 
+	i_assert((sizeof(*hdr) % sizeof(uint64_t)) == 0);
+
 	memset(hdr, 0, sizeof(*hdr));
 
 	hdr->major_version = MAIL_INDEX_MAJOR_VERSION;

