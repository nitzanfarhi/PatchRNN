commit 310354406aecba66ac0acbfd7d8ed8abb8bfcd5d
Author: Bj√∂rn-Egil Dahlberg <egil@erlang.org>
Date:   Thu Oct 11 15:16:08 2012 +0200

    erts: Search for heart in ports that are alive

diff --git a/erts/emulator/beam/io.c b/erts/emulator/beam/io.c
index 502ded4eca..88e9215a9c 100644
--- a/erts/emulator/beam/io.c
+++ b/erts/emulator/beam/io.c
@@ -5248,7 +5248,10 @@ Port *erts_get_heart_port() {
 
     for(ix = 0; ix < erts_max_ports; ix++) {
 	port = &erts_port[ix];
-	/* immediate compare */
+	/* only examine undead or alive ports */
+	if (port->status & ERTS_PORT_SFLGS_DEAD)
+	    continue;
+	/* immediate atom compare */
 	if (port->reg && port->reg->name == am_heart_port) {
 	    return port;
 	}

