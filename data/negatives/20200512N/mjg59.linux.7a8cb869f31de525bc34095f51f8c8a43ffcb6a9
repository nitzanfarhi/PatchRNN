commit 7a8cb869f31de525bc34095f51f8c8a43ffcb6a9
Author: Kenji Kaneshige <kaneshige.kenji@jp.fujitsu.com>
Date:   Mon May 23 19:50:32 2005 +0900

    [PATCH] PCI Hotplug: shpchp driver doesn't program _HPP values properly
    
    Current shpchp driver doesn't seem to program _HPP values
    properly. The following patch fixes this issue.
    
    Signed-off-by: Kenji Kaneshige <kaneshige.kenji@jp.fujitsu.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/pci/hotplug/shpchprm_acpi.c b/drivers/pci/hotplug/shpchprm_acpi.c
index 243a51d88b86..18aa65a206a6 100644
--- a/drivers/pci/hotplug/shpchprm_acpi.c
+++ b/drivers/pci/hotplug/shpchprm_acpi.c
@@ -1626,7 +1626,7 @@ int shpchprm_set_hpp(
 	pci_bus->number = func->bus;
 	devfn = PCI_DEVFN(func->device, func->function);
 
-	ab = find_acpi_bridge_by_bus(acpi_bridges_head, ctrl->seg, ctrl->bus);
+	ab = find_acpi_bridge_by_bus(acpi_bridges_head, ctrl->seg, ctrl->slot_bus);
 
 	if (ab) {
 		if (ab->_hpp) {

