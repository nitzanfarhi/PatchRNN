commit 79639d423f779e65f24d0fcc05b14d6c45b4a894
Author: bellard <bellard@c046a42c-6fe2-441c-8c8c-71466251a162>
Date:   Sat Nov 26 10:58:41 2005 +0000

    update boot sector when using -kernel (Magnus Damm)
    
    
    git-svn-id: svn://svn.savannah.nongnu.org/qemu/trunk@1664 c046a42c-6fe2-441c-8c8c-71466251a162

diff --git a/block.c b/block.c
index 077c278557..efd96e637f 100644
--- a/block.c
+++ b/block.c
@@ -444,6 +444,9 @@ int bdrv_write(BlockDriverState *bs, int64_t sector_num,
         return -1;
     if (bs->read_only)
         return -1;
+    if (sector_num == 0 && bs->boot_sector_enabled && nb_sectors > 0) {
+        memcpy(bs->boot_sector_data, buf, 512);   
+    }
     return bs->drv->bdrv_write(bs, sector_num, buf, nb_sectors);
 }
 

