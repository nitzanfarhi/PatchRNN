commit c3629df4c170553978c7603a1337d979c7fbbf73
Author: matyhtf <mikan.tenny@gmail.com>
Date:   Tue Mar 20 11:46:09 2018 +0800

    added reactor->onBegin callback.

diff --git a/include/swoole.h b/include/swoole.h
index 3a45a407..f7d2b9e8 100644
--- a/include/swoole.h
+++ b/include/swoole.h
@@ -1464,6 +1464,7 @@ struct _swReactor
 
     void (*onTimeout)(swReactor *);
     void (*onFinish)(swReactor *);
+    void (*onBegin)(swReactor *);
 
     void (*enable_accept)(swReactor *);
     int (*can_exit)(swReactor *);
diff --git a/src/reactor/ReactorEpoll.c b/src/reactor/ReactorEpoll.c
index 4ffd760a..55ae6697 100644
--- a/src/reactor/ReactorEpoll.c
+++ b/src/reactor/ReactorEpoll.c
@@ -215,6 +215,10 @@ static int swReactorEpoll_wait(swReactor *reactor, struct timeval *timeo)
 
     while (reactor->running > 0)
     {
+        if (reactor->onBegin != NULL)
+        {
+            reactor->onBegin(reactor);
+        }
         msec = reactor->timeout_msec;
         n = epoll_wait(epoll_fd, events, max_event_num, msec);
         if (n < 0)
diff --git a/src/reactor/ReactorKqueue.c b/src/reactor/ReactorKqueue.c
index 781ffc7a..02b9c2d5 100644
--- a/src/reactor/ReactorKqueue.c
+++ b/src/reactor/ReactorKqueue.c
@@ -277,6 +277,10 @@ static int swReactorKqueue_wait(swReactor *reactor, struct timeval *timeo)
 
     while (reactor->running > 0)
     {
+        if (reactor->onBegin != NULL)
+        {
+            reactor->onBegin(reactor);
+        }
         if (reactor->timeout_msec > 0)
         {
             t.tv_sec = reactor->timeout_msec / 1000;
diff --git a/src/reactor/ReactorPoll.c b/src/reactor/ReactorPoll.c
index ce883e17..90f2d7a1 100644
--- a/src/reactor/ReactorPoll.c
+++ b/src/reactor/ReactorPoll.c
@@ -210,6 +210,10 @@ static int swReactorPoll_wait(swReactor *reactor, struct timeval *timeo)
 
     while (reactor->running > 0)
     {
+        if (reactor->onBegin != NULL)
+        {
+            reactor->onBegin(reactor);
+        }
         msec = reactor->timeout_msec;
         ret = poll(object->events, reactor->event_num, msec);
         if (ret < 0)
diff --git a/src/reactor/ReactorSelect.c b/src/reactor/ReactorSelect.c
index 4b5f7390..2cef704b 100644
--- a/src/reactor/ReactorSelect.c
+++ b/src/reactor/ReactorSelect.c
@@ -183,6 +183,11 @@ int swReactorSelect_wait(swReactor *reactor, struct timeval *timeo)
         FD_ZERO(&(object->wfds));
         FD_ZERO(&(object->efds));
 
+        if (reactor->onBegin != NULL)
+        {
+            reactor->onBegin(reactor);
+        }
+
         LL_FOREACH(object->fds, ev)
         {
             if (swReactor_event_read(ev->fdtype))

