commit c7f2ca7d9cd5359fa82869a0a8d6ef1df4eb8132
Author: aCaB <acab@clamav.net>
Date:   Thu Mar 4 19:13:09 2010 +0100

    fucking nasty fmap bug - i now actually overmap the pages i'm sposed to

diff --git a/libclamav/fmap.c b/libclamav/fmap.c
index 53ff4d26a..14171c73a 100644
--- a/libclamav/fmap.c
+++ b/libclamav/fmap.c
@@ -184,7 +184,7 @@ static void fmap_aging(fmap_t *m) {
 	}
 	if(avail) { /* at least one page is paged and not locked */
 	    for(i=0; i<avail; i++) {
-		char *pptr = (char *)m + i * m->pgsz + m->hdrsz;
+		char *pptr = (char *)m + freeme[i] * m->pgsz + m->hdrsz;
 		/* we mark the page as seen */
 		fmap_bitmap[freeme[i]] = FM_MASK_SEEN;
 		/* and we mmap the page over so the kernel knows there's nothing good in there */

