commit a1466d1edce5cad479ea9082f7d8d7da85edd25e
Author: unknown <vva@eagle.mysql.r18.ru>
Date:   Mon Feb 16 18:09:23 2004 +0400

    fixed bug #1661 Compiling --pstack fails with binutils 2.13.90
    
    fixed wrong execution of bfd_get_symtab_upper_bound in pstack/pstack.c
    for files which don't contain symbols..
    to avoid failing of new binutils (old binutils returned 0 in this case)
    
    
    pstack/pstack.c:
      fixed bug #1661 Compiling --pstack fails with binutils 2.13.90
    
      fixed wrong execution of bfd_get_symtab_upper_bound
      for files which don't contain symbols..
      to avoid failing of new binutils (old binutils returned 0 in this case)

diff --git a/pstack/pstack.c b/pstack/pstack.c
index 48280d4aedb..75869686e35 100644
--- a/pstack/pstack.c
+++ b/pstack/pstack.c
@@ -2667,7 +2667,8 @@ pstack_install_segv_action(	const char*	path_format_)
 	if ((abfd = load_bfd(pid))==0)
 		fprintf(stderr, "BFD load failed..\n");
 	else {
-		long	storage_needed = bfd_get_symtab_upper_bound (abfd);
+		long    storage_needed= (bfd_get_file_flags(abfd) & HAS_SYMS) ?
+		  bfd_get_symtab_upper_bound (abfd) : 0;
 		long	i;
 		(void)i;
 

