commit f6c55f56f71442f36dceba20160ac6255c7d91a2
Author: danieldg <danieldg@e03df62e-2008-0410-955e-edbf42e46eb7>
Date:   Thu Mar 18 23:39:22 2010 +0000

    Only check password during second connect block check; add registered="yes" to get the previous behavior
    
    git-svn-id: http://svn.inspircd.org/repository/trunk/inspircd@12644 e03df62e-2008-0410-955e-edbf42e46eb7

diff --git a/src/users.cpp b/src/users.cpp
index 8aeb4a1f6..3f19aa86c 100644
--- a/src/users.cpp
+++ b/src/users.cpp
@@ -1622,7 +1622,7 @@ void LocalUser::SetClass(const std::string &explicit_name)
 					continue;
 			}
 
-			if (!c->config->getString("pass").empty())
+			if (regdone && !c->config->getString("pass").empty())
 			{
 				if (ServerInstance->PassCompare(this, c->config->getString("pass"), password, c->config->getString("hash")))
 				{

