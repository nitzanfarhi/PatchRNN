commit 7fe412d07d881020022a188b95c63a19b651a391
Author: Venkatesh Srinivas <venkateshs@google.com>
Date:   Mon Feb 24 14:13:32 2014 -0800

    vhost/scsi: Check LUN structure byte 0 is set to 1, per spec
    
    The virtio spec requires byte 0 of the virtio-scsi LUN structure
    to be '1'.
    
    Signed-off-by: Venkatesh Srinivas <venkateshs@google.com>
    Reviewed-by: Paolo Bonzini <pbonzini@redhat.com>
    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>

diff --git a/drivers/vhost/scsi.c b/drivers/vhost/scsi.c
index 0a025b8e2a12..e48d4a672580 100644
--- a/drivers/vhost/scsi.c
+++ b/drivers/vhost/scsi.c
@@ -1001,6 +1001,12 @@ vhost_scsi_handle_vq(struct vhost_scsi *vs, struct vhost_virtqueue *vq)
 			break;
 		}
 
+		/* virtio-scsi spec requires byte 0 of the lun to be 1 */
+		if (unlikely(v_req.lun[0] != 1)) {
+			vhost_scsi_send_bad_target(vs, vq, head, out);
+			continue;
+		}
+
 		/* Extract the tpgt */
 		target = v_req.lun[1];
 		tpg = ACCESS_ONCE(vs_tpg[target]);

