commit 9a0e88b3a5960cc12e30f0239cd751fb0991e663
Author: Guy Harris <guy@alum.mit.edu>
Date:   Sun Sep 29 22:54:13 2013 +0000

    For an EPB, write out an "end of options" option if we write out any
    other options.
    
    Eliminate duplicate comment.
    
    Fix indentation.
    
    svn path=/trunk/; revision=52280

diff --git a/pcapio.c b/pcapio.c
index dd1cab4624..8fc7566298 100644
--- a/pcapio.c
+++ b/pcapio.c
@@ -529,7 +529,6 @@ pcapng_write_enhanced_packet_block(FILE* pfile,
                                             sizeof(guint32));
         }
         /* If we have options add size of end-of-options */
-        /* If we have options add size of end-of-options */
         if (options_length != 0) {
                 options_length += (guint32)sizeof(struct option);
         }
@@ -564,7 +563,14 @@ pcapng_write_enhanced_packet_block(FILE* pfile,
                 option.value_length = 0;
                 if (!write_to_file(pfile, (const guint8*)&option, sizeof(struct option), bytes_written, err))
                         return FALSE;
-       }
+        }
+        if (options_length != 0) {
+                /* write end of options */
+                option.type = OPT_ENDOFOPT;
+                option.value_length = 0;
+                if (!write_to_file(pfile, (const guint8*)&option, sizeof(struct option), bytes_written, err))
+                        return FALSE;
+        }
 
        return write_to_file(pfile, (const guint8*)&block_total_length, sizeof(guint32), bytes_written, err);
 }

