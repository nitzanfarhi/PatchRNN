commit a0820eaa8a5f96a3254b096e59fbd390f7b0afa6
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Tue Mar 27 02:43:40 2012 +0200

    ffmpeg: fix handling or empty audio packets
    
    Fixes Ticket1131
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/ffmpeg.c b/ffmpeg.c
index f66828ffa5..d5e789e111 100644
--- a/ffmpeg.c
+++ b/ffmpeg.c
@@ -1083,7 +1083,7 @@ static int encode_audio_frame(AVFormatContext *s, OutputStream *ost,
     pkt.data = NULL;
     pkt.size = 0;
 
-    if (buf) {
+    if (buf && buf_size) {
         if (!ost->output_frame) {
             ost->output_frame = avcodec_alloc_frame();
             if (!ost->output_frame) {

