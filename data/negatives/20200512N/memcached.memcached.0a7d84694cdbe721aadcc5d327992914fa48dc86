commit 0a7d84694cdbe721aadcc5d327992914fa48dc86
Author: Dustin Sallings <dustin@spy.net>
Date:   Fri Mar 13 20:24:14 2009 -0700

    A bit more space for server_stats, and an assertion (bug 27).
    
    I couldn't figure out how to get the stats output big enough to exceed
    1024, but I accept it might.
    
    I've given it a bit more space here and added an assertion to detect
    when we fail in case we can figure out how to actually have this occur.
    
    Maxing out pretty much everything got me up to 828 bytes:
    
    STAT pid 35893
    STAT uptime 152
    STAT time 1237000260
    STAT version 1.3.2
    STAT pointer_size 32
    STAT rusage_user 0.002487
    STAT rusage_system 0.005412
    STAT curr_connections 4
    STAT total_connections 5
    STAT connection_structures 5
    STAT cmd_get 18446744073709551610
    STAT cmd_set 18446744073709551610
    STAT get_hits 18446744073709551610
    STAT get_misses 18446744073709551610
    STAT delete_misses 18446744073709551610
    STAT delete_hits 18446744073709551610
    STAT incr_misses 18446744073709551610
    STAT incr_hits 18446744073709551610
    STAT decr_misses 18446744073709551610
    STAT decr_hits 18446744073709551610
    STAT cas_misses 18446744073709551610
    STAT cas_hits 18446744073709551610
    STAT cas_badval 18446744073709551610
    STAT bytes_read 1
    STAT bytes_written 18446744073709551610
    STAT limit_maxbytes 67108864
    STAT threads 5
    STAT bytes 18446744073709551610
    STAT curr_items 4294967290
    STAT total_items 4294967290
    STAT evictions 18446744073709551610

diff --git a/memcached.c b/memcached.c
index f6a287f..be9f2c2 100644
--- a/memcached.c
+++ b/memcached.c
@@ -2092,7 +2092,7 @@ static char *server_stats(uint32_t (*add_stats)(char *buf, const char *key,
                           const uint16_t klen, const char *val,
                           const uint32_t vlen, void *cookie), conn *c,
                           int *buflen) {
-    char temp[1024];
+    char temp[2048];
     char val[128];
     char *buf = NULL;
     char *pos = temp;
@@ -2274,6 +2274,8 @@ static char *server_stats(uint32_t (*add_stats)(char *buf, const char *key,
     pos += nbytes;
     *buflen += nbytes;
 
+    assert(*buflen < sizeof(temp));
+
     if(*buflen > 0 && (buf = malloc(*buflen)) == NULL) {
         STATS_UNLOCK();
         return NULL;

