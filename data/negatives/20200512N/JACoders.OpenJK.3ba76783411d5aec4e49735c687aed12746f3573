commit 3ba76783411d5aec4e49735c687aed12746f3573
Author: Razish <mrrazish@gmail.com>
Date:   Wed Apr 24 23:00:02 2013 +1000

    Add sv_filterCommands (default 0) so we can still use semicolons in chat.

diff --git a/codemp/qcommon/cmd_common.cpp b/codemp/qcommon/cmd_common.cpp
index 56f475ab..1ff512a9 100644
--- a/codemp/qcommon/cmd_common.cpp
+++ b/codemp/qcommon/cmd_common.cpp
@@ -438,18 +438,15 @@ char *Cmd_Cmd(void)
    https://bugzilla.icculus.org/show_bug.cgi?id=4769
 */
 
-void Cmd_Args_Sanitize(void)
-{
-	int i;
-
-	for(i = 1; i < cmd_argc; i++)
+void Cmd_Args_Sanitize( void ) {
+	for ( int i=1; i<cmd_argc; i++ )
 	{
 		char *c = cmd_argv[i];
 		
-		if(strlen(c) > MAX_CVAR_VALUE_STRING - 1)
-			c[MAX_CVAR_VALUE_STRING - 1] = '\0';
+		if ( strlen( c ) >= MAX_CVAR_VALUE_STRING )
+			c[MAX_CVAR_VALUE_STRING-1] = '\0';
 		
-		while ((c = strpbrk(c, "\n\r;"))) {
+		while ( (c=strpbrk( c, "\n\r;" )) ) {
 			*c = ' ';
 			++c;
 		}
diff --git a/codemp/server/server.h b/codemp/server/server.h
index 525ba16e..79ac42ae 100644
--- a/codemp/server/server.h
+++ b/codemp/server/server.h
@@ -239,6 +239,7 @@ extern	cvar_t	*sv_pure;
 extern	cvar_t	*sv_floodProtect;
 extern	cvar_t	*sv_lanForceRate;
 extern	cvar_t	*sv_needpass;
+extern	cvar_t	*sv_filterCommands;
 
 //===========================================================
 
diff --git a/codemp/server/sv_client.cpp b/codemp/server/sv_client.cpp
index bb4a6688..b6e8f9d0 100644
--- a/codemp/server/sv_client.cpp
+++ b/codemp/server/sv_client.cpp
@@ -1398,7 +1398,9 @@ void SV_ExecuteClientCommand( client_t *cl, const char *s, qboolean clientOK ) {
 	if (clientOK) {
 		// pass unknown strings to the game
 		if (!u->name && sv.state == SS_GAME && (cl->state == CS_ACTIVE || cl->state == CS_PRIMED)) {
-			Cmd_Args_Sanitize();
+			// strip \r \n and ;
+			if ( sv_filterCommands->integer )
+				Cmd_Args_Sanitize();
 			VM_Call( gvm, GAME_CLIENT_COMMAND, cl - svs.clients );
 		}
 	}
diff --git a/codemp/server/sv_init.cpp b/codemp/server/sv_init.cpp
index 640cf62f..f72cbcae 100644
--- a/codemp/server/sv_init.cpp
+++ b/codemp/server/sv_init.cpp
@@ -963,6 +963,8 @@ void SV_Init (void) {
 	sv_mapChecksum = Cvar_Get ("sv_mapChecksum", "", CVAR_ROM);
 	sv_lanForceRate = Cvar_Get ("sv_lanForceRate", "1", CVAR_ARCHIVE );
 
+	sv_filterCommands = Cvar_Get( "sv_filterCommands", "0", CVAR_ARCHIVE );
+
 //	sv_debugserver = Cvar_Get ("sv_debugserver", "0", 0);
 
 	// initialize bot cvars so they are listed and can be set before loading the botlib
diff --git a/codemp/server/sv_main.cpp b/codemp/server/sv_main.cpp
index 11133ba7..b9ff53d6 100644
--- a/codemp/server/sv_main.cpp
+++ b/codemp/server/sv_main.cpp
@@ -38,6 +38,7 @@ cvar_t	*sv_pure;
 cvar_t	*sv_floodProtect;
 cvar_t	*sv_lanForceRate; // dedicated 1 (LAN) server forces local client rates to 99999 (bug #491)
 cvar_t	*sv_needpass;
+cvar_t	*sv_filterCommands; // strict filtering on commands (replace: \r \n ;)
 /*
 =============================================================================
 

