commit 50db6b134c31351a03cec9d2a7f9e61f63a5ce9f
Author: Seokmann Ju <seokmann.ju@qlogic.com>
Date:   Thu Jan 17 09:02:14 2008 -0800

    [SCSI] qla2xxx: Add a filter to compare port_name against the physical on vport creation.
    
    During vport creation, there was a possibility to get create a
    vport with same port_name as pport.  A new filter has added to
    compare given port_name with the port_name of the pport.
    
    Signed-Off-by: Seokmann Ju <seokmann.ju@qlogic.com>
    Signed-off-by: Andrew Vasquez <andrew.vasquez@qlogic.com>
    Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>

diff --git a/drivers/scsi/qla2xxx/qla_mid.c b/drivers/scsi/qla2xxx/qla_mid.c
index 325bdab11903..dea37689b7d4 100644
--- a/drivers/scsi/qla2xxx/qla_mid.c
+++ b/drivers/scsi/qla2xxx/qla_mid.c
@@ -341,6 +341,8 @@ qla24xx_vport_create_req_sanity_check(struct fc_vport *fc_vport)
 
 	/* Check up unique WWPN */
 	u64_to_wwn(fc_vport->port_name, port_name);
+	if (!memcmp(port_name, ha->port_name, WWN_SIZE))
+		return VPCERR_BAD_WWN;
 	vha = qla24xx_find_vhost_by_name(ha, port_name);
 	if (vha)
 		return VPCERR_BAD_WWN;

