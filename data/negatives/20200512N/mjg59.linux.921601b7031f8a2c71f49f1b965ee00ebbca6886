commit 921601b7031f8a2c71f49f1b965ee00ebbca6886
Author: Mike Christie <michaelc@cs.wisc.edu>
Date:   Thu Jan 31 13:36:49 2008 -0600

    [SCSI] qla4xxx: add async scan support
    
    qla4xxx has the old school startup/probe where it finds presetup sessions
    in its flash and then attempts to log into them before returning from the
    probe. This however, makes it very simple to add a iscsi class scan finished
    helper which the driver can use.
    
    In future patches Dave or I will rip apart the driver to make it more
    like qla2xxx, but for now this is a very simple two line patch which
    fixes the problem of trying to figure out when the initial sessions
    are done being scanned.
    
    Signed-off-by: Mike Christie <michaelc@cs.wisc.edu>
    Cc: David Somayajulu <david.somayajulu@qlogic.com>
    Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>

diff --git a/drivers/scsi/qla4xxx/ql4_os.c b/drivers/scsi/qla4xxx/ql4_os.c
index d4dd149b466f..c3c59d763037 100644
--- a/drivers/scsi/qla4xxx/ql4_os.c
+++ b/drivers/scsi/qla4xxx/ql4_os.c
@@ -89,6 +89,8 @@ static struct scsi_host_template qla4xxx_driver_template = {
 	.slave_alloc		= qla4xxx_slave_alloc,
 	.slave_destroy		= qla4xxx_slave_destroy,
 
+	.scan_finished		= iscsi_scan_finished,
+
 	.this_id		= -1,
 	.cmd_per_lun		= 3,
 	.use_clustering		= ENABLE_CLUSTERING,
@@ -1306,7 +1308,7 @@ static int __devinit qla4xxx_probe_adapter(struct pci_dev *pdev,
 	       qla4xxx_version_str, ha->pdev->device, pci_name(ha->pdev),
 	       ha->host_no, ha->firmware_version[0], ha->firmware_version[1],
 	       ha->patch_number, ha->build_number);
-
+	scsi_scan_host(host);
 	return 0;
 
 remove_host:

