commit 33a798c880f9a8bed1fe95531349e5e5ef1e0cd2
Author: Junio C Hamano <gitster@pobox.com>
Date:   Mon Aug 6 00:20:06 2007 -0700

    setup.c:verify_non_filename(): don't die unnecessarily while disambiguating
    
    If you have a working tree _file_ "foo", attempt to refer to a
    branch "foo/bar" without -- to disambiguate, like this:
    
            $ git log foo/bar
    
    tried to make sure that foo/bar cannot be naming a working tree
    file "foo/bar" (in which case we would say "which one do you
    want?  A rev or a working tree file?  clarify with -- please").
    We run lstat("foo/bar") to check that.  If it does not succeed,
    there is no ambiguity.
    
    That is good.  But we also checked the error status for the
    lstat() and expected it to fail with ENOENT.  In this particular
    case, however, it fails with ENOTDIR.  That should be treated as
    "expected error" as well.
    
    Signed-off-by: Junio C Hamano <gitster@pobox.com>

diff --git a/setup.c b/setup.c
index a45ea8309..2b8e8c0e5 100644
--- a/setup.c
+++ b/setup.c
@@ -103,7 +103,7 @@ void verify_non_filename(const char *prefix, const char *arg)
 	if (!lstat(name, &st))
 		die("ambiguous argument '%s': both revision and filename\n"
 		    "Use '--' to separate filenames from revisions", arg);
-	if (errno != ENOENT)
+	if (errno != ENOENT && errno != ENOTDIR)
 		die("'%s': %s", arg, strerror(errno));
 }
 

