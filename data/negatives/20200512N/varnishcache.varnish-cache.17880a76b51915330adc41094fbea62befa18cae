commit 17880a76b51915330adc41094fbea62befa18cae
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Sat Feb 13 08:55:05 2010 +0000

    Assert that we found all active fd's
    
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@4560 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/cache_waiter_poll.c b/bin/varnishd/cache_waiter_poll.c
index f68ac9f33..c83ad0f16 100644
--- a/bin/varnishd/cache_waiter_poll.c
+++ b/bin/varnishd/cache_waiter_poll.c
@@ -156,6 +156,9 @@ vca_main(void *arg)
 			if (pollfd[fd].revents) {
 				v--;
 				i = HTC_Rx(sp->htc);
+				if (pollfd[fd].revents != POLLIN)
+					VSL(SLT_Debug, fd, "Poll: %x / %d",
+					    pollfd[fd].revents, i);
 				VTAILQ_REMOVE(&sesshead, sp, list);
 				if (i == 0) {
 					/* Mov to front of list for speed */
@@ -172,6 +175,7 @@ vca_main(void *arg)
 				SES_Delete(sp);
 			}
 		}
+		assert(v == 0);
 	}
 	NEEDLESS_RETURN(NULL);
 }

