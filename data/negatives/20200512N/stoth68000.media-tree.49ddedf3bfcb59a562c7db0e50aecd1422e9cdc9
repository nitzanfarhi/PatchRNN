commit 49ddedf3bfcb59a562c7db0e50aecd1422e9cdc9
Author: Martin Sperl <kernel@martin.sperl.org>
Date:   Fri Nov 27 13:56:03 2015 +0000

    spi: add spi_message_init_no_memset to avoid zeroing the spi_message
    
    In the spi_loopback_test driver there is the need to initialize
    a spi_message that is filled with values from a static structure.
    
    Applying spi_message_init to such a prefilled structure results in
    all the settings getting reset to zero, which is not what we want.
    Copying each field of spi_message separately instead always includes
    the risk that some new fields have not been implemented in the copying
    code.
    
    So here we introduce a version of spi_message_init called
    spi_message_init_no_memset that does not fill the structure
    with zero first, but only initializes the relevant list_heads.
    
    Signed-off-by: Martin Sperl <kernel@martin.sperl.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/include/linux/spi/spi.h b/include/linux/spi/spi.h
index cce80e6dc7d1..4c54d4744107 100644
--- a/include/linux/spi/spi.h
+++ b/include/linux/spi/spi.h
@@ -762,10 +762,15 @@ struct spi_message {
 	void			*state;
 };
 
+static inline void spi_message_init_no_memset(struct spi_message *m)
+{
+	INIT_LIST_HEAD(&m->transfers);
+}
+
 static inline void spi_message_init(struct spi_message *m)
 {
 	memset(m, 0, sizeof *m);
-	INIT_LIST_HEAD(&m->transfers);
+	spi_message_init_no_memset(m);
 }
 
 static inline void

