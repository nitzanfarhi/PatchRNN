commit d5898510adbe9c45d16a770531a3e7c95061956b
Author: Alex Hermann <alex@speakup.nl>
Date:   Mon Oct 3 15:55:42 2011 +0200

    modules_k/tmx: Add active_transactions statistics
    
    An active transaction is a transaction that is still waiting for a reply.
    If it has seen a reply but is existing just to collect retransmissions,
    it is not counted (in contrast to inuse_transactions).

diff --git a/modules_k/tmx/tmx_mod.c b/modules_k/tmx/tmx_mod.c
index 5ee9c05aa..927feb15e 100644
--- a/modules_k/tmx/tmx_mod.c
+++ b/modules_k/tmx/tmx_mod.c
@@ -90,6 +90,7 @@ unsigned long tmx_stats_trans_4xx(void);
 unsigned long tmx_stats_trans_5xx(void);
 unsigned long tmx_stats_trans_6xx(void);
 unsigned long tmx_stats_trans_inuse(void);
+unsigned long tmx_stats_trans_active(void);
 #if 0
 unsigned long tmx_stats_rcv_rpls(void);
 unsigned long tmx_stats_rld_rpls(void);
@@ -105,6 +106,7 @@ static stat_export_t mod_stats[] = {
 	{"5xx_transactions" ,    STAT_IS_FUNC, (stat_var**)tmx_stats_trans_5xx   },
 	{"6xx_transactions" ,    STAT_IS_FUNC, (stat_var**)tmx_stats_trans_6xx   },
 	{"inuse_transactions" ,  STAT_IS_FUNC, (stat_var**)tmx_stats_trans_inuse },
+	{"active_transactions" , STAT_IS_FUNC, (stat_var**)tmx_stats_trans_active},
 #if 0
 	{"received_replies" ,    STAT_IS_FUNC, (stat_var**)tmx_stats_rcv_rpls    },
 	{"relayed_replies" ,     STAT_IS_FUNC, (stat_var**)tmx_stats_rld_rpls    },
@@ -653,6 +655,12 @@ unsigned long tmx_stats_trans_inuse(void)
 	return (_tmx_stats_all.transactions - _tmx_stats_all.deleted);
 }
 
+unsigned long tmx_stats_trans_active(void)
+{
+	tmx_stats_update();
+	return (_tmx_stats_all.transactions - _tmx_stats_all.waiting);
+}
+
 #if 0
 unsigned long tmx_stats_rcv_rpls(void)
 {

