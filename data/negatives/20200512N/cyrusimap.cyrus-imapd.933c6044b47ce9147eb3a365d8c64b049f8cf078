commit 933c6044b47ce9147eb3a365d8c64b049f8cf078
Author: Bron Gondwana <brong@fastmail.fm>
Date:   Fri Apr 24 09:44:43 2015 +1000

    mailbox: but if there's no partition, then it really is removed
    
    This is probably not the final fix, but it's trivially correct
    even so, if you have no partition, you can't find any files!

diff --git a/imap/mailbox.c b/imap/mailbox.c
index 398a43c98..b02e457b9 100644
--- a/imap/mailbox.c
+++ b/imap/mailbox.c
@@ -924,6 +924,12 @@ static int mailbox_open_advanced(const char *name,
 	goto done;
     }
 
+    if (!mbentry->partition) {
+	mboxlist_entry_free(&mbentry);
+	r = IMAP_MAILBOX_NONEXISTENT;
+	goto done;
+    }
+
     mailbox->part = xstrdup(mbentry->partition);
 
     /* Note that the header does have the ACL information, but it is only

