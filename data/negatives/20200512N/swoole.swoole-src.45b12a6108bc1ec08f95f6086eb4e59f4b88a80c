commit 45b12a6108bc1ec08f95f6086eb4e59f4b88a80c
Author: matyhtf <mikan.tenny@gmail.com>
Date:   Wed Nov 4 18:40:53 2015 +0800

    fix compile error in php7.

diff --git a/src/protocol/SSL.c b/src/protocol/SSL.c
index 73ae5857..f6a9af5c 100644
--- a/src/protocol/SSL.c
+++ b/src/protocol/SSL.c
@@ -182,6 +182,10 @@ int swSSL_connect(swConnection *conn)
 
 void swSSL_close(swConnection *conn)
 {
+    SSL_set_quiet_shutdown(conn->ssl, 1);
+    SSL_set_shutdown(conn->ssl, SSL_RECEIVED_SHUTDOWN | SSL_SENT_SHUTDOWN);
+
+    SSL_shutdown(conn->ssl);
     SSL_free(conn->ssl);
 }
 
diff --git a/swoole_event.c b/swoole_event.c
index b43c44fb..17940473 100644
--- a/swoole_event.c
+++ b/swoole_event.c
@@ -222,10 +222,9 @@ php_socket* swoole_convert_to_socket(int sock)
     TSRMLS_FETCH_FROM_CTX(sw_thread_ctx ? sw_thread_ctx : NULL);
 #endif
     php_socket *socket_object = emalloc(sizeof *socket_object);
+    bzero(socket_object, sizeof(php_socket));
     socket_object->bsd_socket = sock;
-    socket_object->error = 0;
     socket_object->blocking = 1;
-    socket_object->zstream = NULL;
 
     struct sockaddr_storage addr;
     socklen_t addr_len = sizeof(addr);

