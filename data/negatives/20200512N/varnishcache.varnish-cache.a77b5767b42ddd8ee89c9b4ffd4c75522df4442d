commit a77b5767b42ddd8ee89c9b4ffd4c75522df4442d
Author: Poul-Henning Kamp <phk@FreeBSD.org>
Date:   Sun Nov 20 23:27:03 2011 +0000

    Don't let VCC compilers or other subprocesses kill our VSM.

diff --git a/bin/varnishd/mgt/mgt_shmem.c b/bin/varnishd/mgt/mgt_shmem.c
index 9f88f5805..79f8c4122 100644
--- a/bin/varnishd/mgt/mgt_shmem.c
+++ b/bin/varnishd/mgt/mgt_shmem.c
@@ -293,6 +293,9 @@ void
 mgt_shm_atexit(void)
 {
 
+	/* Do not let VCC kill our VSM */
+	if (getpid() != mgt_pid)
+		return;
 	if (heritage.vsm != NULL)
 		VSM_common_delete(&heritage.vsm);
 }

