commit 3286e1d7c089b6d1096743ab17cba3d85c2c2568
Author: bsimmers <bsimmers@fb.com>
Date:   Thu Feb 7 18:14:41 2013 -0800

    Check RuntimeOption::RepoCommit in Repo::commitUnit instead of callers

diff --git a/hphp/compiler/analysis/emitter.cpp b/hphp/compiler/analysis/emitter.cpp
index b0efcb6fea..6779e4478a 100644
--- a/hphp/compiler/analysis/emitter.cpp
+++ b/hphp/compiler/analysis/emitter.cpp
@@ -7359,9 +7359,7 @@ Unit* hphp_compiler_parse(const char* code, int codeLen, const MD5& md5,
     fsp->analyzeProgram(ar);
 
     UnitEmitter* ue = emitHHBCUnitEmitter(ar, fsp, md5);
-    if (RuntimeOption::RepoCommit) {
-      Repo::get().commitUnit(ue, unitOrigin);
-    }
+    Repo::get().commitUnit(ue, unitOrigin);
     Unit* unit = ue->create();
     delete ue;
     return unit;
diff --git a/hphp/runtime/vm/repo.cpp b/hphp/runtime/vm/repo.cpp
index bbaaeaa529..0ec0cbe6dd 100644
--- a/hphp/runtime/vm/repo.cpp
+++ b/hphp/runtime/vm/repo.cpp
@@ -320,6 +320,8 @@ bool Repo::insertUnit(UnitEmitter* ue, UnitOrigin unitOrigin, RepoTxn& txn) {
 }
 
 void Repo::commitUnit(UnitEmitter* ue, UnitOrigin unitOrigin) {
+  if (!RuntimeOption::RepoCommit) return;
+
   try {
     commitMd5(unitOrigin, ue);
     ue->commit(unitOrigin);

