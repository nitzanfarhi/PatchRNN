commit 8fea49d98fa2b28070333e669dee351e6f3797b6
Author: David McCullough <david_mccullough@securecomputing.com>
Date:   Wed Nov 4 11:05:49 2009 +1000

    NAT-OA support is different between netkey/klips
    
    Only do the NAT-OA code path for klips which handles it specifically.

diff --git a/programs/pluto/ikev1_quick.c b/programs/pluto/ikev1_quick.c
index a0ecc742c..2fa797117 100644
--- a/programs/pluto/ikev1_quick.c
+++ b/programs/pluto/ikev1_quick.c
@@ -2255,7 +2255,8 @@ quick_inI1_outR1_cryptotail(struct dh_continuation *dh
 	    ,(st->hidden_variables.st_nat_traversal & NAT_T_WITH_NATOA)
 	    ,(st->st_esp.attrs.encapsulation == ENCAPSULATION_MODE_TRANSPORT));
     if (st->st_esp.attrs.encapsulation == ENCAPSULATION_MODE_TRANSPORT) {
-	if (st->hidden_variables.st_nat_traversal & NAT_T_WITH_NATOA) {
+	if (kern_interface == USE_KLIPS
+		&& st->hidden_variables.st_nat_traversal & NAT_T_WITH_NATOA) {
 #if 0
 	    /** Send NAT-OA if our address is NATed and if we use Transport Mode */
 	    if (!nat_traversal_add_natoa(ISAKMP_NEXT_NONE, &md->rbody, md->st, FALSE)) {

