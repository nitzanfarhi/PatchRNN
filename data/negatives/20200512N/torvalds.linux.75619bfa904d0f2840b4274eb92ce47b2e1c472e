commit 75619bfa904d0f2840b4274eb92ce47b2e1c472e
Author: Keith Busch <keith.busch@intel.com>
Date:   Thu May 28 09:48:55 2015 -0600

    NVMe: End sync requests immediately on failure
    
    Do not retry failed sync commands so the original status may be seen
    without issuing unnecessary retries.
    
    Signed-off-by: Keith Busch <keith.busch@intel.com>
    Signed-off-by: Jens Axboe <axboe@fb.com>

diff --git a/drivers/block/nvme-core.c b/drivers/block/nvme-core.c
index 4eb9917b2a7a..6ed1356e9eb5 100644
--- a/drivers/block/nvme-core.c
+++ b/drivers/block/nvme-core.c
@@ -1010,6 +1010,7 @@ int __nvme_submit_sync_cmd(struct request_queue *q, struct nvme_command *cmd,
 		return PTR_ERR(req);
 
 	req->cmd_type = REQ_TYPE_DRV_PRIV;
+	req->cmd_flags = REQ_FAILFAST_DRIVER;
 	req->__data_len = 0;
 	req->__sector = (sector_t) -1;
 	req->bio = req->biotail = NULL;

