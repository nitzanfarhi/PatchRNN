commit c61966d0956c264d439cb53cbb65c4f552702f0d
Author: Martin Matuska <martin@matuska.org>
Date:   Tue Dec 13 13:35:27 2016 +0100

    Don't check for duplicates when adding NFSv4 ACL entries

diff --git a/libarchive/archive_acl.c b/libarchive/archive_acl.c
index ff5c9049..3653d6fc 100644
--- a/libarchive/archive_acl.c
+++ b/libarchive/archive_acl.c
@@ -280,11 +280,17 @@ acl_new_entry(struct archive_acl *acl,
 		acl->acl_text = NULL;
 	}
 
-	/* If there's a matching entry already in the list, overwrite it. */
+	/*
+	 * If there's a matching entry already in the list, overwrite it.
+	 * NFSv4 entries may be repeated and are not overwritten.
+	 *
+	 * TODO: compare names of no id is provided (needs more rework)
+	 */
 	ap = acl->acl_head;
 	aq = NULL;
 	while (ap != NULL) {
-		if (ap->type == type && ap->tag == tag && ap->id == id) {
+		if (((type & ARCHIVE_ENTRY_ACL_TYPE_NFS4) == 0) &&
+		    ap->type == type && ap->tag == tag && ap->id == id) {
 			if (id != -1 || (tag != ARCHIVE_ENTRY_ACL_USER &&
 			    tag != ARCHIVE_ENTRY_ACL_GROUP)) {
 				ap->permset = permset;

