commit 5414c6be57dd02e089c3eba1f5134f441733d013
Author: Michael Ellerman <michael@ellerman.id.au>
Date:   Tue Oct 24 13:37:34 2006 +1000

    [POWERPC] Make irq_dispose_mapping(NO_IRQ) a nop
    
    It makes for a friendlier API if irq_dispose_mapping(NO_IRQ) is a
    nop, rather than triggering a WARN_ON.
    
    Signed-off-by: Michael Ellerman <michael@ellerman.id.au>
    Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
    Signed-off-by: Paul Mackerras <paulus@samba.org>

diff --git a/arch/powerpc/kernel/irq.c b/arch/powerpc/kernel/irq.c
index 67b21a008f6e..eb9fc621e057 100644
--- a/arch/powerpc/kernel/irq.c
+++ b/arch/powerpc/kernel/irq.c
@@ -648,10 +648,14 @@ EXPORT_SYMBOL_GPL(irq_of_parse_and_map);
 
 void irq_dispose_mapping(unsigned int virq)
 {
-	struct irq_host *host = irq_map[virq].host;
+	struct irq_host *host;
 	irq_hw_number_t hwirq;
 	unsigned long flags;
 
+	if (virq == NO_IRQ)
+		return;
+
+	host = irq_map[virq].host;
 	WARN_ON (host == NULL);
 	if (host == NULL)
 		return;

