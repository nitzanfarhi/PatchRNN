commit 96f62326b890207d844f41baa8f736a04d973c30
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Aug 4 13:05:26 2011 +0300

    fts: HTML parser now makes sure space is added for each <tag>
    This could be smarter though, like not doing this for <span>, but it gets a
    bit complex..

diff --git a/src/plugins/fts/fts-parser-html.c b/src/plugins/fts/fts-parser-html.c
index 870aafe38..4dc63e4a1 100644
--- a/src/plugins/fts/fts-parser-html.c
+++ b/src/plugins/fts/fts-parser-html.c
@@ -127,6 +127,15 @@ static size_t parse_entity(struct html_fts_parser *parser,
 	return i + 1;
 }
 
+static void parser_add_space(struct html_fts_parser *parser)
+{
+	const unsigned char *data = parser->output->data;
+
+	if (parser->output->used > 0 &&
+	    data[parser->output->used-1] != ' ')
+		buffer_append_c(parser->output, ' ');
+}
+
 static size_t
 parse_data(struct html_fts_parser *parser,
 	   const unsigned char *data, size_t size)
@@ -158,6 +167,7 @@ parse_data(struct html_fts_parser *parser,
 			else if (c == '>') {
 				parser->state = parser->ignore_next_text ?
 					HTML_STATE_IGNORE : HTML_STATE_TEXT;
+				parser_add_space(parser);
 			}
 			break;
 		case HTML_STATE_TAG_QUOTED:

