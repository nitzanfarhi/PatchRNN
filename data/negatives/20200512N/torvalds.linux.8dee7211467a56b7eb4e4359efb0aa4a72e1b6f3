commit 8dee7211467a56b7eb4e4359efb0aa4a72e1b6f3
Author: NeilBrown <neilb@suse.de>
Date:   Fri Nov 6 14:59:29 2009 +1100

    md/raid5: make sure curr_sync_completes is uptodate when reshape starts
    
    This value is visible through sysfs and is used by mdadm
    when it manages a reshape (backing up data that is about to be
    rearranged).  So it is important that it is always correct.
    Current it does not get updated properly when a reshape
    starts which can cause problems when assembling an array
    that is in the middle of being reshaped.
    
    This is suitable for 2.6.31.y stable kernels.
    
    Cc: stable@kernel.org
    Signed-off-by: NeilBrown <neilb@suse.de>

diff --git a/drivers/md/raid5.c b/drivers/md/raid5.c
index 81abefc172d9..dcce204b6c73 100644
--- a/drivers/md/raid5.c
+++ b/drivers/md/raid5.c
@@ -4049,6 +4049,8 @@ static sector_t reshape_request(mddev_t *mddev, sector_t sector_nr, int *skipped
 			sector_nr = conf->reshape_progress;
 		sector_div(sector_nr, new_data_disks);
 		if (sector_nr) {
+			mddev->curr_resync_completed = sector_nr;
+			sysfs_notify(&mddev->kobj, NULL, "sync_completed");
 			*skipped = 1;
 			return sector_nr;
 		}

