commit 4c52228d1b83ef67d4fa381c2ade70122c9e3c34
Author: Ursula Braun <ursula.braun@de.ibm.com>
Date:   Tue Feb 9 09:46:07 2010 +0100

    [S390] qdio: continue polling for buffer state ERROR
    
    Inbound traffic handling may hang if next buffer to check is in
    state ERROR, polling is stopped and the final check for further
    available inbound buffers disregards buffers in state ERROR.
    This patch includes state ERROR when checking availability of
    more inbound buffers.
    
    Cc: Jan Glauber <jang@linux.vnet.ibm.com>
    Signed-off-by: Ursula Braun <ursula.braun@de.ibm.com>
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>

diff --git a/drivers/s390/cio/qdio_main.c b/drivers/s390/cio/qdio_main.c
index 999fe80c4051..5781c5d10cff 100644
--- a/drivers/s390/cio/qdio_main.c
+++ b/drivers/s390/cio/qdio_main.c
@@ -531,7 +531,7 @@ static inline int qdio_inbound_q_done(struct qdio_q *q)
 	qdio_siga_sync_q(q);
 	get_buf_state(q, q->first_to_check, &state, 0);
 
-	if (state == SLSB_P_INPUT_PRIMED)
+	if (state == SLSB_P_INPUT_PRIMED || state == SLSB_P_INPUT_ERROR)
 		/* more work coming */
 		return 0;
 

