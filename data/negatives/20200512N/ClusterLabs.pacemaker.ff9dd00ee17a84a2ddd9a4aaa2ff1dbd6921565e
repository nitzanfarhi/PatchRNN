commit ff9dd00ee17a84a2ddd9a4aaa2ff1dbd6921565e
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Tue Sep 2 14:12:33 2008 +0200

    Low: PE: Remove dead code from stable-0.6
    
    Mercurial revision: b0995e2fbba9e5616017484b61607a6aee488a3f

diff --git a/pengine/group.c b/pengine/group.c
index b43bee1e8..94360d826 100644
--- a/pengine/group.c
+++ b/pengine/group.c
@@ -496,8 +496,6 @@ void group_expand(resource_t *rsc, pe_working_set_t *data_set)
 
 }
 
-extern void node_list_update(GListPtr list1, GListPtr list2, int factor);
-
 GListPtr
 group_merge_weights(
     resource_t *rsc, const char *rhs, GListPtr nodes, int factor, gboolean allow_rollback) 
@@ -515,48 +513,9 @@ group_merge_weights(
 
     set_bit(rsc->flags, pe_rsc_merging);
 
-#if 1
-    /* turn this back on once we switch to migration-threshold */
     nodes = group_data->first_child->cmds->merge_weights(
 	group_data->first_child, rhs, nodes, factor, allow_rollback);
     
-#else
-    slist_iter(child, resource_t, rsc->children, lpc,
-
-	       if(allow_rollback) {
-		   archive = node_list_dup(nodes, FALSE, FALSE);
-	       }
-    	       
-	       slist_iter(
-		   node, node_t, child->allowed_nodes, lpc2,
-		   if(node->weight < 0 && node->weight > -INFINITY) {
-		       /* Once a child's score goes below zero, force the node score to -INFINITY
-			*
-			* This prevents the group from being partially active in scenarios
-			*  where it could be fully active elsewhere
-			*
-			* If we don't do this, then the next child(ren)'s stickiness might bring
-			*  the combined score above 0 again - which confuses the PE into thinking
-			*  the whole group can run there but is pointless since the later children
-			*  are not be able to run if the ones before them can't
-			*/
-		       node->weight = -INFINITY;
-		   }
-		   );
-	       
-	       node_list_update(nodes, child->allowed_nodes, factor);
-
-	       if(archive && can_run_any(nodes) == FALSE) {
-		   crm_debug("%s: Rolling back scores from %s", rhs, rsc->id);
-		   pe_free_shallow_adv(nodes, TRUE);
-		   nodes = archive;
-		   goto bail;
-	       }
-
-	       pe_free_shallow_adv(archive, TRUE);
-	);
-#endif
-
     slist_iter(
 	constraint, rsc_colocation_t, rsc->rsc_cons_lhs, lpc,
 	

