commit 968a50ddb853898c5fe3ab3d4495ed3abcec8568
Author: Mariusz Szafranski <mariuszx.szafranski@intel.com>
Date:   Wed Mar 7 09:57:50 2018 +0000

    Revert "ipmi plugin: Remove duplicate/unused code and unneeded brackets."
    
    This reverts commit 8c9d64bf7615875b5030127b4df68a620e084f0d.

diff --git a/src/ipmi.c b/src/ipmi.c
index 59710c35..a8805866 100644
--- a/src/ipmi.c
+++ b/src/ipmi.c
@@ -387,6 +387,14 @@ static int sensor_list_add(c_ipmi_instance_t *st, ipmi_sensor_t *sensor) {
         ipmi_sensor_get_sensor_direction(sensor),
         ipmi_sensor_get_event_support(sensor));
 
+  /* Both `ignorelist' and `sensor_name_ptr' may be NULL. */
+  if (ignorelist_match(st->ignorelist, sensor_name_ptr) != 0) {
+    INFO("ipmi plugin: sensor_list_add: Ignore sensor `%s` of `%s`, "
+         "because it is on ignore list.",
+         sensor_name_ptr, st->name);
+    return -1;
+  }
+
   /* FIXME: Use rate unit or base unit to scale the value */
 
   sensor_type = ipmi_sensor_get_sensor_type(sensor);
@@ -796,9 +804,10 @@ entity_sensor_update_handler(enum ipmi_update_e op,
         status = ipmi_sensor_add_discrete_event_handler(
             sensor, sensor_discrete_event_handler, st);
 
-      if (status)
+      if (status) {
         ERROR("Unable to add sensor %s event handler, status: %d", sensor_name,
               status);
+      }
     }
   } else if (op == IPMI_DELETED) {
     sensor_list_remove(st, sensor);

