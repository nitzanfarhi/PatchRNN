commit bd96bd6b1280f6f4dd988272e10ad5a2c3abef43
Author: Ivo van Doorn <ivdoorn@gmail.com>
Date:   Thu Jun 3 10:52:11 2010 +0200

    rt2x00: Use IEEE80211_TX_CTL_STBC flag
    
    Use the IEEE80211_TX_CTL_STBC flag to determine the
    correct value to be used for the STBC field in the
    TX descriptor
    
    Signed-off-by: Ivo van Doorn <IvDoorn@gmail.com>

diff --git a/drivers/net/wireless/rt2x00/rt2x00ht.c b/drivers/net/wireless/rt2x00/rt2x00ht.c
index c4b749da4302..382ab79867dd 100644
--- a/drivers/net/wireless/rt2x00/rt2x00ht.c
+++ b/drivers/net/wireless/rt2x00/rt2x00ht.c
@@ -44,7 +44,9 @@ void rt2x00ht_create_tx_descriptor(struct queue_entry *entry,
 		txdesc->mpdu_density = 0;
 
 	txdesc->ba_size = 7;	/* FIXME: What value is needed? */
-	txdesc->stbc = 0;	/* FIXME: What value is needed? */
+
+	txdesc->stbc =
+	    (tx_info->flags & IEEE80211_TX_CTL_STBC) >> IEEE80211_TX_CTL_STBC_SHIFT;
 
 	txdesc->mcs = rt2x00_get_rate_mcs(hwrate->mcs);
 	if (txrate->flags & IEEE80211_TX_RC_USE_SHORT_PREAMBLE)

