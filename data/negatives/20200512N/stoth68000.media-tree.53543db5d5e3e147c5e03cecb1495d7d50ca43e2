commit 53543db5d5e3e147c5e03cecb1495d7d50ca43e2
Author: hayeswang <hayeswang@realtek.com>
Date:   Fri Feb 6 11:30:48 2015 +0800

    r8152: check RTL8152_UNPLUG for rtl8152_close
    
    It is unnecessary to accress the hw register if the device is unplugged.
    
    Signed-off-by: Hayes Wang <hayeswang@realtek.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/usb/r8152.c b/drivers/net/usb/r8152.c
index 66678093db10..aade7b545f02 100644
--- a/drivers/net/usb/r8152.c
+++ b/drivers/net/usb/r8152.c
@@ -3046,7 +3046,7 @@ static int rtl8152_close(struct net_device *netdev)
 	netif_stop_queue(netdev);
 
 	res = usb_autopm_get_interface(tp->intf);
-	if (res < 0) {
+	if (res < 0 || test_bit(RTL8152_UNPLUG, &tp->flags)) {
 		rtl_drop_queued_tx(tp);
 		rtl_stop_rx(tp);
 	} else {

