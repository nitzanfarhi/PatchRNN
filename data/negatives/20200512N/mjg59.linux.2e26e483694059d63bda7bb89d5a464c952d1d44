commit 2e26e483694059d63bda7bb89d5a464c952d1d44
Author: Philipp Zabel <philipp.zabel@gmail.com>
Date:   Mon Nov 27 12:05:04 2006 +0100

    [ALSA] ASoC - Bit clock matching error
    
    This patch by Philipp Zabel fixes a bug whereby the BCLK matching fails
    when the Codec BCLK is constant and the CPU BCLK is based upon a
    divider.
    
    Signed-off-by: Philipp Zabel <philipp.zabel@gmail.com>
    Signed-off-by: Liam Girdwood <lg@opensource.wolfsonmicro.com>
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Jaroslav Kysela <perex@suse.cz>

diff --git a/sound/soc/soc-core.c b/sound/soc/soc-core.c
index 6da1616bf776..90e8841e7e33 100644
--- a/sound/soc/soc-core.c
+++ b/sound/soc/soc-core.c
@@ -424,7 +424,7 @@ static int soc_hw_match_params(struct snd_pcm_substream *substream,
 				/* normalise cpu bfs div & codec const mult */
 				codec_bfs = soc_bfs_rate_to_div(codec_dai_mode->bfs, rate,
 					mclk, rtd->codec_dai->dai_runtime.pcmfmt, chn);
-				if(codec_dai_mode->bfs & codec_bfs) {
+				if(cpu_dai_mode->bfs & codec_bfs) {
 					rtd->cpu_dai->dai_runtime.bfs = codec_bfs;
 					rtd->codec_dai->dai_runtime.bfs = codec_dai_mode->bfs;
 				} else

