commit 89db89b9ba74c2579d876bf699d282cef609c46d
Author: John Cupitt <jcupitt@gmail.com>
Date:   Thu Apr 24 21:58:08 2014 +0100

    use vips_foreign_save_buffer()
    
    so dzsave now knows about save options

diff --git a/libvips/foreign/dzsave.c b/libvips/foreign/dzsave.c
index dc4198b6..dd0897ed 100644
--- a/libvips/foreign/dzsave.c
+++ b/libvips/foreign/dzsave.c
@@ -1021,7 +1021,7 @@ strip_work( VipsThreadState *state, void *a )
 	printf( "strip_work: writing to %s\n", buf );
 #endif /*DEBUG_VERBOSE*/
 
-	if( vips_jpegsave_buffer( x, &buf, &len, NULL ) ) {
+	if( vips_foreign_save_buffer( x, dz->suffix, &buf, &len, NULL ) ) {
 		g_object_unref( x );
 		return( -1 );
 	}
@@ -1042,14 +1042,6 @@ strip_work( VipsThreadState *state, void *a )
 
 	g_free( buf );
 
-	/*
-	if( vips_image_write_to_file( x, buf ) ) {
-		g_object_unref( x );
-		return( -1 );
-	}
-	g_object_unref( x );
-	 */
-
 #ifdef DEBUG_VERBOSE
 	printf( "strip_work: success\n" );
 #endif /*DEBUG_VERBOSE*/

