commit 41bd9dfe618023386afef10e34e97704a10efb51
Author: Sergey Vojtovich <svoj@sun.com>
Date:   Thu Apr 1 15:39:56 2010 +0400

    Applying InnoDB snapshot
    
    Detailed revision comments:
    
    r6608 | marko | 2010-02-09 11:02:37 +0200 (Tue, 09 Feb 2010) | 1 line
    branches/zip: ha_innobase::add_index(): Check for !innodb_table.

diff --git a/storage/innodb_plugin/handler/handler0alter.cc b/storage/innodb_plugin/handler/handler0alter.cc
index 47999ae37f8..fbbcfd6149b 100644
--- a/storage/innodb_plugin/handler/handler0alter.cc
+++ b/storage/innodb_plugin/handler/handler0alter.cc
@@ -656,6 +656,11 @@ ha_innobase::add_index(
 	innodb_table = indexed_table
 		= dict_table_get(prebuilt->table->name, FALSE);
 
+	if (UNIV_UNLIKELY(!innodb_table)) {
+		error = HA_ERR_NO_SUCH_TABLE;
+		goto err_exit;
+	}
+
 	/* Check if the index name is reserved. */
 	if (innobase_index_name_is_reserved(trx, key_info, num_of_keys)) {
 		error = -1;

