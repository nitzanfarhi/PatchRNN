commit 4f4c0072228785179d35b2bd9e48081ce9fa51f6
Author: Mark Brown <broonie@opensource.wolfsonmicro.com>
Date:   Fri Oct 7 14:29:19 2011 +0100

    ASoC: Suppress early calls to snd_soc_dapm_sync()
    
    Ensure we only have one sync during the initial startup of the card by
    making snd_soc_dapm_sync() a noop on non-instantiated cards. This avoids
    any bounces due to things like jacks reporting their initial state on
    partially initialised cards. The callers that don't also get called at
    runtime should just be removed.
    
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>

diff --git a/sound/soc/soc-core.c b/sound/soc/soc-core.c
index 2a2507627520..b65e3d40177c 100644
--- a/sound/soc/soc-core.c
+++ b/sound/soc/soc-core.c
@@ -1498,6 +1498,7 @@ static void snd_soc_instantiate_card(struct snd_soc_card *card)
 #endif
 
 	card->instantiated = 1;
+	snd_soc_dapm_sync(&card->dapm);
 	mutex_unlock(&card->mutex);
 	return;
 
diff --git a/sound/soc/soc-dapm.c b/sound/soc/soc-dapm.c
index 8711aab01445..e49c56d4951e 100644
--- a/sound/soc/soc-dapm.c
+++ b/sound/soc/soc-dapm.c
@@ -1845,6 +1845,13 @@ static int snd_soc_dapm_set_pin(struct snd_soc_dapm_context *dapm,
  */
 int snd_soc_dapm_sync(struct snd_soc_dapm_context *dapm)
 {
+	/*
+	 * Suppress early reports (eg, jacks syncing their state) to avoid
+	 * silly DAPM runs during card startup.
+	 */
+	if (!dapm->card || !dapm->card->instantiated)
+		return 0;
+
 	return dapm_power_widgets(dapm, SND_SOC_DAPM_STREAM_NOP);
 }
 EXPORT_SYMBOL_GPL(snd_soc_dapm_sync);

