commit bc0c081b0e7a4afc4d2c7bc0666f5cd169e96814
Author: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Date:   Fri Feb 25 10:02:39 2011 -0500

    xen/blkback: Update to use blkdev_get_by_dev instead of open_by_devnum.
    
    The API for opening a block device has changed since 2.6.32. The
    correct function to open a device is blkdev_get_by_dev.

diff --git a/drivers/xen/blkback/vbd.c b/drivers/xen/blkback/vbd.c
index dc2572338567..8c91a2fb0019 100644
--- a/drivers/xen/blkback/vbd.c
+++ b/drivers/xen/blkback/vbd.c
@@ -63,8 +63,8 @@ int vbd_create(blkif_t *blkif, blkif_vdev_t handle, unsigned major,
 
 	vbd->pdevice  = MKDEV(major, minor);
 
-	bdev = open_by_devnum(vbd->pdevice,
-			      vbd->readonly ? FMODE_READ : FMODE_WRITE);
+	bdev = blkdev_get_by_dev(vbd->pdevice, vbd->readonly ?
+				 FMODE_READ : FMODE_WRITE, NULL);
 
 	if (IS_ERR(bdev)) {
 		DPRINTK("vbd_creat: device %08x could not be opened.\n",

