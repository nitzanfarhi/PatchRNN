commit 5480e82d77770e81e897a8c217f3c7f0c13a6de1
Author: Michael Niedermayer <michael@niedermayer.cc>
Date:   Sun Sep 17 02:42:11 2017 +0200

    avcodec/pngdec: Clean up on av_frame_ref() failure
    
    Fixes: memleak
    Fixes: 3203/clusterfuzz-testcase-minimized-4514553595428864
    
    Found-by: continuous fuzzing process https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg
    Reviewed-by: James Almer <jamrial@gmail.com>
    Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>

diff --git a/libavcodec/pngdec.c b/libavcodec/pngdec.c
index dce8faf168..0d6612ccca 100644
--- a/libavcodec/pngdec.c
+++ b/libavcodec/pngdec.c
@@ -1414,7 +1414,7 @@ static int decode_frame_png(AVCodecContext *avctx,
     }
 
     if ((ret = av_frame_ref(data, s->picture.f)) < 0)
-        return ret;
+        goto the_end;
 
     *got_frame = 1;
 

