commit dde733e799d907fecd54e3ae8722b3946e4c2244
Author: Lowly Worm <cutlassc91@gmail.com>
Date:   Mon Jan 8 18:48:01 2018 -0800

    add the correct magic for z64

diff --git a/libr/bin/p/bin_z64.c b/libr/bin/p/bin_z64.c
index e74820e9b..8807db802 100644
--- a/libr/bin/p/bin_z64.c
+++ b/libr/bin/p/bin_z64.c
@@ -70,11 +70,11 @@ static ut64 baddr(RBinFile *bf) {
 }
 
 static bool check_bytes (const ut8 *buf, ut64 length) {
-	// XXX just based on size? we should validate the struct too
+	ut32 magic = 0x80371240;
 	if (length < N64_ROM_START) {
 		return false;
 	}
-	return false;
+	return magic == r_read_be32(buf);
 }
 
 static void *load_bytes(RBinFile *bf, const ut8 *buf, ut64 sz, ut64 loadaddr, Sdb *sdb) {
@@ -91,13 +91,8 @@ static bool load(RBinFile *bf) {
 	if (!bf || !bf->o) {
 		return false;
 	}
-	// XXX hack based on name?
-	if(strlen(fname) > 4 && !strcmp(fname + strlen(fname) - 4, ".z64")) {
-		bf->o->bin_obj = load_bytes (bf, bytes, sz, bf->o->loadaddr, bf->sdb);
-		return check_bytes (bytes, sz);
-	} else {
-		return false;
-	}
+	bf->o->bin_obj = load_bytes (bf, bytes, sz, bf->o->loadaddr, bf->sdb);
+	return check_bytes (bytes, sz);
 }
 
 static int destroy(RBinFile *bf) {

