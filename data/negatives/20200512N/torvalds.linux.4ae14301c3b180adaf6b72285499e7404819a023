commit 4ae14301c3b180adaf6b72285499e7404819a023
Author: Johan Hedberg <johan.hedberg@intel.com>
Date:   Sun Jan 20 14:27:13 2013 +0200

    Bluetooth: Fix checking for correct mgmt_load_link_keys parameters
    
    The debug_keys parameter is only allowed to have the values 0x00 and
    0x01. Any other value should result in a proper command status with
    MGMT_STATUS_INVALID_PARAMS.
    
    Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
    Acked-by: Marcel Holtmann <marcel@holtmann.org>
    Signed-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>

diff --git a/net/bluetooth/mgmt.c b/net/bluetooth/mgmt.c
index 36b23101d651..d9b042efbf42 100644
--- a/net/bluetooth/mgmt.c
+++ b/net/bluetooth/mgmt.c
@@ -1519,6 +1519,10 @@ static int load_link_keys(struct sock *sk, struct hci_dev *hdev, void *data,
 				  MGMT_STATUS_INVALID_PARAMS);
 	}
 
+	if (cp->debug_keys != 0x00 && cp->debug_keys != 0x01)
+		return cmd_status(sk, hdev->id, MGMT_OP_LOAD_LINK_KEYS,
+				  MGMT_STATUS_INVALID_PARAMS);
+
 	BT_DBG("%s debug_keys %u key_count %u", hdev->name, cp->debug_keys,
 	       key_count);
 

