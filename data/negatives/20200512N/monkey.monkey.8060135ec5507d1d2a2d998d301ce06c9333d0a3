commit 8060135ec5507d1d2a2d998d301ce06c9333d0a3
Author: Vladimir Cernov <gg.kaspersky@gmail.com>
Date:   Sun Jun 1 20:45:17 2014 +0300

    Scheduler: Close connection after MK_PLUGIN_STAGE_10
    
    Signed-off-by: Vladimir Cernov <gg.kaspersky@gmail.com>

diff --git a/src/mk_scheduler.c b/src/mk_scheduler.c
index 80dcb2c2..71dfdbf5 100644
--- a/src/mk_scheduler.c
+++ b/src/mk_scheduler.c
@@ -287,7 +287,8 @@ int mk_sched_register_client(int remote_fd, struct sched_list_node *sched)
 
     /* Close connection, otherwise continue */
     if (ret == MK_PLUGIN_RET_CLOSE_CONX) {
-        mk_conn_close(remote_fd, MK_EP_SOCKET_CLOSED);
+        mk_epoll_del(sched->epoll_fd, remote_fd);
+        mk_socket_close(remote_fd);
         MK_LT_SCHED(remote_fd, "PLUGIN_CLOSE");
         return -1;
     }

