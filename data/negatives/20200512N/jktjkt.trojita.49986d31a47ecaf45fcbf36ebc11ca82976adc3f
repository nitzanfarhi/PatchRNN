commit 49986d31a47ecaf45fcbf36ebc11ca82976adc3f
Author: Jan Kundr√°t <jkt@gentoo.org>
Date:   Sat Sep 13 15:26:45 2008 +0000

    don't boother with FLAGS checking when we've already fetched all children anyway
    
    
    git-svn-id: svn+ssh://svn.flaska.net/var/svn/trojita/trunk@334 db1c769a-ce0d-0410-92a1-9ec0c70b6fba

diff --git a/Demo/ImapModelDemo.cpp b/Demo/ImapModelDemo.cpp
index e4302ae7..aec59ebe 100644
--- a/Demo/ImapModelDemo.cpp
+++ b/Demo/ImapModelDemo.cpp
@@ -42,7 +42,7 @@ int main( int argc, char** argv) {
 
     Imap::Mailbox::Model model( 0, cache, auth, parser );
 
-    new ModelTest( &model );
+    //new ModelTest( &model );
     
     QTreeView tree;
     tree.setModel( &model );
diff --git a/Imap/MailboxTree.cpp b/Imap/MailboxTree.cpp
index 674150da..68966369 100644
--- a/Imap/MailboxTree.cpp
+++ b/Imap/MailboxTree.cpp
@@ -111,7 +111,9 @@ QVariant TreeItemMailbox::data( const Model* const model, int role )
 bool TreeItemMailbox::hasChildren( const Model* const model )
 {
     // FIXME: case sensitivity
-    if ( _flags.contains( "\\NoInferiors" ) || _flags.contains( "\\HasNoChildren" ) )
+    if ( _fetched )
+        return ! _children.isEmpty();
+    else if ( _flags.contains( "\\NoInferiors" ) || _flags.contains( "\\HasNoChildren" ) )
         return false;
     else if ( _flags.contains( "\\HasChildren" ) )
         return true;

