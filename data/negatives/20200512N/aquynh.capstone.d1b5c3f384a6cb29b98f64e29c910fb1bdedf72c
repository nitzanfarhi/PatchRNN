commit d1b5c3f384a6cb29b98f64e29c910fb1bdedf72c
Author: Nicolas PLANEL <nplanel@gmail.com>
Date:   Thu Oct 8 15:42:39 2015 +1100

    cleanup : move the initialization of m68k_info
    
    Simplify the code by moving the initialization of printer_info (m68k_info)
    at the right place, in the module.init() function.
    
    Signed-off-by: Nicolas PLANEL <nplanel@gmail.com>

diff --git a/arch/M68K/M68KDisassembler.c b/arch/M68K/M68KDisassembler.c
index 6ee4fa82..59a59e5f 100644
--- a/arch/M68K/M68KDisassembler.c
+++ b/arch/M68K/M68KDisassembler.c
@@ -3868,18 +3868,7 @@ bool M68K_getInstruction(csh ud, const uint8_t* code, size_t code_len, MCInst* i
 	int s;
 	int cpu_type = M68K_CPU_TYPE_68000;
 	cs_struct* handle = instr->csh;
-	m68k_info *info;
-
-	if (handle->printer_info == NULL) {
-		info = cs_mem_malloc(sizeof(m68k_info));
-		if (!info) {
-			handle->errnum = CS_ERR_MEM;
-			return false;
-		}
-		handle->printer_info = info;
-	} else {
-		info = (m68k_info *)handle->printer_info;
-	}
+	m68k_info *info = (m68k_info *)handle->printer_info;
 
 	info->code = code;
 	info->baseAddress = address;
diff --git a/arch/M68K/M68KModule.c b/arch/M68K/M68KModule.c
index 89855849..2c7b3a9c 100644
--- a/arch/M68K/M68KModule.c
+++ b/arch/M68K/M68KModule.c
@@ -10,8 +10,15 @@
 
 static cs_err init(cs_struct *ud)
 {
+	m68k_info *info;
+
+	info = cs_mem_malloc(sizeof(m68k_info));
+	if (!info) {
+		return CS_ERR_MEM;
+	}
+
 	ud->printer = M68K_printInst;
-	ud->printer_info = NULL;
+	ud->printer_info = info;
 	ud->getinsn_info = NULL;
 	ud->disasm = M68K_getInstruction;
 	ud->skipdata_size = 2;

