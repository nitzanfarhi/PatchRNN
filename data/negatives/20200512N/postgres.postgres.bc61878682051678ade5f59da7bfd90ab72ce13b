commit bc61878682051678ade5f59da7bfd90ab72ce13b
Author: Tom Lane <tgl@sss.pgh.pa.us>
Date:   Sun Mar 3 19:32:12 2013 -0500

    Fix map_sql_value_to_xml_value() to treat domains like their base types.
    
    This was already the case for domains over arrays, but not for domains
    over certain built-in types such as boolean.  The special formatting
    rules for those types should apply to domains over them as well.
    Per discussion.
    
    While this is a bug fix, it's also a behavioral change that seems likely
    to trip up some applications.  So no back-patch.
    
    Pavel Stehule

diff --git a/src/backend/utils/adt/xml.c b/src/backend/utils/adt/xml.c
index d5d48d5c06..9c5daec31e 100644
--- a/src/backend/utils/adt/xml.c
+++ b/src/backend/utils/adt/xml.c
@@ -2001,6 +2001,12 @@ map_sql_value_to_xml_value(Datum value, Oid type, bool xml_escape_strings)
 		bool		isvarlena;
 		char	   *str;
 
+		/*
+		 * Flatten domains; the special-case treatments below should apply
+		 * to, eg, domains over boolean not just boolean.
+		 */
+		type = getBaseType(type);
+
 		/*
 		 * Special XSD formatting for some data types
 		 */

