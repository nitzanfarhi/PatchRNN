commit abb2cfbe125f70ef8306c3af5b4b2664e4c54924
Author: Isaac <isaac@localhost>
Date:   Tue Jan 23 18:14:55 2018 +0100

    fix zm_av_packet_ref for old ffmpeg.  Need to set the size and flags as well as copying the mem.

diff --git a/src/zm_ffmpeg.cpp b/src/zm_ffmpeg.cpp
index 2db516cf4..5ddd8ee82 100644
--- a/src/zm_ffmpeg.cpp
+++ b/src/zm_ffmpeg.cpp
@@ -354,8 +354,10 @@ int check_sample_fmt(AVCodec *codec, enum AVSampleFormat sample_fmt) {
 #if LIBAVCODEC_VERSION_CHECK(56, 8, 0, 60, 100)
 #else
 unsigned int zm_av_packet_ref( AVPacket *dst, AVPacket *src ) {
-  dst->data = reinterpret_cast<uint8_t*>(new uint64_t[(src->size + FF_INPUT_BUFFER_PADDING_SIZE)/sizeof(uint64_t) + 1]);
+  dst->size = (src->size + FF_INPUT_BUFFER_PADDING_SIZE)/sizeof(uint64_t) + 1;
+  dst->data = reinterpret_cast<uint8_t*>(new uint64_t[dst->size]);
   memcpy(dst->data, src->data, src->size );
+  dst->flags = src->flags;
   return 0;
 }
 #endif

