commit 47ac39150aaff01d136cfe0d169caa4e8e4d2fbe
Author: Moe Jette <jette1@llnl.gov>
Date:   Wed Apr 8 00:12:10 2009 +0000

    move slurmstepd _reclaim_privileges() so that it gets called for batch jobs
       otherwise a batch job is unable to create an sgi_jobs container for the
       proctrack/sgi_jobs plugin

diff --git a/src/slurmd/slurmstepd/mgr.c b/src/slurmd/slurmstepd/mgr.c
index a7f2216601..551917750e 100644
--- a/src/slurmd/slurmstepd/mgr.c
+++ b/src/slurmd/slurmstepd/mgr.c
@@ -461,19 +461,22 @@ _setup_normal_io(slurmd_job_t *job)
 			}
 		}
 
-	if (_reclaim_privileges(&sprivs) < 0)
-		error("sete{u/g}id(%lu/%lu): %m", 
-		      (u_long) sprivs.saved_uid, (u_long) sprivs.saved_gid);
-
 		rc = io_initial_client_connect(srun, job, srun_stdout_tasks, 
 					       srun_stderr_tasks);
 		if (rc < 0) 
 			return ESLURMD_IO_ERROR;
 	}
 
-	if (!job->batch)
+	if (_reclaim_privileges(&sprivs) < 0) {
+		error("sete{u/g}id(%lu/%lu): %m",
+		      (u_long) sprivs.saved_uid, (u_long) sprivs.saved_gid);
+	}
+
+	if (!job->batch) {
 		if (io_thread_start(job) < 0)
 			return ESLURMD_IO_ERROR;
+	}
+
 	debug2("Leaving  _setup_normal_io");
 	return SLURM_SUCCESS;
 }

