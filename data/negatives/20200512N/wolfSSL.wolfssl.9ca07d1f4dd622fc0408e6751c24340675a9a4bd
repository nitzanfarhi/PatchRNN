commit 9ca07d1f4dd622fc0408e6751c24340675a9a4bd
Author: toddouska <todd@yassl.com>
Date:   Wed Oct 3 17:09:45 2012 -0700

    dtls may have different first handshake message

diff --git a/src/internal.c b/src/internal.c
index 9da5d74f..775ec9e6 100644
--- a/src/internal.c
+++ b/src/internal.c
@@ -2478,6 +2478,19 @@ static int DoHandShakeMsgType(CYASSL* ssl, byte* input, word32* inOutIdx,
         return OUT_OF_ORDER_E;
     }
 
+    if (ssl->options.side == CLIENT_END && ssl->options.dtls == 0 &&
+               ssl->options.serverState == NULL_STATE && type != server_hello) {
+        CYASSL_MSG("First server message not server hello");
+        return OUT_OF_ORDER_E;
+    }
+
+    if (ssl->options.side == SERVER_END &&
+               ssl->options.clientState == NULL_STATE && type != client_hello) {
+        CYASSL_MSG("First client message not client hello");
+        return OUT_OF_ORDER_E;
+    }
+
+
     switch (type) {
 
     case hello_request:

