commit 5c20b786fa1521f33d60967633a484837e2895a7
Author: markus <markus@openbsd.org>
Date:   Sun Feb 26 17:50:45 2006 +0000

    unbreak tcp window update (restore 4.4lite code); netbsd pr 13952;
    ok claudio, henning, brad, djm, tedu

diff --git a/sys/netinet/tcp_input.c b/sys/netinet/tcp_input.c
index f7385892c4c..3cceaacfa10 100644
--- a/sys/netinet/tcp_input.c
+++ b/sys/netinet/tcp_input.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: tcp_input.c,v 1.194 2005/12/01 22:31:50 markus Exp $	*/
+/*	$OpenBSD: tcp_input.c,v 1.195 2006/02/26 17:50:45 markus Exp $	*/
 /*	$NetBSD: tcp_input.c,v 1.23 1996/02/13 23:43:44 christos Exp $	*/
 
 /*
@@ -1938,9 +1938,10 @@ step6:
 	 * Update window information.
 	 * Don't look at window if no ACK: TAC's send garbage on first SYN.
 	 */
-	if ((tiflags & TH_ACK) && (SEQ_LT(tp->snd_wl1, th->th_seq) ||
-	    (tp->snd_wl1 == th->th_seq && SEQ_LT(tp->snd_wl2, th->th_ack)) ||
-	    (tp->snd_wl2 == th->th_ack && tiwin > tp->snd_wnd))) {
+	if ((tiflags & TH_ACK) &&
+	    (SEQ_LT(tp->snd_wl1, th->th_seq) || (tp->snd_wl1 == th->th_seq &&
+	    (SEQ_LT(tp->snd_wl2, th->th_ack) ||
+	    (tp->snd_wl2 == th->th_ack && tiwin > tp->snd_wnd))))) {
 		/* keep track of pure window updates */
 		if (tlen == 0 &&
 		    tp->snd_wl2 == th->th_ack && tiwin > tp->snd_wnd)

