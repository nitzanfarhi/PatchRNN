commit 7f21f36e4592180ce33cda489bb0b19bb2517bba
Author: Sara Golemon <pollita@php.net>
Date:   Mon Oct 2 01:11:04 2006 +0000

    ZTS fix

diff --git a/ext/standard/php_string.h b/ext/standard/php_string.h
index 2f91ce5b18..0a144c098e 100644
--- a/ext/standard/php_string.h
+++ b/ext/standard/php_string.h
@@ -133,7 +133,7 @@ PHPAPI void php_u_basename(UChar *s, int len, UChar *suffix, int sufflen, UChar
 PHPAPI void php_basename(char *s, int len, char *suffix, int sufflen, char **p_ret, int *p_len TSRMLS_DC);
 PHPAPI int php_u_dirname(UChar *str, int len);
 PHPAPI int php_dirname(char *str, int len);
-PHPAPI UChar *php_u_stristr(UChar *s, UChar *t, int s_len, int t_len);
+PHPAPI UChar *php_u_stristr(UChar *s, UChar *t, int s_len, int t_len TSRMLS_DC);
 PHPAPI char *php_stristr(char *s, char *t, size_t s_len, size_t t_len);
 PHPAPI int php_u_strspn(UChar *s1, UChar *s2, UChar *s1_end, UChar *s2_end);
 PHPAPI size_t php_strspn(char *s1, char *s2, char *s1_end, char *s2_end);
diff --git a/ext/standard/string.c b/ext/standard/string.c
index ce147d56d1..e519498c10 100644
--- a/ext/standard/string.c
+++ b/ext/standard/string.c
@@ -2156,7 +2156,7 @@ PHP_FUNCTION(pathinfo)
 
 /* {{{ php_u_stristr
    Unicode version of case insensitve strstr */
-PHPAPI UChar *php_u_stristr(UChar *str, UChar *pat, int str_len, int pat_len)
+PHPAPI UChar *php_u_stristr(UChar *str, UChar *pat, int str_len, int pat_len TSRMLS_DC)
 {
 	UChar *str_fold, *pat_fold;
 	int str_fold_len, pat_fold_len;
@@ -2192,7 +2192,7 @@ PHPAPI UChar *php_u_stristr(UChar *str, UChar *pat, int str_len, int pat_len)
 }
 
 #if 0
-PHPAPI UChar *php_u_stristr(UChar *s, UChar *t, int s_len, int t_len)
+PHPAPI UChar *php_u_stristr(UChar *s, UChar *t, int s_len, int t_len TSRMLS_DC)
 {
 	int32_t i,j, last;
 	UChar32 ch1, ch2;
@@ -2394,7 +2394,7 @@ PHP_FUNCTION(stristr)
 
 	if (Z_TYPE_PP(haystack) == IS_UNICODE) {
 		found = php_u_stristr(Z_USTRVAL_PP(haystack), target.u,
-							  Z_USTRLEN_PP(haystack), needle_len);
+							  Z_USTRLEN_PP(haystack), needle_len TSRMLS_CC);
 	} else {
 		haystack_copy = estrndup(Z_STRVAL_PP(haystack), Z_STRLEN_PP(haystack));
 		found = php_stristr(Z_STRVAL_PP(haystack), target.s,

