commit c85a89ff45008528a371ffc5c8e8abaecdab8689
Author: Zardosht Kasheff <zardosht@tokutek.com>
Date:   Wed Mar 9 15:52:59 2011 +0000

    [t:3266], make fix for virtual columns
    
    git-svn-id: file:///svn/mysql/tokudb-engine/tokudb-engine@29301 c7de825b-a66e-492c-adef-691d508d4ae1

diff --git a/storage/tokudb/ha_tokudb.cc b/storage/tokudb/ha_tokudb.cc
index 2cfa5e75fad..90f3dfb5099 100644
--- a/storage/tokudb/ha_tokudb.cc
+++ b/storage/tokudb/ha_tokudb.cc
@@ -7860,6 +7860,14 @@ int ha_tokudb::check_if_supported_alter(TABLE *altered_table,
     if (tokudb_debug & TOKUDB_DEBUG_ALTER_TABLE_INFO) {
         printf("has indexing changes %d, has non indexing changes %d\n", has_indexing_changes, has_non_indexing_changes);
     }
+#ifdef MARIADB_BASE_VERSION
+#if MYSQL_VERSION_ID >= 50203
+    if (table->s->vfields || altered_table->s->vfields) {
+      retval = HA_ALTER_ERROR;
+      goto cleanup;
+    }
+#endif
+#endif
     if (table->s->tmp_table != NO_TMP_TABLE) {
       retval = (get_disable_slow_alter(thd)) ? HA_ALTER_ERROR : HA_ALTER_NOT_SUPPORTED;
       goto cleanup;

