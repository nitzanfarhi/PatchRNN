commit 862775c7801d90cdd085b88672aeb29e16e31bc8
Author: stevesk <stevesk@openbsd.org>
Date:   Mon Mar 4 18:30:23 2002 +0000

    handle connection close during read of protocol version string.
    fixes erroneous "bad greeting".  ok markus@

diff --git a/usr.bin/ssh/ssh-keyscan.c b/usr.bin/ssh/ssh-keyscan.c
index 95b556fc222..5fc53307c3e 100644
--- a/usr.bin/ssh/ssh-keyscan.c
+++ b/usr.bin/ssh/ssh-keyscan.c
@@ -7,7 +7,7 @@
  */
 
 #include "includes.h"
-RCSID("$OpenBSD: ssh-keyscan.c,v 1.34 2002/02/22 12:20:34 markus Exp $");
+RCSID("$OpenBSD: ssh-keyscan.c,v 1.35 2002/03/04 18:30:23 stevesk Exp $");
 
 #include <sys/queue.h>
 #include <errno.h>
@@ -487,6 +487,11 @@ congreet(int s)
 		conrecycle(s);
 		return;
 	}
+	if (n == 0) {
+		error("%s: Connection closed by remote host", c->c_name);
+		conrecycle(s);
+		return;
+	}
 	if (*cp != '\n' && *cp != '\r') {
 		error("%s: bad greeting", c->c_name);
 		confree(s);

