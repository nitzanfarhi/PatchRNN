commit 5a195b445020f6042c2096e5eb63ef900e7871ea
Author: Nicolas Ferre <nicolas.ferre@atmel.com>
Date:   Tue May 24 11:50:57 2011 +0200

    ASoC: wm8731: fix wm8731_check_osc() connected condition
    
    The crystal oscillator is only enabled if the WM8731_SYSCLK_XTAL master clock
    is specified. Fix the connected() struct snd_soc_dapm_route function to take
    this into account. Oscillator is not enabled on machine that need it otherwise.
    
    Machine drivers have to make sure that they use the proper SYSCLK value.
    
    Signed-off-by: Nicolas Ferre <nicolas.ferre@atmel.com>
    Acked-by: Liam Girdwood <lrg@ti.com>
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>

diff --git a/sound/soc/codecs/wm8731.c b/sound/soc/codecs/wm8731.c
index 6dec7cee2cb4..2dc964b55e4f 100644
--- a/sound/soc/codecs/wm8731.c
+++ b/sound/soc/codecs/wm8731.c
@@ -198,7 +198,7 @@ static int wm8731_check_osc(struct snd_soc_dapm_widget *source,
 {
 	struct wm8731_priv *wm8731 = snd_soc_codec_get_drvdata(source->codec);
 
-	return wm8731->sysclk_type == WM8731_SYSCLK_MCLK;
+	return wm8731->sysclk_type == WM8731_SYSCLK_XTAL;
 }
 
 static const struct snd_soc_dapm_route wm8731_intercon[] = {

