commit dea33cfd99022d82d923a0c6a3bd895fb6683fb2
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Wed Jun 17 16:27:29 2009 -0700

    ptrace: mm_need_new_owner: use ->real_parent to search in the siblings
    
    "Search in the siblings" should use ->real_parent, not ->parent.  If the
    task is traced then ->parent == tracer, while the task's parent is always
    ->real_parent.
    
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Acked-by: Roland McGrath <roland@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/kernel/exit.c b/kernel/exit.c
index 533e5f85669a..213f906f5e16 100644
--- a/kernel/exit.c
+++ b/kernel/exit.c
@@ -590,7 +590,7 @@ void mm_update_next_owner(struct mm_struct *mm)
 	/*
 	 * Search in the siblings
 	 */
-	list_for_each_entry(c, &p->parent->children, sibling) {
+	list_for_each_entry(c, &p->real_parent->children, sibling) {
 		if (c->mm == mm)
 			goto assign_new_owner;
 	}

