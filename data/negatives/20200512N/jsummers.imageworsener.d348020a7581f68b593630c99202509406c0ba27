commit d348020a7581f68b593630c99202509406c0ba27
Author: Jason Summers <jason1@pobox.com>
Date:   Tue Jan 17 20:52:45 2012 -0500

    Made sure we fail completely if an attempt is made to reuse an imagew object.

diff --git a/src/imagew-internals.h b/src/imagew-internals.h
index 77cdb38..0f71177 100644
--- a/src/imagew-internals.h
+++ b/src/imagew-internals.h
@@ -117,6 +117,7 @@ struct iw_opt_ctx {
 
 struct iw_context {
 	int caller_api_version;
+	int use_count;
 	unsigned int output_profile;
 
 	iw_mallocfn_type mallocfn;
diff --git a/src/imagew-main.c b/src/imagew-main.c
index 9b2bacd..2fb00f6 100644
--- a/src/imagew-main.c
+++ b/src/imagew-main.c
@@ -1979,6 +1979,12 @@ IW_IMPL(int) iw_process_image(struct iw_context *ctx)
 	int ret;
 	int retval = 0;
 
+	if(ctx->use_count>0) {
+		iw_set_error(ctx,"Internal: Incorrect attempt to reprocess image");
+		goto done;
+	}
+	ctx->use_count++;
+
 	ret = iw_prepare_processing(ctx,ctx->canvas_width,ctx->canvas_height);
 	if(!ret) goto done;
 

