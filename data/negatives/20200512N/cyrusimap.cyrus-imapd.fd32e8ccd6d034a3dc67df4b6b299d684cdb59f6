commit fd32e8ccd6d034a3dc67df4b6b299d684cdb59f6
Author: John Gardiner Myers <jm36@andrew.cmu.edu>
Date:   Sat Jul 16 02:22:16 1994 +0000

    Fix ibuf allocation performance bug

diff --git a/imap/message.c b/imap/message.c
index d27818a0e..8d928d5e4 100644
--- a/imap/message.c
+++ b/imap/message.c
@@ -1239,7 +1239,7 @@ struct body *body;
 }
 
 /* Append character 'c' to 'ibuf' */
-#define PUTIBUF(ibuf,c) (((ibuf)->left || message_ibuf_ensure((ibuf),1)),(*((ibuf)->end)++ = (c)))
+#define PUTIBUF(ibuf,c) (((ibuf)->left || message_ibuf_ensure((ibuf),1)),((ibuf)->left--),(*((ibuf)->end)++ = (c)))
 
 /*
  * Write the IMAP envelope for 'body' to 'ibuf'
@@ -1871,7 +1871,7 @@ int len;
 {
     char *s;
 
-    if (len >= ibuf->left) return;
+    if (len <= ibuf->left) return;
     if (len < IBUFGROWSIZE) len = IBUFGROWSIZE;
 
     s = ibuf->start - sizeof(bit32);

