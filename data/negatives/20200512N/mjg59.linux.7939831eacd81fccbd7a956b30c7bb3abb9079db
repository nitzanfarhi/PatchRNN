commit 7939831eacd81fccbd7a956b30c7bb3abb9079db
Author: Takashi Iwai <tiwai@suse.de>
Date:   Tue May 6 17:52:26 2014 +0200

    pvpanic: Set high notifier priority
    
    We've observed the missing pvpanic call at panic, and it turned out
    that this was blocked by the broken notifier of drm_fb_helper, where
    scheduling may be called during switching to the fb console.
    It's fairly difficult to fix the drm_fb problem and a quick fix isn't
    foreseen, a simpler solution for the missing pvpanic call would be
    just to call this earlier.
    
    In order to assure that, this patch sets a higher priority to pvpanic
    notifier_block.  Once when the issue of drm_fb is resolved, we can
    remove this priority again.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Matthew Garrett <matthew.garrett@nebula.com>

diff --git a/drivers/platform/x86/pvpanic.c b/drivers/platform/x86/pvpanic.c
index c9f6e511daa6..073a90a63dbc 100644
--- a/drivers/platform/x86/pvpanic.c
+++ b/drivers/platform/x86/pvpanic.c
@@ -70,6 +70,7 @@ pvpanic_panic_notify(struct notifier_block *nb, unsigned long code,
 
 static struct notifier_block pvpanic_panic_nb = {
 	.notifier_call = pvpanic_panic_notify,
+	.priority = 1, /* let this called before broken drm_fb_helper */
 };
 
 

