commit 35d69f2f138dfba80d34e271713fb2f5cebb1a0f
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Wed Feb 25 20:57:04 2009 +0100

    Medium: crmd: Allow up to 5 retires when an attrd update fails
    
    Mercurial revision: 569d9fc2b7f56c440c46e1e9905ac66d8b43d587

diff --git a/crmd/utils.c b/crmd/utils.c
index 028ba7008..d24a50ef9 100644
--- a/crmd/utils.c
+++ b/crmd/utils.c
@@ -1247,7 +1247,9 @@ update_attrd(const char *host, const char *name, const char *value)
 {	
     const char *type = "refresh";
     gboolean rc = FALSE;
-    
+    int retries = 5;
+
+  retry:
     if(attrd == NULL) {
 	crm_info("Connecting to attrd...");
 	attrd = init_client_ipc_comms_nodispatch(T_ATTRD);
@@ -1272,7 +1274,7 @@ update_attrd(const char *host, const char *name, const char *value)
 	    if(host != NULL) {
 		crm_xml_add(update, F_ATTRD_HOST, host);
 	    }
-	    crm_info("Updating %s=%s via %s", name, value?"<none>":value, T_ATTRD);
+	    crm_info("Updating %s=%s via %s", name, value?value:"<none>", T_ATTRD);
 	}
 	
 	crm_xml_add(update, F_ATTRD_TASK, type);
@@ -1287,6 +1289,12 @@ update_attrd(const char *host, const char *name, const char *value)
     if(rc == FALSE) {
 	crm_err("Could not send %s %s", T_ATTRD, type);
 	attrd = NULL;
+	
+	if(retries > 0) {
+	    retries--;
+	    sleep(1);
+	    goto retry;
+	}
     }
     
 }

