commit 69971410f9d9fdf5bc6e7cbe73d917155ea442ce
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Fri Jun 22 23:50:57 2012 +0200

    ff_snow_common_end: assert() that the last buffer freed differs from the current.
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/snow.c b/libavcodec/snow.c
index 2021658d4c..4e7bc8c443 100644
--- a/libavcodec/snow.c
+++ b/libavcodec/snow.c
@@ -639,8 +639,10 @@ av_cold void ff_snow_common_end(SnowContext *s)
     for(i=0; i<MAX_REF_FRAMES; i++){
         av_freep(&s->ref_mvs[i]);
         av_freep(&s->ref_scores[i]);
-        if(s->last_picture[i].data[0])
+        if(s->last_picture[i].data[0]) {
+            av_assert0(s->last_picture[i].data[0] != s->current_picture.data[0]);
             s->avctx->release_buffer(s->avctx, &s->last_picture[i]);
+        }
     }
 
     for(plane_index=0; plane_index<3; plane_index++){

