commit 899852af60c212bfe9a2fb71d4d9082d2622df5c
Author: Paul Stewart <pstew@chromium.org>
Date:   Wed Aug 1 16:54:42 2012 -0700

    cfg80211: Clear "beacon_found" on regulatory restore
    
    Restore the default state to the "beacon_found" flag when
    the channel flags are restored.  Otherwise, we can end up
    with a channel that we can no longer transmit on even when
    we can see beacons on that channel.
    
    Signed-off-by: Paul Stewart <pstew@chromium.org>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/wireless/reg.c b/net/wireless/reg.c
index cbf30de79c69..2ded3c7fad06 100644
--- a/net/wireless/reg.c
+++ b/net/wireless/reg.c
@@ -1901,6 +1901,7 @@ static void restore_custom_reg_settings(struct wiphy *wiphy)
 			chan->flags = chan->orig_flags;
 			chan->max_antenna_gain = chan->orig_mag;
 			chan->max_power = chan->orig_mpwr;
+			chan->beacon_found = false;
 		}
 	}
 }

