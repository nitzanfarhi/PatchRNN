commit db2c7f43c2444bd843103393e9ec2f480286f2ce
Author: Timo Sirainen <tss@iki.fi>
Date:   Tue Apr 3 10:31:48 2007 +0300

    Minor optimization. If we just checked that the directory existed, don't
    mkdir() it.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-storage/index/cydir/cydir-storage.c b/src/lib-storage/index/cydir/cydir-storage.c
index 51021a6a9..517179530 100644
--- a/src/lib-storage/index/cydir/cydir-storage.c
+++ b/src/lib-storage/index/cydir/cydir-storage.c
@@ -115,12 +115,13 @@ static int cydir_create(struct mail_storage *_storage, const char *data)
 			}
 			return -1;
 		}
-	}
-
-	if (mkdir_parents(list_set.root_dir, CREATE_MODE) < 0 &&
-	    errno != EEXIST) {
-		i_error("mkdir_parents(%s) failed: %m", list_set.root_dir);
-		return -1;
+	} else {
+		if (mkdir_parents(list_set.root_dir, CREATE_MODE) < 0 &&
+		    errno != EEXIST) {
+			i_error("mkdir_parents(%s) failed: %m",
+				list_set.root_dir);
+			return -1;
+		}
 	}
 
 	if (mailbox_list_init("fs", &list_set,
diff --git a/src/lib-storage/index/dbox/dbox-storage.c b/src/lib-storage/index/dbox/dbox-storage.c
index 12d3414fa..ff09e6d2c 100644
--- a/src/lib-storage/index/dbox/dbox-storage.c
+++ b/src/lib-storage/index/dbox/dbox-storage.c
@@ -196,12 +196,13 @@ static int dbox_create(struct mail_storage *_storage, const char *data)
 			}
 			return -1;
 		}
-	}
-
-	if (mkdir_parents(list_set.root_dir, CREATE_MODE) < 0 &&
-	    errno != EEXIST) {
-		i_error("mkdir_parents(%s) failed: %m", list_set.root_dir);
-		return -1;
+	} else {
+		if (mkdir_parents(list_set.root_dir, CREATE_MODE) < 0 &&
+		    errno != EEXIST) {
+			i_error("mkdir_parents(%s) failed: %m",
+				list_set.root_dir);
+			return -1;
+		}
 	}
 
 	if (mailbox_list_init("fs", &list_set,

