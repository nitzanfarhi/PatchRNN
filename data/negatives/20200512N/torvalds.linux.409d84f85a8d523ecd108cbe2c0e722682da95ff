commit 409d84f85a8d523ecd108cbe2c0e722682da95ff
Author: Trent Piepho <xyzzy@speakeasy.org>
Date:   Thu Oct 4 05:28:45 2007 -0300

    V4L/DVB (6284): cx23885: Update to new videobuf code
    
    cx23885 was still uses the old video-buf includes and code, which would only
    `work' if one happened to be compiling against a kernel that had the old
    headers.  Even then, it wouldn't actually work, it would just compile without
    errors.
    
    Signed-off-by: Trent Piepho <xyzzy@speakeasy.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>

diff --git a/drivers/media/video/cx23885/cx23885-core.c b/drivers/media/video/cx23885/cx23885-core.c
index 51879961e3ea..4d0614093ad6 100644
--- a/drivers/media/video/cx23885/cx23885-core.c
+++ b/drivers/media/video/cx23885/cx23885-core.c
@@ -1008,10 +1008,12 @@ int cx23885_risc_stopper(struct pci_dev *pci, struct btcx_riscmem *risc,
 
 void cx23885_free_buffer(struct videobuf_queue *q, struct cx23885_buffer *buf)
 {
+	struct videobuf_dmabuf *dma = videobuf_to_dma(&buf->vb);
+
 	BUG_ON(in_interrupt());
 	videobuf_waiton(&buf->vb, 0, 0);
-	videobuf_dma_unmap(q, &buf->vb.dma);
-	videobuf_dma_free(&buf->vb.dma);
+	videobuf_dma_unmap(q, dma);
+	videobuf_dma_free(dma);
 	btcx_riscmem_free((struct pci_dev *)q->dev, &buf->risc);
 	buf->vb.state = STATE_NEEDS_INIT;
 }
@@ -1176,8 +1178,8 @@ int cx23885_buf_prepare(struct videobuf_queue *q, struct cx23885_tsport *port,
 		if (0 != (rc = videobuf_iolock(q, &buf->vb, NULL)))
 			goto fail;
 		cx23885_risc_databuffer(dev->pci, &buf->risc,
-				     buf->vb.dma.sglist,
-				     buf->vb.width, buf->vb.height);
+					videobuf_to_dma(&buf->vb)->sglist,
+					buf->vb.width, buf->vb.height);
 	}
 	buf->vb.state = STATE_PREPARED;
 	return 0;
diff --git a/drivers/media/video/cx23885/cx23885.h b/drivers/media/video/cx23885/cx23885.h
index 3d4fae565e35..dec4dc2fcbb4 100644
--- a/drivers/media/video/cx23885/cx23885.h
+++ b/drivers/media/video/cx23885/cx23885.h
@@ -27,8 +27,8 @@
 #include <media/v4l2-common.h>
 #include <media/tuner.h>
 #include <media/tveeprom.h>
-#include <media/video-buf.h>
-#include <media/video-buf-dvb.h>
+#include <media/videobuf-dma-sg.h>
+#include <media/videobuf-dvb.h>
 
 #include "btcx-risc.h"
 #include "cx23885-reg.h"

