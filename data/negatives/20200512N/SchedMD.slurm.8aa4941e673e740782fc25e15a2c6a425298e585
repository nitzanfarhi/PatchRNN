commit 8aa4941e673e740782fc25e15a2c6a425298e585
Author: Danny Auble <da@schedmd.com>
Date:   Thu May 7 13:53:30 2015 -0700

    Make it so tres is filled in on a job when it needs to be.

diff --git a/src/plugins/accounting_storage/mysql/as_mysql_jobacct_process.c b/src/plugins/accounting_storage/mysql/as_mysql_jobacct_process.c
index 8d144191bb..be90c18864 100644
--- a/src/plugins/accounting_storage/mysql/as_mysql_jobacct_process.c
+++ b/src/plugins/accounting_storage/mysql/as_mysql_jobacct_process.c
@@ -695,6 +695,9 @@ static int _cluster_get_jobs(mysql_conn_t *mysql_conn,
 		job->qosid = slurm_atoul(row[JOB_REQ_QOS]);
 		job->show_full = 1;
 
+		if (row[JOB_REQ_TRES])
+			job->tres_alloc_str = xstrdup(row[JOB_REQ_TRES]);
+
 		if (only_pending || (job_cond && job_cond->without_steps))
 			goto skip_steps;
 
@@ -735,9 +738,6 @@ static int _cluster_get_jobs(mysql_conn_t *mysql_conn,
 				xstrcat(extra, ")");
 		}
 
-		if (row[JOB_REQ_TRES])
-			job->tres_alloc_str = xstrdup(row[JOB_REQ_TRES]);
-
 		query =	xstrdup_printf("select %s from \"%s_%s\" as t1 "
 				       "where t1.job_db_inx=%s",
 				       step_fields, cluster_name,

