commit 9c5edb6c458b04a243c4ba09a60349367b36e761
Author: Simon Glass <sjg@chromium.org>
Date:   Wed Jun 18 11:14:01 2014 -0700

    mfd: cros_ec: Detect in-progress commands
    
    Some commands take a while to execute. Use -EAGAIN to signal this to the
    caller.
    
    Signed-off-by: Simon Glass <sjg@chromium.org>
    Signed-off-by: Doug Anderson <dianders@chromium.org>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>

diff --git a/drivers/mfd/cros_ec_spi.c b/drivers/mfd/cros_ec_spi.c
index 6c3075fb5dc7..9d45d88813b8 100644
--- a/drivers/mfd/cros_ec_spi.c
+++ b/drivers/mfd/cros_ec_spi.c
@@ -288,6 +288,12 @@ static int cros_ec_cmd_xfer_spi(struct cros_ec_device *ec_dev,
 	/* check response error code */
 	ptr = ec_dev->din;
 	if (ptr[0]) {
+		if (ptr[0] == EC_RES_IN_PROGRESS) {
+			dev_dbg(ec_dev->dev, "command 0x%02x in progress\n",
+				ec_msg->cmd);
+			ret = -EAGAIN;
+			goto exit;
+		}
 		dev_warn(ec_dev->dev, "command 0x%02x returned an error %d\n",
 			 ec_msg->cmd, ptr[0]);
 		debug_packet(ec_dev->dev, "in_err", ptr, len);

