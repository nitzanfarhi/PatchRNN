commit 0b88f772bdf2847461debf417b1ee96043a7cb1b
Author: Tiejun Chen <tiejun.chen@windriver.com>
Date:   Mon Jul 15 10:36:04 2013 +0800

    powerpc: Access local paca after hard irq disabled
    
    In hard_irq_disable(), we accessed the PACA before we hard disabled
    the interrupts, potentially causing a warning as get_paca() will
    us debug_smp_processor_id().
    
    Move that to after the disabling, and also use local_paca directly
    rather than get_paca() to avoid several redundant and useless checks.
    
    Signed-off-by: Tiejun Chen <tiejun.chen@windriver.com>
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>

diff --git a/arch/powerpc/include/asm/hw_irq.h b/arch/powerpc/include/asm/hw_irq.h
index ba713f166fa5..10be1dd01c6b 100644
--- a/arch/powerpc/include/asm/hw_irq.h
+++ b/arch/powerpc/include/asm/hw_irq.h
@@ -96,10 +96,11 @@ static inline bool arch_irqs_disabled(void)
 #endif
 
 #define hard_irq_disable()	do {			\
-	u8 _was_enabled = get_paca()->soft_enabled;	\
+	u8 _was_enabled;				\
 	__hard_irq_disable();				\
-	get_paca()->soft_enabled = 0;			\
-	get_paca()->irq_happened |= PACA_IRQ_HARD_DIS;	\
+	_was_enabled = local_paca->soft_enabled;	\
+	local_paca->soft_enabled = 0;			\
+	local_paca->irq_happened |= PACA_IRQ_HARD_DIS;	\
 	if (_was_enabled)				\
 		trace_hardirqs_off();			\
 } while(0)

