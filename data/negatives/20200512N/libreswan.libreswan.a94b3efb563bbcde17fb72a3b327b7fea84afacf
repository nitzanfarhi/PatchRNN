commit a94b3efb563bbcde17fb72a3b327b7fea84afacf
Author: Antony Antony <antony@phenome.org>
Date:   Thu Mar 23 13:44:08 2017 +0100

    ikev2: during Child SA rekey negotiation abort when ESP proposals mismatch.
    
    on the responder if the ESP proposals do not match abort instead of
    a partial reply and no traffic on rekeyed SA.
    
    It need a better fix to send a proper notifiy message. New st alreday
    inherited the old Child SA.

diff --git a/programs/pluto/ikev2_parent.c b/programs/pluto/ikev2_parent.c
index 89d83e7ac..4b818429f 100644
--- a/programs/pluto/ikev2_parent.c
+++ b/programs/pluto/ikev2_parent.c
@@ -4746,10 +4746,13 @@ static stf_status ikev2_child_out_tail(struct msg_digest *md)
 
 		DBG_log("ikev2_child_sa_respond returned STF_FAIL with %s",
 				enum_name(&ikev2_notify_names, v2_notify_num));
+		return ret; /* abort building the response message */
 	} else if (ret != STF_OK) {
 		DBG_log("ikev2_child_sa_respond returned %s",
 				enum_name(&stfstatus_name, ret));
+		return ret; /* abort building the response message */
 	}
+
 	if (!ikev2_padup_pre_encrypt(pst, &e_pbs_cipher))
 		return STF_INTERNAL_ERROR;
 

