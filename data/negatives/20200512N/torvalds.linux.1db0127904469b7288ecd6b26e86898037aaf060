commit 1db0127904469b7288ecd6b26e86898037aaf060
Author: Lucas Stach <l.stach@pengutronix.de>
Date:   Fri Dec 2 12:19:16 2016 +0100

    drm/etnaviv: move linear window on MC1.0 parts if necessary
    
    On i.MX6SX the physical memory is placed above the 2GB mark, so the GPU
    linear window has to be moved for the GPU to work at all. This doesn't
    mix with the FAST_CLEAR feature, as the TS unit doesn't take the linear
    window offset into account and will corrupt memory when used with a
    non-zero offset.
    
    Move the linear window if it's necessary for the GPU to work, but avoid
    announcing FAST_CLEAR support to userspace in this case.
    
    Signed-off-by: Lucas Stach <l.stach@pengutronix.de>
    Tested-by: Marek Vasut <marex@denx.de>

diff --git a/drivers/gpu/drm/etnaviv/etnaviv_gpu.c b/drivers/gpu/drm/etnaviv/etnaviv_gpu.c
index b1254f885fed..4b697ad8bd64 100644
--- a/drivers/gpu/drm/etnaviv/etnaviv_gpu.c
+++ b/drivers/gpu/drm/etnaviv/etnaviv_gpu.c
@@ -639,6 +639,10 @@ int etnaviv_gpu_init(struct etnaviv_gpu *gpu)
 			gpu->memory_base = PHYS_OFFSET;
 		else
 			gpu->memory_base = dma_mask - SZ_2G + 1;
+	} else if (PHYS_OFFSET >= SZ_2G) {
+		dev_info(gpu->dev, "Need to move linear window on MC1.0, disabling TS\n");
+		gpu->memory_base = PHYS_OFFSET;
+		gpu->identity.features &= ~chipFeatures_FAST_CLEAR;
 	}
 
 	ret = etnaviv_hw_reset(gpu);

