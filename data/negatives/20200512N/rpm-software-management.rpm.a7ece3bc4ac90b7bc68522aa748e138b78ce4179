commit a7ece3bc4ac90b7bc68522aa748e138b78ce4179
Author: Panu Matilainen <pmatilai@redhat.com>
Date:   Fri Oct 10 14:28:41 2008 +0300

    Add rpmMkdirs() to librpmio
    - allows creating bunch of directories including parents at once

diff --git a/rpmio/rpmfileutil.c b/rpmio/rpmfileutil.c
index 60c4ba520..f4aed4ab2 100644
--- a/rpmio/rpmfileutil.c
+++ b/rpmio/rpmfileutil.c
@@ -704,3 +704,26 @@ char * rpmGetCwd(void)
     return currDir;
 }
 
+int rpmMkdirs(const char *root, const char *pathstr)
+{
+    ARGV_t dirs = NULL;
+    int rc = 0;
+    argvSplit(&dirs, pathstr, ":");
+    
+    for (char **d = dirs; *d; d++) {
+	char *path = rpmGetPath(root ? root : "", "/", *d, NULL);
+	if ((rc = rpmioMkpath(path, 0755, -1, -1)) != 0) {
+	    const char *msg = _("failed to create directory");
+	    /* try to be more informative if the failing part was a macro */
+	    if (**d == '%') {
+	    	rpmlog(RPMLOG_ERR, "%s %s: %s: %m\n", msg, *d, path);
+	    } else {
+	    	rpmlog(RPMLOG_ERR, "%s %s: %m\n", msg, path);
+	    }
+	}
+	free(path);
+	if (rc) break;
+    }
+    argvFree(dirs);
+    return rc;
+}
diff --git a/rpmio/rpmfileutil.h b/rpmio/rpmfileutil.h
index 3e106676c..471509ef9 100644
--- a/rpmio/rpmfileutil.h
+++ b/rpmio/rpmfileutil.h
@@ -62,6 +62,16 @@ FD_t rpmMkTempFile(const char * prefix, char **fn);
  */
 int rpmioMkpath(const char * path, mode_t mode, uid_t uid, gid_t gid);
 
+/** \ingroup rpmfileutil
+ * Create several directories (including parents if needed) in one go.
+ * Macros in pathstr will be expanded in the process.
+ * @param root		leading root directory (or NULL for none)
+ * @param pathstr	list of directories separated with :
+ * @return		0 if all directories were successfully created
+ * 			(or already existed), non-zero otherwise
+ */
+int rpmMkdirs(const char *root, const char *pathstr);
+
 /** \ingroup rpmfileutil
  * Canonicalize file path.
  * @param path		path to canonicalize (in-place)

