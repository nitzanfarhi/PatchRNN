commit 8258d4a574d3a8c01f0ef68aa26b969398a0e140
Author: Andrew Morton <akpm@osdl.org>
Date:   Wed Oct 11 01:21:53 2006 -0700

    [PATCH] invalidate_inode_pages2_range() debug
    
    A failure in invalidate_inode_pages2_range() can result in unpleasant things
    happening in NFS (at least).  Stick a WARN_ON_ONCE() in there so we can find
    out if it happens, and maybe why.
    
    (akpm: might be a -mm-only patch, we'll see..)
    
    Cc: Chuck Lever <chuck.lever@oracle.com>
    Cc: Trond Myklebust <Trond.Myklebust@netapp.com>
    Cc: Steve Dickson <SteveD@redhat.com>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/mm/truncate.c b/mm/truncate.c
index f4edbc179d14..fca28839c46e 100644
--- a/mm/truncate.c
+++ b/mm/truncate.c
@@ -396,6 +396,7 @@ int invalidate_inode_pages2_range(struct address_space *mapping,
 		pagevec_release(&pvec);
 		cond_resched();
 	}
+	WARN_ON_ONCE(ret);
 	return ret;
 }
 EXPORT_SYMBOL_GPL(invalidate_inode_pages2_range);

