commit 40ccea665f1c5228f8e1801f15d84465c71679c2
Author: nicm <nicm@openbsd.org>
Date:   Tue Jan 18 18:57:51 2011 +0000

    Merge a change from ncurses upstream to correctly recalculate a form
    field size on set. Fixes an issue found by canacar@ who provided a
    similar fix.
    
    ok canacar

diff --git a/lib/libform/frm_driver.c b/lib/libform/frm_driver.c
index ea428fd113c..266140af9a8 100644
--- a/lib/libform/frm_driver.c
+++ b/lib/libform/frm_driver.c
@@ -32,7 +32,7 @@
 
 #include "form.priv.h"
 
-MODULE_ID("$Id: frm_driver.c,v 1.9 2010/01/12 23:22:07 nicm Exp $")
+MODULE_ID("$Id: frm_driver.c,v 1.10 2011/01/18 18:57:51 nicm Exp $")
 
 /*----------------------------------------------------------------------------
   This is the core module of the form library. It contains the majority
@@ -4347,7 +4347,9 @@ set_field_buffer(FIELD *field, int buffer, const char *value)
 						     * field->cols))))
 	    RETURN(E_SYSTEM_ERROR);
 
+#if !USE_WIDEC_SUPPORT
 	  len = vlen;
+#endif
 	}
     }
 
@@ -4366,6 +4368,7 @@ set_field_buffer(FIELD *field, int buffer, const char *value)
       delwin(field->working);
       field->working = newpad(field->drows, field->dcols);
     }
+  len = Buffer_Length(field);
   wclear(field->working);
   mvwaddstr(field->working, 0, 0, value);
 

