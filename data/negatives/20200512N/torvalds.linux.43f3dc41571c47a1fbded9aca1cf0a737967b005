commit 43f3dc41571c47a1fbded9aca1cf0a737967b005
Author: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
Date:   Mon Jun 20 18:53:18 2011 -0300

    Bluetooth: Fix not setting the chan state
    
    When the connection is ready we should set the connection
    to CONNECTED so userspace can use it.
    
    Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@openbossa.org>
    Signed-off-by: Gustavo F. Padovan <padovan@profusion.mobi>

diff --git a/net/bluetooth/l2cap_core.c b/net/bluetooth/l2cap_core.c
index ba0b2f47bab8..9ec9c8c5eb5e 100644
--- a/net/bluetooth/l2cap_core.c
+++ b/net/bluetooth/l2cap_core.c
@@ -895,7 +895,7 @@ static void l2cap_chan_ready(struct sock *sk)
 	chan->conf_state = 0;
 	__clear_chan_timer(chan);
 
-	sk->sk_state = BT_CONNECTED;
+	l2cap_state_change(chan, BT_CONNECTED);
 	sk->sk_state_change(sk);
 
 	if (parent)

