commit 5bc99d3904c5f4669b6827a5d07d9bcd9497f509
Author: Daniel-Constantin Mierla <daniel@voice-system.ro>
Date:   Mon Jan 20 17:39:04 2003 +0000

    XJAB module
            - added a new function that sends offline NOTIFYs to SIP user for every
              subscribed Jabber user when the connection to Jabber server is closed. All
              of them will appear offline.

diff --git a/modules_s/jabber/xjab_presence.c b/modules_s/jabber/xjab_presence.c
index cc7062b67..5a6c2a8f0 100644
--- a/modules_s/jabber/xjab_presence.c
+++ b/modules_s/jabber/xjab_presence.c
@@ -255,5 +255,21 @@ xj_pres_cell xj_pres_list_check(xj_pres_list prl, str* uid)
 	return NULL;
 }
 
-
+/**
+ *
+ */
+void xj_pres_list_notifyall(xj_pres_list prl, int s)
+{
+	xj_pres_cell p;
+	if(!prl || prl->nr<=0 || prl->clist==NULL)
+		return;
+	p = prl->clist;
+	while(p)
+	{
+		if(p->cbf)
+			(*(p->cbf))(&(p->userid),(s==XJ_PRES_STATE_CHECK)?p->state:s,
+					p->cbp);
+		p = p->next;
+	}
+}
 
diff --git a/modules_s/jabber/xjab_presence.h b/modules_s/jabber/xjab_presence.h
index 1b848bfed..a52d65893 100644
--- a/modules_s/jabber/xjab_presence.h
+++ b/modules_s/jabber/xjab_presence.h
@@ -32,6 +32,7 @@
 #include "../../str.h"
 #include "xjab_base.h"
 
+#define XJ_PRES_STATE_CHECK		-1
 #define XJ_PRES_STATE_OFFLINE	0
 #define XJ_PRES_STATE_ONLINE	1
 #define XJ_PRES_STATE_REFUSED	2
@@ -70,7 +71,7 @@ void xj_pres_list_free(xj_pres_list);
 xj_pres_cell xj_pres_list_add(xj_pres_list, xj_pres_cell);
 int xj_pres_list_del(xj_pres_list, str*);
 xj_pres_cell xj_pres_list_check(xj_pres_list, str*);
-
+void xj_pres_list_notifyall(xj_pres_list,int);
 
 #endif
 

