commit 19b3bd3e2d260323c5e727212a6dcd7fc0f7aa07
Author: Robert Shearman <rob@codeweavers.com>
Date:   Thu Jul 13 23:17:22 2006 +0100

    format-patch: Generate a newline between the subject header and the message body
    
    format-patch previously didn't generate a newline after a subject. This
    caused the diffstat to not be displayed in messages with only one line
    for the commit message.
    This patch fixes this by adding a newline after the headers if a body
    hasn't been added.
    Signed-off-by: Robert Shearman <rob@codeweavers.com>
    Signed-off-by: Junio C Hamano <junkio@cox.net>

diff --git a/commit.c b/commit.c
index 522a6f3ac..6ac3bf755 100644
--- a/commit.c
+++ b/commit.c
@@ -655,6 +655,9 @@ unsigned long pretty_print_commit(enum cmit_fmt fmt, const struct commit *commit
 			continue;
 		}
 
+		if (!subject)
+			body = 1;
+
 		if (is_empty_line(line, &linelen)) {
 			if (!body)
 				continue;
@@ -662,8 +665,6 @@ unsigned long pretty_print_commit(enum cmit_fmt fmt, const struct commit *commit
 				continue;
 			if (fmt == CMIT_FMT_SHORT)
 				break;
-		} else {
-			body = 1;
 		}
 
 		if (subject) {
@@ -702,6 +703,12 @@ unsigned long pretty_print_commit(enum cmit_fmt fmt, const struct commit *commit
 	/* Make sure there is an EOLN for the non-oneline case */
 	if (fmt != CMIT_FMT_ONELINE)
 		buf[offset++] = '\n';
+	/*
+	 * make sure there is another EOLN to separate the headers from whatever
+	 * body the caller appends if we haven't already written a body
+	 */
+	if (fmt == CMIT_FMT_EMAIL && !body)
+		buf[offset++] = '\n';
 	buf[offset] = '\0';
 	return offset;
 }

