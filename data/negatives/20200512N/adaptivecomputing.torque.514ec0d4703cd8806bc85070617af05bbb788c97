commit 514ec0d4703cd8806bc85070617af05bbb788c97
Author: Chad Vizino <cvizino@adaptivecomputing.com>
Date:   Thu Jun 18 17:15:08 2015 -0600

    Resolve Coverity id 1307711

diff --git a/src/server/pbsd_init.c b/src/server/pbsd_init.c
index 073215318..5052ff4dd 100644
--- a/src/server/pbsd_init.c
+++ b/src/server/pbsd_init.c
@@ -739,7 +739,6 @@ int mk_subdirs(
 
   {
   int         j;
-  struct stat statbuf;
   char        log_buf[LOCAL_LOG_BUF_SIZE];
 
   if (paths == NULL)
@@ -753,25 +752,26 @@ int mk_subdirs(
       {
       char buf[1024];
 
-      // build the complete path and see if it exists
+      // build the complete path
       snprintf(buf, sizeof(buf), "%s%d/", paths[j], i);
-      if ((lstat(buf, &statbuf) != 0) && (errno == ENOENT))
-        {
-        // try to make the directory
-        if (mkdir(buf, 0770) != 0)
-          {
-          snprintf(log_buf, sizeof(log_buf), "%s cannot create directory, errno=%d, %s",
-             buf,
-             errno,
-             strerror(errno));
-          log_err(-1, __func__, log_buf);
-          return(3);
-          }
 
+      // try to make the directory
+      if (mkdir(buf, 0770) == 0)
+        {
         // success - add log message
         snprintf(log_buf, sizeof(log_buf), "created missing directory %s", buf);
         log_ext(0, __func__, log_buf, LOG_INFO);
         }
+      else if (errno != EEXIST)
+        {
+        // fail only if directory (or file) named by buf does not exist
+        snprintf(log_buf, sizeof(log_buf), "%s cannot create directory, errno=%d, %s",
+           buf,
+           errno,
+           strerror(errno));
+        log_err(-1, __func__, log_buf);
+        return(3);
+        }
       }
     }
   return(PBSE_NONE);

