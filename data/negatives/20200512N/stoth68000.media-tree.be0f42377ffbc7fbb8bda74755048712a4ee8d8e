commit be0f42377ffbc7fbb8bda74755048712a4ee8d8e
Author: Thomas Pedersen <thomas@cozybit.com>
Date:   Sun May 13 22:24:08 2012 -0700

    mac80211: allow channel change while mesh is down
    
    Allow channel change on a mesh interface if the interface is up and no
    mesh is started.
    
    Signed-off-by: Thomas Pedersen <thomas@cozybit.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/mac80211/chan.c b/net/mac80211/chan.c
index c76cf7230c7d..f0f87e5a1d35 100644
--- a/net/mac80211/chan.c
+++ b/net/mac80211/chan.c
@@ -41,6 +41,10 @@ __ieee80211_get_channel_mode(struct ieee80211_local *local,
 			if (!sdata->u.ap.beacon)
 				continue;
 			break;
+		case NL80211_IFTYPE_MESH_POINT:
+			if (!sdata->wdev.mesh_id_len)
+				continue;
+			break;
 		default:
 			break;
 		}

