commit 8488cd96ff88966ccb076e4f3654f59d84ba686d
Author: Eric Biggers <ebiggers@google.com>
Date:   Mon Dec 5 11:12:46 2016 -0800

    fscrypt: use EEXIST when file already uses different policy
    
    As part of an effort to clean up fscrypt-related error codes, make
    FS_IOC_SET_ENCRYPTION_POLICY fail with EEXIST when the file already uses
    a different encryption policy.  This is more descriptive than EINVAL,
    which was ambiguous with some of the other error cases.
    
    I am not aware of any users who might be relying on the previous error
    code of EINVAL, which was never documented anywhere.
    
    This failure case will be exercised by an xfstest.
    
    Signed-off-by: Eric Biggers <ebiggers@google.com>
    Signed-off-by: Theodore Ts'o <tytso@mit.edu>

diff --git a/fs/crypto/policy.c b/fs/crypto/policy.c
index 40ecd7173e34..47f19800ceb7 100644
--- a/fs/crypto/policy.c
+++ b/fs/crypto/policy.c
@@ -129,7 +129,7 @@ int fscrypt_ioctl_set_policy(struct file *filp, const void __user *arg)
 		printk(KERN_WARNING
 		       "%s: Policy inconsistent with encryption context\n",
 		       __func__);
-		ret = -EINVAL;
+		ret = -EEXIST;
 	}
 
 	inode_unlock(inode);

