commit 74458e6c1aea9e422e46030e7bc61e9b0984be5b
Author: Sascha Sommer <saschasommer@freenet.de>
Date:   Tue Nov 8 21:37:33 2005 -0800

    [PATCH] v4l: 786: chip id removed since it isn t required anymore
    
    - Chip_id removed since it isn't required anymore.
    
    Signed-off-by: Sascha Sommer <saschasommer@freenet.de>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@brturbo.com.br>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/drivers/media/video/em28xx/em28xx-cards.c b/drivers/media/video/em28xx/em28xx-cards.c
index 919520f89975..59f8fa0bea60 100644
--- a/drivers/media/video/em28xx/em28xx-cards.c
+++ b/drivers/media/video/em28xx/em28xx-cards.c
@@ -160,7 +160,6 @@ struct em2820_board em2820_boards[] = {
 	},
 	[EM2800_BOARD_TERRATEC_CINERGY_200] = {
 		.name         = "Terratec Cinergy 200 USB",
-		.chip_id      = 0x4,
 		.is_em2800    = 1,
 		.vchannels    = 3,
 		.norm         = VIDEO_MODE_PAL,
@@ -184,7 +183,6 @@ struct em2820_board em2820_boards[] = {
 	},
 	[EM2800_BOARD_LEADTEK_WINFAST_USBII] = {
 		.name         = "Leadtek Winfast USB II",
-		.chip_id      = 0x2,
 		.is_em2800    = 1,
 		.vchannels    = 3,
 		.norm         = VIDEO_MODE_PAL,
@@ -208,7 +206,6 @@ struct em2820_board em2820_boards[] = {
 	},
 	[EM2800_BOARD_KWORLD_USB2800] = {
 		.name         = "Kworld USB2800",
-		.chip_id      = 0x7,
 		.is_em2800    = 1,
 		.vchannels    = 3,
 		.norm         = VIDEO_MODE_PAL,
diff --git a/drivers/media/video/em28xx/em28xx-core.c b/drivers/media/video/em28xx/em28xx-core.c
index f5e22154a97f..f7b8fb035c9e 100644
--- a/drivers/media/video/em28xx/em28xx-core.c
+++ b/drivers/media/video/em28xx/em28xx-core.c
@@ -437,6 +437,18 @@ int em2820_scaler_set(struct em2820 *dev, u16 h, u16 v)
 	buf[0] = v;
 	buf[1] = v >> 8;
 	em2820_write_regs(dev, VSCALELOW_REG, (char *)buf, 2);
+	if(dev->is_em2800){
+		/* FIXME */
+		/* random ratio scaling and 720x567 doesn't seem to work */
+		/* the maximum we can get is 640x480 with disabled scaler */
+		/* and norm_maxw set to 640 */
+		if(dev->width == 640 && dev->height == 480)
+			return em2820_write_regs(dev, COMPR_REG,"\x00",1);
+		if(dev->height > 288)
+			return em2820_write_regs(dev, COMPR_REG,"\x10",1);
+		if(dev->width > 360)
+			return em2820_write_regs(dev, COMPR_REG,"\x20",1);
+	}
 	/* when H and V mixershould be used? */
 	/*	return em2820_write_reg_bits(dev, COMPR_REG, (h ? 0x20 : 0x00) | (v ? 0x10 : 0x00), 0x30); */
 	/* it seems that both H and V scalers must be active to work correctly */
diff --git a/drivers/media/video/em28xx/em28xx-video.c b/drivers/media/video/em28xx/em28xx-video.c
index f3fc44b352b4..048ad1d77bab 100644
--- a/drivers/media/video/em28xx/em28xx-video.c
+++ b/drivers/media/video/em28xx/em28xx-video.c
@@ -1272,6 +1272,18 @@ static int em2820_video_do_ioctl(struct inode *inode, struct file *filp,
 			if (width > maxw)
 				width = maxw;
 
+			/* FIXME*/
+			if(dev->is_em2800){
+				/* we only know how to scale to 50% */
+				if(height % (maxh / 2))
+					height=maxh;
+				if(width % (maxw / 2))
+					width=maxw;
+				/* larger resoltion don't seem to work either */
+				if(width == maxw && height == maxh)
+					width /= 2;
+			}
+
 			if ((hscale =
 			     (((unsigned long)maxw) << 12) / width - 4096L) >=
 			    0x4000)
diff --git a/drivers/media/video/em28xx/em28xx.h b/drivers/media/video/em28xx/em28xx.h
index 31b23f0db051..a11df04a8c3d 100644
--- a/drivers/media/video/em28xx/em28xx.h
+++ b/drivers/media/video/em28xx/em28xx.h
@@ -159,7 +159,6 @@ enum em2820_decoder {
 
 struct em2820_board {
 	char *name;
-	unsigned char chip_id;
 	int vchannels;
 	int norm;
 	int tuner_type;

