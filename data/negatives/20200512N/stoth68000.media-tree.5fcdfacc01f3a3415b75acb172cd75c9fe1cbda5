commit 5fcdfacc01f3a3415b75acb172cd75c9fe1cbda5
Author: Trond Myklebust <trond.myklebust@primarydata.com>
Date:   Wed Mar 25 13:19:42 2015 -0400

    NFSv4: Return delegations synchronously in evict_inode
    
    Kinglong Mee reports that asynchronous delegations are being killed
    by the call to rpc_shutdown_client() when unmounting. This can lead
    to state leakage on the server until the client lease expires.
    
    Reported-by: Kinglong Mee <kinglongmee@gmail.com>
    Signed-off-by: Trond Myklebust <trond.myklebust@primarydata.com>

diff --git a/fs/nfs/delegation.c b/fs/nfs/delegation.c
index a6ad68865880..08c624448750 100644
--- a/fs/nfs/delegation.c
+++ b/fs/nfs/delegation.c
@@ -514,7 +514,7 @@ void nfs_inode_return_delegation_noreclaim(struct inode *inode)
 
 	delegation = nfs_inode_detach_delegation(inode);
 	if (delegation != NULL)
-		nfs_do_return_delegation(inode, delegation, 0);
+		nfs_do_return_delegation(inode, delegation, 1);
 }
 
 /**

