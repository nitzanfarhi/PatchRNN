commit 1811f1d84079b30295725ae69aa14054dbb377ff
Author: James Zern <jzern@google.com>
Date:   Tue Mar 5 13:19:03 2013 -0800

    libopusenc: use ff_alloc_packet2
    
    Signed-off-by: Paul B Mahol <onemda@gmail.com>

diff --git a/libavcodec/libopusenc.c b/libavcodec/libopusenc.c
index a4aa37cdd4..04c297deba 100644
--- a/libavcodec/libopusenc.c
+++ b/libavcodec/libopusenc.c
@@ -331,10 +331,8 @@ static int libopus_encode(AVCodecContext *avctx, AVPacket *avpkt,
     /* Maximum packet size taken from opusenc in opus-tools. 60ms packets
      * consist of 3 frames in one packet. The maximum frame size is 1275
      * bytes along with the largest possible packet header of 7 bytes. */
-    if (ret = ff_alloc_packet(avpkt, (1275 * 3 + 7) * opus->stream_count)) {
-        av_log(avctx, AV_LOG_ERROR, "Error getting output packet\n");
+    if ((ret = ff_alloc_packet2(avctx, avpkt, (1275 * 3 + 7) * opus->stream_count)) < 0)
         return ret;
-    }
 
     if (avctx->sample_fmt == AV_SAMPLE_FMT_FLT)
         ret = opus_multistream_encode_float(opus->enc, (float *)audio,

