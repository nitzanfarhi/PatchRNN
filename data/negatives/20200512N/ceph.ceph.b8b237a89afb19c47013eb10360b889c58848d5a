commit b8b237a89afb19c47013eb10360b889c58848d5a
Author: Orit Wasserman <owasserm@redhat.com>
Date:   Mon Sep 21 16:21:57 2015 +0200

    rgw: add realms to zonegroupmap
    
    Signed-off-by: Orit Wasserman <owasserm@redhat.com>

diff --git a/src/rgw/rgw_json_enc.cc b/src/rgw/rgw_json_enc.cc
index 5e908ec054..f828b4a661 100644
--- a/src/rgw/rgw_json_enc.cc
+++ b/src/rgw/rgw_json_enc.cc
@@ -920,6 +920,7 @@ void RGWPeriodMap::decode_json(JSONObj *obj)
 
 void RGWZoneGroupMap::dump(Formatter *f) const
 {
+  encode_json("realms", realms, f);
   encode_json("periods", periods, f);
   encode_json("bucket_quota", bucket_quota, f);
   encode_json("user_quota", user_quota, f);
@@ -927,6 +928,7 @@ void RGWZoneGroupMap::dump(Formatter *f) const
 
 void RGWZoneGroupMap::decode_json(JSONObj *obj)
 {
+  JSONDecoder::decode_json("realms", realms, obj);
   JSONDecoder::decode_json("periods", periods, obj);
   JSONDecoder::decode_json("bucket_quota", bucket_quota, obj);
   JSONDecoder::decode_json("user_quota", user_quota, obj);
diff --git a/src/rgw/rgw_rados.cc b/src/rgw/rgw_rados.cc
index 91bf63d201..4024f9cf5a 100644
--- a/src/rgw/rgw_rados.cc
+++ b/src/rgw/rgw_rados.cc
@@ -1036,6 +1036,7 @@ int RGWPeriodMap::update(RGWZoneGroup& zonegroup)
 
 void RGWZoneGroupMap::encode(bufferlist& bl) const {
   ENCODE_START(4, 1, bl);
+  ::encode(realms, bl);
   ::encode(periods, bl);
   ::encode(bucket_quota, bl);
   ::encode(user_quota, bl);
@@ -1044,6 +1045,7 @@ void RGWZoneGroupMap::encode(bufferlist& bl) const {
 
 void RGWZoneGroupMap::decode(bufferlist::iterator& bl) {
   DECODE_START(4, bl);
+  ::decode(realms, bl);
   ::decode(periods, bl);
   ::decode(bucket_quota, bl);
   ::decode(user_quota, bl);
diff --git a/src/rgw/rgw_rados.h b/src/rgw/rgw_rados.h
index 4cbd93ccd3..a0d404a113 100644
--- a/src/rgw/rgw_rados.h
+++ b/src/rgw/rgw_rados.h
@@ -1151,8 +1151,8 @@ class RGWRealm;
 struct RGWZoneGroupMap {
 
   Mutex lock;
+  map<string, RGWRealm> realms;
   map<string, RGWPeriodMap> periods;
-
   RGWQuotaInfo bucket_quota;
   RGWQuotaInfo user_quota;
 

