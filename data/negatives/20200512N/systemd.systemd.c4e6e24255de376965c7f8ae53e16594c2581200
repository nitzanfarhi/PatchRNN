commit c4e6e24255de376965c7f8ae53e16594c2581200
Author: Zbigniew JÄ™drzejewski-Szmek <zbyszek@in.waw.pl>
Date:   Thu Jan 16 01:15:17 2014 -0500

    bus: fix issue with reference counting
    
    b7fc42e03 introduced a regression.

diff --git a/src/libsystemd/sd-bus.c b/src/libsystemd/sd-bus.c
index b76221ef9..95d80db24 100644
--- a/src/libsystemd/sd-bus.c
+++ b/src/libsystemd/sd-bus.c
@@ -1425,8 +1425,8 @@ static int dispatch_wqueue(sd_bus *bus) {
                          * it got full, then all bets are off
                          * anyway. */
 
-                        sd_bus_message_unref(bus->wqueue[0]);
                         bus->wqueue_size --;
+                        sd_bus_message_unref(bus->wqueue[0]);
                         memmove(bus->wqueue, bus->wqueue + 1, sizeof(sd_bus_message*) * bus->wqueue_size);
                         bus->windex = 0;
 

