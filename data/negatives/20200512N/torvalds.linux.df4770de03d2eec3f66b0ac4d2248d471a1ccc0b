commit df4770de03d2eec3f66b0ac4d2248d471a1ccc0b
Author: Eilon Greenstein <eilong@broadcom.com>
Date:   Wed Aug 12 08:23:28 2009 +0000

    bnx2x: Calling pci_set_drvdata earlier
    
    In case of error, bnx2x_init_dev calls pci_set_drvdata(pdev, NULL)
    
    Signed-off-by: Yitchak Gertner <gertner@broadcom.com>
    Signed-off-by: Eilon Greenstein <eilong@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/bnx2x_main.c b/drivers/net/bnx2x_main.c
index 0ebbc7794803..8e77e933ac18 100644
--- a/drivers/net/bnx2x_main.c
+++ b/drivers/net/bnx2x_main.c
@@ -11885,14 +11885,14 @@ static int __devinit bnx2x_init_one(struct pci_dev *pdev,
 	bp = netdev_priv(dev);
 	bp->msglevel = debug;
 
+	pci_set_drvdata(pdev, dev);
+
 	rc = bnx2x_init_dev(pdev, dev);
 	if (rc < 0) {
 		free_netdev(dev);
 		return rc;
 	}
 
-	pci_set_drvdata(pdev, dev);
-
 	rc = bnx2x_init_bp(bp);
 	if (rc)
 		goto init_one_exit;

