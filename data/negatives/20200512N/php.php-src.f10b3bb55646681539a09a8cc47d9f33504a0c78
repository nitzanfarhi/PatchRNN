commit f10b3bb55646681539a09a8cc47d9f33504a0c78
Author: Dmitry Stogov <dmitry@php.net>
Date:   Thu Dec 1 13:58:29 2011 +0000

    Fixed icorrect key length after updating constant index

diff --git a/Zend/zend_hash.c b/Zend/zend_hash.c
index ad3f46a08d..07fe739c81 100644
--- a/Zend/zend_hash.c
+++ b/Zend/zend_hash.c
@@ -1399,6 +1399,7 @@ ZEND_API int zend_hash_update_current_key_ex(HashTable *ht, int key_type, const
 			p->h = num_index;
 		} else {
 			p->h = h;
+			p->nKeyLength = str_length;
 			if (IS_INTERNED(str_index)) {
 				p->arKey = str_index;
 			} else {

