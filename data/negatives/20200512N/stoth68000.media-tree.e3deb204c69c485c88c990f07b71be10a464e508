commit e3deb204c69c485c88c990f07b71be10a464e508
Author: Eric Anholt <eric@anholt.net>
Date:   Mon Nov 2 15:33:05 2009 -0800

    agp/intel: Use a non-reserved value for the cache field of the PTEs.
    
    I don't know if this is what we'll want to be using long term, we'll see.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

diff --git a/drivers/char/agp/intel-agp.c b/drivers/char/agp/intel-agp.c
index df85ed9c7531..c3c870bf5678 100644
--- a/drivers/char/agp/intel-agp.c
+++ b/drivers/char/agp/intel-agp.c
@@ -296,6 +296,11 @@ static void intel_agp_insert_sg_entries(struct agp_memory *mem,
 					off_t pg_start, int mask_type)
 {
 	int i, j;
+	u32 cache_bits = 0;
+
+	if (agp_bridge->dev->device == PCI_DEVICE_ID_INTEL_SANDYBRIDGE_HB) {
+		cache_bits = I830_PTE_SYSTEM_CACHED;
+	}
 
 	for (i = 0, j = pg_start; i < mem->page_count; i++, j++) {
 		writel(agp_bridge->driver->mask_memory(agp_bridge,

