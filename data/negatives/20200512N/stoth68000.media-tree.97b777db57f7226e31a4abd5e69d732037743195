commit 97b777db57f7226e31a4abd5e69d732037743195
Author: Luis R. Rodriguez <lrodriguez@atheros.com>
Date:   Thu Nov 13 19:11:57 2008 -0800

    ath9k: make DMA memory consistent
    
    Make the DMAable mameory consistent with pci_set_consistent_dma_mask().
    The DMA-mapping.txt Documentation recommends this but for PCI-X
    considerations and on strange architecture like SGI SN2, not sure
    why it would fix an issue but lets see if it does, just in case.
    
    Before this, this driver was tested with x86_64 with about
    7 GB of RAM, not sure if this is really needed.
    
    Signed-off-by: Luis R. Rodriguez <lrodriguez@atheros.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/ath9k/main.c b/drivers/net/wireless/ath9k/main.c
index 9d64ef565c03..3355ba4043e8 100644
--- a/drivers/net/wireless/ath9k/main.c
+++ b/drivers/net/wireless/ath9k/main.c
@@ -1591,9 +1591,18 @@ static int ath_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 	if (pci_enable_device(pdev))
 		return -EIO;
 
-	if (pci_set_dma_mask(pdev, DMA_32BIT_MASK)) {
+	ret =  pci_set_dma_mask(pdev, DMA_32BIT_MASK);
+
+	if (ret) {
 		printk(KERN_ERR "ath9k: 32-bit DMA not available\n");
-		ret = -ENODEV;
+		goto bad;
+	}
+
+	ret = pci_set_consistent_dma_mask(pdev, DMA_32BIT_MASK);
+
+	if (ret) {
+		printk(KERN_ERR "ath9k: 32-bit DMA consistent "
+			"DMA enable faled\n");
 		goto bad;
 	}
 

