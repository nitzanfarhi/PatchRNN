commit afdb698c81d58450289a222c263565219785e42e
Author: Julian Taylor <jtaylor.debian@googlemail.com>
Date:   Sat Mar 29 12:58:01 2014 +0100

    ENH: use fast sequence API for setArrayFromSequence
    
    reduces runtime of function by about 10%

diff --git a/numpy/core/src/multiarray/ctors.c b/numpy/core/src/multiarray/ctors.c
index 2ab46d258..1fc11aee4 100644
--- a/numpy/core/src/multiarray/ctors.c
+++ b/numpy/core/src/multiarray/ctors.c
@@ -503,15 +503,18 @@ setArrayFromSequence(PyArrayObject *a, PyObject *s,
     }
     /* Copy element by element */
     else {
+        PyObject * seq;
+        seq = PySequence_Fast(s, "Could not convert object to sequence");
+        if (seq == NULL) {
+            goto fail;
+        }
         for (i = 0; i < slen; i++) {
-            PyObject *o = PySequence_GetItem(s, i);
-            if (o == NULL) {
-                goto fail;
-            }
+            PyObject * o = PySequence_Fast_GET_ITEM(seq, i);
             if ((PyArray_NDIM(a) - dim) > 1) {
                 PyArrayObject * tmp =
                     (PyArrayObject *)array_item_asarray(dst, i);
                 if (tmp == NULL) {
+                    Py_DECREF(seq);
                     goto fail;
                 }
 
@@ -522,11 +525,12 @@ setArrayFromSequence(PyArrayObject *a, PyObject *s,
                 char * b = (PyArray_BYTES(dst) + i * PyArray_STRIDES(dst)[0]);
                 res = PyArray_DESCR(dst)->f->setitem(o, b, dst);
             }
-            Py_DECREF(o);
             if (res < 0) {
+                Py_DECREF(seq);
                 goto fail;
             }
         }
+        Py_DECREF(seq);
     }
 
     Py_DECREF(s);

