commit 33de4f9d787e01646f715ac10c2699fb98fd479e
Author: Johannes Berg <johannes@sipsolutions.net>
Date:   Thu Sep 17 08:35:54 2009 -0700

    cfg80211: wext: don't display BSSID unless associated
    
    Currently, cfg80211's SIOCGIWAP implementation returns
    the BSSID that the user set, even if the connection has
    since been dropped due to other changes. It only should
    return the current BSSID when actually connected.
    
    Also do a small code cleanup.
    
    Reported-by: Thomas H. Guenther <thomas.h.guenther@intel.com>
    Signed-off-by: Johannes Berg <johannes@sipsolutions.net>
    Tested-by: Thomas H. Guenther <thomas.h.guenther@intel.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/wireless/wext-sme.c b/net/wireless/wext-sme.c
index bf725275eb8d..53c6ba98dc25 100644
--- a/net/wireless/wext-sme.c
+++ b/net/wireless/wext-sme.c
@@ -229,8 +229,7 @@ int cfg80211_mgd_wext_giwessid(struct net_device *dev,
 		data->flags = 1;
 		data->length = wdev->wext.connect.ssid_len;
 		memcpy(ssid, wdev->wext.connect.ssid, data->length);
-	} else
-		data->flags = 0;
+	}
 	wdev_unlock(wdev);
 
 	return 0;
@@ -306,8 +305,6 @@ int cfg80211_mgd_wext_giwap(struct net_device *dev,
 	wdev_lock(wdev);
 	if (wdev->current_bss)
 		memcpy(ap_addr->sa_data, wdev->current_bss->pub.bssid, ETH_ALEN);
-	else if (wdev->wext.connect.bssid)
-		memcpy(ap_addr->sa_data, wdev->wext.connect.bssid, ETH_ALEN);
 	else
 		memset(ap_addr->sa_data, 0, ETH_ALEN);
 	wdev_unlock(wdev);

