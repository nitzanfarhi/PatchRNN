commit b3bebd94bbe4e59dfa23d85b0296a4ce8ebcc6c7
Author: Miklos Szeredi <miklos@szeredi.hu>
Date:   Mon Jan 16 22:14:27 2006 -0800

    [PATCH] fuse: handle error INIT reply
    
    Handle the case when the INIT request is answered with an error.
    
    Signed-off-by: Miklos Szeredi <miklos@szeredi.hu>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/fs/fuse/dev.c b/fs/fuse/dev.c
index de402e4d8bce..8244e89a8dd6 100644
--- a/fs/fuse/dev.c
+++ b/fs/fuse/dev.c
@@ -153,7 +153,7 @@ static void process_init_reply(struct fuse_conn *fc, struct fuse_req *req)
 	int i;
 	struct fuse_init_out *arg = &req->misc.init_out;
 
-	if (arg->major != FUSE_KERNEL_VERSION)
+	if (req->out.h.error || arg->major != FUSE_KERNEL_VERSION)
 		fc->conn_error = 1;
 	else {
 		fc->minor = arg->minor;

