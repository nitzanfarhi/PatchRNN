commit a377980f308a13a56ab28ba144a29b02eb155fde
Author: ratchov <ratchov@openbsd.org>
Date:   Fri Jan 29 15:14:23 2016 +0000

    Move the AUDIO_GETDEV ioctl in its own routine.

diff --git a/sys/dev/audio.c b/sys/dev/audio.c
index cc6e8ccd29f..1271bc77517 100644
--- a/sys/dev/audio.c
+++ b/sys/dev/audio.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: audio.c,v 1.143 2016/01/20 19:01:39 ratchov Exp $	*/
+/*	$OpenBSD: audio.c,v 1.144 2016/01/29 15:14:23 ratchov Exp $	*/
 /*
  * Copyright (c) 2015 Alexandre Ratchov <alex@caoua.org>
  *
@@ -1531,6 +1531,16 @@ audio_write(struct audio_softc *sc, struct uio *uio, int ioflag)
 	return 0;
 }
 
+int
+audio_getdev(struct audio_softc *sc, struct audio_device *adev)
+{
+	memset(adev, 0, sizeof(struct audio_device));
+	if (sc->dev.dv_parent == NULL)
+		return EIO;
+	strlcpy(adev->name, sc->dev.dv_parent->dv_xname, MAX_AUDIO_DEV_LEN);
+	return 0;
+}
+
 int
 audio_ioctl(struct audio_softc *sc, unsigned long cmd, void *addr)
 {
@@ -1584,11 +1594,7 @@ audio_ioctl(struct audio_softc *sc, unsigned long cmd, void *addr)
 		error = audio_getinfo(sc, (struct audio_info *)addr);
 		break;
 	case AUDIO_GETDEV:
-		memset(addr, 0, sizeof(struct audio_device));
-		if (sc->dev.dv_parent)
-			strlcpy(((struct audio_device *)addr)->name,
-			    sc->dev.dv_parent->dv_xname,
-			    MAX_AUDIO_DEV_LEN);
+		error = audio_getdev(sc, (struct audio_device *)addr);
 		break;
 	case AUDIO_GETENC:
 		error = sc->ops->query_encoding(sc->arg,

