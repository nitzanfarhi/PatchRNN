commit b7f758659265c173380b792862aaad1c23c0e004
Author: Russell King - ARM Linux <linux@arm.linux.org.uk>
Date:   Mon Jan 3 22:46:17 2011 +0000

    ARM: PL08x: prevent dma_set_runtime_config() reconfiguring memcpy channels
    
    Prevent dma_set_runtime_config() being used to alter the configuration
    supplied by the platform for memcpy channel configuration.  No one
    should be trying to change this configuration.
    
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Acked-by: Linus Walleij <linus.walleij@stericsson.com>
    Signed-off-by: Dan Williams <dan.j.williams@intel.com>

diff --git a/drivers/dma/amba-pl08x.c b/drivers/dma/amba-pl08x.c
index c7f7b82f6155..bebc678ed4fc 100644
--- a/drivers/dma/amba-pl08x.c
+++ b/drivers/dma/amba-pl08x.c
@@ -1129,6 +1129,9 @@ static int dma_set_runtime_config(struct dma_chan *chan,
 	u32 cctl = 0;
 	int i;
 
+	if (!plchan->slave)
+		return -EINVAL;
+
 	/* Transfer direction */
 	plchan->runtime_direction = config->direction;
 	if (config->direction == DMA_TO_DEVICE) {

