commit e19f6bcf64da384de25547bb442058d206017ec5
Author: Tom Lane <tgl@sss.pgh.pa.us>
Date:   Tue Aug 31 23:27:05 2004 +0000

    needs_toast_table() should ignore dropped columns.

diff --git a/src/backend/commands/tablecmds.c b/src/backend/commands/tablecmds.c
index d14fb35ca3..8c50d22843 100644
--- a/src/backend/commands/tablecmds.c
+++ b/src/backend/commands/tablecmds.c
@@ -8,7 +8,7 @@
  *
  *
  * IDENTIFICATION
- *	  $PostgreSQL: pgsql/src/backend/commands/tablecmds.c,v 1.130 2004/08/31 15:56:39 tgl Exp $
+ *	  $PostgreSQL: pgsql/src/backend/commands/tablecmds.c,v 1.131 2004/08/31 23:27:05 tgl Exp $
  *
  *-------------------------------------------------------------------------
  */
@@ -5760,6 +5760,8 @@ needs_toast_table(Relation rel)
 
 	for (i = 0; i < tupdesc->natts; i++)
 	{
+		if (att[i]->attisdropped)
+			continue;
 		data_length = att_align(data_length, att[i]->attalign);
 		if (att[i]->attlen > 0)
 		{

