commit 1b6a19b34d54d3d56b90423e4a7c60b971d70197
Author: Christian Borntraeger <borntraeger@de.ibm.com>
Date:   Mon Mar 31 09:44:30 2014 +0200

    kvm/s390: also set guest pages back to stable on kexec/kdump
    
    We need to reset the usage state of the pages on kexec/kdump,
    which use subcode 0 and 1. We will only do the cmma reset in
    the kernel, everything else is done in userspace as before.
    
    Signed-off-by: Christian Borntraeger <borntraeger@de.ibm.com>
    Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>

diff --git a/arch/s390/kvm/diag.c b/arch/s390/kvm/diag.c
index 6f9cfa500372..1facd9277f38 100644
--- a/arch/s390/kvm/diag.c
+++ b/arch/s390/kvm/diag.c
@@ -85,6 +85,10 @@ static int __diag_ipl_functions(struct kvm_vcpu *vcpu)
 
 	VCPU_EVENT(vcpu, 5, "diag ipl functions, subcode %lx", subcode);
 	switch (subcode) {
+	case 0:
+	case 1:
+		page_table_reset_pgste(current->mm, 0, TASK_SIZE);
+		return -EOPNOTSUPP;
 	case 3:
 		vcpu->run->s390_reset_flags = KVM_S390_RESET_CLEAR;
 		page_table_reset_pgste(current->mm, 0, TASK_SIZE);

