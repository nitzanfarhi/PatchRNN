commit c4020746ff49b2156b4f98672c077d1a3b86fa8b
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Sat Nov 17 12:15:02 2012 +0100

    usb-smartcard-reader: Properly NAK interrupt eps when we've no events
    
    When we've no data to return from the interrupt endpoint, return NAK rather
    then a 0 length packet.
    
    CC: Alon Levy <alevy@redhat.com>
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

diff --git a/hw/usb/dev-smartcard-reader.c b/hw/usb/dev-smartcard-reader.c
index 190fcd62d4..de955b709f 100644
--- a/hw/usb/dev-smartcard-reader.c
+++ b/hw/usb/dev-smartcard-reader.c
@@ -1002,6 +1002,8 @@ static void ccid_handle_data(USBDevice *dev, USBPacket *p)
                         "handle_data: int_in: notify_slot_change %X, "
                         "requested len %zd\n",
                         s->bmSlotICCState, p->iov.size);
+            } else {
+                p->status = USB_RET_NAK;
             }
             break;
         default:

