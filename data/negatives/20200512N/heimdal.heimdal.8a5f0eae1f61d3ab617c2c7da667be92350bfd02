commit 8a5f0eae1f61d3ab617c2c7da667be92350bfd02
Author: Assar Westerlund <assar@sics.se>
Date:   Thu Nov 25 05:29:32 1999 +0000

    (krb4_authenticate): obtain the `local' address when doing NAT.  also
    turn on passive mode.  From <thn@stacken.kth.se>
    
    
    git-svn-id: svn://svn.h5l.se/heimdal/trunk/heimdal@7429 ec53bebd-3082-4978-b11e-865c3cabbd6b

diff --git a/appl/kx/krb4.c b/appl/kx/krb4.c
index 028e3b8cc..2668cd837 100644
--- a/appl/kx/krb4.c
+++ b/appl/kx/krb4.c
@@ -76,6 +76,14 @@ krb4_authenticate (kx_context *kc, int s)
     krb4_kx_context *c = (krb4_kx_context *)kc->data;
     const char *host = kc->host;
 
+    if (krb_get_config_bool("nat_in_use")) {
+	struct in_addr natAddr;
+
+	if (krb_get_our_ip_for_realm(krb_realmofhost(kc->host),
+				     &natAddr) == KSUCCESS)
+	    kc->thisaddr.sin_addr = natAddr;
+    }
+
     status = krb_sendauth (KOPT_DO_MUTUAL, s, &text, "rcmd",
 			   (char *)host, krb_realmofhost (host),
 			   getpid(), &msg, &cred, c->schedule,

