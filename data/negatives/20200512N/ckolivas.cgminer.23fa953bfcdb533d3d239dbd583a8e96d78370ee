commit 23fa953bfcdb533d3d239dbd583a8e96d78370ee
Author: Con Kolivas <kernel@kolivas.org>
Date:   Fri Apr 5 18:51:20 2013 +1100

    Check enough work is queued before queueing more in avalon_fill.

diff --git a/driver-avalon.c b/driver-avalon.c
index 48bb870f..cfa2b7a2 100644
--- a/driver-avalon.c
+++ b/driver-avalon.c
@@ -768,6 +768,8 @@ static bool avalon_fill(struct cgpu_info *avalon)
 
 	if (unlikely(!work))
 		return false;
+	if (avalon->queued == avalon_info[avalon->device_id]->miner_count)
+		return true;
 	avalon->works[avalon->queued++] = work;
 	if (avalon->queued == avalon_info[avalon->device_id]->miner_count)
 		return true;

