commit 9758bb28bfc49fcddd6753b1fea063c9c89ba28b
Author: vtarasov <vtarasov@c6295689-39f2-0310-b995-f0e70906c6a9>
Date:   Thu Apr 21 16:14:36 2011 +0000

    pkcs11: copy&past issue in r5356
    
    
    git-svn-id: https://www.opensc-project.org/svnp/opensc/trunk@5382 c6295689-39f2-0310-b995-f0e70906c6a9

diff --git a/src/pkcs11/framework-pkcs15.c b/src/pkcs11/framework-pkcs15.c
index 8b644012..6d5d1c0a 100644
--- a/src/pkcs11/framework-pkcs15.c
+++ b/src/pkcs11/framework-pkcs15.c
@@ -1924,10 +1924,11 @@ static CK_RV pkcs15_gen_keypair(struct sc_pkcs11_card *p11card,
 		&keytype, NULL);
 	if (rv != CKR_OK && pMechanism->mechanism == CKM_RSA_PKCS_KEY_PAIR_GEN)
 		keytype = CKK_RSA;
-	if (rv != CKR_OK && pMechanism->mechanism == CKM_EC_KEY_PAIR_GEN)
+	else if (rv != CKR_OK && pMechanism->mechanism == CKM_EC_KEY_PAIR_GEN)
 		keytype = CKK_EC;
 	else if (rv != CKR_OK)
 		goto kpgen_done;
+
 	if (keytype == CKK_GOSTR3410)   {
 		keygen_args.prkey_args.key.algorithm = SC_ALGORITHM_GOSTR3410;
 		pub_args.key.algorithm               = SC_ALGORITHM_GOSTR3410;

