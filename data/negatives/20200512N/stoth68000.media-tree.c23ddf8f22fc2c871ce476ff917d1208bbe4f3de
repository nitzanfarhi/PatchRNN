commit c23ddf8f22fc2c871ce476ff917d1208bbe4f3de
Author: Stephen Hemminger <shemminger@linux-foundation.org>
Date:   Thu Sep 3 06:16:25 2009 +0000

    sky2: only enable Vaux if capable of wakeup
    
    While perusing vendor driver, I saw that it did not enable the Vaux
    power unless device was able to wake from lan for D3cold.
    This might help for Rene's power issue.
    
    Signed-off-by: Stephen Hemminger <shemminger@vyatta.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/sky2.c b/drivers/net/sky2.c
index d1f3b46a2b08..bab591b418df 100644
--- a/drivers/net/sky2.c
+++ b/drivers/net/sky2.c
@@ -272,8 +272,9 @@ static void sky2_power_aux(struct sky2_hw *hw)
 			    Y2_CLK_GAT_LNK1_DIS | Y2_PCI_CLK_LNK2_DIS |
 			    Y2_COR_CLK_LNK2_DIS | Y2_CLK_GAT_LNK2_DIS);
 
-	/* switch power to VAUX */
-	if (sky2_read32(hw, B0_CTST) & Y2_VAUX_AVAIL)
+	/* switch power to VAUX if supported and PME from D3cold */
+	if ( (sky2_read32(hw, B0_CTST) & Y2_VAUX_AVAIL) &&
+	     pci_pme_capable(hw->pdev, PCI_D3cold))
 		sky2_write8(hw, B0_POWER_CTRL,
 			    (PC_VAUX_ENA | PC_VCC_ENA |
 			     PC_VAUX_ON | PC_VCC_OFF));

