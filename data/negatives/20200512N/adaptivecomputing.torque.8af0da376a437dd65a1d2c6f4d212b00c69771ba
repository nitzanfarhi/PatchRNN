commit 8af0da376a437dd65a1d2c6f4d212b00c69771ba
Author: Chad Vizino <cvizino@adaptivecomputing.com>
Date:   Wed Sep 14 08:33:53 2016 -0600

    Fix unit test.

diff --git a/src/test/mom_hierarchy_handler/scaffolding.c b/src/test/mom_hierarchy_handler/scaffolding.c
index 87c8c5ac7..18f86ec07 100644
--- a/src/test/mom_hierarchy_handler/scaffolding.c
+++ b/src/test/mom_hierarchy_handler/scaffolding.c
@@ -343,10 +343,10 @@ int insert_node(all_nodes *an, struct pbsnode *pnode)
 
 int remove_node(all_nodes *an, struct pbsnode *pnode)
   {
-  if ((an == NULL) || (pnode == NULL) || (pnode->nd_name == NULL)) return 0;
+  if ((an == NULL) || (pnode == NULL) || (pnode->get_name() == NULL)) return 0;
 
   an->lock();
-  an->remove(pnode->nd_name);
+  an->remove(pnode->get_name());
   an->unlock();
   return(PBSE_NONE);
   }
diff --git a/src/test/mom_hierarchy_handler/test_uut.c b/src/test/mom_hierarchy_handler/test_uut.c
index 734d52ce5..7a8f1715c 100644
--- a/src/test/mom_hierarchy_handler/test_uut.c
+++ b/src/test/mom_hierarchy_handler/test_uut.c
@@ -57,21 +57,19 @@ END_TEST
 
 START_TEST(test_checkAndSendHierarchy)
   {
-  pbsnode *node = NULL;
+  u_long pul = 0;
+  pbsnode node("foo", &pul, true);
 
   // first, remove node from allnodes (from previous test)
-  node = (pbsnode *)calloc(1, sizeof(pbsnode));
-  fail_unless(node != NULL);
-  node->nd_name = (char *)"foo";
   allnodes.unlock();
-  remove_node(&allnodes, node);
+  remove_node(&allnodes, &node);
 
   // insert node into allnodes
-  node->nd_state = INUSE_DOWN|INUSE_OFFLINE|INUSE_NOHIERARCHY;
-  insert_node(&allnodes, node);
+  node.nd_state = INUSE_DOWN|INUSE_OFFLINE|INUSE_NOHIERARCHY;
+  insert_node(&allnodes, &node);
 
   hierarchy_handler.checkAndSendHierarchy(false);
-  fail_unless(node->nd_state == INUSE_DOWN);
+  fail_unless(node.nd_state == INUSE_DOWN);
   }
 END_TEST
 

