commit 8bc506e25825620c356a61e0db8825b669409159
Author: Yukihiro Matsumoto <matz@ruby-lang.org>
Date:   Tue Jun 12 23:39:27 2012 +0900

    a bug in contant reference from modules

diff --git a/src/variable.c b/src/variable.c
index 33cd6ba1..b8957fb6 100644
--- a/src/variable.c
+++ b/src/variable.c
@@ -235,6 +235,7 @@ const_get(mrb_state *mrb, struct RClass *base, mrb_sym sym)
   khiter_t k;
   mrb_sym cm = mrb_intern(mrb, "const_missing");
 
+ L_RETRY:
   while (c) {
     if (c->iv) {
       h = c->iv;
@@ -250,6 +251,10 @@ const_get(mrb_state *mrb, struct RClass *base, mrb_sym sym)
     c = c->super;
   }
 
+  if (base->tt == MRB_TT_MODULE) {
+    c = base = mrb->object_class;
+    goto L_RETRY;
+  }
   mrb_raise(mrb, E_NAME_ERROR, "uninitialized constant %s",
             mrb_sym2name(mrb, sym));
   /* not reached */

