commit 6f391880bb4fb7cbb1d8c44553fa67527b00f115
Author: bcook <>
Date:   Wed Sep 14 11:34:37 2016 +0000

    Set callbacks on the right tls ctx on accept.
    
    From Tobias Pape

diff --git a/src/lib/libtls/tls_server.c b/src/lib/libtls/tls_server.c
index fd352a8a9..fbd726f33 100644
--- a/src/lib/libtls/tls_server.c
+++ b/src/lib/libtls/tls_server.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: tls_server.c,v 1.27 2016/09/04 13:20:56 jsing Exp $ */
+/* $OpenBSD: tls_server.c,v 1.28 2016/09/14 11:34:37 bcook Exp $ */
 /*
  * Copyright (c) 2014 Joel Sing <jsing@openbsd.org>
  *
@@ -351,7 +351,7 @@ tls_accept_cbs(struct tls *ctx, struct tls **cctx,
 	if ((conn_ctx = tls_accept_common(ctx)) == NULL)
 		goto err;
 
-	if (tls_set_cbs(ctx, read_cb, write_cb, cb_arg) != 0) {
+	if (tls_set_cbs(conn_ctx, read_cb, write_cb, cb_arg) != 0) {
 		tls_set_errorx(ctx, "callback registration failure");
 		goto err;
 	}

