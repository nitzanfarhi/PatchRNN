commit eee99eb3e8f4481ee5e669e60a0fd6be891af5ac
Author: Baptiste Coudurier <baptiste.coudurier@gmail.com>
Date:   Sun Feb 1 22:02:57 2009 +0000

    return eof/error if only ffm header has been written, should fix #815
    
    Originally committed as revision 16924 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavformat/ffmdec.c b/libavformat/ffmdec.c
index 03b7bd82f..9951d756e 100644
--- a/libavformat/ffmdec.c
+++ b/libavformat/ffmdec.c
@@ -359,6 +359,9 @@ static int ffm_read_packet(AVFormatContext *s, AVPacket *pkt)
     FFMContext *ffm = s->priv_data;
     int duration;
 
+    if (url_fsize(s->pb) == FFM_PACKET_SIZE)
+        return -1;
+
     switch(ffm->read_state) {
     case READ_HEADER:
         if (!ffm_is_avail_data(s, FRAME_HEADER_SIZE+4)) {

