commit 9d25d4db81833029d30b7b03cc1000cbbe09e192
Author: Hugh Dickins <hugh@veritas.com>
Date:   Mon Jul 21 18:41:26 2008 +0100

    x86: BUILD_IRQ say .text to avoid .data.percpu
    
    When I edit the x86_64 Makefile to -fno-unit-at-a-time, bootup panics
    on 0xCCs in IRQ0x3e_interrupt(): IRQ0x20_interrupt etc. have got linked
    into .data.percpu.  Perhaps there are other ways of triggering that:
    specify ".text" in the BUILD_IRQ() macro for safety.
    
    I've been using -fno-unit-at-a-time (to lessen inlining, for easier
    debugging) for a long time.
    
    Signed-off-by: Hugh Dickins <hugh@veritas.com>
    Cc: Mike Travis <travis@sgi.com>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/arch/x86/kernel/irqinit_64.c b/arch/x86/kernel/irqinit_64.c
index 0373e88de95a..9414125f19ce 100644
--- a/arch/x86/kernel/irqinit_64.c
+++ b/arch/x86/kernel/irqinit_64.c
@@ -43,7 +43,7 @@
 
 #define BUILD_IRQ(nr)				\
 	asmlinkage void IRQ_NAME(nr);		\
-	asm("\n.p2align\n"			\
+	asm("\n.text\n.p2align\n"		\
 	    "IRQ" #nr "_interrupt:\n\t"		\
 	    "push $~(" #nr ") ; "		\
 	    "jmp common_interrupt");

