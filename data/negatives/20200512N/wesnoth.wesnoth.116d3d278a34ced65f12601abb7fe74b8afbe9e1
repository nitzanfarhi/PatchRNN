commit 116d3d278a34ced65f12601abb7fe74b8afbe9e1
Author: Gregory Shikhman <cornmander@cornmander.com>
Date:   Wed Jul 15 02:02:07 2009 +0000

    Added commandline parameter '--screenshoot <map>'
    
    to take screenshots of maps without starting all of wesnoth. Actual
    implementation still stubbed.

diff --git a/src/game.cpp b/src/game.cpp
index 4c2115b973..a6fdc117c7 100644
--- a/src/game.cpp
+++ b/src/game.cpp
@@ -135,6 +135,7 @@ public:
 	bool init_language();
 	bool play_test();
 	bool play_multiplayer_mode();
+	bool play_screenshot_mode();
 
 	void reload_changed_game_config();
 
@@ -198,7 +199,8 @@ private:
 
 	std::string test_scenario_;
 
-	bool test_mode_, multiplayer_mode_, no_gui_;
+	bool test_mode_, multiplayer_mode_, no_gui_, screenshot_mode_;
+	std::string screenshot_map_;
 	int force_bpp_;
 
 	config game_config_;
@@ -243,6 +245,7 @@ game_controller::game_controller(int argc, char** argv) :
 	test_mode_(false),
 	multiplayer_mode_(false),
 	no_gui_(false),
+	screenshot_mode_(false),
 	force_bpp_(-1),
 	game_config_(),
 	old_defines_map_(),
@@ -340,6 +343,15 @@ game_controller::game_controller(int argc, char** argv) :
 			no_gui_ = true;
 			no_sound = true;
 			preferences::disable_preferences_save();
+		} else if(val == "--screenshot") {
+			if(arg_+1 != argc_) {
+				++arg_;
+				screenshot_map_ = argv_[arg_];
+				no_gui_ = true;
+				no_sound = true;
+				screenshot_mode_ = true;
+				preferences::disable_preferences_save();
+			}
 		} else if(val == "--smallgui") {
 			game_config::small_gui = true;
 		} else if(val == "--config-dir") {
@@ -570,8 +582,8 @@ bool game_controller::detect_video_settings()
 bool game_controller::init_video()
 {
 	if(no_gui_) {
-		if(!multiplayer_mode_) {
-			std::cerr << "--nogui flag is only valid with --multiplayer flag\n";
+		if( !(multiplayer_mode_ || screenshot_mode_) ) {
+			std::cerr << "--nogui flag is only valid with --multiplayer flag or --screenshot flag\n";
 			return false;
 		}
 		video_.make_fake();
@@ -683,6 +695,15 @@ bool game_controller::play_test()
 	return false;
 }
 
+bool game_controller::play_screenshot_mode()
+{
+	if(!screenshot_mode_) {
+		return true;
+	}
+
+	return false;
+}
+
 bool game_controller::play_multiplayer_mode()
 {
 	state_ = game_state();
@@ -1975,6 +1996,10 @@ static int do_gameloop(int argc, char** argv)
 			return 0;
 		}
 
+		if(game.play_screenshot_mode() == false) {
+			return 0;
+		}
+
 		recorder.clear();
 
 		//Start directly a campaign

