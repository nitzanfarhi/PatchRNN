commit 4a76ef036ac415c28d1adbaf2b7a74040b84d4c2
Author: Nick Piggin <npiggin@suse.de>
Date:   Wed Feb 14 12:36:32 2007 +0100

    [PATCH] mincore: fill in results properly
    
    Paper bag time. Thanks to Randy for noticing that I didn't actually assign
    'present' to anything.
    
    Unfortunately my original patch passed the few simple test cases I gave it,
    purely by coincidence.
    
    Signed-off-by: Nick Piggin <npiggin@suse.de>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/mm/mincore.c b/mm/mincore.c
index 9780097e3812..9c1d0a426e95 100644
--- a/mm/mincore.c
+++ b/mm/mincore.c
@@ -125,6 +125,8 @@ static long do_mincore(unsigned long addr, unsigned char *vec, unsigned long pag
 #endif
 			}
 		}
+
+		vec[i] = present;
 	}
 	pte_unmap_unlock(ptep-1, ptl);
 
@@ -135,6 +137,9 @@ static long do_mincore(unsigned long addr, unsigned char *vec, unsigned long pag
 		pgoff = linear_page_index(vma, addr);
 		for (i = 0; i < nr; i++, pgoff++)
 			vec[i] = mincore_page(vma->vm_file->f_mapping, pgoff);
+	} else {
+		for (i = 0; i < nr; i++)
+			vec[i] = 0;
 	}
 
 	return nr;

