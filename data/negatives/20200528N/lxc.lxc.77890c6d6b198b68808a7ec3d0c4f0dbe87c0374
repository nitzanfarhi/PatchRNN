commit 77890c6d6b198b68808a7ec3d0c4f0dbe87c0374
Author: Sven Wegener <sven.wegener@stealer.net>
Date:   Mon May 23 23:12:24 2011 +0200

    Check for existing ptmx symlink
    
    It's OK, if /dev/ptmx points to /dev/pts/ptmx via a symlink.
    
    Signed-off-by: Sven Wegener <sven.wegener@stealer.net>
    Signed-off-by: Daniel Lezcano <dlezcano@fr.ibm.com>

diff --git a/src/lxc/conf.c b/src/lxc/conf.c
index 62b3727e..483d3756 100644
--- a/src/lxc/conf.c
+++ b/src/lxc/conf.c
@@ -752,6 +752,8 @@ int setup_pivot_root(const struct lxc_rootfs *rootfs)
 
 static int setup_pts(int pts)
 {
+	char target[PATH_MAX];
+
 	if (!pts)
 		return 0;
 
@@ -773,6 +775,9 @@ static int setup_pts(int pts)
 		return -1;
 	}
 
+	if (realpath("/dev/ptmx", target) && !strcmp(target, "/dev/pts/ptmx"))
+		goto out;
+
 	/* fallback here, /dev/pts/ptmx exists just mount bind */
 	if (mount("/dev/pts/ptmx", "/dev/ptmx", "none", MS_BIND, 0)) {
 		SYSERROR("mount failed '/dev/pts/ptmx'->'/dev/ptmx'");

