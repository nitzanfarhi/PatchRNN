commit 19167bfd8ae72ceeb41930343227bf8f5fb19a66
Author: Tudor Ambarus <tudor.ambarus@freescale.com>
Date:   Fri Oct 24 18:13:37 2014 +0300

    crypto: caam - fix output sequence contiguity check
    
    This patch fixes the assumption that output sequence is not contiguous
    when input sequence is not contiguous and in-place encryption is done.
    Output sequence does not need to be contiguous with associated data.
    
    Signed-off-by: Tudor Ambarus <tudor.ambarus@freescale.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

diff --git a/drivers/crypto/caam/caamalg.c b/drivers/crypto/caam/caamalg.c
index c17154c32031..36434d9eefad 100644
--- a/drivers/crypto/caam/caamalg.c
+++ b/drivers/crypto/caam/caamalg.c
@@ -2185,7 +2185,8 @@ static struct aead_edesc *aead_giv_edesc_alloc(struct aead_givcrypt_request
 		assoc_nents = assoc_nents ? : 1;
 		src_nents = src_nents ? : 1;
 		sec4_sg_len += assoc_nents + 1 + src_nents;
-		if (likely(req->src == req->dst))
+		if (req->src == req->dst &&
+		    (src_nents || iv_dma + ivsize != sg_dma_address(req->src)))
 			contig &= ~GIV_DST_CONTIG;
 	}
 

