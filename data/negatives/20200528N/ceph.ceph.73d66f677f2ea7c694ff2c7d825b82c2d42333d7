commit 73d66f677f2ea7c694ff2c7d825b82c2d42333d7
Author: Greg Farnum <gregory.farnum@dreamhost.com>
Date:   Wed Jul 20 13:15:33 2011 -0700

    mds: cinode: Add a little debugging and fix an output
    
    Signed-off-by: Greg Farnum <gregory.farnum@dreamhost.com>

diff --git a/src/mds/CInode.cc b/src/mds/CInode.cc
index 2299da24a1..c2ee8d322f 100644
--- a/src/mds/CInode.cc
+++ b/src/mds/CInode.cc
@@ -1933,9 +1933,11 @@ void CInode::add_waiter(uint64_t tag, Context *c)
   //  make sure its not the inode that is explicitly ambiguous|freezing|frozen
   if (((tag & WAIT_SINGLEAUTH) && !state_test(STATE_AMBIGUOUSAUTH)) ||
       ((tag & WAIT_UNFREEZE) && !is_frozen_inode() && !is_freezing_inode())) {
+    dout(15) << "passing waiter up tree" << dendl;
     parent->dir->add_waiter(tag, c);
     return;
   }
+  dout(15) << "taking waiter here" << dendl;
   MDSCacheObject::add_waiter(tag, c);
 }
 
@@ -2018,7 +2020,7 @@ void CInode::auth_unpin(void *by)
   assert(auth_pins >= 0);
 
   if (parent)
-    parent->adjust_nested_auth_pins(-1, -1, this);
+    parent->adjust_nested_auth_pins(-1, -1, by);
 
   if (is_freezing_inode() &&
       auth_pins == auth_pin_freeze_allowance) {

