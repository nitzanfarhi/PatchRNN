commit 45ec267160307ce2ca7494d942589ba222b29479
Author: Ed Maste <emaste@freebsd.org>
Date:   Tue May 7 10:06:12 2013 -0400

    host-libusb: Correct test for USB packet state
    
    USB_RET_ASYNC is -6, so inflight was always false.
    
    Signed-off-by: Ed Maste <emaste@freebsd.org>
    Cc: qemu-stable@nongnu.org
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

diff --git a/hw/usb/host-libusb.c b/hw/usb/host-libusb.c
index f3de4591fd..3a582c526d 100644
--- a/hw/usb/host-libusb.c
+++ b/hw/usb/host-libusb.c
@@ -385,7 +385,7 @@ out:
 static void usb_host_req_abort(USBHostRequest *r)
 {
     USBHostDevice  *s = r->host;
-    bool inflight = (r->p && r->p->state == USB_RET_ASYNC);
+    bool inflight = (r->p && r->p->state == USB_PACKET_ASYNC);
 
     if (inflight) {
         r->p->status = USB_RET_NODEV;

