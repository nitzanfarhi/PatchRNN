commit e8817e7b0e0c355690d34bb499d50373137d240f
Author: Markus Armbruster <armbru@redhat.com>
Date:   Fri May 16 11:00:08 2014 +0200

    blockdev: Don't use qerror_report_err() in drive_init()
    
    qerror_report_err() is a transitional interface to help with
    converting existing HMP commands to QMP.  It should not be used
    elsewhere.
    
    drive_init() is not meant to be used by QMP commands.  It uses both
    qerror_report_err() and error_report().  Convert the former to the
    latter.
    
    Signed-off-by: Markus Armbruster <armbru@redhat.com>
    Reviewed-by: Eric Blake <eblake@redhat.com>
    Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>

diff --git a/blockdev.c b/blockdev.c
index 9a9bdec7da..264b07ca4e 100644
--- a/blockdev.c
+++ b/blockdev.c
@@ -730,7 +730,7 @@ DriveInfo *drive_init(QemuOpts *all_opts, BlockInterfaceType block_default_type)
                                    &error_abort);
     qemu_opts_absorb_qdict(legacy_opts, bs_opts, &local_err);
     if (local_err) {
-        qerror_report_err(local_err);
+        error_report("%s", error_get_pretty(local_err));
         error_free(local_err);
         goto fail;
     }
@@ -942,7 +942,7 @@ DriveInfo *drive_init(QemuOpts *all_opts, BlockInterfaceType block_default_type)
     dinfo = blockdev_init(filename, bs_opts, &local_err);
     if (dinfo == NULL) {
         if (local_err) {
-            qerror_report_err(local_err);
+            error_report("%s", error_get_pretty(local_err));
             error_free(local_err);
         }
         goto fail;

