commit 501fb30403c35d2d1f062a842660f6fead3841eb
Author: Paul Wouters <paul@xelerance.com>
Date:   Thu Nov 6 12:52:34 2008 -0500

    Fix for setting up connections using two different source IP's to the
    same single destination IP using separate tunnels. Patch by Avesh Agarwal

diff --git a/programs/pluto/connections.c b/programs/pluto/connections.c
index 38d5ba69a..8a2d0649b 100644
--- a/programs/pluto/connections.c
+++ b/programs/pluto/connections.c
@@ -2091,6 +2091,14 @@ route_owner(struct connection *c
 		    continue;
 		if (src->that.port != srd->that.port)
 		    continue;
+
+		/* with old eroutes/routing, we could not do this. This
+		 * allows a host with two IP's to talk to 1 oter host
+		 * with both IP's using two different tunnels.
+		 */
+		if (!sameaddr(&src->this.host_addr, &srd->this.host_addr))
+			continue;
+
 		passert(oriented(*d));
 		if (srd->routing > best_routing)
 		{

