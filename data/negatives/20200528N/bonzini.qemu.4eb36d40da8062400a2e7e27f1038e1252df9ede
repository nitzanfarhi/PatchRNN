commit 4eb36d40da8062400a2e7e27f1038e1252df9ede
Author: Anthony Liguori <aliguori@us.ibm.com>
Date:   Sat Jul 23 16:14:37 2011 -0500

    guest-agent: only enable FSFREEZE when it's supported by the kernel
    
    Signed-off-by: Anthony Liguori <aliguori@us.ibm.com>

diff --git a/qga/guest-agent-commands.c b/qga/guest-agent-commands.c
index 624972e84c..30c406848f 100644
--- a/qga/guest-agent-commands.c
+++ b/qga/guest-agent-commands.c
@@ -10,15 +10,17 @@
  * See the COPYING file in the top-level directory.
  */
 
-#if defined(__linux__)
-#define CONFIG_FSFREEZE
-#endif
-
 #include <glib.h>
-#if defined(CONFIG_FSFREEZE)
+
+#if defined(__linux__)
 #include <mntent.h>
 #include <linux/fs.h>
+
+#if defined(__linux__) && defined(FIFREEZE)
+#define CONFIG_FSFREEZE
 #endif
+#endif
+
 #include <sys/types.h>
 #include <sys/ioctl.h>
 #include "qga/guest-agent-core.h"

