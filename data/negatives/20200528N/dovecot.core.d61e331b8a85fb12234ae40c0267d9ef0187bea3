commit d61e331b8a85fb12234ae40c0267d9ef0187bea3
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Oct 22 19:12:27 2009 -0400

    ssl-params: When generating parameters, run the process with priority +15.
    
    --HG--
    branch : HEAD

diff --git a/src/ssl-params/ssl-params.c b/src/ssl-params/ssl-params.c
index e6154a1d7..1e0161417 100644
--- a/src/ssl-params/ssl-params.c
+++ b/src/ssl-params/ssl-params.c
@@ -11,12 +11,18 @@
 
 #include <stdio.h>
 #include <stdlib.h>
-#include <unistd.h>
 #include <fcntl.h>
 #include <sys/stat.h>
+#ifdef HAVE_SYS_TIME_H
+#  include <sys/time.h>
+#endif
+#ifdef HAVE_SYS_RESOURCE_H
+#  include <sys/resource.h>
+#endif
 
 #define MAX_PARAM_FILE_SIZE 1024
 #define SSL_BUILD_PARAM_TIMEOUT_SECS (60*30)
+#define SSL_PARAMS_PRIORITY 15
 
 struct ssl_params {
 	char *path;
@@ -35,6 +41,11 @@ static void ssl_params_if_unchanged(const char *path, time_t mtime)
 	mode_t old_mask;
 	int fd, ret;
 
+#ifdef HAVE_SETPRIORITY
+	if (setpriority(PRIO_PROCESS, 0, SSL_PARAMS_PRIORITY) < 0)
+		i_error("setpriority(%d) failed: %m", SSL_PARAMS_PRIORITY);
+#endif
+
 	temp_path = t_strconcat(path, ".tmp", NULL);
 
 	old_mask = umask(0);

