commit 728bb4d02e723966319981631649b5a4f6822f7e
Author: Matthew Leeds <matthew.leeds@endlessm.com>
Date:   Wed Feb 7 13:30:29 2018 -0800

    info: Show collection ID if available
    
    If flatpak is compiled with P2P support and the commit in question has a
    collection ID in its metadata, show it.
    
    Closes: #1351
    Approved by: alexlarsson

diff --git a/app/flatpak-builtins-info.c b/app/flatpak-builtins-info.c
index cab70306..d611a232 100644
--- a/app/flatpak-builtins-info.c
+++ b/app/flatpak-builtins-info.c
@@ -174,12 +174,14 @@ flatpak_builtin_info (int argc, char **argv, GCancellable *cancellable, GError *
   if (friendly)
     {
       g_autoptr(GVariant) commit_v = NULL;
+      g_autoptr(GVariant) commit_metadata = NULL;
       guint64 timestamp;
       g_autofree char *formatted_timestamp = NULL;
       const gchar *subject = NULL;
       const gchar *body = NULL;
       g_autofree char *parent = NULL;
       const char *latest;
+      const char *collection_id = NULL;
 
       latest = flatpak_dir_read_latest (dir, origin, ref, NULL, NULL, NULL);
       if (latest == NULL)
@@ -192,6 +194,12 @@ flatpak_builtin_info (int argc, char **argv, GCancellable *cancellable, GError *
           parent = ostree_commit_get_parent (commit_v);
           timestamp = ostree_commit_get_timestamp (commit_v);
           formatted_timestamp = format_timestamp (timestamp);
+
+          commit_metadata = g_variant_get_child_value (commit_v, 0);
+
+#ifdef FLATPAK_ENABLE_P2P
+          g_variant_lookup (commit_metadata, "ostree.collection-binding", "&s", &collection_id);
+#endif
         }
 
       g_print ("%s%s%s %s\n", on, _("Ref:"), off, ref);
@@ -199,6 +207,8 @@ flatpak_builtin_info (int argc, char **argv, GCancellable *cancellable, GError *
       g_print ("%s%s%s %s\n", on, _("Arch:"), off, parts[2]);
       g_print ("%s%s%s %s\n", on, _("Branch:"), off, parts[3]);
       g_print ("%s%s%s %s\n", on, _("Origin:"), off, origin ? origin : "-");
+      if (collection_id)
+        g_print ("%s%s%s %s\n", on, _("Collection ID:"), off, collection_id);
       if (formatted_timestamp)
         g_print ("%s%s%s %s\n", on, _("Date:"), off, formatted_timestamp);
       if (subject)

