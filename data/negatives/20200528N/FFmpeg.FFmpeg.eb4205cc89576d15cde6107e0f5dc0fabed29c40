commit eb4205cc89576d15cde6107e0f5dc0fabed29c40
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Wed Oct 23 10:14:05 2013 +0200

    swscale/utils: check mprotect() return code
    
    Found-by: wm4
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libswscale/utils.c b/libswscale/utils.c
index 9b2b5e9279..0743ee3531 100644
--- a/libswscale/utils.c
+++ b/libswscale/utils.c
@@ -1430,8 +1430,11 @@ av_cold int sws_init_context(SwsContext *c, SwsFilter *srcFilter,
                                 c->hChrFilter, (uint32_t*)c->hChrFilterPos, 4);
 
 #if USE_MMAP
-            mprotect(c->lumMmxextFilterCode, c->lumMmxextFilterCodeSize, PROT_EXEC | PROT_READ);
-            mprotect(c->chrMmxextFilterCode, c->chrMmxextFilterCodeSize, PROT_EXEC | PROT_READ);
+            if (   mprotect(c->lumMmxextFilterCode, c->lumMmxextFilterCodeSize, PROT_EXEC | PROT_READ) == -1
+                || mprotect(c->chrMmxextFilterCode, c->chrMmxextFilterCodeSize, PROT_EXEC | PROT_READ) == -1) {
+                av_log(c, AV_LOG_ERROR, "mprotect failed, cannot use fast bilinear scaler\n");
+                goto fail;
+            }
 #endif
         } else
 #endif /* HAVE_MMXEXT_INLINE */

