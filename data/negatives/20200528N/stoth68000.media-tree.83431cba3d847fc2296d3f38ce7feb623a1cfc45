commit 83431cba3d847fc2296d3f38ce7feb623a1cfc45
Author: Jay Fenlason <fenlason@redhat.com>
Date:   Mon Oct 8 17:00:29 2007 -0400

    firewire: fw-cdev: reorder wakeup vs. spinlock
    
    Signed-off-by: Jay Fenlason <fenlason@redhat.com>
    
    Prompted by https://bugzilla.redhat.com/show_bug.cgi?id=323411
    
    Signed-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>

diff --git a/drivers/firewire/fw-cdev.c b/drivers/firewire/fw-cdev.c
index 290d9f036199..60f1a8924a95 100644
--- a/drivers/firewire/fw-cdev.c
+++ b/drivers/firewire/fw-cdev.c
@@ -143,11 +143,10 @@ static void queue_event(struct client *client, struct event *event,
 	event->v[1].size = size1;
 
 	spin_lock_irqsave(&client->lock, flags);
-
 	list_add_tail(&event->link, &client->event_list);
-	wake_up_interruptible(&client->wait);
-
 	spin_unlock_irqrestore(&client->lock, flags);
+
+	wake_up_interruptible(&client->wait);
 }
 
 static int

