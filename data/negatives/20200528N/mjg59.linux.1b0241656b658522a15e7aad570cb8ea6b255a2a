commit 1b0241656b658522a15e7aad570cb8ea6b255a2a
Author: Jiri Slaby <jirislaby@gmail.com>
Date:   Mon Jul 14 12:43:23 2008 +0200

    mac80211: tx, use dev_kfree_skb_any for beacon_get
    
    Use dev_kfree_skb_any(); instead of dev_kfree_skb();, since
    ieee80211_beacon_get function might be called from atomic.
    (It's in a fail path.)
    
    Signed-off-by: Jiri Slaby <jirislaby@gmail.com>
    Cc: Johannes Berg <johannes@sipsolutions.net>
    Cc: Michael Wu <flamingice@sourmilk.net>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/mac80211/tx.c b/net/mac80211/tx.c
index 0fbadd8b983c..7e99d1615192 100644
--- a/net/mac80211/tx.c
+++ b/net/mac80211/tx.c
@@ -1931,7 +1931,7 @@ struct sk_buff *ieee80211_beacon_get(struct ieee80211_hw *hw,
 			       "no rate found\n",
 			       wiphy_name(local->hw.wiphy));
 		}
-		dev_kfree_skb(skb);
+		dev_kfree_skb_any(skb);
 		skb = NULL;
 		goto out;
 	}

