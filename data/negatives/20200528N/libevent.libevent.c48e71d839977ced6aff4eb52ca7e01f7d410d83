commit c48e71d839977ced6aff4eb52ca7e01f7d410d83
Author: Niels Provos <provos@gmail.com>
Date:   Sat Mar 8 16:44:51 2003 +0000

    oneshot means that its removed from the kernel list already
    
    
    svn:r51

diff --git a/kqueue.c b/kqueue.c
index 9e48b704..a61a6057 100644
--- a/kqueue.c
+++ b/kqueue.c
@@ -248,8 +248,10 @@ kq_dispatch(void *arg, struct timeval *tv)
 		if (!which)
 			continue;
 
-		if (!(ev->ev_events & EV_PERSIST))
+		if (!(ev->ev_events & EV_PERSIST)) {
+			ev->ev_flags &= ~EVLIST_X_KQINKERNEL;
 			event_del(ev);
+		}
 
 		event_active(ev, which,
 		    ev->ev_events & EV_SIGNAL ? events[i].data : 1);

