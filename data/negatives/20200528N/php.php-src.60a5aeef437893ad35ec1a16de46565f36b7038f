commit 60a5aeef437893ad35ec1a16de46565f36b7038f
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Tue Dec 10 20:16:30 2002 +0000

    Fixed a few compile warnings and one compile error.

diff --git a/main/php_main.h b/main/php_main.h
index 08c091e3b9..ca054c6348 100644
--- a/main/php_main.h
+++ b/main/php_main.h
@@ -35,6 +35,7 @@ PHPAPI int php_module_startup(sapi_module_struct *sf, zend_module_entry *additio
 PHPAPI void php_module_shutdown(TSRMLS_D);
 PHPAPI void php_module_shutdown_for_exec(void);
 PHPAPI int php_module_shutdown_wrapper(sapi_module_struct *sapi_globals);
+PHPAPI int php_request_startup_for_hook(TSRMLS_D);
 
 PHPAPI int php_startup_extensions(zend_module_entry **ptr, int count);
 
diff --git a/sapi/apache_hooks/mod_php4.c b/sapi/apache_hooks/mod_php4.c
index aea466374c..812493d187 100644
--- a/sapi/apache_hooks/mod_php4.c
+++ b/sapi/apache_hooks/mod_php4.c
@@ -1087,7 +1087,6 @@ static CONST_PREFIX char *php_set_post_read_handler_code(cmd_parms *cmd, php_per
 
 static CONST_PREFIX char *php_set_require(cmd_parms *cmd, void *dummy, char *arg1)
 {
-	php_per_server_config *conf;
 	return php_set_server_handler(cmd->server, arg1, 0, AP_HANDLER_TYPE_FILE);
 }
 /* }}} */
diff --git a/sapi/apache_hooks/php_apache.c b/sapi/apache_hooks/php_apache.c
index 79757bff9a..e8006e2f0d 100644
--- a/sapi/apache_hooks/php_apache.c
+++ b/sapi/apache_hooks/php_apache.c
@@ -132,10 +132,12 @@ static request_rec *get_apache_request(pval *z TSRMLS_DC)
 /* {{{ php_apache_request_new(request_rec *r)
  * create a new zval-instance for ApacheRequest that wraps request_rec
  */
-zval *php_apache_request_new(request_rec *r TSRMLS_DC)
+zval *php_apache_request_new(request_rec *r)
 {
 	zval *req;
 	zval *addr;
+	
+	TSRMLS_FETCH();
 
 	MAKE_STD_ZVAL(addr);
 	Z_TYPE_P(addr) = IS_LONG;
diff --git a/sapi/apache_hooks/sapi_apache.c b/sapi/apache_hooks/sapi_apache.c
index 5991ad8d39..7e7a1acd60 100644
--- a/sapi/apache_hooks/sapi_apache.c
+++ b/sapi/apache_hooks/sapi_apache.c
@@ -105,8 +105,8 @@ int apache_php_module_hook(request_rec *r, php_handler *handler, zval **ret TSRM
                 ZVAL_STRING(method, tmp +2, 1);
                 *tmp = ':';
                 call_user_function_ex(EG(function_table), &class, method, ret, 0, NULL, 0, NULL TSRMLS_CC);
-                zval_dtor(&class);
-                zval_dtor(&method);
+                zval_dtor(class);
+                zval_dtor(method);
             }
             else {
                 php_error(E_ERROR, "Unable to call %s - not a Class::Method\n", handler->name);
@@ -118,7 +118,7 @@ int apache_php_module_hook(request_rec *r, php_handler *handler, zval **ret TSRM
             assert(0);
             break;
     }
-	zval_dtor(&req);
+	zval_dtor(req);
 	AP(in_request) = 0;
 
 	return OK;

