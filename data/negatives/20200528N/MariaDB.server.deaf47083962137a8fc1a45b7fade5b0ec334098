commit deaf47083962137a8fc1a45b7fade5b0ec334098
Author: svoj@mysql.com/april.(none) <>
Date:   Fri Sep 29 21:36:17 2006 +0500

    Fixed that max_zfile_size was incorrectly calculated on big-endian boxes.
    Was introduced with patch for bug#21675.

diff --git a/sql/ha_archive.cc b/sql/ha_archive.cc
index 3a30f404a40..bc3c819c4ed 100644
--- a/sql/ha_archive.cc
+++ b/sql/ha_archive.cc
@@ -206,7 +206,17 @@ bool archive_db_init()
   else
   {
     zoffset_size= 2 << ((zlibCompileFlags() >> 6) & 3);
-    max_zfile_size= (z_off_t) (~(1 << (zoffset_size * 8 - 1)));
+    switch (sizeof(z_off_t)) {
+    case 2:
+      max_zfile_size= INT_MAX16;
+      break;
+    case 8:
+      max_zfile_size= LONGLONG_MAX;
+      break;
+    case 4:
+    default:
+      max_zfile_size= INT_MAX32;
+    }
     archive_inited= TRUE;
     DBUG_RETURN(FALSE);
   }

