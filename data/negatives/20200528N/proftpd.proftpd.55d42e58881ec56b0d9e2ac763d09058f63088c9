commit 55d42e58881ec56b0d9e2ac763d09058f63088c9
Author: castaglia <castaglia>
Date:   Tue Apr 13 16:39:01 2010 +0000

    Remove unused variables, and quell compiler warnings about "incompatible
    pointer types" on FreeBSD.

diff --git a/contrib/mod_sftp/utf8.c b/contrib/mod_sftp/utf8.c
index f9d8092b3..03da6306f 100644
--- a/contrib/mod_sftp/utf8.c
+++ b/contrib/mod_sftp/utf8.c
@@ -21,7 +21,7 @@
  * resulting executable, without including the source code for OpenSSL in the
  * source distribution.
  *
- * $Id: utf8.c,v 1.11 2010-04-13 15:35:55 castaglia Exp $
+ * $Id: utf8.c,v 1.12 2010-04-13 16:39:01 castaglia Exp $
  */
 
 #include "mod_sftp.h"
@@ -41,10 +41,9 @@ static const char *local_charset = NULL;
 static iconv_t decode_conv = (iconv_t) -1;
 static iconv_t encode_conv = (iconv_t) -1;
 
-static int utf8_convert(iconv_t conv, char *inbuf, size_t *inbuflen,
+static int utf8_convert(iconv_t conv, const char *inbuf, size_t *inbuflen,
     char *outbuf, size_t *outbuflen) {
 # ifdef HAVE_ICONV
-  char *start = inbuf;
 
   /* Reset the state machine before each conversion. */
   (void) iconv(conv, NULL, NULL, NULL, NULL);
@@ -54,7 +53,17 @@ static int utf8_convert(iconv_t conv, char *inbuf, size_t *inbuflen,
 
     pr_signals_handle();
 
+    /* Solaris/FreeBSD's iconv(3) takes a const char ** for the input buffer,
+     * whereas Linux/Mac OSX iconv(3) use char ** for the input buffer.
+     */
+#if defined(LINUX) || defined(DARWIN6) || defined(DARWIN7) || \
+    defined(DARWIN8) || defined(DARWIN9)
+ 
+    nconv = iconv(conv, (char **) &inbuf, inbuflen, &outbuf, outbuflen);
+#else
     nconv = iconv(conv, &inbuf, inbuflen, &outbuf, outbuflen);
+#endif
+
     if (nconv == (size_t) -1) {
       return -1;
     }
diff --git a/src/encode.c b/src/encode.c
index 5e0d6e83a..7862a5384 100644
--- a/src/encode.c
+++ b/src/encode.c
@@ -23,7 +23,7 @@
  */
 
 /* UTF8/charset encoding/decoding
- * $Id: encode.c,v 1.24 2010-04-13 15:35:55 castaglia Exp $
+ * $Id: encode.c,v 1.25 2010-04-13 16:39:01 castaglia Exp $
  */
 
 #include "conf.h"
@@ -51,7 +51,6 @@ static const char *trace_channel = "encode";
 static int str_convert(iconv_t conv, const char *inbuf, size_t *inbuflen,
     char *outbuf, size_t *outbuflen) {
 # ifdef HAVE_ICONV
-  char *start = (char *) inbuf;
 
   /* Reset the state machine before each conversion. */
   (void) iconv(conv, NULL, NULL, NULL, NULL);

