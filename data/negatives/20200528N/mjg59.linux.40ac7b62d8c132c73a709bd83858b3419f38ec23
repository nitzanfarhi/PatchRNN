commit 40ac7b62d8c132c73a709bd83858b3419f38ec23
Author: George Nassar <george.nassar@gmail.com>
Date:   Wed Oct 14 18:27:41 2009 -0500

    USB: rndis_host: debug info clobbered before it is logged
    
    The MTU throttle-down if a RNDIS device doesn't support a particular
    packet size is being incorrectly logged.  The attempted packet size is
    being clobbered before it gets logged.
    
    First patch; please inform if I'm doing this incorrectly.  Diff'd
    against latest official source as per the FAQ; forward port to current
    git version is straightforward.
    
    Signed-off-by: George Nassar <george.nassar@gmail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/net/usb/rndis_host.c b/drivers/net/usb/rndis_host.c
index 0caa8008c51c..f56dec6119c3 100644
--- a/drivers/net/usb/rndis_host.c
+++ b/drivers/net/usb/rndis_host.c
@@ -362,12 +362,12 @@ generic_rndis_bind(struct usbnet *dev, struct usb_interface *intf, int flags)
 			retval = -EINVAL;
 			goto halt_fail_and_release;
 		}
-		dev->hard_mtu = tmp;
-		net->mtu = dev->hard_mtu - net->hard_header_len;
 		dev_warn(&intf->dev,
 			 "dev can't take %u byte packets (max %u), "
 			 "adjusting MTU to %u\n",
-			 dev->hard_mtu, tmp, net->mtu);
+			 dev->hard_mtu, tmp, tmp - net->hard_header_len);
+		dev->hard_mtu = tmp;
+		net->mtu = dev->hard_mtu - net->hard_header_len;
 	}
 
 	/* REVISIT:  peripheral "alignment" request is ignored ... */

