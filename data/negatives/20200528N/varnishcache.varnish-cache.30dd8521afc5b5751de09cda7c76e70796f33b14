commit 30dd8521afc5b5751de09cda7c76e70796f33b14
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Wed Aug 26 11:12:48 2009 +0000

    Factor getdtablesize() out of close loop.
    
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@4210 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/mgt_child.c b/bin/varnishd/mgt_child.c
index c231e0525..3d4b2613f 100644
--- a/bin/varnishd/mgt_child.c
+++ b/bin/varnishd/mgt_child.c
@@ -235,7 +235,7 @@ start_child(struct cli *cli)
 	unsigned u;
 	char *p;
 	struct vev *e;
-	int i, cp[2];
+	int i, j, cp[2];
 
 	if (child_state != CH_STOPPED && child_state != CH_DIED)
 		return;
@@ -303,7 +303,8 @@ start_child(struct cli *cli)
 		/* Close anything we shouldn't know about */
 		closelog();
 		printf("Closed fds:");
-		for (i = STDERR_FILENO + 1; i < getdtablesize(); i++) {
+		j = getdtablesize();
+		for (i = STDERR_FILENO + 1; i < j; i++) {
 			if (vbit_test(fd_map, i))
 				continue;
 			if (close(i) == 0)
diff --git a/bin/varnishd/varnishd.c b/bin/varnishd/varnishd.c
index 3bddf544a..ba3876c2e 100644
--- a/bin/varnishd/varnishd.c
+++ b/bin/varnishd/varnishd.c
@@ -314,7 +314,8 @@ DebugStunt(void)
 	pipes[1][1] = 1;
 
 	/* close the rest */
-	for (i = 5; i < getdtablesize(); i++)
+	j = getdtablesize();
+	for (i = 5; i < j; i++)
 		(void)close(i);
 
 	pfd[0].fd = pipes[0][0];

