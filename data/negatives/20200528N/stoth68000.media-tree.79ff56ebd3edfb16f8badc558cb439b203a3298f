commit 79ff56ebd3edfb16f8badc558cb439b203a3298f
Author: Roland Dreier <rdreier@cisco.com>
Date:   Tue Dec 30 20:18:00 2008 -0800

    swiotlb: add missing __init annotations
    
    Impact: cleanup, reduce kernel size a bit
    
    The current kernel build warns:
    
        WARNING: vmlinux.o(.text+0x11458): Section mismatch in reference from the function swiotlb_alloc_boot() to the function .init.text:__alloc_bootmem_low()
        The function swiotlb_alloc_boot() references
        the function __init __alloc_bootmem_low().
        This is often because swiotlb_alloc_boot lacks a __init
        annotation or the annotation of __alloc_bootmem_low is wrong.
    
        WARNING: vmlinux.o(.text+0x1011f2): Section mismatch in reference from the function swiotlb_late_init_with_default_size() to the function .init.text:__alloc_bootmem_low()
        The function swiotlb_late_init_with_default_size() references
        the function __init __alloc_bootmem_low().
        This is often because swiotlb_late_init_with_default_size lacks a __init
        annotation or the annotation of __alloc_bootmem_low is wrong.
    
    and indeed the functions calling __alloc_bootmem_low() can be marked
    __init as well.
    
    Signed-off-by: Roland Dreier <rolandd@cisco.com>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/arch/x86/kernel/pci-swiotlb_64.c b/arch/x86/kernel/pci-swiotlb_64.c
index 242c3440687f..8cba3749a511 100644
--- a/arch/x86/kernel/pci-swiotlb_64.c
+++ b/arch/x86/kernel/pci-swiotlb_64.c
@@ -13,7 +13,7 @@
 
 int swiotlb __read_mostly;
 
-void *swiotlb_alloc_boot(size_t size, unsigned long nslabs)
+void * __init swiotlb_alloc_boot(size_t size, unsigned long nslabs)
 {
 	return alloc_bootmem_low_pages(size);
 }
diff --git a/lib/swiotlb.c b/lib/swiotlb.c
index fa2dc4e5f9ba..b6d0aae4fd31 100644
--- a/lib/swiotlb.c
+++ b/lib/swiotlb.c
@@ -116,7 +116,7 @@ setup_io_tlb_npages(char *str)
 __setup("swiotlb=", setup_io_tlb_npages);
 /* make io_tlb_overflow tunable too? */
 
-void * __weak swiotlb_alloc_boot(size_t size, unsigned long nslabs)
+void * __weak __init swiotlb_alloc_boot(size_t size, unsigned long nslabs)
 {
 	return alloc_bootmem_low_pages(size);
 }

