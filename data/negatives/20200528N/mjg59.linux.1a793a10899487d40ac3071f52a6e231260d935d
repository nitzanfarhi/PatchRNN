commit 1a793a10899487d40ac3071f52a6e231260d935d
Author: Rajkumar Kasirajan <rajkumar.kasirajan@stericsson.com>
Date:   Wed May 30 14:54:28 2012 +0530

    ab8500-fg: Use correct battery charge full design
    
    If battery is not identified while fg probe, mah_max_design gets
    initialized with unknown battery's charge full design. Reinitialize
    mah_max_design if battery is identified after fg probe.
    
    Signed-off-by: Rajkumar Kasirajan <rajkumar.kasirajan@stericsson.com>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Reviewed-by: Vijaya Kumar K-1 <vijay.kilari@stericsson.com>
    Reviewed-by: Marcus COOPER <marcus.xm.cooper@stericsson.com>
    Reviewed-by: Olivier CLERGEAUD <olivier.clergeaud@stericsson.com>
    Reviewed-by: Arun MURTHY <arun.murthy@stericsson.com>
    Reviewed-by: Rabin VINCENT <rabin.vincent@stericsson.com>
    Tested-by: Rupesh KUMAR <rupesh.kumar@stericsson.com>
    Tested-by: Jonas ABERG <jonas.aberg@stericsson.com>

diff --git a/drivers/power/ab8500_fg.c b/drivers/power/ab8500_fg.c
index f94c9661e47e..25dae4c4b0ef 100644
--- a/drivers/power/ab8500_fg.c
+++ b/drivers/power/ab8500_fg.c
@@ -2250,7 +2250,8 @@ static int ab8500_fg_get_ext_psy_data(struct device *dev, void *data)
 		case POWER_SUPPLY_PROP_TECHNOLOGY:
 			switch (ext->type) {
 			case POWER_SUPPLY_TYPE_BATTERY:
-				if (!di->flags.batt_id_received) {
+				if (!di->flags.batt_id_received &&
+				    di->bm->batt_id != BATTERY_UNKNOWN) {
 					const struct abx500_battery_type *b;
 
 					b = &(di->bm->bat_type[di->bm->batt_id]);

