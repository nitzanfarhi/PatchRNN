commit a6a7b9a207d46c6a32ecd1ed3ddd877640f90df4
Author: Liviu Dudau <Liviu.Dudau@arm.com>
Date:   Fri Jul 29 14:21:29 2016 +0100

    drm: mali-dp: Set the drm->irq_enabled flag to match driver's state.
    
    Mali DP driver does not use drm_irq_{un,}install() function so the
    drm->irq_enabled flag does not get set automatically.
    drm_wait_vblank() checks the value of the flag among other functions.
    
    Signed-off-by: Liviu Dudau <Liviu.Dudau@arm.com>

diff --git a/drivers/gpu/drm/arm/malidp_drv.c b/drivers/gpu/drm/arm/malidp_drv.c
index f15dc5484f31..9468dfd52336 100644
--- a/drivers/gpu/drm/arm/malidp_drv.c
+++ b/drivers/gpu/drm/arm/malidp_drv.c
@@ -378,6 +378,8 @@ static int malidp_bind(struct device *dev)
 	if (ret < 0)
 		goto irq_init_fail;
 
+	drm->irq_enabled = true;
+
 	ret = drm_vblank_init(drm, drm->mode_config.num_crtc);
 	if (ret < 0) {
 		DRM_ERROR("failed to initialise vblank\n");
@@ -403,6 +405,7 @@ static int malidp_bind(struct device *dev)
 vblank_fail:
 	malidp_se_irq_fini(drm);
 	malidp_de_irq_fini(drm);
+	drm->irq_enabled = false;
 irq_init_fail:
 	component_unbind_all(dev, drm);
 bind_fail:

