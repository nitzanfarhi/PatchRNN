commit cb0355836e4da1c77de94abaf30d51c9e289eeef
Author: Sunny Bains <Sunny.Bains@Oracle.Com>
Date:   Tue Aug 17 12:18:58 2010 +1000

    srv_fast_shutdown is not a boolean, adjust checks. Fix the check for shutdown
    condition in the purge coordinator thread.

diff --git a/storage/innobase/srv/srv0srv.c b/storage/innobase/srv/srv0srv.c
index c62a7ce1aea..6c9ecb53375 100644
--- a/storage/innobase/srv/srv0srv.c
+++ b/storage/innobase/srv/srv0srv.c
@@ -2813,7 +2813,7 @@ srv_purge_coordinator_thread(
 		ulint	batch_size = srv_purge_batch_size;
 		ulint	sleep_ms = ut_rnd_gen_ulint() % 10000;
 
-		if (srv_shutdown_state != 0 && srv_fast_shutdown) {
+		if (srv_shutdown_state != 0 && srv_fast_shutdown != 0) {
 			break;
 		}
 
@@ -2841,7 +2841,7 @@ srv_purge_coordinator_thread(
 					os_thread_sleep(sleep_ms);
 				}
 
-			} while (n_pages_purged > 0 && !srv_fast_shutdown);
+			} while (n_pages_purged > 0 && srv_fast_shutdown == 0);
 
 			++iterations;
 
@@ -2864,7 +2864,7 @@ srv_purge_coordinator_thread(
 				Force the coordinator thread to do the purge
 				tasks from the work queue. */
 				while (srv_get_task_queue_length() > 0
-				       && !srv_fast_shutdown) {
+				       && srv_fast_shutdown == 0) {
 					ut_a(srv_shutdown_state);
 					srv_task_execute();
 				}
@@ -2900,7 +2900,8 @@ srv_purge_coordinator_thread(
 
 			} while (trx_sys->rseg_history_len > 100
 				 && (srv_shutdown_state == 0
-				     || !srv_fast_shutdown));
+				     || (srv_shutdown_state > 0
+                                         && srv_fast_shutdown == 0)));
 		}
 	}
 

