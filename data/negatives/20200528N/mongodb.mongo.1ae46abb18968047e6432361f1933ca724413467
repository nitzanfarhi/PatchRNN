commit 1ae46abb18968047e6432361f1933ca724413467
Author: Eliot Horowitz <eliot@10gen.com>
Date:   Fri Sep 3 16:53:54 2010 -0400

    slighly cleaner shutdown

diff --git a/s/strategy.cpp b/s/strategy.cpp
index b3c8f5b3b5..8a974a3c65 100644
--- a/s/strategy.cpp
+++ b/s/strategy.cpp
@@ -90,7 +90,7 @@ namespace mongo {
             OID lastID;
             lastID.clear();
             int secsToSleep = 0;
-            while ( Shard::isMember( _addr ) ){
+            while ( ! inShutdown() && Shard::isMember( _addr ) ){
                 
                 if ( lastID.isSet() ){
                     scoped_lock lk( _seenWritebacksLock );
@@ -159,8 +159,14 @@ namespace mongo {
                     continue;
                 }
                 catch ( std::exception e ){
-                    log() << "WriteBackListener exception : " << e.what() << endl;
 
+                    if ( inShutdown() ){
+                        // we're shutting down, so just clean up
+                        return;
+                    }
+
+                    log() << "WriteBackListener exception : " << e.what() << endl;
+                    
                     // It's possible this shard was removed
                     Shard::reloadShardInfo();                    
                 }

