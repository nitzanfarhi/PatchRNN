commit 929ef50908605ee49e0455ebb07c390a29c826ef
Author: Daniel Vassdal <daniel@daniel-VirtualBox.(none)>
Date:   Mon Mar 25 15:04:26 2013 +0100

    Added support for EXTERNAL

diff --git a/src/modules/m_sasl.cpp b/src/modules/m_sasl.cpp
index 59751588e..f8d8c5322 100644
--- a/src/modules/m_sasl.cpp
+++ b/src/modules/m_sasl.cpp
@@ -22,6 +22,7 @@
 #include "m_cap.h"
 #include "account.h"
 #include "sasl.h"
+#include "ssl.h"
 
 /* $ModDesc: Provides support for IRC Authentication Layer (aka: atheme SASL) via AUTHENTICATE. */
 
@@ -62,6 +63,15 @@ class SaslAuthenticator
 		params.push_back("S");
 		params.push_back(method);
 
+		if (method == "EXTERNAL" && IS_LOCAL(user_))
+		{
+			SocketCertificateRequest req(&((LocalUser*)user_)->eh, ServerInstance->Modules->Find("m_sasl.so"));
+			std::string fp = req.GetFingerprint();
+
+			if (fp.size())
+				params.push_back(fp);
+		}
+
 		SendSASL(params);
 	}
 

