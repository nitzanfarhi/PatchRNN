commit 63693d848328c335c5ddc7c51300d2fda0f4d140
Author: w00t <w00t@e03df62e-2008-0410-955e-edbf42e46eb7>
Date:   Sat Oct 18 16:52:55 2008 +0000

    Use servers/auspex and users/auspex privs where needed.
    
    
    git-svn-id: http://svn.inspircd.org/repository/trunk/inspircd@10669 e03df62e-2008-0410-955e-edbf42e46eb7

diff --git a/src/commands/cmd_whois.cpp b/src/commands/cmd_whois.cpp
index 29264348c..df2e1d97d 100644
--- a/src/commands/cmd_whois.cpp
+++ b/src/commands/cmd_whois.cpp
@@ -27,7 +27,7 @@ void do_whois(InspIRCd* ServerInstance, User* user, User* dest,unsigned long sig
 	if (dest->registered == REG_ALL)
 	{
 		ServerInstance->SendWhoisLine(user, dest, 311, "%s %s %s %s * :%s",user->nick.c_str(), dest->nick.c_str(), dest->ident.c_str(), dest->dhost.c_str(), dest->fullname.c_str());
-		if (user == dest || IS_OPER(user))
+		if (user == dest || user->HasPrivPermission("users/auspex"))
 		{
 			ServerInstance->SendWhoisLine(user, dest, 378, "%s %s :is connecting from %s@%s %s", user->nick.c_str(), dest->nick.c_str(), dest->ident.c_str(), dest->host.c_str(), dest->GetIPString());
 		}
@@ -45,7 +45,7 @@ void do_whois(InspIRCd* ServerInstance, User* user, User* dest,unsigned long sig
 				ServerInstance->SendWhoisLine(user, dest, 319, "%s %s :%s",user->nick.c_str(), dest->nick.c_str(), cl.c_str());
 			}
 		}
-		if (*ServerInstance->Config->HideWhoisServer && !IS_OPER(user))
+		if (*ServerInstance->Config->HideWhoisServer && !user->HasPrivPermission("servers/auspex"))
 		{
 			ServerInstance->SendWhoisLine(user, dest, 312, "%s %s %s :%s",user->nick.c_str(), dest->nick.c_str(), ServerInstance->Config->HideWhoisServer, ServerInstance->Config->Network);
 		}
@@ -64,9 +64,9 @@ void do_whois(InspIRCd* ServerInstance, User* user, User* dest,unsigned long sig
 			ServerInstance->SendWhoisLine(user, dest, 313, "%s %s :is %s %s on %s",user->nick.c_str(), dest->nick.c_str(), (strchr("AEIOUaeiou",dest->oper[0]) ? "an" : "a"),irc::Spacify(dest->oper.c_str()), ServerInstance->Config->Network);
 		}
 
-		if (user == dest || IS_OPER(user))
+		if (user == dest || user->HasPrivPermission("users/auspex"))
 		{
-			if (dest->modes[UM_SNOMASK] != 0)
+			if (dest->IsModeSet('s') != 0)
 			{
 				ServerInstance->SendWhoisLine(user, dest, 379, "%s %s :is using modes +%s +%s", user->nick.c_str(), dest->nick.c_str(), dest->FormatModes(), dest->FormatNoticeMasks());
 			}

