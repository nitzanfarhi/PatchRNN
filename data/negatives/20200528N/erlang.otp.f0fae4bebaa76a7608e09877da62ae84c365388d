commit f0fae4bebaa76a7608e09877da62ae84c365388d
Author: Rickard Green <rickard@erlang.org>
Date:   Fri Nov 5 16:26:20 2010 +0100

    Don't use more reader groups than schedulers

diff --git a/erts/emulator/beam/erl_init.c b/erts/emulator/beam/erl_init.c
index 4ae656a3ad..e2f2cccb7e 100644
--- a/erts/emulator/beam/erl_init.c
+++ b/erts/emulator/beam/erl_init.c
@@ -786,6 +786,8 @@ early_init(int *argc, char **argv) /*
 	elid.mem.ll.free = ethr_ll_free;
 
 #ifdef ERTS_SMP
+	if (erts_max_main_threads > no_schedulers)
+	    erts_max_main_threads = no_schedulers;
 	elid.main_threads = erts_max_main_threads;
 #else
 	elid.main_threads = 1;

