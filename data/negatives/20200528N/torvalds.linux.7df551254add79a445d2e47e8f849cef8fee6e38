commit 7df551254add79a445d2e47e8f849cef8fee6e38
Author: David S. Miller <davem@davemloft.net>
Date:   Sat Jun 18 23:01:10 2005 -0700

    [TCP]: Fix sysctl_tcp_low_latency
    
    When enabled, this should disable UCOPY prequeue'ing altogether,
    but it does not due to a missing test.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/ipv4/tcp.c b/net/ipv4/tcp.c
index 3a4c52e77e01..674bbd8cfd36 100644
--- a/net/ipv4/tcp.c
+++ b/net/ipv4/tcp.c
@@ -1326,7 +1326,7 @@ int tcp_recvmsg(struct kiocb *iocb, struct sock *sk, struct msghdr *msg,
 
 		cleanup_rbuf(sk, copied);
 
-		if (tp->ucopy.task == user_recv) {
+		if (!sysctl_tcp_low_latency && tp->ucopy.task == user_recv) {
 			/* Install new reader */
 			if (!user_recv && !(flags & (MSG_TRUNC | MSG_PEEK))) {
 				user_recv = current;

