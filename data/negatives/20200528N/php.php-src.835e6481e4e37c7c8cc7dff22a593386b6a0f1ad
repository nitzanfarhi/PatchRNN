commit 835e6481e4e37c7c8cc7dff22a593386b6a0f1ad
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Tue Jan 28 16:34:21 2003 +0000

    Fixed bug #17868 (more then the <!--include--> directive used to include
    a PHP file would result in a crash).

diff --git a/sapi/apache2filter/sapi_apache2.c b/sapi/apache2filter/sapi_apache2.c
index b193d852b1..031b5e2fef 100644
--- a/sapi/apache2filter/sapi_apache2.c
+++ b/sapi/apache2filter/sapi_apache2.c
@@ -532,7 +532,9 @@ static int php_output_filter(ap_filter_t *f, apr_bucket_brigade *bb)
 			
 			php_apache_request_dtor(f TSRMLS_CC);
 			
-			ctx->request_processed = 1;
+			if (!f->r->main) {
+				ctx->request_processed = 1;
+			}
 
 			/* Delete the FILE bucket from the brigade. */
 			apr_bucket_delete(b);

