commit 34cf0081294513bc734896c9051c20ca6c19c3db
Author: Andrew de Quincey <adq@lidskialf.net>
Date:   Sun Aug 8 21:04:50 2010 +0100

    posix-aio-compat: Fix async_conmtext for ioctl
    
    Set the async_context_id field when queuing an async ioctl call
    
    Signed-off-by: Andrew de Quincey <adq@lidskialf.net>
    Signed-off-by: Kevin Wolf <kwolf@redhat.com>

diff --git a/posix-aio-compat.c b/posix-aio-compat.c
index a67ffe3113..efc59683c0 100644
--- a/posix-aio-compat.c
+++ b/posix-aio-compat.c
@@ -599,6 +599,7 @@ BlockDriverAIOCB *paio_ioctl(BlockDriverState *bs, int fd,
     acb->aio_type = QEMU_AIO_IOCTL;
     acb->aio_fildes = fd;
     acb->ev_signo = SIGUSR2;
+    acb->async_context_id = get_async_context_id();
     acb->aio_offset = 0;
     acb->aio_ioctl_buf = buf;
     acb->aio_ioctl_cmd = req;

