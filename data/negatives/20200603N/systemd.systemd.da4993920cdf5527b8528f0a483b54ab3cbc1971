commit da4993920cdf5527b8528f0a483b54ab3cbc1971
Author: Kay Sievers <kay@vrfy.org>
Date:   Mon Mar 4 15:17:45 2013 +0100

    journal: split journal uid only when audit uid data is valid

diff --git a/src/journal/journald-server.c b/src/journal/journald-server.c
index c8a6285a8..545760726 100644
--- a/src/journal/journald-server.c
+++ b/src/journal/journald-server.c
@@ -671,12 +671,12 @@ static void dispatch_message_real(
 
         assert(n <= m);
 
-        if (s->split_mode == SPLIT_NONE)
-                journal_uid = 0;
-        else if (s->split_mode == SPLIT_UID || realuid == 0 || !loginuid_valid)
+        if (s->split_mode == SPLIT_UID && realuid > 0)
                 journal_uid = realuid;
-        else
+        else if (s->split_mode == SPLIT_LOGIN && loginuid > 0 && loginuid_valid)
                 journal_uid = loginuid;
+        else
+                journal_uid = 0;
 
         write_to_journal(s, journal_uid, iovec, n);
 }

