commit 3573b80c42e88c2a43c068c86bcd1a753cf6e1a0
Author: Hemant Gupta <hemant.gupta@stericsson.com>
Date:   Fri Dec 23 11:07:24 2011 +0530

    Bluetooth: Incorrect address while storing LTK.
    
    This patch fixes incorrect address storage while storing
    Long Term Key for LE Devices using SMP (Security Manager Protocol).
    The address stored should be of remote device and not of source device.
    
    Signed-off-by: Hemant Gupta <hemant.gupta@stericsson.com>
    Acked-by: Marcel Holtmann <marcel@holtmann.org>
    Signed-off-by: Gustavo F. Padovan <padovan@profusion.mobi>

diff --git a/net/bluetooth/smp.c b/net/bluetooth/smp.c
index 9fea4bfd0eb5..32c47de30344 100644
--- a/net/bluetooth/smp.c
+++ b/net/bluetooth/smp.c
@@ -820,7 +820,7 @@ static int smp_cmd_master_ident(struct l2cap_conn *conn, struct sk_buff *skb)
 
 	skb_pull(skb, sizeof(*rp));
 
-	hci_add_ltk(conn->hcon->hdev, 1, conn->src, smp->smp_key_size,
+	hci_add_ltk(conn->hcon->hdev, 1, conn->dst, smp->smp_key_size,
 						rp->ediv, rp->rand, smp->tk);
 
 	smp_distribute_keys(conn, 1);

