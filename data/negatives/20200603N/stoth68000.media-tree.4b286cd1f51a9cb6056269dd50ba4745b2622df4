commit 4b286cd1f51a9cb6056269dd50ba4745b2622df4
Author: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
Date:   Tue May 21 02:39:21 2013 +0000

    Btrfs: return error code in btrfs_check_trunc_cache_free_space()
    
    Fix to return error code instead always return 0 from function
    btrfs_check_trunc_cache_free_space().
    Introduced by commit 7b61cd92242542944fc27024900c495a6a7b3396
    (Btrfs: don't use global block reservation for inode cache truncation)
    
    Signed-off-by: Wei Yongjun <yongjun_wei@trendmicro.com.cn>
    Reviewed-by: Miao Xie <miaox@cn.fujitsu.com>
    Signed-off-by: Josef Bacik <jbacik@fusionio.com>

diff --git a/fs/btrfs/free-space-cache.c b/fs/btrfs/free-space-cache.c
index ed26a5793cf7..75172853d713 100644
--- a/fs/btrfs/free-space-cache.c
+++ b/fs/btrfs/free-space-cache.c
@@ -213,7 +213,7 @@ int btrfs_check_trunc_cache_free_space(struct btrfs_root *root,
 	else
 		ret = 0;
 	spin_unlock(&rsv->lock);
-	return 0;
+	return ret;
 }
 
 int btrfs_truncate_free_space_cache(struct btrfs_root *root,

