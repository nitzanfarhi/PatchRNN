commit 7d74586f79880a2b495792fe3d6caf6d944482d2
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Jan 4 00:59:55 2007 +0200

    Don't keep a connection open to dovecot-auth when we're only proxying.
    
    --HG--
    branch : HEAD

diff --git a/src/login-common/main.c b/src/login-common/main.c
index 9ce67842c..4b8eb384b 100644
--- a/src/login-common/main.c
+++ b/src/login-common/main.c
@@ -47,6 +47,9 @@ void main_unref(void)
 		/* last login finished, close all communications
 		   to master process */
 		master_close();
+		/* we might still be proxying. close the connection to
+		   dovecot-auth, since it's not needed anymore. */
+		auth_client_free(&auth_client);
 	}
 }
 
@@ -336,7 +339,8 @@ static void main_deinit(void)
 	ssl_proxy_deinit();
 	login_proxy_deinit();
 
-	auth_client_free(&auth_client);
+	if (auth_client != NULL)
+		auth_client_free(&auth_client);
 	clients_deinit();
 	master_deinit();
 

