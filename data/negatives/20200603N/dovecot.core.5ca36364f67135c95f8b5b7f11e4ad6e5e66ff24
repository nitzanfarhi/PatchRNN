commit 5ca36364f67135c95f8b5b7f11e4ad6e5e66ff24
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Nov 15 03:28:56 2007 +0200

    If file_dotlock_create() fails with "dotlock was immediately recreated under
    us", return errno=ENOENT.
    
    --HG--
    branch : HEAD

diff --git a/src/lib/file-dotlock.c b/src/lib/file-dotlock.c
index 6c2802285..8dc24569d 100644
--- a/src/lib/file-dotlock.c
+++ b/src/lib/file-dotlock.c
@@ -611,6 +611,7 @@ int file_dotlock_create(const struct dotlock_settings *set, const char *path,
 	}
 	/* extra sanity check won't hurt.. */
 	if (st.st_dev != dotlock->dev || st.st_ino != dotlock->ino) {
+		errno = ENOENT;
 		i_error("dotlock %s was immediately recreated under us",
 			lock_path);
                 file_dotlock_free(dotlock);

