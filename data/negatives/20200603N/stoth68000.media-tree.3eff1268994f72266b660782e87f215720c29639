commit 3eff1268994f72266b660782e87f215720c29639
Author: Dave Chinner <dchinner@redhat.com>
Date:   Tue Apr 12 13:34:20 2011 +0000

    xfs: fix duplicate message output
    
    Commit 957935dc ("xfs: fix xfs_debug warnings" broke the logic in
    __xfs_printk(). Instead of only printing one of two possible output
    strings based on whether the fs has a name or not, it outputs both.
    Fix it to only output one message again.
    
    Signed-off-by: Dave Chinner <dchinner@redhat.com>
    Reviewed-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Alex Elder <aelder@sgi.com>

diff --git a/fs/xfs/linux-2.6/xfs_message.c b/fs/xfs/linux-2.6/xfs_message.c
index 3ca795609113..9f76cceb678d 100644
--- a/fs/xfs/linux-2.6/xfs_message.c
+++ b/fs/xfs/linux-2.6/xfs_message.c
@@ -34,8 +34,10 @@ __xfs_printk(
 	const struct xfs_mount	*mp,
 	struct va_format	*vaf)
 {
-	if (mp && mp->m_fsname)
+	if (mp && mp->m_fsname) {
 		printk("%sXFS (%s): %pV\n", level, mp->m_fsname, vaf);
+		return;
+	}
 	printk("%sXFS: %pV\n", level, vaf);
 }
 

