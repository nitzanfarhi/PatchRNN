commit 4c47df35c38eb6065f1a8ca7d97126f605d10701
Author: Sage Weil <sage@newdream.net>
Date:   Fri Jun 24 10:46:32 2011 -0700

    client: prefer auth cap in caps_issued_mask()
    
    If we have an auth cap, prefer to touch that one.  This helps consolidate
    caps on a single mds and allows mds replicas to eventually recall their
    state.
    
    Signed-off-by: Sage Weil <sage@newdream.net>

diff --git a/src/client/Client.h b/src/client/Client.h
index cd5ba72e28..292bac5d0d 100644
--- a/src/client/Client.h
+++ b/src/client/Client.h
@@ -601,6 +601,14 @@ class Inode {
     int c = exporting_issued | snap_caps;
     if ((c & mask) == mask)
       return true;
+    // prefer auth cap
+    if (auth_cap &&
+	cap_is_valid(auth_cap) &&
+	(auth_cap->issued & mask) == mask) {
+      touch_cap(auth_cap);
+      return true;
+    }
+    // try any cap
     for (map<int,InodeCap*>::iterator it = caps.begin();
          it != caps.end();
          it++) {

