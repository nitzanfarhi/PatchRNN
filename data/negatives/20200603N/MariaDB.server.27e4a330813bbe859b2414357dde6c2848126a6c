commit 27e4a330813bbe859b2414357dde6c2848126a6c
Author: Yoni Fogel <yoni@tokutek.com>
Date:   Tue Apr 14 14:11:22 2009 +0000

    Addresses #1683 Assert shutdown is not called twice on the same minicron
    
    git-svn-id: file:///svn/toku/tokudb@11297 c7de825b-a66e-492c-adef-691d508d4ae1

diff --git a/newbrt/minicron.c b/newbrt/minicron.c
index 037139e0d7c..a57ad4257e1 100644
--- a/newbrt/minicron.c
+++ b/newbrt/minicron.c
@@ -116,6 +116,7 @@ toku_minicron_change_period(struct minicron *p, u_int32_t new_period)
 int
 toku_minicron_shutdown(struct minicron *p) {
     int r = toku_pthread_mutex_lock(&p->mutex);        assert(r==0);
+    assert(!p->do_shutdown);
     p->do_shutdown = TRUE;
     //printf("%s:%d signalling\n", __FILE__, __LINE__);
     r = toku_pthread_cond_signal(&p->condvar);         assert(r==0);

