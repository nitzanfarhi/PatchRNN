commit 1bb9edbaf27d026acbf3fcfb80bdbf7a34f00fce
Author: John Spray <john.spray@redhat.com>
Date:   Mon Sep 26 22:12:19 2016 +0100

    mgr: fix OSDMap notifications
    
    This broken when MgrStandby was separated out,
    because it now eats the original OSDMap message
    without calling maybe_request_map.
    
    Signed-off-by: John Spray <john.spray@redhat.com>

diff --git a/src/mgr/Mgr.cc b/src/mgr/Mgr.cc
index 2a1cd246e5..834eb9111f 100644
--- a/src/mgr/Mgr.cc
+++ b/src/mgr/Mgr.cc
@@ -172,6 +172,9 @@ void Mgr::init()
     cluster_state.notify_osdmap(osd_map);
   });
 
+  // Subscribe to OSDMap update to pass on to ClusterState
+  objecter->maybe_request_map();
+
   monc->sub_want("mgrdigest", 0, 0);
 
   // Prepare to receive FSMap and request it
@@ -437,7 +440,6 @@ bool Mgr::ms_dispatch(Message *m)
       m->put();
       break;
     case CEPH_MSG_OSD_MAP:
-
       handle_osd_map();
 
       py_modules.notify_all("osd_map", "");

