commit 45b500d5a60ca6c43e5a545b9e15e203be1feeac
Author: Nick Mathewson <nickm@torproject.org>
Date:   Mon Nov 15 19:38:19 2010 -0500

    Clean up my 1776 fix a bit
    
    Sebastian notes (and I think correctly) that one of our ||s should
    have been an &&, which simplifies a boolean expression to decide
    whether to replace bridges.  I'm also refactoring out the negation at
    the start of the expression, to make it more readable.

diff --git a/src/or/routerlist.c b/src/or/routerlist.c
index 0e9265fe4..670574a9d 100644
--- a/src/or/routerlist.c
+++ b/src/or/routerlist.c
@@ -3238,8 +3238,12 @@ router_add_to_routerlist(routerinfo_t *router, const char **msg,
     const int was_bridge = old_router &&
       old_router->purpose == ROUTER_PURPOSE_BRIDGE;
 
-    if (! (routerinfo_is_a_configured_bridge(router) &&
-           (router->purpose == ROUTER_PURPOSE_BRIDGE || !was_bridge))) {
+    if (routerinfo_is_a_configured_bridge(router) &&
+        router->purpose == ROUTER_PURPOSE_BRIDGE &&
+        !was_bridge) {
+      log_info(LD_DIR, "Replacing non-bridge descriptor with bridge "
+               "descriptor for router '%s'", router->nickname);
+    } else {
       log_info(LD_DIR,
                "Dropping descriptor that we already have for router '%s'",
                router->nickname);

