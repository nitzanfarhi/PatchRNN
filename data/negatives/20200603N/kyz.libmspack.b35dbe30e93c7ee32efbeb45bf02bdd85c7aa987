commit b35dbe30e93c7ee32efbeb45bf02bdd85c7aa987
Author: Stuart Caie <kyzer@4u.net>
Date:   Thu Feb 24 13:55:05 2005 +0000

    better place for the test

diff --git a/libmspack/trunk/mspack/chmd.c b/libmspack/trunk/mspack/chmd.c
index c7a649b..136d60a 100644
--- a/libmspack/trunk/mspack/chmd.c
+++ b/libmspack/trunk/mspack/chmd.c
@@ -341,16 +341,16 @@ static int chmd_read_headers(struct mspack_system *sys, struct mspack_file *fh,
     chm->sec0.offset = chm->dir_offset + (chm->chunk_size * chm->num_chunks);
   }
 
-  /* if we are doing a quick read, stop here! */
-  if (!entire) {
-    return MSPACK_ERR_OK;
-  }
-
   /* avoid an infinite loop if chunk_size is zero */
   if (chm->chunk_size == 0) {
     return MSPACK_ERR_DATAFORMAT;
   }
 
+  /* if we are doing a quick read, stop here! */
+  if (!entire) {
+    return MSPACK_ERR_OK;
+  }
+
   /* seek to the first PMGL chunk, and reduce the number of chunks to read */
   if ((x = EndGetI32(&buf[chmhs1_FirstPMGL]))) {
     if (sys->seek(fh,(off_t) (x * chm->chunk_size), MSPACK_SYS_SEEK_CUR)) {

