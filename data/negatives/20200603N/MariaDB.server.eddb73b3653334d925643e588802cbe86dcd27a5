commit eddb73b3653334d925643e588802cbe86dcd27a5
Author: ingo/mydev@chilla.local <>
Date:   Sat Jul 29 21:58:50 2006 +0200

    Bug#20719 - Reading dynamic records with write buffer could fail
    After merge fix

diff --git a/myisam/mi_dynrec.c b/myisam/mi_dynrec.c
index 51f2ff349f8..4dec3055fa1 100644
--- a/myisam/mi_dynrec.c
+++ b/myisam/mi_dynrec.c
@@ -1141,6 +1141,9 @@ int _mi_read_dynamic_record(MI_INFO *info, my_off_t filepos, byte *buf)
     block_info.second_read= 0;
     do
     {
+      /* A corrupted table can have wrong pointers. (Bug# 19835) */
+      if (filepos == HA_OFFSET_ERROR)
+        goto panic;
       if (info->opt_flag & WRITE_CACHE_USED &&
 	  info->rec_cache.pos_in_file < filepos + MI_BLOCK_INFO_HEADER_LENGTH &&
 	  flush_io_cache(&info->rec_cache))

