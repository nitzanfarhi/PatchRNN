commit 1cfad2ea77d3137935525b30e002be5c839f6f7f
Author: Sage Weil <sage@newdream.net>
Date:   Fri Dec 17 10:59:45 2010 -0800

    osd: clear INCONSISTENT if scrub detects no errors
    
    Signed-off-by: Sage Weil <sage@newdream.net>

diff --git a/src/osd/PG.cc b/src/osd/PG.cc
index 76e2a05898..6502b73174 100644
--- a/src/osd/PG.cc
+++ b/src/osd/PG.cc
@@ -3310,7 +3310,7 @@ void PG::scrub()
     ss << ", " << fixed << " fixed";
   osd->get_logclient()->log(errors ? LOG_ERROR:LOG_INFO, ss);
 
-  if (!(errors - fixed) && repair)
+  if (errors == 0 || (repair && (errors - fixed) == 0))
     state_clear(PG_STATE_INCONSISTENT);
   state_clear(PG_STATE_REPAIR);
 

