commit 5f195c2c5cba60241004146cd12d71451d6b0fc4
Author: Chris Mi <chrism@mellanox.com>
Date:   Tue May 16 07:07:11 2017 -0400

    net/mlx5e: Fix min inline value for VF rep SQs
    
    The offending commit only changed the code path for PF/VF, but it
    didn't take care of VF representors. As a result, since
    params->tx_min_inline_mode for VF representors is kzalloced to 0
    (MLX5_INLINE_MODE_NONE), all VF reps SQs were set to that mode.
    
    This actually works on CX5 by default but broke CX4. Fix that by
    adding a call to query the min inline mode from the VF rep build up code.
    
    Fixes: a6f402e49901 ("net/mlx5e: Tx, no inline copy on ConnectX-5")
    Signed-off-by: Chris Mi <chrism@mellanox.com>
    Reviewed-by: Or Gerlitz <ogerlitz@mellanox.com>
    Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>

diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
index 79462c0368a0..46984a52a94b 100644
--- a/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_rep.c
@@ -791,6 +791,8 @@ static void mlx5e_build_rep_params(struct mlx5_core_dev *mdev,
 	params->tx_max_inline         = mlx5e_get_max_inline_cap(mdev);
 	params->num_tc                = 1;
 	params->lro_wqe_sz            = MLX5E_PARAMS_DEFAULT_LRO_WQE_SZ;
+
+	mlx5_query_min_inline(mdev, &params->tx_min_inline_mode);
 }
 
 static void mlx5e_build_rep_netdev(struct net_device *netdev)

