commit 67e6b49e39e9b9bf5ce1351ef21dad391856183f
Author: Jens Axboe <jens.axboe@oracle.com>
Date:   Fri Apr 20 14:18:00 2007 +0200

    cfq-iosched: slice offset should take ioprio into account
    
    Use the max_slice-cur_slice as the multipler for the insertion offset.
    
    Signed-off-by: Jens Axboe <jens.axboe@oracle.com>

diff --git a/block/cfq-iosched.c b/block/cfq-iosched.c
index 29284fa06e6b..4a0397022f5b 100644
--- a/block/cfq-iosched.c
+++ b/block/cfq-iosched.c
@@ -442,7 +442,8 @@ static unsigned long cfq_slice_offset(struct cfq_data *cfqd,
 	/*
 	 * just an approximation, should be ok.
 	 */
-	return ((cfqd->busy_queues - 1) * cfq_prio_slice(cfqd, 1, 0));
+	return (cfqd->busy_queues - 1) * (cfq_prio_slice(cfqd, 1, 0) -
+		       cfq_prio_slice(cfqd, cfq_cfqq_sync(cfqq), cfqq->ioprio));
 }
 
 /*

