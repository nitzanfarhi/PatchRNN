commit 3f4ccfbc67eb1850bb3c067f443f34953b087514
Author: Love Hörnquist Åstrand <lha@kth.se>
Date:   Sat Aug 27 05:46:07 2005 +0000

    (fix_transited_encoding): Allow empty content of type 0 because that
    is was Microsoft enerates in their TGT.
    
    
    git-svn-id: svn://svn.h5l.se/heimdal/trunk/heimdal@15993 ec53bebd-3082-4978-b11e-865c3cabbd6b

diff --git a/kdc/kerberos5.c b/kdc/kerberos5.c
index 4811432d4..2b78614cf 100644
--- a/kdc/kerberos5.c
+++ b/kdc/kerberos5.c
@@ -1505,7 +1505,20 @@ fix_transited_encoding(krb5_context context,
     int num_realms;
     int i;
 
-    if(tr->tr_type != DOMAIN_X500_COMPRESS) {
+    switch (tr->tr_type) {
+    case DOMAIN_X500_COMPRESS:
+	break;
+    case 0:
+	/*
+	 * Allow empty content of type 0 because that is was Microsoft
+	 * generates in their TGT.
+	 */
+	if (tr->contents.length == 0)
+	    break;
+	kdc_log(context, config, 0,
+		"Transited type 0 with non empty content");
+	return KRB5KDC_ERR_TRTYPE_NOSUPP;
+    default:
 	kdc_log(context, config, 0,
 		"Unknown transited type: %u", tr->tr_type);
 	return KRB5KDC_ERR_TRTYPE_NOSUPP;

