commit 91863d360bea96e2ff2f52f38c8a735291adadf4
Author: Christian Brauner <christian.brauner@canonical.com>
Date:   Fri Oct 28 20:08:12 2016 +0200

    conf/ile: use lxc_safe_uint() in config_kmsg()
    
    Signed-off-by: Christian Brauner <christian.brauner@canonical.com>

diff --git a/src/lxc/conf.h b/src/lxc/conf.h
index 4fd5b108..6f40259e 100644
--- a/src/lxc/conf.h
+++ b/src/lxc/conf.h
@@ -329,7 +329,7 @@ struct lxc_conf {
 	int haltsignal; // signal used to halt container
 	int rebootsignal; // signal used to reboot container
 	int stopsignal; // signal used to hard stop container
-	int kmsg;  // if 1, create /dev/kmsg symlink
+	unsigned int kmsg;  // if 1, create /dev/kmsg symlink
 	char *rcfile;	// Copy of the top level rcfile we read
 
 	// Logfile and logleve can be set in a container config file.
diff --git a/src/lxc/confile.c b/src/lxc/confile.c
index b6d5af00..a9f8a74a 100644
--- a/src/lxc/confile.c
+++ b/src/lxc/confile.c
@@ -1275,9 +1275,11 @@ static int config_ttydir(const char *key, const char *value,
 static int config_kmsg(const char *key, const char *value,
 			  struct lxc_conf *lxc_conf)
 {
-	int v = atoi(value);
+	if (lxc_safe_uint(value, &lxc_conf->kmsg) < 0)
+		return -1;
 
-	lxc_conf->kmsg = v;
+	if (lxc_conf->kmsg > 1)
+		return -1;
 
 	return 0;
 }

