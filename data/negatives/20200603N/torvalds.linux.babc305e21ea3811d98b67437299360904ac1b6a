commit babc305e21ea3811d98b67437299360904ac1b6a
Author: Sara Sharon <sara.sharon@intel.com>
Date:   Mon Sep 21 15:47:40 2015 +0300

    mac80211: reset CQM history upon reconfiguration
    
    The current behavior of notifying CQM events is inconsistent:
    Upon first configuration there is a cqm event with the current
    status according to threshold configured, regardless of signal
    stability.
    When there is reconfiguration no event is sent unless there is
    a significant change to the signal level according to the new
    configuration.
    
    Since the current reconfiguration behavior might cause missing
    CQM events in case the current signal did not change but is on
    the other side of the new threshold, fix that by resetting the
    stored signal level upon reconfiguration.
    
    Signed-off-by: Sara Sharon <sara.sharon@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/mac80211/cfg.c b/net/mac80211/cfg.c
index a30ec3ce3d25..7a77a1470f25 100644
--- a/net/mac80211/cfg.c
+++ b/net/mac80211/cfg.c
@@ -2474,6 +2474,7 @@ static int ieee80211_set_cqm_rssi_config(struct wiphy *wiphy,
 
 	bss_conf->cqm_rssi_thold = rssi_thold;
 	bss_conf->cqm_rssi_hyst = rssi_hyst;
+	sdata->u.mgd.last_cqm_event_signal = 0;
 
 	/* tell the driver upon association, unless already associated */
 	if (sdata->u.mgd.associated &&

