commit 3740161de2c6a7734db7fdd3c10e3828d64d4e16
Author: matyhtf <mikan.tenny@gmail.com>
Date:   Thu Jun 30 17:58:20 2016 +0800

    fix swoole_websocket_server->exist cannot use when client accept from un-websocket listen port.

diff --git a/php_swoole.h b/php_swoole.h
index 4c2d721c..b0af7fc7 100644
--- a/php_swoole.h
+++ b/php_swoole.h
@@ -43,7 +43,7 @@
 #include "Client.h"
 #include "async.h"
 
-#define PHP_SWOOLE_VERSION  "1.8.7-beta"
+#define PHP_SWOOLE_VERSION  "1.8.7-rc1"
 #define PHP_SWOOLE_CHECK_CALLBACK
 
 /**
diff --git a/swoole_http_server.c b/swoole_http_server.c
index ceac35fd..2657c82d 100644
--- a/swoole_http_server.c
+++ b/swoole_http_server.c
@@ -1152,9 +1152,11 @@ void swoole_http_context_free(http_context *ctx TSRMLS_DC)
         swString_free(ctx->buffer);
     }
 #endif
+
     ctx->end = 1;
     ctx->send_header = 0;
     ctx->gzip_enable = 0;
+    ctx->response.zobject = NULL;
 }
 
 static char *http_status_message(int code)
diff --git a/swoole_websocket_server.c b/swoole_websocket_server.c
index 098a2fce..b6ea548d 100644
--- a/swoole_websocket_server.c
+++ b/swoole_websocket_server.c
@@ -490,6 +490,16 @@ static PHP_METHOD(swoole_websocket_server, exist)
     {
         RETURN_FALSE;
     }
+    swConnection *server_sock = swServer_connection_get(serv, conn->from_fd);
+    if (server_sock)
+    {
+        swListenPort *port = server_sock->object;
+        //not websocket port
+        if (port && !port->open_websocket_protocol)
+        {
+            RETURN_TRUE;
+        }
+    }
     //have not handshake
     if (conn->websocket_status < WEBSOCKET_STATUS_ACTIVE)
     {

