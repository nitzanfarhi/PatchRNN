commit a180a6cfd1c08478abac65edbabb20426dd089eb
Author: kettenis <kettenis@openbsd.org>
Date:   Mon Jul 1 09:37:04 2013 +0000

    Make the acpi global lock functions actually work.  Luckily these functions
    were still unused.
    
    ok millert@

diff --git a/sys/arch/i386/i386/acpi_machdep.c b/sys/arch/i386/i386/acpi_machdep.c
index 15ce3419ef8..3297a6822c6 100644
--- a/sys/arch/i386/i386/acpi_machdep.c
+++ b/sys/arch/i386/i386/acpi_machdep.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: acpi_machdep.c,v 1.48 2013/03/20 21:23:05 kettenis Exp $	*/
+/*	$OpenBSD: acpi_machdep.c,v 1.49 2013/07/01 09:37:04 kettenis Exp $	*/
 /*
  * Copyright (c) 2005 Thorsten Lockert <tholo@sigmasoft.com>
  *
@@ -198,7 +198,7 @@ acpi_acquire_glk(uint32_t *lock)
 		new = (old & ~GL_BIT_PENDING) | GL_BIT_OWNED;
 		if ((old & GL_BIT_OWNED) != 0)
 			new |= GL_BIT_PENDING;
-	} while (i386_atomic_cas_int32(lock, old, new) == 0);
+	} while (i386_atomic_cas_int32(lock, old, new) != old);
 
 	return ((new & GL_BIT_PENDING) == 0);
 }
@@ -216,7 +216,7 @@ acpi_release_glk(uint32_t *lock)
 	do {
 		old = *lock;
 		new = old & ~(GL_BIT_PENDING | GL_BIT_OWNED);
-	} while (i386_atomic_cas_int32(lock, old, new) == 0);
+	} while (i386_atomic_cas_int32(lock, old, new) != old);
 
 	return ((old & GL_BIT_PENDING) != 0);
 }

