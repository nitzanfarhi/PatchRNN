commit b4b9748da8227894f2e1ba7c0da45721ea257ddf
Author: Yoni Fogel <yoni@tokutek.com>
Date:   Thu Jun 12 23:13:04 2008 +0000

    Addresses #912
    Use ybt->size field if ybt->ulen field is unset (for DB_DBT_REALLOC).
    
    git-svn-id: file:///svn/tokudb@4505 c7de825b-a66e-492c-adef-691d508d4ae1

diff --git a/newbrt/ybt.c b/newbrt/ybt.c
index 6deed7564de..db2f36235d9 100644
--- a/newbrt/ybt.c
+++ b/newbrt/ybt.c
@@ -51,8 +51,9 @@ static inline int dbt_set_copy(DBT* ybt, bytevec* datap, ITEMLEN len, void** sta
             tempdata  = (void*)*datap;
             do_malloc = FALSE;
         }
-        else if (ybt->flags==DB_DBT_REALLOC) {
-             if (ybt->data && ybt->ulen>=len && ybt->ulen/2<=len) {
+        else if (ybt->flags==DB_DBT_REALLOC && ybt->data) {
+            if (!ybt->ulen) ybt->ulen = ybt->size;
+            if (ybt->ulen>=len && ybt->ulen/2<=len) {
                 tempdata  = ybt->data;
                 do_malloc = FALSE;
             }

