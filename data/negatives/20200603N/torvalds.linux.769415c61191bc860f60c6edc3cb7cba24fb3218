commit 769415c61191bc860f60c6edc3cb7cba24fb3218
Author: Miklos Szeredi <mszeredi@suse.cz>
Date:   Thu Oct 16 16:08:56 2008 +0200

    fuse: fix SEEK_END incorrectness
    
    Update file size before using it in lseek(..., SEEK_END).
    
    Reported-by: Amnon Shiloh <u3557@miso.sublimeip.com>
    Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>

diff --git a/fs/fuse/file.c b/fs/fuse/file.c
index 2bada6bbc317..98079aa800e8 100644
--- a/fs/fuse/file.c
+++ b/fs/fuse/file.c
@@ -1448,6 +1448,9 @@ static loff_t fuse_file_llseek(struct file *file, loff_t offset, int origin)
 	mutex_lock(&inode->i_mutex);
 	switch (origin) {
 	case SEEK_END:
+		retval = fuse_update_attributes(inode, NULL, file, NULL);
+		if (retval)
+			return retval;
 		offset += i_size_read(inode);
 		break;
 	case SEEK_CUR:

