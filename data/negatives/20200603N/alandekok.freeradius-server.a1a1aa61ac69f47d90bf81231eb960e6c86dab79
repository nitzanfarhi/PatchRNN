commit a1a1aa61ac69f47d90bf81231eb960e6c86dab79
Author: aland <aland>
Date:   Tue Jun 19 11:01:00 2007 +0000

            listen sections in the default config can point to a virtual
            server.  Ones inside of a virtual server inherit their parent

diff --git a/src/main/listen.c b/src/main/listen.c
index 5d2696b7d..307b9b173 100644
--- a/src/main/listen.c
+++ b/src/main/listen.c
@@ -1715,7 +1715,7 @@ static rad_listen_t *listen_parse(const char *filename, CONF_SECTION *cs, const
 	listen_type = NULL;
 	
 	DEBUG2(" listen {");
-	
+
 	rcode = cf_item_parse(cs, "type", PW_TYPE_STRING_PTR,
 			      &listen_type, "");
 	if (rcode < 0) return NULL;
@@ -1735,6 +1735,16 @@ static rad_listen_t *listen_parse(const char *filename, CONF_SECTION *cs, const
 		return NULL;
 	}
 	
+	/*
+	 *	Allow listen sections in the default config to
+	 *	refer to a server.
+	 */
+	if (!server) {
+		rcode = cf_item_parse(cs, "server", PW_TYPE_STRING_PTR,
+				      &server, NULL);
+		if (rcode < 0) return NULL;
+	}
+
 	/*
 	 *	Set up cross-type data.
 	 */

