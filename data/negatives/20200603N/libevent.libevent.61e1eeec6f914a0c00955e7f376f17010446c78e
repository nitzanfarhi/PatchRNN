commit 61e1eeec6f914a0c00955e7f376f17010446c78e
Author: Nick Mathewson <nickm@torproject.org>
Date:   Mon Jul 5 13:24:45 2010 -0400

    Tidy up the code in evthread_make_base_notifiable a little
    
    Previously, we had a few conditional statements with the "if (...)"
    inside an #ifdef and the body outside.  That kind of thing is hard to
    read.

diff --git a/event.c b/event.c
index 12522993..35abd1aa 100644
--- a/event.c
+++ b/event.c
@@ -2564,16 +2564,15 @@ evthread_make_base_notifiable(struct event_base *base)
 	if (base->th_notify_fd[0] >= 0) {
 		notify = evthread_notify_base_eventfd;
 		cb = evthread_notify_drain_eventfd;
-	} else
+	}
 #endif
 #if defined(_EVENT_HAVE_PIPE)
-	{
+	if (base->th_notify_fd[0] < 0) {
 		if ((base->evsel->features & EV_FEATURE_FDS)) {
 			if (pipe(base->th_notify_fd) < 0)
 				event_warn("%s: pipe", __func__);
 		}
 	}
-	if (base->th_notify_fd[0] < 0)
 #endif
 
 #ifdef WIN32
@@ -2581,7 +2580,7 @@ evthread_make_base_notifiable(struct event_base *base)
 #else
 #define LOCAL_SOCKETPAIR_AF AF_UNIX
 #endif
-	{
+	if (base->th_notify_fd[0] < 0) {
 		if (evutil_socketpair(LOCAL_SOCKETPAIR_AF, SOCK_STREAM, 0,
 			base->th_notify_fd) == -1) {
 			event_sock_warn(-1, "%s: socketpair", __func__);

