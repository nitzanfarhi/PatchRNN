commit 8f7880348fa4a926793ba114c0c7724be1da8610
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Thu Aug 3 19:20:02 2006 +0000

    Sanitycheck that the length of an object adds up, right when we
    fetch it.
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@623 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/cache_fetch.c b/bin/varnishd/cache_fetch.c
index 9a7802519..339b1e908 100644
--- a/bin/varnishd/cache_fetch.c
+++ b/bin/varnishd/cache_fetch.c
@@ -242,6 +242,17 @@ FetchBody(struct sess *sp)
 	} else
 		cls = 0;
 
+	{
+	/* Sanity check fetch methods accounting */
+		struct storage *st;
+		unsigned uu;
+
+		uu = 0;
+		TAILQ_FOREACH(st, &sp->obj->store, list)
+			uu += st->len;
+		assert(uu == sp->obj->len);
+	}
+
 	http_CopyHttp(&sp->obj->http, hp);
 
 	if (http_GetHdr(vc->http, H_Connection, &b) && !strcasecmp(b, "close"))

