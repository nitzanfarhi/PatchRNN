commit 050006a753bab8ba05f2113cc57ba49398cd5521
Author: Sage Weil <sage@newdream.net>
Date:   Fri Oct 29 15:37:33 2010 -0400

    Btrfs: fix clone ioctl where range is adjacent to extent
    
    We had an edge case issue where the requested range was just
    following an existing extent. Instead of skipping to the next
    extent, we used the previous one which lead to having zero
    sized extents.
    
    Signed-off-by: Yehuda Sadeh <yehuda@hq.newdream.net>
    Signed-off-by: Chris Mason <chris.mason@oracle.com>

diff --git a/fs/btrfs/ioctl.c b/fs/btrfs/ioctl.c
index d94bef5179fc..3fe15e435b5c 100644
--- a/fs/btrfs/ioctl.c
+++ b/fs/btrfs/ioctl.c
@@ -1597,7 +1597,7 @@ static noinline long btrfs_ioctl_clone(struct file *file, unsigned long srcfd,
 			}
 			btrfs_release_path(root, path);
 
-			if (key.offset + datal < off ||
+			if (key.offset + datal <= off ||
 			    key.offset >= off+len)
 				goto next;
 

