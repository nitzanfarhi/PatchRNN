commit 5270b6a0d0cf41e49d634007ace40f5dfc381940
Author: John Snow <jsnow@redhat.com>
Date:   Mon Jun 8 16:49:15 2015 -0400

    block: record new size in bdrv_dirty_bitmap_truncate
    
    ce1ffea8 neglected to update the BdrvDirtyBitmap structure
    itself for internal consistency. It's currently not an issue,
    but for migration and persistence series this will cause headaches.
    
    Signed-off-by: John Snow <jsnow@redhat.com>
    Reviewed-by: Eric Blake <eblake@redhat.com>
    Signed-off-by: Kevin Wolf <kwolf@redhat.com>

diff --git a/block.c b/block.c
index 2b9ceae02f..2786e47d1e 100644
--- a/block.c
+++ b/block.c
@@ -3224,6 +3224,7 @@ static void bdrv_dirty_bitmap_truncate(BlockDriverState *bs)
             continue;
         }
         hbitmap_truncate(bitmap->bitmap, size);
+        bitmap->size = size;
     }
 }
 

