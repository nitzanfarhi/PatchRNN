commit a53a6c85756339f82ff19e001e90cfba2d6299a8
Author: NeilBrown <neilb@suse.de>
Date:   Thu Nov 6 17:28:20 2008 +1100

    md: fix bug in raid10 recovery.
    
    Adding a spare to a raid10 doesn't cause recovery to start.
    This is due to an silly type in
      commit 6c2fce2ef6b4821c21b5c42c7207cb9cf8c87eda
    and so is a bug in 2.6.27 and .28-rc.
    
    Thanks to Thomas Backlund for bisecting to find this.
    
    Cc: Thomas Backlund <tmb@mandriva.org>
    Cc: stable@kernel.org
    
    Signed-off-by: NeilBrown <neilb@suse.de>

diff --git a/drivers/md/raid10.c b/drivers/md/raid10.c
index da5129a24b18..970a96ef9b18 100644
--- a/drivers/md/raid10.c
+++ b/drivers/md/raid10.c
@@ -1137,7 +1137,7 @@ static int raid10_add_disk(mddev_t *mddev, mdk_rdev_t *rdev)
 	if (!enough(conf))
 		return -EINVAL;
 
-	if (rdev->raid_disk)
+	if (rdev->raid_disk >= 0)
 		first = last = rdev->raid_disk;
 
 	if (rdev->saved_raid_disk >= 0 &&

