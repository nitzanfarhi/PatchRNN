commit c24ef531ca58abad996482f5c2e8992be9ae8981
Author: Timo Sirainen <tss@iki.fi>
Date:   Wed Jul 25 19:31:28 2012 +0300

    i_stream_read(): Added assert to make sure EOF isn't returned too early.

diff --git a/src/lib/istream.c b/src/lib/istream.c
index 33f179f7b..ef3deec21 100644
--- a/src/lib/istream.c
+++ b/src/lib/istream.c
@@ -140,6 +140,7 @@ ssize_t i_stream_read(struct istream *stream)
 			errno = stream->stream_errno;
 		} else {
 			i_assert(stream->eof);
+			i_assert(old_size == _stream->pos - _stream->skip);
 		}
 		break;
 	case 0:

