commit 7f9444671d613e989f40e1afef5f5d05fc95b9f7
Author: jsg <jsg@openbsd.org>
Date:   Wed Feb 1 01:25:19 2017 +0000

    Switch from splsoftnet to taking the netlock in if_attachhead().
    The same change was made to if_attach() in rev 1.467.
    
    ok mpi@

diff --git a/sys/net/if.c b/sys/net/if.c
index 0dd6e9aac17..5d11b721071 100644
--- a/sys/net/if.c
+++ b/sys/net/if.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: if.c,v 1.483 2017/01/31 12:16:20 mpi Exp $	*/
+/*	$OpenBSD: if.c,v 1.484 2017/02/01 01:25:19 jsg Exp $	*/
 /*	$NetBSD: if.c,v 1.35 1996/05/07 05:26:04 thorpej Exp $	*/
 
 /*
@@ -513,11 +513,11 @@ if_attachhead(struct ifnet *ifp)
 {
 	int s;
 
-	s = splsoftnet();
+	NET_LOCK(s);
 	if_attach_common(ifp);
 	TAILQ_INSERT_HEAD(&ifnet, ifp, if_list);
 	if_attachsetup(ifp);
-	splx(s);
+	NET_UNLOCK(s);
 }
 
 void

