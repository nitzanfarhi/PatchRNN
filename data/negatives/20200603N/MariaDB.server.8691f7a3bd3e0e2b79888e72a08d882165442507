commit 8691f7a3bd3e0e2b79888e72a08d882165442507
Author: Rich Prohaska <prohaska@tokutek.com>
Date:   Fri Nov 1 09:57:31 2013 -0400

    Tokutek/mysql56#5 optimize read only transactions

diff --git a/storage/tokudb/ha_tokudb.cc b/storage/tokudb/ha_tokudb.cc
index b0b4027ce5f..394137f6d57 100644
--- a/storage/tokudb/ha_tokudb.cc
+++ b/storage/tokudb/ha_tokudb.cc
@@ -6168,7 +6168,13 @@ int ha_tokudb::create_txn(THD* thd, tokudb_trx_data* trx) {
          (thd_sql_command(thd) != SQLCOM_ALTER_TABLE)) {
         /* QQQ We have to start a master transaction */
         // DBUG_PRINT("trans", ("starting transaction all "));
-        if ((error = txn_begin(db_env, NULL, &trx->all, toku_iso_to_txn_flag(toku_iso_level), thd))) {
+        uint32_t txn_begin_flags = toku_iso_to_txn_flag(toku_iso_level);
+#if 50614 <= MYSQL_VERSION_ID && MYSQL_VERSION_ID <= 50699
+        if (thd_tx_is_read_only(thd)) {
+            txn_begin_flags |= DB_TXN_READ_ONLY;
+        }
+#endif
+        if ((error = txn_begin(db_env, NULL, &trx->all, txn_begin_flags, thd))) {
             trx->tokudb_lock_count--;      // We didn't get the lock
             goto cleanup;
         }

