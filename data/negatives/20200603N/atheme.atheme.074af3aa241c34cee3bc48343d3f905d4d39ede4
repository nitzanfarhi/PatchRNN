commit 074af3aa241c34cee3bc48343d3f905d4d39ede4
Author: Jilles Tjoelker <jilles@stack.nl>
Date:   Sun Aug 10 18:16:29 2008 +0200

    alis: fix handling of key and limit

diff --git a/modules/alis/main.c b/modules/alis/main.c
index 6a618d044..aca8d4b32 100644
--- a/modules/alis/main.c
+++ b/modules/alis/main.c
@@ -328,7 +328,7 @@ static int show_channel(channel_t *chptr, struct alis_query *query)
 	if(query->mode_dir == DIR_SET)
 	{
 		if(((chptr->modes & query->mode) != query->mode) ||
-		   (query->mode_key && chptr->key[0] == '\0') ||
+		   (query->mode_key && chptr->key == NULL) ||
 		   (query->mode_limit && !chptr->limit))
 			return 0;
 		for (i = 0; ignore_mode_list[i].mode != '\0'; i++)
@@ -338,7 +338,7 @@ static int show_channel(channel_t *chptr, struct alis_query *query)
 	else if(query->mode_dir == DIR_UNSET)
 	{
 		if((chptr->modes & query->mode) ||
-		   (query->mode_key && chptr->key[0] != '\0') ||
+		   (query->mode_key && chptr->key != NULL) ||
 		   (query->mode_limit && chptr->limit))
 			return 0;
 		for (i = 0; ignore_mode_list[i].mode != '\0'; i++)
@@ -347,8 +347,8 @@ static int show_channel(channel_t *chptr, struct alis_query *query)
 	}
 	else if(query->mode_dir == DIR_EQUAL)
 	{
-		if((chptr->modes != query->mode) ||
-		   (query->mode_key && chptr->key[0] == '\0') ||
+		if(((chptr->modes & ~(CMODE_LIMIT | CMODE_KEY)) != query->mode) ||
+		   (query->mode_key && chptr->key == NULL) ||
 		   (query->mode_limit && !chptr->limit))
 			return 0;
 		for (i = 0; ignore_mode_list[i].mode != '\0'; i++)

