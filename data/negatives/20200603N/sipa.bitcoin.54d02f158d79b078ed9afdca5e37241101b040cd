commit 54d02f158d79b078ed9afdca5e37241101b040cd
Author: Gavin Andresen <gavinandresen@gmail.com>
Date:   Thu Sep 15 08:55:15 2011 -0400

    SetMockTime() for cleaner unit testing

diff --git a/src/util.cpp b/src/util.cpp
index 76a270027..14ca87b62 100644
--- a/src/util.cpp
+++ b/src/util.cpp
@@ -815,11 +815,20 @@ void ShrinkDebugFile()
 //  - Median of other nodes's clocks
 //  - The user (asking the user to fix the system clock if the first two disagree)
 //
+static int64 nMockTime = 0;  // For unit testing
+
 int64 GetTime()
 {
+    if (nMockTime) return nMockTime;
+
     return time(NULL);
 }
 
+void SetMockTime(int64 nMockTimeIn)
+{
+    nMockTime = nMockTimeIn;
+}
+
 static int64 nTimeOffset = 0;
 
 int64 GetAdjustedTime()
diff --git a/src/util.h b/src/util.h
index 3d7ef108b..658d10e1e 100644
--- a/src/util.h
+++ b/src/util.h
@@ -199,6 +199,7 @@ void ShrinkDebugFile();
 int GetRandInt(int nMax);
 uint64 GetRand(uint64 nMax);
 int64 GetTime();
+void SetMockTime(int64 nMockTimeIn);
 int64 GetAdjustedTime();
 void AddTimeData(unsigned int ip, int64 nTime);
 std::string FormatFullVersion();

