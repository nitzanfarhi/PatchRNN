commit a9e31765e7d528858e1b0c202b823cf4df7577ca
Author: Yinghai Lu <yinghai@kernel.org>
Date:   Wed Sep 22 13:04:53 2010 -0700

    ipmi: fix acpi probe print
    
    After d9e1b6c45059ccf ("ipmi: fix ACPI detection with regspacing") we get
    
    [   11.026326] ipmi_si: probing via ACPI
    [   11.030019] ipmi_si 00:09: (null) regsize 1 spacing 1 irq 0
    [   11.035594] ipmi_si: Adding ACPI-specified kcs state machine
    
    on an old system with only one range for ipmi kcs range.
    
    Try to fix it by adding another res pointer.
    
    Signed-off-by: Yinghai Lu <yinghai@kernel.org>
    Signed-off-by: Corey Minyard <cminyard@mvista.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/char/ipmi/ipmi_si_intf.c b/drivers/char/ipmi/ipmi_si_intf.c
index 3822b4f49c84..2be457a0c0c3 100644
--- a/drivers/char/ipmi/ipmi_si_intf.c
+++ b/drivers/char/ipmi/ipmi_si_intf.c
@@ -2126,7 +2126,7 @@ static int __devinit ipmi_pnp_probe(struct pnp_dev *dev,
 {
 	struct acpi_device *acpi_dev;
 	struct smi_info *info;
-	struct resource *res;
+	struct resource *res, *res_second;
 	acpi_handle handle;
 	acpi_status status;
 	unsigned long long tmp;
@@ -2182,13 +2182,13 @@ static int __devinit ipmi_pnp_probe(struct pnp_dev *dev,
 	info->io.addr_data = res->start;
 
 	info->io.regspacing = DEFAULT_REGSPACING;
-	res = pnp_get_resource(dev,
+	res_second = pnp_get_resource(dev,
 			       (info->io.addr_type == IPMI_IO_ADDR_SPACE) ?
 					IORESOURCE_IO : IORESOURCE_MEM,
 			       1);
-	if (res) {
-		if (res->start > info->io.addr_data)
-			info->io.regspacing = res->start - info->io.addr_data;
+	if (res_second) {
+		if (res_second->start > info->io.addr_data)
+			info->io.regspacing = res_second->start - info->io.addr_data;
 	}
 	info->io.regsize = DEFAULT_REGSPACING;
 	info->io.regshift = 0;

