commit db0dbae9d9680bce69fe1ce775709e60c8ee9c29
Author: Wade Farnsworth <wfarnsworth@mvista.com>
Date:   Wed Jun 20 10:15:10 2007 +1000

    [POWERPC] Add a check for keyboard/mouse device nodes in check_legacy_ioport()
    
    The device tree for the MPC8641 HPCN does not implement the device type
    property for I8042 nodes.
    
    In addition to checking the I8042 node's device type, also match the
    keyboard and/or mouse nodes' compatible property.
    
    Signed-off-by: Wade Farnsworth <wfarnsworth@mvista.com>
    Signed-off-by: Paul Mackerras <paulus@samba.org>

diff --git a/arch/powerpc/kernel/setup-common.c b/arch/powerpc/kernel/setup-common.c
index ed07a198f8d6..38c4b733a72e 100644
--- a/arch/powerpc/kernel/setup-common.c
+++ b/arch/powerpc/kernel/setup-common.c
@@ -486,6 +486,14 @@ int check_legacy_ioport(unsigned long base_port)
 
 	switch(base_port) {
 	case I8042_DATA_REG:
+		if (!(np = of_find_compatible_node(NULL, NULL, "pnpPNP,303")))
+			np = of_find_compatible_node(NULL, NULL, "pnpPNP,f03");
+		if (np) {
+			parent = of_get_parent(np);
+			of_node_put(np);
+			np = parent;
+			break;
+		}
 		np = of_find_node_by_type(NULL, "8042");
 		break;
 	case FDC_BASE: /* FDC1 */

