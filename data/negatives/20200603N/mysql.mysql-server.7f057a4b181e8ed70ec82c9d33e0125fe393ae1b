commit 7f057a4b181e8ed70ec82c9d33e0125fe393ae1b
Author: marko <>
Date:   Wed Sep 20 05:05:58 2006 +0000

    branches/zip: mlog_parse_index(): After merge fix (r841):
    Identify DB_TRX_ID and DB_ROLL_PTR in the index.

diff --git a/mtr/mtr0log.c b/mtr/mtr0log.c
index ffde52a4b75..0206455b629 100644
--- a/mtr/mtr0log.c
+++ b/mtr/mtr0log.c
@@ -601,6 +601,19 @@ mlog_parse_index(
 					   0);
 		}
 		dict_table_add_system_columns(table);
+		if (n_uniq != n) {
+			/* Identify DB_TRX_ID and DB_ROLL_PTR in the index. */
+			ut_a(DATA_TRX_ID_LEN
+			     == dict_index_get_nth_col(ind, DATA_TRX_ID - 1
+						       + n_uniq)->len);
+			ut_a(DATA_ROLL_PTR_LEN
+			     == dict_index_get_nth_col(ind, DATA_ROLL_PTR - 1
+						       + n_uniq)->len);
+			ind->fields[DATA_TRX_ID - 1 + n_uniq].col
+				= &table->cols[n + DATA_TRX_ID];
+			ind->fields[DATA_ROLL_PTR - 1 + n_uniq].col
+				= &table->cols[n + DATA_ROLL_PTR];
+		}
 	}
 	/* avoid ut_ad(index->cached) in dict_index_get_n_unique_in_tree */
 	ind->cached = TRUE;

