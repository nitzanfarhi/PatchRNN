commit fc6b6054bd3f060f569d72ff7d4c4d1bb8088a88
Author: aj <aj@c6295689-39f2-0310-b995-f0e70906c6a9>
Date:   Sun Apr 18 18:05:05 2004 +0000

    adds three options PIN, QUIET, VERBOSE to theengine allowing respectively to
    set the PIN code, reduce output, augmentoutput. First one is obvious, the 2
    others need the second patch to beuseful.
    Patch by Mathias Brossard <mathias.brossard@idealx.com>
    
    
    git-svn-id: https://www.opensc-project.org/svnp/opensc/trunk@1768 c6295689-39f2-0310-b995-f0e70906c6a9

diff --git a/src/sslengines/engine_pkcs11.c b/src/sslengines/engine_pkcs11.c
index a6399b5f..c93ab987 100644
--- a/src/sslengines/engine_pkcs11.c
+++ b/src/sslengines/engine_pkcs11.c
@@ -46,6 +46,18 @@ int set_module(const char *modulename)
 	return 1;
 }
 
+int set_pin(const char *_pin)
+{
+	pin = strdup(_pin);
+	return 1;
+}
+
+int set_quiet(int i)
+{
+	quiet = i;
+	return 1;
+}
+
 char *get_pin(UI_METHOD * ui_method, char *sc_pin, int maxlen)
 {
 	UI *ui;
diff --git a/src/sslengines/engine_pkcs11.h b/src/sslengines/engine_pkcs11.h
index d236a410..c5055e56 100644
--- a/src/sslengines/engine_pkcs11.h
+++ b/src/sslengines/engine_pkcs11.h
@@ -35,6 +35,10 @@
 
 int set_module(const char *modulename);
 
+int set_pin(const char *pin);
+
+int set_quiet(int i);
+
 int pkcs11_finish(ENGINE * engine);
 
 int pkcs11_init(ENGINE * engine);
diff --git a/src/sslengines/hw_pkcs11.c b/src/sslengines/hw_pkcs11.c
index 01994225..acc8c69d 100644
--- a/src/sslengines/hw_pkcs11.c
+++ b/src/sslengines/hw_pkcs11.c
@@ -75,6 +75,9 @@
 
 #define CMD_SO_PATH		ENGINE_CMD_BASE
 #define CMD_MODULE_PATH 	(ENGINE_CMD_BASE+1)
+#define CMD_PIN		(ENGINE_CMD_BASE+2)
+#define CMD_VERBOSE		(ENGINE_CMD_BASE+3)
+#define CMD_QUIET		(ENGINE_CMD_BASE+4)
 
 static int pkcs11_engine_destroy(ENGINE * e);
 static int pkcs11_engine_ctrl(ENGINE * e, int cmd, long i, void *p, void (*f) ());
@@ -92,6 +95,18 @@ static const ENGINE_CMD_DEFN pkcs11_cmd_defns[] = {
 	 "MODULE_PATH",
 	 "Specifies the path to the pkcs11 module shared library",
 	 ENGINE_CMD_FLAG_STRING},
+	{CMD_PIN,
+	 "PIN",
+	 "Specifies the pin code",
+	 ENGINE_CMD_FLAG_STRING},
+	{CMD_VERBOSE,
+	 "VERBOSE",
+	 "Print additional details",
+	 ENGINE_CMD_FLAG_NO_INPUT},
+	{CMD_QUIET,
+	 "QUIET",
+	 "Remove additional details",
+	 ENGINE_CMD_FLAG_NO_INPUT},
 	{0, NULL, NULL, 0}
 };
 
@@ -107,7 +122,12 @@ static int pkcs11_engine_ctrl(ENGINE * e, int cmd, long i, void *p, void (*f) ()
 	switch (cmd) {
 	case CMD_MODULE_PATH:
 		return set_module((const char *) p);
-
+	case CMD_PIN:
+		return set_pin((const char *) p);
+	case CMD_VERBOSE:
+		return set_quiet(0);
+	case CMD_QUIET:
+		return set_quiet(1);
 	default:
 		break;
 	}

