commit 05c985436dfe81ab784251a54dd69be5b2dea98a
Author: Eric Dumazet <edumazet@google.com>
Date:   Mon May 25 18:50:01 2015 -0700

    net: fix inet_proto_csum_replace4() sparse errors
    
    make C=2 CF=-D__CHECK_ENDIAN__ net/core/utils.o
    ...
    net/core/utils.c:307:72: warning: incorrect type in argument 2 (different base types)
    net/core/utils.c:307:72:    expected restricted __wsum [usertype] addend
    net/core/utils.c:307:72:    got restricted __be32 [usertype] from
    net/core/utils.c:308:34: warning: incorrect type in argument 2 (different base types)
    net/core/utils.c:308:34:    expected restricted __wsum [usertype] addend
    net/core/utils.c:308:34:    got restricted __be32 [usertype] to
    net/core/utils.c:310:70: warning: incorrect type in argument 2 (different base types)
    net/core/utils.c:310:70:    expected restricted __wsum [usertype] addend
    net/core/utils.c:310:70:    got restricted __be32 [usertype] from
    net/core/utils.c:310:77: warning: incorrect type in argument 2 (different base types)
    net/core/utils.c:310:77:    expected restricted __wsum [usertype] addend
    net/core/utils.c:310:77:    got restricted __be32 [usertype] to
    net/core/utils.c:312:72: warning: incorrect type in argument 2 (different base types)
    net/core/utils.c:312:72:    expected restricted __wsum [usertype] addend
    net/core/utils.c:312:72:    got restricted __be32 [usertype] from
    net/core/utils.c:313:35: warning: incorrect type in argument 2 (different base types)
    net/core/utils.c:313:35:    expected restricted __wsum [usertype] addend
    net/core/utils.c:313:35:    got restricted __be32 [usertype] to
    
    Note we can use csum_replace4() helper
    
    Fixes: 58e3cac5613aa ("net: optimise inet_proto_csum_replace4()")
    Signed-off-by: Eric Dumazet <edumazet@google.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/core/utils.c b/net/core/utils.c
index 7b803884c162..a7732a068043 100644
--- a/net/core/utils.c
+++ b/net/core/utils.c
@@ -304,13 +304,15 @@ void inet_proto_csum_replace4(__sum16 *sum, struct sk_buff *skb,
 			      __be32 from, __be32 to, int pseudohdr)
 {
 	if (skb->ip_summed != CHECKSUM_PARTIAL) {
-		*sum = csum_fold(csum_add(csum_sub(~csum_unfold(*sum), from),
-				 to));
+		csum_replace4(sum, from, to);
 		if (skb->ip_summed == CHECKSUM_COMPLETE && pseudohdr)
-			skb->csum = ~csum_add(csum_sub(~(skb->csum), from), to);
+			skb->csum = ~csum_add(csum_sub(~(skb->csum),
+						       (__force __wsum)from),
+					      (__force __wsum)to);
 	} else if (pseudohdr)
-		*sum = ~csum_fold(csum_add(csum_sub(csum_unfold(*sum), from),
-				  to));
+		*sum = ~csum_fold(csum_add(csum_sub(csum_unfold(*sum),
+						    (__force __wsum)from),
+					   (__force __wsum)to));
 }
 EXPORT_SYMBOL(inet_proto_csum_replace4);
 

