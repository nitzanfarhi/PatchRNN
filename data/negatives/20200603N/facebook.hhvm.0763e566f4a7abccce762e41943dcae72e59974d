commit 0763e566f4a7abccce762e41943dcae72e59974d
Author: jan <jan@fb.com>
Date:   Wed Feb 6 23:59:50 2013 -0800

    Instance::cloneSet: do not initialize dynamic properties if no properties to clone
    
    Instance::cloneSet() unnecessarily creates HPHP array even if cloned
    object has no dynamic properties. Don't do this.

diff --git a/hphp/runtime/vm/instance.cpp b/hphp/runtime/vm/instance.cpp
index 7ced3a17d4..6e20a4a07f 100644
--- a/hphp/runtime/vm/instance.cpp
+++ b/hphp/runtime/vm/instance.cpp
@@ -937,8 +937,8 @@ void Instance::cloneSet(ObjectData* clone) {
     tvRefcountedDecRef(&iclonePropVec[i]);
     tvDupFlattenVars(&propVec()[i], &iclonePropVec[i], NULL);
   }
-  iclone->initDynProps();
   if (o_properties.get() != NULL) {
+    iclone->initDynProps();
     ssize_t iter = o_properties.get()->iter_begin();
     while (iter != HphpArray::ElmIndEmpty) {
       auto props = static_cast<HphpArray*>(o_properties.get());

