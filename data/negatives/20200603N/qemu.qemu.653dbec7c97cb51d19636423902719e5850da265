commit 653dbec7c97cb51d19636423902719e5850da265
Author: Luiz Capitulino <lcapitulino@redhat.com>
Date:   Wed Jun 2 17:46:31 2010 -0300

    block: Fix serial number assignment
    
    We should use 'dinfo->serial' length, 'serial' is a pointer, so
    the serial number length is currently limited to the pointer size.
    
    This fixes https://bugs.launchpad.net/qemu/+bug/584143 and is also
    valid for stable.
    
    Signed-off-by: Luiz Capitulino <lcapitulino@redhat.com>
    Signed-off-by: Kevin Wolf <kwolf@redhat.com>

diff --git a/blockdev.c b/blockdev.c
index bd9783affd..642ce756ac 100644
--- a/blockdev.c
+++ b/blockdev.c
@@ -422,7 +422,7 @@ DriveInfo *drive_init(QemuOpts *opts, int default_to_scsi, int *fatal_error)
     dinfo->on_write_error = on_write_error;
     dinfo->opts = opts;
     if (serial)
-        strncpy(dinfo->serial, serial, sizeof(serial));
+        strncpy(dinfo->serial, serial, sizeof(dinfo->serial) - 1);
     QTAILQ_INSERT_TAIL(&drives, dinfo, next);
 
     switch(type) {

