commit 5fac325759f86fd48fbd4a4a889a7982d1c85ced
Author: mugur <mugur@952d13e4-84fd-0310-bd7c-ee2827c68691>
Date:   Tue Jun 13 12:36:48 2006 +0000

    implemented ticket:2034 - Add ability to set topic by ID and show topic ID in the template language

diff --git a/campsite/implementation/parser/parser/actions.cpp b/campsite/implementation/parser/parser/actions.cpp
index b69d15278..e7e19b810 100644
--- a/campsite/implementation/parser/parser/actions.cpp
+++ b/campsite/implementation/parser/parser/actions.cpp
@@ -610,9 +610,25 @@ int CActTopic::takeAction(CContext& c, sockstream& fs)
 		c.SetTopic(c.DefTopic());
 		return RES_OK;
 	}
-	const Topic* pcoTopic = Topic::topic(param.value());
+	const Topic* pcoTopic = NULL;
+	if (case_comp(param.attribute(), "identifier") == 0)
+	{
+		try {
+			pcoTopic = Topic::topic((lint)Integer(param.value()));
+		}
+		catch (const InvalidValue &rcoEx)
+		{
+			return ERR_NODATA;
+		}
+	}
+	else
+	{
+		pcoTopic = Topic::topic(param.value());
+	}
 	if (pcoTopic == NULL)
+	{
 		return ERR_NODATA;
+	}
 	c.SetTopic(pcoTopic->id());
 	return RES_OK;
 }
diff --git a/campsite/implementation/parser/parser/lex.cpp b/campsite/implementation/parser/parser/lex.cpp
index 39b4015bc..79ef56efb 100644
--- a/campsite/implementation/parser/parser/lex.cpp
+++ b/campsite/implementation/parser/parser/lex.cpp
@@ -371,6 +371,7 @@ int CStatementMap::InitStatements()
 	pcoSt = new CStatement(CMS_ST_TOPIC, ST_TOPIC);
 
 	pcoCtx = new CStatementContext(CMS_CT_DEFAULT);
+	pcoCtx->insertAttr(new CIntegerAttr("identifier"));
 	pcoCtx->insertAttr(new CTopicAttr("name"));
 	pcoCtx->insertAttr(new CAttribute("off"));
 	pcoCtx->insertAttr(new CAttribute("default"));
@@ -381,8 +382,8 @@ int CStatementMap::InitStatements()
 	pcoSt->insertCtx(pcoCtx);
 
 	pcoCtx = new CStatementContext(CMS_CT_PRINT);
-	pcoCtx->insertAttr(new CTopicAttr("identifier"));
-	pcoCtx->insertAttr(new CTopicAttr("name"));
+	pcoCtx->insertAttr(new CIntegerAttr("identifier"));
+	pcoCtx->insertAttr(new CStringAttr("name"));
 	pcoSt->insertCtx(pcoCtx);
 
 	this->insert(pcoSt);

