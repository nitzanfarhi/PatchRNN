commit da28d966f6aa942ae836d09729f76a1647932309
Author: Richard Guy Briggs <rbriggs@redhat.com>
Date:   Tue Feb 12 19:39:44 2013 +0000

    thermal: return an error on failure to register thermal class
    
    The return code from the registration of the thermal class is used to
    unallocate resources, but this failure isn't passed back to the caller of
    thermal_init.  Return this failure back to the caller.
    
    This bug was introduced in changeset 4cb18728 which overwrote the return code
    when the variable was re-used to catch the return code of the registration of
    the genetlink thermal socket family.
    
    Signed-off-by: Richard Guy Briggs <rbriggs@redhat.com>
    Signed-off-by: Zhang Rui <rui.zhang@intel.com>

diff --git a/drivers/thermal/thermal_sys.c b/drivers/thermal/thermal_sys.c
index 6472e7e9f969..1a19a2f4ba27 100644
--- a/drivers/thermal/thermal_sys.c
+++ b/drivers/thermal/thermal_sys.c
@@ -1875,6 +1875,7 @@ static int __init thermal_init(void)
 		idr_destroy(&thermal_cdev_idr);
 		mutex_destroy(&thermal_idr_lock);
 		mutex_destroy(&thermal_list_lock);
+		return result;
 	}
 	result = genetlink_init();
 	return result;

