commit 2fe7267d53b41529efc150d6f95ca7300965f649
Author: foobar <sniper@php.net>
Date:   Sun Apr 15 23:06:08 2007 +0000

    MFH: Simplify previous patch.

diff --git a/sapi/cgi/cgi_main.c b/sapi/cgi/cgi_main.c
index e4d0e52761..e8f277cfc3 100644
--- a/sapi/cgi/cgi_main.c
+++ b/sapi/cgi/cgi_main.c
@@ -1738,16 +1738,13 @@ consult the installation file that came with this distribution, or visit \n\
 						php_get_highlight_struct(&syntax_highlighter_ini);
 						zend_highlight(&syntax_highlighter_ini TSRMLS_CC);
 #if PHP_FASTCGI
-						if (!fastcgi)
-#endif
-						{
-							fclose(file_handle.handle.fp);
-							php_end_ob_buffers(1 TSRMLS_CC);
+						if (fastcgi) {
+							goto fastcgi_request_done;
 						}
-					}
-#if PHP_FASTCGI
-					if (!fastcgi)
 #endif
+						fclose(file_handle.handle.fp);
+						php_end_ob_buffers(1 TSRMLS_CC);
+					}
 					return SUCCESS;
 				}
 				break;

