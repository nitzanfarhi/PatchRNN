commit 6bd851a7a3d0f9cf5c0e991397432a17a6cf4526
Author: Zoltan Varga <vargaz@gmail.com>
Date:   Tue Apr 26 13:06:17 2011 +0200

    Modify fixup_cattrs () to handle a corner case where a cattr is created using a MonoCMethod instead of a ConstructorBuilder. Fixes #689533.

diff --git a/mono/metadata/reflection.c b/mono/metadata/reflection.c
index 46ce7a02d4c..fc0a6f60972 100644
--- a/mono/metadata/reflection.c
+++ b/mono/metadata/reflection.c
@@ -4325,7 +4325,7 @@ fixup_cattrs (MonoDynamicImage *assembly)
 			ctor = mono_g_hash_table_lookup (assembly->tokens, GUINT_TO_POINTER (token));
 			g_assert (ctor);
 
-			if (!strcmp (ctor->vtable->klass->name, "MonoCMethod")) {
+			if (!strcmp (ctor->vtable->klass->name, "MonoCMethod") || !strcmp (ctor->vtable->klass->name, "ConstructorBuilder")) {
 				MonoMethod *m = ((MonoReflectionMethod*)ctor)->method;
 				idx = GPOINTER_TO_UINT (g_hash_table_lookup (assembly->method_to_table_idx, m));
 				values [MONO_CUSTOM_ATTR_TYPE] = (idx << MONO_CUSTOM_ATTR_TYPE_BITS) | MONO_CUSTOM_ATTR_TYPE_METHODDEF;

