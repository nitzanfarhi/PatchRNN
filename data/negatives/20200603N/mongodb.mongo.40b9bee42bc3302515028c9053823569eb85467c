commit 40b9bee42bc3302515028c9053823569eb85467c
Author: Eliot Horowitz <eliot@10gen.com>
Date:   Wed Mar 16 11:52:55 2011 -0400

    movving logic from .h to .cpp

diff --git a/util/message.cpp b/util/message.cpp
index 653b5628e7..16ba4c4fca 100644
--- a/util/message.cpp
+++ b/util/message.cpp
@@ -773,4 +773,14 @@ again:
 
     TicketHolder connTicketHolder(DEFAULT_MAX_CONN);
 
+    int AbstractMessagingPort::getClientId() {
+        if ( _clientId == 0 ) {
+            int x = remotePort();
+            x = x << 16;
+            x |= ( ( 0xFF0 & (long long)this ) >> 9 ); // lowest byte in pointer often meaningless
+            _clientId = x;
+        }
+        return _clientId;
+    }
+
 } // namespace mongo
diff --git a/util/message.h b/util/message.h
index d5eacb2863..52979142b9 100644
--- a/util/message.h
+++ b/util/message.h
@@ -85,12 +85,10 @@ namespace mongo {
         virtual HostAndPort remote() const = 0;
         virtual unsigned remotePort() const = 0;
 
-        virtual int getClientId() {
-            int x = remotePort();
-            x = x << 16;
-            x |= ( ( 0xFF0 & (long long)this ) >> 8 ); // lowest byte in pointer often meaningless
-            return x;
-        }
+        virtual int getClientId();
+        
+    private:
+        int _clientId;
     };
 
     class MessagingPort : public AbstractMessagingPort {

