commit 9a7dc618c50902e7a171f2deda6430d52c277a95
Author: Martin Storsjö <martin@martin.st>
Date:   Thu Jan 26 21:37:38 2012 +0200

    libavcodec: Don't crash in avcodec_encode_audio if time_base isn't set
    
    Earlier, calling avcodec_encode_audio worked fine even if time_base
    wasn't set. Now it crashes due to trying to scale the output pts to
    the codec context time base. This affects e.g. VLC.
    
    If no time_base is set for audio codecs, set it to the sample
    rate.
    
    CC: libav-stable@libav.org
    Signed-off-by: Martin Storsjö <martin@martin.st>

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index fadfb0c0a..707ecb5fe 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -714,6 +714,12 @@ int attribute_align_arg avcodec_open2(AVCodecContext *avctx, AVCodec *codec, AVD
     }
     avctx->frame_number = 0;
 
+    if (avctx->codec_type == AVMEDIA_TYPE_AUDIO &&
+        (!avctx->time_base.num || !avctx->time_base.den)) {
+        avctx->time_base.num = 1;
+        avctx->time_base.den = avctx->sample_rate;
+    }
+
     if (HAVE_THREADS && !avctx->thread_opaque) {
         ret = ff_thread_init(avctx);
         if (ret < 0) {

