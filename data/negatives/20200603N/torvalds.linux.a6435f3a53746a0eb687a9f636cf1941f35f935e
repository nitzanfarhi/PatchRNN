commit a6435f3a53746a0eb687a9f636cf1941f35f935e
Author: Matt Carlson <mcarlson@broadcom.com>
Date:   Wed Feb 25 14:21:20 2009 +0000

    tg3: Fix 5906 link problems
    
    Commit 6833c043f9fc03696fde623914c4a0277df2a0bc introduced the phy
    auto-powerdown capability.  While the APD feature only works for 5761
    and 5784 asic revisions, the (harmless portion of the) code was applied
    to all 5705 and newer devices.  However, the 5906 phy departs from the
    usual design.  This commit was interfering with the 5906's ability to
    negotiate link against some switches.  This patch corrects the problem.
    
    Signed-off-by: Matt Carlson <mcarlson@broadcom.com>
    Signed-off-by: Benjamin Li <benli@broadcom.com>
    Signed-off-by: Michael Chan <mchan@broadcom.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/tg3.c b/drivers/net/tg3.c
index 67630fb8272e..c7bbbb19f000 100644
--- a/drivers/net/tg3.c
+++ b/drivers/net/tg3.c
@@ -1473,7 +1473,8 @@ static void tg3_phy_toggle_apd(struct tg3 *tp, bool enable)
 {
 	u32 reg;
 
-	if (!(tp->tg3_flags2 & TG3_FLG2_5705_PLUS))
+	if (!(tp->tg3_flags2 & TG3_FLG2_5705_PLUS) ||
+	    GET_ASIC_REV(tp->pci_chip_rev_id) == ASIC_REV_5906)
 		return;
 
 	reg = MII_TG3_MISC_SHDW_WREN |

