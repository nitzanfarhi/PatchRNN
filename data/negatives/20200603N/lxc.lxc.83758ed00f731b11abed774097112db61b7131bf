commit 83758ed00f731b11abed774097112db61b7131bf
Author: S.Çağlar Onur <caglar@10ur.org>
Date:   Wed Oct 30 16:10:26 2013 -0400

    daemonize implies close_all_fds so set it in lxcapi_want_daemonize instead of setting in every cli or in every binding explicitly
    
    Reported-by: Fatih Arslan <ftharsln@gmail.com>
    Signed-off-by: S.Çağlar Onur <caglar@10ur.org>
    Signed-off-by: Serge Hallyn <serge.hallyn@ubuntu.com>

diff --git a/src/lxc/lxc_start.c b/src/lxc/lxc_start.c
index 2e3c3b30..add2542f 100644
--- a/src/lxc/lxc_start.c
+++ b/src/lxc/lxc_start.c
@@ -96,7 +96,7 @@ static int my_parser(struct lxc_arguments* args, int c, char* arg)
 	switch (c) {
 	case 'c': args->console = arg; break;
 	case 'L': args->console_log = arg; break;
-	case 'd': args->daemonize = 1; args->close_all_fds = 1; break;
+	case 'd': args->daemonize = 1; break;
 	case 'f': args->rcfile = arg; break;
 	case 'C': args->close_all_fds = 1; break;
 	case 's': return lxc_config_define_add(&defines, arg);
diff --git a/src/lxc/lxccontainer.c b/src/lxc/lxccontainer.c
index 1254dc04..8b81a634 100644
--- a/src/lxc/lxccontainer.c
+++ b/src/lxc/lxccontainer.c
@@ -459,6 +459,8 @@ static void lxcapi_want_daemonize(struct lxc_container *c)
 		return;
 	}
 	c->daemonize = 1;
+	/* daemonize implies close_all_fds so set it */
+	c->lxc_conf->close_all_fds = 1;
 	container_mem_unlock(c);
 }
 

