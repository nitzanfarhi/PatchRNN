commit 9f1ab06d52870e4d6d92914dd96e6ee6c2918266
Author: Paul Wouters <pwouters@redhat.com>
Date:   Sat Mar 30 16:43:57 2013 -0400

    * pluto: don't log 0 bytes traffic stats for phase1 SA's
    
    We tried to determine the amount of traffic on ISAKMP SA's as well as
    IPsec SA's. We no longer log bogus 0byte traffic for ISAKMP SA's.

diff --git a/programs/pluto/state.c b/programs/pluto/state.c
index 7f5d6411c..72a4e0f8d 100644
--- a/programs/pluto/state.c
+++ b/programs/pluto/state.c
@@ -397,7 +397,8 @@ delete_state(struct state *st)
 
     DBG(DBG_CONTROL, DBG_log("deleting state #%lu", st->st_serialno));
 
-    if (st->st_esp.present) {
+    if (IS_IPSEC_SA_ESTABLISHED(st->st_state)) {
+      if (st->st_esp.present) {
         sbcp = humanize_number(st->st_esp.peer_bytes,
                                sbcp, sizeof(statebuf) - 1,
                                "ESP traffic information: in=%lu%s");
@@ -410,9 +411,9 @@ delete_state(struct state *st)
 	} else {
 	    libreswan_log(statebuf);
 	}
-    }
+      }
 
-    if (st->st_ah.present) {
+      if (st->st_ah.present) {
         sbcp = humanize_number(st->st_ah.peer_bytes,
                                sbcp, sizeof(statebuf) - 1,
                                "AH traffic information: in=%lu%s");
@@ -426,7 +427,7 @@ delete_state(struct state *st)
 	    libreswan_log(statebuf);
 	}
 
-    }
+      }
 
     if (st->st_ipcomp.present) {
         sbcp = humanize_number(st->st_ipcomp.peer_bytes,
@@ -441,6 +442,7 @@ delete_state(struct state *st)
 	} else {
 	    libreswan_log(statebuf);
 	}
+      }
     }
     
 #ifdef XAUTH_HAVE_PAM 

