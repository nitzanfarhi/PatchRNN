commit 71f8ba6b7e44fc525fb15a60997c0c5064c160e6
Author: Paulo Zanoni <paulo.r.zanoni@intel.com>
Date:   Fri May 3 12:15:39 2013 -0300

    drm/i915: check the power well on i915_pipe_enabled
    
    This fixes "unclaimed register" messages when the power well is
    disabled and there's a GPU hang.
    
    v2: Use the new intel_display_power_enabled().
    v3: Use the new domains for intel_display_power_enabled().
    
    Signed-off-by: Paulo Zanoni <paulo.r.zanoni@intel.com>
    Reviewed-by: Damien Lespiau <damien.lespiau@intel.com>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

diff --git a/drivers/gpu/drm/i915/i915_irq.c b/drivers/gpu/drm/i915/i915_irq.c
index 03a31befa8fd..161101f42717 100644
--- a/drivers/gpu/drm/i915/i915_irq.c
+++ b/drivers/gpu/drm/i915/i915_irq.c
@@ -384,6 +384,10 @@ i915_pipe_enabled(struct drm_device *dev, int pipe)
 	enum transcoder cpu_transcoder = intel_pipe_to_cpu_transcoder(dev_priv,
 								      pipe);
 
+	if (!intel_display_power_enabled(dev,
+		POWER_DOMAIN_TRANSCODER(cpu_transcoder)))
+		return false;
+
 	return I915_READ(PIPECONF(cpu_transcoder)) & PIPECONF_ENABLE;
 }
 

