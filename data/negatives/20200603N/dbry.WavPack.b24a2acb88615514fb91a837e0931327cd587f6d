commit b24a2acb88615514fb91a837e0931327cd587f6d
Author: David Bryant <david@wavpack.com>
Date:   Sun Jun 1 23:57:31 2008 +0000

    make sure WavPack bitstreams actually have data in them

diff --git a/src/unpack.c b/src/unpack.c
index c4d8802..3dcdffb 100644
--- a/src/unpack.c
+++ b/src/unpack.c
@@ -115,6 +115,9 @@ int unpack_init (WavpackContext *wpc)
 
 int init_wv_bitstream (WavpackStream *wps, WavpackMetadata *wpmd)
 {
+    if (!wpmd->byte_length)
+        return FALSE;
+
     bs_open_read (&wps->wvbits, wpmd->data, (uchar *) wpmd->data + wpmd->byte_length);
     return TRUE;
 }
@@ -124,6 +127,9 @@ int init_wv_bitstream (WavpackStream *wps, WavpackMetadata *wpmd)
 
 int init_wvc_bitstream (WavpackStream *wps, WavpackMetadata *wpmd)
 {
+    if (!wpmd->byte_length)
+        return FALSE;
+
     bs_open_read (&wps->wvcbits, wpmd->data, (uchar *) wpmd->data + wpmd->byte_length);
     return TRUE;
 }
@@ -139,6 +145,9 @@ int init_wvx_bitstream (WavpackStream *wps, WavpackMetadata *wpmd)
 {
     uchar *cp = wpmd->data;
 
+    if (wpmd->byte_length <= 4)
+        return FALSE;
+
     wps->crc_wvx = *cp++;
     wps->crc_wvx |= (int32_t) *cp++ << 8;
     wps->crc_wvx |= (int32_t) *cp++ << 16;

