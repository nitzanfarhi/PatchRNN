commit 646d79050ce0e35cc4aa6de21d225b2004055ddf
Author: unknown <msvensson@neptunus.(none)>
Date:   Tue Jan 17 16:48:26 2006 +0100

    Bug #14634 Running out of diskspace on tmpdir returns an inappropriate error
    
    
    sql/sql_select.cc:
      Backport from 5.0, catch the new errno that is returned

diff --git a/sql/sql_select.cc b/sql/sql_select.cc
index 5e29c98e2c8..5c5216b8561 100644
--- a/sql/sql_select.cc
+++ b/sql/sql_select.cc
@@ -5942,21 +5942,19 @@ do_select(JOIN *join,List<Item> *fields,TABLE *table,Procedure *procedure)
   }
   if (table)
   {
-    int tmp;
+    int tmp, new_errno= 0;
     if ((tmp=table->file->extra(HA_EXTRA_NO_CACHE)))
     {
       DBUG_PRINT("error",("extra(HA_EXTRA_NO_CACHE) failed"));
-      my_errno= tmp;
-      error= -1;
+      new_errno= tmp;
     }
     if ((tmp=table->file->ha_index_or_rnd_end()))
     {
       DBUG_PRINT("error",("ha_index_or_rnd_end() failed"));
-      my_errno= tmp;
-      error= -1;
+      new_errno= tmp;
     }
-    if (error == -1)
-      table->file->print_error(my_errno,MYF(0));
+    if (new_errno)
+      table->file->print_error(new_errno,MYF(0));
   }
 #ifndef DBUG_OFF
   if (error)

