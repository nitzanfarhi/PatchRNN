commit aa979a6acbb468b0ebe8cf36dc782a5b3cc1e28d
Author: Herton Ronaldo Krzesinski <herton@mandriva.com.br>
Date:   Wed Apr 9 16:38:31 2008 -0300

    rtl8187: Add missing priv->vif assignments
    
    This adds missing priv->vif assignments after "mac80211: don't use
    interface indices in drivers" change. As rtl8180, rtl8187 also needs
    priv->vif to be set, as without this an oops can happen in rtl8187_tx
    function (priv->vif is passed to ieee80211_rts_duration).
    
    Signed-off-by: Herton Ronaldo Krzesinski <herton@mandriva.com.br>
    Acked-by: Pavel Roskin <proski@gnu.org>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/rtl8187_dev.c b/drivers/net/wireless/rtl8187_dev.c
index f44505994a0e..133b3f39eeb6 100644
--- a/drivers/net/wireless/rtl8187_dev.c
+++ b/drivers/net/wireless/rtl8187_dev.c
@@ -509,6 +509,8 @@ static int rtl8187_add_interface(struct ieee80211_hw *dev,
 		return -EOPNOTSUPP;
 	}
 
+	priv->vif = conf->vif;
+
 	rtl818x_iowrite8(priv, &priv->map->EEPROM_CMD, RTL818X_EEPROM_CMD_CONFIG);
 	for (i = 0; i < ETH_ALEN; i++)
 		rtl818x_iowrite8(priv, &priv->map->MAC[i],
@@ -523,6 +525,7 @@ static void rtl8187_remove_interface(struct ieee80211_hw *dev,
 {
 	struct rtl8187_priv *priv = dev->priv;
 	priv->mode = IEEE80211_IF_TYPE_MNTR;
+	priv->vif = NULL;
 }
 
 static int rtl8187_config(struct ieee80211_hw *dev, struct ieee80211_conf *conf)

