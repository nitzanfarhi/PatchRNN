commit 820d18a6053fe01353e635d46b86a41f1344e8c0
Author: ellie timoney <ellie@fastmail.com>
Date:   Mon Sep 21 12:52:09 2015 +1000

    master: warn when file desc limit change is capped
    
    (... unless requesting "infinity", in which case capping is silent,
    you just get as many as you're allowed.  Really, you shouldn't be
    requesting infinity anyway.  Just don't leak them! :P)

diff --git a/master/master.c b/master/master.c
index 781eb8e8a..507a92c86 100644
--- a/master/master.c
+++ b/master/master.c
@@ -69,6 +69,7 @@
 #include <errno.h>
 #include <limits.h>
 #include <math.h>
+#include <inttypes.h>
 
 #ifndef INADDR_NONE
 #define INADDR_NONE 0xffffffff
@@ -1890,6 +1891,11 @@ static void limit_fds(rlim_t x)
 
 #ifdef HAVE_GETRLIMIT
     if (!getrlimit(RLIMIT_NUMFDS, &rl)) {
+        if (x != RLIM_INFINITY && rl.rlim_max != RLIM_INFINITY && x > rl.rlim_max) {
+            syslog(LOG_WARNING,
+                   "limit_fds: requested %" PRIu64 ", but capped to %" PRIu64,
+                   (uint64_t) x, (uint64_t) rl.rlim_max);
+        }
         rl.rlim_cur = (x == RLIM_INFINITY || x > rl.rlim_max) ? rl.rlim_max : x;
     }
     else

