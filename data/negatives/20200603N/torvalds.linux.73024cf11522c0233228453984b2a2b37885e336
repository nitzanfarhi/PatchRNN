commit 73024cf11522c0233228453984b2a2b37885e336
Author: Eric Sesterhenn <snakebyte@gmx.de>
Date:   Wed Jun 28 08:42:26 2006 +1000

    [XFS] Fix realtime subvolume expansion, a porting bug b0rked it.  Coverity
    made me look at this code (bug id #344). We only return with
    XFS_ERROR(EINVAL) if mp->m_rtdev_targp is valid and pass it otherwise to
    xfs_read_buf() where some function calls later it gets dereferenced by an
    assert.
    
    SGI-PV: 954266
    SGI-Modid: xfs-linux-melb:xfs-kern:26363a
    
    Signed-off-by: Eric Sesterhenn <snakebyte@gmx.de>
    Signed-off-by: Nathan Scott <nathans@sgi.com>

diff --git a/fs/xfs/xfs_rtalloc.c b/fs/xfs/xfs_rtalloc.c
index 0c1e42b037ef..5a0b678956e0 100644
--- a/fs/xfs/xfs_rtalloc.c
+++ b/fs/xfs/xfs_rtalloc.c
@@ -1929,7 +1929,7 @@ xfs_growfs_rt(
 	/*
 	 * Initial error checking.
 	 */
-	if (mp->m_rtdev_targp || mp->m_rbmip == NULL ||
+	if (mp->m_rtdev_targp == NULL || mp->m_rbmip == NULL ||
 	    (nrblocks = in->newblocks) <= sbp->sb_rblocks ||
 	    (sbp->sb_rblocks && (in->extsize != sbp->sb_rextsize)))
 		return XFS_ERROR(EINVAL);

