commit c9e00bee08680d90ef8bbf86a598bae935db81e6
Author: Adel Gadllah <adel.gadllah@gmail.com>
Date:   Sat Jul 19 18:48:52 2014 +0200

    plugin: Use the clutter xdisplay for has_swap_events
    
    The filter now runs on the backend connection.

diff --git a/src/gnome-shell-plugin.c b/src/gnome-shell-plugin.c
index 8edc7b69a..b1a704ace 100644
--- a/src/gnome-shell-plugin.c
+++ b/src/gnome-shell-plugin.c
@@ -174,7 +174,6 @@ gnome_shell_plugin_has_swap_event (GnomeShellPlugin *shell_plugin)
   const char * (* query_extensions_string) (Display *dpy, int screen);
   Bool (* query_extension) (Display *dpy, int *error, int *event);
   MetaScreen *screen;
-  MetaDisplay *display;
   Display *xdisplay;
   const char *glx_extensions;
 
@@ -183,9 +182,8 @@ gnome_shell_plugin_has_swap_event (GnomeShellPlugin *shell_plugin)
     return FALSE;
 
   screen = meta_plugin_get_screen (plugin);
-  display = meta_screen_get_display (screen);
 
-  xdisplay = meta_display_get_xdisplay (display);
+  xdisplay = clutter_x11_get_default_display ();
 
   query_extensions_string =
     (void *) cogl_get_proc_address ("glXQueryExtensionsString");

