commit 282c311e1a73178c798af0110ce57733d76ed801
Author: Orvid King <blah38621@gmail.com>
Date:   Tue Aug 25 10:40:41 2015 -0700

    Stub CALLEE_SAVED_BARRIER for MSVC
    
    Summary: There isn't a way to force MSVC to save the registers, so this will likely have to be done with a pair of assembly stubs.
    For now, just `always_assert(false);`.
    Closes https://github.com/facebook/hhvm/pull/6119
    
    Reviewed By: @sgolemon
    
    Differential Revision: D2375960

diff --git a/hphp/runtime/vm/jit/back-end-x64.cpp b/hphp/runtime/vm/jit/back-end-x64.cpp
index 2d9fca63ea..ba8572672d 100644
--- a/hphp/runtime/vm/jit/back-end-x64.cpp
+++ b/hphp/runtime/vm/jit/back-end-x64.cpp
@@ -72,6 +72,10 @@ struct BackEnd final : jit::BackEnd {
 #if defined(__CYGWIN__) || defined(__MINGW__)
   #define CALLEE_SAVED_BARRIER()                                    \
       asm volatile("" : : : "rbx", "rsi", "rdi", "r12", "r13", "r14", "r15");
+#elif defined(_MSC_VER)
+  // Unfortunately, we have no way to tell MSVC to do this, so we'll
+  // probably have to use a pair of assembly stubs to manage this.
+  #define CALLEE_SAVED_BARRIER() always_assert(false);
 #else
   #define CALLEE_SAVED_BARRIER()                                    \
       asm volatile("" : : : "rbx", "r12", "r13", "r14", "r15");

