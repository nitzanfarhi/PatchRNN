commit f83d4b17804f11a78a8c6f877543a7c55b734dd2
Author: naruse <naruse@b2dd03c8-39d4-4d8f-98ff-823fe69b080e>
Date:   Sun Jan 30 21:47:10 2011 +0000

    Additional fix for r30736
    
    git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/trunk@30739 b2dd03c8-39d4-4d8f-98ff-823fe69b080e

diff --git a/array.c b/array.c
index e776ebdc6a..1c94396907 100644
--- a/array.c
+++ b/array.c
@@ -3487,6 +3487,7 @@ rb_ary_uniq_bang(VALUE ary)
 	ARY_SET_LEN(ary, 0);
 	if (ARY_SHARED_P(ary) && !ARY_EMBED_P(ary)) {
 	    rb_ary_unshare(ary);
+	    FL_SET_EMBED(ary);
 	}
 	ary_resize_capa(ary, i);
 	st_foreach(RHASH_TBL(hash), push_value, ary);

