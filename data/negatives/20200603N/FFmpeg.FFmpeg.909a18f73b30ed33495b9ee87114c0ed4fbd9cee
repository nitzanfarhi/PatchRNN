commit 909a18f73b30ed33495b9ee87114c0ed4fbd9cee
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Fri Nov 9 12:43:51 2012 +0100

    mjpegbdec: dont return a picture when there is no picture.
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/mjpegbdec.c b/libavcodec/mjpegbdec.c
index 77f23f237f..796ef84260 100644
--- a/libavcodec/mjpegbdec.c
+++ b/libavcodec/mjpegbdec.c
@@ -136,6 +136,11 @@ read_header:
 
     //XXX FIXME factorize, this looks very similar to the EOI code
 
+    if(!s->got_picture) {
+        av_log(avctx, AV_LOG_WARNING, "no picture\n");
+        return buf_size;
+    }
+
     *picture= *s->picture_ptr;
     *data_size = sizeof(AVFrame);
 

