commit 3b97121933b9f93f82d205fa25e999d902b612b9
Author: Morris Jette <jette@schedmd.com>
Date:   Tue Jul 3 10:20:05 2012 -0700

    Correction to logic for port range in slurm.conf node configuration

diff --git a/src/common/node_conf.c b/src/common/node_conf.c
index 34442c4747..213cc0b174 100644
--- a/src/common/node_conf.c
+++ b/src/common/node_conf.c
@@ -179,7 +179,8 @@ static int _build_single_nodeline_info(slurm_conf_node_t *node_ptr,
 		error_code = errno;
 		goto cleanup;
 	}
-	if (node_ptr->port_str[0] && (node_ptr->port_str[0] != '[') &&
+	if (node_ptr->port_str && node_ptr->port_str[0] &&
+	    (node_ptr->port_str[0] != '[') &&
 	    (strchr(node_ptr->port_str, '-') ||
 	     strchr(node_ptr->port_str, ','))) {
 		xstrfmtcat(port_str, "[%s]", node_ptr->port_str);
diff --git a/src/common/read_config.c b/src/common/read_config.c
index 2e953b376b..e14959ef37 100644
--- a/src/common/read_config.c
+++ b/src/common/read_config.c
@@ -1290,7 +1290,8 @@ static int _register_conf_node_aliases(slurm_conf_node_t *node_ptr)
 		goto cleanup;
 	}
 
-	if (node_ptr->port_str[0] && (node_ptr->port_str[0] != '[') &&
+	if (node_ptr->port_str && node_ptr->port_str[0] &&
+	    (node_ptr->port_str[0] != '[') &&
 	    (strchr(node_ptr->port_str, '-') ||
 	     strchr(node_ptr->port_str, ','))) {
 		xstrfmtcat(port_str, "[%s]", node_ptr->port_str);
@@ -1358,7 +1359,7 @@ static int _register_conf_node_aliases(slurm_conf_node_t *node_ptr)
 			address = hostlist_shift(address_list);
 		if ((hostname_count > 1) || (hostname == NULL))
 			hostname = hostlist_shift(hostname_list);
-		if ((port_count > 1) || (port_str == NULL)) {
+		if ((port_count > 1) && (port_str == NULL)) {
 			int port_int;
 			port_str = hostlist_shift(port_list);
 			port_int = atoi(port_str);

