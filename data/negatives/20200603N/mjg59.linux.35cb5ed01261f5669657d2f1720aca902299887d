commit 35cb5ed01261f5669657d2f1720aca902299887d
Author: Frédéric Weisbecker <fweisbec@gmail.com>
Date:   Sun Sep 21 20:10:14 2008 +0200

    tracing/ftrace: make nop tracer reset previous entries
    
    If nop tracer is selected, some old entries from the previous tracer
    could still be enqueued. Tracing have to be reset.
    
    Signed-off-by: Frederic Weisbecker <fweisbec@gmail.com>
    Cc: Steven Rostedt <rostedt@goodmis.org>
    Cc: Steven Noonan <steven@uplinklabs.net>
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/kernel/trace/trace_nop.c b/kernel/trace/trace_nop.c
index dafaefb84038..9fb02c17ad0c 100644
--- a/kernel/trace/trace_nop.c
+++ b/kernel/trace/trace_nop.c
@@ -26,8 +26,12 @@ static void stop_nop_trace(struct trace_array *tr)
 
 static void nop_trace_init(struct trace_array *tr)
 {
+	int cpu;
 	ctx_trace = tr;
 
+	for_each_online_cpu(cpu)
+		tracing_reset(tr->data[cpu]);
+
 	if (tr->ctrl)
 		start_nop_trace(tr);
 }

