commit 81d9ddae856678c45297550e9353c8a5a7fd6438
Author: Patrick McHardy <kaber@trash.net>
Date:   Tue Nov 13 02:58:44 2007 -0800

    [NETFILTER]: bridge: fix double POSTROUTING hook invocation
    
    Packets routed between bridges have the POST_ROUTING hook invoked
    twice since bridging mistakes them for bridged packets because
    they have skb->nf_bridge set.
    
    Signed-off-by: Patrick McHardy <kaber@trash.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/bridge/br_netfilter.c b/net/bridge/br_netfilter.c
index da22f900e89d..c1757c79dfbb 100644
--- a/net/bridge/br_netfilter.c
+++ b/net/bridge/br_netfilter.c
@@ -766,6 +766,9 @@ static unsigned int br_nf_post_routing(unsigned int hook, struct sk_buff *skb,
 	if (!nf_bridge)
 		return NF_ACCEPT;
 
+	if (!(nf_bridge->mask & (BRNF_BRIDGED | BRNF_BRIDGED_DNAT)))
+		return NF_ACCEPT;
+
 	if (!realoutdev)
 		return NF_DROP;
 

