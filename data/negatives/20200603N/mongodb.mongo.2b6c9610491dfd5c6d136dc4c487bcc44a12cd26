commit 2b6c9610491dfd5c6d136dc4c487bcc44a12cd26
Author: Siyuan Zhou <siyuan.zhou@mongodb.com>
Date:   Mon Jun 22 21:30:49 2015 -0400

    SERVER-19059 Mismatch in protocolVersion field

diff --git a/src/mongo/db/repl/replica_set_config.cpp b/src/mongo/db/repl/replica_set_config.cpp
index eef500a232..70bc115647 100644
--- a/src/mongo/db/repl/replica_set_config.cpp
+++ b/src/mongo/db/repl/replica_set_config.cpp
@@ -132,15 +132,6 @@ Status ReplicaSetConfig::initialize(const BSONObj& cfg) {
     if (!status.isOK())
         return status;
 
-    //
-    // Parse protocol version
-    //
-    BSONElement protocolVersionElement;
-    status = bsonExtractIntegerField(cfg, kProtocolVersionFieldName, &_protocolVersion);
-    if (!status.isOK() && status != ErrorCodes::NoSuchKey) {
-        return status;
-    }
-
     _calculateMajorities();
     _addInternalWriteConcernModes();
     _isInitialized = true;
@@ -246,6 +237,15 @@ Status ReplicaSetConfig::_parseSettingsSubdocument(const BSONObj& settings) {
         }
         _customWriteConcernModes[modeElement.fieldNameStringData()] = pattern;
     }
+
+    //
+    // Parse protocol version
+    //
+    status = bsonExtractIntegerField(settings, kProtocolVersionFieldName, &_protocolVersion);
+    if (!status.isOK() && status != ErrorCodes::NoSuchKey) {
+        return status;
+    }
+
     return Status::OK();
 }
 

