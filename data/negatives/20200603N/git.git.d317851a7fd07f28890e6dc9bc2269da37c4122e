commit d317851a7fd07f28890e6dc9bc2269da37c4122e
Author: Johannes Sixt <johannes.sixt@telecom.at>
Date:   Tue Sep 23 08:52:16 2008 +0200

    compat/mingw: Support a timeout in the poll emulation if no fds are given
    
    Our poll() emulation did not support the timeout argument. With this patch
    we support it for the simple case where poll() does not need to wait on
    file descriptors as well because this case amounts to a mere Sleep().
    
    This is needed if the user sets help.autocorrect is set to a positive
    value.
    
    Signed-off-by: Johannes Sixt <johannes.sixt@telecom.at>
    Signed-off-by: Shawn O. Pearce <spearce@spearce.org>

diff --git a/compat/mingw.c b/compat/mingw.c
index ccfa2a0a3..7eed60db1 100644
--- a/compat/mingw.c
+++ b/compat/mingw.c
@@ -263,8 +263,13 @@ int poll(struct pollfd *ufds, unsigned int nfds, int timeout)
 {
 	int i, pending;
 
-	if (timeout != -1)
+	if (timeout >= 0) {
+		if (nfds == 0) {
+			Sleep(timeout);
+			return 0;
+		}
 		return errno = EINVAL, error("poll timeout not supported");
+	}
 
 	/* When there is only one fd to wait for, then we pretend that
 	 * input is available and let the actual wait happen when the

