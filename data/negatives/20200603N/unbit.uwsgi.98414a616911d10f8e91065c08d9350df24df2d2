commit 98414a616911d10f8e91065c08d9350df24df2d2
Author: roberto@localhost.localdomain <roberto@localhost.localdomain>
Date:   Thu Oct 29 12:37:42 2009 +0100

    real fix for mod_uwsgi

diff --git a/apache2/mod_uwsgi.c b/apache2/mod_uwsgi.c
index 4addbd97..e5801d7f 100644
--- a/apache2/mod_uwsgi.c
+++ b/apache2/mod_uwsgi.c
@@ -199,9 +199,14 @@ static int uwsgi_handler(request_rec *r) {
 	}
 	else {
 		if (r->path_info) {
-			ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, "uwsgi: PATH_INFO: %s", r->path_info);
-			vecptr = uwsgi_add_var(uwsgi_vars, vecptr, "SCRIPT_NAME", apr_pstrndup(r->pool, r->uri, (strlen(r->uri) - strlen(r->path_info) )) , &pkt_size) ;
-			vecptr = uwsgi_add_var(uwsgi_vars, vecptr, "PATH_INFO", r->path_info, &pkt_size) ;
+			if (strlen(r->path_info) <= 0) {
+				vecptr = uwsgi_add_var(uwsgi_vars, vecptr, "SCRIPT_NAME", "", &pkt_size) ;
+				vecptr = uwsgi_add_var(uwsgi_vars, vecptr, "PATH_INFO", r->uri, &pkt_size) ;
+			}
+			else {
+				vecptr = uwsgi_add_var(uwsgi_vars, vecptr, "SCRIPT_NAME", apr_pstrndup(r->pool, r->uri, (strlen(r->uri) - strlen(r->path_info) )) , &pkt_size) ;
+				vecptr = uwsgi_add_var(uwsgi_vars, vecptr, "PATH_INFO", r->path_info, &pkt_size) ;
+			}
 		}
 		else {
 			vecptr = uwsgi_add_var(uwsgi_vars, vecptr, "SCRIPT_NAME", "", &pkt_size) ;

