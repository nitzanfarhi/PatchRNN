commit 5203e56b6b338ebe19cb5433c609f9f5eb7d12b7
Author: Jerry Jelinek <jerry.jelinek@joyent.com>
Date:   Wed Sep 6 15:09:43 2017 +0000

    9063 improve procfs exit handling
    Reviewed by: Patrick Mooney <patrick.mooney@joyent.com>
    Reviewed by: Jason King <jason.king@joyent.com>
    Approved by: Joshua M. Clulow <josh@sysmgr.org>

diff --git a/usr/src/uts/common/fs/proc/prvnops.c b/usr/src/uts/common/fs/proc/prvnops.c
index 9a08f0c030..fdef53dc2e 100644
--- a/usr/src/uts/common/fs/proc/prvnops.c
+++ b/usr/src/uts/common/fs/proc/prvnops.c
@@ -3596,7 +3596,7 @@ pr_lookup_procdir(vnode_t *dp, char *comp)
 		/* initialize the new prcommon struct */
 		if ((p->p_flag & SSYS) || p->p_as == &kas)
 			pcp->prc_flags |= PRC_SYS;
-		if (p->p_stat == SZOMB)
+		if (p->p_stat == SZOMB || (p->p_flag & SEXITING) != 0)
 			pcp->prc_flags |= PRC_DESTROY;
 		pcp->prc_proc = p;
 		pcp->prc_datamodel = p->p_model;

