commit 3d6b4ea4b6bd5855205bbfe1bfd023844fa5e964
Author: wm4 <wm4@nowhere>
Date:   Fri May 24 17:47:01 2013 +0200

    stream: kill memory streams
    
    These are unused by now, and it relied on some assumptions that have
    been broken by now.

diff --git a/stream/stream.c b/stream/stream.c
index b6f15348fb..3f7983e294 100644
--- a/stream/stream.c
+++ b/stream/stream.c
@@ -137,6 +137,8 @@ static const stream_info_t *const auto_open_streams[] = {
     NULL
 };
 
+static stream_t *new_stream(int fd, int type);
+
 static stream_t *open_stream_plugin(const stream_info_t *sinfo,
                                     const char *filename,
                                     int mode, struct MPOpts *options,
@@ -626,26 +628,7 @@ void stream_update_size(stream_t *s)
     }
 }
 
-stream_t *new_memory_stream(unsigned char *data, int len)
-{
-    stream_t *s;
-
-    if (len < 0)
-        return NULL;
-    s = calloc(1, sizeof(stream_t) + len);
-    s->fd = -1;
-    s->type = STREAMTYPE_MEMORY;
-    s->buf_pos = 0;
-    s->buf_len = len;
-    s->start_pos = 0;
-    s->end_pos = len;
-    stream_reset(s);
-    s->pos = len;
-    memcpy(s->buffer, data, len);
-    return s;
-}
-
-stream_t *new_stream(int fd, int type)
+static stream_t *new_stream(int fd, int type)
 {
     stream_t *s = talloc_zero(NULL, stream_t);
 
diff --git a/stream/stream.h b/stream/stream.h
index 5d74433c0b..5b6da3af9a 100644
--- a/stream/stream.h
+++ b/stream/stream.h
@@ -40,7 +40,6 @@
 #define STREAMTYPE_VCD  1      // raw mode-2 CDROM reading, 2324 bytes/sector
 #define STREAMTYPE_STREAM 2    // same as FILE but no seeking (for net/stdin)
 #define STREAMTYPE_DVD  3      // libdvdread
-#define STREAMTYPE_MEMORY  4   // read data from memory area
 #define STREAMTYPE_PLAYLIST 6  // FIXME!!! same as STREAMTYPE_FILE now
 #define STREAMTYPE_CDDA 10     // raw audio CD reader
 #define STREAMTYPE_SMB 11      // smb:// url, using libsmbclient (samba)
@@ -328,9 +327,7 @@ struct bstr stream_read_complete(struct stream *s, void *talloc_ctx,
 void stream_reset(stream_t *s);
 int stream_control(stream_t *s, int cmd, void *arg);
 void stream_update_size(stream_t *s);
-stream_t *new_stream(int fd, int type);
 void free_stream(stream_t *s);
-stream_t *new_memory_stream(unsigned char *data, int len);
 stream_t *open_stream(const char *filename, struct MPOpts *options,
                       int *file_format);
 stream_t *open_output_stream(const char *filename, struct MPOpts *options);

