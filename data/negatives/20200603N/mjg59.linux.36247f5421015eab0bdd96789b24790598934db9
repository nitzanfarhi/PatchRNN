commit 36247f5421015eab0bdd96789b24790598934db9
Author: Herbert Xu <herbert@gondor.apana.org.au>
Date:   Wed May 23 14:30:44 2007 -0700

    [NET_SCHED]: Fix qdisc_restart return value when dequeue is empty
    
    My previous patch that changed the return value of qdisc_restart
    incorrectly made the case where dequeue returns empty continue
    processing packets.
    
    This patch is based on diagnosis and fix by Patrick McHardy.
    
    Reported-and-debugged-by: Anant Nitya <kernel@prachanda.info>
    
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/sched/sch_generic.c b/net/sched/sch_generic.c
index f28bb2dc58d0..cbefe225581e 100644
--- a/net/sched/sch_generic.c
+++ b/net/sched/sch_generic.c
@@ -169,8 +169,8 @@ requeue:
 		else
 			q->ops->requeue(skb, q);
 		netif_schedule(dev);
-		return 0;
 	}
+	return 0;
 
 out:
 	BUG_ON((int) q->q.qlen < 0);

