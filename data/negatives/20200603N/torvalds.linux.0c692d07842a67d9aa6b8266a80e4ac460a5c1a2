commit 0c692d07842a67d9aa6b8266a80e4ac460a5c1a2
Author: Levente Kurusa <levex@linux.com>
Date:   Thu Jan 30 15:45:46 2014 -0800

    drivers/net/phy/mdio_bus.c: call put_device on device_register() failure
    
    It is required to call put_device() if device_register() fails, so that
    we give up the last reference to the device.  Calling put_device allows
    for mdiobus_release to be executed, kfreeing the bus.
    
    Signed-off-by: Levente Kurusa <levex@linux.com>
    Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Cc: Grant Likely <grant.likely@secretlab.ca>
    Cc: David Daney <david.daney@cavium.com>
    Cc: David S. Miller <davem@davemloft.net>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/net/phy/mdio_bus.c b/drivers/net/phy/mdio_bus.c
index 930694d3a13f..71e49000fbf3 100644
--- a/drivers/net/phy/mdio_bus.c
+++ b/drivers/net/phy/mdio_bus.c
@@ -150,6 +150,7 @@ int mdiobus_register(struct mii_bus *bus)
 	err = device_register(&bus->dev);
 	if (err) {
 		pr_err("mii_bus %s failed to register\n", bus->id);
+		put_device(&bus->dev);
 		return -EINVAL;
 	}
 

