commit 1d679de58e886e134c5569c542667a08f0faedd6
Author: Carlos Martín Nieto <cmn@elego.de>
Date:   Wed Mar 16 17:06:17 2011 +0100

    make_absolute_path: return the input path if it points to our buffer
    
    Some codepaths call make_absolute_path with its own return value as
    input. In such a cases, return the path immediately.
    
    This fixes a valgrind-discovered error, whereby we tried to copy a
    string onto itself.
    
    Signed-off-by: Carlos Martín Nieto <cmn@elego.de>
    Signed-off-by: Junio C Hamano <gitster@pobox.com>

diff --git a/abspath.c b/abspath.c
index 91ca00f05..ff140689e 100644
--- a/abspath.c
+++ b/abspath.c
@@ -24,6 +24,10 @@ const char *make_absolute_path(const char *path)
 	char *last_elem = NULL;
 	struct stat st;
 
+	/* We've already done it */
+	if (path == buf || path == next_buf)
+		return path;
+
 	if (strlcpy(buf, path, PATH_MAX) >= PATH_MAX)
 		die ("Too long path: %.*s", 60, path);
 

