commit 1a7fa543cb5d8185d293a03842b33136d8dcc04c
Author: Takashi Iwai <tiwai@suse.de>
Date:   Fri Jul 6 12:27:25 2007 +0200

    [ALSA] Fix substream to check in PCM drain
    
    The check of a substream in snd_pcm_drain() might not be always correct
    since runtime can point a different substream (although the PCM state
    of each linked substream should be same, in theory).
    This patch fixes it.
    
    Signed-off-by: Takashi Iwai <tiwai@suse.de>
    Signed-off-by: Jaroslav Kysela <perex@suse.cz>

diff --git a/sound/core/pcm_native.c b/sound/core/pcm_native.c
index a96733a5beb8..59b29cd482ae 100644
--- a/sound/core/pcm_native.c
+++ b/sound/core/pcm_native.c
@@ -1487,7 +1487,7 @@ static int snd_pcm_drain(struct snd_pcm_substream *substream)
 
 	snd_pcm_stream_lock_irq(substream);
 	/* resume pause */
-	if (runtime->status->state == SNDRV_PCM_STATE_PAUSED)
+	if (substream->runtime->status->state == SNDRV_PCM_STATE_PAUSED)
 		snd_pcm_pause(substream, 0);
 
 	/* pre-start/stop - all running streams are changed to DRAINING state */

