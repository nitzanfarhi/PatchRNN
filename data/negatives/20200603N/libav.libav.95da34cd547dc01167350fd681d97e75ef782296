commit 95da34cd547dc01167350fd681d97e75ef782296
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Sat Oct 28 20:00:05 2006 +0000

    CANDIDATE_MB_TYPE_INTER heuristic doesnt work at really low quality where the distortion becomes less relevant then the overhead of intra blocks
    
    Originally committed as revision 6829 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavcodec/motion_est.c b/libavcodec/motion_est.c
index 83733a84a..fb32ec591 100644
--- a/libavcodec/motion_est.c
+++ b/libavcodec/motion_est.c
@@ -1299,7 +1299,8 @@ void ff_estimate_p_frame_motion(MpegEncContext * s,
 
         if (vard*2 + 200*256 > varc)
             mb_type|= CANDIDATE_MB_TYPE_INTRA;
-        if (varc*2 + 200*256 > vard){
+        if (varc*2 + 200*256 > vard || s->qscale > 24){
+//        if (varc*2 + 200*256 + 50*(s->lambda2>>FF_LAMBDA_SHIFT) > vard){
             mb_type|= CANDIDATE_MB_TYPE_INTER;
             c->sub_motion_search(s, &mx, &my, dmin, 0, 0, 0, 16);
             if(s->flags&CODEC_FLAG_MV0)

