commit daf73d5d17012eac2f2b9bcbfc6297e2de8d8676
Author: Paul B Mahol <onemda@gmail.com>
Date:   Fri Apr 17 14:29:06 2015 +0000

    avcodec/g729dec: support decoding packets with multiple frames
    
    Signed-off-by: Paul B Mahol <onemda@gmail.com>

diff --git a/libavcodec/g729dec.c b/libavcodec/g729dec.c
index 6eb057f5d8..e97677b5c9 100644
--- a/libavcodec/g729dec.c
+++ b/libavcodec/g729dec.c
@@ -421,7 +421,7 @@ static int decode_frame(AVCodecContext *avctx, void *data, int *got_frame_ptr,
         return ret;
     out_frame = (int16_t*) frame->data[0];
 
-    if (buf_size == 10) {
+    if (buf_size % 10 == 0) {
         packet_type = FORMAT_G729_8K;
         format = &format_g729_8k;
         //Reset voice decision
@@ -711,7 +711,7 @@ static int decode_frame(AVCodecContext *avctx, void *data, int *got_frame_ptr,
     memmove(ctx->exc_base, ctx->exc_base + 2 * SUBFRAME_SIZE, (PITCH_DELAY_MAX+INTERPOL_LEN)*sizeof(int16_t));
 
     *got_frame_ptr = 1;
-    return buf_size;
+    return packet_type == FORMAT_G729_8K ? 10 : 8;
 }
 
 AVCodec ff_g729_decoder = {
@@ -722,5 +722,5 @@ AVCodec ff_g729_decoder = {
     .priv_data_size = sizeof(G729Context),
     .init           = decoder_init,
     .decode         = decode_frame,
-    .capabilities   = CODEC_CAP_DR1,
+    .capabilities   = CODEC_CAP_SUBFRAMES | CODEC_CAP_DR1,
 };

