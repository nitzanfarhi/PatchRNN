commit 2d475fd27be5c807a8a6bede0a45c4baab5057b0
Author: Jonas Oreland <jonas@mysql.com>
Date:   Thu Nov 4 10:48:03 2010 +0100

    ndb - store primary tableid in keydescriptor

diff --git a/storage/ndb/src/kernel/blocks/dbdict/Dbdict.cpp b/storage/ndb/src/kernel/blocks/dbdict/Dbdict.cpp
index b04056d8865..5ffd7bdbe0c 100644
--- a/storage/ndb/src/kernel/blocks/dbdict/Dbdict.cpp
+++ b/storage/ndb/src/kernel/blocks/dbdict/Dbdict.cpp
@@ -6176,6 +6176,17 @@ Dbdict::createTab_local(Signal* signal,
     KeyDescriptor* desc= g_key_descriptor_pool.getPtr(tabPtr.i);
     new (desc) KeyDescriptor();
 
+    if (tabPtr.p->primaryTableId == RNIL)
+    {
+      jam();
+      desc->primaryTableId = createTabPtr.p->m_request.tableId;
+    }
+    else
+    {
+      jam();
+      desc->primaryTableId = tabPtr.p->primaryTableId;
+    }
+
     Uint32 key = 0;
     Ptr<AttributeRecord> attrPtr;
     LocalDLFifoList<AttributeRecord> list(c_attributeRecordPool,
diff --git a/storage/ndb/src/kernel/vm/KeyDescriptor.hpp b/storage/ndb/src/kernel/vm/KeyDescriptor.hpp
index 6ff3a4248b2..29200b5eb52 100644
--- a/storage/ndb/src/kernel/vm/KeyDescriptor.hpp
+++ b/storage/ndb/src/kernel/vm/KeyDescriptor.hpp
@@ -26,9 +26,11 @@
 struct KeyDescriptor
 {
   KeyDescriptor () { 
+    primaryTableId = RNIL;
     noOfKeyAttr = hasCharAttr = noOfDistrKeys = noOfVarKeys = 0; 
   }
   
+  Uint32 primaryTableId;
   Uint8 noOfKeyAttr;
   Uint8 hasCharAttr;
   Uint8 noOfDistrKeys;

