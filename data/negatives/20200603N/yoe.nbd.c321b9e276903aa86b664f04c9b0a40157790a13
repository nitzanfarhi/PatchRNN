commit c321b9e276903aa86b664f04c9b0a40157790a13
Author: Wouter Verhelst <w@uter.be>
Date:   Sat Nov 7 16:05:24 2015 +0100

    Fix a few logic reversals

diff --git a/nbdsrv.c b/nbdsrv.c
index af6ac60..c44bb20 100644
--- a/nbdsrv.c
+++ b/nbdsrv.c
@@ -269,10 +269,10 @@ int exptrim(struct nbd_request* req, CLIENT* client) {
 			next.fhandle = -1;
 			next.startoff = client->exportsize;
 		}
-		if(cur.startoff <= req->from && next.startoff - cur.startoff <= req->len) {
+		if(cur.startoff <= req->from && next.startoff - cur.startoff >= req->len) {
 			off_t reqoff = req->from - cur.startoff;
 			off_t curlen = next.startoff - reqoff;
-			off_t reqlen = curlen - reqoff > req->len ? curlen - reqoff : req->len;
+			off_t reqlen = curlen - reqoff > req->len ? req->len : curlen - reqoff;
 			punch_hole(cur.fhandle, reqoff, reqlen);
 		}
 		cur = next;

