commit 9ac33b2b749e9539e84bbb1a41f97b066c4bd757
Author: Christoph Lameter <clameter@sgi.com>
Date:   Tue Mar 4 12:24:22 2008 -0800

    slab numa fallback logic: Do not pass unfiltered flags to page allocator
    
    The NUMA fallback logic should be passing local_flags to kmem_get_pages() and not simply the
    flags passed in.
    
    Reviewed-by: Pekka Enberg <penberg@cs.helsinki.fi>
    Signed-off-by: Christoph Lameter <clameter@sgi.com>

diff --git a/mm/slab.c b/mm/slab.c
index 473e6c2eaefb..5d16c8a30499 100644
--- a/mm/slab.c
+++ b/mm/slab.c
@@ -3280,7 +3280,7 @@ static void *fallback_alloc(struct kmem_cache *cache, gfp_t flags)
 		if (local_flags & __GFP_WAIT)
 			local_irq_enable();
 		kmem_flagcheck(cache, flags);
-		obj = kmem_getpages(cache, flags, -1);
+		obj = kmem_getpages(cache, local_flags, -1);
 		if (local_flags & __GFP_WAIT)
 			local_irq_disable();
 		if (obj) {

