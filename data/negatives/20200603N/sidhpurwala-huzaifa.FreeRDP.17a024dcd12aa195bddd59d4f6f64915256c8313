commit 17a024dcd12aa195bddd59d4f6f64915256c8313
Author: Armin Novak <anovak@thinstuff.com>
Date:   Wed Oct 23 12:16:23 2013 +0200

    Returing WAIT_TIMEOUT for MUTEX objects now too.

diff --git a/winpr/libwinpr/synch/wait.c b/winpr/libwinpr/synch/wait.c
index 6a7a55b8..f582438c 100644
--- a/winpr/libwinpr/synch/wait.c
+++ b/winpr/libwinpr/synch/wait.c
@@ -150,9 +150,7 @@ DWORD WaitForSingleObject(HANDLE hHandle, DWORD dwMilliseconds)
 
 				status = pthread_timedjoin_np(thread->thread, &thread_status, &timeout);
 				if (ETIMEDOUT == status)
-				{
 					return WAIT_TIMEOUT;
-				}
 			}
 			else
 				status = pthread_join(thread->thread, &thread_status);
@@ -180,7 +178,9 @@ DWORD WaitForSingleObject(HANDLE hHandle, DWORD dwMilliseconds)
 			clock_gettime(CLOCK_REALTIME, &timeout);
 			ts_add_ms(&timeout, dwMilliseconds);	
 
-			pthread_mutex_timedlock(&mutex->mutex, &timeout);
+			status = pthread_mutex_timedlock(&mutex->mutex, &timeout);
+			if (ETIMEDOUT == status)
+				return WAIT_TIMEOUT;
 		}
 		else
 		{

