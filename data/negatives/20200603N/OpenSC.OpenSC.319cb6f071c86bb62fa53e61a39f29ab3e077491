commit 319cb6f071c86bb62fa53e61a39f29ab3e077491
Author: vtarasov <vtarasov@c6295689-39f2-0310-b995-f0e70906c6a9>
Date:   Sun May 29 11:48:50 2011 +0000

    minidriver: when reading 'cardid' file return the content of 'cardid' file ...
    
    'cardid' size is 16 bytes.
    It's initialized by the 'empty-cardid' value (00-0F) overwritten (from left) by the last 16 (or less) bytes
    of the card's serial.
    
    
    git-svn-id: https://www.opensc-project.org/svnp/opensc/trunk@5513 c6295689-39f2-0310-b995-f0e70906c6a9

diff --git a/src/minidriver/minidriver.c b/src/minidriver/minidriver.c
index 1ee27798..a1df1447 100644
--- a/src/minidriver/minidriver.c
+++ b/src/minidriver/minidriver.c
@@ -769,14 +769,12 @@ DWORD WINAPI CardReadFile(__in PCARD_DATA pCardData,
 	{
 		if(strcmp(pszFileName, "cardid") == 0)
 		{
-			*pcbData = strlen(vs->p15card->tokeninfo->serial_number) + 10;
+			*pcbData = sizeof(vs->cardFiles.file_cardid);
 			*ppbData = pCardData->pfnCspAlloc(*pcbData);
 			if(!*ppbData)
-			{
 				return SCARD_E_NO_MEMORY;
-			}
 
-			strcpy(*ppbData, vs->p15card->tokeninfo->serial_number);
+			memcpy(*ppbData, &(vs->cardFiles.file_cardid), *pcbData);
 
 			logprintf(pCardData, 7, "return cardid ");
 			loghex(pCardData, 7, *ppbData, *pcbData);

