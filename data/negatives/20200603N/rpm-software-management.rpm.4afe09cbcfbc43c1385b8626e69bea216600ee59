commit 4afe09cbcfbc43c1385b8626e69bea216600ee59
Author: Panu Matilainen <pmatilai@redhat.com>
Date:   Fri Aug 18 12:43:27 2017 +0300

    Add a flag to allow quiet test for package existence with lookupPackage()
    
    Turning "flag" into an actual bitfield requires testing for
    PART_NAME/PART_SUBNAME differently, no actual changes here though.

diff --git a/build/rpmbuild_internal.h b/build/rpmbuild_internal.h
index c294d5ee2..439b7d3b5 100644
--- a/build/rpmbuild_internal.h
+++ b/build/rpmbuild_internal.h
@@ -138,6 +138,7 @@ struct Package_s {
 
 #define PART_SUBNAME  0
 #define PART_NAME     1
+#define PART_QUIET    2
 
 /** \ingroup rpmbuild
  * rpmSpec file parser states.
diff --git a/build/spec.c b/build/spec.c
index 17a9b7c5a..39599e284 100644
--- a/build/spec.c
+++ b/build/spec.c
@@ -73,7 +73,7 @@ rpmRC lookupPackage(rpmSpec spec, const char *name, int flag,Package *pkg)
     }
 
     /* Construct partial package name */
-    if (flag == PART_SUBNAME) {
+    if (!(flag & PART_NAME)) {
 	rasprintf(&fullName, "%s-%s",
 		 headerGetString(spec->packages->header, RPMTAG_NAME), name);
 	name = fullName;
@@ -87,12 +87,14 @@ rpmRC lookupPackage(rpmSpec spec, const char *name, int flag,Package *pkg)
 	}
     }
 
-    if (p == NULL && pkg != NULL) {
-	rpmlog(RPMLOG_ERR, _("line %d: %s: package %s does not exist\n"),
-				spec->lineNum, spec->line, name);
-    } else if (p != NULL && pkg == NULL) {
-	rpmlog(RPMLOG_ERR, _("line %d: %s: package %s already exists\n"),
-				spec->lineNum, spec->line, name);
+    if (!(flag & PART_QUIET)) {
+	if (p == NULL && pkg != NULL) {
+	    rpmlog(RPMLOG_ERR, _("line %d: %s: package %s does not exist\n"),
+				    spec->lineNum, spec->line, name);
+	} else if (p != NULL && pkg == NULL) {
+	    rpmlog(RPMLOG_ERR, _("line %d: %s: package %s already exists\n"),
+				    spec->lineNum, spec->line, name);
+	}
     }
 
     if (fullName == name)

