commit a8000cb480c8cfb612b039bf0382c41b9d6c7d45
Author: Richard Henderson <rth@twiddle.net>
Date:   Tue Apr 5 11:50:16 2016 -0700

    target/openrisc: Optimize l.jal to next
    
    This allows the tcg optimizer to see, and fold, all of the
    constants involved in a GOT base register load sequence.
    
    Reviewed-by: Philippe Mathieu-Daud√© <f4bug@amsat.org>
    Signed-off-by: Richard Henderson <rth@twiddle.net>

diff --git a/target/openrisc/translate.c b/target/openrisc/translate.c
index 66064e1829..cda84b61cb 100644
--- a/target/openrisc/translate.c
+++ b/target/openrisc/translate.c
@@ -198,7 +198,11 @@ static void gen_jump(DisasContext *dc, int32_t n26, uint32_t reg, uint32_t op0)
         tcg_gen_movi_tl(jmp_pc, tmp_pc);
         break;
     case 0x01:     /* l.jal */
-        tcg_gen_movi_tl(cpu_R[9], (dc->pc + 8));
+        tcg_gen_movi_tl(cpu_R[9], dc->pc + 8);
+        /* Optimize jal being used to load the PC for PIC.  */
+        if (tmp_pc == dc->pc + 8) {
+            return;
+        }
         tcg_gen_movi_tl(jmp_pc, tmp_pc);
         break;
     case 0x03:     /* l.bnf */

