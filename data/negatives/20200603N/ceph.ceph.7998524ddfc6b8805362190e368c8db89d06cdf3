commit 7998524ddfc6b8805362190e368c8db89d06cdf3
Author: Greg Farnum <greg@inktank.com>
Date:   Fri Jan 18 13:05:24 2013 -0800

    mds: ESubtreeMap event now uses modern encoding
    
    Signed-off-by: Greg Farnum <greg@inktank.com>

diff --git a/src/mds/events/ESubtreeMap.h b/src/mds/events/ESubtreeMap.h
index 0230de1a59..72d9a8c315 100644
--- a/src/mds/events/ESubtreeMap.h
+++ b/src/mds/events/ESubtreeMap.h
@@ -34,17 +34,16 @@ public:
   }
 
   void encode(bufferlist& bl) const {
-    __u8 struct_v = 4;
-    ::encode(struct_v, bl);
+    ENCODE_START(5, 5, bl);
     ::encode(stamp, bl);
     ::encode(metablob, bl);
     ::encode(subtrees, bl);
     ::encode(ambiguous_subtrees, bl);
     ::encode(expire_pos, bl);
+    ENCODE_FINISH(bl);
   } 
   void decode(bufferlist::iterator &bl) {
-    __u8 struct_v;
-    ::decode(struct_v, bl);
+    DECODE_START_LEGACY_COMPAT_LEN(5, 5, 5, bl);
     if (struct_v >= 2)
       ::decode(stamp, bl);
     ::decode(metablob, bl);
@@ -53,6 +52,7 @@ public:
       ::decode(ambiguous_subtrees, bl);
     if (struct_v >= 3)
       ::decode(expire_pos, bl);
+    DECODE_FINISH(bl);
   }
 
   void replay(MDS *mds);

