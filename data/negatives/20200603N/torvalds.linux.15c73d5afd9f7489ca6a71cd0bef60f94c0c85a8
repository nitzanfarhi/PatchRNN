commit 15c73d5afd9f7489ca6a71cd0bef60f94c0c85a8
Author: James Bottomley <James.Bottomley@HansenPartnership.com>
Date:   Wed Mar 26 09:26:13 2008 -0700

    [SCSI] libsas: Warn if ATA device detected but CONFIG_SCSI_SAS_ATA not set
    
    We give a very cryptic error if an ATA device is seen on a SAS port
    but libsas isn't compiled to include libata to handle them.  Add an
    extra warning to explain specifically what the problem is.
    
    Acked-by: Darrick J. Wong <djwong@us.ibm.com>
    Signed-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>

diff --git a/drivers/scsi/libsas/sas_discover.c b/drivers/scsi/libsas/sas_discover.c
index 31b9af224243..709a6f75ca9d 100644
--- a/drivers/scsi/libsas/sas_discover.c
+++ b/drivers/scsi/libsas/sas_discover.c
@@ -295,11 +295,14 @@ static void sas_discover_domain(struct work_struct *work)
 	case FANOUT_DEV:
 		error = sas_discover_root_expander(dev);
 		break;
-#ifdef CONFIG_SCSI_SAS_ATA
 	case SATA_DEV:
 	case SATA_PM:
+#ifdef CONFIG_SCSI_SAS_ATA
 		error = sas_discover_sata(dev);
 		break;
+#else
+		SAS_DPRINTK("ATA device seen but CONFIG_SCSI_SAS_ATA=N so cannot attach\n");
+		/* Fall through */
 #endif
 	default:
 		error = -ENXIO;

