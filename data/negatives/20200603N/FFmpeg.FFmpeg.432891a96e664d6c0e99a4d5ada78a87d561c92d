commit 432891a96e664d6c0e99a4d5ada78a87d561c92d
Author: Matthieu Bouron <matthieu.bouron@stupeflix.com>
Date:   Thu Jun 16 18:30:16 2016 +0200

    lavc/mediacodecdec{,_h264}: set FF_CODEC_CAP_SETS_PKT_DTS capability
    
    And sets frames pkt_dts to AV_NOPTS_VALUE as we do not want lavc/utils
    to overwrite the field with incorrect values as the decoder is
    asynchronous.

diff --git a/libavcodec/mediacodecdec.c b/libavcodec/mediacodecdec.c
index 0b08f02089..68df885c77 100644
--- a/libavcodec/mediacodecdec.c
+++ b/libavcodec/mediacodecdec.c
@@ -162,6 +162,7 @@ static int mediacodec_wrap_buffer(AVCodecContext *avctx,
      *   * N avpackets can be pushed before 1 frame is actually returned
      *   * 0-sized avpackets are pushed to flush remaining frames at EOS */
     frame->pkt_pts = info->presentationTimeUs;
+    frame->pkt_dts = AV_NOPTS_VALUE;
 
     av_log(avctx, AV_LOG_DEBUG,
             "Frame: width=%d stride=%d height=%d slice-height=%d "
diff --git a/libavcodec/mediacodecdec_h264.c b/libavcodec/mediacodecdec_h264.c
index 52e48aecb3..0f90606a9f 100644
--- a/libavcodec/mediacodecdec_h264.c
+++ b/libavcodec/mediacodecdec_h264.c
@@ -344,4 +344,5 @@ AVCodec ff_h264_mediacodec_decoder = {
     .flush          = mediacodec_decode_flush,
     .close          = mediacodec_decode_close,
     .capabilities   = CODEC_CAP_DELAY,
+    .caps_internal  = FF_CODEC_CAP_SETS_PKT_DTS,
 };

