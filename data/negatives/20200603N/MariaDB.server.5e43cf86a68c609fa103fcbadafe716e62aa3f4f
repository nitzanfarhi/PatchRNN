commit 5e43cf86a68c609fa103fcbadafe716e62aa3f4f
Author: guilhem@mysql.com <>
Date:   Mon Jan 17 21:26:14 2005 +0100

    Fix for BUG#7965 "Slave_IO_State Stuck at 'Checking Master Version'":
    Working around hang of master < 3.23.50 on SELECT @@unknown_var
    (to enable 3.23.49->4.1.10 replication)

diff --git a/sql/slave.cc b/sql/slave.cc
index ef9caa5f5b5..d85c44c915e 100644
--- a/sql/slave.cc
+++ b/sql/slave.cc
@@ -1243,7 +1243,11 @@ not always make sense; please check the manual before using it).";
     values of these 2 are never used (new connections don't use them).
     We don't test equality of global collation_database either as it's is
     going to be deprecated (made read-only) in 4.1 very soon.
+    We don't do it for <3.23.57 because masters <3.23.50 hang on
+    SELECT @@unknown_var (BUG#7965 - see changelog of 3.23.50).
   */
+  if (mi->old_format == BINLOG_FORMAT_323_LESS_57)
+    goto err;
   if (!mysql_real_query(mysql, "SELECT @@GLOBAL.COLLATION_SERVER", 32) &&
       (master_res= mysql_store_result(mysql)))
   {
@@ -1280,6 +1284,7 @@ be equal for replication to work";
     mysql_free_result(master_res);
   }
 
+err:
   if (errmsg)
   {
     sql_print_error(errmsg);

