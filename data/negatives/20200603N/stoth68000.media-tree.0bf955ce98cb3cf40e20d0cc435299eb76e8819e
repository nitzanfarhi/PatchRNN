commit 0bf955ce98cb3cf40e20d0cc435299eb76e8819e
Author: Robert Love <rml@novell.com>
Date:   Mon Aug 15 12:27:54 2005 -0400

    [PATCH] inotify: fix idr_get_new_above usage
    
    We are saving the wrong thing in ->last_wd.  We want the wd, not the
    return value.
    
    Signed-off-by: Robert Love <rml@novell.com>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/fs/inotify.c b/fs/inotify.c
index 27ebcac5e07f..868901b1e779 100644
--- a/fs/inotify.c
+++ b/fs/inotify.c
@@ -402,7 +402,7 @@ static struct inotify_watch *create_watch(struct inotify_device *dev,
 		return ERR_PTR(ret);
 	}
 
-	dev->last_wd = ret;
+	dev->last_wd = watch->wd;
 	watch->mask = mask;
 	atomic_set(&watch->count, 0);
 	INIT_LIST_HEAD(&watch->d_list);

