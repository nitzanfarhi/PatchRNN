commit e6c463e3a3d067f5da2c79d5acdb2f626754cdb3
Author: Michael Buesch <mb@bu3sch.de>
Date:   Sat Sep 5 11:18:47 2009 +0200

    ssb: Fail ssb modinit, if attach of the buses failed.
    
    SSB modinit should not succeed, if busattach failed.
    
    Signed-off-by: Michael Buesch <mb@bu3sch.de>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/ssb/main.c b/drivers/ssb/main.c
index 65a1ed951a1d..8d16cb258ccf 100644
--- a/drivers/ssb/main.c
+++ b/drivers/ssb/main.c
@@ -1358,8 +1358,10 @@ static int __init ssb_modinit(void)
 	ssb_buses_lock();
 	err = ssb_attach_queued_buses();
 	ssb_buses_unlock();
-	if (err)
+	if (err) {
 		bus_unregister(&ssb_bustype);
+		goto out;
+	}
 
 	err = b43_pci_ssb_bridge_init();
 	if (err) {
@@ -1375,7 +1377,7 @@ static int __init ssb_modinit(void)
 		/* don't fail SSB init because of this */
 		err = 0;
 	}
-
+out:
 	return err;
 }
 /* ssb must be initialized after PCI but before the ssb drivers.

