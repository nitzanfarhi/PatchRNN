commit 2411967305dbfb8930b9b9c11f55f6c1ef7361e1
Author: Weston Andros Adamson <dros@netapp.com>
Date:   Thu May 24 15:42:17 2012 -0400

    nfsd: probe the back channel on new connections
    
    Initiate a CB probe when a new connection with the correct direction is added
    to a session (IFF backchannel is marked as down).  Without this a
    BIND_CONN_TO_SESSION has no effect on the internal backchannel state, which
    causes the server to reply to every SEQUENCE op with the
    SEQ4_STATUS_CB_PATH_DOWN flag set until DESTROY_SESSION.
    
    Signed-off-by: Weston Andros Adamson <dros@netapp.com>
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>

diff --git a/fs/nfsd/nfs4state.c b/fs/nfsd/nfs4state.c
index 94effd5bc4a1..8b80a10d4fc5 100644
--- a/fs/nfsd/nfs4state.c
+++ b/fs/nfsd/nfs4state.c
@@ -862,6 +862,11 @@ static __be32 nfsd4_new_conn(struct svc_rqst *rqstp, struct nfsd4_session *ses,
 	if (ret)
 		/* oops; xprt is already down: */
 		nfsd4_conn_lost(&conn->cn_xpt_user);
+	if (ses->se_client->cl_cb_state == NFSD4_CB_DOWN &&
+		dir & NFS4_CDFC4_BACK) {
+		/* callback channel may be back up */
+		nfsd4_probe_callback(ses->se_client);
+	}
 	return nfs_ok;
 }
 

