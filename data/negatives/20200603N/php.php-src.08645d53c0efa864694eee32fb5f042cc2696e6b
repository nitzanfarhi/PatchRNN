commit 08645d53c0efa864694eee32fb5f042cc2696e6b
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Fri Oct 4 18:44:47 2002 +0000

    Fixed bug #19746

diff --git a/main/streams.c b/main/streams.c
index 2da448aa64..a7cbfc6221 100755
--- a/main/streams.c
+++ b/main/streams.c
@@ -711,6 +711,8 @@ PHPAPI char *_php_stream_gets(php_stream *stream, char *buf, size_t maxlen TSRML
 			size_t toread = maxlen - 1;
 			if (toread > stream->chunk_size)
 				toread = stream->chunk_size;
+			else if (toread < stream->chunk_size)
+				stream->chunk_size = toread;
 
 			/* XXX: Should not the loop end, if the stream op fails? */
 			php_stream_fill_read_buffer(stream, toread TSRMLS_CC);

