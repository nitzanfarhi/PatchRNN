commit b5e5849ef74ba59445500ae7d2c094bfb0e1e0b7
Author: Jean Le Feuvre <jeanlf@users.sourceforge.net>
Date:   Mon Dec 10 09:27:10 2007 +0000

    no message
    
    
    git-svn-id: http://svn.code.sf.net/p/gpac/code/trunk/gpac@749 63c20433-aa62-49bd-875c-5a186b69a8fb

diff --git a/src/media_tools/media_import.c b/src/media_tools/media_import.c
index a93e1560d..608a9222d 100644
--- a/src/media_tools/media_import.c
+++ b/src/media_tools/media_import.c
@@ -4822,12 +4822,14 @@ static GF_ESD *m2ts_get_esd(GF_M2TS_ES *es)
 	u32 k, esd_count;
 
 	esd = NULL;
-	esd_count = gf_list_count(es->program->pmt_iod->ESDescriptors);
-	for (k = 0; k < esd_count; k++) {
-		GF_ESD *esd_tmp = (GF_ESD *)gf_list_get(es->program->pmt_iod->ESDescriptors, k);
-		if (esd_tmp->ESID != es->mpeg4_es_id) continue;
-		esd = esd_tmp;
-		break;
+	if (es->program->pmt_iod && es->program->pmt_iod->ESDescriptors) {
+		esd_count = gf_list_count(es->program->pmt_iod->ESDescriptors);
+		for (k = 0; k < esd_count; k++) {
+			GF_ESD *esd_tmp = (GF_ESD *)gf_list_get(es->program->pmt_iod->ESDescriptors, k);
+			if (esd_tmp->ESID != es->mpeg4_es_id) continue;
+			esd = esd_tmp;
+			break;
+		}
 	}
 	
 	if (!esd) {
@@ -4966,15 +4968,17 @@ void on_m2ts_import_data(GF_M2TS_Demuxer *ts, u32 evt_type, void *par)
 		} else {
 			/* We are not in PROBE mode, we are importing only one stream and don't care about the other streams */
 			u32 mtype, stype, oti;
-			Bool is_in_iod;
+			Bool is_in_iod, found;
 
 			/* Since the GF_M2TS_ES_IS_MPEG4_OD flag is stored at the ES level and ES are reset after probe,
 			   we need to set it again as in probe mode */
+			found = 0;
 			count = gf_list_count(prog->streams);
 			for (i=0; i<count; i++) {
 				GF_ESD *esd;
 				es = (GF_M2TS_ES *)gf_list_get(prog->streams, i);
 				if (es->pid == prog->pmt_pid) continue;
+				if (es->pid == import->trackID) found = 1;
 				if (es->flags & GF_M2TS_ES_IS_SECTION) {
 					ses = (GF_M2TS_SECTION_ES *)es;
 				} else {
@@ -4985,6 +4989,8 @@ void on_m2ts_import_data(GF_M2TS_Demuxer *ts, u32 evt_type, void *par)
 					es->flags |= GF_M2TS_ES_IS_MPEG4_OD;
 				}
 			}
+			/*this PMT is not the one of our stream*/
+			if (!found) return;
 
 			es = ts->ess[import->trackID]; /* import->trackID == pid */
 			if (!es) break;
diff --git a/src/media_tools/mpegts.c b/src/media_tools/mpegts.c
index c333e736b..2a06b8689 100644
--- a/src/media_tools/mpegts.c
+++ b/src/media_tools/mpegts.c
@@ -504,8 +504,10 @@ static void gf_m2ts_section_complete(GF_M2TS_Demuxer *ts, GF_M2TS_SectionFilter
 		/*not done yet*/
 		if (t->last_section_number > t->section_number) return;
 
-		if (!t->is_init) status = GF_M2TS_TABLE_FOUND;
-		else status = (t->last_version_number==t->version_number) ? GF_M2TS_TABLE_REPEAT : GF_M2TS_TABLE_UPDATE;
+		if (!t->is_init) 
+			status = GF_M2TS_TABLE_FOUND;
+		else 
+			status = (t->last_version_number==t->version_number) ? GF_M2TS_TABLE_REPEAT : GF_M2TS_TABLE_UPDATE;
 
 		t->last_version_number = t->version_number;
 		t->is_init = 1;

