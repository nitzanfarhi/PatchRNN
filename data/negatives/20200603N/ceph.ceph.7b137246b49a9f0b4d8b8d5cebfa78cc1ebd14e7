commit 7b137246b49a9f0b4d8b8d5cebfa78cc1ebd14e7
Author: Yehuda Sadeh <yehuda@redhat.com>
Date:   Thu Sep 18 20:51:02 2014 -0700

    crypto: don't hash zero sized buffer
    
    libnss returns an error and we assert in that case.
    
    Signed-off-by: Yehuda Sadeh <yehuda@redhat.com>

diff --git a/src/common/ceph_crypto.h b/src/common/ceph_crypto.h
index c55359431d..686efb4896 100644
--- a/src/common/ceph_crypto.h
+++ b/src/common/ceph_crypto.h
@@ -78,9 +78,11 @@ namespace ceph {
 	assert(s == SECSuccess);
       }
       void Update (const byte *input, size_t length) {
-	SECStatus s;
-	s = PK11_DigestOp(ctx, input, length);
-	assert(s == SECSuccess);
+        if (length) {
+	  SECStatus s;
+	  s = PK11_DigestOp(ctx, input, length);
+	  assert(s == SECSuccess);
+        }
       }
       void Final (byte *digest) {
 	SECStatus s;

