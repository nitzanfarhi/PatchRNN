commit 3e334024f40ef93347bdede682086106b7672243
Author: Sage Weil <sage@newdream.net>
Date:   Tue Jun 29 14:38:39 2010 -0700

    osd: removed unused RepGather::indata
    
    Signed-off-by: Sage Weil <sage@newdream.net>

diff --git a/src/osd/ReplicatedPG.cc b/src/osd/ReplicatedPG.cc
index aaeea7e200..9225b3580b 100644
--- a/src/osd/ReplicatedPG.cc
+++ b/src/osd/ReplicatedPG.cc
@@ -372,7 +372,6 @@ void ReplicatedPG::do_pg_op(MOSDOp *op)
 {
   dout(0) << "do_pg_op " << *op << dendl;
 
-  //bufferlist& indata = op->get_data();
   bufferlist outdata;
   int result = 0;
 
@@ -509,7 +508,7 @@ void ReplicatedPG::do_op(MOSDOp *op)
   dout(10) << "do_op mode now " << mode << dendl;
 
   const sobject_t& soid = obc->obs.oi.soid;
-  OpContext *ctx = new OpContext(op, op->get_reqid(), op->ops, op->get_data(),
+  OpContext *ctx = new OpContext(op, op->get_reqid(), op->ops,
 				 &obc->obs, this);
   bool noop = false;
 
@@ -759,10 +758,9 @@ bool ReplicatedPG::snap_trimmer()
       register_object_context(obc);
 
       vector<OSDOp> ops;
-      bufferlist data;
       tid_t rep_tid = osd->get_tid();
       osd_reqid_t reqid(osd->messenger->get_myname(), 0, rep_tid);
-      OpContext *ctx = new OpContext(NULL, reqid, ops, data, &obc->obs, this);
+      OpContext *ctx = new OpContext(NULL, reqid, ops, &obc->obs, this);
       ctx->mtime = g_clock.now();
 
       ctx->at_version.epoch = osd->osdmap->get_epoch();
@@ -2763,6 +2761,7 @@ void ReplicatedPG::sub_op_modify(MOSDSubOp *op)
 
       rm->tls.push_back(&rm->opt);
       rm->tls.push_back(&rm->localt);
+
     } else {
       // do op
       ObjectState obs(op->poid);
@@ -2770,7 +2769,7 @@ void ReplicatedPG::sub_op_modify(MOSDSubOp *op)
       obs.oi.size = op->old_size;
       obs.exists = op->old_exists;
       
-      rm->ctx = new OpContext(op, op->reqid, op->ops, op->get_data(), &obs, this);
+      rm->ctx = new OpContext(op, op->reqid, op->ops, &obs, this);
       
       rm->ctx->mtime = op->mtime;
       rm->ctx->at_version = op->version;
diff --git a/src/osd/ReplicatedPG.h b/src/osd/ReplicatedPG.h
index 09f2581e93..f68bf75e02 100644
--- a/src/osd/ReplicatedPG.h
+++ b/src/osd/ReplicatedPG.h
@@ -284,7 +284,6 @@ public:
     Message *op;
     osd_reqid_t reqid;
     vector<OSDOp>& ops;
-    bufferlist& indata;
     bufferlist outdata;
 
     ObjectState *obs;
@@ -307,9 +306,9 @@ public:
 
     ReplicatedPG *pg;
 
-    OpContext(Message *_op, osd_reqid_t _reqid, vector<OSDOp>& _ops, bufferlist& _data,
+    OpContext(Message *_op, osd_reqid_t _reqid, vector<OSDOp>& _ops,
 	      ObjectState *_obs, ReplicatedPG *_pg) :
-      op(_op), reqid(_reqid), ops(_ops), indata(_data), obs(_obs),
+      op(_op), reqid(_reqid), ops(_ops), obs(_obs),
       bytes_written(0),
       clone_obc(0), snapset_obc(0), data_off(0), reply(NULL), pg(_pg) {}
     ~OpContext() {

