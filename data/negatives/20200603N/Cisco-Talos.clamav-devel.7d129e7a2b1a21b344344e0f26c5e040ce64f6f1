commit 7d129e7a2b1a21b344344e0f26c5e040ce64f6f1
Author: Tomasz Kojm <tkojm@clamav.net>
Date:   Mon Oct 9 21:32:22 2006 +0000

    w32 fix
    
    
    git-svn: trunk@2364

diff --git a/clamav-devel/freshclam/dns.c b/clamav-devel/freshclam/dns.c
index 5e2282fb0..7c48ef19e 100644
--- a/clamav-devel/freshclam/dns.c
+++ b/clamav-devel/freshclam/dns.c
@@ -154,7 +154,7 @@ char *txtquery(const char *domain, unsigned int *ttl)
    if(DnsQuery_UTF8(domain, DNS_TYPE_TEXT, DNS_QUERY_TREAT_AS_FQDN, NULL, &pDnsRecord, NULL) != 0)
 	return NULL;
 
-    if(pDnsRecord->Data.TXT.dwStringCount > 0) {
+    if((pDnsRecord->Data.TXT.dwStringCount > 0) && pDnsRecord->Data.TXT.pStringArray[0]) {
 	txt = mmalloc(strlen(pDnsRecord->Data.TXT.pStringArray[0]) + 1);
 	if(txt)
 	    strcpy(txt, pDnsRecord->Data.TXT.pStringArray[0]);

