commit be0bfed002e0c64a91dacc42a4dab6e883e6bc7e
Author: Trond Myklebust <Trond.Myklebust@netapp.com>
Date:   Fri May 25 16:02:15 2012 -0400

    NFSv4: When purging the lease, we must clear NFS4CLNT_LEASE_CONFIRM
    
    Otherwise we can end up not sending a new exchange-id/setclientid
    
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>

diff --git a/fs/nfs/nfs4state.c b/fs/nfs/nfs4state.c
index 758b9a8a54b3..604c6009d1ac 100644
--- a/fs/nfs/nfs4state.c
+++ b/fs/nfs/nfs4state.c
@@ -1647,6 +1647,7 @@ static void nfs4_reset_all_state(struct nfs_client *clp)
 {
 	if (test_and_set_bit(NFS4CLNT_LEASE_EXPIRED, &clp->cl_state) == 0) {
 		set_bit(NFS4CLNT_PURGE_STATE, &clp->cl_state);
+		clear_bit(NFS4CLNT_LEASE_CONFIRM, &clp->cl_state);
 		nfs4_state_start_reclaim_nograce(clp);
 		nfs4_schedule_state_manager(clp);
 	}

