commit 1d92a08da23848a38eece4df7eaa4e8ec0e6c699
Author: Trond Myklebust <Trond.Myklebust@netapp.com>
Date:   Tue Jun 14 12:07:38 2011 -0400

    NFSv4.1: Fix a refcounting issue in the pNFS device id cache
    
    When we add something to the global device id cache, we need to bump the
    reference count, so that the cache itself holds a reference.
    
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>

diff --git a/fs/nfs/pnfs_dev.c b/fs/nfs/pnfs_dev.c
index 5944d4b369a2..f0f8e1e22f6c 100644
--- a/fs/nfs/pnfs_dev.c
+++ b/fs/nfs/pnfs_dev.c
@@ -209,6 +209,7 @@ nfs4_insert_deviceid_node(struct nfs4_deviceid_node *new)
 
 	hlist_add_head_rcu(&new->node, &nfs4_deviceid_cache[hash]);
 	spin_unlock(&nfs4_deviceid_lock);
+	atomic_inc(&new->ref);
 
 	return new;
 }

