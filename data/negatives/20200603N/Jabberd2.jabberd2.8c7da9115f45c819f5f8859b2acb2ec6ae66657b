commit 8c7da9115f45c819f5f8859b2acb2ec6ae66657b
Author: Tomasz Sterna <tomek@xiaoka.com>
Date:   Sun Apr 24 18:53:23 2016 +0200

    CID 90920 Skip empty template roster file

diff --git a/sm/mod_template_roster.c b/sm/mod_template_roster.c
index 6de084c..812f849 100644
--- a/sm/mod_template_roster.c
+++ b/sm/mod_template_roster.c
@@ -76,6 +76,11 @@ static int _template_roster_reload(template_roster_t tr) {
     fseek(f, 0, SEEK_END);
     size = ftell(f);
     fseek(f, 0, SEEK_SET);
+    if(size == 0) {
+        log_write(tr->sm->log, LOG_ERR, "empty roster template %s", tr->filename);
+        fclose(f);
+        return 1;
+    }
 
     buf = (char *) malloc(sizeof(char) * size);
 
@@ -109,7 +114,7 @@ static int _template_roster_reload(template_roster_t tr) {
             log_write(tr->sm->log, LOG_ERR, "roster template has item with no jid, skipping");
             continue;
         }
-        
+
         item = (item_t) pmalloco(xhash_pool(tr->items), sizeof(struct item_st));
 
         item->jid = jid_new(NAD_AVAL(nad, ajid), NAD_AVAL_L(nad, ajid));
@@ -155,7 +160,7 @@ static int _template_roster_reload(template_roster_t tr) {
         log_debug(ZONE, "loaded roster template item %s, %d groups", jid_full(item->jid), item->ngroups);
 
         nitems++;
-        
+
         eitem = nad_find_elem(nad, eitem, NAD_ENS(nad, 0), "item", 0);
     }
 
@@ -199,7 +204,7 @@ static void _template_roster_save_item(sm_t sm, jid_t jid, item_t item) {
     }
 
     os = os_new();
-    
+
     for(i = 0; i < item->ngroups; i++) {
         o = os_object_new(os);
 

