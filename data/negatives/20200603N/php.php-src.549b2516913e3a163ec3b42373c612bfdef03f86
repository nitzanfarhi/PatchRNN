commit 549b2516913e3a163ec3b42373c612bfdef03f86
Author: Anatol Belski <ab@php.net>
Date:   Sun Mar 2 11:10:27 2014 +0100

    more zpp fixes

diff --git a/ext/mysqli/mysqli_api.c b/ext/mysqli/mysqli_api.c
index e606e38702..530eadcffd 100644
--- a/ext/mysqli/mysqli_api.c
+++ b/ext/mysqli/mysqli_api.c
@@ -2306,7 +2306,7 @@ PHP_FUNCTION(mysqli_stmt_attr_set)
 	my_bool	mode_b;
 #endif
 	php_uint_t	mode;
-	php_uint_t	attr;
+	php_int_t	attr;
 	void	*mode_p;
 
 	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Oii", &mysql_stmt, mysqli_stmt_class_entry, &attr, &mode_in) == FAILURE) {
@@ -2319,6 +2319,11 @@ PHP_FUNCTION(mysqli_stmt_attr_set)
 		RETURN_FALSE;
 	}
 
+	if (attr < 0) {
+		php_error_docref(NULL TSRMLS_CC, E_WARNING, "attr should be non-negative, %pd passed", attr);
+		RETURN_FALSE;
+	}
+
 	switch (attr) {
 #if MYSQL_VERSION_ID >= 50107
 	case STMT_ATTR_UPDATE_MAX_LENGTH:
@@ -2349,12 +2354,18 @@ PHP_FUNCTION(mysqli_stmt_attr_get)
 	MY_STMT	*stmt;
 	zval	*mysql_stmt;
 	php_uint_t	value = 0;
-	php_uint_t	attr;
+	php_int_t	attr;
 	int		rc;
 
 	if (zend_parse_method_parameters(ZEND_NUM_ARGS() TSRMLS_CC, getThis(), "Oi", &mysql_stmt, mysqli_stmt_class_entry, &attr) == FAILURE) {
 		return;
 	}
+
+	if (attr < 0) {
+		php_error_docref(NULL TSRMLS_CC, E_WARNING, "attr should be non-negative, %pd passed", attr);
+		RETURN_FALSE;
+	}
+
 	MYSQLI_FETCH_RESOURCE_STMT(stmt, &mysql_stmt, MYSQLI_STATUS_VALID);
 
 	if ((rc = mysql_stmt_attr_get(stmt->stmt, attr, &value))) {

