commit 87840eeb7115a8949ab589a82f24bc25ee647b78
Author: Ronald S. Bultje <rsbultje@gmail.com>
Date:   Fri Feb 17 14:48:57 2012 -0800

    avcodec: disallow reget_buffer() if pix_fmt changed.

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index 67c9e36bba..285be9b72b 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -553,6 +553,8 @@ int avcodec_default_reget_buffer(AVCodecContext *s, AVFrame *pic){
         return s->get_buffer(s, pic);
     }
 
+    assert(s->pix_fmt == pic->pix_fmt);
+
     /* If internal buffer type return the same buffer */
     if(pic->type == FF_BUFFER_TYPE_INTERNAL) {
         if(s->pkt) pic->pkt_pts= s->pkt->pts;

