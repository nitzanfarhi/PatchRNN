commit c7f33023308f3142433b7379718af5f0c2c322a6
Author: Martin Kelly <mkelly@xevo.com>
Date:   Tue Dec 5 10:34:03 2017 -0800

    can: mcba_usb: cancel urb on -EPROTO
    
    When we unplug the device, we can see both -EPIPE and -EPROTO depending
    on exact timing and what system we run on. If we continue to resubmit
    URBs, they will immediately fail, and they can cause stalls, especially
    on slower CPUs.
    
    Fix this by not resubmitting on -EPROTO, as we already do on -EPIPE.
    
    Signed-off-by: Martin Kelly <mkelly@xevo.com>
    Cc: linux-stable <stable@vger.kernel.org>
    Signed-off-by: Marc Kleine-Budde <mkl@pengutronix.de>

diff --git a/drivers/net/can/usb/mcba_usb.c b/drivers/net/can/usb/mcba_usb.c
index ef417dcddbf7..8d8c2086424d 100644
--- a/drivers/net/can/usb/mcba_usb.c
+++ b/drivers/net/can/usb/mcba_usb.c
@@ -593,6 +593,7 @@ static void mcba_usb_read_bulk_callback(struct urb *urb)
 
 	case -ENOENT:
 	case -EPIPE:
+	case -EPROTO:
 	case -ESHUTDOWN:
 		return;
 

