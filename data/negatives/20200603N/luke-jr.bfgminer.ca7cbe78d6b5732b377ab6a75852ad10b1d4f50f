commit ca7cbe78d6b5732b377ab6a75852ad10b1d4f50f
Author: Luke Dashjr <luke-jr+git@utopios.org>
Date:   Sun Aug 18 19:48:50 2013 +0000

    SGW: Refuse to issue new work to disabled devices

diff --git a/driver-getwork.c b/driver-getwork.c
index 0b2d29ef..5699dda0 100644
--- a/driver-getwork.c
+++ b/driver-getwork.c
@@ -38,7 +38,6 @@ static
 pthread_mutex_t getwork_clients_mutex;
 
 // TODO: X-Hashes-Done?
-// TODO: block getworks if disabled?
 
 static
 void prune_worklog()
@@ -240,6 +239,12 @@ int handle_getwork(struct MHD_Connection *conn, bytes_t *upbuf)
 		goto out;
 	}
 	
+	if (cgpu->deven == DEV_DISABLED)
+	{
+		ret = getwork_error(conn, -10, "Virtual device has been disabled", idstr, idstr_sz);
+		goto out;
+	}
+	
 	{
 		const size_t replysz = 451 + idstr_sz;
 		

