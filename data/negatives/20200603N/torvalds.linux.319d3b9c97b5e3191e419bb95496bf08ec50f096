commit 319d3b9c97b5e3191e419bb95496bf08ec50f096
Author: Glauber Costa <glommer@parallels.com>
Date:   Sun Jan 15 22:04:39 2012 +0000

    net: move sock_update_memcg outside of CONFIG_INET
    
    Although only used currently for tcp sockets, this function
    is now used in common sock code (for sock_clone())
    
    Commit 475f1b52645a29936b9df1d8fcd45f7e56bd4a9f moved the
    declaration of sock_update_clone() to inside sock.c, but
    this only fixes the problem when CONFIG_CGROUP_MEM_RES_CTLR_KMEM
    is also not defined.
    
    This patch here is verified to fix both problems, although
    reverting the previous one is not necessary.
    
    Signed-off-by: Glauber Costa <glommer@parallels.com>
    CC: David S. Miller <davem@davemloft.net>
    CC: Stephen Rothwell <sfr@canb.auug.org.au>
    Reported-by: Randy Dunlap <rdunlap@xenotime.net>
    Acked-by: Randy Dunlap <rdunlap@xenotime.net>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/mm/memcontrol.c b/mm/memcontrol.c
index 602207be9853..3dbff4dcde35 100644
--- a/mm/memcontrol.c
+++ b/mm/memcontrol.c
@@ -373,7 +373,6 @@ static void mem_cgroup_put(struct mem_cgroup *memcg);
 
 /* Writing them here to avoid exposing memcg's inner layout */
 #ifdef CONFIG_CGROUP_MEM_RES_CTLR_KMEM
-#ifdef CONFIG_INET
 #include <net/sock.h>
 #include <net/ip.h>
 
@@ -420,6 +419,7 @@ void sock_release_memcg(struct sock *sk)
 	}
 }
 
+#ifdef CONFIG_INET
 struct cg_proto *tcp_proto_cgroup(struct mem_cgroup *memcg)
 {
 	if (!memcg || mem_cgroup_is_root(memcg))

