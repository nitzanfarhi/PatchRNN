commit dcaca12b6127a4547e114c9856ab58bbb431856f
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Oct 25 06:29:53 2002 +0300

    If Content-Length header was invalid, we didn't fix it properly.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mbox/mbox-index.c b/src/lib-index/mbox/mbox-index.c
index c60f2598d..869f2ff77 100644
--- a/src/lib-index/mbox/mbox-index.c
+++ b/src/lib-index/mbox/mbox-index.c
@@ -198,6 +198,8 @@ void mbox_header_func(MessagePart *part __attr_unused__,
 		end_offset = start_offset + ctx->content_length;
 		if (ctx->content_length == 0 ||
 		    !mbox_verify_end_of_body(ctx->inbuf, end_offset)) {
+			if (ctx->content_length != 0)
+				i_buffer_seek(ctx->inbuf, start_offset);
 			mbox_skip_message(ctx->inbuf);
 			end_offset = ctx->inbuf->v_offset;
 			ctx->content_length = end_offset - start_offset;

