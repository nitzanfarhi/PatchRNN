commit 5a6f7094e26098f74951a00bbc96b778d417a193
Author: David Lutterkort <lutter@watzmann.net>
Date:   Fri Sep 23 22:34:17 2016 -0700

    * src/pathx.c (ns_from_locpath): insist that arg LP is not NULL
    
    This allows us to remove some confused checking

diff --git a/src/pathx.c b/src/pathx.c
index 52009ca7..64cc5cb1 100644
--- a/src/pathx.c
+++ b/src/pathx.c
@@ -1250,8 +1250,10 @@ static void ns_from_locpath(struct locpath *lp, uint *maxns,
                             const struct nodeset *root,
                             struct state *state) {
     struct tree *old_ctx = state->ctx;
-
     *maxns = 0;
+
+    ensure(lp != NULL, state);
+
     *ns = NULL;
     list_for_each(step, lp->steps)
         *maxns += 1;
@@ -1267,8 +1269,7 @@ static void ns_from_locpath(struct locpath *lp, uint *maxns,
 
     if (root == NULL) {
         struct step *first_step = NULL;
-        if (lp != NULL)
-            first_step = lp->steps;
+        first_step = lp->steps;
 
         struct tree *root_tree;
         root_tree = step_root(first_step, state->ctx, state->root_ctx);

