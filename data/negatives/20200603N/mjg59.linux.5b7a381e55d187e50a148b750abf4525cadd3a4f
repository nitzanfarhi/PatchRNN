commit 5b7a381e55d187e50a148b750abf4525cadd3a4f
Author: Hugh Daschbach <hdasch@broadcom.com>
Date:   Tue Feb 16 12:15:23 2010 -0800

    [SCSI] libfc: Fix e_d_tov ns -> ms scaling factor in PLOGI response.
    
    Both PLOGI and RTV response processing conditionally scale e_d_tov,
    but use different scaling factors.  The scaling factor is correct in
    RTV response processing.  Bring PLOGI e_d_tov scaling in line with RTV
    common service parameter inspection.
    
    Signed-off-by: Hugh Daschbach <hdasch@broadcom.com>
    Acked-by: Joe Eykholt <jeykholt@cisco.com>
    Signed-off-by: Robert Love <robert.w.love@intel.com>
    Signed-off-by: James Bottomley <James.Bottomley@suse.de>

diff --git a/drivers/scsi/libfc/fc_rport.c b/drivers/scsi/libfc/fc_rport.c
index 02300523b234..97923bb07765 100644
--- a/drivers/scsi/libfc/fc_rport.c
+++ b/drivers/scsi/libfc/fc_rport.c
@@ -623,7 +623,7 @@ static void fc_rport_plogi_resp(struct fc_seq *sp, struct fc_frame *fp,
 
 		tov = ntohl(plp->fl_csp.sp_e_d_tov);
 		if (ntohs(plp->fl_csp.sp_features) & FC_SP_FT_EDTR)
-			tov /= 1000;
+			tov /= 1000000;
 		if (tov > rdata->e_d_tov)
 			rdata->e_d_tov = tov;
 		csp_seq = ntohs(plp->fl_csp.sp_tot_seq);

