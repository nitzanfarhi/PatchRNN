commit 5fc16840dc0c52ab849d74dbbbf7041b3e6afd62
Author: Danny Auble <da@schedmd.com>
Date:   Fri Aug 19 10:10:41 2016 -0600

    Sanity check to validate the pmix version is the same as the one we are
    linking against.

diff --git a/src/plugins/mpi/pmix/mpi_pmix.c b/src/plugins/mpi/pmix/mpi_pmix.c
index e37f4e5649..c4dcf37e52 100644
--- a/src/plugins/mpi/pmix/mpi_pmix.c
+++ b/src/plugins/mpi/pmix/mpi_pmix.c
@@ -89,6 +89,23 @@ const char plugin_type[] = "mpi/pmix_v2";
 
 const uint32_t plugin_version = SLURM_VERSION_NUMBER;
 
+/*
+ * init() is called when the plugin is loaded, before any other functions
+ * are called.  Put global initialization here.
+ */
+extern int init(void)
+{
+	/* HAVE_PMIX_VER is what we were compiled against PMIX_VERSION_MAJOR is
+	 * found in the pmix source we are dynamically linking against.
+	 */
+	if (HAVE_PMIX_VER != PMIX_VERSION_MAJOR)
+		fatal("pmix_init: Slurm was compiled against PMIx v%d but we are now linking against v%ld. Please check your install.",
+		      HAVE_PMIX_VER, PMIX_VERSION_MAJOR);
+
+	return SLURM_SUCCESS;
+}
+
+
 int p_mpi_hook_slurmstepd_prefork(const stepd_step_rec_t *job, char ***env)
 {
 	int ret;

