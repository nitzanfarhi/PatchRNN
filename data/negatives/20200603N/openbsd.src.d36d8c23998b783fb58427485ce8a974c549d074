commit d36d8c23998b783fb58427485ce8a974c549d074
Author: miod <miod@openbsd.org>
Date:   Mon Jan 16 21:48:20 2006 +0000

    Do not register adb and pm interrupts until the related devices initialize.

diff --git a/sys/arch/mac68k/dev/adb_direct.c b/sys/arch/mac68k/dev/adb_direct.c
index e0c7d6459cf..a4a74300deb 100644
--- a/sys/arch/mac68k/dev/adb_direct.c
+++ b/sys/arch/mac68k/dev/adb_direct.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: adb_direct.c,v 1.18 2006/01/13 19:36:43 miod Exp $	*/
+/*	$OpenBSD: adb_direct.c,v 1.19 2006/01/16 21:48:20 miod Exp $	*/
 /*	$NetBSD: adb_direct.c,v 1.51 2005/06/16 22:43:36 jmc Exp $	*/
 
 /* From: adb_direct.c 2.02 4/18/97 jpw */
@@ -1968,6 +1968,7 @@ adb_reinit(void)
 	int device;
 	int nonewtimes;		/* times thru loop w/o any new devices */
 
+	via1_register_irq(2, adb_intr, NULL, "adb");
 	adb_setup_hw_type();	/* setup hardware type */
 
 	/* Make sure we are not interrupted while building the table. */
diff --git a/sys/arch/mac68k/mac68k/via.c b/sys/arch/mac68k/mac68k/via.c
index 74f702015f7..c8bb706c493 100644
--- a/sys/arch/mac68k/mac68k/via.c
+++ b/sys/arch/mac68k/mac68k/via.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: via.c,v 1.26 2006/01/13 21:02:04 miod Exp $	*/
+/*	$OpenBSD: via.c,v 1.27 2006/01/16 21:48:22 miod Exp $	*/
 /*	$NetBSD: via.c,v 1.62 1997/09/10 04:38:48 scottr Exp $	*/
 
 /*-
@@ -50,10 +50,7 @@
 #include <machine/intr.h>
 #include <machine/viareg.h>
 
-int	adb_intr(void *);
-int	pm_intr(void *);
 int	rtclock_intr(void *);
-void	profclock(void *);
 
 int	via1_intr(void *);
 int	via2_intr(void *);
@@ -99,8 +96,6 @@ via_init()
 	intr_establish(via1_intr, NULL, mac68k_machine.via1_ipl, "via1");
 
 	/* register default VIA1 interrupts */
-	via1_register_irq(2, adb_intr, NULL, "adb");
-	via1_register_irq(4, pm_intr, NULL, "pm");
 	via1_register_irq(VIA1_T1, rtclock_intr, NULL, "clock");
 
 	for (i = 0; i < 7; i++)

