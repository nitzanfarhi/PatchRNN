commit f53e57975151f54ad8caa1b0ac8a78091cd5700a
Author: Eric W. Biederman <ebiederm@xmission.com>
Date:   Mon Jan 19 11:48:45 2015 -0600

    mnt: Fix the error check in __detach_mounts
    
    lookup_mountpoint can return either NULL or an error value.
    Update the test in __detach_mounts to test for an error value
    to avoid pathological cases causing a NULL pointer dereferences.
    
    The callers of __detach_mounts should prevent it from ever being
    called on an unlinked dentry but don't take any chances.
    
    Cc: stable@vger.kernel.org
    Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>

diff --git a/fs/namespace.c b/fs/namespace.c
index 1894d1878dbc..e8f7f8c58c3c 100644
--- a/fs/namespace.c
+++ b/fs/namespace.c
@@ -1516,7 +1516,7 @@ void __detach_mounts(struct dentry *dentry)
 
 	namespace_lock();
 	mp = lookup_mountpoint(dentry);
-	if (!mp)
+	if (IS_ERR_OR_NULL(mp))
 		goto out_unlock;
 
 	lock_mount_hash();

