commit 057ba29bbe85e9587635e3128b26fa30fe849af9
Author: Jiri Benc <jbenc@redhat.com>
Date:   Thu Sep 17 16:11:11 2015 +0200

    vxlan: reject IPv6 addresses if IPv6 is not configured
    
    When IPv6 address is set without IPv6 configured, the vxlan socket is mostly
    treated as an IPv4 one but various lookus in fdb etc. still take the
    AF_INET6 into account. This creates incosistencies with weird consequences.
    
    Just reject IPv6 addresses in such case.
    
    Signed-off-by: Jiri Benc <jbenc@redhat.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/vxlan.c b/drivers/net/vxlan.c
index 6ebe562af04e..bbac1d35ed4e 100644
--- a/drivers/net/vxlan.c
+++ b/drivers/net/vxlan.c
@@ -2636,8 +2636,11 @@ static int vxlan_dev_configure(struct net *src_net, struct net_device *dev,
 		dst->remote_ip.sa.sa_family = AF_INET;
 
 	if (dst->remote_ip.sa.sa_family == AF_INET6 ||
-	    vxlan->cfg.saddr.sa.sa_family == AF_INET6)
+	    vxlan->cfg.saddr.sa.sa_family == AF_INET6) {
+		if (!IS_ENABLED(CONFIG_IPV6))
+			return -EPFNOSUPPORT;
 		use_ipv6 = true;
+	}
 
 	if (conf->remote_ifindex) {
 		struct net_device *lowerdev

