commit 99361a9c0e2a93ab8a21a675f74178700457f838
Author: Sami Kerola <kerolasa@iki.fi>
Date:   Sun Jun 30 09:44:00 2013 +0100

    ul: enhance command performance
    
    Avoid reseting, time after time, the memory which was not used.  Effect
    of the change is below in before and after timings.
    
    $ time ./ul </etc/services >/dev/null
    real    0m0.320s
    user    0m0.307s
    sys     0m0.010s
    
    $ time ./ul </etc/services >/dev/null
    real    0m0.068s
    user    0m0.050s
    sys     0m0.017s
    
    [kzak@redhat.com: - add "else" and use maxcol]
    
    Signed-off-by: Sami Kerola <kerolasa@iki.fi>
    Signed-off-by: Karel Zak <kzak@redhat.com>

diff --git a/text-utils/ul.c b/text-utils/ul.c
index 5710a5547..7b50ede50 100644
--- a/text-utils/ul.c
+++ b/text-utils/ul.c
@@ -491,11 +491,11 @@ static void initbuf(void)
 	if (obuf == NULL) {
 		/* First time. */
 		obuflen = BUFSIZ;
-		obuf = xmalloc(sizeof(struct CHAR) * obuflen);
-	}
+		obuf = xcalloc(obuflen, sizeof(struct CHAR));
+	} else
+		/* assumes NORMAL == 0 */
+		memset(obuf, 0, sizeof(struct CHAR) * maxcol);
 
-	/* assumes NORMAL == 0 */
-	memset(obuf, 0, sizeof(struct CHAR) * obuflen);
 	setcol(0);
 	maxcol = 0;
 	mode &= ALTSET;

