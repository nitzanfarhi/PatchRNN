commit 9e40675ba5f52306851173b99b746430977ec449
Author: ratchov <ratchov@openbsd.org>
Date:   Sat Jun 5 16:52:28 2010 +0000

    when parsing wav headers, check that a data chuck actually exists

diff --git a/usr.bin/aucat/headers.c b/usr.bin/aucat/headers.c
index 6d58fa620e1..a1a361a68ee 100644
--- a/usr.bin/aucat/headers.c
+++ b/usr.bin/aucat/headers.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: headers.c,v 1.16 2010/05/27 06:17:04 ratchov Exp $	*/
+/*	$OpenBSD: headers.c,v 1.17 2010/06/05 16:52:28 ratchov Exp $	*/
 /*
  * Copyright (c) 2008 Alexandre Ratchov <alex@caoua.org>
  *
@@ -186,7 +186,11 @@ wav_readhdr(int fd, struct aparams *par, off_t *startpos, off_t *datasz, short *
 		return 0;
 	}
 	rsize = letoh32(riff.size);
-	while (pos + sizeof(struct wavchunk) <= rsize) {
+	for (;;) {
+		if (pos + sizeof(struct wavchunk) > rsize) {
+			warnx("missing data chunk");
+			return 0;
+		}
 		if (read(fd, &chunk, sizeof(chunk)) != sizeof(chunk)) {
 			warn("wav_readhdr: chunk");
 			return 0;

