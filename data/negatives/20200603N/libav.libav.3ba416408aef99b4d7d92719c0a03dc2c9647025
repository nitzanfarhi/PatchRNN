commit 3ba416408aef99b4d7d92719c0a03dc2c9647025
Author: Justin Ruggles <justin.ruggles@gmail.com>
Date:   Tue Nov 6 14:24:31 2012 -0500

    avconv: rescale packet duration to muxer time base when flushing encoders
    
    Fixes Bug 385

diff --git a/avconv.c b/avconv.c
index 964847a48..c931c46de 100644
--- a/avconv.c
+++ b/avconv.c
@@ -964,6 +964,8 @@ static void flush_encoders(void)
                     pkt.pts = av_rescale_q(pkt.pts, enc->time_base, ost->st->time_base);
                 if (pkt.dts != AV_NOPTS_VALUE)
                     pkt.dts = av_rescale_q(pkt.dts, enc->time_base, ost->st->time_base);
+                if (pkt.duration > 0)
+                    pkt.duration = av_rescale_q(pkt.duration, enc->time_base, ost->st->time_base);
                 write_frame(os, &pkt, ost);
             }
 

