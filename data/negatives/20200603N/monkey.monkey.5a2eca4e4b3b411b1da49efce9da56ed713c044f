commit 5a2eca4e4b3b411b1da49efce9da56ed713c044f
Author: Eduardo Silva <eduardo@monkey.io>
Date:   Sat Jul 25 10:22:55 2015 -0600

    mk_server: HTTP: do not mk_bug() when status is already completed
    
    Signed-off-by: Eduardo Silva <eduardo@monkey.io>

diff --git a/include/monkey/mk_http.h b/include/monkey/mk_http.h
index a60f9ec1..27b81dc3 100644
--- a/include/monkey/mk_http.h
+++ b/include/monkey/mk_http.h
@@ -158,12 +158,18 @@ struct mk_http_session
     struct mk_http_parser parser;
 };
 
-static inline void mk_http_status_completed(struct mk_http_session *cs,
-                                            struct mk_sched_conn *conn)
+static inline int mk_http_status_completed(struct mk_http_session *cs,
+                                           struct mk_sched_conn *conn)
 {
     (void) conn;
-    mk_bug(cs->status == MK_REQUEST_STATUS_COMPLETED);
+
+    if (cs->status == MK_REQUEST_STATUS_COMPLETED) {
+        MK_TRACE("HTTP Completed but already completed, aborting conx");
+        return -1;
+    }
+
     cs->status = MK_REQUEST_STATUS_COMPLETED;
+    return 0;
 }
 
 int mk_http_error(int http_status, struct mk_http_session *cs,

