commit d1df341371f8356586cdd3ca2696ad1d0aaf56f0
Author: Jyrki Vesterinen <sandgtx@gmail.com>
Date:   Sat Apr 15 12:19:31 2017 +0300

    Fix: with --new-widgets advanced preferences may not shrink on deselect
    
    Partial relayout does not make a grid yield more space to its parent grid.
    Thus, only firing partial relayout as a result of hiding a widget is *not*
    safe.
    
    Fixed by triggering full relayout instead, like the code already does
    without --new-widgets.

diff --git a/src/gui/widgets/widget.cpp b/src/gui/widgets/widget.cpp
index ee2592553c..5d3ecd677e 100644
--- a/src/gui/widgets/widget.cpp
+++ b/src/gui/widgets/widget.cpp
@@ -489,7 +489,7 @@ void widget::set_visible(const visibility visible)
 	visible_ = visible;
 
 	if(need_resize) {
-		if(new_widgets) {
+		if(visible == visibility::visible && new_widgets) {
 			event::message message;
 			fire(event::REQUEST_PLACEMENT, *this, message);
 		} else {

