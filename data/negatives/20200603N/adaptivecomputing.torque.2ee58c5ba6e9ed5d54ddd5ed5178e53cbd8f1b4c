commit 2ee58c5ba6e9ed5d54ddd5ed5178e53cbd8f1b4c
Author: scottmo <scottmo@8f940c70-5916-0410-ac46-d1fa2fa6ea29>
Date:   Thu Sep 4 00:29:03 2008 +0000

    INCR:           Added logging for job and checkpoint executions

diff --git a/src/resmom/catch_child.c b/src/resmom/catch_child.c
index f80f27941..66e98e546 100644
--- a/src/resmom/catch_child.c
+++ b/src/resmom/catch_child.c
@@ -271,7 +271,9 @@ hnodent *get_node(
  *      o validates server response to preobit message
  *      - fork_me()
  *        o parent registers post_epilog in job ji_mompost attribute, sets job
- *          substate to JOB_SUBSTATE_OBIT, and registers post_epilogue handler
+ *          substate to JOB_SUBSTATE_OBIT, and registers post_epilogue handler.
+ *          This handler will be invoked when the waitpid in scan_for_terminated
+ *          catches a SIGCHLD for the job epilog invoked by the child.
  *        o child runs run_pelog()
  *
  *  - post_epilog()
diff --git a/src/resmom/checkpoint.c b/src/resmom/checkpoint.c
index 2eceeae8e..1484ffd77 100644
--- a/src/resmom/checkpoint.c
+++ b/src/resmom/checkpoint.c
@@ -150,6 +150,7 @@ mom_checkpoint_job_is_checkpointable(job *pjob)
 void
 mom_checkpoint_execute_job(job *pjob, char *shell, char *arg[], struct var_table *vtable)
   {
+  static char          *id = "mom_checkpoint_execute_job";
 
   /* Launch job executable with cr_run command so that cr_checkpoint command will work. */
 
@@ -166,23 +167,22 @@ mom_checkpoint_execute_job(job *pjob, char *shell, char *arg[], struct var_table
   strcpy(arg[1], shell);
   arg[0] = checkpoint_run_exe_name;
 
-#if 1
+  if (LOGLEVEL >= 10)
     {
-    int i;
     char cmd[1024];
-    strcpy(cmd, "\"");
+    int i;
 
-    for (i = 0; i < 10 && arg[i]; i++)
+    strcat(cmd,arg[0]);
+    for (i = 1; arg[i] != NULL; i++)
       {
-      strcat(cmd, arg[i]);
-      strcat(cmd, " ");
+      strcat(cmd," ");
+      strcat(cmd,arg[i]);
       }
+    strcat(cmd,")");
 
-    strcat(cmd, "\"");
-
-    log_err(-1, "mom_checkpoint_execute_job", cmd);
+    sprintf(log_buffer, "execing checkpoint command (%s)\n", cmd);
+    log_err(-1, id, log_buffer);
     }
-#endif
 
   execve(checkpoint_run_exe_name, arg, vtable->v_envp);
   }
diff --git a/src/resmom/start_exec.c b/src/resmom/start_exec.c
index ac6ff1829..62f06b9ea 100644
--- a/src/resmom/start_exec.c
+++ b/src/resmom/start_exec.c
@@ -3003,6 +3003,22 @@ int TMomFinalizeChild(
       }
     else
       {
+      if (LOGLEVEL >= 10)
+        {
+        char cmd[1024];
+        int i;
+
+        strcat(cmd,arg[0]);
+        for (i = 1; arg[i] != NULL; i++)
+          {
+          strcat(cmd," ");
+          strcat(cmd,arg[i]);
+          }
+        strcat(cmd,")");
+
+        sprintf(log_buffer, "execing command (%s)\n", cmd);
+        log_err(-1, id, log_buffer);
+        }
       execve(shell, arg, vtable.v_envp);
       }
     }    /* END if ((pjob->ji_numnodes == 1) || ...) */

