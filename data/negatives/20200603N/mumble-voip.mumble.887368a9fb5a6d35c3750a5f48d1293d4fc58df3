commit 887368a9fb5a6d35c3750a5f48d1293d4fc58df3
Author: Thorvald Natvig <slicer@users.sourceforge.net>
Date:   Tue Jan 20 23:19:18 2009 +0000

    Patch #2524995: DBus started/stopped signals [julian7]
    
    git-svn-id: https://mumble.svn.sourceforge.net/svnroot/mumble/trunk@1466 05730e5d-ab1b-0410-a4ac-84af385074fa

diff --git a/src/murmur/Meta.cpp b/src/murmur/Meta.cpp
index 3184ed25..48a810f2 100644
--- a/src/murmur/Meta.cpp
+++ b/src/murmur/Meta.cpp
@@ -265,6 +265,7 @@ void MetaParams::read(QString fname) {
 Meta::Meta() {
 	qsOS = OSInfo::getOS();
 	qsOSVersion = OSInfo::getOSVersion();
+	dbus = NULL;
 }
 
 void Meta::bootAll() {
@@ -282,6 +283,7 @@ bool Meta::boot(int srvnum) {
 	if (s->bValid)
 		s->start(QThread::HighestPriority);
 	qhServers.insert(srvnum, s);
+	dbus->started(s);
 	return true;
 }
 
@@ -290,11 +292,13 @@ void Meta::kill(int srvnum) {
 	if (!s)
 		return;
 	delete s;
+	dbus->stopped(s);
 }
 
 void Meta::killAll() {
 	foreach(Server *s, qhServers) {
 		delete s;
+		dbus->stopped(s);
 	}
 	qhServers.clear();
 }
diff --git a/src/murmur/Meta.h b/src/murmur/Meta.h
index 4a7634ef..d9581d45 100644
--- a/src/murmur/Meta.h
+++ b/src/murmur/Meta.h
@@ -34,6 +34,7 @@
 #include "murmur_pch.h"
 #include "Timer.h"
 #include "Server.h"
+#include "DBus.h"
 
 struct MetaParams {
 	QDir qdBasePath;
@@ -98,6 +99,7 @@ class Meta : public QObject {
 		QHash<QHostAddress, QList<Timer> > qhAttempts;
 		QHash<QHostAddress, Timer> qhBans;
 		QString qsOS, qsOSVersion;
+		MetaDBus *dbus;
 
 		Meta();
 		void bootAll();
diff --git a/src/murmur/main.cpp b/src/murmur/main.cpp
index 79abbca5..515f2438 100644
--- a/src/murmur/main.cpp
+++ b/src/murmur/main.cpp
@@ -397,8 +397,8 @@ int main(int argc, char **argv) {
 		if (! MurmurDBus::qdbc.isConnected()) {
 			qWarning("Failed to connect to D-Bus %s",qPrintable(Meta::mp.qsDBus));
 		}
-		new MetaDBus(meta);
 	}
+	meta->dbus = new MetaDBus(meta);
 	if (MurmurDBus::qdbc.isConnected()) {
 		if (! MurmurDBus::qdbc.registerObject("/", meta) || ! MurmurDBus::qdbc.registerService(Meta::mp.qsDBusService)) {
 			QDBusError e=MurmurDBus::qdbc.lastError();

