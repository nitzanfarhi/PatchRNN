commit e17fd4ba2a81f1d29875b20464e4899185a3c946
Author: John Stultz <john.stultz@linaro.org>
Date:   Tue May 31 23:26:11 2011 -0700

    rtc: Fix ioctl error path return
    
    Bryan Henderson noticed that the  "RTC: Fix rtc driver ioctl specific
    shortcutting" commit has a small bug: When an ioctl is called with an
    invalid command code and the clock driver does not have an "ioctl"
    method, the ioctl returns rc 0 instead of -ENOTTY.
    
    This patch fixes the issue.
    
    CC: Bryan Henderson <bryanh@giraffe-data.com>
    CC: Gabor Z. Papp <gzp@papp.hu>
    Reported-by: Bryan Henderson <bryanh@giraffe-data.com>
    Signed-off-by: John Stultz <john.stultz@linaro.org>

diff --git a/drivers/rtc/rtc-dev.c b/drivers/rtc/rtc-dev.c
index d0e06edb14c5..cace6d3aed9a 100644
--- a/drivers/rtc/rtc-dev.c
+++ b/drivers/rtc/rtc-dev.c
@@ -421,7 +421,8 @@ static long rtc_dev_ioctl(struct file *file,
 			err = ops->ioctl(rtc->dev.parent, cmd, arg);
 			if (err == -ENOIOCTLCMD)
 				err = -ENOTTY;
-		}
+		} else
+			err = -ENOTTY;
 		break;
 	}
 

