commit cbdea7b8fb39f8c8badbc5690822df9a9152b98b
Author: Paul Wouters <paul@xelerance.com>
Date:   Thu Aug 28 12:32:36 2008 -0400

    Use ixs->physdev->ifindex not ixs->physdev->iflink, so that VLAN's which
    share the same iflink, but not ifindex, work properly. Lost in openswan
    2.4 -> 2.5 transition? Originally found by Tino Keitel and Krisztian KOVACS

diff --git a/linux/net/ipsec/ipsec_xmit.c b/linux/net/ipsec/ipsec_xmit.c
index a98a8cd63..8b5061d10 100644
--- a/linux/net/ipsec/ipsec_xmit.c
+++ b/linux/net/ipsec/ipsec_xmit.c
@@ -2108,7 +2108,7 @@ ipsec_tunnel_send(struct ipsec_xmit_state *ixs)
 
 	/* new route/dst cache code from James Morris */
 	ixs->skb->dev = ixs->physdev;
- 	fl.oif = ixs->physdev->iflink;
+ 	fl.oif = ixs->physdev->ifindex;
 
 	return ipsec_xmit_send(ixs, &fl);
 }

