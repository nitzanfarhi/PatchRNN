commit 179f1aa407b466c06a94f9e54abc948d1e1146e7
Author: Sebastian Hesselbarth <sebastian.hesselbarth@gmail.com>
Date:   Wed Aug 14 21:43:32 2013 +0200

    drm/i2c: tda998x: prepare for broken sync workaround
    
    Some LCD controller cannot provide valid VESA style sync, i.e. coincident
    HS/VS edges. First, this patch adds hskew passed from the adjusted_mode to
    reference pixel calculation to allow those controllers to add an offset
    relative to the expected reference pixel.
    
    Signed-off-by: Darren Etheridge <detheridge@ti.com>
    Signed-off-by: Sebastian Hesselbarth <sebastian.hesselbarth@gmail.com>
    Tested-by: Russell King <rmk_kernel@arm.linux.org.uk>
    Signed-off-by: Dave Airlie <airlied@redhat.com>

diff --git a/drivers/gpu/drm/i2c/tda998x_drv.c b/drivers/gpu/drm/i2c/tda998x_drv.c
index 92fcb3deae22..c2bd711e86e9 100644
--- a/drivers/gpu/drm/i2c/tda998x_drv.c
+++ b/drivers/gpu/drm/i2c/tda998x_drv.c
@@ -782,6 +782,14 @@ tda998x_encoder_mode_set(struct drm_encoder *encoder,
 	de_pix_s     = mode->htotal - mode->hdisplay;
 	ref_pix      = 3 + hs_pix_s;
 
+	/*
+	 * Attached LCD controllers may generate broken sync. Allow
+	 * those to adjust the position of the rising VS edge by adding
+	 * HSKEW to ref_pix.
+	 */
+	if (adjusted_mode->flags & DRM_MODE_FLAG_HSKEW)
+		ref_pix += adjusted_mode->hskew;
+
 	if ((mode->flags & DRM_MODE_FLAG_INTERLACE) == 0) {
 		ref_line     = 1 + mode->vsync_start - mode->vdisplay;
 		vwin1_line_s = mode->vtotal - mode->vdisplay - 1;

