commit 73eb9965cf3c553e354def0d8b55b066eb1fc074
Author: Nicholas Maniscalco <nicholas@maniscalco.com>
Date:   Wed Feb 2 13:41:22 2011 +0100

    multi: fix CURLM_STATE_TOOFAST for multi_socket
    
    The code in the toofast state needs to first recalculate the values
    before it uses them again since it may have been a while since it last
    did it when it reaches this point.

diff --git a/lib/multi.c b/lib/multi.c
index ecd72bb32..122f66b40 100644
--- a/lib/multi.c
+++ b/lib/multi.c
@@ -1408,6 +1408,7 @@ static CURLMcode multi_runsingle(struct Curl_multi *multi,
 
     case CURLM_STATE_TOOFAST: /* limit-rate exceeded in either direction */
       /* if both rates are within spec, resume transfer */
+      Curl_pgrsUpdate(easy->easy_conn);
       if( ( (data->set.max_send_speed == 0) ||
             (data->progress.ulspeed < data->set.max_send_speed ))  &&
           ( (data->set.max_recv_speed == 0) ||

