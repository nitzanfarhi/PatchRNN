commit f67b4938af07e3ef3a925027a2fc62199c026e2b
Author: Michael Neuling <mikey@neuling.org>
Date:   Fri Jun 5 14:38:26 2015 +1000

    cxl: Reset default context for vPHB on release
    
    When we release the device, we should also invalidate the default context.
    With this cxl_get_context() will return null after removal.
    
    Signed-off-by: Michael Neuling <mikey@neuling.org>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>

diff --git a/drivers/misc/cxl/vphb.c b/drivers/misc/cxl/vphb.c
index f733309b65d5..b1d1983a84a5 100644
--- a/drivers/misc/cxl/vphb.c
+++ b/drivers/misc/cxl/vphb.c
@@ -72,6 +72,7 @@ static void cxl_pci_disable_device(struct pci_dev *dev)
 			dev_err(&dev->dev, "Default context started\n");
 			return;
 		}
+		dev->dev.archdata.cxl_ctx = NULL;
 		cxl_release_context(ctx);
 	}
 }

