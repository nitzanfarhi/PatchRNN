commit 6ec5dae5a49f2933dc9b3925d8054eb380a56d88
Author: Yonit Halperin <yhalperi@redhat.com>
Date:   Sun Mar 18 09:42:39 2012 +0200

    monitor: fix client_migrate_info error handling
    
    Report QERR_MISSING_PARAMETER when port is missing. Otherwise
    QERR_UNDEFINED_ERROR will occur.
    
    rhbz #795652
    
    Signed-off-by: Yonit Halperin <yhalperi@redhat.com>
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

diff --git a/monitor.c b/monitor.c
index d57e7bf61d..8f460317ee 100644
--- a/monitor.c
+++ b/monitor.c
@@ -880,6 +880,11 @@ static int client_migrate_info(Monitor *mon, const QDict *qdict,
             return -1;
         }
 
+        if (port == -1 && tls_port == -1) {
+            qerror_report(QERR_MISSING_PARAMETER, "port/tls-port");
+            return -1;
+        }
+
         ret = qemu_spice_migrate_info(hostname, port, tls_port, subject,
                                       cb, opaque);
         if (ret != 0) {

