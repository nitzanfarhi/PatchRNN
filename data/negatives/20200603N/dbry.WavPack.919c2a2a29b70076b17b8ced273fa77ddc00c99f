commit 919c2a2a29b70076b17b8ced273fa77ddc00c99f
Author: David Bryant <david@wavpack.com>
Date:   Sun Aug 26 20:01:10 2018 -0700

    issue #42: make sure channel chunk does not have negative length

diff --git a/cli/caff.c b/cli/caff.c
index 807f750..a6a98e0 100644
--- a/cli/caff.c
+++ b/cli/caff.c
@@ -276,9 +276,10 @@ int ParseCaffHeaderConfig (FILE *infile, char *infilename, char *fourcc, Wavpack
         else if (!strncmp (caf_chunk_header.mChunkType, "chan", 4)) {
             CAFChannelLayout *caf_channel_layout;
 
-            if (caf_chunk_header.mChunkSize < sizeof (CAFChannelLayout) || caf_chunk_header.mChunkSize > 1024) {
-                error_line ("this .CAF file has an invalid 'chan' chunk!");
-                return WAVPACK_SOFT_ERROR;
+            if (caf_chunk_header.mChunkSize < 0 || caf_chunk_header.mChunkSize > 1024 ||
+                caf_chunk_header.mChunkSize < sizeof (CAFChannelLayout)) {
+                    error_line ("this .CAF file has an invalid 'chan' chunk!");
+                    return WAVPACK_SOFT_ERROR;
             }
 
             if (debug_logging_mode)

