commit 2a643ec67f9efc4b6921a3dd6e257f3b5360622b
Author: Stephen M. Cameron <scameron@beardog.cce.hp.com>
Date:   Wed Aug 25 19:58:53 2010 +0200

    cciss: fix reporting of max queue depth since init
    
    The ioctl path and the scsi tape path were not accounting
    for their additions to the queue depth.
    
    Signed-off-by: Stephen M. Cameron <scameron@beardog.cce.hp.com>
    Signed-off-by: Jens Axboe <jaxboe@fusionio.com>

diff --git a/drivers/block/cciss.c b/drivers/block/cciss.c
index 7191c16954d2..6124c2fd2d33 100644
--- a/drivers/block/cciss.c
+++ b/drivers/block/cciss.c
@@ -297,6 +297,8 @@ static void enqueue_cmd_and_start_io(ctlr_info_t *h,
 	spin_lock_irqsave(&h->lock, flags);
 	addQ(&h->reqQ, c);
 	h->Qdepth++;
+	if (h->Qdepth > h->maxQsinceinit)
+		h->maxQsinceinit = h->Qdepth;
 	start_io(h);
 	spin_unlock_irqrestore(&h->lock, flags);
 }

