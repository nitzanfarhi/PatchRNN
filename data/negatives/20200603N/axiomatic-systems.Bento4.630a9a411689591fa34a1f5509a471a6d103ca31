commit 630a9a411689591fa34a1f5509a471a6d103ca31
Author: bok <bok@c210c87e-2b05-0410-b4a6-82fbe8e97a6a>
Date:   Fri Mar 29 02:57:31 2013 +0000

    Avoid default-base-is-moof in PIFF format

diff --git a/Source/C++/Core/Ap4CommonEncryption.cpp b/Source/C++/Core/Ap4CommonEncryption.cpp
index 7fc05d3..2c8272b 100644
--- a/Source/C++/Core/Ap4CommonEncryption.cpp
+++ b/Source/C++/Core/Ap4CommonEncryption.cpp
@@ -566,7 +566,7 @@ AP4_CencFragmentEncrypter::ProcessFragment()
     
     // set the default-base-is-moof flag
     AP4_TfhdAtom* tfhd = AP4_DYNAMIC_CAST(AP4_TfhdAtom, m_Traf->GetChild(AP4_ATOM_TYPE_TFHD));
-    if (tfhd) {
+    if (tfhd && m_Variant != AP4_CENC_VARIANT_PIFF_CBC && m_Variant != AP4_CENC_VARIANT_PIFF_CTR) {
         tfhd->SetFlags(tfhd->GetFlags() | AP4_TFHD_FLAG_DEFAULT_BASE_IS_MOOF);
     }
     

