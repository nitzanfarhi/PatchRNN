commit 1db2b9dde3317e181f76860410cb0e7433896f28
Author: Bryan Schumaker <bjschuma@netapp.com>
Date:   Wed Apr 27 15:47:15 2011 -0400

    NFSD: Check status from nfsd4_map_bcts_dir()
    
    Compiling gave me this warning:
    fs/nfsd/nfs4state.c: In function ‘nfsd4_bind_conn_to_session’:
    fs/nfsd/nfs4state.c:1623:9: warning: variable ‘status’ set but not used
    [-Wunused-but-set-variable]
    
    The local variable "status" was being set by nfsd4_map_bcts_dir() and
    then ignored before calling nfsd4_new_conn().
    
    Signed-off-by: Bryan Schumaker <bjschuma@netapp.com>
    Signed-off-by: J. Bruce Fields <bfields@redhat.com>

diff --git a/fs/nfsd/nfs4state.c b/fs/nfsd/nfs4state.c
index 2bb03f86a037..a2ea14f40b42 100644
--- a/fs/nfsd/nfs4state.c
+++ b/fs/nfsd/nfs4state.c
@@ -1636,8 +1636,9 @@ __be32 nfsd4_bind_conn_to_session(struct svc_rqst *rqstp,
 		return nfserr_badsession;
 
 	status = nfsd4_map_bcts_dir(&bcts->dir);
-	nfsd4_new_conn(rqstp, cstate->session, bcts->dir);
-	return nfs_ok;
+	if (!status)
+		nfsd4_new_conn(rqstp, cstate->session, bcts->dir);
+	return status;
 }
 
 static bool nfsd4_compound_in_session(struct nfsd4_session *session, struct nfs4_sessionid *sid)

