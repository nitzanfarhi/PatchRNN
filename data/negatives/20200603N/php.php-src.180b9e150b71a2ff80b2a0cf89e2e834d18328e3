commit 180b9e150b71a2ff80b2a0cf89e2e834d18328e3
Author: Rasmus Lerdorf <rasmus@php.net>
Date:   Wed Dec 19 22:58:18 2012 -0500

    Fix for bug #63811

diff --git a/main/streams/userspace.c b/main/streams/userspace.c
index 3b277160d6..74d9beb025 100644
--- a/main/streams/userspace.c
+++ b/main/streams/userspace.c
@@ -458,7 +458,7 @@ static php_stream *user_wrapper_opendir(php_stream_wrapper *wrapper, char *filen
 	us->wrapper = uwrap;
 
 	us->object = user_stream_create_object(uwrap, context TSRMLS_CC);
-	if(us == NULL) {
+	if(us->object == NULL) {
 		FG(user_stream_current_filename) = NULL;
 		efree(us);
 		return NULL;

