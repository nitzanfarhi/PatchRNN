commit f2a5ded38592e5936a099ea6535ad5d3addcbc9d
Author: Nicolas Boichat <drinkcat@chromium.org>
Date:   Fri Jul 17 10:36:57 2015 +0800

    ASoC: rt5645: Check if codec is initialized in workqueue handler
    
    This fixes kernel panic on boot, if rt5645->codec is NULL when
    rt5645_jack_detect_work is first called.
    
    rt5645_jack_detect_work needs rt5645->codec to be initialized to setup
    dapm pins. Also, reporting jack events is useless, as the jacks cannot
    be set before the codec is ready.
    
    Since we manually call the interrupt handler in
    rt5645_set_jack_detect, the initial jack state will be reported
    correctly, and dapm pins will be setup at that time.
    
    Signed-off-by: Nicolas Boichat <drinkcat@chromium.org>
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/sound/soc/codecs/rt5645.c b/sound/soc/codecs/rt5645.c
index 9ce311e088fc..e9cc3aae5366 100644
--- a/sound/soc/codecs/rt5645.c
+++ b/sound/soc/codecs/rt5645.c
@@ -2943,6 +2943,9 @@ static int rt5645_irq_detection(struct rt5645_priv *rt5645)
 {
 	int val, btn_type, gpio_state = 0, report = 0;
 
+	if (!rt5645->codec)
+		return -EINVAL;
+
 	switch (rt5645->pdata.jd_mode) {
 	case 0: /* Not using rt5645 JD */
 		if (rt5645->gpiod_hp_det) {

