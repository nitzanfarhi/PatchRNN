commit e1fa0db34c0db830be7685243c13e5af56d099d4
Author: Eddie Kohler <ekohler@gmail.com>
Date:   Fri Jan 31 20:03:36 2014 -0500

    Restore old dither-penalty formula, which works better by penalizing less.

diff --git a/src/quantize.c b/src/quantize.c
index f14400a..45c7355 100644
--- a/src/quantize.c
+++ b/src/quantize.c
@@ -636,7 +636,7 @@ colormap_diversity(kchist* kch, Gt_OutputData* od, int blend)
             kcolor x = kch->h[chosen].ka.k, *y = &kch->h[adapt[j].pixel].ka.k;
             /* penalize combinations with large luminance difference */
             double dL = fabs(kc_luminance(&x) - kc_luminance(y));
-            dL = (dL >= 4096 ? dL * 2 / 8192. : 1);
+            dL = (dL > 8192 ? dL * 4 / 32767. : 1);
             /* create combination */
             for (i = 0; i < 3; ++i)
                 x.a[i] = (x.a[i] + y->a[i]) >> 1;

