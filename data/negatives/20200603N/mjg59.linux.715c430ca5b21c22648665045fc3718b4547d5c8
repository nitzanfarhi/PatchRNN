commit 715c430ca5b21c22648665045fc3718b4547d5c8
Author: Easwar Hariharan <easwar.hariharan@intel.com>
Date:   Wed Feb 3 14:32:14 2016 -0800

    staging/rdma/hfi1: Don't attempt to qualify or tune loopback plugs
    
    Loopback plugs used for testing hardware don't need to be qualified to
    bring the link up unlike production cables. This patch adds an exception
    for loopback plugs to the QSFP and SerDes tuning algortihm.
    
    Reviewed-by: Dean Luick <dean.luick@intel.com>
    Signed-off-by: Easwar Hariharan <easwar.hariharan@intel.com>
    Signed-off-by: Doug Ledford <dledford@redhat.com>

diff --git a/drivers/staging/rdma/hfi1/platform.c b/drivers/staging/rdma/hfi1/platform.c
index 9aa5e06633de..c3df1d892754 100644
--- a/drivers/staging/rdma/hfi1/platform.c
+++ b/drivers/staging/rdma/hfi1/platform.c
@@ -737,7 +737,8 @@ void tune_serdes(struct hfi1_pportdata *ppd)
 	ppd->driver_link_ready = 0;
 	ppd->offline_disabled_reason = HFI1_ODR_MASK(OPA_LINKDOWN_REASON_NONE);
 
-	if (loopback == LOOPBACK_SERDES || loopback == LOOPBACK_LCB ||
+	/* Skip the tuning for testing (loopback != none) and simulations */
+	if (loopback != LOOPBACK_NONE ||
 	    ppd->dd->icode == ICODE_FUNCTIONAL_SIMULATOR ||
 	    !dd->pcfg_cache.cache_valid) {
 		ppd->driver_link_ready = 1;

