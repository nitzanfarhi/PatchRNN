commit c74e90a9e37c4a3923905189a6ebbd7ef61e6e67
Author: Johannes Berg <johannes@sipsolutions.net>
Date:   Wed Oct 8 10:18:36 2008 +0200

    mac80211: fix debugfs netdev rename
    
    If, for some reason, a netdev has no debugfs dir, we shouldn't
    try to rename that dir.
    
    Signed-off-by: Johannes Berg <johannes@sipsolutions.net>
    Cc: Robin Holt <holt@sgi.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/net/mac80211/debugfs_netdev.c b/net/mac80211/debugfs_netdev.c
index 2a4515623776..2ad504fc3414 100644
--- a/net/mac80211/debugfs_netdev.c
+++ b/net/mac80211/debugfs_netdev.c
@@ -545,8 +545,12 @@ static int netdev_notify(struct notifier_block *nb,
 
 	sdata = IEEE80211_DEV_TO_SUB_IF(dev);
 
-	sprintf(buf, "netdev:%s", dev->name);
 	dir = sdata->debugfsdir;
+
+	if (!dir)
+		return 0;
+
+	sprintf(buf, "netdev:%s", dev->name);
 	if (!debugfs_rename(dir->d_parent, dir, dir->d_parent, buf))
 		printk(KERN_ERR "mac80211: debugfs: failed to rename debugfs "
 		       "dir to %s\n", buf);

