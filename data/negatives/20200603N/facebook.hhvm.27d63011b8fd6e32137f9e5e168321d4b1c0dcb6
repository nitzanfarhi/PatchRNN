commit 27d63011b8fd6e32137f9e5e168321d4b1c0dcb6
Author: myang <myang@2248de34-8caa-4a3c-bc55-5e52d9d7b73a>
Date:   Thu Feb 11 21:53:37 2010 +0000

    fix g++ error on '@' operator
    
    Summary: The '@' operator generates (silenceInc(), silenceDec(exp)) that has
             a return type of Variant (from silenceDec). Changed the type
             inference to reflect that.
    
    Reviewed By: hzhao
    
    Test Plan: new test
               make fast_tests
    
    Revert: OK
    
    DiffCamp Revision: 89926
    
    git-svn-id: http://svn.facebook.net/hiphop/fbomb/branches/hphp-dev/fbcode/hphp@21825 2248de34-8caa-4a3c-bc55-5e52d9d7b73a

diff --git a/src/lib/expression/unary_op_expression.cpp b/src/lib/expression/unary_op_expression.cpp
index afe286de11..a4ada257e7 100644
--- a/src/lib/expression/unary_op_expression.cpp
+++ b/src/lib/expression/unary_op_expression.cpp
@@ -257,7 +257,7 @@ TypePtr UnaryOpExpression::inferTypes(AnalysisResultPtr ar, TypePtr type,
   case T_DEC:
   case '~':             et = rt = NEW_TYPE(Primitive);                   break;
   case T_CLONE:         et = rt = NEW_TYPE(Object);                      break;
-  case '@':
+  case '@':             et = type;                rt = Type::Variant;    break;
   case '(':             et = rt = type;                                  break;
   case T_INT_CAST:      et = NEW_TYPE(Some);      rt = Type::Int64;      break;
   case T_DOUBLE_CAST:   et = NEW_TYPE(Some);      rt = Type::Double;     break;
@@ -326,7 +326,6 @@ TypePtr UnaryOpExpression::inferTypes(AnalysisResultPtr ar, TypePtr type,
     }
 
     switch (m_op) {
-    case '@':
     case '(':
       rt = expType;
       break;
diff --git a/src/test/test_code_run.cpp b/src/test/test_code_run.cpp
index ff0cd40bca..0f8ab42b0a 100644
--- a/src/test/test_code_run.cpp
+++ b/src/test/test_code_run.cpp
@@ -7140,6 +7140,9 @@ bool TestCodeRun::TestTernary() {
       "  return $class;"
       "}"
       "add_cssclass('test', $a);");
+  VCR("<?php "
+      "$a = 123;"
+      "echo $a ? @mysql_data_seek(null, null) : false;");
   return true;
 }
 

