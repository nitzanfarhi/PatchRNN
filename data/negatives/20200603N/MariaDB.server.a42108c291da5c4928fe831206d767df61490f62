commit a42108c291da5c4928fe831206d767df61490f62
Author: Alexey Kopytov <Alexey.Kopytov@sun.com>
Date:   Thu Jul 15 10:10:16 2010 +0400

    Backport of the fix for bug#25421 to 5.0.
    
    Calculating the estimated number of records for a range scan
    may take a significant time, and it was impossible for a user
    to interrupt that process by killing the connection or the
    query.
    
    Fixed by checking the thread's 'killed' status in
    check_quick_keys() and interrupting the calculation process if
    it is set to a non-zero value.

diff --git a/sql/opt_range.cc b/sql/opt_range.cc
index 84519c091b9..35d1216387c 100644
--- a/sql/opt_range.cc
+++ b/sql/opt_range.cc
@@ -6066,6 +6066,9 @@ check_quick_keys(PARAM *param,uint idx,SEL_ARG *key_tree,
     tmp_max_flag=max_key_flag | key_tree->max_flag;
   }
 
+  if (unlikely(param->thd->killed != 0))
+    return HA_POS_ERROR;
+
   keynr=param->real_keynr[idx];
   param->range_count++;
   if (!tmp_min_flag && ! tmp_max_flag &&

