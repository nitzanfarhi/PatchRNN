commit 07310a63147164eaf44a68932fbe9dbbde0fa82b
Author: Felix Fietkau <nbd@openwrt.org>
Date:   Wed Mar 2 15:54:51 2016 +0100

    mac80211: do not pass injected frames without a valid rate to the driver
    
    Fall back to rate control if the requested bitrate was not found.
    
    Fixes: dfdfc2beb0dd ("mac80211: Parse legacy and HT rate in injected frames")
    Signed-off-by: Felix Fietkau <nbd@openwrt.org>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/mac80211/tx.c b/net/mac80211/tx.c
index 51e225e4b450..597c8fe672a3 100644
--- a/net/mac80211/tx.c
+++ b/net/mac80211/tx.c
@@ -1839,6 +1839,9 @@ static bool ieee80211_parse_tx_radiotap(struct ieee80211_local *local,
 			}
 		}
 
+		if (info->control.rates[0].idx < 0)
+			info->control.flags &= ~IEEE80211_TX_CTRL_RATE_INJECT;
+
 		info->control.rates[0].flags = rate_flags;
 		info->control.rates[0].count = min_t(u8, rate_retries + 1,
 						     local->hw.max_rate_tries);

