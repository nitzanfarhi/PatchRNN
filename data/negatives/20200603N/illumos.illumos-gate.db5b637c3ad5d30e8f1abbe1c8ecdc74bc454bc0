commit db5b637c3ad5d30e8f1abbe1c8ecdc74bc454bc0
Author: priyanka <none@none>
Date:   Wed Mar 22 21:15:58 2006 -0800

    6390449 IP_NEXTHOP option not supported on raw IP sockets

diff --git a/usr/src/uts/common/inet/ip/icmp.c b/usr/src/uts/common/inet/ip/icmp.c
index e398e32528..4dec0c7b4c 100644
--- a/usr/src/uts/common/inet/ip/icmp.c
+++ b/usr/src/uts/common/inet/ip/icmp.c
@@ -1592,6 +1592,7 @@ icmp_opt_get(queue_t *q, int level, int name, uchar_t *ptr)
 		 * case MRT_ASSERT:
 		 * case IP_SEC_OPT:
 		 * case IP_DONTFAILOVER_IF:
+		 * case IP_NEXTHOP:
 		 */
 		default:
 			return (-1);
@@ -2078,6 +2079,7 @@ icmp_opt_set(queue_t *q, uint_t optset_context, int level, int name,
 		case MRT_ASSERT:
 		case IP_SEC_OPT:
 		case IP_DONTFAILOVER_IF:
+		case IP_NEXTHOP:
 			/*
 			 * "soft" error (negative)
 			 * option not handled at this level
diff --git a/usr/src/uts/common/inet/ip/icmp_opt_data.c b/usr/src/uts/common/inet/ip/icmp_opt_data.c
index 861dcbd44b..b1f83571f7 100644
--- a/usr/src/uts/common/inet/ip/icmp_opt_data.c
+++ b/usr/src/uts/common/inet/ip/icmp_opt_data.c
@@ -2,9 +2,8 @@
  * CDDL HEADER START
  *
  * The contents of this file are subject to the terms of the
- * Common Development and Distribution License, Version 1.0 only
- * (the "License").  You may not use this file except in compliance
- * with the License.
+ * Common Development and Distribution License (the "License").
+ * You may not use this file except in compliance with the License.
  *
  * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
  * or http://www.opensolaris.org/os/licensing.
@@ -20,7 +19,7 @@
  * CDDL HEADER END
  */
 /*
- * Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
+ * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
  */
 
@@ -144,6 +143,9 @@ opdes_t	icmp_opt_arr[] = {
 
 { IP_RECVIF, IPPROTO_IP, OA_RW, OA_RW, OP_NP, OP_PASSNEXT, sizeof (int), 0 },
 
+{ IP_NEXTHOP, IPPROTO_IP, OA_RW, OA_RW, OP_CONFIG, OP_PASSNEXT,
+	sizeof (in_addr_t),	-1 /* not initialized */ },
+
 { MRT_INIT, IPPROTO_IP, 0, OA_X, OP_CONFIG,
 	(OP_PASSNEXT|OP_NODEFAULT), sizeof (int),
 	-1 /* not initialized */ },
diff --git a/usr/src/uts/common/inet/ip/ip_opt_data.c b/usr/src/uts/common/inet/ip/ip_opt_data.c
index 4d837b03e8..5e98e73e63 100644
--- a/usr/src/uts/common/inet/ip/ip_opt_data.c
+++ b/usr/src/uts/common/inet/ip/ip_opt_data.c
@@ -2,9 +2,8 @@
  * CDDL HEADER START
  *
  * The contents of this file are subject to the terms of the
- * Common Development and Distribution License, Version 1.0 only
- * (the "License").  You may not use this file except in compliance
- * with the License.
+ * Common Development and Distribution License (the "License").
+ * You may not use this file except in compliance with the License.
  *
  * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
  * or http://www.opensolaris.org/os/licensing.
@@ -20,7 +19,7 @@
  * CDDL HEADER END
  */
 /*
- * Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
+ * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
  */
 
@@ -124,6 +123,9 @@ opdes_t		ip_opt_arr[] = {
 { IP_SEC_OPT, IPPROTO_IP, OA_RW, OA_RW, OP_NP, (OP_PASSNEXT|OP_NODEFAULT),
 	sizeof (ipsec_req_t), -1 /* not initialized */ },
 
+{ IP_NEXTHOP, IPPROTO_IP, OA_RW, OA_RW, OP_CONFIG, OP_PASSNEXT,
+	sizeof (in_addr_t),	-1 /* not initialized */ },
+
 { MRT_INIT, IPPROTO_IP, 0, OA_X, OP_CONFIG,
 	(OP_PASSNEXT|OP_NODEFAULT), sizeof (int), -1 /* not initialized */ },
 

