commit 6d8b21f3e816615f5553d992fdd96d4e7253309e
Author: Roman Shaposhnik <roman@shaposhnik.org>
Date:   Mon Jan 5 17:50:13 2009 +0000

    additional recovery for the badly broken streams
    
    Originally committed as revision 16438 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavformat/dv.c b/libavformat/dv.c
index f7a01465ea..a0e07e91ca 100644
--- a/libavformat/dv.c
+++ b/libavformat/dv.c
@@ -430,6 +430,8 @@ static int dv_read_packet(AVFormatContext *s, AVPacket *pkt)
     size = dv_get_packet(c->dv_demux, pkt);
 
     if (size < 0) {
+        if (!c->dv_demux->sys)
+            return AVERROR(EIO);
         size = c->dv_demux->sys->frame_size;
         if (get_buffer(s->pb, c->buf, size) <= 0)
             return AVERROR(EIO);

