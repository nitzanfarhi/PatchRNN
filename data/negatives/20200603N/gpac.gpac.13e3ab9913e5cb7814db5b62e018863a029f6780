commit 13e3ab9913e5cb7814db5b62e018863a029f6780
Author: Romain Bouqueau <romain.bouqueau.pro@gmail.com>
Date:   Mon Nov 12 18:46:25 2012 +0000

    [bouqueau] fix crashes when no dash_cfg specified
    
    git-svn-id: http://svn.code.sf.net/p/gpac/code/trunk/gpac@4227 63c20433-aa62-49bd-875c-5a186b69a8fb

diff --git a/src/media_tools/dash_segmenter.c b/src/media_tools/dash_segmenter.c
index f1d8368fc..c253a1437 100644
--- a/src/media_tools/dash_segmenter.c
+++ b/src/media_tools/dash_segmenter.c
@@ -498,7 +498,7 @@ static GF_Err gf_media_isom_segment_file(GF_ISOFile *input, const char *output_f
 	}
 
 	MaxFragmentDuration = (u32) (max_duration_sec * 1000);	
-	MaxSegmentDuration = (u32) (dash_cfg->segment_duration * 1000);
+	MaxSegmentDuration = (u32) (1000 * (dash_cfg ? dash_cfg->segment_duration : max_duration_sec));
 
 	if (dash_cfg) {
 		/*in single segment mode, only one big SIDX is written between the end of the moov and the first fragment. 
@@ -1068,7 +1068,7 @@ restart_fragmentation_pass:
 					stop_frag = 1;
 				} else if (tf==tfref) {
 					/*fragmenting on "clock" track: no drift control*/
-					if (!dash_cfg->fragments_start_with_rap || ( (next && next->IsRAP) || split_at_rap) ) {
+					if (!(dash_cfg ? dash_cfg->fragments_start_with_rap : 0) || ( (next && next->IsRAP) || split_at_rap) ) {
 						if (tf->FragmentLength*1000 >= MaxFragmentDuration*tf->TimeScale) {
 							stop_frag = 1;
 						}

