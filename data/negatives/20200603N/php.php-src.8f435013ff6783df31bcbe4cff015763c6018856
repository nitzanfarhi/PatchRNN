commit 8f435013ff6783df31bcbe4cff015763c6018856
Author: Wez Furlong <wez@php.net>
Date:   Tue Jun 29 21:51:53 2004 +0000

    Fix for Bug #28964 fread "greedy" behaviour

diff --git a/main/streams/streams.c b/main/streams/streams.c
index 46c5d16b2d..3ba75a0845 100755
--- a/main/streams/streams.c
+++ b/main/streams/streams.c
@@ -590,6 +590,9 @@ PHPAPI size_t _php_stream_read(php_stream *stream, char *buf, size_t size TSRMLS
 			/* EOF, or temporary end of data (for non-blocking mode). */
 			break;
 		}
+
+		/* just break anyway, to avoid greedy read */
+		break;
 	}
 
 	if (didread > 0) {

