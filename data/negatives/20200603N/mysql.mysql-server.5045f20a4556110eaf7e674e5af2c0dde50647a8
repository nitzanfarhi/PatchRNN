commit 5045f20a4556110eaf7e674e5af2c0dde50647a8
Author: John David Duncan <john.duncan@oracle.com>
Date:   Fri Dec 9 12:18:16 2011 -0800

    Fix problem with key buffers, detected by setting _MALLOC_CHECK_ on linux.

diff --git a/storage/ndb/memcache/include/Operation.h b/storage/ndb/memcache/include/Operation.h
index a44fa7884b7..9a23a668df0 100644
--- a/storage/ndb/memcache/include/Operation.h
+++ b/storage/ndb/memcache/include/Operation.h
@@ -142,7 +142,9 @@ inline void Operation::readColumn(int id) {
 /* Methods for writing to the key record */
 
 inline size_t Operation::requiredKeyBuffer() {
-  return plan->key_record->rec_size;
+  /* Malloc checkers complain if this +1 is not present.  Not sure why.
+     Theory: because the terminating null of a C-string may be written there. */
+  return plan->key_record->rec_size + 1;
 }
 
 inline void Operation::clearKeyNullBits() {
@@ -166,7 +168,7 @@ inline void Operation::setKeyPartNull(int id) {
 /*  Methods for writing to the row  */
 
 inline size_t Operation::requiredBuffer() {
-  return record->rec_size;
+  return record->rec_size + 1;
 }
 
 inline void Operation::setNullBits() {

