commit da667d63e02bed01945cc71d1a45710fcee277f9
Author: Noel Maersk <veox@wemakethings.net>
Date:   Fri Apr 11 03:01:13 2014 +0300

    config: write pool name and description to config.

diff --git a/pool.c b/pool.c
index e5f8af83..eb619953 100644
--- a/pool.c
+++ b/pool.c
@@ -22,9 +22,6 @@
  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  * SUCH DAMAGE.
- *
- * This file was originally written by Colin Percival as part of the Tarsnap
- * online backup system.
  */
 
 #include "config.h"
@@ -37,17 +34,17 @@
 
 char* get_pool_name(struct pool *pool) {
     if (opt_incognito) 
-		return "<pool>";
+	return "<pool>";
 
-    if (strcmp(pool->name, "") == 0) 
-		return pool->sockaddr_url;
+    if (strcmp(pool->name, "") == 0)
+	return pool->sockaddr_url;
 
     return pool->name;
 }
 
 char* get_pool_user(struct pool *pool) {
-    if (opt_incognito) 
-		return "<user>";
+    if (opt_incognito)
+	return "<user>";
 
     return pool->rpc_user;
 }
diff --git a/sgminer.c b/sgminer.c
index dc5965e5..9027496b 100644
--- a/sgminer.c
+++ b/sgminer.c
@@ -4274,6 +4274,13 @@ void write_config(FILE *fcfg)
 	for(i = 0; i < total_pools; i++) {
 		struct pool *pool = pools[i];
 
+		/* Using get_pool_name() here is unsafe if opt_incognito is true. */
+		if (strcmp(pool->name, "") != 0) {
+			fprintf(fcfg, "\n\t\t\"name\" : \"%s\",", json_escape(pool->name));
+		}
+		if (strcmp(pool->description, "") != 0) {
+			fprintf(fcfg, "\n\t\t\"description\" : \"%s\",", json_escape(pool->description));
+		}
 		if (pool->quota != 1) {
 			fprintf(fcfg, "%s\n\t{\n\t\t\"quota\" : \"%s%s%s%d;%s\",", i > 0 ? "," : "",
 				pool->rpc_proxy ? json_escape((char *)proxytype(pool->rpc_proxytype)) : "",

