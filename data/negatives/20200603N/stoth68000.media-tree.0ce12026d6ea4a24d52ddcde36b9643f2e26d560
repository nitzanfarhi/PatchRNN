commit 0ce12026d6ea4a24d52ddcde36b9643f2e26d560
Author: Eliad Peller <eliad@wizery.com>
Date:   Tue Jun 17 13:07:02 2014 +0300

    cfg80211: fix elapsed_jiffies calculation
    
    MAX_JIFFY_OFFSET has no meaning when calculating the
    elapsed jiffies, as jiffies run out until ULONG_MAX.
    
    This miscalculation results in erroneous values
    in case of a wrap-around.
    
    Signed-off-by: Eliad Peller <eliad@wizery.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/wireless/core.h b/net/wireless/core.h
index e9afbf10e756..7e3a3cef7df9 100644
--- a/net/wireless/core.h
+++ b/net/wireless/core.h
@@ -424,7 +424,7 @@ static inline unsigned int elapsed_jiffies_msecs(unsigned long start)
 	if (end >= start)
 		return jiffies_to_msecs(end - start);
 
-	return jiffies_to_msecs(end + (MAX_JIFFY_OFFSET - start) + 1);
+	return jiffies_to_msecs(end + (ULONG_MAX - start) + 1);
 }
 
 void

