commit 7746cf83d9cbc1d76a45685bdd4faced9fe51037
Author: Hannes Magnusson <bjori@php.net>
Date:   Mon Aug 29 21:20:41 2011 +0000

    fixed bug #55267 - session_regenerate_id fails after header sent even if session.use_cookies = 0

diff --git a/ext/session/session.c b/ext/session/session.c
index bc3b3487a0..89a3aca415 100644
--- a/ext/session/session.c
+++ b/ext/session/session.c
@@ -1670,7 +1670,7 @@ static PHP_FUNCTION(session_regenerate_id)
 		return;
 	}
 
-	if (SG(headers_sent)) {
+	if (SG(headers_sent) && PS(use_cookies)) {
 		php_error_docref(NULL TSRMLS_CC, E_WARNING, "Cannot regenerate session id - headers already sent");
 		RETURN_FALSE;
 	}

