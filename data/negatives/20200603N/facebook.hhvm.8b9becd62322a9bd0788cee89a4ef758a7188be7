commit 8b9becd62322a9bd0788cee89a4ef758a7188be7
Author: Sergey Pupyrev <spupyrev@fb.com>
Date:   Wed Aug 31 16:32:22 2016 -0700

    modifying dot output
    
    Summary:
    A small modification of the format in the output dot file to make things easier to parse and analyze.
    Instead of
      f3762 [label="connect\\nsamples=883"]
    we will have
      f3762 [label="connect",samples=883,size=273];
    Let me know if you rely on the existing file format; i'll create a separate parser then.
    
    Reviewed By: ottoni
    
    Differential Revision: D3787490
    
    fbshipit-source-id: 00a07a2844537f0e9bcecca01d608d10ef1f7e62

diff --git a/hphp/tools/hfsort/hfsort.cpp b/hphp/tools/hfsort/hfsort.cpp
index 6336978267..cd4de63116 100644
--- a/hphp/tools/hfsort/hfsort.cpp
+++ b/hphp/tools/hfsort/hfsort.cpp
@@ -112,6 +112,7 @@ void readPerfData(CallGraph& cg, gzFile file, bool computeArcWeight) {
       auto& arc = *cg.arcs.find(Arc(src, f));
       arc.normalizedWeight = arc.weight / func.samples;
       arc.avgCallOffset = arc.avgCallOffset / arc.weight;
+      assert(arc.avgCallOffset < cg.targets[src].size);
     }
   }
 }
diff --git a/hphp/tools/hfsort/hfutil.cpp b/hphp/tools/hfsort/hfutil.cpp
index 0f801b7090..a0d6e8a676 100644
--- a/hphp/tools/hfsort/hfutil.cpp
+++ b/hphp/tools/hfsort/hfutil.cpp
@@ -65,8 +65,13 @@ void CallGraph::printDot(char* fileName) const {
   fprintf(file, "digraph g {\n");
   for (size_t f = 0; f < funcs.size(); f++) {
     if (targets[f].samples == 0) continue;
-    fprintf(file, "f%lu [label=\"%s\\nsamples=%u\"]\n",
-            f, funcs[f].mangledNames[0].c_str(), targets[f].samples);
+    fprintf(
+      file,
+      "f%lu [label=\"%s\\nsamples=%u\\nsize=%u\"];\n",
+      f,
+      funcs[f].mangledNames[0].c_str(),
+      targets[f].samples,
+      targets[f].size);
   }
   for (size_t f = 0; f < funcs.size(); f++) {
     if (targets[f].samples == 0) continue;
@@ -74,7 +79,7 @@ void CallGraph::printDot(char* fileName) const {
       auto& arc = *arcs.find(Arc(f, dst));
       fprintf(
         file,
-        "f%lu -> f%u [label=normWgt=%.3lf,weight=%.0lf,callOffset=%.1lf]\n",
+        "f%lu -> f%u [label=\"normWgt=%.3lf,weight=%.0lf,callOffset=%.1lf\"];\n",
         f,
         dst,
         arc.normalizedWeight,

