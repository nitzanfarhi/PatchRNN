commit a2a89da693edd2738dc0be62746149ff5ed5ad9a
Author: Roger Dingledine <arma@torproject.org>
Date:   Mon Jul 17 06:59:56 2006 +0000

    and don't try to build the descriptor every second, if it's dirty
    but we don't have a known address.
    
    
    svn:r6777

diff --git a/src/or/router.c b/src/or/router.c
index 987a70798..a4782138d 100644
--- a/src/or/router.c
+++ b/src/or/router.c
@@ -751,6 +751,10 @@ router_rebuild_descriptor(int force)
     if (router_guess_address_from_dir_headers(&addr) < 0) {
       log_info(LD_CONFIG, "No hints from directory headers either. "
                "Will try again later.");
+      /* Stop trying to rebuild our descriptor every second. We'll
+       * learn that it's time to try again when server_has_changed_ip()
+       * marks it dirty. */
+      desc_clean_since = time(NULL);
       return -1;
     }
   }

