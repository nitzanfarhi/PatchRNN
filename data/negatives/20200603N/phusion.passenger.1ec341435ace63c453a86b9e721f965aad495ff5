commit 1ec341435ace63c453a86b9e721f965aad495ff5
Author: Hongli Lai (Phusion) <hongli@phusion.nl>
Date:   Sat Aug 2 19:22:01 2008 +0200

    Fix some spawn options passing bugs.

diff --git a/ext/apache2/Configuration.cpp b/ext/apache2/Configuration.cpp
index 894ba1194..e8577c7fc 100644
--- a/ext/apache2/Configuration.cpp
+++ b/ext/apache2/Configuration.cpp
@@ -99,7 +99,8 @@ passenger_config_merge_dir(apr_pool_t *p, void *basev, void *addv) {
 	config->spawnMethod = (add->spawnMethod == DirConfig::SM_UNSET) ? base->spawnMethod : add->spawnMethod;
 	config->frameworkSpawnerTimeout = (add->frameworkSpawnerTimeout == -1) ? base->frameworkSpawnerTimeout : add->frameworkSpawnerTimeout;
 	config->appSpawnerTimeout = (add->appSpawnerTimeout == -1) ? base->appSpawnerTimeout : add->appSpawnerTimeout;
-	config->maxRequests = (!add->maxRequestsSpecified) ? base->maxRequests : add->maxRequests;
+	config->maxRequests = (add->maxRequestsSpecified) ? add->maxRequests : base->maxRequests;
+	config->maxRequestsSpecified = base->maxRequestsSpecified || add->maxRequestsSpecified;
 	return config;
 }
 
diff --git a/ext/apache2/SpawnOptions.h b/ext/apache2/SpawnOptions.h
index e853a5285..12760ebd5 100644
--- a/ext/apache2/SpawnOptions.h
+++ b/ext/apache2/SpawnOptions.h
@@ -147,7 +147,7 @@ struct SpawnOptions {
 		this->appType        = appType;
 		this->frameworkSpawnerTimeout = frameworkSpawnerTimeout;
 		this->appSpawnerTimeout       = appSpawnerTimeout;
-		this->maxRequests    = 0;
+		this->maxRequests    = maxRequests;
 	}
 	
 	/**

