commit 3c6736d696341b3dddd5fcd71fc4dc5e2fd21b1e
Author: Colin Patrick McCabe <cmccabe@alumni.cmu.edu>
Date:   Wed Feb 23 05:59:22 2011 -0800

    rados_create: add id parameter
    
    Signed-off-by: Colin McCabe <colin.mccabe@dreamhost.com>

diff --git a/src/include/rados/librados.h b/src/include/rados/librados.h
index 33cd30bfa5..3d01eca5e1 100644
--- a/src/include/rados/librados.h
+++ b/src/include/rados/librados.h
@@ -51,7 +51,7 @@ struct rados_statfs_t {
 void rados_version(int *major, int *minor, int *extra);
 
 /* initialization */
-int rados_create(rados_t *cluster);
+int rados_create(rados_t *cluster, const char * const id);
 
 /* Connect to the cluster */
 int rados_connect(rados_t cluster);
diff --git a/src/librados.cc b/src/librados.cc
index 2f8b93ecca..0e9cd71c54 100644
--- a/src/librados.cc
+++ b/src/librados.cc
@@ -2352,7 +2352,7 @@ void Rados::set_notify_timeout(pool_t pool, uint32_t timeout)
 static Mutex rados_init_mutex("rados_init");
 static int rados_initialized = 0;
 
-extern "C" int rados_create(rados_t *pcluster)
+extern "C" int rados_create(rados_t *pcluster, const char * const id)
 {
   rados_init_mutex.Lock();
   if (!rados_initialized) {
@@ -2360,6 +2360,8 @@ extern "C" int rados_create(rados_t *pcluster)
     vector<const char*> args;
     env_to_vec(args);
 
+    if (id)
+      g_conf.id = strdup(id);
     common_init(args, "librados", STARTUP_FLAG_INIT_KEYS);
 
     ++rados_initialized;

