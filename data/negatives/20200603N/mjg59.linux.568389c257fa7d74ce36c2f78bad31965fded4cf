commit 568389c257fa7d74ce36c2f78bad31965fded4cf
Author: Thomas Gleixner <tglx@linutronix.de>
Date:   Fri Dec 17 11:16:17 2010 +0100

    serial: apbuart: Fixup apbuart_console_init()
    
    commit 35c64e5d (drivers: serial: apbuart: Handle OF failures
    gracefully) missed that the modified grlib_apbuart_configure()
    function is called from apbuart_console_init() as well.
    
    Fix the fallout.
    
    Reported-by: Stephen Rothwell <sfr@canb.auug.org.au>
    Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/serial/apbuart.c b/drivers/serial/apbuart.c
index 2e84d9c3d419..a30bb9620c9b 100644
--- a/drivers/serial/apbuart.c
+++ b/drivers/serial/apbuart.c
@@ -520,11 +520,12 @@ static struct console grlib_apbuart_console = {
 };
 
 
-static void grlib_apbuart_configure(void);
+static int grlib_apbuart_configure(void);
 
 static int __init apbuart_console_init(void)
 {
-	grlib_apbuart_configure();
+	if (grlib_apbuart_configure())
+		return -ENODEV;
 	register_console(&grlib_apbuart_console);
 	return 0;
 }

