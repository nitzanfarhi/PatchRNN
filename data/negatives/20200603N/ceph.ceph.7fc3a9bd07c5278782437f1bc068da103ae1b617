commit 7fc3a9bd07c5278782437f1bc068da103ae1b617
Author: Sage Weil <sage@redhat.com>
Date:   Sat Apr 7 14:18:52 2018 -0500

    mon/OSDMonitor: disallow pg_num changes while CREATING flag is set
    
    Signed-off-by: Sage Weil <sage@redhat.com>

diff --git a/src/mon/OSDMonitor.cc b/src/mon/OSDMonitor.cc
index ea84caeab7..4fefba9e90 100644
--- a/src/mon/OSDMonitor.cc
+++ b/src/mon/OSDMonitor.cc
@@ -6844,6 +6844,10 @@ int OSDMonitor::prepare_command_pool_set(const cmdmap_t& cmdmap,
          << " (you may adjust 'mon max pool pg num' for higher values)";
       return -ERANGE;
     }
+    if (p.has_flag(pg_pool_t::FLAG_CREATING)) {
+      ss << "cannot adjust pg_num while initial PGs are being created";
+      return -EBUSY;
+    }
     if (n > (int)p.get_pg_num()) {
       p.set_pg_num(n);
     } else {

