commit aed6d05d8c52345840379a0ca1a303da4eee5647
Author: Alexander Alashkin <alexander.alashkin@cesanta.com>
Date:   Wed Mar 1 09:50:12 2017 +0000

    Do not test reassembled buffer for WS_OP_CLOSE
    
    PUBLISHED_FROM=0e8de208b553b63c8367f66893389587bd17359f

diff --git a/mongoose.c b/mongoose.c
index 914879e..e4c210e 100644
--- a/mongoose.c
+++ b/mongoose.c
@@ -8888,8 +8888,8 @@ static int mg_deliver_websocket_data(struct mg_connection *nc) {
       mbuf_remove(&nc->recv_mbuf, (size_t) frame_len); /* Cleanup frame */
     }
 
-    /* If client closes, close too */
-    if ((buf[0] & 0x0f) == WEBSOCKET_OP_CLOSE) {
+    /* If the frame is not reassembled - client closes and close too */
+    if (!reass && (buf[0] & 0x0f) == WEBSOCKET_OP_CLOSE) {
       nc->flags |= MG_F_SEND_AND_CLOSE;
     }
   }

