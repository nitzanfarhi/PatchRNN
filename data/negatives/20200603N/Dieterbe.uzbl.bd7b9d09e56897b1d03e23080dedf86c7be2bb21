commit bd7b9d09e56897b1d03e23080dedf86c7be2bb21
Author: keis <keijser@gmail.com>
Date:   Sun Sep 11 14:32:02 2011 +0200

    bail if trying to send events with newlines
    
    each line is treated as a new event by the event manager
    so previous behaviour could cause to event injection, which in theory
    could be use to exploit uzbl.

diff --git a/src/events.c b/src/events.c
index 20f45457..fdb6b2af 100644
--- a/src/events.c
+++ b/src/events.c
@@ -192,11 +192,15 @@ vsend_event(int type, const gchar *custom_event, va_list vargs) {
         }
     }
 
-    g_string_append_c(event_message, '\n');
-
-    if (uzbl.state.events_stdout)
-        send_event_stdout (event_message);
-    send_event_socket (event_message);
+    // A event string is not supposed to contain newlines as it will be
+    // interpreted as two events
+    if (!strchr(event_message->str, '\n')) {
+        g_string_append_c(event_message, '\n');
+
+        if (uzbl.state.events_stdout)
+            send_event_stdout (event_message);
+        send_event_socket (event_message);
+    }
 
     g_string_free (event_message, TRUE);
 }

