commit 5a3446bc648d86a99a895e93d28d7df00bbbfb3c
Author: David Ahern <daahern@cisco.com>
Date:   Sun Jan 9 11:21:12 2011 -0700

    perf stat: better error message for unsupported events
    
    For unsupported events (e.g., H/W events when running in a VM)
    perf stat currently fails with the error message:
    
          Error: open_counter returned with 2 (No such file or directory).
        /bin/dmesg may provide additional information.
    
          Fatal: Not all events could be opened.
    
    dmesg is of no help and it is not clear as to why it fails to
    open the counter. This patch changes the error message to
    
          Error: cache-misses event is not supported.
          Fatal: Not all events could be opened.
    
    Cc: Ingo Molnar <mingo@elte.hu>
    Cc: Paul Mackerras <paulus@samba.org>
    Cc: a.p.zijlstra@chello.nl
    LPU-Reference: <1294597272-17335-1-git-send-email-daahern@cisco.com>
    Signed-off-by: David Ahern <daahern@cisco.com>
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

diff --git a/tools/perf/builtin-stat.c b/tools/perf/builtin-stat.c
index 2dfcb613e66b..c385a63ebfd1 100644
--- a/tools/perf/builtin-stat.c
+++ b/tools/perf/builtin-stat.c
@@ -316,6 +316,8 @@ static int run_perf_stat(int argc __used, const char **argv)
 				      "\t Consider tweaking"
 				      " /proc/sys/kernel/perf_event_paranoid or running as root.",
 				      system_wide ? "system-wide " : "");
+			} else if (errno == ENOENT) {
+				error("%s event is not supported. ", event_name(counter));
 			} else {
 				error("open_counter returned with %d (%s). "
 				      "/bin/dmesg may provide additional information.\n",

