commit 6abcb0d1fd4f329c350f5e78f8bca96182cae967
Author: Pablo Rincon <pablo.rincon.crespo@gmail.com>
Date:   Mon May 3 21:21:15 2010 +0200

    http_heade fix, check first that we have a connp before checking transactions

diff --git a/src/detect-http-header.c b/src/detect-http-header.c
index 56c4d8e8..31dbec39 100644
--- a/src/detect-http-header.c
+++ b/src/detect-http-header.c
@@ -74,7 +74,8 @@ int DetectHttpHeaderMatch(ThreadVars *t, DetectEngineThreadCtx *det_ctx,
 
     SCMutexLock(&f->m);
 
-    if (htp_state == NULL) {
+    if (htp_state == NULL || htp_state->connp == NULL ||
+        htp_state->connp->conn == NULL) {
         SCLogDebug("No htp state, no match at http header data");
         goto end;
     }

