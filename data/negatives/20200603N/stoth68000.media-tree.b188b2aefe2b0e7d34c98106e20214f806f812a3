commit b188b2aefe2b0e7d34c98106e20214f806f812a3
Author: Kumar Gala <galak@kernel.crashing.org>
Date:   Mon Jan 14 09:41:36 2008 -0600

    [POWERPC] Fixup transparent P2P resources
    
    For transparent P2P bridges the first 3 resources may get set from based on
    BAR registers and need to get fixed up. Where as the remainder come from the
    parent bus and have already been fixed up.
    
    Signed-off-by: Kumar Gala <galak@kernel.crashing.org>

diff --git a/arch/powerpc/kernel/pci-common.c b/arch/powerpc/kernel/pci-common.c
index 7d0afd47b3e0..980fe32895c0 100644
--- a/arch/powerpc/kernel/pci-common.c
+++ b/arch/powerpc/kernel/pci-common.c
@@ -792,9 +792,10 @@ static void __devinit __pcibios_fixup_bus(struct pci_bus *bus)
 		for (i = 0; i < PCI_BUS_NUM_RESOURCES; ++i) {
 			if ((res = bus->resource[i]) == NULL)
 				continue;
-			if (!res->flags || bus->self->transparent)
+			if (!res->flags)
+				continue;
+			if (i >= 3 && bus->self->transparent)
 				continue;
-
 			/* On PowerMac, Apple leaves bridge windows open over
 			 * an inaccessible region of memory space (0...fffff)
 			 * which is somewhat bogus, but that's what they think

