commit a5429c88464ab770b255340b62987b2b8245788f
Author: Rainer Gerhards <rgerhards@adiscon.com>
Date:   Mon Oct 12 16:50:51 2015 +0200

    bugfix: omfile writes partial lines in when async writing is enabled

diff --git a/tools/omfile.c b/tools/omfile.c
index 8fa84b234..8d87ef7d9 100644
--- a/tools/omfile.c
+++ b/tools/omfile.c
@@ -1037,14 +1037,16 @@ CODESTARTcommitTransaction
 		writeFile(pData, pParams, i);
 	}
 	/* Note: pStrm may be NULL if there was an error opening the stream */
-	if(pData->bFlushOnTXEnd && pData->pStrm != NULL) {
-		/* if we have an async writer, it controls the flush via
-		 * a timeout. However, without it, we actually need to flush,
-		 * else incomplete records are written.
-		 */
-		if(!pData->bUseAsyncWriter)
+	if(pData->bUseAsyncWriter) {
+		if(pData->bFlushOnTXEnd && pData->pStrm != NULL) {
 			CHKiRet(strm.Flush(pData->pStrm));
+		}
+	} else {
+		if(pData->pStrm != NULL) {
+			CHKiRet(strm.Flush(pData->pStrm));
+		}
 	}
+
 finalize_it:
 	pthread_mutex_unlock(&pData->mutWrite);
 ENDcommitTransaction

