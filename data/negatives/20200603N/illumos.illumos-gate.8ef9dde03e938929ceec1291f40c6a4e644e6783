commit 8ef9dde03e938929ceec1291f40c6a4e644e6783
Author: marks <none@none>
Date:   Tue Feb 7 12:37:40 2006 -0800

    6381600 tc_open.021 in mstc testsuite is returning -1 when run on a zfs

diff --git a/usr/src/uts/common/fs/zfs/zfs_vnops.c b/usr/src/uts/common/fs/zfs/zfs_vnops.c
index fd71675edf..959a3122e0 100644
--- a/usr/src/uts/common/fs/zfs/zfs_vnops.c
+++ b/usr/src/uts/common/fs/zfs/zfs_vnops.c
@@ -1915,7 +1915,7 @@ zfs_setattr(vnode_t *vp, vattr_t *vap, int flags, cred_t *cr,
 	if (mask & AT_SIZE && vp->v_type == VDIR)
 		return (EISDIR);
 
-	if (mask & AT_SIZE && vp->v_type != VREG)
+	if (mask & AT_SIZE && vp->v_type != VREG && vp->v_type != VFIFO)
 		return (EINVAL);
 
 	ZFS_ENTER(zfsvfs);
diff --git a/usr/src/uts/common/fs/zfs/zfs_znode.c b/usr/src/uts/common/fs/zfs/zfs_znode.c
index 9d52c5d11d..7eb3a2410d 100644
--- a/usr/src/uts/common/fs/zfs/zfs_znode.c
+++ b/usr/src/uts/common/fs/zfs/zfs_znode.c
@@ -20,7 +20,7 @@
  * CDDL HEADER END
  */
 /*
- * Copyright 2005 Sun Microsystems, Inc.  All rights reserved.
+ * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
  */
 
@@ -1128,6 +1128,9 @@ zfs_freesp(znode_t *zp, uint64_t from, uint64_t len, int flag, dmu_tx_t *tx,
 	uint64_t end = from + len;
 	int have_grow_lock, error;
 
+	if (ZTOV(zp)->v_type == VFIFO)
+		return (0);
+
 	have_grow_lock = RW_WRITE_HELD(&zp->z_grow_lock);
 
 	/*

