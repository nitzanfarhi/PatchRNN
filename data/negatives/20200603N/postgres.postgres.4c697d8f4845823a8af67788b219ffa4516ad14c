commit 4c697d8f4845823a8af67788b219ffa4516ad14c
Author: Heikki Linnakangas <heikki.linnakangas@iki.fi>
Date:   Mon Nov 18 09:51:09 2013 +0200

    Count locked pages that don't need vacuuming as scanned.
    
    Previously, if VACUUM skipped vacuuming a page because it's pinned, it
    didn't count that page as scanned. However, that meant that relfrozenxid
    was not bumped up either, which prevented anti-wraparound vacuum from
    doing its job.
    
    Report by Миша Тюрин, analysis and patch by Sergey Burladyn and Jeff Janes.
    Backpatch to 9.2, where the skip-locked-pages behavior was introduced.

diff --git a/src/backend/commands/vacuumlazy.c b/src/backend/commands/vacuumlazy.c
index e1d6d1c9e6..6778c7d58f 100644
--- a/src/backend/commands/vacuumlazy.c
+++ b/src/backend/commands/vacuumlazy.c
@@ -602,6 +602,7 @@ lazy_scan_heap(Relation onerel, LVRelStats *vacrelstats,
 			if (!lazy_check_needs_freeze(buf))
 			{
 				UnlockReleaseBuffer(buf);
+				vacrelstats->scanned_pages++;
 				continue;
 			}
 			LockBuffer(buf, BUFFER_LOCK_UNLOCK);

