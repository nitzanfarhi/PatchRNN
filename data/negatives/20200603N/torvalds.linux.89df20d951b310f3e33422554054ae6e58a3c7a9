commit 89df20d951b310f3e33422554054ae6e58a3c7a9
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Tue May 20 11:38:18 2014 +0200

    stmmac: Remove unbalanced clk_disable call
    
    The stmmac_open call was calling clk_disable_unprepare on phy init
    failure, but it never calls clk_prepare_enable, this causes
    a WARN_ON in the clk framework to trigger if for some reason phy init
    fails.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Acked-by: Giuseppe Cavallaro <peppe.cavallaro@st.com>
    Acked-by: Chen-Yu Tsai <wens@csie.org>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c b/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
index d940034acdd4..0f4841d2e8dc 100644
--- a/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
+++ b/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
@@ -1704,7 +1704,7 @@ static int stmmac_open(struct net_device *dev)
 		if (ret) {
 			pr_err("%s: Cannot attach to PHY (error: %d)\n",
 			       __func__, ret);
-			goto phy_error;
+			return ret;
 		}
 	}
 
@@ -1779,8 +1779,6 @@ static int stmmac_open(struct net_device *dev)
 dma_desc_error:
 	if (priv->phydev)
 		phy_disconnect(priv->phydev);
-phy_error:
-	clk_disable_unprepare(priv->stmmac_clk);
 
 	return ret;
 }

