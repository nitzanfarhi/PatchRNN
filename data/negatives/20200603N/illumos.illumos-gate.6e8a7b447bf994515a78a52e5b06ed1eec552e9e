commit 6e8a7b447bf994515a78a52e5b06ed1eec552e9e
Author: jchu <none@none>
Date:   Sun Jan 14 15:32:18 2007 -0800

    6502745 px driver output wrong information for IMU error
    6512844 panic in pcie_get_ppd with QLC device hang off Fire leaf directly

diff --git a/usr/src/uts/sun4/io/px/px.c b/usr/src/uts/sun4/io/px/px.c
index d3a36c3eb7..d1322be4ea 100644
--- a/usr/src/uts/sun4/io/px/px.c
+++ b/usr/src/uts/sun4/io/px/px.c
@@ -19,7 +19,7 @@
  * CDDL HEADER END
  */
 /*
- * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
+ * Copyright 2007 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
  */
 
@@ -1220,6 +1220,9 @@ px_ctlops(dev_info_t *dip, dev_info_t *rdip,
 		return (px_uninit_child(px_p, (dev_info_t *)arg));
 
 	case DDI_CTLOPS_ATTACH:
+		if (!pcie_is_child(dip, rdip))
+			return (DDI_SUCCESS);
+
 		as = (struct attachspec *)arg;
 		switch (as->when) {
 		case DDI_PRE:
diff --git a/usr/src/uts/sun4u/io/px/px_err.c b/usr/src/uts/sun4u/io/px/px_err.c
index 8a11df9e16..980c622884 100644
--- a/usr/src/uts/sun4u/io/px/px_err.c
+++ b/usr/src/uts/sun4u/io/px/px_err.c
@@ -19,7 +19,7 @@
  * CDDL HEADER END
  */
 /*
- * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
+ * Copyright 2007 Sun Microsystems, Inc.  All rights reserved.
  * Use is subject to license terms.
  */
 
@@ -253,7 +253,7 @@ px_err_bit_desc_t px_err_imu_tbl[] = {
 	{ IMU_BIT_DESC(MSI_NOT_EN,		panic,		imu_rds) },
 
 	/* DMC IMU SCS */
-	{ IMU_BIT_DESC(EQ_NOT_EN,		panic,		imu_rds) },
+	{ IMU_BIT_DESC(EQ_NOT_EN,		panic,		imu_scs) },
 
 	/* DMC IMU */
 	{ IMU_BIT_DESC(EQ_OVER,			imu_eq_ovfl,	imu) }

