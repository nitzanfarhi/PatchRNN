commit b2c7655093821710aac2b4d35ccb1740429eb402
Author: Sage Weil <sage@newdream.net>
Date:   Thu Sep 17 15:57:06 2009 -0700

    mon: fix bug with client id assignment of -1

diff --git a/src/mon/ClientMonitor.cc b/src/mon/ClientMonitor.cc
index 689011b389..a2f0d7ba04 100644
--- a/src/mon/ClientMonitor.cc
+++ b/src/mon/ClientMonitor.cc
@@ -63,7 +63,7 @@ bool ClientMonitor::update_from_paxos()
 
   paxos->stash_latest(paxosv, bl);
 
-  if (next_client < 0) {
+  if (next_client <= client_map.next_client) {
     dout(10) << "in-core next_client reset to " << client_map.next_client << dendl;
     next_client = client_map.next_client;
   }
@@ -73,8 +73,8 @@ bool ClientMonitor::update_from_paxos()
 
 void ClientMonitor::on_election_start()
 {
-  dout(10) << "in-core next_client cleared" << dendl;
-  next_client = -1;
+  dout(10) << "in-core next_client reset to " << client_map.next_client << dendl;
+  next_client = client_map.next_client;
 }
 
 void ClientMonitor::create_pending()

