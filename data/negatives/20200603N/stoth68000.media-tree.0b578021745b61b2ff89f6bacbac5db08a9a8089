commit 0b578021745b61b2ff89f6bacbac5db08a9a8089
Author: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>
Date:   Tue Dec 21 22:44:12 2010 +0200

    rndis_wlan: do not set default_key if not WEP key
    
    rndis_set_default_key did call add_wep_key to set default key on device, even
    if key is WPA. This caused rndis_wlan not work with wpa_supplicant in nl80211
    mode (causing disconnect from AP).
    
    Signed-off-by: Jussi Kivilinna <jussi.kivilinna@mbnet.fi>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/rndis_wlan.c b/drivers/net/wireless/rndis_wlan.c
index de4c05019f1e..9e6105cd54a5 100644
--- a/drivers/net/wireless/rndis_wlan.c
+++ b/drivers/net/wireless/rndis_wlan.c
@@ -2435,6 +2435,9 @@ static int rndis_set_default_key(struct wiphy *wiphy, struct net_device *netdev,
 
 	priv->encr_tx_key_index = key_index;
 
+	if (is_wpa_key(priv, key_index))
+		return 0;
+
 	key = priv->encr_keys[key_index];
 
 	return add_wep_key(usbdev, key.material, key.len, key_index);

