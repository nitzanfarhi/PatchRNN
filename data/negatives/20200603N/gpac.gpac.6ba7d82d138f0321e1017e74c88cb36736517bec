commit 6ba7d82d138f0321e1017e74c88cb36736517bec
Author: Jean Le Feuvre <jeanlf@users.sourceforge.net>
Date:   Thu May 27 08:40:58 2010 +0000

    Fixed assignement of SSRC when not done in SDP
    
    
    git-svn-id: http://svn.code.sf.net/p/gpac/code/trunk/gpac@1809 63c20433-aa62-49bd-875c-5a186b69a8fb

diff --git a/src/ietf/rtp.c b/src/ietf/rtp.c
index b34d5d420..5ed69d612 100644
--- a/src/ietf/rtp.c
+++ b/src/ietf/rtp.c
@@ -410,7 +410,7 @@ GF_Err gf_rtp_decode_rtp(GF_RTPChannel *ch, char *pck, u32 pck_size, GF_RTPHeade
 		ch->rtp_first_SN = rtp_hdr->SequenceNumber;
 		ch->num_sn_loops = 0;
 	}
-	if (ch->first_SR && !ch->SenderSSRC) {
+	if (ch->first_SR && !ch->SenderSSRC && rtp_hdr->SSRC) {
 		ch->SenderSSRC = rtp_hdr->SSRC;
 		GF_LOG(GF_LOG_WARNING, GF_LOG_RTP, ("[RTP] Assigning SSRC %d because none has been signaled\n", ch->SenderSSRC));
 	}
@@ -545,7 +545,7 @@ GF_Err gf_rtp_send_packet(GF_RTPChannel *ch, GF_RTPHeader *rtp_hdr, char *pck, u
 	gf_bs_write_int(bs, rtp_hdr->PayloadType, 7);
 	gf_bs_write_u16(bs, rtp_hdr->SequenceNumber);
 	gf_bs_write_u32(bs, rtp_hdr->TimeStamp);
-	gf_bs_write_u32(bs, rtp_hdr->SSRC);
+	gf_bs_write_u32(bs, ch->SSRC);
 
 	for (i=0; i<rtp_hdr->CSRCCount; i++) {
 		gf_bs_write_u32(bs, rtp_hdr->CSRC[i]);

