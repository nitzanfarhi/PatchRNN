commit b6cafbd7d840f4e315c3a066ab742c893bc4d41a
Author: Bodo MÃ¶ller <bodo@openssl.org>
Date:   Wed Nov 29 09:57:13 2000 +0000

    Make BN_mod_inverse a little faster

diff --git a/crypto/bn/bn_gcd.c b/crypto/bn/bn_gcd.c
index d53f32656b..d361ada8b2 100644
--- a/crypto/bn/bn_gcd.c
+++ b/crypto/bn/bn_gcd.c
@@ -338,15 +338,15 @@ BIGNUM *BN_mod_inverse(BIGNUM *in,
 				{
 				if (!BN_lshift1(tmp,X)) goto err;
 				}
-			else if (BN_is_word(D,3))
-				{
-				if (!BN_lshift1(tmp,X)) goto err;
-				if (!BN_add(tmp,tmp,X)) goto err;
-				}
 			else if (BN_is_word(D,4))
 				{
 				if (!BN_lshift(tmp,X,2)) goto err;
 				}
+			else if (D->top == 1)
+				{
+				if (!BN_copy(tmp,X)) goto err;
+				if (!BN_mul_word(tmp,D->d[0])) goto err;
+				}
 			else
 				{
 				if (!BN_mul(tmp,D,X,ctx)) goto err;

