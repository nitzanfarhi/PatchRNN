commit cd5cd721101535bf6f837767e0c0062bf2df4685
Author: Sage Weil <sage@newdream.net>
Date:   Wed May 7 16:22:29 2008 -0700

    mds: fix can_rdlock_soon vs xlock on FileLock

diff --git a/src/mds/FileLock.h b/src/mds/FileLock.h
index 17ef0d5f94..aa0b3f0c16 100644
--- a/src/mds/FileLock.h
+++ b/src/mds/FileLock.h
@@ -147,7 +147,9 @@ class FileLock : public SimpleLock {
   }
   bool can_rdlock_soon() {
     if (parent->is_auth())
-      return (state == LOCK_GLOCKL);
+      return
+	(state == LOCK_GLOCKL) ||
+	(state == LOCK_LOCK && xlock_by);
     else
       return false;
   }

