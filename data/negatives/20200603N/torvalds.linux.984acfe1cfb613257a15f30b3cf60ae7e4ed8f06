commit 984acfe1cfb613257a15f30b3cf60ae7e4ed8f06
Author: Steve French <sfrench@us.ibm.com>
Date:   Thu Apr 26 16:42:50 2007 +0000

    [CIFS] prefixpath mounts to servers supporting posix paths used wrong slash
    
    Acked-by: Alexander Bokovoy <abokovoy@ru.ibm.com>
    Signed-off-by: Steve French <sfrench@us.ibm.com>

diff --git a/fs/cifs/connect.c b/fs/cifs/connect.c
index c139fbd24be9..c1af15995689 100644
--- a/fs/cifs/connect.c
+++ b/fs/cifs/connect.c
@@ -1662,7 +1662,13 @@ void reset_cifs_unix_caps(int xid, struct cifsTconInfo * tcon,
 				CIFS_SB(sb)->mnt_cifs_flags |= 
 					CIFS_MOUNT_POSIX_PATHS;
 		}
-			
+	
+		/* We might be setting the path sep back to a different
+		form if we are reconnecting and the server switched its
+		posix path capability for this share */	
+		if(CIFS_SB(sb)->prepathlen > 0)
+			CIFS_SB(sb)->prepath[0] = CIFS_DIR_SEP(CIFS_SB(sb));
+	
 		cFYI(1,("Negotiate caps 0x%x",(int)cap));
 #ifdef CONFIG_CIFS_DEBUG2
 		if(cap & CIFS_UNIX_FCNTL_CAP)

