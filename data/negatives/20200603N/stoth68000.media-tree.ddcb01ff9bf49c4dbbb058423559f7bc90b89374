commit ddcb01ff9bf49c4dbbb058423559f7bc90b89374
Author: Geoff Levand <geoffrey.levand@am.sony.com>
Date:   Fri Oct 31 13:52:54 2008 -0700

    USB: Fix PS3 USB shutdown problems
    
    Add ehci_shutdown() or ohci_shutdown() calls to the USB
    PS3 bus glue.  ehci_shutdown() and ohci_shutdown() do some
    controller specific cleanups not done by usb_remove_hcd().
    
    Fixes errors on shutdown or reboot similar to these:
    
      ps3-ehci-driver sb_07: HC died; cleaning up
      irq 51: nobody cared (try booting with the "irqpoll" option)
    
    Related bugzilla reports:
    
      http://bugzilla.kernel.org/show_bug.cgi?id=11819
      http://bugzilla.terrasoftsolutions.com/show_bug.cgi?id=317
    
    Signed-off-by: Geoff Levand <geoffrey.levand@am.sony.com>
    Cc: stable <stable@kernel.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/usb/host/ehci-ps3.c b/drivers/usb/host/ehci-ps3.c
index 0eba894bcb01..9c9da35abc6c 100644
--- a/drivers/usb/host/ehci-ps3.c
+++ b/drivers/usb/host/ehci-ps3.c
@@ -205,6 +205,7 @@ static int ps3_ehci_remove(struct ps3_system_bus_device *dev)
 
 	tmp = hcd->irq;
 
+	ehci_shutdown(hcd);
 	usb_remove_hcd(hcd);
 
 	ps3_system_bus_set_driver_data(dev, NULL);
diff --git a/drivers/usb/host/ohci-ps3.c b/drivers/usb/host/ohci-ps3.c
index 2089d8a46c4b..3c1a3b5f89f1 100644
--- a/drivers/usb/host/ohci-ps3.c
+++ b/drivers/usb/host/ohci-ps3.c
@@ -192,7 +192,7 @@ static int ps3_ohci_probe(struct ps3_system_bus_device *dev)
 	return result;
 }
 
-static int ps3_ohci_remove (struct ps3_system_bus_device *dev)
+static int ps3_ohci_remove(struct ps3_system_bus_device *dev)
 {
 	unsigned int tmp;
 	struct usb_hcd *hcd =
@@ -205,6 +205,7 @@ static int ps3_ohci_remove (struct ps3_system_bus_device *dev)
 
 	tmp = hcd->irq;
 
+	ohci_shutdown(hcd);
 	usb_remove_hcd(hcd);
 
 	ps3_system_bus_set_driver_data(dev, NULL);

