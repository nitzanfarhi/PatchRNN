commit cc5fed25e2b0501148a566279fa9f565f299b023
Author: Panu Matilainen <pmatilai@redhat.com>
Date:   Mon Mar 18 13:16:25 2013 +0200

    Clean up dbiFindMatches() error handling
    
    - No need to further translate dbiCursorGetToSet() errors anymore
    - Comment and clarify the early success/fail return cases, and
      make them go through a single exit point.

diff --git a/lib/rpmdb.c b/lib/rpmdb.c
index 4d659e6e4..355989d5a 100644
--- a/lib/rpmdb.c
+++ b/lib/rpmdb.c
@@ -1110,11 +1110,13 @@ static rpmRC dbiFindMatches(rpmdb db, dbiCursor dbc,
 
     rc = dbiCursorGetToSet(dbc, name, strlen(name), matches);
 
-    if (rc != 0) {
-	return (rc == RPMRC_NOTFOUND) ? RPMRC_NOTFOUND : RPMRC_FAIL;
-    } else if (epoch < 0 && version == NULL && release == NULL && arch == NULL) {
-	return RPMRC_OK;
-    }
+    /* No matches on the name, anything else wont match either */
+    if (rc != RPMRC_OK)
+	goto exit;
+    
+    /* If we got matches on name and nothing else was specified, we're done */
+    if (epoch < 0 && version == NULL && release == NULL && arch == NULL)
+	goto exit;
 
     /* Make sure the version and release match. */
     for (i = 0; i < dbiIndexSetCount(*matches); i++) {

