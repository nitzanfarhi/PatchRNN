commit 04cb3f779e777f7724819d9670b0ae007fb53423
Author: Sage Weil <sage@newdream.net>
Date:   Tue Feb 24 11:55:58 2009 -0800

    mds: look at active (not projected) inode when issuing truncation
    
    We are interested in applying the truncation that just committed, not one
    that is projected.

diff --git a/src/mds/MDCache.cc b/src/mds/MDCache.cc
index abc07b47da..9c317744c2 100644
--- a/src/mds/MDCache.cc
+++ b/src/mds/MDCache.cc
@@ -4104,7 +4104,7 @@ struct C_MDC_TruncateFinish : public Context {
 
 void MDCache::_truncate_inode(CInode *in, LogSegment *ls)
 {
-  inode_t *pi = in->get_projected_inode();
+  inode_t *pi = &in->inode;
   dout(10) << "_truncate_inode "
 	   << pi->truncate_from << " -> " << pi->truncate_size
 	   << " on " << *in << dendl;

