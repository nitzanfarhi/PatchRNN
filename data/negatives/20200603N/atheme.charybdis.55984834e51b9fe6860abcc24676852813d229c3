commit 55984834e51b9fe6860abcc24676852813d229c3
Author: Elizabeth Myers <elizabeth@interlinked.me>
Date:   Sat Apr 2 22:31:19 2016 -0500

    opm: properly disable opm on blacklist deletions.
    
    If there are no proxies left (or they're all being cleared), disable
    OPM, as it's totally useless from that point.

diff --git a/authd/providers/opm.c b/authd/providers/opm.c
index e93143d0..ac299a12 100644
--- a/authd/providers/opm.c
+++ b/authd/providers/opm.c
@@ -846,6 +846,9 @@ delete_opm_scanner(const char *key __unused, int parc __unused, const char **par
 
 	rb_dlinkDelete(&proxy->node, &proxy_scanners);
 	rb_free(proxy);
+
+	if(!rb_dlink_list_length(proxy_scanners))
+		opm_enable = false;
 }
 
 static void
@@ -865,6 +868,8 @@ delete_opm_scanner_all(const char *key __unused, int parc __unused, const char *
 	{
 		opm_cancel(auth);
 	}
+
+	opm_enable = false;
 }
 
 

