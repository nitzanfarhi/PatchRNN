commit 9a1fe1571f9c5582836dfe02b05d05a450de42fe
Author: Greg Banks <gnb@fastmail.fm>
Date:   Wed Jan 19 16:15:05 2011 +1100

    unit: improve binhex.c tests
    
    - test passing NULL to hex_to_bin()
    - fix bug in odd-length test
    
    This brings line coverage for bin_to_hex() and hex_to_bin() to 100%.

diff --git a/cunit/binhex.c b/cunit/binhex.c
index 358fe792b..e2d0a9d33 100644
--- a/cunit/binhex.c
+++ b/cunit/binhex.c
@@ -113,13 +113,17 @@ static void test_hex_to_bin_capitals(void)
 
 static void test_hex_to_bin_odd(void)
 {
-    static const char HEX[9] = "cafebab";
+    static const char HEX[8] = "cafebab";
     int r;
-    char bin[4];
+    unsigned char bin[4];
 
     memset(bin, 0xff, sizeof(bin));
     r = hex_to_bin(HEX, sizeof(HEX)-1, bin);
     CU_ASSERT_EQUAL(r, -1);
+    CU_ASSERT_EQUAL(bin[0], 0xff);
+    CU_ASSERT_EQUAL(bin[1], 0xff);
+    CU_ASSERT_EQUAL(bin[2], 0xff);
+    CU_ASSERT_EQUAL(bin[3], 0xff);
 }
 
 static void test_hex_to_bin_nonxdigit(void)
@@ -157,3 +161,14 @@ static void test_hex_to_bin_nolength(void)
     CU_ASSERT_EQUAL(memcmp(bin, BIN, sizeof(bin)), 0);
 }
 
+static void test_hex_to_bin_null(void)
+{
+    int r;
+    unsigned char bin[1];
+
+    memset(bin, 0xff, sizeof(bin));
+    r = hex_to_bin(NULL, 0, bin);
+    CU_ASSERT_EQUAL(r, -1);
+    CU_ASSERT_EQUAL(bin[0], 0xff);
+}
+

