commit 06859fca4368c407d4acccf3948b8b825db5e569
Author: Charles Keepax <ckeepax@opensource.wolfsonmicro.com>
Date:   Mon Nov 7 13:03:17 2016 +0000

    ASoC: core: If a platform doesn't have an of_node use parent's node
    
    Support was added to allow location of both CPU and CODEC components
    of a DAI link from their parent's of_node if they did not have an
    of_node themselves in this commit:
    
    commit 3e0aa8d83bf8 ("ASoC: core: If component doesn't have of_node
                          use parent's node instead")
    
    However this leaves platforms as something of a special case as the
    major DAI component that doesn't do this. Since this is useful for MFD
    devices which often utilise a single device tree entry for the whole
    device, add support for looking up platforms from the parent's of_node
    as well.
    
    Signed-off-by: Charles Keepax <ckeepax@opensource.wolfsonmicro.com>
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/sound/soc/soc-core.c b/sound/soc/soc-core.c
index c0bbcd903261..26da0466126d 100644
--- a/sound/soc/soc-core.c
+++ b/sound/soc/soc-core.c
@@ -993,6 +993,7 @@ static int soc_bind_dai_link(struct snd_soc_card *card,
 	struct snd_soc_dai_link_component cpu_dai_component;
 	struct snd_soc_dai **codec_dais;
 	struct snd_soc_platform *platform;
+	struct device_node *platform_of_node;
 	const char *platform_name;
 	int i;
 
@@ -1042,9 +1043,12 @@ static int soc_bind_dai_link(struct snd_soc_card *card,
 
 	/* find one from the set of registered platforms */
 	list_for_each_entry(platform, &platform_list, list) {
+		platform_of_node = platform->dev->of_node;
+		if (!platform_of_node && platform->dev->parent->of_node)
+			platform_of_node = platform->dev->parent->of_node;
+
 		if (dai_link->platform_of_node) {
-			if (platform->dev->of_node !=
-			    dai_link->platform_of_node)
+			if (platform_of_node != dai_link->platform_of_node)
 				continue;
 		} else {
 			if (strcmp(platform->component.name, platform_name))

