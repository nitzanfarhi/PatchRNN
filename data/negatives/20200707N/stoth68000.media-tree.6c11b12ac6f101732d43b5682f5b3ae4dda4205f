commit 6c11b12ac6f101732d43b5682f5b3ae4dda4205f
Author: Alain Knaff <alain@knaff.lu>
Date:   Thu Jan 8 15:10:19 2009 -0800

    bzip2/lzma: fix decompress_inflate.c vs multi-block-with-embedded-filename
    
    Impact: Bug fix
    
    Fix gunzip uncompression, so that it also works with files with
    embedded filenames that are larger than one block.
    
    Signed-off-by: Alain Knaff <alain@knaff.lu>
    Signed-off-by: H. Peter Anvin <hpa@zytor.com>

diff --git a/lib/decompress_inflate.c b/lib/decompress_inflate.c
index d2e7c758d1ca..839a329b4fc4 100644
--- a/lib/decompress_inflate.c
+++ b/lib/decompress_inflate.c
@@ -97,7 +97,7 @@ STATIC int INIT gunzip(unsigned char *buf, int len,
 			strm->next_in++;
 		strm->next_in++;
 	}
-	strm->avail_in = len - 10;
+	strm->avail_in = len - (strm->next_in - zbuf);
 
 	strm->next_out = out_buf;
 	strm->avail_out = out_len;

