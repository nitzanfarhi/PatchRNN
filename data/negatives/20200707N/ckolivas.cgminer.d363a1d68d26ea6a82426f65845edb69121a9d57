commit d363a1d68d26ea6a82426f65845edb69121a9d57
Author: Jeff Garzik <jeff@garzik.org>
Date:   Sun Dec 19 21:37:30 2010 -0500

    sha256_via: ensure proper data area is fully checksummed

diff --git a/cpu-miner.c b/cpu-miner.c
index ac151f61..138ec9c9 100644
--- a/cpu-miner.c
+++ b/cpu-miner.c
@@ -319,7 +319,7 @@ static void *miner_thread(void *thr_id_int)
 
 #ifdef WANT_VIA_PADLOCK
 		case ALGO_VIA:
-			rc = scanhash_via(work.midstate, work.data + 64,
+			rc = scanhash_via(work.midstate, work.data,
 					  work.hash1, work.hash,
 					  &hashes_done);
 			break;
diff --git a/sha256_via.c b/sha256_via.c
index 45e68211..ef2c1029 100644
--- a/sha256_via.c
+++ b/sha256_via.c
@@ -35,7 +35,7 @@ bool scanhash_via(const unsigned char *midstate, const unsigned char *data_in,
 	unsigned char data[128] __attribute__((aligned(128)));
 	unsigned char tmp_hash1[32] __attribute__((aligned(128)));
 	uint32_t *hash32 = (uint32_t *) hash;
-	uint32_t *nonce = (uint32_t *)(data + 12);
+	uint32_t *nonce = (uint32_t *)(data + 64 + 12);
 	uint32_t n = 0;
 	unsigned long stat_ctr = 0;
 	int i;

