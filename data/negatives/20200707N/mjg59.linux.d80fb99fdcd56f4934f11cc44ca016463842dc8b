commit d80fb99fdcd56f4934f11cc44ca016463842dc8b
Author: Zhang Rui <rui.zhang@intel.com>
Date:   Wed Mar 18 16:27:14 2009 +0800

    ACPI video: support reversed _BCL method in  ACPI video driver
    
    The brightness levels returned by _BCL package are in a reversed order
    on some laptops.
    http://bugzilla.kernel.org/show_bug.cgi?id=12037
    http://bugzilla.kernel.org/show_bug.cgi?id=12302
    http://bugzilla.kernel.org/show_bug.cgi?id=12235
    
    sort the _BCL packge in case it's reversed.
    
    Signed-off-by: Zhang Rui <rui.zhang@intel.com>
    Acked-by: Matthew Garrett <mjg59@srcf.ucam.org>
    Acked-by: Thomas Renninger <trenn@suse.de>
    Signed-off-by: Len Brown <len.brown@intel.com>

diff --git a/drivers/acpi/video.c b/drivers/acpi/video.c
index 398b3eee37fb..dc84970ce1e9 100644
--- a/drivers/acpi/video.c
+++ b/drivers/acpi/video.c
@@ -170,6 +170,7 @@ struct acpi_video_device_cap {
 
 struct acpi_video_brightness_flags {
 	u8 _BCL_no_ac_battery_levels:1;	/* no AC/Battery levels in _BCL */
+	u8 _BCL_reversed:1;		/* _BCL package is in a reversed order*/
 };
 
 struct acpi_video_device_brightness {
@@ -744,9 +745,14 @@ acpi_video_init_brightness(struct acpi_video_device *device)
 	} else if (level_ac_battery > 2)
 		ACPI_ERROR((AE_INFO, "Too many duplicates in _BCL package\n"));
 
-	/* sort all the supported brightness levels */
-	sort(&br->levels[2], count - 2, sizeof(br->levels[2]),
-		acpi_video_cmp_level, NULL);
+	/* Check if the _BCL package is in a reversed order */
+	if (max_level == br->levels[2]) {
+		br->flags._BCL_reversed = 1;
+		sort(&br->levels[2], count - 2, sizeof(br->levels[2]),
+			acpi_video_cmp_level, NULL);
+	} else if (max_level != br->levels[count - 1])
+		ACPI_ERROR((AE_INFO,
+			    "Found unordered _BCL package\n"));
 
 	br->count = count;
 	device->brightness = br;

