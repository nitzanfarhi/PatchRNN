commit d7789218886ab1166b5786a9e7b3b39f213ba049
Author: Sage Weil <sage.weil@dreamhost.com>
Date:   Sun Apr 17 21:58:27 2011 -0700

    mount.ceph: behave when CONFIG_KEYS is not compiled in
    
    In that case we get ENOSYS.  This also implies an old version of the client
    and that we should fall back.
    
    Signed-off-by: Sage Weil <sage.weil@dreamhost.com>

diff --git a/src/mount/mount.ceph.c b/src/mount/mount.ceph.c
index b86020a2d3..9757836313 100755
--- a/src/mount/mount.ceph.c
+++ b/src/mount/mount.ceph.c
@@ -368,7 +368,7 @@ static char *parse_options(const char *data, int *filesys_flags)
 		}
 		serial = add_key("ceph", name, payload, sizeof(payload), KEY_SPEC_USER_KEYRING);
 		if (serial < 0) {
-			if (errno == ENODEV) {
+			if (errno == ENODEV || errno == ENOSYS) {
 				/* running against older kernel; fall back to secret= in options */
 				if (pos)
 					pos = safe_cat(&out, &out_len, pos, ",");

