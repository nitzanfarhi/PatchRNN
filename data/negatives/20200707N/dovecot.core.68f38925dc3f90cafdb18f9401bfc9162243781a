commit 68f38925dc3f90cafdb18f9401bfc9162243781a
Author: Timo Sirainen <tss@iki.fi>
Date:   Tue Jun 12 20:15:00 2007 +0300

    nfs check: If namespaces are defined, use the first one's location instead
    of mail_location.
    
    --HG--
    branch : HEAD

diff --git a/src/master/mail-process.c b/src/master/mail-process.c
index 4ea99a146..a561a1157 100644
--- a/src/master/mail-process.c
+++ b/src/master/mail-process.c
@@ -666,8 +666,15 @@ bool create_mail_process(enum process_type process_type, struct settings *set,
 		}
 	}
 
-	if (nfs_check)
-		nfs_warn_if_found(getenv("MAIL"), full_home_dir);
+	if (nfs_check) {
+		/* ideally we should check all of the namespaces,
+		   but for now don't bother. */
+		const char *mail_location = getenv("NAMESPACE_1");
+
+		if (mail_location == NULL)
+			mail_location = getenv("MAIL");
+		nfs_warn_if_found(mail_location, full_home_dir);
+	}
 
 	env_put("LOGGED_IN=1");
 	env_put(t_strconcat("HOME=", home_dir, NULL));

