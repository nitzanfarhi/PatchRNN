commit a8aead0ac6e2fdcdb77cf8de738e6f5ed00b0545
Author: Eliot Horowitz <eliot@10gen.com>
Date:   Sat Oct 11 18:56:23 2014 -0400

    SERVER-14425 Add MMAP V1 check to invariant

diff --git a/src/mongo/db/concurrency/lock_state.cpp b/src/mongo/db/concurrency/lock_state.cpp
index 0fef041f6c..f485802f25 100644
--- a/src/mongo/db/concurrency/lock_state.cpp
+++ b/src/mongo/db/concurrency/lock_state.cpp
@@ -411,7 +411,12 @@ namespace mongo {
         invariant(!inAWriteUnitOfWork());
 
         // Only Global and Flush lock could be held at this point.
-        invariant(_requests.size() == 2);
+        if ( IsForMMAPV1 ) {
+            invariant(_requests.size() == 2);
+        }
+        else {
+            invariant(_requests.size() == 1);
+        }
 
         LockRequest* globalLockRequest = _find(resourceIdGlobal);
         invariant(globalLockRequest->mode == MODE_X);

