commit 4503efd0891c40e30928afb4b23dc3f99c62a6b2
Author: Greg Kroah-Hartman <gregkh@suse.de>
Date:   Tue Jan 20 15:51:16 2009 -0800

    sysfs: fix problems with binary files
    
    Some sysfs binary files don't like having 0 passed to them as a size.
    Fix this up at the root by just returning to the vfs if userspace asks
    us for a zero sized buffer.
    
    Thanks to Pavel Roskin for pointing this out.
    
    Reported-by: Pavel Roskin <proski@gnu.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/fs/sysfs/bin.c b/fs/sysfs/bin.c
index 66f6e58a7e4b..f2c478c3424e 100644
--- a/fs/sysfs/bin.c
+++ b/fs/sysfs/bin.c
@@ -63,6 +63,9 @@ read(struct file *file, char __user *userbuf, size_t bytes, loff_t *off)
 	int count = min_t(size_t, bytes, PAGE_SIZE);
 	char *temp;
 
+	if (!bytes)
+		return 0;
+
 	if (size) {
 		if (offs > size)
 			return 0;
@@ -131,6 +134,9 @@ static ssize_t write(struct file *file, const char __user *userbuf,
 	int count = min_t(size_t, bytes, PAGE_SIZE);
 	char *temp;
 
+	if (!bytes)
+		return 0;
+
 	if (size) {
 		if (offs > size)
 			return 0;

