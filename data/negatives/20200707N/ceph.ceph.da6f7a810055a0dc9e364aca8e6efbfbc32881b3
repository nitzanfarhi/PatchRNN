commit da6f7a810055a0dc9e364aca8e6efbfbc32881b3
Author: Kefu Chai <kchai@redhat.com>
Date:   Tue Sep 26 15:50:08 2017 +0800

    mon/OSDMonitor: bypass checks if pg_temp.forced
    
    originally, monitor ignores the pg_temp messages sent from replica osds,
    but to re-trigger peering if replica osd's pg number drops down below
    the setting, we need to bypass the checks.
    
    Signed-off-by: Kefu Chai <kchai@redhat.com>

diff --git a/src/mon/OSDMonitor.cc b/src/mon/OSDMonitor.cc
index cff19f73eb..53096a71d5 100644
--- a/src/mon/OSDMonitor.cc
+++ b/src/mon/OSDMonitor.cc
@@ -2643,6 +2643,10 @@ bool OSDMonitor::preprocess_pgtemp(MonOpRequestRef op)
     goto ignore;
   }
 
+  if (m->forced) {
+    return false;
+  }
+
   for (auto p = m->pg_temp.begin(); p != m->pg_temp.end(); ++p) {
     dout(20) << " " << p->first
 	     << (osdmap.pg_temp->count(p->first) ? osdmap.pg_temp->get(p->first) : empty)

