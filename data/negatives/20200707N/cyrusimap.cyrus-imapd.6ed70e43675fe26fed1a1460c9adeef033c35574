commit 6ed70e43675fe26fed1a1460c9adeef033c35574
Author: Bron Gondwana <brong@fastmail.fm>
Date:   Fri May 15 17:37:54 2015 +1000

    mailbox: skip no-uid records

diff --git a/imap/mailbox.c b/imap/mailbox.c
index feb0a842c..24cefd874 100644
--- a/imap/mailbox.c
+++ b/imap/mailbox.c
@@ -6443,6 +6443,7 @@ EXPORTED const struct index_record *mailbox_iter_step(struct mailbox_iter *iter)
     for (iter->recno++; iter->recno <= mailbox->i.num_records; iter->recno++) {
 	int r = mailbox_read_index_record(mailbox, iter->recno, &iter->record);
 	if (r) continue;
+	if (!iter->record.uid) continue; /* can happen on damaged mailboxes */
 	if ((iter->record.system_flags & iter->skipflags)) continue;
 	if (iter->record.modseq <= iter->changedsince) continue;
 	return &iter->record;

