commit c30bb2c75e3291a6a676ad74ab88934ca329106f
Author: Alexis La Goutte <alexis.lagoutte@gmail.com>
Date:   Sun May 14 19:33:12 2017 +0200

    SMB: Fix dissection of SMB_COM_TRANSACTION2_SECONDARY (0x33)
    
    Issue reported by Alex
    Bug: 13690
    Change-Id: I6c0c01569be8474e1cbab0c8ca009c00394e1ffe
    Reviewed-on: https://code.wireshark.org/review/21650
    Reviewed-by: Anders Broman <a.broman58@gmail.com>
    Petri-Dish: Anders Broman <a.broman58@gmail.com>
    Tested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>
    Reviewed-by: Michael Mann <mmann78@netscape.net>

diff --git a/epan/dissectors/packet-smb.c b/epan/dissectors/packet-smb.c
index 3c0423f6fc..cb8876a550 100644
--- a/epan/dissectors/packet-smb.c
+++ b/epan/dissectors/packet-smb.c
@@ -13857,7 +13857,7 @@ dissect_transaction_request(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,
 
 	WORD_COUNT;
 
-	if (wc == 8) {
+	if (wc == 8 || (wc == 9 && si->cmd == SMB_COM_TRANSACTION2_SECONDARY)) {
 		/*secondary client request*/
 
 		/* total param count, only a 16bit integer here*/
@@ -13898,7 +13898,7 @@ dissect_transaction_request(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,
 		proto_tree_add_uint(tree, hf_smb_data_disp16, tvb, offset, 2, dd);
 		offset += 2;
 
-		if (si->cmd == SMB_COM_TRANSACTION2) {
+		if (si->cmd == SMB_COM_TRANSACTION2 || si->cmd == SMB_COM_TRANSACTION2_SECONDARY) {
 			guint16 fid;
 
 			/* fid */

