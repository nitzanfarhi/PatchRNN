commit 74ccde11686a2b934d2f88bacccaa769713167a0
Author: pancake <pancake@nopcode.org>
Date:   Mon Sep 21 12:48:35 2015 +0200

    Fix softmagic crash in PE bin (reported by @daniel-rome)

diff --git a/libr/magic/softmagic.c b/libr/magic/softmagic.c
index 54fba905f..4719e075c 100644
--- a/libr/magic/softmagic.c
+++ b/libr/magic/softmagic.c
@@ -1313,9 +1313,10 @@ static int magiccheck(RMagic *ms, struct r_magic *m) {
 		v = 0;
 
 		for (idx = 0; m->str_range == 0 || idx < m->str_range; idx++) {
+			if ((int)ms->search.offset < 0)
+				break;
 			if (slen + idx > ms->search.s_len)
 				break;
-
 			v = file_strncmp (m->value.s, ms->search.s + idx, slen, m->str_flags);
 			if (v == 0) {	/* found match */
 				ms->search.offset += idx;

