commit 4be2f4c9b545ae9c2e790347817a53f8b56decb3
Author: Thomas Bernard <miniupnp@free.fr>
Date:   Wed Jul 22 15:52:33 2015 +0200

    miniupnpc-libevent: set multicast TTL to 2

diff --git a/miniupnpc-libevent/miniupnpc-libevent.c b/miniupnpc-libevent/miniupnpc-libevent.c
index 3d1e262..88bd2b3 100644
--- a/miniupnpc-libevent/miniupnpc-libevent.c
+++ b/miniupnpc-libevent/miniupnpc-libevent.c
@@ -1,4 +1,4 @@
-/* $Id: miniupnpc-libevent.c,v 1.25 2015/02/05 17:56:38 nanard Exp $ */
+/* $Id: miniupnpc-libevent.c,v 1.27 2015/07/22 13:51:09 nanard Exp $ */
 /* miniupnpc-libevent
  * Copyright (c) 2008-2014, Thomas BERNARD <miniupnp@free.fr>
  * http://miniupnp.free.fr/ or http://miniupnp.tuxfamily.org/
@@ -721,11 +721,18 @@ int upnpc_init(upnpc_t * p, struct event_base * base, const char * multicastif,
 	p->ready_cb = ready_cb;
 	p->soap_cb = soap_cb;
 	p->cb_data = cb_data;
+	p->ttl = 2;
 	/* open the socket for SSDP */
 	p->ssdp_socket = socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP);
 	if(p->ssdp_socket < 0) {
 		return UPNPC_ERR_SOCKET_FAILED;
 	}
+	/* set multicast TTL */
+	if(setsockopt(p->ssdp_socket, IPPROTO_IP, IP_MULTICAST_TTL, &p->ttl, sizeof(p->ttl) < 0))
+	{
+		/* not a fatal error */
+		debug_printf("setsockopt(%d, ..., IP_MULTICAST_TTL, ...) FAILED\n", p->ssdp_socket);
+	}
 	/* set REUSEADDR */
 #ifdef _WIN32
 	if(setsockopt(p->ssdp_socket, SOL_SOCKET, SO_REUSEADDR, (const char *)&opt, sizeof(opt)) < 0) {
diff --git a/miniupnpc-libevent/miniupnpc-libevent.h b/miniupnpc-libevent/miniupnpc-libevent.h
index c7fca09..47bc896 100644
--- a/miniupnpc-libevent/miniupnpc-libevent.h
+++ b/miniupnpc-libevent/miniupnpc-libevent.h
@@ -1,6 +1,6 @@
-/* $Id: miniupnpc-libevent.h,v 1.11 2014/12/02 13:33:42 nanard Exp $ */
+/* $Id: miniupnpc-libevent.h,v 1.13 2015/07/22 13:48:37 nanard Exp $ */
 /* miniupnpc-libevent
- * Copyright (c) 2008-2014, Thomas BERNARD <miniupnp@free.fr>
+ * Copyright (c) 2008-2015, Thomas BERNARD <miniupnp@free.fr>
  * http://miniupnp.free.fr/ or http://miniupnp.tuxfamily.org/
  *
  * Permission to use, copy, modify, and/or distribute this software for any
@@ -88,6 +88,7 @@ struct upnpc {
 #endif /* ENABLE_UPNP_EVENTS */
 	char * local_address;
 	uint16_t local_port;
+	unsigned char ttl;
 };
 
 int upnpc_init(upnpc_t * p, struct event_base * base, const char * multicastif,

