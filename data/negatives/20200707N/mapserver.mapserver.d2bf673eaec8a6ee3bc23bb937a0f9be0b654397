commit d2bf673eaec8a6ee3bc23bb937a0f9be0b654397
Author: Even Rouault <even.rouault@mines-paris.org>
Date:   Sat Jul 6 10:56:19 2013 +0200

    Correct test to resolve PROJECTION AUTO in msSHPLayerOpen() is '#if defined(USE_GDAL) || defined(USE_OGR)'

diff --git a/mapshape.c b/mapshape.c
index 64e187bd..3a762b79 100644
--- a/mapshape.c
+++ b/mapshape.c
@@ -38,7 +38,7 @@
 #include <assert.h>
 #include "mapserver.h"
 
-#ifdef USE_GDAL
+#if defined(USE_GDAL) || defined(USE_OGR)
 #include <cpl_conv.h>
 #include <ogr_srs_api.h>
 #endif
@@ -2514,7 +2514,7 @@ int msSHPLayerOpen(layerObj *layer)
   if (layer->projection.numargs > 0 &&
       EQUAL(layer->projection.args[0], "auto"))
   {
-#ifdef USE_GDAL
+#if defined(USE_GDAL) || defined(USE_OGR)
     const char* pszPRJFilename = CPLResetExtension(szPath, "prj");
     int bOK = MS_FALSE;
     FILE* fp = fopen(pszPRJFilename, "rb");
@@ -2553,11 +2553,11 @@ int msSHPLayerOpen(layerObj *layer)
             msDebug( "Unable to get SRS from shapefile '%s' for layer '%s'.\n", szPath, layer->name );
         }
     }
-#else
+#else /* !(defined(USE_GDAL) || defined(USE_OGR)) */
     if( layer->debug || (layer->map && layer->map->debug) ) {
-        msDebug( "Unable to get SRS from shapefile '%s' for layer '%s'. GDAL support needed\n", szPath, layer->name );
+        msDebug( "Unable to get SRS from shapefile '%s' for layer '%s'. GDAL or OGR support needed\n", szPath, layer->name );
     }
-#endif
+#endif /* defined(USE_GDAL) || defined(USE_OGR) */
   }
 
   return MS_SUCCESS;

