commit 788064dd12ab7a7075ad24771f377587ad93b68d
Author: Pieter Wuille <pieter.wuille@gmail.com>
Date:   Tue Apr 30 16:12:21 2013 +0200

    Don't announce to non-peer CNodes

diff --git a/src/net.h b/src/net.h
index df34f5a88..af66eed07 100644
--- a/src/net.h
+++ b/src/net.h
@@ -256,7 +256,7 @@ public:
         pfilter = NULL;
 
         // Be shy and don't send version until we hear
-        if (!fInbound)
+        if (hSocket != INVALID_SOCKET && !fInbound)
             PushVersion();
     }
 

