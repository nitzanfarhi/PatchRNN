commit 6e1b3095ddd2aa5286c8219ee19ab77c0398b43f
Author: Bjørn Mork <bjorn@mork.no>
Date:   Sun May 11 10:47:13 2014 +0200

    net: cdc_mbim: reject IP packets on DSS VLANs
    
    DSS VLANs are pseudo network interfaces representing arbitrary
    data streams, and specifically not IP. Preventing spurious IP
    packets can sometimes be a hassle. The kernel will for example
    send an IPv6 Router Solicit when the interface is brought up
    unless the user has been careful enough to disable IPv6 first.
    Such packets forwared to a MBIM DSS session will look like
    spurious noise to the device, and can cause it to log an error
    or even malfunction.
    
    Drop all IP packets on the designated DSS VLANs to prevent such
    unwanted spurious transmissions.
    
    Cc: Greg Suarez <gsuarez@smithmicro.com>
    Reported-by: Arnaud Desmier <adesmier@sequans.com>
    Signed-off-by: Bjørn Mork <bjorn@mork.no>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/usb/cdc_mbim.c b/drivers/net/usb/cdc_mbim.c
index 694a8790f695..80d27719ba38 100644
--- a/drivers/net/usb/cdc_mbim.c
+++ b/drivers/net/usb/cdc_mbim.c
@@ -237,6 +237,8 @@ static struct sk_buff *cdc_mbim_tx_fixup(struct usbnet *dev, struct sk_buff *skb
 			c[3] = tci;
 			break;
 		case 0x0100: /* VLAN ID 256 - 511 */
+			if (is_ip)
+				goto error;
 			sign = cpu_to_le32(USB_CDC_MBIM_NDP16_DSS_SIGN);
 			c = (u8 *)&sign;
 			c[3] = tci;

