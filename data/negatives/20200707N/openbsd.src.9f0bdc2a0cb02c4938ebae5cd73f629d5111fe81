commit 9f0bdc2a0cb02c4938ebae5cd73f629d5111fe81
Author: krw <krw@openbsd.org>
Date:   Thu Mar 1 15:19:05 2018 +0000

    Check return value of getuint64() for ULLONG_MAX, and
    ULLONG_MAX - 1, not <= 0. This fixes the detection of
    ^D and invalid values during the 'R'esize command.
    
    ok otto@

diff --git a/sbin/disklabel/editor.c b/sbin/disklabel/editor.c
index 29708f24101..4ae9b2c3906 100644
--- a/sbin/disklabel/editor.c
+++ b/sbin/disklabel/editor.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: editor.c,v 1.314 2018/02/27 14:58:05 krw Exp $	*/
+/*	$OpenBSD: editor.c,v 1.315 2018/03/01 15:19:05 krw Exp $	*/
 
 /*
  * Copyright (c) 1997-2000 Todd C. Miller <Todd.Miller@courtesan.com>
@@ -727,11 +727,14 @@ editor_resize(struct disklabel *lp, char *p)
 	}
 	secs = getuint64(lp, "[+|-]new size (with unit)",
 	    "new size or amount to grow (+) or shrink (-) partition including unit",
-	    sz, editor_countfree(lp), 0, DO_CONVERSIONS);
+	    sz, sz + editor_countfree(lp), 0, DO_CONVERSIONS);
 
-	if (secs <= 0) {
+	if (secs == ULLONG_MAX - 1) {
 		fputs("Command aborted\n", stderr);
 		return;
+	} else if (secs == ULLONG_MAX) {
+		fputs("Invalid entry\n", stderr);
+		return;
 	}
 
 #ifdef SUN_CYLCHECK

