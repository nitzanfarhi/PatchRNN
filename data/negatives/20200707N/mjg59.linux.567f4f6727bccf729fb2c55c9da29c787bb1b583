commit 567f4f6727bccf729fb2c55c9da29c787bb1b583
Author: Viresh Kumar <viresh.kumar@linaro.org>
Date:   Wed Jun 19 14:22:59 2013 +0530

    cpufreq: e_powersaver: call CPUFREQ_POSTCHANGE notfier in error cases
    
    In case we have started PRECHANGE notifier and found an error, we
    must call POSTCHANGE notifier with freqs.new = freqs.old.
    
    This driver does take care of it, but the POSTCHANGE is called with
    freqs.new on errors too, which is incorrect, so fix it.
    
    [rjw: Changelog]
    Signed-off-by: Viresh Kumar <viresh.kumar@linaro.org>
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/cpufreq/e_powersaver.c b/drivers/cpufreq/e_powersaver.c
index 324aff20aeef..a60efaeb4cf8 100644
--- a/drivers/cpufreq/e_powersaver.c
+++ b/drivers/cpufreq/e_powersaver.c
@@ -161,6 +161,9 @@ postchange:
 		current_multiplier);
 	}
 #endif
+	if (err)
+		freqs.new = freqs.old;
+
 	cpufreq_notify_transition(policy, &freqs, CPUFREQ_POSTCHANGE);
 	return err;
 }

