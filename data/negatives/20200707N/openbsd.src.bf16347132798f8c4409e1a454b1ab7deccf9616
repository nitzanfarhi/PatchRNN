commit bf16347132798f8c4409e1a454b1ab7deccf9616
Author: miod <miod@openbsd.org>
Date:   Tue Dec 4 05:37:40 2007 +0000

    Faster splassert_check()

diff --git a/sys/arch/m88k/m88k/trap.c b/sys/arch/m88k/m88k/trap.c
index 19b2c18257d..793a5f0a44a 100644
--- a/sys/arch/m88k/m88k/trap.c
+++ b/sys/arch/m88k/m88k/trap.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: trap.c,v 1.56 2007/12/04 05:36:34 miod Exp $	*/
+/*	$OpenBSD: trap.c,v 1.57 2007/12/04 05:37:40 miod Exp $	*/
 /*
  * Copyright (c) 2004, Miodrag Vallat.
  * Copyright (c) 1998 Steve Murphree, Jr.
@@ -1697,14 +1697,15 @@ splassert_check(int wantipl, const char *func)
 {
 	int oldipl;
 
-	/*
-	 * This will raise the spl if too low,
-	 * in a feeble attempt to reduce further damage.
-	 */
-	oldipl = raiseipl(wantipl);
+	oldipl = getipl();
 
 	if (oldipl < wantipl) {
 		splassert_fail(wantipl, oldipl, func);
+		/*
+		 * This will raise the spl,
+		 * in a feeble attempt to reduce further damage.
+		 */
+		(void)raiseipl(wantipl);
 	}
 }
 #endif

