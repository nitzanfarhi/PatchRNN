commit c912c2db2f5c2467ba34e4e655008a14532a3900
Author: Jon Mason <jdmason@us.ibm.com>
Date:   Sat Mar 25 16:31:19 2006 +0100

    [PATCH] x86_64: free_bootmem_node needs __pa in allocate_aperture
    
    free_bootmem_node expects a physical address to be passed in, but
    __alloc_bootmem_node returns a virtual one.  That address needs to be
    translated to physical.
    
    Signed-off-by: Jon Mason <jdmason@us.ibm.com>
    Signed-off-by: Andi Kleen <ak@suse.de>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/arch/x86_64/kernel/aperture.c b/arch/x86_64/kernel/aperture.c
index a0f955b9995f..15b45582101f 100644
--- a/arch/x86_64/kernel/aperture.c
+++ b/arch/x86_64/kernel/aperture.c
@@ -60,7 +60,7 @@ static u32 __init allocate_aperture(void)
 		printk("Cannot allocate aperture memory hole (%p,%uK)\n",
 		       p, aper_size>>10);
 		if (p)
-			free_bootmem_node(nd0, (unsigned long)p, aper_size); 
+			free_bootmem_node(nd0, __pa(p), aper_size); 
 		return 0;
 	}
 	printk("Mapping aperture over %d KB of RAM @ %lx\n",

