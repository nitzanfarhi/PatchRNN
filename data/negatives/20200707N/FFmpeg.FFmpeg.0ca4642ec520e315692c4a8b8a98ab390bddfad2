commit 0ca4642ec520e315692c4a8b8a98ab390bddfad2
Author: Luca Barbato <lu_zero@gentoo.org>
Date:   Sun Apr 29 17:55:51 2012 -0700

    mkv: mark corrupted packets and return them
    
    Do return error if memory allocation or I/O fails.

diff --git a/libavformat/matroskadec.c b/libavformat/matroskadec.c
index 5688658055..3b78ae3972 100644
--- a/libavformat/matroskadec.c
+++ b/libavformat/matroskadec.c
@@ -2069,6 +2069,11 @@ static int matroska_read_packet(AVFormatContext *s, AVPacket *pkt)
         ret = matroska_parse_cluster(matroska);
     }
 
+    if (ret == AVERROR_INVALIDDATA) {
+        pkt->flags |= AV_PKT_FLAG_CORRUPT;
+        return 0;
+    }
+
     return ret;
 }
 

