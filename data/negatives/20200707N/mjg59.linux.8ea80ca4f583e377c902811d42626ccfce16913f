commit 8ea80ca4f583e377c902811d42626ccfce16913f
Author: Sam Ravnborg <sam@mars.ravnborg.org>
Date:   Sun Feb 19 09:56:18 2006 +0100

    kbuild: fix segfault in modpost
    
    Do not try to look up section name until we know it is not a special
    section. Otherwise we will address outside legal space and segfault.
    
    Signed-off-by: Sam Ravnborg <sam@ravnborg.org>

diff --git a/scripts/mod/modpost.c b/scripts/mod/modpost.c
index a7360c379cba..eeaf57476820 100644
--- a/scripts/mod/modpost.c
+++ b/scripts/mod/modpost.c
@@ -576,11 +576,11 @@ static void check_sec_ref(struct module *mod, const char *modname,
 			r.r_offset = TO_NATIVE(rela->r_offset);
 			r.r_info   = TO_NATIVE(rela->r_info);
 			sym = elf->symtab_start + ELF_R_SYM(r.r_info);
-			secname = secstrings + sechdrs[sym->st_shndx].sh_name;
 			/* Skip special sections */
 			if (sym->st_shndx >= SHN_LORESERVE)
 				continue;
 
+			secname = secstrings + sechdrs[sym->st_shndx].sh_name;
 			if (section(secname))
 				warn_sec_mismatch(modname, name, elf, sym, r);
 		}

