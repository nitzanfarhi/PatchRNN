commit f6a50ab94799b632c6fc95ec73bfed399ead4e19
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Oct 6 13:15:10 2014 +0300

    doveadm backup: Don't unnecessarily delete mailbox when handling expunges

diff --git a/src/doveadm/dsync/dsync-mailbox-import.c b/src/doveadm/dsync/dsync-mailbox-import.c
index 4a7b274b7..f12757b25 100644
--- a/src/doveadm/dsync/dsync-mailbox-import.c
+++ b/src/doveadm/dsync/dsync-mailbox-import.c
@@ -1474,7 +1474,8 @@ dsync_mailbox_find_common_uid(struct dsync_mailbox_importer *importer,
 		}
 		return;
 	}
-	if (importer->revert_local_changes) {
+	if (importer->revert_local_changes &&
+	    change->type != DSYNC_MAIL_CHANGE_TYPE_EXPUNGE) {
 		dsync_mailbox_revert_missing(importer, change);
 		*result_r = "Reverting local change by deleting mailbox";
 	} else if (dsync_mailbox_find_common_expunged_uid(importer, change)) {

