commit d461dfd34a8de2260eba7756d4bb50e6a373b30e
Author: pvalchev <pvalchev@openbsd.org>
Date:   Thu Jun 12 19:18:50 2008 +0000

    fix parser crash w/ invalid UTF-8 char sequences (all apps that use expat
    for XML parsing are affected)
    
    reported & fixed in upstream cvs

diff --git a/lib/libexpat/lib/xmltok_impl.c b/lib/libexpat/lib/xmltok_impl.c
index 12688192522..8154c1afa92 100644
--- a/lib/libexpat/lib/xmltok_impl.c
+++ b/lib/libexpat/lib/xmltok_impl.c
@@ -1748,6 +1748,9 @@ PREFIX(updatePosition)(const ENCODING *enc,
     switch (BYTE_TYPE(enc, ptr)) {
 #define LEAD_CASE(n) \
     case BT_LEAD ## n: \
+      if (end - ptr < n) { \
+        return; \
+      } \
       ptr += n; \
       break;
     LEAD_CASE(2) LEAD_CASE(3) LEAD_CASE(4)

