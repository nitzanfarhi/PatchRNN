commit 925d74ae717c9a12d3618eb4b36b9fb632e2cef3
Author: Németh Márton <nm127@freemail.hu>
Date:   Wed Apr 29 15:57:24 2009 -0300

    V4L/DVB (11736): videobuf: modify return value of VIDIOC_REQBUFS ioctl
    
    The V4L2 ioctls usually return 0 when the operation was successful
    and -1 in case of error. Currently VIDIOC_REQBUFS returns the
    number of buffers which is redundant because this information is
    available in count field of struct v4l2_requestbuffers. The
    V4L2 API specification, revision 0.24 [1] explicitly specifies for
    VIDIOC_REQBUFS that the return value shall be 0 on success.
    
    The patch was tested with v4l-test 0.13 [2] with vivi driver.
    
    References:
    [1] V4L2 API specification, revision 0.24
        http://v4l2spec.bytesex.org/spec/r13696.htm
    
    [2] v4l-test: Test environment for Video For Linux Two API
        http://v4l-test.sourceforge.net/
    
    Signed-off-by: Márton Németh <nm127@freemail.hu>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/video/videobuf-core.c b/drivers/media/video/videobuf-core.c
index b7b05842cf28..29b3c693a8e4 100644
--- a/drivers/media/video/videobuf-core.c
+++ b/drivers/media/video/videobuf-core.c
@@ -439,6 +439,7 @@ int videobuf_reqbufs(struct videobuf_queue *q,
 	}
 
 	req->count = retval;
+	retval = 0;
 
  done:
 	mutex_unlock(&q->vb_lock);

