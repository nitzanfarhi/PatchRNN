commit 307d46e83291ef58b2c3b6d33b7ec6dd163d58b9
Author: Linas Vepstas <linas@austin.ibm.com>
Date:   Fri Nov 16 05:56:23 2007 +1100

    [POWERPC] EEH: Work with device endpoint, always
    
    Perform all error checking at the "partitonable endpoint"
    of the device.
    
    Signed-off-by: Linas Vepstas <linas@austin.ibm.com>
    Signed-off-by: Paul Mackerras <paulus@samba.org>

diff --git a/arch/powerpc/platforms/pseries/eeh.c b/arch/powerpc/platforms/pseries/eeh.c
index fb3d636e088b..42a30b6628a9 100644
--- a/arch/powerpc/platforms/pseries/eeh.c
+++ b/arch/powerpc/platforms/pseries/eeh.c
@@ -480,6 +480,7 @@ int eeh_dn_check_failure(struct device_node *dn, struct pci_dev *dev)
 		no_dn++;
 		return 0;
 	}
+	dn = find_device_pe(dn);
 	pdn = PCI_DN(dn);
 
 	/* Access to IO BARs might get this far and still not want checking. */

