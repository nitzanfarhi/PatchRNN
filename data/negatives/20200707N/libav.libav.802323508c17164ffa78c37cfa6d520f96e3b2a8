commit 802323508c17164ffa78c37cfa6d520f96e3b2a8
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Mon Mar 15 19:45:57 2010 +0000

    Allow mpeg style yuv in jpeg when strict standard compliance is small enough.
    
    Originally committed as revision 22553 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/ffmpeg.c b/ffmpeg.c
index 3bc751c0d..61b833212 100644
--- a/ffmpeg.c
+++ b/ffmpeg.c
@@ -3147,7 +3147,11 @@ static void new_video_stream(AVFormatContext *oc)
                 if(*p == video_enc->pix_fmt)
                     break;
             }
-            if(*p == -1)
+            if(*p == -1
+               && !(   video_enc->codec_id==CODEC_ID_MJPEG
+                    && video_enc->strict_std_compliance <= FF_COMPLIANCE_INOFFICIAL
+                    && (   video_enc->pix_fmt == PIX_FMT_YUV420P
+                        || video_enc->pix_fmt == PIX_FMT_YUV422P)))
                 video_enc->pix_fmt = codec->pix_fmts[0];
         }
 

