commit e3fc2d16bdab7d826bff122932185c5fbe00637c
Author: mwilliams <markw65@facebook.com>
Date:   Fri May 21 14:48:51 2010 -0700

    Fix soap encoding error
    
    Summary:
    get_array_types tries to assign a type to an array by looking at the types of
    all of its elements.
    If there's at least one element and they're all the same type, it returns that,
    otherwise it returns XSD_ANYTYPE.
    But it wasnt taking account of LiteralString vs KindOfString, and so was
    mischaracterizing certain arrays.
    
    This broke flib/intern/fbcdn/purge. The test has been removed from flib on
    trunk because of stability issues (it relies on an external endpoint); but under
    compiled www it would consitently throw an error because the soap request was
    mal-formed, while under php/hphpi it would either pass, or fail to get a
    response at all.
    
    Test Plan:
    fast_tests, slow_tests, flib/intern/fbcdn/purge.
    
    DiffCamp Revision: 116987
    Reviewed By: hzhao
    CC: hphp-diffs@lists
    Revert Plan:
    OK

diff --git a/src/runtime/ext/soap/encoding.cpp b/src/runtime/ext/soap/encoding.cpp
index e203343c71..cc79ccd1cb 100644
--- a/src/runtime/ext/soap/encoding.cpp
+++ b/src/runtime/ext/soap/encoding.cpp
@@ -3236,6 +3236,9 @@ static encodePtr get_array_type(xmlNodePtr node, CVarRef array,
       cur_ns = NULL;
     } else {
       cur_type = tmp.getType();
+      if (cur_type == LiteralString) {
+        cur_type = KindOfString;
+      }
       cur_stype = NULL;
       cur_ns = NULL;
     }

