commit dda072cfdf90ccd09f16421b415a04e9d89a4dcf
Author: Ensiform <ensiform@gmail.com>
Date:   Sat Feb 7 20:55:28 2015 -0600

    [SP] Tweak RE_Shutdown so that tr.registered doesn't need to be checked
    so early.

diff --git a/code/rd-vanilla/tr_init.cpp b/code/rd-vanilla/tr_init.cpp
index 88318301..e8d2f565 100644
--- a/code/rd-vanilla/tr_init.cpp
+++ b/code/rd-vanilla/tr_init.cpp
@@ -1766,43 +1766,45 @@ void RE_Shutdown( qboolean destroyWindow, qboolean restarting ) {
 	for ( size_t i = 0; i < numCommands; i++ )
 		ri.Cmd_RemoveCommand( commands[i].cmd );
 
-	R_ShutdownWorldEffects();
-	R_ShutdownFonts();
+	if ( r_DynamicGlow && r_DynamicGlow->integer )
+	{
+		// Release the Glow Vertex Shader.
+		if ( tr.glowVShader )
+		{
+			qglDeleteProgramsARB( 1, &tr.glowVShader );
+		}
 
-	if ( tr.registered ) {
-		if ( r_DynamicGlow && r_DynamicGlow->integer )
+		// Release Pixel Shader.
+		if ( tr.glowPShader )
 		{
-			// Release the Glow Vertex Shader.
-			if ( tr.glowVShader )
+			if ( qglCombinerParameteriNV  )
 			{
-				qglDeleteProgramsARB( 1, &tr.glowVShader );
+				// Release the Glow Regcom call list.
+				qglDeleteLists( tr.glowPShader, 1 );
 			}
-
-			// Release Pixel Shader.
-			if ( tr.glowPShader )
+			else if ( qglGenProgramsARB )
 			{
-				if ( qglCombinerParameteriNV  )
-				{
-					// Release the Glow Regcom call list.
-					qglDeleteLists( tr.glowPShader, 1 );
-				}
-				else if ( qglGenProgramsARB )
-				{
-					// Release the Glow Fragment Shader.
-					qglDeleteProgramsARB( 1, &tr.glowPShader );
-				}
+				// Release the Glow Fragment Shader.
+				qglDeleteProgramsARB( 1, &tr.glowPShader );
 			}
+		}
 
-			// Release the scene glow texture.
-			qglDeleteTextures( 1, &tr.screenGlow );
+		// Release the scene glow texture.
+		qglDeleteTextures( 1, &tr.screenGlow );
 
-			// Release the scene texture.
-			qglDeleteTextures( 1, &tr.sceneImage );
+		// Release the scene texture.
+		qglDeleteTextures( 1, &tr.sceneImage );
 
-			// Release the blur texture.
-			qglDeleteTextures( 1, &tr.blurImage );
-		}
-		if (destroyWindow)
+		// Release the blur texture.
+		qglDeleteTextures( 1, &tr.blurImage );
+	}
+
+	R_ShutdownWorldEffects();
+	R_ShutdownFonts();
+	if ( tr.registered )
+	{
+		R_IssuePendingRenderCommands();
+		if ( destroyWindow )
 		{
 			R_DeleteTextures();	// only do this for vid_restart now, not during things like map load
 

