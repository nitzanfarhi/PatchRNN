commit 204e706fa2ac1a62ff6423039945eb567c6c7efc
Author: Marek Vasut <marex@denx.de>
Date:   Tue Sep 4 04:40:16 2012 +0200

    mxs/spi: Increment the transfer length only if transfer succeeded
    
    The transfer function incremented (struct spi_message)->actual_length
    unconditionally, even if the transfer failed. Rectify this by incrementing
    this only if transfer succeeded.
    
    Signed-off-by: Marek Vasut <marex@denx.de>
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>

diff --git a/drivers/spi/spi-mxs.c b/drivers/spi/spi-mxs.c
index bcba098e97c5..138c8523dbba 100644
--- a/drivers/spi/spi-mxs.c
+++ b/drivers/spi/spi-mxs.c
@@ -473,12 +473,12 @@ static int mxs_spi_transfer_one(struct spi_master *master,
 						&first, &last, 0);
 		}
 
-		m->actual_length += t->len;
 		if (status) {
 			stmp_reset_block(ssp->base);
 			break;
 		}
 
+		m->actual_length += t->len;
 		first = last = 0;
 	}
 

