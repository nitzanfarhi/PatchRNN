commit 5fcc584c344e7894e2da15071050b6eb5f882f55
Author: Richard W.M. Jones <rjones@redhat.com>
Date:   Wed Sep 17 15:34:03 2014 +0100

    daemon: parted: Don't crash if part-get-name called on non-partitioned device (RHBZ#1142158).
    
    If do_part_get_parttype returns NULL, then return from the function
    instead of dereferencing the NULL pointer and crashing.  Note that
    do_part_get_parttype has already called reply_with_error in this case.
    
    This fixes commit 0316d247706aab7ce7c2225472feeb51fa8b1664.
    
    Found by: Lingfei Kong

diff --git a/daemon/parted.c b/daemon/parted.c
index 5b049f577..5e016f48b 100644
--- a/daemon/parted.c
+++ b/daemon/parted.c
@@ -896,7 +896,11 @@ do_part_get_gpt_type (const char *device, int partnum)
 char *
 do_part_get_name (const char *device, int partnum)
 {
-  CLEANUP_FREE char *parttype = do_part_get_parttype (device);
+  CLEANUP_FREE char *parttype;
+
+  parttype = do_part_get_parttype (device);
+  if (parttype == NULL)
+    return NULL;
 
   if (STREQ (parttype, "gpt")) {
     int parted_has_m_opt = test_parted_m_opt ();

