commit 0186271e7a509e98d5db49d8f7295ceb99183eac
Author: Sage Weil <sage@redhat.com>
Date:   Fri Apr 29 15:44:04 2016 -0400

    osd: pay attention to shard when setting role
    
    This matches start_peering_interval().
    
    Signed-off-by: Sage Weil <sage@redhat.com>

diff --git a/src/osd/OSD.cc b/src/osd/OSD.cc
index f7907f5c83..b061616488 100644
--- a/src/osd/OSD.cc
+++ b/src/osd/OSD.cc
@@ -3222,7 +3222,10 @@ void OSD::load_pgs()
       up_primary,
       primary);
     int role = OSDMap::calc_pg_role(whoami, pg->acting);
-    pg->set_role(role);
+    if (pg->pool.info.is_replicated() || role == pg->pg_whoami.shard)
+      pg->set_role(role);
+    else
+      pg->set_role(-1);
 
     pg->reg_next_scrub();
 

