commit 33167ddc13fd20313ccfcdc64141000407b68b8f
Author: Even Rouault <even.rouault@spatialys.com>
Date:   Fri Sep 8 09:53:52 2017 +0200

    opj_j2k_update_image_data(): restrict optimized path

diff --git a/src/lib/openjp2/j2k.c b/src/lib/openjp2/j2k.c
index 8bac309f..0dad1503 100644
--- a/src/lib/openjp2/j2k.c
+++ b/src/lib/openjp2/j2k.c
@@ -9129,6 +9129,7 @@ static OPJ_BOOL opj_j2k_update_image_data(opj_tcd_t * p_tcd,
         /* Allocate output component buffer if necessary */
         if (l_img_comp_dest->data == NULL &&
                 l_start_offset_src == 0 && l_start_offset_dest == 0 &&
+                src_data_stride == l_img_comp_dest->w &&
                 l_width_dest == l_img_comp_dest->w &&
                 l_height_dest == l_img_comp_dest->h) {
             /* If the final image matches the tile buffer, then borrow it */

