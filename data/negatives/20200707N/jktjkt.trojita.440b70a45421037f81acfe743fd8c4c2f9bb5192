commit 440b70a45421037f81acfe743fd8c4c2f9bb5192
Author: Jan Kundr√°t <jkt@flaska.net>
Date:   Tue May 10 18:26:27 2011 +0200

    Truncate overly long messages

diff --git a/src/Imap/Model/Logging.h b/src/Imap/Model/Logging.h
index 314125c6..90e39fa6 100644
--- a/src/Imap/Model/Logging.h
+++ b/src/Imap/Model/Logging.h
@@ -49,9 +49,11 @@ struct LogMessage
     QString source;
     /** @short Actual message */
     QString message;
+    /** @short Was it truncated? */
+    bool truncated;
 
-    LogMessage(const QDateTime &timestamp_, const LogKind kind_, const QString &source_, const QString &message_):
-        timestamp(timestamp_), kind(kind_), source(source_), message(message_)
+    LogMessage(const QDateTime &timestamp_, const LogKind kind_, const QString &source_, const QString &message_, const bool truncated_):
+        timestamp(timestamp_), kind(kind_), source(source_), message(message_), truncated(truncated_)
     {
     }
 
diff --git a/src/Imap/Model/Model.cpp b/src/Imap/Model/Model.cpp
index 76b548eb..aff496e7 100644
--- a/src/Imap/Model/Model.cpp
+++ b/src/Imap/Model/Model.cpp
@@ -1377,8 +1377,11 @@ void Model::emitAuthFailed(const QString &message)
 
 void Model::logTrace(Parser *parser, const LogKind kind, const QString &source, const QString &message)
 {
-    LogMessage m(QDateTime::currentDateTime(), kind, source, message);
+    enum {CUTOFF=200};
+    bool truncated = message.size() <= CUTOFF;
+    LogMessage m(QDateTime::currentDateTime(), kind, source, truncated ? message.left(CUTOFF) : message, truncated);
     accessParser(parser).eventLog.append(m);
+
 }
 
 }

