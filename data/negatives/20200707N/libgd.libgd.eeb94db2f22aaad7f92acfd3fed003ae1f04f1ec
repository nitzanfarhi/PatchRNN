commit eeb94db2f22aaad7f92acfd3fed003ae1f04f1ec
Author: pierre <none@none>
Date:   Wed Apr 5 15:54:20 2006 +0000

    - sync to 2.0.29

diff --git a/src/gd_topal.c b/src/gd_topal.c
index fa44b58..b2b6575 100644
--- a/src/gd_topal.c
+++ b/src/gd_topal.c
@@ -793,6 +793,11 @@ select_colors (gdImagePtr oim, gdImagePtr nim, my_cquantize_ptr cquantize, int d
   boxlist = (boxptr) (*cinfo->mem->alloc_small)
     ((j_common_ptr) cinfo, JPOOL_IMAGE, desired_colors * SIZEOF (box));
 #else
+  /* This can't happen because we clamp desired_colors at gdMaxColors, 
+    but anyway */
+  if (overflow2(desired_colors, sizeof (box))) {
+    return;
+   }
   boxlist = (boxptr) gdMalloc (desired_colors * sizeof (box));
 #endif
   /* Initialize one box containing whole space */

