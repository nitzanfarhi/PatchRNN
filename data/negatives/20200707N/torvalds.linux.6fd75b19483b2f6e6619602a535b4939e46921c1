commit 6fd75b19483b2f6e6619602a535b4939e46921c1
Author: Alan Stern <stern@rowland.harvard.edu>
Date:   Fri May 4 11:57:00 2007 -0400

    OHCI: Fix machine check in ohci_hub_status_data
    
    This patch (as901) fixes an oversight in ohci-hcd.  The
    hub_status_data routine must not try to access the controller's
    memory-mapped registers if the controller is in a low-power state;
    such attempts will cause a crash on some architectures (such as PPC).
    
    Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/usb/host/ohci-hub.c b/drivers/usb/host/ohci-hub.c
index 216c9c9d4d6d..bb9cc595219e 100644
--- a/drivers/usb/host/ohci-hub.c
+++ b/drivers/usb/host/ohci-hub.c
@@ -417,6 +417,8 @@ ohci_hub_status_data (struct usb_hcd *hcd, char *buf)
 	unsigned long	flags;
 
 	spin_lock_irqsave (&ohci->lock, flags);
+	if (!test_bit(HCD_FLAG_HW_ACCESSIBLE, &hcd->flags))
+		goto done;
 
 	/* undocumented erratum seen on at least rev D */
 	if ((ohci->flags & OHCI_QUIRK_AMD756)

