commit a8bf2bc212e129dd59a8b06cdbc15079cc3bd876
Author: Bob Peterson <rpeterso@redhat.com>
Date:   Thu Jun 24 19:15:09 2010 -0400

    GFS2: O_TRUNC not working on stuffed files across cluster
    
    This patch replaces a statement that got dropped out by accident.
    Without the patch, truncates on stuffed (very small) files cause
    those files to have an unpredictable size.
    
    Signed-off-by: Bob Peterson <rpeterso@redhat.com>
    Signed-off-by: Steven Whitehouse <swhiteho@redhat.com>

diff --git a/fs/gfs2/bmap.c b/fs/gfs2/bmap.c
index 4a48c0f4b402..84da64b551b2 100644
--- a/fs/gfs2/bmap.c
+++ b/fs/gfs2/bmap.c
@@ -1041,6 +1041,7 @@ static int trunc_start(struct gfs2_inode *ip, u64 size)
 
 	if (gfs2_is_stuffed(ip)) {
 		u64 dsize = size + sizeof(struct gfs2_inode);
+		ip->i_disksize = size;
 		ip->i_inode.i_mtime = ip->i_inode.i_ctime = CURRENT_TIME;
 		gfs2_trans_add_bh(ip->i_gl, dibh, 1);
 		gfs2_dinode_out(ip, dibh->b_data);

