commit 57638bf3aa64facd9eba0e018b5773f5d2da6c2b
Author: David Teigland <teigland@redhat.com>
Date:   Mon Apr 23 14:08:52 2012 -0500

    dlm: avoid unnecessary search in search_rsb
    
    If the rsb is found in the "keep" tree, but is
    not the right type (i.e. not MASTER), we can
    return immediately with the result.  There's
    no point in going on to search the "toss" list
    as if we hadn't found it.
    
    Signed-off-by: David Teigland <teigland@redhat.com>

diff --git a/fs/dlm/lock.c b/fs/dlm/lock.c
index 3d35c593f4c1..49926f1df23e 100644
--- a/fs/dlm/lock.c
+++ b/fs/dlm/lock.c
@@ -479,6 +479,9 @@ static int _search_rsb(struct dlm_ls *ls, char *name, int len, int b,
 		kref_get(&r->res_ref);
 		goto out;
 	}
+	if (error == -ENOTBLK)
+		goto out;
+
 	error = dlm_search_rsb_tree(&ls->ls_rsbtbl[b].toss, name, len, flags, &r);
 	if (error)
 		goto out;

