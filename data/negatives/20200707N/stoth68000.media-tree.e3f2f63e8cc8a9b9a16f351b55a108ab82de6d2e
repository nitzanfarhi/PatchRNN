commit e3f2f63e8cc8a9b9a16f351b55a108ab82de6d2e
Author: Jemma Denson <jdenson@gmail.com>
Date:   Tue May 19 17:23:14 2015 -0300

    [media] cx24120: Check for lock before updating BER & UCB
    
    BER & UCB aren't available unless we're locked; don't update dvbv5
    stats when not locked and mark these counters as unavailable.
    
    Signed-off-by: Jemma Denson <jdenson@gmail.com>
    Signed-off-by: Patrick Boettcher <patrick.boettcher@posteo.de>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>

diff --git a/drivers/media/dvb-frontends/cx24120.c b/drivers/media/dvb-frontends/cx24120.c
index ce784248b328..dc80e6affeae 100644
--- a/drivers/media/dvb-frontends/cx24120.c
+++ b/drivers/media/dvb-frontends/cx24120.c
@@ -663,6 +663,15 @@ static void cx24120_get_stats(struct cx24120_state *state)
 		c->cnr.stat[0].scale = FE_SCALE_NOT_AVAILABLE;
 	}
 
+	/* BER & UCB require lock */
+	if (!(state->fe_status & FE_HAS_LOCK)) {
+		c->post_bit_error.stat[0].scale = FE_SCALE_NOT_AVAILABLE;
+		c->post_bit_count.stat[0].scale = FE_SCALE_NOT_AVAILABLE;
+		c->block_error.stat[0].scale = FE_SCALE_NOT_AVAILABLE;
+		c->block_count.stat[0].scale = FE_SCALE_NOT_AVAILABLE;
+		return;
+	}
+
 	/* BER */
 	if (time_after(jiffies, state->ber_jiffies_stats)) {
 		msecs = (state->berw_usecs + 500) / 1000;

