commit ab54dcc175fa340eff037bb9e17220fe0296645e
Author: Jean Le Feuvre <jeanlf@users.sourceforge.net>
Date:   Mon Aug 1 15:43:51 2011 +0000

    Made <animation> automatically switch focus to its subtree and added top root dispatch of BROWSER* key codes
    
    git-svn-id: http://svn.code.sf.net/p/gpac/code/trunk/gpac@3492 63c20433-aa62-49bd-875c-5a186b69a8fb

diff --git a/src/compositor/events.c b/src/compositor/events.c
index 0404f43ef..d3a1bb095 100644
--- a/src/compositor/events.c
+++ b/src/compositor/events.c
@@ -782,6 +782,15 @@ TODO clean: figure out whether we use a mouse or a touch device - if touch devic
 		evt.detail = event->key.key_code;
 		evt.key_hw_code = event->key.hw_code;
 		target = compositor->focus_node;
+		
+		/*dirty hack to simulate browserback*/
+		if (event->key.key_code==GF_KEY_BACKSPACE && (event->key.flags & GF_KEY_MOD_CTRL)) {
+			event->key.key_code = GF_KEY_BROWSERBACK;
+		}
+
+		if ((event->key.key_code>=GF_KEY_BROWSERBACK) && (event->key.key_code<=GF_KEY_BROWSERSTOP)) {
+			target = NULL;
+		}
 		if (!target) target = gf_sg_get_root_node(compositor->scene);
 		ret += gf_dom_event_fire(target, &evt);
 
diff --git a/src/compositor/svg_grouping.c b/src/compositor/svg_grouping.c
index 6c505b470..737598e58 100644
--- a/src/compositor/svg_grouping.c
+++ b/src/compositor/svg_grouping.c
@@ -1316,6 +1316,11 @@ static void svg_traverse_animation(GF_Node *node, void *rs, Bool is_destroy)
 	if (!stack->inline_sg && stack->resource) {
 		stack->inline_sg = gf_mo_get_scenegraph(stack->resource);
 	}
+	/*if we have the focus, move it to the subtree*/
+	if (tr_state->visual->compositor->focus_node==node) {
+		GF_Node *subroot = gf_sg_get_root_node(stack->inline_sg);
+		if (subroot) tr_state->visual->compositor->focus_node = subroot;
+	}
 
 	if (stack->inline_sg) {
 		gf_sc_traverse_subscene(tr_state->visual->compositor, node, stack->inline_sg, tr_state);

