commit 35096e912c4eba6c5ffd961d36fc92f1ddf34240
Author: Rich Salz <rsalz@openssl.org>
Date:   Mon Jun 13 09:51:12 2016 -0400

    GH1141: Different fix, preferred by Richard.
    
    Reviewed-by: Richard Levitte <levitte@openssl.org>

diff --git a/crypto/cms/cms_env.c b/crypto/cms/cms_env.c
index 111b2aa573..b143a91f24 100644
--- a/crypto/cms/cms_env.c
+++ b/crypto/cms/cms_env.c
@@ -833,10 +833,10 @@ static void cms_env_set_version(CMS_EnvelopedData *env)
             env->version = 2;
         }
     }
-    if (env->version == 2)
-        return;
     if (env->originatorInfo || env->unprotectedAttrs)
         env->version = 2;
+    if (env->version == 2)
+        return;
     env->version = 0;
 }
 

