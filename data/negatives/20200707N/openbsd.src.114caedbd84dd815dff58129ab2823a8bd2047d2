commit 114caedbd84dd815dff58129ab2823a8bd2047d2
Author: jmatthew <jmatthew@openbsd.org>
Date:   Fri Apr 20 09:40:36 2018 +0000

    remove the background scan timeout on detach, so we don't crash shortly
    afterwards.
    
    crash reported by Piotr Isajew
    ok stsp@

diff --git a/sys/net80211/ieee80211.c b/sys/net80211/ieee80211.c
index 407da701240..da43082d70c 100644
--- a/sys/net80211/ieee80211.c
+++ b/sys/net80211/ieee80211.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: ieee80211.c,v 1.65 2017/12/12 15:52:49 stsp Exp $	*/
+/*	$OpenBSD: ieee80211.c,v 1.66 2018/04/20 09:40:36 jmatthew Exp $	*/
 /*	$NetBSD: ieee80211.c,v 1.19 2004/06/06 05:45:29 dyoung Exp $	*/
 
 /*-
@@ -193,6 +193,7 @@ ieee80211_ifdetach(struct ifnet *ifp)
 {
 	struct ieee80211com *ic = (void *)ifp;
 
+	timeout_del(&ic->ic_bgscan_timeout);
 	ieee80211_proto_detach(ifp);
 	ieee80211_crypto_detach(ifp);
 	ieee80211_node_detach(ifp);

