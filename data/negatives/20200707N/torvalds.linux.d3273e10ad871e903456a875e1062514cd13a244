commit d3273e10ad871e903456a875e1062514cd13a244
Author: Alex Smith <alex.smith@imgtec.com>
Date:   Fri Jul 24 17:24:23 2015 +0100

    dmaengine: jz4780: Use dma_get_slave_channel when requesting a specific channel
    
    When the DT requests a specific channel to use it is not necesssary
    to scan through all DMA channels in the system. Just return the
    requested channel using dma_get_slave_channel().
    
    Signed-off-by: Alex Smith <alex.smith@imgtec.com>
    Cc: Vinod Koul <vinod.koul@intel.com>
    Cc: Zubair Lutfullah Kakakhel <Zubair.Kakakhel@imgtec.com>
    Cc: dmaengine@vger.kernel.org
    Signed-off-by: Vinod Koul <vinod.koul@intel.com>

diff --git a/drivers/dma/dma-jz4780.c b/drivers/dma/dma-jz4780.c
index e4a291c67e2a..40baaf00b971 100644
--- a/drivers/dma/dma-jz4780.c
+++ b/drivers/dma/dma-jz4780.c
@@ -726,9 +726,14 @@ static struct dma_chan *jz4780_of_dma_xlate(struct of_phandle_args *dma_spec,
 				data.channel);
 			return NULL;
 		}
-	}
 
-	return dma_request_channel(mask, jz4780_dma_filter_fn, &data);
+		jzdma->chan[data.channel].transfer_type = data.transfer_type;
+
+		return dma_get_slave_channel(
+			&jzdma->chan[data.channel].vchan.chan);
+	} else {
+		return dma_request_channel(mask, jz4780_dma_filter_fn, &data);
+	}
 }
 
 static int jz4780_dma_probe(struct platform_device *pdev)

