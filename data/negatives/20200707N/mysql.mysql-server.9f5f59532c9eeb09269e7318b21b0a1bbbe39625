commit 9f5f59532c9eeb09269e7318b21b0a1bbbe39625
Author: konstantin@mysql.com <>
Date:   Sun Dec 19 20:28:52 2004 +0300

    Fix assertion failure in client_test when linked with the embedded
    library: stmt_update_metadata (used when we update max_length
    in mysql_stmt_store_result) needs valid row->length.

diff --git a/libmysqld/lib_sql.cc b/libmysqld/lib_sql.cc
index 8092d87b97c..917bcada564 100644
--- a/libmysqld/lib_sql.cc
+++ b/libmysqld/lib_sql.cc
@@ -710,6 +710,7 @@ bool Protocol_prep::write()
   }
   cur->data= (MYSQL_ROW)(((char *)cur) + sizeof(MYSQL_ROWS));
   memcpy(cur->data, packet->ptr()+1, packet->length()-1);
+  cur->length= packet->length();       /* To allow us to do sanity checks */
 
   *data->prev_ptr= cur;
   data->prev_ptr= &cur->next;

