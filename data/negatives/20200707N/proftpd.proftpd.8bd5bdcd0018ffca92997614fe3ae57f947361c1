commit 8bd5bdcd0018ffca92997614fe3ae57f947361c1
Author: castaglia <castaglia>
Date:   Fri Feb 13 22:03:40 2009 +0000

    Make sure that, when unloaded, mod_sftp unregisters all event handlers,
    and scrubs any keys from memory.

diff --git a/contrib/mod_sftp/mod_sftp.c b/contrib/mod_sftp/mod_sftp.c
index a66fe10cd..f3e2a0013 100644
--- a/contrib/mod_sftp/mod_sftp.c
+++ b/contrib/mod_sftp/mod_sftp.c
@@ -1067,6 +1067,10 @@ static void sftp_exit_ev(const void *event_data, void *user_data) {
 #if defined(PR_SHARED_MODULE)
 static void sftp_mod_unload_ev(const void *event_data, void *user_data) {
   if (strcmp("mod_sftp.c", (const char *) event_data) == 0) {
+    /* Unregister ourselves from all events. */
+    pr_event_unregister(&sftp_module, NULL, NULL);
+
+    sftp_keys_free();
     pr_response_block(FALSE);
     sftp_utf8_free();
 

