commit 85173ad0ec6a5aa910d7dcb6781919eec40f21d3
Author: Danny Auble <da@schedmd.com>
Date:   Wed Mar 28 13:21:06 2012 -0700

    BLUEGENE - if a system is doing a clean start and there happen to be
    hardware in error and job running on blocks as well this fix will make it
    so new blocks are formed around the bad hardware and free the old ones.

diff --git a/src/plugins/select/bluegene/bg_record_functions.c b/src/plugins/select/bluegene/bg_record_functions.c
index 19e400d56b..75d57c3886 100644
--- a/src/plugins/select/bluegene/bg_record_functions.c
+++ b/src/plugins/select/bluegene/bg_record_functions.c
@@ -1016,6 +1016,9 @@ extern int down_nodecard(char *mp_name, bitoff_t io_start,
 	slurm_mutex_lock(&block_state_mutex);
 	itr = list_iterator_create(bg_lists->main);
 	while ((bg_record = list_next(itr))) {
+		if (bg_record->free_cnt)
+			continue;
+
 		if (!bit_test(bg_record->mp_bitmap, mp_bit))
 			continue;
 
@@ -1244,6 +1247,8 @@ extern int down_nodecard(char *mp_name, bitoff_t io_start,
 	while ((bg_record = list_pop(requests))) {
 		itr = list_iterator_create(bg_lists->main);
 		while ((found_record = list_next(itr))) {
+			if (found_record->free_cnt)
+				continue;
 			if (!blocks_overlap(bg_record, found_record))
 				continue;
 			list_push(delete_list, found_record);

