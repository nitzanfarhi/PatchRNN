commit 846eeb1f478fc98de92c43842d4678a0c24eee11
Author: Timo Sirainen <tss@iki.fi>
Date:   Thu Mar 15 03:34:44 2007 +0200

    Crashfix
    
    --HG--
    branch : HEAD

diff --git a/src/lib-index/mailbox-list-index.c b/src/lib-index/mailbox-list-index.c
index ec54b4e69..ae24ba10c 100644
--- a/src/lib-index/mailbox-list-index.c
+++ b/src/lib-index/mailbox-list-index.c
@@ -465,7 +465,7 @@ mailbox_list_index_lookup_rec(struct mailbox_list_index *index,
 	const char *p, *hier_name;
 	int ret;
 
-	if (dir_offset == index->mmap_size &&
+	if ((dir_offset == index->mmap_size || index->mmap_size == 0) &&
 	    dir_offset == sizeof(*index->hdr)) {
 		/* root doesn't exist in the file yet */
 		return 0;

