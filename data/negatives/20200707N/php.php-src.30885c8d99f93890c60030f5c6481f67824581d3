commit 30885c8d99f93890c60030f5c6481f67824581d3
Author: Ilia Alshanetsky <iliaa@php.net>
Date:   Sun Oct 1 21:00:00 2006 +0000

    MFB: Fixed bug #38993 (Fixed safe_mode/open_basedir checks for
    session.save_path, allowing them to account for extra parameters).

diff --git a/ext/session/session.c b/ext/session/session.c
index a6a7e90431..a4b8880672 100644
--- a/ext/session/session.c
+++ b/ext/session/session.c
@@ -151,7 +151,15 @@ static PHP_INI_MH(OnUpdateSaveDir)
 {
 	/* Only do the safemode/open_basedir check at runtime */
 	if (stage == PHP_INI_STAGE_RUNTIME) {
-		if (php_check_open_basedir(new_value TSRMLS_CC)) {
+ 		char *p;
+
+		if ((p = zend_memrchr(new_value, ';', new_value_length))) {
+			p++;
+		} else {
+			p = new_value;
+		}
+
+		if (php_check_open_basedir(p TSRMLS_CC)) {
 			return FAILURE;
 		}
 	}
diff --git a/ext/standard/basic_functions.c b/ext/standard/basic_functions.c
index e215355b32..0749d92e92 100644
--- a/ext/standard/basic_functions.c
+++ b/ext/standard/basic_functions.c
@@ -5660,7 +5660,6 @@ PHP_FUNCTION(ini_set)
 			_CHECK_PATH(varname, "java.class.path") ||
 			_CHECK_PATH(varname, "java.home") ||
 			_CHECK_PATH(varname, "java.library.path") ||
-			_CHECK_PATH(varname, "session.save_path") ||
 			_CHECK_PATH(varname, "vpopmail.directory")) {
 			
 			if (php_check_open_basedir(Z_STRVAL_PP(new_value) TSRMLS_CC)) {

