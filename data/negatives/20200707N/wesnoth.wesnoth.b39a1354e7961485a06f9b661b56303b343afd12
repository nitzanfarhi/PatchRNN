commit b39a1354e7961485a06f9b661b56303b343afd12
Author: Ali El Gariani <alinkmaze@gmail.com>
Date:   Sat May 24 00:05:44 2008 +0000

    A discovered hidden unit now lost its hidden status until its next new turn.
    
    Previously, was hidden again after the next user action.
    
    This change a little how hides works for multi sides games.

diff --git a/src/actions.cpp b/src/actions.cpp
index 639d4c1185..689f79e5da 100644
--- a/src/actions.cpp
+++ b/src/actions.cpp
@@ -2146,18 +2146,24 @@ size_t move_unit(game_display* disp,
 			if(adjacent[i] == ui->first)
 				continue;
 
-			const unit_map::const_iterator it = units.find(adjacent[i]);
+			const unit_map::iterator it = units.find(adjacent[i]);
 			if(it != units.end() && team.is_enemy(it->second.side()) &&
 					it->second.invisible(it->first,units,teams)) {
 				discovered_unit = true;
-				unit_ability_list hides = it->second.get_abilities("hides",it->first);
-				for(std::vector<std::pair<config*,gamemap::location> >::const_iterator hide_it = hides.cfgs.begin();
-						hide_it != hides.cfgs.end(); ++hide_it) {
-					ambushed_string =(*hide_it->first)["alert"];
-				}
 				should_clear_stack = true;
 				moves_left = 0;
-				break;
+
+				it->second.set_state("hidden","no");
+
+				// we only use the first valid alert message
+				if (ambushed_string.empty()) {
+					unit_ability_list hides = it->second.get_abilities("hides",it->first);
+					
+					for(std::vector<std::pair<config*,gamemap::location> >::const_iterator hide_it = hides.cfgs.begin();
+							hide_it != hides.cfgs.end(); ++hide_it) {
+						ambushed_string =(*hide_it->first)["alert"];
+					}
+				}
 			}
 		}
 	}

