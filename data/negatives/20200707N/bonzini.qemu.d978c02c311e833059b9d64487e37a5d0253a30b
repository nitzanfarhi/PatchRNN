commit d978c02c311e833059b9d64487e37a5d0253a30b
Author: aurel32 <aurel32@c046a42c-6fe2-441c-8c8c-71466251a162>
Date:   Wed Jun 18 22:10:21 2008 +0000

    Make save function optional
    
    (Ian Jackson)
    
    
    git-svn-id: svn://svn.savannah.nongnu.org/qemu/trunk@4749 c046a42c-6fe2-441c-8c8c-71466251a162

diff --git a/vl.c b/vl.c
index d759fde9ac..37301b02fd 100644
--- a/vl.c
+++ b/vl.c
@@ -5987,6 +5987,10 @@ static int qemu_savevm_state(QEMUFile *f)
     qemu_put_be64(f, 0); /* total size */
 
     for(se = first_se; se != NULL; se = se->next) {
+	if (se->save_state == NULL)
+	    /* this one has a loader only, for backwards compatibility */
+	    continue;
+
         /* ID string */
         len = strlen(se->idstr);
         qemu_put_byte(f, len);

