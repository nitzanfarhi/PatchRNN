commit aa392a40fe73df11dd3fafc9b70ad75b5e4dffea
Author: Guy Harris <guy@alum.mit.edu>
Date:   Wed May 18 07:20:45 2011 +0000

    You cannot just make the "len" field of a GByteArray larger, if there's
    no data to back that length; you can only make it smaller.
    
    svn path=/trunk/; revision=37236

diff --git a/epan/proto.c b/epan/proto.c
index 2bde3f9abc..b343574b14 100644
--- a/epan/proto.c
+++ b/epan/proto.c
@@ -4096,7 +4096,12 @@ proto_item_set_len(proto_item *pi, const gint length)
 	DISSECTOR_ASSERT(length >= 0);
 	fi->length = length;
 
-	if (fi->value.ftype->ftype == FT_BYTES)
+	/*
+	 * You cannot just make the "len" field of a GByteArray
+	 * larger, if there's no data to back that length;
+	 * you can only make it smaller.
+	 */
+	if (fi->value.ftype->ftype == FT_BYTES && length <= fi->length)
 		fi->value.value.bytes->len = length;
 }
 

