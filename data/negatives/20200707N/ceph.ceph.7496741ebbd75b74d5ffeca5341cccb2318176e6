commit 7496741ebbd75b74d5ffeca5341cccb2318176e6
Author: brian <bjfelton@gmail.com>
Date:   Wed Sep 23 09:49:36 2015 -0500

    rgw: fix modification to index attrs when setting acls
    
    Fixes: #12955
    
     - add ACL change after initial population
     - populate bufferlist with object attributes
    
    Signed-off-by: Brian Felton <bjfelton@gmail.com>

diff --git a/src/rgw/rgw_op.cc b/src/rgw/rgw_op.cc
index ca41a25ad9..8633036ef9 100644
--- a/src/rgw/rgw_op.cc
+++ b/src/rgw/rgw_op.cc
@@ -2799,8 +2799,17 @@ void RGWPutACLs::execute()
   new_policy.encode(bl);
   obj = rgw_obj(s->bucket, s->object);
   map<string, bufferlist> attrs;
-  attrs[RGW_ATTR_ACL] = bl;
+
   store->set_atomic(s->obj_ctx, obj);
+
+  if (!s->object.empty()) {
+    ret = get_obj_attrs(store, s, obj, attrs);
+    if (ret < 0)
+      return;
+  }
+  
+  attrs[RGW_ATTR_ACL] = bl;
+
   if (!s->object.empty()) {
     ret = store->set_attrs(s->obj_ctx, obj, attrs, NULL, ptracker);
   } else {

