commit 088a4b7151928d49430544279dff76c5a6a59244
Author: Andrei Zmievski <andrei@php.net>
Date:   Sat Feb 3 07:21:35 2001 +0000

    Set the correct function state during execution. This is mainly to have
    get_active_function_name() to return proper value.

diff --git a/Zend/zend_execute_API.c b/Zend/zend_execute_API.c
index 53bd1ab958..0e3b4eb4c0 100644
--- a/Zend/zend_execute_API.c
+++ b/Zend/zend_execute_API.c
@@ -417,6 +417,8 @@ int call_user_function_ex(HashTable *function_table, zval **object_pp, zval *fun
 
 	zend_ptr_stack_n_push(&EG(argument_stack), 2, (void *) (long) param_count, NULL);
 
+	EG(function_state_ptr) = &function_state;
+
 	if (function_state.function->type == ZEND_USER_FUNCTION) {
 		calling_symbol_table = EG(active_symbol_table);
 		if (symbol_table) {

