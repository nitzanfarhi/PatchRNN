commit 91af41825466e1f0fd490bceffe34b1af5cd8572
Author: Frédéric Brière <fbriere@fbriere.net>
Date:   Sun May 27 11:46:00 2012 -0400

    Don't trip on absence of global ratio in QBtSession::processBigRatios()
    
    QBtSession::processBigRatios() must fetch the global ratio, if
    applicable, before checking for NO_RATIO_LIMIT.
    
    LP: #835217

diff --git a/src/qtlibtorrent/qbtsession.cpp b/src/qtlibtorrent/qbtsession.cpp
index 3d14f2c68..e71759c22 100644
--- a/src/qtlibtorrent/qbtsession.cpp
+++ b/src/qtlibtorrent/qbtsession.cpp
@@ -272,10 +272,10 @@ void QBtSession::processBigRatios() {
       const QString hash = h.hash();
       const qreal ratio = getRealRatio(hash);
       qreal ratio_limit = TorrentPersistentData::getRatioLimit(hash);
-      if (ratio_limit == TorrentPersistentData::NO_RATIO_LIMIT)
-        continue;
       if (ratio_limit == TorrentPersistentData::USE_GLOBAL_RATIO)
         ratio_limit = global_ratio_limit;
+      if (ratio_limit == TorrentPersistentData::NO_RATIO_LIMIT)
+        continue;
       qDebug("Ratio: %f (limit: %f)", ratio, ratio_limit);
       Q_ASSERT(ratio_limit >= 0.f);
       if (ratio <= MAX_RATIO && ratio >= ratio_limit) {

