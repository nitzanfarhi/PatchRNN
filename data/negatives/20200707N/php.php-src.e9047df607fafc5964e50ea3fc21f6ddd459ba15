commit e9047df607fafc5964e50ea3fc21f6ddd459ba15
Author: Sara Golemon <pollita@php.net>
Date:   Sat Nov 23 01:09:07 2002 +0000

    New function dns_get_record(): close resolver socket after use.
    fix to internal func php_parserr(): correct bug in return state.

diff --git a/ext/standard/dns.c b/ext/standard/dns.c
index cb68897944..cd55fb3618 100644
--- a/ext/standard/dns.c
+++ b/ext/standard/dns.c
@@ -331,8 +331,9 @@ static u_char *php_parserr(u_char *cp, querybuf *answer, int type_to_fetch, int
 	GETLONG(ttl, cp);
 	GETSHORT(dlen, cp);
 	if (type_to_fetch != T_ANY && type != type_to_fetch) {
-		/* Should never actually occour */
-		return NULL;
+		*subarray = NULL;
+		cp += dlen;
+		return cp;
 	}
 
 	if (!store) {
@@ -576,6 +577,7 @@ PHP_FUNCTION(dns_get_record)
 					zend_hash_next_index_insert(HASH_OF(return_value), (void *)&subarray[current_subarray], sizeof(zval *), NULL);
 				current_subarray++;
 			}
+			res_nclose(&res);
 		}
 	}
 

