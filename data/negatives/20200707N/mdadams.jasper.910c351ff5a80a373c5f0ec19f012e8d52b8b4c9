commit 910c351ff5a80a373c5f0ec19f012e8d52b8b4c9
Author: Max Kellermann <max.kellermann@gmail.com>
Date:   Fri Oct 6 19:15:47 2017 +0200

    jpc_t1cod: check whether passno is in range
    
    This works around an assertion failure in jpc_floorlog2() which can be
    provoked with a crafted JP2 file.
    
    This check probably belongs somewhere else, but I don't understand the
    code well enough.
    
    Closes #71

diff --git a/src/libjasper/jpc/jpc_t1cod.c b/src/libjasper/jpc/jpc_t1cod.c
index db7a788..1b65c6e 100644
--- a/src/libjasper/jpc/jpc_t1cod.c
+++ b/src/libjasper/jpc/jpc_t1cod.c
@@ -210,7 +210,8 @@ int JPC_SEGPASSCNT(int passno, int firstpassno, int numpasses, int bypass, int t
 	} else {
 		ret = JPC_PREC * 3 - 2;
 	}
-	ret = JAS_MIN(ret, numpasses - passno);
+	if (passno < numpasses)
+		ret = JAS_MIN(ret, numpasses - passno);
 	return ret;
 }
 

