commit 3c4f6a9171dfe14e32b7bad21309554f43a010a7
Author: Unbit <info@unbit.it>
Date:   Tue Mar 26 07:05:02 2013 +0100

    completed the geoip plugin

diff --git a/plugins/geoip/geoip.c b/plugins/geoip/geoip.c
index 80c6734b..0a7ce03e 100644
--- a/plugins/geoip/geoip.c
+++ b/plugins/geoip/geoip.c
@@ -39,6 +39,8 @@ static int uwsgi_geoip_init() {
 static char *uwsgi_route_var_geoip(struct wsgi_request *wsgi_req, char *key, uint16_t keylen, uint16_t *vallen) {
 	uint32_t ip;
 	char ip_str[16];
+	// should be enough for geo coords
+	char lonlat[64];
 	memset(ip_str, 0, 16);
 	memcpy(ip_str, wsgi_req->remote_addr, wsgi_req->remote_addr_len);
 	if (inet_pton(AF_INET, ip_str, &ip) <= 0) {
@@ -88,6 +90,9 @@ static char *uwsgi_route_var_geoip(struct wsgi_request *wsgi_req, char *key, uin
 	else if (!uwsgi_strncmp(key, keylen, "region", 6)) {
 		value = gr->region;
 	}
+	else if (!uwsgi_strncmp(key, keylen, "region_name", 11)) {
+		value = (char *) GeoIP_region_name_by_code(gr->country_code, gr->region);
+	}
 	else if (!uwsgi_strncmp(key, keylen, "city", 4)) {
 		value = gr->city;
 	}
@@ -97,6 +102,22 @@ static char *uwsgi_route_var_geoip(struct wsgi_request *wsgi_req, char *key, uin
 	else if (!uwsgi_strncmp(key, keylen, "postal_code", 11)) {
 		value = gr->postal_code;
 	}
+	else if (!uwsgi_strncmp(key, keylen, "latitude", 8) || !uwsgi_strncmp(key, keylen, "lat", 3)) {
+		snprintf(lonlat, 64, "%f", gr->latitude);
+		value = lonlat;
+	}
+	else if (!uwsgi_strncmp(key, keylen, "longitude", 9) || !uwsgi_strncmp(key, keylen, "lon", 3)) {
+		snprintf(lonlat, 64, "%f", gr->longitude);
+		value = lonlat;
+	}
+	else if (!uwsgi_strncmp(key, keylen, "dma", 3)) {
+		snprintf(lonlat, 64, "%d", gr->dma_code);
+		value = lonlat;
+	}
+	else if (!uwsgi_strncmp(key, keylen, "area", 4)) {
+		snprintf(lonlat, 64, "%d", gr->area_code);
+		value = lonlat;
+	}
 
 	
 	if (value) {

