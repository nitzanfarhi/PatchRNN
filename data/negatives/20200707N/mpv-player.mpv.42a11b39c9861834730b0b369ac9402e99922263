commit 42a11b39c9861834730b0b369ac9402e99922263
Author: albeu <albeu@b3059339-0415-0410-9bf9-f77b7e298cf2>
Date:   Wed Mar 29 19:31:31 2006 +0000

    100L to who wrote this. Also fix broken headers while at it.
    
    
    git-svn-id: svn://svn.mplayerhq.hu/mplayer/trunk@17991 b3059339-0415-0410-9bf9-f77b7e298cf2

diff --git a/libmpdemux/aviheader.c b/libmpdemux/aviheader.c
index 592d71ffdb..9f95ca339b 100644
--- a/libmpdemux/aviheader.c
+++ b/libmpdemux/aviheader.c
@@ -225,7 +225,12 @@ while(1){
 	  
       print_avisuperindex_chunk(s,MSGL_V);
 
-      msize = sizeof (uint32_t) * s->wLongsPerEntry * s->nEntriesInUse;
+      // Check and fix this useless crap
+      if(s->wLongsPerEntry != sizeof (avisuperindex_entry)/4) {
+          mp_msg (MSGT_HEADER, MSGL_WARN, "Broken super index chunk size: %u\n",s->wLongsPerEntry);
+          s->wLongsPerEntry = sizeof(avisuperindex_entry)/4;
+      }
+      msize = sizeof (avisuperindex_entry) * s->nEntriesInUse;
       s->aIndex = malloc(msize);
       memset (s->aIndex, 0, msize);
       s->stdidx = malloc (s->nEntriesInUse * sizeof (avistdindex_chunk));

