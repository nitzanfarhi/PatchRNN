commit 904cfd257db56f8146e7053bb9053ab53122f735
Author: Benoit Fouet <benoit.fouet@free.fr>
Date:   Tue Sep 30 13:06:40 2014 +0200

    avcodec/h264_mp4toannexb_bsf: reset the new IDR flag when SPS/PPS is seen.
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/h264_mp4toannexb_bsf.c b/libavcodec/h264_mp4toannexb_bsf.c
index be42304c77..ae96ee953d 100644
--- a/libavcodec/h264_mp4toannexb_bsf.c
+++ b/libavcodec/h264_mp4toannexb_bsf.c
@@ -186,9 +186,9 @@ static int h264_mp4toannexb_filter(AVBitStreamFilterContext *bsfc,
             goto fail;
 
         if (unit_type == 7)
-            ctx->idr_sps_seen = 1;
+            ctx->idr_sps_seen = ctx->new_idr = 1;
         else if (unit_type == 8) {
-            ctx->idr_pps_seen = 1;
+            ctx->idr_pps_seen = ctx->new_idr = 1;
             /* if SPS has not been seen yet, prepend the AVCC one to PPS */
             if (!ctx->idr_sps_seen) {
                 if (ctx->sps_offset == -1)

