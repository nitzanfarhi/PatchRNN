commit 009dd872d753f854cf13c8334e0055092f539b38
Author: Padmanabh Ratnakar <padmanabh.ratnakar@emulex.com>
Date:   Tue May 10 05:12:17 2011 +0000

    be2net: Handle error completion in Lancer
    
    In Lancer if a frame is DMAed partially due to lack of RX buffers,
    an error completion is sent with packet size as zero and num_recvd
    indicating number of used buffers. These buffers need to be freed
    and packet dropped.
    
    Signed-off-by: Padmanabh Ratnakar <padmanabh.ratnakar@emulex.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/benet/be_main.c b/drivers/net/benet/be_main.c
index 3fb4a1f465e1..3202f67d8785 100644
--- a/drivers/net/benet/be_main.c
+++ b/drivers/net/benet/be_main.c
@@ -1757,12 +1757,15 @@ static int be_poll_rx(struct napi_struct *napi, int budget)
 			break;
 
 		/* Ignore flush completions */
-		if (rxcp->num_rcvd) {
+		if (rxcp->num_rcvd && rxcp->pkt_size) {
 			if (do_gro(rxcp))
 				be_rx_compl_process_gro(adapter, rxo, rxcp);
 			else
 				be_rx_compl_process(adapter, rxo, rxcp);
+		} else if (rxcp->pkt_size == 0) {
+			be_rx_compl_discard(adapter, rxo, rxcp);
 		}
+
 		be_rx_stats_update(rxo, rxcp);
 	}
 

