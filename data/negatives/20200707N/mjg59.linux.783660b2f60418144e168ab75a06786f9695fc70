commit 783660b2f60418144e168ab75a06786f9695fc70
Author: Jens Axboe <jens.axboe@oracle.com>
Date:   Fri Jan 19 11:27:47 2007 +1100

    elevator: don't sort reads between writes
    
    Don't allow elv_dispatch_sort() to mix reads and writes together,
    it's rarely a good idea.
    
    Signed-off-by: Jens Axboe <jens.axboe@oracle.com>

diff --git a/block/elevator.c b/block/elevator.c
index d03762399147..25f6ef28e3bb 100644
--- a/block/elevator.c
+++ b/block/elevator.c
@@ -413,6 +413,8 @@ void elv_dispatch_sort(request_queue_t *q, struct request *rq)
 	list_for_each_prev(entry, &q->queue_head) {
 		struct request *pos = list_entry_rq(entry);
 
+		if (rq_data_dir(rq) != rq_data_dir(pos))
+			break;
 		if (pos->cmd_flags & (REQ_SOFTBARRIER|REQ_HARDBARRIER|REQ_STARTED))
 			break;
 		if (rq->sector >= boundary) {

