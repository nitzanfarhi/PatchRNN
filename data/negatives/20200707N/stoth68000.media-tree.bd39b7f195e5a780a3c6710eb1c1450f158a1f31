commit bd39b7f195e5a780a3c6710eb1c1450f158a1f31
Author: Chris Humbert <mahadri-kernel@drigon.com>
Date:   Mon Nov 28 09:29:23 2005 -0800

    [PATCH] USB: don't allocate dma pools for PIO HCDs
    
    USB: don't allocate dma pools for PIO HCDs
    
    hcd_buffer_alloc() and hcd_buffer_free() have a similar dma_mask
    check and revert to kmalloc()/kfree(), but hcd_buffer_create()
    doesn't check dma_mask and allocates unused dma pools.
    
    Signed-off-by: Chris Humbert <mahadri-kernel@drigon.com>
    Acked-by: David Brownell <david-b@pacbell.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/usb/core/buffer.c b/drivers/usb/core/buffer.c
index 419c9943a7cb..ad742cec94fa 100644
--- a/drivers/usb/core/buffer.c
+++ b/drivers/usb/core/buffer.c
@@ -55,6 +55,9 @@ int hcd_buffer_create (struct usb_hcd *hcd)
 	char		name [16];
 	int 		i, size;
 
+	if (!hcd->self.controller->dma_mask)
+		return 0;
+
 	for (i = 0; i < HCD_BUFFER_POOLS; i++) { 
 		if (!(size = pool_max [i]))
 			continue;

