commit d0ea8881d9e3b7e7e2988974c1cb996652a06e22
Author: Andreas Ericsson <ae@op5.se>
Date:   Wed Sep 12 15:36:33 2012 +0000

    core: Remove aggregate_status_updates
    
    It's been deprecated since 2008, so the gracetime was about three
    years longer than anyone could possibly need.
    
    Signed-off-by: Andreas Ericsson <ae@op5.se>
    
    git-svn-id: https://nagios.svn.sourceforge.net/svnroot/nagios/nagioscore/trunk@2184 5f96b256-904b-4d8d-8c98-d829582c6739

diff --git a/base/config.c b/base/config.c
index 5647797a..d9c9670a 100644
--- a/base/config.c
+++ b/base/config.c
@@ -949,14 +949,6 @@ int read_main_config_file(char *main_config_file) {
 				}
 			}
 
-		else if(!strcmp(variable, "aggregate_status_updates")) {
-
-			/* DEPRECATED - ALL UPDATED ARE AGGREGATED AS OF NAGIOS 3.X */
-			/*aggregate_status_updates=(atoi(value)>0)?TRUE:FALSE;*/
-
-			logit(NSLOG_CONFIG_WARNING, TRUE, "Warning: aggregate_status_updates directive ignored.  All status file updates are now aggregated.");
-			}
-
 		else if(!strcmp(variable, "status_update_interval")) {
 
 			status_update_interval = atoi(value);
diff --git a/base/events.c b/base/events.c
index 0ef20881..75368e2e 100644
--- a/base/events.c
+++ b/base/events.c
@@ -513,8 +513,7 @@ void init_timing_loop(void) {
 		schedule_new_event(EVENT_HFRESHNESS_CHECK, TRUE, current_time + host_freshness_check_interval, TRUE, host_freshness_check_interval, NULL, TRUE, NULL, NULL, 0);
 
 	/* add a status save event */
-	if(aggregate_status_updates == TRUE)
-		schedule_new_event(EVENT_STATUS_SAVE, TRUE, current_time + status_update_interval, TRUE, status_update_interval, NULL, TRUE, NULL, NULL, 0);
+	schedule_new_event(EVENT_STATUS_SAVE, TRUE, current_time + status_update_interval, TRUE, status_update_interval, NULL, TRUE, NULL, NULL, 0);
 
 	/* add a log rotation event if necessary */
 	if(log_rotation_method != LOG_ROTATION_NONE)
diff --git a/base/utils.c b/base/utils.c
index eefce48b..bf474130 100644
--- a/base/utils.c
+++ b/base/utils.c
@@ -166,7 +166,6 @@ time_t event_start = 0L;
 int translate_passive_host_checks = DEFAULT_TRANSLATE_PASSIVE_HOST_CHECKS;
 int passive_host_checks_are_soft = DEFAULT_PASSIVE_HOST_CHECKS_SOFT;
 
-int aggregate_status_updates = TRUE;
 int status_update_interval = DEFAULT_STATUS_UPDATE_INTERVAL;
 
 int time_change_threshold = DEFAULT_TIME_CHANGE_THRESHOLD;
@@ -3506,7 +3505,6 @@ int reset_variables(void) {
 	next_event_id = 1;
 	next_notification_id = 1;
 
-	aggregate_status_updates = TRUE;
 	status_update_interval = DEFAULT_STATUS_UPDATE_INTERVAL;
 
 	event_broker_options = BROKER_NOTHING;
diff --git a/common/statusdata.c b/common/statusdata.c
index 1db66687..58093f43 100644
--- a/common/statusdata.c
+++ b/common/statusdata.c
@@ -42,10 +42,6 @@
 #endif
 
 
-#ifdef NSCORE
-extern int      aggregate_status_updates;
-#endif
-
 #ifdef NSCGI
 hoststatus      *hoststatus_list = NULL;
 hoststatus      *hoststatus_list_tail = NULL;
@@ -128,12 +124,6 @@ int update_program_status(int aggregated_dump) {
 		broker_program_status(NEBTYPE_PROGRAMSTATUS_UPDATE, NEBFLAG_NONE, NEBATTR_NONE, NULL);
 #endif
 
-	/* currently a noop if aggregated updates is TRUE */
-
-	/* update all status data if we're not aggregating updates */
-	if(aggregate_status_updates == FALSE)
-		update_all_status_data();
-
 	return OK;
 	}
 
@@ -148,12 +138,6 @@ int update_host_status(host *hst, int aggregated_dump) {
 		broker_host_status(NEBTYPE_HOSTSTATUS_UPDATE, NEBFLAG_NONE, NEBATTR_NONE, hst, NULL);
 #endif
 
-	/* currently a noop if aggregated updates is TRUE */
-
-	/* update all status data if we're not aggregating updates */
-	if(aggregate_status_updates == FALSE)
-		update_all_status_data();
-
 	return OK;
 	}
 
@@ -168,12 +152,6 @@ int update_service_status(service *svc, int aggregated_dump) {
 		broker_service_status(NEBTYPE_SERVICESTATUS_UPDATE, NEBFLAG_NONE, NEBATTR_NONE, svc, NULL);
 #endif
 
-	/* currently a noop if aggregated updates is TRUE */
-
-	/* update all status data if we're not aggregating updates */
-	if(aggregate_status_updates == FALSE)
-		update_all_status_data();
-
 	return OK;
 	}
 
@@ -188,12 +166,6 @@ int update_contact_status(contact *cntct, int aggregated_dump) {
 		broker_contact_status(NEBTYPE_CONTACTSTATUS_UPDATE, NEBFLAG_NONE, NEBATTR_NONE, cntct, NULL);
 #endif
 
-	/* currently a noop if aggregated updates is TRUE */
-
-	/* update all status data if we're not aggregating updates */
-	if(aggregate_status_updates == FALSE)
-		update_all_status_data();
-
 	return OK;
 	}
 #endif
diff --git a/include/nagios.h b/include/nagios.h
index 0524832f..fa8ef7c8 100644
--- a/include/nagios.h
+++ b/include/nagios.h
@@ -171,7 +171,6 @@ extern int process_performance_data;
 extern int translate_passive_host_checks;
 extern int passive_host_checks_are_soft;
 
-extern int aggregate_status_updates;
 extern int status_update_interval;
 
 extern int time_change_threshold;
diff --git a/t-tap/test-stubs.c b/t-tap/test-stubs.c
index dc66b764..91a51ced 100644
--- a/t-tap/test-stubs.c
+++ b/t-tap/test-stubs.c
@@ -41,7 +41,6 @@ int      retention_update_interval;
 int      max_parallel_service_checks;
 int      currently_running_service_checks;
 
-int      aggregate_status_updates;
 int      status_update_interval;
 
 int      log_rotation_method;
diff --git a/t-tap/test_events.c b/t-tap/test_events.c
index 0dd27c6f..a37f72c2 100644
--- a/t-tap/test_events.c
+++ b/t-tap/test_events.c
@@ -65,7 +65,6 @@ int      retention_update_interval;
 int      max_parallel_service_checks;
 int      currently_running_service_checks;
 
-int      aggregate_status_updates;
 int      status_update_interval;
 
 int      log_rotation_method;
diff --git a/t-tap/test_nagios_config.c b/t-tap/test_nagios_config.c
index 84a82c6a..31b34fca 100644
--- a/t-tap/test_nagios_config.c
+++ b/t-tap/test_nagios_config.c
@@ -190,7 +190,6 @@ int             obsess_over_hosts = FALSE;
 int             translate_passive_host_checks = DEFAULT_TRANSLATE_PASSIVE_HOST_CHECKS;
 int             passive_host_checks_are_soft = DEFAULT_PASSIVE_HOST_CHECKS_SOFT;
 
-int             aggregate_status_updates = TRUE;
 int             status_update_interval = DEFAULT_STATUS_UPDATE_INTERVAL;
 
 int             time_change_threshold = DEFAULT_TIME_CHANGE_THRESHOLD;
diff --git a/t-tap/test_timeperiods.c b/t-tap/test_timeperiods.c
index 3a7ed92f..e59f4e3e 100644
--- a/t-tap/test_timeperiods.c
+++ b/t-tap/test_timeperiods.c
@@ -190,7 +190,6 @@ int             obsess_over_hosts = FALSE;
 int             translate_passive_host_checks = DEFAULT_TRANSLATE_PASSIVE_HOST_CHECKS;
 int             passive_host_checks_are_soft = DEFAULT_PASSIVE_HOST_CHECKS_SOFT;
 
-int             aggregate_status_updates = TRUE;
 int             status_update_interval = DEFAULT_STATUS_UPDATE_INTERVAL;
 
 int             time_change_threshold = DEFAULT_TIME_CHANGE_THRESHOLD;

