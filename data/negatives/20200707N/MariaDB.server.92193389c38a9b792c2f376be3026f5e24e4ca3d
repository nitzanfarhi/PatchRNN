commit 92193389c38a9b792c2f376be3026f5e24e4ca3d
Author: marko <Unknown>
Date:   Tue Feb 20 11:30:13 2007 +0000

    branches/zip: btr_cur_optimistic_insert(): If btr_page_reorganize()
    fails, reset the insert buffer free bits for the page.

diff --git a/btr/btr0cur.c b/btr/btr0cur.c
index 2f37789321a..4d93f82cb65 100644
--- a/btr/btr0cur.c
+++ b/btr/btr0cur.c
@@ -1170,6 +1170,8 @@ btr_cur_optimistic_insert(
 		if (UNIV_UNLIKELY(!btr_page_reorganize(block, index, mtr))) {
 			ut_a(buf_block_get_page_zip(block));
 
+			ibuf_reset_free_bits_with_type(index->type, block);
+
 			goto fail;
 		}
 

