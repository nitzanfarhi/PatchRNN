commit 3ca81a55256f38d9a8a4d5e9a6a9288ddc672e19
Author: Hans Verkuil <hverkuil@xs4all.nl>
Date:   Tue Dec 16 08:32:37 2008 -0300

    V4L/DVB (9906): v4l2-compat: test for unlocked_ioctl as well.
    
    The v4l_compat_ioctl32() function only tested for the presence of the
    ioctl op, not for unlocked_ioctl. So it would always return an error
    when used with drivers that use unlocked_ioctl instead of ioctl.
    
    Signed-off-by: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

diff --git a/drivers/media/video/compat_ioctl32.c b/drivers/media/video/compat_ioctl32.c
index e6ca4012b5f0..0ea85a05e5c0 100644
--- a/drivers/media/video/compat_ioctl32.c
+++ b/drivers/media/video/compat_ioctl32.c
@@ -831,7 +831,7 @@ long v4l_compat_ioctl32(struct file *file, unsigned int cmd, unsigned long arg)
 {
 	int ret = -ENOIOCTLCMD;
 
-	if (!file->f_op->ioctl)
+	if (!file->f_op->ioctl && !file->f_op->unlocked_ioctl)
 		return ret;
 
 	switch (cmd) {

