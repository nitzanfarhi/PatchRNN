commit 8552d85442dd814d733f67592627ea55f7cbfb01
Author: Mitch Williams <mitch.a.williams@intel.com>
Date:   Mon Aug 31 19:54:51 2015 -0400

    i40evf: don't blow away MAC address
    
    Under certain circumstances, we can get an extra VF_RESOURCES message
    from the PF driver at runtime. When this happens, we need to parse it
    because our VSI may have changed out from underneath us, and that will
    affect our relationship with the PF driver.
    
    However, parsing the resources message also blows away our current MAC
    address in the hardware struct, usually with all zeros. When this
    happens, the next time the interface is opened, it will have no MAC
    address and will a) not work and b) complain.
    
    Fix this issue by restoring the current MAC address from the netdev
    struct after we parse the resource message.
    
    Change-ID: I6cd1b624fc20432f81dc901166c8de195b8e0e65
    Signed-off-by: Mitch Williams <mitch.a.williams@intel.com>
    Tested-by: Andrew Bowers <andrewx.bowers@intel.com>
    Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>

diff --git a/drivers/net/ethernet/intel/i40evf/i40evf_virtchnl.c b/drivers/net/ethernet/intel/i40evf/i40evf_virtchnl.c
index d4eb1a5e7d42..fbf2a1c86c1c 100644
--- a/drivers/net/ethernet/intel/i40evf/i40evf_virtchnl.c
+++ b/drivers/net/ethernet/intel/i40evf/i40evf_virtchnl.c
@@ -756,6 +756,8 @@ void i40evf_virtchnl_completion(struct i40evf_adapter *adapter,
 			  sizeof(struct i40e_virtchnl_vsi_resource);
 		memcpy(adapter->vf_res, msg, min(msglen, len));
 		i40e_vf_parse_hw_config(&adapter->hw, adapter->vf_res);
+		/* restore current mac address */
+		ether_addr_copy(adapter->hw.mac.addr, netdev->dev_addr);
 		i40evf_process_config(adapter);
 		}
 		break;

