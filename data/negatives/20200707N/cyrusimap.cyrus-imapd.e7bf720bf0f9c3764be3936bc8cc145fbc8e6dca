commit e7bf720bf0f9c3764be3936bc8cc145fbc8e6dca
Author: Bron Gondwana <brong@opera.com>
Date:   Sun Jan 27 23:54:24 2013 +1100

    mboxevent: protect against disabled events in add_flags

diff --git a/imap/mboxevent.c b/imap/mboxevent.c
index e82ac4b71..144460433 100644
--- a/imap/mboxevent.c
+++ b/imap/mboxevent.c
@@ -525,6 +525,9 @@ void mboxevent_add_flags(struct mboxevent *event, char *flagnames[MAX_USER_FLAGS
 #ifdef ENABLE_MBOXEVENT
     unsigned flag, flagmask;
 
+    if (!event)
+	return;
+
     /* add system flags */
     if (system_flags & FLAG_DELETED) {
 	if (strarray_find_case(excluded_flags, "\\Deleted", 0) < 0)
@@ -1071,6 +1074,9 @@ static int filled_params(enum event_type type, struct mboxevent *event)
     struct buf missing = BUF_INITIALIZER;
     int param, ret = 1;
 
+    if (!event)
+	return 0;
+
     for (param = 0; param <= MAX_PARAM; param++) {
 
 	if (mboxevent_expected_param(type, param) &&

