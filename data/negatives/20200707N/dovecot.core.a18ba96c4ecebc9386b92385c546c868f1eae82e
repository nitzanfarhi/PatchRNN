commit a18ba96c4ecebc9386b92385c546c868f1eae82e
Author: Timo Sirainen <timo.sirainen@dovecot.fi>
Date:   Tue Jun 21 18:30:20 2016 +0300

    doveadm: Fixed --long-parameters handling

diff --git a/src/doveadm/doveadm-cmd.c b/src/doveadm/doveadm-cmd.c
index 5f5cf04e1..05f9cdc40 100644
--- a/src/doveadm/doveadm-cmd.c
+++ b/src/doveadm/doveadm-cmd.c
@@ -377,18 +377,17 @@ doveadm_build_options(const struct doveadm_cmd_param par[],
 {
 	for(size_t i=0; par[i].name != NULL; i++) {
 		struct option longopt;
+
+		memset(&longopt, 0, sizeof(longopt));
 		longopt.name = par[i].name;
-		longopt.flag = 0;
-		longopt.val = 0;
 		if (par[i].short_opt != '\0') {
 			longopt.val = par[i].short_opt;
 			str_append_c(shortopts, par[i].short_opt);
 			if (par[i].type != CMD_PARAM_BOOL)
 				str_append_c(shortopts, ':');
-		} else {
-			if (par[i].type != CMD_PARAM_BOOL) longopt.has_arg = 1;
-			else longopt.has_arg = 0;
 		}
+		if (par[i].type != CMD_PARAM_BOOL)
+			longopt.has_arg = 1;
 		array_append(longopts, &longopt, 1);
 	}
 	array_append_zero(longopts);

