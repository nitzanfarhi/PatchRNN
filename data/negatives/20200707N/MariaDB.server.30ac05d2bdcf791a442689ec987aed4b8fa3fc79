commit 30ac05d2bdcf791a442689ec987aed4b8fa3fc79
Author: marko <>
Date:   Fri Nov 24 08:39:53 2006 +0000

    branches/zip: buf_read_ahead_random(): Stop searching upon exceeding the
    threshold.

diff --git a/buf/buf0rea.c b/buf/buf0rea.c
index f9e8527be51..eb640ef63bd 100644
--- a/buf/buf0rea.c
+++ b/buf/buf0rea.c
@@ -236,21 +236,24 @@ buf_read_ahead_random(
 		block = buf_page_hash_get(space, i);
 
 		if ((block)
-		    && (block->LRU_position > LRU_recent_limit)
-		    && block->accessed) {
+		    && block->accessed
+		    && (block->LRU_position > LRU_recent_limit)) {
 
 			recent_blocks++;
+
+			if (recent_blocks >= BUF_READ_AHEAD_RANDOM_THRESHOLD) {
+
+				mutex_exit(&buf_pool->mutex);
+				goto read_ahead;
+			}
 		}
 	}
 
 	mutex_exit(&(buf_pool->mutex));
+	/* Do nothing */
+	return(0);
 
-	if (recent_blocks < BUF_READ_AHEAD_RANDOM_THRESHOLD) {
-		/* Do nothing */
-
-		return(0);
-	}
-
+read_ahead:
 	/* Read all the suitable blocks within the area */
 
 	if (ibuf_inside()) {

