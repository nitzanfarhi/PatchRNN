commit 26e6385f14b991e30450daee4348cbbc4bc4bb09
Author: David S. Miller <davem@sunset.davemloft.net>
Date:   Thu May 10 02:16:27 2007 -0700

    [SPARC64]: Use alloc_pci_dev() in PCI bus probes.
    
    Otherwise MSI explodes because pci_msi_init_pci_dev() does not
    get invoked.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/arch/sparc64/kernel/pci.c b/arch/sparc64/kernel/pci.c
index d85e1ed7c3e4..cf9a75112d0f 100644
--- a/arch/sparc64/kernel/pci.c
+++ b/arch/sparc64/kernel/pci.c
@@ -377,7 +377,7 @@ struct pci_dev *of_create_pci_dev(struct pci_pbm_info *pbm,
 	const char *type;
 	u32 class;
 
-	dev = kzalloc(sizeof(struct pci_dev), GFP_KERNEL);
+	dev = alloc_pci_dev();
 	if (!dev)
 		return NULL;
 

