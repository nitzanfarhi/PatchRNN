commit acdb62966fc2dfa2d6f6a56f643774b399c37d18
Author: Andreas Ericsson <ae@op5.se>
Date:   Thu Jul 18 15:47:45 2013 +0200

    xdata/xodtemplate: Fix processing of servicelists for serviceextinfo
    
    This patch fixes two issues with service lookups for serviceextinfo
    objects.
    
    Firstly, we fix parameters to xodtemplate_create_service_list(),
    which were previously warped so that we shipped the hostgroup_name
    as the host_name and vice versa.
    
    Secondly, we reset the master_service_list and service_map for each
    iteration to make sure the serviceextinfo isn't set for more objects
    than it should be. This second part only matters if there's more
    than one serviceextinfo object (which is usually the case if one
    uses such deprecated constructs).
    
    Even though serviceextinfo objects are deprecated, we should still
    handle them properly if we encounter them.
    
    Original-patch-by: Ricardo Maraschini <ricardo.maraschini@gmail.com>
    Commit-message-by: Andreas Ericsson <ae@op5.se>
    Signed-off-by: Ricardo Maraschini <ricardo.maraschini@gmail.com>
    Signed-off-by: Andreas Ericsson <ae@op5.se>

diff --git a/xdata/xodtemplate.c b/xdata/xodtemplate.c
index 2aefb2f6..a9b9d9d3 100644
--- a/xdata/xodtemplate.c
+++ b/xdata/xodtemplate.c
@@ -4363,9 +4363,11 @@ int xodtemplate_duplicate_objects(void) {
 		if(temp_serviceextinfo->hostgroup_name == NULL && temp_serviceextinfo->host_name == NULL)
 			continue;
 
-		/* get list of hosts */
-		if(xodtemplate_create_service_list(&master_servicelist, service_map, temp_serviceextinfo->hostgroup_name, temp_serviceextinfo->host_name, NULL, temp_serviceextinfo->service_description, temp_serviceextinfo->_config_file, temp_serviceextinfo->_start_line) != OK) {
-			logit(NSLOG_CONFIG_ERROR, TRUE, "Error: Could not expand hostgroups and/or hosts specified in extended service info (config file '%s', starting on line %d)\n", xodtemplate_config_file_name(temp_serviceextinfo->_config_file), temp_serviceextinfo->_start_line);
+		master_servicelist = NULL;
+
+		/* get list of services */
+		if(xodtemplate_create_service_list(&master_servicelist, service_map, temp_serviceextinfo->host_name, temp_serviceextinfo->hostgroup_name, NULL, temp_serviceextinfo->service_description, temp_serviceextinfo->_config_file, temp_serviceextinfo->_start_line) != OK) {
+			logit(NSLOG_CONFIG_ERROR, TRUE, "Error: Could not expand services specified in extended service info (config file '%s', starting on line %d)\n", xodtemplate_config_file_name(temp_serviceextinfo->_config_file), temp_serviceextinfo->_start_line);
 			return ERROR;
 			}
 

