commit bca5c2c550f16d2dc2d21ffb7b4712bd0a7d32a9
Author: Andres Salomon <dilinger@queued.net>
Date:   Sat Jul 12 13:47:54 2008 -0700

    ov7670: clean up ov7670_read semantics
    
    Cortland Setlow pointed out a bug in ov7670.c where the result from
    ov7670_read() was just being checked for !0, rather than <0.  This made me
    realize that ov7670_read's semantics were rather confusing; it both fills
    in 'value' with the result, and returns it.  This is goes against general
    kernel convention; so rather than fixing callers, let's fix the function.
    
    This makes ov7670_read return <0 in the case of an error, and 0 upon
    success. Thus, code like:
    
    res = ov7670_read(...);
    if (!res)
            goto error;
    
    ..will work properly.
    
    Signed-off-by: Cortland Setlow <csetlow@tower-research.com>
    Signed-off-by: Andres Salomon <dilinger@debian.org>
    Acked-by: Jonathan Corbet <corbet@lwn.net>
    Cc: <stable@kernel.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/media/video/ov7670.c b/drivers/media/video/ov7670.c
index 2bc6bdc9c1f2..d7bfd30f74a9 100644
--- a/drivers/media/video/ov7670.c
+++ b/drivers/media/video/ov7670.c
@@ -406,8 +406,10 @@ static int ov7670_read(struct i2c_client *c, unsigned char reg,
 	int ret;
 
 	ret = i2c_smbus_read_byte_data(c, reg);
-	if (ret >= 0)
+	if (ret >= 0) {
 		*value = (unsigned char) ret;
+		ret = 0;
+	}
 	return ret;
 }
 

