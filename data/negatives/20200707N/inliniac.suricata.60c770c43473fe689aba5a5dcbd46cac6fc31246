commit 60c770c43473fe689aba5a5dcbd46cac6fc31246
Author: Anoop Saldanha <poonaatsoc@gmail.com>
Date:   Mon Jul 26 20:40:10 2010 +0530

    make pcre respect discontinue_matching flag in content matching functions

diff --git a/src/detect-engine-dcepayload.c b/src/detect-engine-dcepayload.c
index de39e9f5..3d076f4d 100644
--- a/src/detect-engine-dcepayload.c
+++ b/src/detect-engine-dcepayload.c
@@ -313,6 +313,9 @@ static int DoInspectDcePayload(DetectEngineCtx *de_ctx,
                     SCReturnInt(1);
                 }
 
+                if (det_ctx->discontinue_matching)
+                    SCReturnInt(0);
+
                 det_ctx->payload_offset = prev_payload_offset;
                 det_ctx->pcre_match_start_offset = prev_offset;
             } while (1);
diff --git a/src/detect-engine-payload.c b/src/detect-engine-payload.c
index e22164ca..fade78a0 100644
--- a/src/detect-engine-payload.c
+++ b/src/detect-engine-payload.c
@@ -287,6 +287,9 @@ static int DoInspectPacketPayload(DetectEngineCtx *de_ctx,
                     SCReturnInt(1);
                 }
 
+                if (det_ctx->discontinue_matching)
+                    SCReturnInt(0);
+
                 det_ctx->payload_offset = prev_payload_offset;
                 det_ctx->pcre_match_start_offset = prev_offset;
             } while (1);
diff --git a/src/detect-engine-uri.c b/src/detect-engine-uri.c
index 8a01b088..4be69308 100644
--- a/src/detect-engine-uri.c
+++ b/src/detect-engine-uri.c
@@ -270,6 +270,9 @@ static int DoInspectPacketUri(DetectEngineCtx *de_ctx,
                 SCReturnInt(1);
             }
 
+            if (det_ctx->discontinue_matching)
+                SCReturnInt(0);
+
             det_ctx->payload_offset = prev_payload_offset;
             det_ctx->pcre_match_start_offset = prev_offset;
         } while (1);

