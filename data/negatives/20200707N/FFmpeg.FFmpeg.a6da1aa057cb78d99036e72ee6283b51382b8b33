commit a6da1aa057cb78d99036e72ee6283b51382b8b33
Author: David Conrad <lessen42@gmail.com>
Date:   Wed Sep 5 00:25:14 2007 +0000

    Use sample format for bit depth if av_get_bits_per_sample() doesn't give one
    
    Originally committed as revision 10362 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavformat/matroskaenc.c b/libavformat/matroskaenc.c
index 294f98f257..c1d591f734 100644
--- a/libavformat/matroskaenc.c
+++ b/libavformat/matroskaenc.c
@@ -498,6 +498,9 @@ static int mkv_write_tracks(AVFormatContext *s)
         int sample_rate = codec->sample_rate;
         int output_sample_rate = 0;
 
+        if (!bit_depth)
+            bit_depth = av_get_bits_per_sample_format(codec->sample_fmt);
+
         if (codec->codec_id == CODEC_ID_AAC)
             get_aac_sample_rates(codec, &sample_rate, &output_sample_rate);
 

