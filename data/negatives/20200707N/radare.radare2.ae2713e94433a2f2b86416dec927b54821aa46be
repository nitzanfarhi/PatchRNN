commit ae2713e94433a2f2b86416dec927b54821aa46be
Author: pancake <pancake@nopcode.org>
Date:   Wed Sep 23 15:23:36 2015 +0200

    Fix PE regression

diff --git a/libr/bin/format/pe/pe.c b/libr/bin/format/pe/pe.c
index 2cff9c0d2..9db363349 100644
--- a/libr/bin/format/pe/pe.c
+++ b/libr/bin/format/pe/pe.c
@@ -1334,7 +1334,7 @@ static PE_VS_VERSIONINFO *Pe_r_bin_pe_parse_version_info(struct PE_(r_bin_pe_obj
 		return NULL;
 	}
 
-	if (r_buf_read_at(bin->b, curAddr, (ut8*)vs_VersionInfo->szKey, VS_VERSION_INFO_UTF_16_LEN) != VS_VERSION_INFO_UTF_16_LEN) {
+	if (r_buf_read_at (bin->b, curAddr, (ut8*)vs_VersionInfo->szKey, VS_VERSION_INFO_UTF_16_LEN) != VS_VERSION_INFO_UTF_16_LEN) {
 		eprintf ("Error: read (VS_VERSIONINFO szKey)\n");
 		free_VS_VERSIONINFO(vs_VersionInfo);
 		return NULL;
@@ -1350,20 +1350,21 @@ static PE_VS_VERSIONINFO *Pe_r_bin_pe_parse_version_info(struct PE_(r_bin_pe_obj
 	align32 (curAddr);
 
 	if (vs_VersionInfo->wValueLength) {
-		if (vs_VersionInfo->wValueLength != sizeof(*vs_VersionInfo->Value)) {
+		if (vs_VersionInfo->wValueLength != sizeof (*vs_VersionInfo->Value)) {
 			eprintf ("Error: check (VS_VERSIONINFO wValueLength != sizeof PE_VS_FIXEDFILEINFO)\n");
-			free_VS_VERSIONINFO(vs_VersionInfo);
+			free_VS_VERSIONINFO (vs_VersionInfo);
 			return NULL;
 		}
 
 		vs_VersionInfo->Value = (PE_VS_FIXEDFILEINFO *) malloc (sizeof(*vs_VersionInfo->Value));
 		if (vs_VersionInfo->Value == NULL) {
 			eprintf ("Error: malloc (VS_VERSIONINFO Value)\n");
-			free_VS_VERSIONINFO(vs_VersionInfo);
+			free_VS_VERSIONINFO (vs_VersionInfo);
 			return NULL;
 		}
 
-		if (r_buf_read_at(bin->b, curAddr, (ut8*)vs_VersionInfo->Value, sizeof(*vs_VersionInfo->Value)) != sizeof(*vs_VersionInfo->Value)) {
+		const int sz = sizeof(*vs_VersionInfo->Value);
+		if (r_buf_read_at (bin->b, curAddr, (ut8*)vs_VersionInfo->Value, sz) != sz) {
 			eprintf ("Error: read (VS_VERSIONINFO Value)\n");
 			free_VS_VERSIONINFO(vs_VersionInfo);
 			return NULL;
diff --git a/libr/bin/format/pe/pe_specs.h b/libr/bin/format/pe/pe_specs.h
index 78863d660..57632039b 100644
--- a/libr/bin/format/pe/pe_specs.h
+++ b/libr/bin/format/pe/pe_specs.h
@@ -399,10 +399,10 @@ typedef struct {
 #define VARFILEINFO_UTF_16     "V\0a\0r\0F\0i\0l\0e\0I\0n\0f\0o\0\0"
 #define VS_VERSION_INFO_UTF_16 "V\0S\0_\0V\0E\0R\0S\0I\0O\0N\0_\0I\0N\0F\0O\0\0"
 
-#define STRINGFILEINFO_UTF_16_LEN  23
-#define TRANSLATION_UTF_16_LEN     12
-#define VARFILEINFO_UTF_16_LEN     12
-#define VS_VERSION_INFO_UTF_16_LEN 25
+#define STRINGFILEINFO_UTF_16_LEN  sizeof (STRINGFILEINFO_UTF_16)
+#define TRANSLATION_UTF_16_LEN     sizeof (TRANSLATION_UTF_16)
+#define VARFILEINFO_UTF_16_LEN     sizeof (VARFILEINFO_UTF_16)
+#define VS_VERSION_INFO_UTF_16_LEN sizeof (VS_VERSION_INFO_UTF_16)
 
 typedef struct {
 	ut16 wLength; //The length, in bytes, of this String structure.

