commit 649f6dfb5d9108ea4caebe7589ac84fd5a0f2686
Author: Allen Lai <zheng.lai@oracle.com>
Date:   Thu Mar 24 16:01:32 2016 +0800

    Bug#22897921 TDE: BLOCKING ONLINE DDL(INPLACE) ,WHICH OTHERWISE ALLOWED IN 5.7
    
    Followup patch for fixing UBSAN test failure.

diff --git a/storage/innobase/handler/handler0alter.cc b/storage/innobase/handler/handler0alter.cc
index b06c053bd72..dce7a9cbf0c 100644
--- a/storage/innobase/handler/handler0alter.cc
+++ b/storage/innobase/handler/handler0alter.cc
@@ -553,9 +553,11 @@ ha_innobase::check_if_supported_inplace_alter(
 
 	/* We don't support change encryption attribute with
 	inplace algorithm. */
-	if (strncmp(this->table->s->encrypt_type.str,
-			altered_table->s->encrypt_type.str,
-			altered_table->s->encrypt_type.length) != 0) {
+	char*	old_encryption = this->table->s->encrypt_type.str;
+	char*	new_encryption = altered_table->s->encrypt_type.str;
+
+	if (Encryption::is_none(old_encryption)
+	    != Encryption::is_none(new_encryption)) {
 		ha_alter_info->unsupported_reason =
 			innobase_get_err_msg(
 				ER_UNSUPPORTED_ALTER_ENCRYPTION_INPLACE);

