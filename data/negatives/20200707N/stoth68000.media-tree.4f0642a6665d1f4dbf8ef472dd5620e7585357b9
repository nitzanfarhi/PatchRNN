commit 4f0642a6665d1f4dbf8ef472dd5620e7585357b9
Author: Wey-Yi Guy <wey-yi.w.guy@intel.com>
Date:   Mon Jun 6 16:28:54 2011 -0700

    iwlagn: Sanity check for 11n capability
    
    Make sure when we say 11n enable, we really support it.
    
    Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>

diff --git a/drivers/net/wireless/iwlwifi/iwl-agn-eeprom.c b/drivers/net/wireless/iwlwifi/iwl-agn-eeprom.c
index 512d8beb3dfd..7745816eaff4 100644
--- a/drivers/net/wireless/iwlwifi/iwl-agn-eeprom.c
+++ b/drivers/net/wireless/iwlwifi/iwl-agn-eeprom.c
@@ -113,6 +113,11 @@ int iwl_eeprom_check_sku(struct iwl_priv *priv)
 	if (!priv->cfg->sku) {
 		/* not using sku overwrite */
 		priv->cfg->sku = iwl_eeprom_query16(priv, EEPROM_SKU_CAP);
+		if (priv->cfg->sku & EEPROM_SKU_CAP_11N_ENABLE &&
+		    !priv->cfg->ht_params) {
+			IWL_ERR(priv, "Invalid 11n configuration\n");
+			return -EINVAL;
+		}
 	}
 	if (!priv->cfg->sku) {
 		IWL_ERR(priv, "Invalid device sku\n");

