commit c3b3f16d1bceb5ac5f21528f889810b4ac5a3596
Author: Daniel De Graaf <dgdegra@tycho.nsa.gov>
Date:   Mon Nov 28 11:49:09 2011 -0500

    xen/events: prevent calling evtchn_get on invalid channels
    
    The event channel number provided to evtchn_get can be provided by
    userspace, so needs to be checked against the maximum number of event
    channels prior to using it to index into evtchn_to_irq.
    
    Signed-off-by: Daniel De Graaf <dgdegra@tycho.nsa.gov>
    Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

diff --git a/drivers/xen/events.c b/drivers/xen/events.c
index a3bcd6175f4a..e5e5812a1014 100644
--- a/drivers/xen/events.c
+++ b/drivers/xen/events.c
@@ -1104,6 +1104,9 @@ int evtchn_get(unsigned int evtchn)
 	struct irq_info *info;
 	int err = -ENOENT;
 
+	if (evtchn >= NR_EVENT_CHANNELS)
+		return -EINVAL;
+
 	mutex_lock(&irq_mapping_update_lock);
 
 	irq = evtchn_to_irq[evtchn];

