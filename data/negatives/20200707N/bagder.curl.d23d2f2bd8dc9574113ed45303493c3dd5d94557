commit d23d2f2bd8dc9574113ed45303493c3dd5d94557
Author: Steve Holme <steve_holme@hotmail.com>
Date:   Sun Feb 24 19:23:33 2013 +0000

    imap: Added check for new internal imap response code

diff --git a/lib/imap.c b/lib/imap.c
index 0c0154824..5d94548a3 100644
--- a/lib/imap.c
+++ b/lib/imap.c
@@ -1283,6 +1283,10 @@ static CURLcode imap_statemach_act(struct connectdata *conn)
   if(result)
     return result;
 
+  /* Was there an error parsing the response line? */
+  if(imapcode == -1)
+    return CURLE_FTP_WEIRD_SERVER_REPLY;
+
   if(imapcode) {
     /* We have now received a full IMAP server response */
     switch(imapc->state) {

