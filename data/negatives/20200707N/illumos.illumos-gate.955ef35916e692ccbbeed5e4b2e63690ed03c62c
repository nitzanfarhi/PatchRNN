commit 955ef35916e692ccbbeed5e4b2e63690ed03c62c
Author: Lin Ling <Lin.Ling@Sun.COM>
Date:   Thu Jun 10 11:29:20 2010 -0700

    6951283 hotspare_import_001_pos FAILs unless doing a sync before detach

diff --git a/usr/src/uts/common/fs/zfs/spa.c b/usr/src/uts/common/fs/zfs/spa.c
index d7c5de0d35..69f75766a3 100644
--- a/usr/src/uts/common/fs/zfs/spa.c
+++ b/usr/src/uts/common/fs/zfs/spa.c
@@ -3228,6 +3228,8 @@ spa_import(const char *pool, nvlist_t *config, nvlist_t *props)
 		return (error);
 	}
 
+	spa_async_resume(spa);
+
 	/*
 	 * Override any spares and level 2 cache devices as specified by
 	 * the user, as these may have correct device names/devids, etc.
@@ -3278,8 +3280,6 @@ spa_import(const char *pool, nvlist_t *config, nvlist_t *props)
 		spa_config_update(spa, SPA_CONFIG_UPDATE_POOL);
 	}
 
-	spa_async_resume(spa);
-
 	/*
 	 * It's possible that the pool was expanded while it was exported.
 	 * We kick off an async task to handle this for us.

