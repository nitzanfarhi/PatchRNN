commit aa8d9dbe855c8b8d8f23f6d7796b9094b46cfe45
Author: Andrew Cagney <cagney@gnu.org>
Date:   Wed Apr 5 17:59:34 2017 -0400

    ikev2: reject SKF payloads when the remote never negotiated them

diff --git a/programs/pluto/ikev2.c b/programs/pluto/ikev2.c
index cc1536fb0..da7024404 100644
--- a/programs/pluto/ikev2.c
+++ b/programs/pluto/ikev2.c
@@ -713,6 +713,11 @@ static bool ikev2_check_fragment(struct msg_digest *md)
 			"discarding IKE encrypted fragment - fragmentation not allowed by local policy (ike_frag=no)"));
 		return FALSE;
 	}
+	if (!(st->st_seen_fragvid)) {
+		DBG(DBG_CONTROL, DBG_log(
+			    "discarding IKE encrypted fragment - remote never proposed fragmentation"));
+		return FALSE;
+	}
 
 	DBG(DBG_CONTROL, DBG_log(
 		"received IKE encrypted fragment number '%u', total number '%u', next payload '%u'",

