commit 47d531af5faac1df8dedeb383867850ab430f0a1
Author: Michael Wallner <mike@php.net>
Date:   Fri Oct 14 09:08:43 2005 +0000

    - unset the time condition option in curl properly if we unset the lastmodified option

diff --git a/http_request_api.c b/http_request_api.c
index 615958c..777fd7b 100644
--- a/http_request_api.c
+++ b/http_request_api.c
@@ -542,8 +542,13 @@ PHP_HTTP_API STATUS _http_request_init(CURL *ch, http_request_method meth, char
 
 	/* lastmodified */
 	if (zoption = http_curl_getopt(options, "lastmodified", IS_LONG)) {
-		HTTP_CURL_OPT(TIMECONDITION, range_req ? CURL_TIMECOND_IFUNMODSINCE : CURL_TIMECOND_IFMODSINCE);
-		HTTP_CURL_OPT(TIMEVALUE, Z_LVAL_P(zoption));
+		if (Z_LVAL_P(zoption) > 0) {
+			HTTP_CURL_OPT(TIMECONDITION, range_req ? CURL_TIMECOND_IFUNMODSINCE : CURL_TIMECOND_IFMODSINCE);
+			HTTP_CURL_OPT(TIMEVALUE, Z_LVAL_P(zoption));
+		} else {
+			HTTP_CURL_OPT(TIMECONDITION, CURL_TIMECOND_NONE);
+			HTTP_CURL_OPT(TIMEVALUE, 0);
+		}
 	}
 
 	/* timeout, defaults to 0 */

