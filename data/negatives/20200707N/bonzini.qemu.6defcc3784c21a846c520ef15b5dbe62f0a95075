commit 6defcc3784c21a846c520ef15b5dbe62f0a95075
Author: MORITA Kazutaka <morita.kazutaka@lab.ntt.co.jp>
Date:   Wed Jul 7 15:25:30 2010 +0900

    sheepdog: fix compile error on systems without TCP_CORK
    
    WIN32 is not only the system which doesn't have TCP_CORK (e.g. OS X).
    
    Signed-off-by: MORITA Kazutaka <morita.kazutaka@lab.ntt.co.jp>
    Signed-off-by: Blue Swirl <blauwirbel@gmail.com>

diff --git a/block/sheepdog.c b/block/sheepdog.c
index 69a24940aa..81aa564f26 100644
--- a/block/sheepdog.c
+++ b/block/sheepdog.c
@@ -889,7 +889,7 @@ static int aio_flush_request(void *opaque)
     return !QLIST_EMPTY(&s->outstanding_aio_head);
 }
 
-#ifdef _WIN32
+#if !defined(SOL_TCP) || !defined(TCP_CORK)
 
 static int set_cork(int fd, int v)
 {

