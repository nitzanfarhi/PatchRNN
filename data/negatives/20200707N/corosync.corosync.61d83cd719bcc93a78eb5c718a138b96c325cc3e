commit 61d83cd719bcc93a78eb5c718a138b96c325cc3e
Author: Jan Friesse <jfriesse@redhat.com>
Date:   Wed May 4 15:00:31 2011 +0200

    totemsrp: Enhance mcast failure detection
    
    memb_state_gather_enter increase stats.continuous_gather only if
    previous state was gather also. This should happen only if multicast is
    not working properly (local firewall in most cases) and not if many
    nodes joins at one time.
    
    Signed-off-by: Jan Friesse <jfriesse@redhat.com>
    Reviewed-by: Angus Salkeld <asalkeld@redhat.com>

diff --git a/exec/totemsrp.c b/exec/totemsrp.c
index d300d4ba..9f7f4340 100644
--- a/exec/totemsrp.c
+++ b/exec/totemsrp.c
@@ -1895,7 +1895,13 @@ static void memb_state_gather_enter (
 
 	instance->memb_state = MEMB_STATE_GATHER;
 	instance->stats.gather_entered++;
-	instance->stats.continuous_gather++;
+
+	if (gather_from == 3) {
+		/*
+		 * State 3 means gather, so we are continuously gathering.
+		 */
+		instance->stats.continuous_gather++;
+	}
 
 	if (instance->stats.continuous_gather > MAX_NO_CONT_GATHER) {
 		log_printf (instance->totemsrp_log_level_warning,

