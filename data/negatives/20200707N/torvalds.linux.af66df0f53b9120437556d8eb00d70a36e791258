commit af66df0f53b9120437556d8eb00d70a36e791258
Author: Thierry Escande <thierry.escande@collabora.com>
Date:   Thu Jun 16 20:24:44 2016 +0200

    NFC: digital: Set the command pending flag
    
    There is a flag in the command structure indicating that this command is
    pending. It was checked before sending the command to not send the same
    command twice but it was actually never set. This is now fixed.
    
    Signed-off-by: Thierry Escande <thierry.escande@collabora.com>
    Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>

diff --git a/net/nfc/digital_core.c b/net/nfc/digital_core.c
index 6e0b255aec66..0146e42ee28f 100644
--- a/net/nfc/digital_core.c
+++ b/net/nfc/digital_core.c
@@ -176,6 +176,8 @@ static void digital_wq_cmd(struct work_struct *work)
 		return;
 	}
 
+	cmd->pending = 1;
+
 	mutex_unlock(&ddev->cmd_lock);
 
 	if (cmd->req)

