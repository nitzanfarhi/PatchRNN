commit b4e7754ff0f88baf2a842ae0f255c297dd39572d
Author: Yehuda Sadeh <yehuda@hq.newdream.net>
Date:   Thu Sep 11 10:55:19 2008 -0700

    kclient: setxattr for virtual xattr is not allowed

diff --git a/src/kernel/inode.c b/src/kernel/inode.c
index 03e96824a6..46ad6f5c03 100644
--- a/src/kernel/inode.c
+++ b/src/kernel/inode.c
@@ -1810,6 +1810,9 @@ int ceph_setxattr(struct dentry *dentry, const char *name,
 	if (strncmp(name, "user.", 5) != 0)
 		return -EOPNOTSUPP;
 
+	if (_ceph_match_vir_xattr(name) != NULL)
+		return -EOPNOTSUPP;
+
 	/* copy value into some pages */
 	nr_pages = calc_pages_for(0, size);
 	if (nr_pages) {

