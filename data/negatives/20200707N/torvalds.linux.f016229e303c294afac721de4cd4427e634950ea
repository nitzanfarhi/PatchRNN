commit f016229e303c294afac721de4cd4427e634950ea
Author: Timo Teräs <timo.teras@iki.fi>
Date:   Mon May 27 20:46:32 2013 +0000

    ipv4: rate limit updating of next hop exceptions with same pmtu
    
    The tunnel devices call update_pmtu for each packet sent, this causes
    contention on the fnhe_lock. Ignore the pmtu update if pmtu is not
    actually changed, and there is still plenty of time before the entry
    expires.
    
    Signed-off-by: Timo Teräs <timo.teras@iki.fi>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/ipv4/route.c b/net/ipv4/route.c
index 561a37833d86..a4082be1b9b4 100644
--- a/net/ipv4/route.c
+++ b/net/ipv4/route.c
@@ -947,6 +947,10 @@ static void __ip_rt_update_pmtu(struct rtable *rt, struct flowi4 *fl4, u32 mtu)
 	if (mtu < ip_rt_min_pmtu)
 		mtu = ip_rt_min_pmtu;
 
+	if (rt->rt_pmtu == mtu &&
+	    time_before(jiffies, dst->expires - ip_rt_mtu_expires / 2))
+		return;
+
 	rcu_read_lock();
 	if (fib_lookup(dev_net(dst->dev), fl4, &res) == 0) {
 		struct fib_nh *nh = &FIB_RES_NH(res);

