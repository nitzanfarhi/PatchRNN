commit f7be59b4770a8a8b76c1d0612db409ce7e8d11f2
Author: Junio C Hamano <gitster@pobox.com>
Date:   Tue Dec 18 12:51:35 2012 -0800

    xmkstemp(): avoid showing truncated template more carefully
    
    Some implementations of xmkstemp() leaves the given in/out buffer
    truncated when they return with failure.
    
    6cf6bb3 (Improve error messages when temporary file creation fails,
    2010-12-18) attempted to show the real filename we tried to create
    (but failed), and if that is not available due to such truncation,
    to show the original template that was given by the caller.
    
    But it failed to take into account that the given template could
    have "directory/" in front, in which case the truncation point may
    not be template[0] but somewhere else.
    
    Signed-off-by: Junio C Hamano <gitster@pobox.com>

diff --git a/wrapper.c b/wrapper.c
index 68739aaa3..a066e2ee9 100644
--- a/wrapper.c
+++ b/wrapper.c
@@ -229,7 +229,7 @@ int xmkstemp(char *template)
 		int saved_errno = errno;
 		const char *nonrelative_template;
 
-		if (!template[0])
+		if (strlen(template) != strlen(origtemplate))
 			template = origtemplate;
 
 		nonrelative_template = absolute_path(template);

