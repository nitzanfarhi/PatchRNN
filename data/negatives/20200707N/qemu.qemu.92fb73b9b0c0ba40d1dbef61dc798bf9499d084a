commit 92fb73b9b0c0ba40d1dbef61dc798bf9499d084a
Author: balrog <balrog@c046a42c-6fe2-441c-8c8c-71466251a162>
Date:   Sat Dec 13 23:57:01 2008 +0000

    Fix PXA2xx framebuffer dirty checking.
    
    
    git-svn-id: svn://svn.savannah.nongnu.org/qemu/trunk@6019 c046a42c-6fe2-441c-8c8c-71466251a162

diff --git a/hw/pxa2xx_lcd.c b/hw/pxa2xx_lcd.c
index c36ff3644b..1640781eec 100644
--- a/hw/pxa2xx_lcd.c
+++ b/hw/pxa2xx_lcd.c
@@ -752,11 +752,11 @@ static void pxa2xx_lcdc_dma0_redraw_vert(struct pxa2xx_lcdc_s *s,
     addr = (ram_addr_t) (fb - phys_ram_base);
     start = addr + s->yres * src_width;
     end = addr;
+    x = addr + TARGET_PAGE_SIZE;
     dirty[0] = dirty[1] = cpu_physical_memory_get_dirty(start, VGA_DIRTY_FLAG);
     for (y = 0; y < s->yres; y ++) {
         new_addr = addr + src_width;
-        for (x = addr + TARGET_PAGE_SIZE; x < new_addr;
-                        x += TARGET_PAGE_SIZE) {
+        for (; x < new_addr; x += TARGET_PAGE_SIZE) {
             dirty[1] = cpu_physical_memory_get_dirty(x, VGA_DIRTY_FLAG);
             dirty[0] |= dirty[1];
         }

