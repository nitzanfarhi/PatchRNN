commit 934f6c3f8e7f5d6a6d07ae2df283fd02393019dd
Author: John W. Linville <linville@tuxdriver.com>
Date:   Thu Nov 6 15:49:04 2008 -0500

    Revert "ath5k: honor FIF_BCN_PRBRESP_PROMISC in STA mode"
    
    Unfortunately, the result was that mac80211 didn't see all the beacons
    it actually wanted to see.  This caused lost associations.
    
    Hopefully we can revisit this when mac80211 is less greedy about seeing
    beacons directly...
    
    This reverts commit 063279062a8c530cc90fb77797db16c49c905b26.
    
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/ath5k/base.c b/drivers/net/wireless/ath5k/base.c
index 9e47d727e220..cfd4d052d666 100644
--- a/drivers/net/wireless/ath5k/base.c
+++ b/drivers/net/wireless/ath5k/base.c
@@ -2942,8 +2942,10 @@ static void ath5k_configure_filter(struct ieee80211_hw *hw,
 		sc->opmode != NL80211_IFTYPE_MESH_POINT &&
 		test_bit(ATH_STAT_PROMISC, sc->status))
 		rfilt |= AR5K_RX_FILTER_PROM;
-	if (sc->opmode == NL80211_IFTYPE_ADHOC)
+	if (sc->opmode == NL80211_IFTYPE_STATION ||
+		sc->opmode == NL80211_IFTYPE_ADHOC) {
 		rfilt |= AR5K_RX_FILTER_BEACON;
+	}
 
 	/* Set filters */
 	ath5k_hw_set_rx_filter(ah,rfilt);

