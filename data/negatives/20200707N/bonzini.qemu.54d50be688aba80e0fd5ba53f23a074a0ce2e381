commit 54d50be688aba80e0fd5ba53f23a074a0ce2e381
Author: Luiz Capitulino <lcapitulino@redhat.com>
Date:   Mon Nov 14 11:25:09 2011 -0200

    qapi: Check for negative enum values
    
    We don't currently check for negative enum values in qmp_output_type_enum(),
    this will very likely generate a segfault when triggered.
    
    However, it _seems_ that no code in tree can trigger this today.
    
    Acked-by: Michael Roth <mdroth@linux.vnet.ibm.com>
    Signed-off-by: Luiz Capitulino <lcapitulino@redhat.com>

diff --git a/qapi/qmp-output-visitor.c b/qapi/qmp-output-visitor.c
index d67724ea4b..f76d0159cd 100644
--- a/qapi/qmp-output-visitor.c
+++ b/qapi/qmp-output-visitor.c
@@ -190,7 +190,7 @@ static void qmp_output_type_enum(Visitor *v, int *obj, const char *strings[],
 
     assert(strings);
     while (strings[i++] != NULL);
-    if (value >= i - 1) {
+    if (value < 0 || value >= i - 1) {
         error_set(errp, QERR_INVALID_PARAMETER, name ? name : "null");
         return;
     }

