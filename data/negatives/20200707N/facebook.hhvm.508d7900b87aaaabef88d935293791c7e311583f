commit 508d7900b87aaaabef88d935293791c7e311583f
Author: Max Wang <mwang@fb.com>
Date:   Wed Nov 30 15:04:58 2016 -0800

    Fix PhysRegSaver adjustment
    
    Summary:
    The previous expression was total nonsense.  Interestingly, the
    expression used before that was /also/ wrong in the presence of SIMD
    regs (but fortunately, we happen to never use SIMD regs in stubs).
    
    Reviewed By: ricklavoie
    
    Differential Revision: D4254232
    
    fbshipit-source-id: b0f5c02ba9060c74d94d0796b47db5f71bc0d104

diff --git a/hphp/runtime/vm/jit/phys-reg-saver.cpp b/hphp/runtime/vm/jit/phys-reg-saver.cpp
index 0576ed7a1b..cfa35cde4d 100644
--- a/hphp/runtime/vm/jit/phys-reg-saver.cpp
+++ b/hphp/runtime/vm/jit/phys-reg-saver.cpp
@@ -72,8 +72,9 @@ PhysRegSaver::~PhysRegSaver() {
 }
 
 size_t PhysRegSaver::dwordsPushed() const {
-  // Round up the number of regs pushed to an even number.
-  return (m_regs.size() + 1) ^ 0x1;
+  auto const gpr = m_regs & abi().gp();
+  auto const xmm = m_regs & abi().simd();
+  return 2 * xmm.size() + gpr.size() + (gpr.size() & 0x1);
 }
 
 ///////////////////////////////////////////////////////////////////////////////

