commit c72900877682b240829581e46c700e99ff1a84cf
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Aug 23 09:38:55 2004 +0300

    fix
    
    --HG--
    branch : HEAD

diff --git a/src/lib-mail/istream-header-filter.c b/src/lib-mail/istream-header-filter.c
index 1486b3118..7090529b4 100644
--- a/src/lib-mail/istream-header-filter.c
+++ b/src/lib-mail/istream-header-filter.c
@@ -64,7 +64,8 @@ static ssize_t read_header(struct header_filter_istream *mstream)
 	int matched, hdr_ret;
 
 	if (mstream->header_read &&
-	    mstream->istream.istream.v_offset + mstream->istream.pos ==
+	    mstream->istream.istream.v_offset +
+	    (mstream->istream.pos - mstream->istream.skip) ==
 	    mstream->header_size.virtual_size) {
 		/* we don't support mixing headers and body.
 		   it shouldn't be needed. */

