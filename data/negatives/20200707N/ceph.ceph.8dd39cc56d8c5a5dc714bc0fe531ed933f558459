commit 8dd39cc56d8c5a5dc714bc0fe531ed933f558459
Author: Sage Weil <sage@newdream.net>
Date:   Fri Apr 10 15:59:11 2009 -0700

    kclient: use FLUSH cap op on cap writeback
    
    This is just to make the message logs easier to read.  The only
    real distinction is that a FLUSH won't release caps, only write
    dirty ones back.

diff --git a/src/include/ceph_fs.h b/src/include/ceph_fs.h
index 2aded4ea51..0fd2de5bea 100644
--- a/src/include/ceph_fs.h
+++ b/src/include/ceph_fs.h
@@ -1017,6 +1017,7 @@ enum {
 	CEPH_CAP_OP_IMPORT,    /* mds has imported the cap from specified mds */
 	CEPH_CAP_OP_UPDATE,    /* client->mds update */
 	CEPH_CAP_OP_DROP,      /* client->mds drop cap bits */
+	CEPH_CAP_OP_FLUSH,     /* client->mds cap writeback */
 	CEPH_CAP_OP_FLUSH_ACK, /* mds->client flushed.  if caps=0, cap also released. */
 	CEPH_CAP_OP_FLUSHSNAP, /* client->mds flush snapped metadata */
 	CEPH_CAP_OP_FLUSHSNAP_ACK, /* mds->client flushed snapped metadata */
@@ -1034,6 +1035,7 @@ static inline const char *ceph_cap_op_name(int op)
 	case CEPH_CAP_OP_IMPORT: return "import";
 	case CEPH_CAP_OP_UPDATE: return "update";
 	case CEPH_CAP_OP_DROP: return "drop";
+	case CEPH_CAP_OP_FLUSH: return "flush";
 	case CEPH_CAP_OP_FLUSH_ACK: return "flush_ack";
 	case CEPH_CAP_OP_FLUSHSNAP: return "flushsnap";
 	case CEPH_CAP_OP_FLUSHSNAP_ACK: return "flushsnap_ack";
diff --git a/src/kernel/caps.c b/src/kernel/caps.c
index d5fdecf82b..8c4e4bbd12 100644
--- a/src/kernel/caps.c
+++ b/src/kernel/caps.c
@@ -1308,7 +1308,7 @@ retry:
 		ci->i_dirty_caps = 0;
 
 		/* __send_cap drops i_lock */
-		__send_cap(mdsc, cap, CEPH_CAP_OP_UPDATE, used, want,
+		__send_cap(mdsc, cap, CEPH_CAP_OP_FLUSH, used, want,
 			   cap->issued | cap->implemented, flushing);
 		goto out_unlocked;
 	}

