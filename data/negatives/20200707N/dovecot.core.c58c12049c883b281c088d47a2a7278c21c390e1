commit c58c12049c883b281c088d47a2a7278c21c390e1
Author: Timo Sirainen <tss@iki.fi>
Date:   Tue Jan 25 00:32:50 2011 +0200

    lib-storage: Give a better error message if mail_location has INBOX but no mail root dir.

diff --git a/src/lib-storage/mailbox-list.c b/src/lib-storage/mailbox-list.c
index 9d13953e6..456e486f1 100644
--- a/src/lib-storage/mailbox-list.c
+++ b/src/lib-storage/mailbox-list.c
@@ -264,6 +264,12 @@ int mailbox_list_settings_parse(struct mail_user *user, const char *data,
 		*error_r = t_strconcat(error, "mail root dir in: ", data, NULL);
 		return -1;
 	}
+	if (strncmp(set_r->root_dir, "INBOX=", 6) == 0) {
+		/* probably mbox user trying to avoid root_dir */
+		*error_r = t_strconcat("Mail root directory not given: ",
+				       data, NULL);
+		return -1;
+	}
 
 	while (*tmp != NULL) {
 		str = split_next_arg(&tmp);

