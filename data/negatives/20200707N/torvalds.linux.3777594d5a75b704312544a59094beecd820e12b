commit 3777594d5a75b704312544a59094beecd820e12b
Author: Carsten Otte <cotte@de.ibm.com>
Date:   Wed Jan 4 10:25:28 2012 +0100

    KVM: s390: fix assumption for KVM_MAX_VCPUS
    
    This patch fixes definition of the idle_mask and the local_int array
    in kvm_s390_float_interrupt. Previous definition had 64 cpus max
    hardcoded instead of using KVM_MAX_VCPUS.
    
    Signed-off-by: Carsten Otte <cotte@de.ibm.com>
    Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
    Signed-off-by: Avi Kivity <avi@redhat.com>

diff --git a/arch/s390/include/asm/kvm_host.h b/arch/s390/include/asm/kvm_host.h
index b0c235cb6ad5..e34fb2ba76c1 100644
--- a/arch/s390/include/asm/kvm_host.h
+++ b/arch/s390/include/asm/kvm_host.h
@@ -220,8 +220,9 @@ struct kvm_s390_float_interrupt {
 	struct list_head list;
 	atomic_t active;
 	int next_rr_cpu;
-	unsigned long idle_mask [(64 + sizeof(long) - 1) / sizeof(long)];
-	struct kvm_s390_local_interrupt *local_int[64];
+	unsigned long idle_mask[(KVM_MAX_VCPUS + sizeof(long) - 1)
+				/ sizeof(long)];
+	struct kvm_s390_local_interrupt *local_int[KVM_MAX_VCPUS];
 };
 
 

