commit 925ba01748666a35ed2758abb4d89d48686a95b5
Author: Timo Sirainen <tss@iki.fi>
Date:   Sun Jun 21 22:48:50 2009 -0400

    When accessing a shared namespace, don't change separators in mailbox name.
    
    --HG--
    branch : HEAD

diff --git a/src/lib-storage/mail-namespace.c b/src/lib-storage/mail-namespace.c
index 680cb1c6c..f17b170a3 100644
--- a/src/lib-storage/mail-namespace.c
+++ b/src/lib-storage/mail-namespace.c
@@ -371,6 +371,12 @@ const char *mail_namespace_fix_sep(struct mail_namespace *ns, const char *name)
 
 	if (ns->sep == ns->real_sep)
 		return name;
+	if (ns->type == NAMESPACE_SHARED &&
+	    (ns->flags & NAMESPACE_FLAG_AUTOCREATED) == 0) {
+		/* shared namespace root. the backend storage's hierarchy
+		   separator isn't known yet, so do nothing. */
+		return name;
+	}
 
 	ret = p_strdup(unsafe_data_stack_pool, name);
 	for (p = ret; *p != '\0'; p++) {

