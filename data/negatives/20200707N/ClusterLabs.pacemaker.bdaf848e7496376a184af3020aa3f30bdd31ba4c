commit bdaf848e7496376a184af3020aa3f30bdd31ba4c
Author: Andrew Beekhof <andrew@beekhof.net>
Date:   Thu Feb 8 13:20:12 2007 +0100

    TE: Always exit via mainloop
    
    Mercurial revision: 2c8faaee27f6f7a71ac990ba6f64940761941ae0

diff --git a/crm/tengine/actions.c b/crm/tengine/actions.c
index 3122a328f..6d6c0019c 100644
--- a/crm/tengine/actions.c
+++ b/crm/tengine/actions.c
@@ -440,6 +440,8 @@ crm_graph_functions_t te_graph_fns = {
 	te_fence_node
 };
 
+extern GMainLoop*  mainloop;
+
 void
 notify_crmd(crm_graph_t *graph)
 {	
@@ -471,6 +473,10 @@ notify_crmd(crm_graph_t *graph)
 
 		case tg_shutdown:
 			crm_info("Exiting after transition");
+			if (mainloop != NULL && g_main_is_running(mainloop)) {
+				g_main_quit(mainloop);
+				return;
+			}
 			exit(LSB_EXIT_OK);
 	}
 

