commit fb6e76cd2309c76d2120e013ff34ff6ab27aad88
Author: Ben Dooks <ben@ben-laptop.fluff.org>
Date:   Wed Jan 6 01:07:57 2010 +0900

    ARM: SAMSUNG: Do not allow get/set/round rate calls with no divider
    
    If the reg_div field is not set, then do not register clk_ops with the
    get/set/round rate calls as these will fail to work.
    
    Signed-off-by: Ben Dooks <ben-linux@fluff.org>

diff --git a/arch/arm/plat-samsung/clock-clksrc.c b/arch/arm/plat-samsung/clock-clksrc.c
index 12129f8e509c..aaf7d5ebea96 100644
--- a/arch/arm/plat-samsung/clock-clksrc.c
+++ b/arch/arm/plat-samsung/clock-clksrc.c
@@ -158,14 +158,25 @@ static struct clk_ops clksrc_ops = {
 	.round_rate	= s3c_roundrate_clksrc,
 };
 
+static struct clk_ops clksrc_ops_nodiv = {
+	.set_parent	= s3c_setparent_clksrc,
+};
+
 void __init s3c_register_clksrc(struct clksrc_clk *clksrc, int size)
 {
 	int ret;
 
+	WARN_ON(!clksrc->reg_div.reg && !clksrc->reg_src.reg);
+
 	for (; size > 0; size--, clksrc++) {
 		/* fill in the default functions */
-		if (!clksrc->clk.ops)
-			clksrc->clk.ops = &clksrc_ops;
+
+		if (!clksrc->clk.ops) {
+			if (!clksrc->reg_div.reg)
+				clksrc->clk.ops = &clksrc_ops_nodiv;
+			else
+				clksrc->clk.ops = &clksrc_ops;
+		}
 
 		/* setup the clocksource, but do not announce it
 		 * as it may be re-set by the setup routines

