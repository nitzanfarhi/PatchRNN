commit 524222f09453872128c71f350e1fea757ba758fa
Author: Carter Li <zhangsongcui3371@sina.com>
Date:   Sun Feb 22 17:43:58 2015 +0800

    Win32 doesn't have _BitScanForward64 so emulate it with two 32 bit calls.
    Implementation used: http://llvm.org/viewvc/llvm-project/libcxx/trunk/include/support/win32/support.h?view=markup#l135

diff --git a/format.h b/format.h
index 7a71ddc..47f77da 100644
--- a/format.h
+++ b/format.h
@@ -56,15 +56,22 @@ inline uint32_t clz(uint32_t x) {
   return 31 - r;
 }
 # define FMT_BUILTIN_CLZ(n) fmt::internal::clz(n)
-# ifdef _WIN64
-#  pragma intrinsic(_BitScanReverse64)
 inline uint32_t clzll(uint64_t n) {
   unsigned long r = 0;
+# ifdef _WIN64
+#  pragma intrinsic(_BitScanReverse64)
   _BitScanReverse64(&r, x);
+# else
+  // Scan the high 32 bits.
+  if (_BitScanReverse(&r, static_cast<uint32_t>(n >> 32)))
+    return 63 - (r + 32);
+
+  // Scan the low 32 bits.
+  _BitScanReverse(&r, static_cast<uint32_t>(n));
+# endif
   return 63 - r;
 }
 # define FMT_BUILTIN_CLZLL(n) fmt::internal::clzll(n)
-# endif
 }
 }
 #endif

