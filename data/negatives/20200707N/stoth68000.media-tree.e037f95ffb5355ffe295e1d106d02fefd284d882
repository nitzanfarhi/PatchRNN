commit e037f95ffb5355ffe295e1d106d02fefd284d882
Author: Matwey V. Kornilov <matwey@sai.msu.ru>
Date:   Wed May 22 11:13:38 2013 +0400

    tty: mxser: Fix build warning introduced by dfc7b837c7f9 (Re: linux-next: build warning after merge of the tty.current tree)
    
    Fix build warning at mxser.c introduced by dfc7b837c7f9 (tty: mxser: fix
    usage of opmode_ioaddr)
    
    Signed-off-by: Matwey V. Kornilov <matwey@sai.msu.ru>
    Reported-by: kbuild test robot <fengguang.wu@intel.com>
    Reported-by: Stephen Rothwell <sfr@canb.auug.org.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/tty/mxser.c b/drivers/tty/mxser.c
index f97b196693c6..4c4a23674569 100644
--- a/drivers/tty/mxser.c
+++ b/drivers/tty/mxser.c
@@ -1674,15 +1674,15 @@ static int mxser_ioctl(struct tty_struct *tty,
 		return mxser_ioctl_special(cmd, argp);
 
 	if (cmd == MOXA_SET_OP_MODE || cmd == MOXA_GET_OP_MODE) {
-		if (info->board->chip_flag != MOXA_MUST_MU860_HWID)
-			return -EFAULT;
-
 		int p;
 		unsigned long opmode;
 		static unsigned char ModeMask[] = { 0xfc, 0xf3, 0xcf, 0x3f };
 		int shiftbit;
 		unsigned char val, mask;
 
+		if (info->board->chip_flag != MOXA_MUST_MU860_HWID)
+			return -EFAULT;
+
 		p = tty->index % 4;
 		if (cmd == MOXA_SET_OP_MODE) {
 			if (get_user(opmode, (int __user *) argp))

