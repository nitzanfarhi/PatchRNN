commit 76832d8416430d6dd0575579ca1e00d1a790f4cb
Author: Julia Lawall <julia@diku.dk>
Date:   Mon Dec 10 15:49:28 2007 -0800

    drivers/serial/uartlite.c: Add missing of_node_put
    
    There should be an of_node_put when breaking out of a loop that iterates
    using for_each_compatible_node.
    
    This was detected and fixed using the following semantic patch.
    (http://www.emn.fr/x-info/coccinelle/)
    
    // <smpl>
    @@
    identifier d;
    type T;
    expression e;
    iterator for_each_compatible_node;
    @@
    
    T *d;
    ...
    for_each_compatible_node(d,...)
      {... when != of_node_put(d)
           when != e = d
    (
       return d;
    |
    +  of_node_put(d);
    ?  return ...;
    )
    ...}
    // </smpl>
    
    Signed-off-by: Julia Lawall <julia@diku.dk>
    Acked-by: Grant Likely <grant.likely@secretlab.ca>
    Acked-by: Peter Korsgaard <jacmet@sunsite.dk>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/drivers/serial/uartlite.c b/drivers/serial/uartlite.c
index a85f2d31a686..3f593247c41e 100644
--- a/drivers/serial/uartlite.c
+++ b/drivers/serial/uartlite.c
@@ -393,6 +393,7 @@ static inline void __init ulite_console_of_find_device(int id)
 			continue;
 
 		ulite_ports[id].mapbase = res.start;
+		of_node_put(np);
 		return;
 	}
 }

