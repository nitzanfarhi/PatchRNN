commit 4b72a544ec98c90e1a506bed28420d7eb7298557
Author: Moritz Kroll <moritz.kroll@avira.com>
Date:   Thu Feb 12 08:45:27 2015 +0100

    PE module: Corrected size of strings in checks

diff --git a/libyara/modules/pe.c b/libyara/modules/pe.c
index 2b26de5..be445bf 100644
--- a/libyara/modules/pe.c
+++ b/libyara/modules/pe.c
@@ -619,7 +619,7 @@ void pe_parse_version_info(
 
   version_info = (PVERSION_INFO) (pe->data + version_info_offset);
 
-  if (!fits_in_pe(pe, version_info->Key, sizeof("VS_VERSION_INFO")))
+  if (!fits_in_pe(pe, version_info->Key, sizeof("VS_VERSION_INFO") * 2))
     return;
 
   if (strcmp_w(version_info->Key, "VS_VERSION_INFO") != 0)
@@ -627,7 +627,7 @@ void pe_parse_version_info(
 
   string_file_info = ADD_OFFSET(version_info, sizeof(VERSION_INFO) + 86);
 
-  while(fits_in_pe(pe, string_file_info->Key, sizeof("StringFileInfo")) &&
+  while(fits_in_pe(pe, string_file_info->Key, sizeof("StringFileInfo") * 2) &&
       strcmp_w(string_file_info->Key, "StringFileInfo") == 0)
   {
     PVERSION_INFO string_table = ADD_OFFSET(

