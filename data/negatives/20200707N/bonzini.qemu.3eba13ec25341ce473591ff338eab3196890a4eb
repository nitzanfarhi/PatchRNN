commit 3eba13ec25341ce473591ff338eab3196890a4eb
Author: Peter Lieven <pl@kamp.de>
Date:   Wed Feb 26 10:47:57 2014 +0100

    block/vmdk: do not report file offset for compressed extents
    
    Signed-off-by: Peter Lieven <pl@kamp.de>
    Reviewed-by: Fam Zheng <famz@redhat.com>
    Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>

diff --git a/block/vmdk.c b/block/vmdk.c
index 83839f9b7a..b69988d169 100644
--- a/block/vmdk.c
+++ b/block/vmdk.c
@@ -1184,7 +1184,7 @@ static int64_t coroutine_fn vmdk_co_get_block_status(BlockDriverState *bs,
         break;
     case VMDK_OK:
         ret = BDRV_BLOCK_DATA;
-        if (extent->file == bs->file) {
+        if (extent->file == bs->file && !extent->compressed) {
             ret |= BDRV_BLOCK_OFFSET_VALID | offset;
         }
 

