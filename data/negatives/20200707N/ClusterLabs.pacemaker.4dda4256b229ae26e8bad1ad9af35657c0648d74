commit 4dda4256b229ae26e8bad1ad9af35657c0648d74
Author: David Vossel <dvossel@redhat.com>
Date:   Tue Nov 6 10:30:05 2012 -0600

    Low: fencing: Fixes glib assert caused by lookup on NULL hash table

diff --git a/lib/fencing/st_client.c b/lib/fencing/st_client.c
index a6fd5d6ae..aacb7a6eb 100644
--- a/lib/fencing/st_client.c
+++ b/lib/fencing/st_client.c
@@ -550,7 +550,6 @@ stonith_action_create(const char *agent,
         GHashTable * port_map)
 {
     stonith_action_t *action;
-    char *value = NULL;
 
     action = calloc(1, sizeof(stonith_action_t));
     crm_info("Initiating action %s for agent %s (target=%s)", _action, agent, victim);
@@ -561,13 +560,18 @@ stonith_action_create(const char *agent,
         action->victim = strdup(victim);
     }
     action->timeout = action->remaining_timeout = timeout;
+    action->max_retries = FAILURE_MAX_RETRIES;
 
-    value = g_hash_table_lookup(device_args, "pcmk_fencing_max_retries");
-    if (value && (safe_str_eq(action->action, "on") || safe_str_eq(action->action, "off")
-        || safe_str_eq(action->action, "reboot"))) {
-        action->max_retries = atoi(value);
-    } else {
-        action->max_retries = FAILURE_MAX_RETRIES;
+    if (device_args) {
+        const char *value = g_hash_table_lookup(device_args, "pcmk_fencing_max_retries");
+
+        if (value &&
+            (safe_str_eq(action->action, "on") ||
+            safe_str_eq(action->action, "off") ||
+            safe_str_eq(action->action, "reboot"))) {
+
+            action->max_retries = atoi(value);
+        }
     }
 
     return action;

