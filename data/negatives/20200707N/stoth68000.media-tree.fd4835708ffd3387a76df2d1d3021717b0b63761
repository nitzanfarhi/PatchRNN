commit fd4835708ffd3387a76df2d1d3021717b0b63761
Author: Weston Andros Adamson <dros@netapp.com>
Date:   Tue Oct 2 11:33:22 2012 -0700

    NFSv4.1: don't do two EXCHANGE_IDs on mount
    
    Since the addition of NFSv4 server trunking detection the mount context
    calls nfs4_proc_exchange_id then schedules the state manager, which also
    calls nfs4_proc_exchange_id. Setting the NFS4CLNT_LEASE_CONFIRM bit
    makes the state manager skip the unneeded EXCHANGE_ID and continue on
    with session creation.
    
    Reported-by: Jorge Mora <mora@netapp.com>
    Signed-off-by: Weston Andros Adamson <dros@netapp.com>
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>

diff --git a/fs/nfs/nfs4state.c b/fs/nfs/nfs4state.c
index 24a3ab492df2..c351e6b39838 100644
--- a/fs/nfs/nfs4state.c
+++ b/fs/nfs/nfs4state.c
@@ -351,6 +351,7 @@ int nfs41_discover_server_trunking(struct nfs_client *clp,
 	status = nfs4_proc_exchange_id(clp, cred);
 	if (status != NFS4_OK)
 		return status;
+	set_bit(NFS4CLNT_LEASE_CONFIRM, &clp->cl_state);
 
 	return nfs41_walk_client_list(clp, result, cred);
 }

