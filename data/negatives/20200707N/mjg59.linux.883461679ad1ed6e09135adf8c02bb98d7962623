commit 883461679ad1ed6e09135adf8c02bb98d7962623
Author: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Date:   Mon Nov 18 14:18:47 2013 +0100

    ACPI / scan: Set flags.match_driver in acpi_bus_scan_fixed()
    
    Before commit 6931007cc90b (ACPI / scan: Start matching drivers
    after trying scan handlers) the match_driver flag for all devices
    was set in acpi_add_single_object(), but now it is set by
    acpi_bus_device_attach() which is not called for the "fixed"
    devices added by acpi_bus_scan_fixed().  This means that
    flags.match_driver is never set for those devices now, so make
    acpi_bus_scan_fixed() set it before calling device_attach().
    
    Fixes: 6931007cc90b (ACPI / scan: Start matching drivers after trying scan handlers)
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

diff --git a/drivers/acpi/scan.c b/drivers/acpi/scan.c
index 821d154221d5..ce518867a18a 100644
--- a/drivers/acpi/scan.c
+++ b/drivers/acpi/scan.c
@@ -1990,6 +1990,7 @@ static int acpi_bus_scan_fixed(void)
 		if (result)
 			return result;
 
+		device->flags.match_driver = true;
 		result = device_attach(&device->dev);
 		if (result < 0)
 			return result;
@@ -2006,6 +2007,7 @@ static int acpi_bus_scan_fixed(void)
 		if (result)
 			return result;
 
+		device->flags.match_driver = true;
 		result = device_attach(&device->dev);
 	}
 

