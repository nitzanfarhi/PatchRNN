commit 3a047bf87b1b6f69c62ab9fb28072c639cb7e2fa
Author: Changli Gao <xiaosuo@gmail.com>
Date:   Mon Jul 12 21:00:12 2010 +0000

    rfs: call sock_rps_record_flow() in tcp_splice_read()
    
    rfs: call sock_rps_record_flow() in tcp_splice_read()
    
    call sock_rps_record_flow() in tcp_splice_read(), so the applications using
    splice(2) or sendfile(2) can utilize RFS.
    
    Signed-off-by: Changli Gao <xiaosuo@gmail.com>
    ----
     net/ipv4/tcp.c |    1 +
     1 file changed, 1 insertion(+)
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/ipv4/tcp.c b/net/ipv4/tcp.c
index 6596b4feeddc..65afeaec15b7 100644
--- a/net/ipv4/tcp.c
+++ b/net/ipv4/tcp.c
@@ -608,6 +608,7 @@ ssize_t tcp_splice_read(struct socket *sock, loff_t *ppos,
 	ssize_t spliced;
 	int ret;
 
+	sock_rps_record_flow(sk);
 	/*
 	 * We can't seek on a socket input
 	 */

