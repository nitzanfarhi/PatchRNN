commit 573632c2eaf87429a89490173f34682bb71f6883
Author: Jamie Gennis <jgennis@google.com>
Date:   Thu Feb 28 16:43:26 2013 -0800

    staging: sync: Fix timeout = 0 wait behavior
    
    Fix wait behavior on timeout == 0 case
    
    Cc: Maarten Lankhorst <maarten.lankhorst@canonical.com>
    Cc: Erik Gilling <konkers@android.com>
    Cc: Daniel Vetter <daniel.vetter@ffwll.ch>
    Cc: Rob Clark <robclark@gmail.com>
    Cc: Sumit Semwal <sumit.semwal@linaro.org>
    Cc: dri-devel@lists.freedesktop.org
    Cc: Android Kernel Team <kernel-team@android.com>
    Signed-off-by: Jamie Gennis <jgennis@google.com>
    [jstultz: Added commit message]
    Signed-off-by: John Stultz <john.stultz@linaro.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/android/sync.c b/drivers/staging/android/sync.c
index 9b8b0e96b988..b9bb974faacd 100644
--- a/drivers/staging/android/sync.c
+++ b/drivers/staging/android/sync.c
@@ -616,10 +616,12 @@ int sync_fence_wait(struct sync_fence *fence, long timeout)
 		return fence->status;
 	}
 
-	if (fence->status == 0 && timeout > 0) {
-		pr_info("fence timeout on [%p] after %dms\n", fence,
-			jiffies_to_msecs(timeout));
-		sync_dump();
+	if (fence->status == 0) {
+		if (timeout > 0) {
+			pr_info("fence timeout on [%p] after %dms\n", fence,
+				jiffies_to_msecs(timeout));
+			sync_dump();
+		}
 		return -ETIME;
 	}
 

