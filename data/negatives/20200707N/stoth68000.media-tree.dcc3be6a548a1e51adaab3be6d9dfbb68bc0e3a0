commit dcc3be6a548a1e51adaab3be6d9dfbb68bc0e3a0
Author: Alex Shi <alex.shi@intel.com>
Date:   Tue Sep 6 14:46:01 2011 +0800

    slub: Discard slab page when node partial > minimum partial number
    
    Discarding slab should be done when node partial > min_partial.  Otherwise,
    node partial slab may eat up all memory.
    
    Signed-off-by: Alex Shi <alex.shi@intel.com>
    Acked-by: Christoph Lameter <cl@linux.com>
    Signed-off-by: Pekka Enberg <penberg@kernel.org>

diff --git a/mm/slub.c b/mm/slub.c
index 8f687575d310..e06f72c81e53 100644
--- a/mm/slub.c
+++ b/mm/slub.c
@@ -1953,7 +1953,7 @@ static void unfreeze_partials(struct kmem_cache *s)
 
 			new.frozen = 0;
 
-			if (!new.inuse && (!n || n->nr_partial < s->min_partial))
+			if (!new.inuse && (!n || n->nr_partial > s->min_partial))
 				m = M_FREE;
 			else {
 				struct kmem_cache_node *n2 = get_node(s,

