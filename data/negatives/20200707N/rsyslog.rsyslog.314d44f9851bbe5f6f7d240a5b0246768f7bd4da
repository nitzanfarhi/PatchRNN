commit 314d44f9851bbe5f6f7d240a5b0246768f7bd4da
Author: Tomas Heinrich <theinric@redhat.com>
Date:   Mon Jul 14 19:07:05 2014 +0200

    bugfix: check return value of malloc()
    
    Error: NULL_RETURNS (CWE-476):
    rsyslog-7.4.10/plugins/imuxsock/imuxsock.c:1336: returned_null: Function "malloc(size_t)" returns null (checked 140 out of 168 times).
    rsyslog-7.4.10/action.c:1197: example_checked: Example 1: "malloc(batchNumMsgs(pBatch) * 1UL)" has its value checked in "(active = malloc(batchNumMsgs(pBatch) * 1UL)) == NULL".
    rsyslog-7.4.10/grammar/lexer.l:302: example_checked: Example 2: "malloc(40UL)" has its value checked in "(bs = malloc(40UL)) == NULL".
    rsyslog-7.4.10/grammar/rainerscript.c:2483: example_checked: Example 3: "malloc(8UL)" has its value checked in "(ar->arr = malloc(8UL)) == NULL".
    rsyslog-7.4.10/plugins/imklog/bsd.c:221: example_checked: Example 4: "malloc(1UL * (iMaxLine + 1))" has its value checked in "(pRcv = (uchar *)malloc(1UL * (iMaxLine + 1))) == NULL".
    rsyslog-7.4.10/plugins/imuxsock/imuxsock.c:968: example_checked: Example 5: "malloc(1UL * (iMaxLine + 1))" has its value checked in "(pRcv = (uchar *)malloc(1UL * (iMaxLine + 1))) == NULL".
    rsyslog-7.4.10/plugins/imuxsock/imuxsock.c:1336: var_assigned: Assigning: "pReadfds" = null return value from "malloc(size_t)".
    rsyslog-7.4.10/plugins/imuxsock/imuxsock.c:1355: dereference: Dereferencing a pointer that might be null "pReadfds" when calling "memset(void *, int, size_t)".

diff --git a/plugins/imuxsock/imuxsock.c b/plugins/imuxsock/imuxsock.c
index 7d6b78995..5a2efdcc7 100644
--- a/plugins/imuxsock/imuxsock.c
+++ b/plugins/imuxsock/imuxsock.c
@@ -1356,6 +1356,7 @@ BEGINrunInput
 #endif
 
 CODESTARTrunInput
+	CHKmalloc(pReadfds);
 	if(runModConf->bOmitLocalLogging && nfd == 1)
 		ABORT_FINALIZE(RS_RET_OK);
 	/* this is an endless loop - it is terminated when the thread is

