commit e08d36c387e143002d899cab64464bf947b12811
Author: Krunal Bauskar krunal.bauskar@oracle.com <>
Date:   Tue Aug 6 16:00:19 2013 +0530

    - bug#17227149: INNODB_WL6501 KEEPS ON FAILING INTERMITTENTLY
      - Caching length before log directory path is copied to the buffer and then
        using the stale length for calculation.
      - Missed out change at one place. Did the same change at other places.
      - Missed out instance resulted in valgrind issue.
      - Corrected the same.

diff --git a/storage/innobase/row/row0trunc.cc b/storage/innobase/row/row0trunc.cc
index b64f04fcae0..5a52f63b14d 100644
--- a/storage/innobase/row/row0trunc.cc
+++ b/storage/innobase/row/row0trunc.cc
@@ -274,13 +274,14 @@ public:
 		}
 		memset(m_log_file_name, 0, log_file_name_buf_sz);
 
-		ulint	log_file_name_len = strlen(m_log_file_name);
 		strcpy(m_log_file_name, srv_log_group_home_dir);
+		ulint	log_file_name_len = strlen(m_log_file_name);
 		if (m_log_file_name[log_file_name_len - 1]
 			!= SRV_PATH_SEPARATOR) {
 
 			m_log_file_name[log_file_name_len]
 				= SRV_PATH_SEPARATOR;
+			log_file_name_len = strlen(m_log_file_name);
 		}
 
 		ut_snprintf(m_log_file_name + log_file_name_len,
@@ -550,6 +551,7 @@ TruncateLogParser::scan(
 
 				log_file_name[log_file_name_len]
 					= SRV_PATH_SEPARATOR;
+				log_file_name_len = strlen(log_file_name);
 			}
 			strcat(log_file_name, fileinfo.name);
 			log_files.push_back(log_file_name);

