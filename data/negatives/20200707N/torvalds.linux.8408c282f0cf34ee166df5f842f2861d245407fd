commit 8408c282f0cf34ee166df5f842f2861d245407fd
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Mon Feb 21 12:54:48 2011 +0000

    drm/i915: First try a normal large kmalloc for the temporary exec buffers
    
    As we just need a temporary array whilst performing the relocations for
    the execbuffer, first attempt to allocate using kmalloc even if it is
    not of order page-0. This avoids the overhead of remapping the
    discontiguous array and so gives a moderate boost to execution
    throughput.
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

diff --git a/drivers/gpu/drm/i915/i915_gem_execbuffer.c b/drivers/gpu/drm/i915/i915_gem_execbuffer.c
index a72e7b2cb048..f0c93b2e6c68 100644
--- a/drivers/gpu/drm/i915/i915_gem_execbuffer.c
+++ b/drivers/gpu/drm/i915/i915_gem_execbuffer.c
@@ -1306,7 +1306,11 @@ i915_gem_execbuffer2(struct drm_device *dev, void *data,
 		return -EINVAL;
 	}
 
-	exec2_list = drm_malloc_ab(sizeof(*exec2_list), args->buffer_count);
+	exec2_list = kmalloc(sizeof(*exec2_list)*args->buffer_count,
+			     GFP_KERNEL | __GFP_NOWARN | __GFP_NORETRY);
+	if (exec2_list == NULL)
+		exec2_list = drm_malloc_ab(sizeof(*exec2_list),
+					   args->buffer_count);
 	if (exec2_list == NULL) {
 		DRM_ERROR("Failed to allocate exec list for %d buffers\n",
 			  args->buffer_count);

