commit 9a1a4c2ca1b9a8bbadd38224b15a364c78cb9938
Author: Timo Sirainen <tss@iki.fi>
Date:   Wed Sep 26 21:14:23 2012 +0300

    i_getpwnam(): Ignore EINVAL errors silently.
    At least FreeBSD returns it when attempting to lookup user@domain.

diff --git a/src/lib/ipwd.c b/src/lib/ipwd.c
index 6b12ecf07..f1b76f343 100644
--- a/src/lib/ipwd.c
+++ b/src/lib/ipwd.c
@@ -58,6 +58,10 @@ int i_getpwnam(const char *name, struct passwd *pwd_r)
 	errno = getpwnam_r(name, pwd_r, pwbuf, pwbuf_size, &result);
 	if (result != NULL)
 		return 1;
+	if (errno == EINVAL) {
+		/* FreeBSD fails here when name="user@domain" */
+		return 0;
+	}
 	return errno == 0 ? 0 : -1;
 }
 

