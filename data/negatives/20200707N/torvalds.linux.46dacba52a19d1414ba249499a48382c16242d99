commit 46dacba52a19d1414ba249499a48382c16242d99
Author: Michal Schmidt <xschmi00@stud.feec.vutbr.cz>
Date:   Sat Sep 3 15:57:01 2005 -0700

    [PATCH] swsusp: prevent disks from spinning down and up
    
    Stop the disks from spinning down and up on suspend.
    
    Signed-off-by: Michal Schmidt <xschmi00@stud.feec.vutbr.cz>
    Cc: Pavel Machek <pavel@ucw.cz>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/drivers/ide/ide-io.c b/drivers/ide/ide-io.c
index 248e3cc8b352..f174aee659e5 100644
--- a/drivers/ide/ide-io.c
+++ b/drivers/ide/ide-io.c
@@ -150,7 +150,7 @@ static void ide_complete_power_step(ide_drive_t *drive, struct request *rq, u8 s
 
 	switch (rq->pm->pm_step) {
 	case ide_pm_flush_cache:	/* Suspend step 1 (flush cache) complete */
-		if (rq->pm->pm_state == 4)
+		if (rq->pm->pm_state == PM_EVENT_FREEZE)
 			rq->pm->pm_step = ide_pm_state_completed;
 		else
 			rq->pm->pm_step = idedisk_pm_standby;

