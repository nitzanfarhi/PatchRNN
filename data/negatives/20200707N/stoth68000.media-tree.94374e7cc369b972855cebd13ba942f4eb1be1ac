commit 94374e7cc369b972855cebd13ba942f4eb1be1ac
Author: Latchesar Ionkov <lucho@ionkov.net>
Date:   Wed Jun 28 04:26:50 2006 -0700

    [PATCH] v9fs: return the correct error when interrupted by signal
    
    If a signal interrupts the user process, v9fs sends a flush request to the
    file server and waits for its response.  It error code is incorrectly set
    to the error code of the flush message instead of ERESTARTSYS.  The patch
    sets the error code to the correct value.
    
    Signed-off-by: Latchesar Ionkov <lucho@ionkov.net>
    Cc: Eric Van Hensbergen <ericvh@ericvh.myip.org>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/fs/9p/mux.c b/fs/9p/mux.c
index 12e1baa4508d..8d45ed668837 100644
--- a/fs/9p/mux.c
+++ b/fs/9p/mux.c
@@ -932,6 +932,8 @@ v9fs_mux_rpc(struct v9fs_mux_data *m, struct v9fs_fcall *tc,
 					r.rcall || r.err);
 			} while (!r.rcall && !r.err && err==-ERESTARTSYS &&
 				m->trans->status==Connected && !m->err);
+
+			err = -ERESTARTSYS;
 		}
 		sigpending = 1;
 	}

