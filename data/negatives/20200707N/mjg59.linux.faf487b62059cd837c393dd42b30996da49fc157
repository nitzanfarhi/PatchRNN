commit faf487b62059cd837c393dd42b30996da49fc157
Author: Christopher Brannon <chris@the-brannons.com>
Date:   Wed Sep 11 10:05:27 2013 -0700

    staging: speakup: kobjects.c: Use correct values when changing voice.
    
    When a new voice is selected, we set volume and pitch appropriate for
    the voice.  We need to use the numeric index corresponding to the
    voice when indexing into the volume and pitch tables, rather than
    the raw user input that was used to select the voice.
    Note that using the raw input can also lead to an invalid memory read
    in the case of invalid or malicious user input.
    
    Signed-off-by: Christopher Brannon <chris@the-brannons.com>
    Acked-by: Samuel Thibault <samuel.thibault@ens-lyon.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/staging/speakup/kobjects.c b/drivers/staging/speakup/kobjects.c
index 61a3f7a5eb6b..f31afa2cffb7 100644
--- a/drivers/staging/speakup/kobjects.c
+++ b/drivers/staging/speakup/kobjects.c
@@ -651,7 +651,10 @@ ssize_t spk_var_store(struct kobject *kobj, struct kobj_attribute *attr,
 		* If voice was just changed, we might need to reset our default
 		* pitch and volume.
 		*/
-		if (param->var_id == VOICE) {
+		if (param->var_id == VOICE && synth &&
+		    (ret == 0 || ret == -ERESTART)) {
+			var_data = param->data;
+			value = var_data->u.n.value;
 			spk_reset_default_value("pitch", synth->default_pitch,
 				value);
 			spk_reset_default_value("vol", synth->default_vol,

