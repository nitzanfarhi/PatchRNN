commit 978c7b2ff49597ab76ff7529a933bd366941ac25
Author: Rafael J. Wysocki <rjw@sisk.pl>
Date:   Fri Dec 7 14:09:02 2007 +1100

    [XFS] Make xfsbufd threads freezable
    
    Fix breakage caused by commit 831441862956fffa17b9801db37e6ea1650b0f69
    that did not introduce the necessary call to set_freezable() in
    xfs/linux-2.6/xfs_buf.c .
    
    SGI-PV: 974224
    SGI-Modid: xfs-linux-melb:xfs-kern:30203a
    
    Signed-off-by: Rafael J. Wysocki <rjw@sisk.pl>
    Signed-off-by: David Chinner <dgc@sgi.com>
    Signed-off-by: Lachlan McIlroy <lachlan@sgi.com>

diff --git a/fs/xfs/linux-2.6/xfs_buf.c b/fs/xfs/linux-2.6/xfs_buf.c
index 43d6c7a290e2..a49dd8d4b069 100644
--- a/fs/xfs/linux-2.6/xfs_buf.c
+++ b/fs/xfs/linux-2.6/xfs_buf.c
@@ -1743,6 +1743,8 @@ xfsbufd(
 
 	current->flags |= PF_MEMALLOC;
 
+	set_freezable();
+
 	do {
 		if (unlikely(freezing(current))) {
 			set_bit(XBT_FORCE_SLEEP, &target->bt_flags);

