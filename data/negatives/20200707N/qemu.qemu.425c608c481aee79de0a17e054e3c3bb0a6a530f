commit 425c608c481aee79de0a17e054e3c3bb0a6a530f
Author: Isaku Yamahata <yamahata@valinux.co.jp>
Date:   Fri May 1 18:33:53 2009 +0900

    minor fix of pci_register_bus()
    
    keep first_bus linked list correct.
    
    Signed-off-by: Isaku Yamahata <yamahata@valinux.co.jp>

diff --git a/hw/pci.c b/hw/pci.c
index 827889466e..ee7d4031e0 100644
--- a/hw/pci.c
+++ b/hw/pci.c
@@ -100,6 +100,7 @@ PCIBus *pci_register_bus(pci_set_irq_fn set_irq, pci_map_irq_fn map_irq,
     bus->irq_opaque = pic;
     bus->devfn_min = devfn_min;
     bus->nirq = nirq;
+    bus->next = first_bus;
     first_bus = bus;
     register_savevm("PCIBUS", nbus++, 1, pcibus_save, pcibus_load, bus);
     return bus;

