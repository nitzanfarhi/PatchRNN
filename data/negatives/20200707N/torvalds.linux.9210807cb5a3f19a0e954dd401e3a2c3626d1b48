commit 9210807cb5a3f19a0e954dd401e3a2c3626d1b48
Author: Nicolas Pitre <nico@cam.org>
Date:   Fri Sep 19 10:43:06 2008 -0400

    [ARM] prevent the vmalloc cmdline argument from eating all memory
    
    Commit 8d5796d2ec6b5a4e7a52861144e63af438d6f8f7 allows for the vmalloc
    area to be resized from the kernel cmdline.  Make sure it cannot overlap
    with RAM entirely.
    
    Signed-off-by: Nicolas Pitre <nico@marvell.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>

diff --git a/arch/arm/mm/mmu.c b/arch/arm/mm/mmu.c
index ab511d94d917..636cf8fc70ef 100644
--- a/arch/arm/mm/mmu.c
+++ b/arch/arm/mm/mmu.c
@@ -646,6 +646,13 @@ static void __init early_vmalloc(char **arg)
 			"vmalloc area too small, limiting to %luMB\n",
 			vmalloc_reserve >> 20);
 	}
+
+	if (vmalloc_reserve > VMALLOC_END - (PAGE_OFFSET + SZ_32M)) {
+		vmalloc_reserve = VMALLOC_END - (PAGE_OFFSET + SZ_32M);
+		printk(KERN_WARNING
+			"vmalloc area is too big, limiting to %luMB\n",
+			vmalloc_reserve >> 20);
+	}
 }
 __early_param("vmalloc=", early_vmalloc);
 

