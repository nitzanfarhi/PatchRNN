commit 38b48754f787e7956dc97ebae6891203358a032e
Author: Lennart Poettering <lennart@poettering.net>
Date:   Tue Feb 2 12:50:04 2010 +0100

    execute: allow configuration of SCHED_RESET_ON_FORK

diff --git a/execute.c b/execute.c
index ae32bcada..65a7fbba1 100644
--- a/execute.c
+++ b/execute.c
@@ -347,7 +347,8 @@ int exec_spawn(const ExecCommand *command, const ExecContext *context, int *fds,
                         zero(param);
                         param.sched_priority = context->cpu_sched_priority;
 
-                        if (sched_setscheduler(0, context->cpu_sched_policy, &param) < 0) {
+                        if (sched_setscheduler(0, context->cpu_sched_policy |
+                                               (context->cpu_sched_reset_on_fork ? SCHED_RESET_ON_FORK : 0), &param) < 0) {
                                 r = EXIT_SETSCHEDULER;
                                 goto fail;
                         }
@@ -563,9 +564,11 @@ void exec_context_dump(ExecContext *c, FILE* f, const char *prefix) {
         if (c->cpu_sched_set)
                 fprintf(f,
                         "%sCPUSchedulingPolicy: %s\n"
-                        "%sCPUSchedulingPriority: %i\n",
+                        "%sCPUSchedulingPriority: %i\n"
+                        "%sCPUSchedulingResetOnFork: %s\n",
                         prefix, sched_policy_to_string(c->cpu_sched_policy),
-                        prefix, c->cpu_sched_priority);
+                        prefix, c->cpu_sched_priority,
+                        prefix, yes_no(c->cpu_sched_reset_on_fork));
 
         if (c->cpu_affinity_set) {
                 fprintf(f, "%sCPUAffinity:", prefix);
diff --git a/execute.h b/execute.h
index 09e436797..4f700efd4 100644
--- a/execute.h
+++ b/execute.h
@@ -70,6 +70,8 @@ struct ExecContext {
         bool cpu_affinity_set:1;
         bool timer_slack_ns_set:1;
 
+        bool cpu_sched_reset_on_fork;
+
         ExecInput input;
         ExecOutput output;
         int syslog_priority;
diff --git a/load-fragment.c b/load-fragment.c
index 4bb1ef010..c271ce5a5 100644
--- a/load-fragment.c
+++ b/load-fragment.c
@@ -1024,6 +1024,7 @@ static int load_from_path(Unit *u, const char *path) {
                 { "IOSchedulingPriority",   config_parse_io_priority,     &(context),                                      section   }, \
                 { "CPUSchedulingPolicy",    config_parse_cpu_sched_policy,&(context),                                      section   }, \
                 { "CPUSchedulingPriority",  config_parse_cpu_sched_prio,  &(context),                                      section   }, \
+                { "CPUSchedulingResetOnFork", config_parse_bool,          &(context).cpu_sched_reset_on_fork,              section   }, \
                 { "CPUAffinity",            config_parse_cpu_affinity,    &(context),                                      section   }, \
                 { "UMask",                  config_parse_umask,           &(context).umask,                                section   }, \
                 { "Environment",            config_parse_strv,            &(context).environment,                          section   }, \

