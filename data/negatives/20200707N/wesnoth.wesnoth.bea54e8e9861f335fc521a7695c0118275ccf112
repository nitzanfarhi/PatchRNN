commit bea54e8e9861f335fc521a7695c0118275ccf112
Author: Ali El Gariani <alinkmaze@gmail.com>
Date:   Fri Feb 27 00:46:21 2009 +0000

    Fix auto-undo when chaining few move+attack+cancel on different targets...
    
    ...by moving this ugly attackmove special flag to a higher level in
    mouse code.

diff --git a/src/mouse_events.cpp b/src/mouse_events.cpp
index c601dfe0fc..0ff57bab7e 100644
--- a/src/mouse_events.cpp
+++ b/src/mouse_events.cpp
@@ -322,7 +322,6 @@ paths::route mouse_handler::get_route(unit_map::const_iterator un, map_location
 
 void mouse_handler::mouse_press(const SDL_MouseButtonEvent& event, const bool browse)
 {
-	if (attackmove_) return;
 	mouse_handler_base::mouse_press(event, browse);
 }
 
@@ -444,7 +443,9 @@ bool mouse_handler::left_click(int x, int y, const bool browse)
 
 		gui().unhighlight_reach();
 		move_unit_along_current_route(check_shroud);
-	} else {
+	} else if (!attackmove_) {
+		// we block selection during attack+move (because motion is blocked)
+		// FIXME: deal with selected event when commands_disabled
 		// we select a (maybe empty) hex
 		select_hex(hex, browse);
 	}

