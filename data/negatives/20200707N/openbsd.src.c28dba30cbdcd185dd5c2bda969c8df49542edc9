commit c28dba30cbdcd185dd5c2bda969c8df49542edc9
Author: claudio <claudio@openbsd.org>
Date:   Thu Nov 12 22:29:15 2009 +0000

    Add more paranoia in lsa_router_check(). There needs to be at least one
    router link in a type-1 LSA.

diff --git a/usr.sbin/ospfd/rde_lsdb.c b/usr.sbin/ospfd/rde_lsdb.c
index d860c260ce1..df30c01e91a 100644
--- a/usr.sbin/ospfd/rde_lsdb.c
+++ b/usr.sbin/ospfd/rde_lsdb.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: rde_lsdb.c,v 1.42 2009/01/07 21:16:36 claudio Exp $ */
+/*	$OpenBSD: rde_lsdb.c,v 1.43 2009/11/12 22:29:15 claudio Exp $ */
 
 /*
  * Copyright (c) 2004, 2005 Claudio Jeker <claudio@openbsd.org>
@@ -260,6 +260,10 @@ lsa_router_check(struct lsa *lsa, u_int16_t len)
 	}
 
 	nlinks = ntohs(lsa->data.rtr.nlinks);
+	if (nlinks == 0) {
+		log_warnx("lsa_check: invalid LSA router packet");
+		return (0);
+	}
 	for (i = 0; i < nlinks; i++) {
 		rtr_link = (struct lsa_rtr_link *)(buf + off);
 		off += sizeof(struct lsa_rtr_link);

