commit 688cae1eef7476d33d9ed023140bd0e1923f8872
Author: guy <guy>
Date:   Sun Aug 10 19:47:39 2003 +0000

    From Mark Ellzey Thomas <mark@ackers.net>: some additional
    buffer-overflow checking.

diff --git a/smbutil.c b/smbutil.c
index e80b6636..314a9704 100644
--- a/smbutil.c
+++ b/smbutil.c
@@ -12,7 +12,7 @@
 
 #ifndef lint
 static const char rcsid[] =
-     "@(#) $Header: /tcpdump/master/tcpdump/smbutil.c,v 1.25 2002-09-05 00:00:25 guy Exp $";
+     "@(#) $Header: /tcpdump/master/tcpdump/smbutil.c,v 1.26 2003-08-10 19:47:39 guy Exp $";
 #endif
 
 #include <tcpdump-stdinc.h>
@@ -396,8 +396,12 @@ smb_fdata1(const u_char *buf, const char *fmt, const u_char *maxbuf)
 
 	    p = strchr(++fmt, '}');
 	    l = PTR_DIFF(p, fmt);
+
+	    if ((unsigned int)l > sizeof(bitfmt) - 1)
+		    l = sizeof(bitfmt)-1;
+
 	    strncpy(bitfmt, fmt, l);
-	    bitfmt[l] = 0;
+	    bitfmt[l] = '\0';
 	    fmt = p + 1;
 	    write_bits(buf[0], bitfmt);
 	    buf++;

