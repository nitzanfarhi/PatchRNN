commit 78e9ddd75e79159ccb5f3506ac0359ce0df28183
Author: Peter Maydell <peter.maydell@linaro.org>
Date:   Mon Aug 6 13:34:41 2018 +0100

    hw/intc/arm_gicv3_common: Give no-migration-shift-bug subsection a needed function
    
    Currently the migration code incorrectly treats a subsection with
    no .needed function pointer as if it was the subsection list
    terminator -- it is ignored and so is everything after it.
    Work around this by giving vmstate_gicv3_gicd_no_migration_shift_bug
    a 'needed' function that always returns true.
    
    Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
    Reviewed-by: Dr. David Alan Gilbert <dgilbert@redhat.com>
    Reviewed-by: Richard Henderson <richard.henderson@linaro.org>
    Message-id: 20180806123445.1459-2-peter.maydell@linaro.org

diff --git a/hw/intc/arm_gicv3_common.c b/hw/intc/arm_gicv3_common.c
index ff326b374a..e58bc8b810 100644
--- a/hw/intc/arm_gicv3_common.c
+++ b/hw/intc/arm_gicv3_common.c
@@ -203,10 +203,16 @@ static int gicv3_gicd_no_migration_shift_bug_post_load(void *opaque,
     return 0;
 }
 
+static bool needed_always(void *opaque)
+{
+    return true;
+}
+
 const VMStateDescription vmstate_gicv3_gicd_no_migration_shift_bug = {
     .name = "arm_gicv3/gicd_no_migration_shift_bug",
     .version_id = 1,
     .minimum_version_id = 1,
+    .needed = needed_always,
     .pre_load = gicv3_gicd_no_migration_shift_bug_pre_load,
     .post_load = gicv3_gicd_no_migration_shift_bug_post_load,
     .fields = (VMStateField[]) {

