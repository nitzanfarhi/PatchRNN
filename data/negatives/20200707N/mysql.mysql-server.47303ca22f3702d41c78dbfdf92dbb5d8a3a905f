commit 47303ca22f3702d41c78dbfdf92dbb5d8a3a905f
Author: magnus.blaudd@oracle.com <>
Date:   Tue Sep 13 10:46:15 2011 +0200

    BUG#12543299
     - Don't allow nodeid to be taken until nodefailure handling
       of the API node has completed

diff --git a/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp b/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp
index feadc6e6fdc..546b06753ef 100644
--- a/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp
+++ b/storage/ndb/src/kernel/blocks/qmgr/QmgrMain.cpp
@@ -6353,6 +6353,11 @@ Qmgr::execALLOC_NODEID_REQ(Signal * signal)
     jam();
     error = AllocNodeIdRef::NodeFailureHandlingNotCompleted;
   }
+  else if (req.nodeType == NodeInfo::API && nodePtr.p->phase != ZAPI_INACTIVE)
+  {
+    jam();
+    error = AllocNodeIdRef::NodeReserved;
+  }
 #if 0
   /**
    * For now only make "time/secret" based reservation on master

