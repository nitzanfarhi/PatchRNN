commit 3f601a622d886918866ae4775c1199892f43507c
Author: Attila Molnar <attilamolnar@hush.com>
Date:   Sun Mar 23 22:10:04 2014 +0100

    m_operprefix Don't set +y on the oper if hideoper is being unset due to deopering
    
    Fixes issue #801 reported by @UselessOper

diff --git a/src/modules/m_operprefix.cpp b/src/modules/m_operprefix.cpp
index 25937cd6e..62ddb6c67 100644
--- a/src/modules/m_operprefix.cpp
+++ b/src/modules/m_operprefix.cpp
@@ -162,7 +162,8 @@ class ModuleOperPrefixMode : public Module
 
 void HideOperWatcher::AfterMode(User* source, User* dest, Channel* channel, const std::string& parameter, bool adding, ModeType type)
 {
-	if (IS_LOCAL(dest))
+	// If hideoper is being unset because the user is deopering, don't set +y
+	if (IS_LOCAL(dest) && IS_OPER(dest))
 		parentmod->SetOperPrefix(dest, !adding);
 }
 

