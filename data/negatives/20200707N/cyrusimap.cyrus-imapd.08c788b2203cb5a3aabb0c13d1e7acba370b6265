commit 08c788b2203cb5a3aabb0c13d1e7acba370b6265
Author: Ken Murchison <murch@andrew.cmu.edu>
Date:   Wed Oct 4 10:07:33 2017 -0400

    http_carddav.c: check restrictions on vCard during PUT

diff --git a/imap/http_carddav.c b/imap/http_carddav.c
index 6e1818978..e7acffa47 100644
--- a/imap/http_carddav.c
+++ b/imap/http_carddav.c
@@ -1114,6 +1114,13 @@ static int carddav_put(struct transaction_t *txn, void *obj,
 {
     struct carddav_db *db = (struct carddav_db *)destdb;
     struct vparse_card *vcard = (struct vparse_card *)obj;
+
+    if (!(vcard && vcard->objects &&
+          vparse_restriction_check(vcard->objects))) {
+        txn->error.precond = CARDDAV_VALID_DATA;
+        return HTTP_FORBIDDEN;
+    }
+
     return store_resource(txn, vcard, mailbox, resource, db, /*dupcheck*/1);
 }
 

