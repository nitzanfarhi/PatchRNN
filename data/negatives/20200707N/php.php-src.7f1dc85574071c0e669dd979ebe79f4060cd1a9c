commit 7f1dc85574071c0e669dd979ebe79f4060cd1a9c
Author: Stanislav Malyshev <stas@php.net>
Date:   Mon Nov 6 18:09:51 2000 +0000

    Serialize as reference only if it's a true reference

diff --git a/ext/standard/var.c b/ext/standard/var.c
index d78bf51577..5a0b92fe58 100644
--- a/ext/standard/var.c
+++ b/ext/standard/var.c
@@ -178,7 +178,7 @@ void php_var_serialize(pval *buf, pval **struc, HashTable *var_hash)
 	HashTable *myht;
 	BLS_FETCH();
 
-	if(var_hash != NULL && php_add_var_hash(var_hash,*struc,(void *)&var_already) == FAILURE) {
+	if(var_hash != NULL && (*struc)->is_ref && php_add_var_hash(var_hash,*struc,(void *)&var_already) == FAILURE) {
 		slen = sprintf(s,"R:%ld;",*var_already);
 		STR_CAT(buf, s, slen);
 		return;

