commit 96f339c6b95344942fe5fce012ff4f2a3b2cb80d
Author: Greg Edwards <edwardsg@sgi.com>
Date:   Wed Sep 28 17:05:19 2005 -0500

    [IA64] mbcs_init() should give up unless running on sn2
    
    CONFIG_SGI_MBCS is enabled in generic kernels, but the driver may
    oops some other platforms.  Check whether we are running on sn2
    and bail out if we are not before doing anything dangerous.
    
    Acked-by: Bruce Losure <blosure@americas.sgi.com>
    Signed-off-by: Greg Edwards <edwardsg@sgi.com>
    Signed-off-by: Tony Luck <tony.luck@intel.com>

diff --git a/drivers/char/mbcs.c b/drivers/char/mbcs.c
index 3fa64c631108..c268ee04b2aa 100644
--- a/drivers/char/mbcs.c
+++ b/drivers/char/mbcs.c
@@ -830,6 +830,9 @@ static int __init mbcs_init(void)
 {
 	int rv;
 
+	if (!ia64_platform_is("sn2"))
+		return -ENODEV;
+
 	// Put driver into chrdevs[].  Get major number.
 	rv = register_chrdev(mbcs_major, DEVICE_NAME, &mbcs_ops);
 	if (rv < 0) {

