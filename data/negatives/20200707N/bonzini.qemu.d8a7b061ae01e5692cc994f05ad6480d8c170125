commit d8a7b061ae01e5692cc994f05ad6480d8c170125
Author: Fam Zheng <famz@redhat.com>
Date:   Thu Jan 23 15:10:52 2014 +0800

    vmdk: Fix format specific information (create type) for streamOptimized
    
    Previously the field is wrong:
    
        $ ./qemu-img create -f vmdk -o subformat=streamOptimized /tmp/a.vmdk 1G
    
        $ ./qemu-img info /tmp/a.vmdk
        image: /tmp/a.vmdk
        file format: vmdk
        virtual size: 1.0G (1073741824 bytes)
        disk size: 12K
        Format specific information:
            cid: 1390460459
            parent cid: 4294967295
    >>>     create type: monolithicSparse
            <snip>
    
    Signed-off-by: Fam Zheng <famz@redhat.com>
    Signed-off-by: Kevin Wolf <kwolf@redhat.com>

diff --git a/block/vmdk.c b/block/vmdk.c
index 74c44bd5fb..67b5f96a19 100644
--- a/block/vmdk.c
+++ b/block/vmdk.c
@@ -661,6 +661,10 @@ static int vmdk_open_vmdk4(BlockDriverState *bs,
     }
     extent->compressed =
         le16_to_cpu(header.compressAlgorithm) == VMDK4_COMPRESSION_DEFLATE;
+    if (extent->compressed) {
+        g_free(s->create_type);
+        s->create_type = g_strdup("streamOptimized");
+    }
     extent->has_marker = le32_to_cpu(header.flags) & VMDK4_FLAG_MARKER;
     extent->version = le32_to_cpu(header.version);
     extent->has_zero_grain = le32_to_cpu(header.flags) & VMDK4_FLAG_ZERO_GRAIN;

