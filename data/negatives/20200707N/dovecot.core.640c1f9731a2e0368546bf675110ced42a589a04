commit 640c1f9731a2e0368546bf675110ced42a589a04
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Oct 29 20:34:31 2012 +0200

    iostream-rawlog: Avoid crashing if write() to rawlog fails.

diff --git a/src/lib/iostream-rawlog.c b/src/lib/iostream-rawlog.c
index a25ce3a65..e88803a24 100644
--- a/src/lib/iostream-rawlog.c
+++ b/src/lib/iostream-rawlog.c
@@ -96,7 +96,7 @@ void iostream_rawlog_write(struct rawlog_iostream *rstream,
 		return;
 	}
 
-	do {
+	while (rstream->rawlog_fd != -1 && size > 0) {
 		p = memchr(data, '\n', size);
 		if (p != NULL) {
 			line_ends = TRUE;
@@ -118,7 +118,7 @@ void iostream_rawlog_write(struct rawlog_iostream *rstream,
 
 		data += pos;
 		size -= pos;
-	} while (size > 0);
+	}
 }
 
 void iostream_rawlog_close(struct rawlog_iostream *rstream)

