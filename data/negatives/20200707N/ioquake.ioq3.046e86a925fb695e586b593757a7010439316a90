commit 046e86a925fb695e586b593757a7010439316a90
Author: Tony J. White = <tjw@tjw.org>
Date:   Thu Feb 1 22:24:45 2007 +0000

    * (bug 3014) my revision 935 broke the sending of the kick/clientkick message
      since SV_DropClient() tried to set the client's state to CS_ZOMBIE prior
      to sending the message.

diff --git a/code/server/sv_client.c b/code/server/sv_client.c
index d2454dce..a0df1ce2 100644
--- a/code/server/sv_client.c
+++ b/code/server/sv_client.c
@@ -493,8 +493,6 @@ void SV_DropClient( client_t *drop, const char *reason ) {
 	// tell everyone why they got dropped
 	SV_SendServerCommand( NULL, "print \"%s" S_COLOR_WHITE " %s\n\"", drop->name, reason );
 
-	Com_DPrintf( "Going to CS_ZOMBIE for %s\n", drop->name );
-	drop->state = CS_ZOMBIE;		// become free in a few seconds
 
 	if (drop->download)	{
 		FS_FCloseFile( drop->download );
@@ -514,6 +512,9 @@ void SV_DropClient( client_t *drop, const char *reason ) {
 
 	// nuke user info
 	SV_SetUserinfo( drop - svs.clients, "" );
+	
+	Com_DPrintf( "Going to CS_ZOMBIE for %s\n", drop->name );
+	drop->state = CS_ZOMBIE;		// become free in a few seconds
 
 	// if this was the last client on the server, send a heartbeat
 	// to the master so it is known the server is empty

