commit 2c4c40ac0052eaf9b14009635ab475362e88c6e0
Author: Rupesh Kumar <rupesh.kumar@stericsson.com>
Date:   Wed Aug 22 15:14:22 2012 +0530

    ab8500-btemp: Defer btemp filtering while initialising
    
    Due to btemp filtering enabled during init, temp values reported
    to charge algorithm driver started from 0. As a result,charge
    algorithm was going into wrong state and charging was stopped.
    
    Signed-off-by: Rupesh Kumar <rupesh.kumar@stericsson.com>
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Reviewed-by: Marcus COOPER <marcus.xm.cooper@stericsson.com>
    Reviewed-by: Martin SJOBLOM <martin.w.sjoblom@stericsson.com>
    Reviewed-by: Philippe LANGLAIS <philippe.langlais@stericsson.com>

diff --git a/drivers/power/ab8500_btemp.c b/drivers/power/ab8500_btemp.c
index fa60e3ac33a3..91ad3edf6197 100644
--- a/drivers/power/ab8500_btemp.c
+++ b/drivers/power/ab8500_btemp.c
@@ -609,7 +609,6 @@ static void ab8500_btemp_periodic_work(struct work_struct *work)
 		struct ab8500_btemp, btemp_periodic_work.work);
 
 	if (!di->initialized) {
-		di->initialized = true;
 		/* Identify the battery */
 		if (ab8500_btemp_id(di) < 0)
 			dev_warn(di->dev, "failed to identify the battery\n");
@@ -622,8 +621,9 @@ static void ab8500_btemp_periodic_work(struct work_struct *work)
 	 * same temperature. Else only allow 1 degree change from previous
 	 * reported value in the direction of the new measurement.
 	 */
-	if (bat_temp == di->prev_bat_temp || !di->initialized) {
-		if (di->bat_temp != di->prev_bat_temp || !di->initialized) {
+	if ((bat_temp == di->prev_bat_temp) || !di->initialized) {
+		if ((di->bat_temp != di->prev_bat_temp) || !di->initialized) {
+			di->initialized = true;
 			di->bat_temp = bat_temp;
 			power_supply_changed(&di->btemp_psy);
 		}

