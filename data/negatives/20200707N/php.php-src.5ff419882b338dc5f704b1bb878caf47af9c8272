commit 5ff419882b338dc5f704b1bb878caf47af9c8272
Author: Jani Taskinen <jani@php.net>
Date:   Sun May 10 21:55:07 2009 +0000

    MFB: missing part of the GC stuff

diff --git a/Zend/zend_operators.h b/Zend/zend_operators.h
index 98980d0995..8334825749 100644
--- a/Zend/zend_operators.h
+++ b/Zend/zend_operators.h
@@ -433,8 +433,8 @@ END_EXTERN_C()
 	}
 
 #define convert_scalar_to_number_ex(ppzv)							\
-	if (Z_TYPE_PP(ppzv)!=IS_LONG && Z_TYPE_PP(ppzv)!=IS_DOUBLE) {		\
-		if (!(*ppzv)->is_ref) {										\
+	if (Z_TYPE_PP(ppzv)!=IS_LONG && Z_TYPE_PP(ppzv)!=IS_DOUBLE) {	\
+		if (!Z_ISREF_PP(ppzv)) {									\
 			SEPARATE_ZVAL(ppzv);									\
 		}															\
 		convert_scalar_to_number(*ppzv TSRMLS_CC);					\

