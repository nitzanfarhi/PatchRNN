commit ed688748ea7b716ccd4964c411fb2a71e0660b67
Author: Poul-Henning Kamp <phk@phk.freebsd.dk>
Date:   Thu Jul 20 09:42:47 2006 +0000

    Loop till we have everything.
    
    
    git-svn-id: http://www.varnish-cache.org/svn/trunk/varnish-cache@514 d4fa192b-c00b-0410-8231-f00ffab90ce4

diff --git a/bin/varnishd/cache_http.c b/bin/varnishd/cache_http.c
index dc1dd829d..4cb2ca103 100644
--- a/bin/varnishd/cache_http.c
+++ b/bin/varnishd/cache_http.c
@@ -140,11 +140,12 @@ http_Read(struct http *hp, int fd, void *p, unsigned len)
 		b += u;
 		len -= u;
 	}
-	if (len > 0) {
+	while (len > 0) {
 		i = read(fd, b, len);
-		if (i < 0)
+		if (i <= 0)
 			return (i);
 		u += i;
+		len -= u;
 	}
 	return (u);
 }

