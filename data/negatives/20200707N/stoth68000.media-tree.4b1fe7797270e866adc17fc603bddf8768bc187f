commit 4b1fe7797270e866adc17fc603bddf8768bc187f
Author: Andreas Schwab <schwab@linux-m68k.org>
Date:   Mon Sep 28 20:10:02 2009 +0200

    tty: fix vt_compat_ioctl
    
    Call compat_unimap_ioctl, not do_unimap_ioctl.
    
    This was broken by commit e9216651.
    
    The compat_unimap_ioctl was originally called do_unimap_ioctl in
    fs/compat_ioctl.h which got moved to drivers/char/vt_ioctl.c.
    In that patch, the caller was not updated and consequently called
    the native handler.
    
    Signed-off-by: Andreas Schwab <schwab@linux-m68k.org>
    Acked-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

diff --git a/drivers/char/vt_ioctl.c b/drivers/char/vt_ioctl.c
index 6b36ee56e6fe..ed86d3bf249a 100644
--- a/drivers/char/vt_ioctl.c
+++ b/drivers/char/vt_ioctl.c
@@ -1532,7 +1532,7 @@ long vt_compat_ioctl(struct tty_struct *tty, struct file * file,
 
 	case PIO_UNIMAP:
 	case GIO_UNIMAP:
-		ret = do_unimap_ioctl(cmd, up, perm, vc);
+		ret = compat_unimap_ioctl(cmd, up, perm, vc);
 		break;
 
 	/*

