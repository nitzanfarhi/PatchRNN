commit 28148c211ccc57c50a1bbdf9a77dda9dbd30af4c
Author: alex <alex@b3059339-0415-0410-9bf9-f77b7e298cf2>
Date:   Mon Jan 13 10:08:21 2003 +0000

    M6 bug workaround by Hanno Bock <hanno@gmx.de>
    
    
    git-svn-id: svn://svn.mplayerhq.hu/mplayer/trunk@8942 b3059339-0415-0410-9bf9-f77b7e298cf2

diff --git a/drivers/radeon/radeonfb.c b/drivers/radeon/radeonfb.c
index 69d29afb54..84fec539d7 100644
--- a/drivers/radeon/radeonfb.c
+++ b/drivers/radeon/radeonfb.c
@@ -1108,6 +1108,16 @@ static int radeonfb_pci_register (struct pci_dev *pdev,
 	/* mem size is bits [28:0], mask off the rest */
 	rinfo->video_ram = tmp & CONFIG_MEMSIZE_MASK;
 
+	/* according to XFree86 4.2.0, some production M6's return
+	   0 for 8MB */
+	if (rinfo->video_ram == 0 && 
+	    (pdev->device == PCI_DEVICE_ID_RADEON_LY ||
+	     pdev->device == PCI_DEVICE_ID_RADEON_LZ))
+	{
+	    rinfo->video_ram = 8192*1024;
+	    printk("radeonfb: workarounding buggy Radeon M6 (0 vs 8MB memory)\n");
+	}
+
 	/* ram type */
 	rinfo->MemCntl = INREG(MEM_SDRAM_MODE_REG);
 	switch ((MEM_CFG_TYPE & rinfo->MemCntl) >> 30) {

