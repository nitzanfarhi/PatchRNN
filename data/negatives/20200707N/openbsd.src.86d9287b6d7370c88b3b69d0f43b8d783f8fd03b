commit 86d9287b6d7370c88b3b69d0f43b8d783f8fd03b
Author: deraadt <deraadt@openbsd.org>
Date:   Tue Mar 4 15:30:18 2008 +0000

    Do not permit insertion of a "" symbolic link translation into the path
    translation; abort with ENOENT; ok millert kettenis thib, pr #5752

diff --git a/sys/kern/vfs_lookup.c b/sys/kern/vfs_lookup.c
index 09c59058d34..db8643ff992 100644
--- a/sys/kern/vfs_lookup.c
+++ b/sys/kern/vfs_lookup.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: vfs_lookup.c,v 1.37 2007/09/08 01:45:58 hshoexer Exp $	*/
+/*	$OpenBSD: vfs_lookup.c,v 1.38 2008/03/04 15:30:18 deraadt Exp $	*/
 /*	$NetBSD: vfs_lookup.c,v 1.17 1996/02/09 19:00:59 christos Exp $	*/
 
 /*
@@ -220,6 +220,10 @@ badlink:
 			break;
 		}
 		linklen = MAXPATHLEN - auio.uio_resid;
+		if (linklen == 0) {
+			error = ENOENT;
+			goto badlink;
+		}
 		if (linklen + ndp->ni_pathlen >= MAXPATHLEN) {
 			error = ENAMETOOLONG;
 			goto badlink;

