commit 0ff1f9f585712684dc46cb6cb6a46a8cc160b2ae
Author: Orit Wasserman <owasserm@redhat.com>
Date:   Tue Jun 19 11:51:37 2012 +0300

    Add missing check for host_from_stream_offset return value for RAM_SAVE_FLAG_PAGE
    
    Signed-off-by: Orit Wasserman <owasserm@redhat.com>

diff --git a/arch_init.c b/arch_init.c
index a9e8b7442b..81c2e5443f 100644
--- a/arch_init.c
+++ b/arch_init.c
@@ -483,6 +483,9 @@ int ram_load(QEMUFile *f, void *opaque, int version_id)
             void *host;
 
             host = host_from_stream_offset(f, addr, flags);
+            if (!host) {
+                return -EINVAL;
+            }
 
             qemu_get_buffer(f, host, TARGET_PAGE_SIZE);
         }

