commit 08ed54f365d20ed6ea7275787e853c359aa9385b
Author: Vasumathi Sundaram <Vasumathi.Sundaram@oracle.COM>
Date:   Thu Aug 12 09:27:28 2010 -0400

    6975991 ipadm show-addr does not show tunnel destination address

diff --git a/usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c b/usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c
index 5e6712f0c0..5902431a63 100644
--- a/usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c
+++ b/usr/src/cmd/cmd-inet/usr.sbin/ipadm/ipadm.c
@@ -1763,20 +1763,18 @@ print_sa_cb(ofmt_arg_t *ofarg, char *buf, uint_t bufsize)
 				}
 				break;
 			}
-			/*
-			 * For the non-persistent case, we need to show the
-			 * currently configured addresses for source and
-			 * destination.
-			 */
-			if (ifa->ifa_flags & IFF_POINTOPOINT) {
-				sockaddr2str(
-				    (struct sockaddr_storage *)ifa->ifa_dstaddr,
-				    dstbuf, sizeof (dstbuf));
-			}
 		}
+		/*
+		 * For the non-persistent case, we need to show the
+		 * currently configured addresses for source and
+		 * destination.
+		 */
 		sockaddr2str((struct sockaddr_storage *)ifa->ifa_addr,
 		    addrbuf, sizeof (addrbuf));
-		if (dstbuf[0] != '\0') {
+		if (ifa->ifa_flags & IFF_POINTOPOINT) {
+			sockaddr2str(
+			    (struct sockaddr_storage *)ifa->ifa_dstaddr,
+			    dstbuf, sizeof (dstbuf));
 			(void) snprintf(buf, bufsize, "%s->%s", addrbuf,
 			    dstbuf);
 		} else {
diff --git a/usr/src/lib/libsocket/inet/getifaddrs.c b/usr/src/lib/libsocket/inet/getifaddrs.c
index cca013aa40..df6d4199d1 100644
--- a/usr/src/lib/libsocket/inet/getifaddrs.c
+++ b/usr/src/lib/libsocket/inet/getifaddrs.c
@@ -183,7 +183,7 @@ retry:
 			    sizeof (struct sockaddr_storage));
 			if (curr->ifa_dstaddr == NULL)
 				goto fail;
-			(void) memcpy(curr->ifa_dstaddr, &lifrp->lifr_addr,
+			(void) memcpy(curr->ifa_dstaddr, &lifrl.lifr_addr,
 			    sizeof (struct sockaddr_storage));
 		} else if (curr->ifa_flags & IFF_BROADCAST) {
 			if (ioctl(s, SIOCGLIFBRDADDR, (caddr_t)&lifrl) < 0)
@@ -192,7 +192,7 @@ retry:
 			    sizeof (struct sockaddr_storage));
 			if (curr->ifa_broadaddr == NULL)
 				goto fail;
-			(void) memcpy(curr->ifa_broadaddr, &lifrp->lifr_addr,
+			(void) memcpy(curr->ifa_broadaddr, &lifrl.lifr_addr,
 			    sizeof (struct sockaddr_storage));
 		}
 

