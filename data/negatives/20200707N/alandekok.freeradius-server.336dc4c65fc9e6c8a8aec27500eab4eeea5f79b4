commit 336dc4c65fc9e6c8a8aec27500eab4eeea5f79b4
Author: Alan T. DeKok <aland@freeradius.org>
Date:   Mon Sep 1 11:05:51 2008 +0200

    leverage rlm_dynamic_clients

diff --git a/src/main/listen.c b/src/main/listen.c
index 094477eec..3263252ea 100644
--- a/src/main/listen.c
+++ b/src/main/listen.c
@@ -235,8 +235,22 @@ RADCLIENT *client_listener_find(const rad_listen_t *listener,
 		return NULL;
 	}
 
-	created = client_create(clients, request);
+	/*
+	 *	If the client was updated by rlm_dynamic_clients,
+	 *	don't create the client from attribute-value pairs.
+	 */
+	if (request->client == client) {
+		created = client_create(clients, request);
+	} else {
+		created = request->client;
 
+		/*
+		 *	This frees the client if it isn't valid.
+		 */
+		if (!client_validate(clients, request, created)) {
+			return NULL;
+		}
+	}
 	request_free(&request);
 
 	return created;		/* may be NULL */

