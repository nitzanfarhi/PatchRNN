commit cd330c4bc5ae3e2e89a5c02a031ffd90292e94f1
Author: Attila Molnar <attilamolnar@hush.com>
Date:   Mon Jul 28 14:21:20 2014 +0200

    m_spanningtree Ensure that TreeSocket::Close() only runs once

diff --git a/src/modules/m_spanningtree/treesocket2.cpp b/src/modules/m_spanningtree/treesocket2.cpp
index 25cc751e4..7e26a325e 100644
--- a/src/modules/m_spanningtree/treesocket2.cpp
+++ b/src/modules/m_spanningtree/treesocket2.cpp
@@ -344,8 +344,10 @@ void TreeSocket::OnTimeout()
 
 void TreeSocket::Close()
 {
-	if (fd != -1)
-		ServerInstance->GlobalCulls.AddItem(this);
+	if (fd < 0)
+		return;
+
+	ServerInstance->GlobalCulls.AddItem(this);
 	this->BufferedSocket::Close();
 	SetError("Remote host closed connection");
 

