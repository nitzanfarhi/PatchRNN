commit 7cb793ae50d7d35341d9987703549da7dc3ec43f
Author: Igor Tsiglyar <igor_tsiglyar@outlook.com>
Date:   Wed Mar 1 19:22:47 2017 +0300

    Fix: TE: don't bump counters when action or synapse is invalid

diff --git a/lib/transition/unpack.c b/lib/transition/unpack.c
index b679d7985..e9cc1785c 100644
--- a/lib/transition/unpack.c
+++ b/lib/transition/unpack.c
@@ -134,10 +134,11 @@ unpack_synapse(crm_graph_t * new_graph, xmlNode * xml_synapse)
         new_synapse->priority = crm_parse_int(value, NULL);
     }
 
-    new_graph->num_synapses++;
     CRM_CHECK(new_synapse->id >= 0, free(new_synapse);
               return NULL);
 
+    new_graph->num_synapses++;
+
     new_synapse->graph = new_graph;
 
     crm_trace("look for actions in synapse %s", crm_element_value(xml_synapse, XML_ATTR_ID));
@@ -151,11 +152,12 @@ unpack_synapse(crm_graph_t * new_graph, xmlNode * xml_synapse)
                  action = __xml_next(action)) {
                 crm_action_t *new_action = unpack_action(new_synapse, action);
 
-                new_graph->num_actions++;
-
                 if (new_action == NULL) {
                     continue;
                 }
+
+                new_graph->num_actions++;
+
                 crm_trace("Adding action %d to synapse %d", new_action->id, new_synapse->id);
 
                 new_synapse->actions = g_list_append(new_synapse->actions, new_action);

