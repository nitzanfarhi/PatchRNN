commit 2040b52768ebab6e7bd73af0dc63703269c62f17
Author: Josh Cartwright <joshc@codeaurora.org>
Date:   Thu Mar 13 16:36:36 2014 -0500

    of: only scan for reserved mem when fdt present
    
    When the reserved memory patches hit -next, several legacy (non-DT) boot
    failures were detected and bisected down to that commit. There needs to
    be some sanity checking whether a DT is even present before parsing the
    reserved ranges.
    
    Reported-by: Kevin Hilman <khilman@linaro.org>
    Signed-off-by: Josh Cartwright <joshc@codeaurora.org>
    Tested-by: Kevin Hilman <khilman@linaro.org>
    Signed-off-by: Grant Likely <grant.likely@linaro.org>

diff --git a/drivers/of/fdt.c b/drivers/of/fdt.c
index 510c0d8de8a0..501bc83f8cdf 100644
--- a/drivers/of/fdt.c
+++ b/drivers/of/fdt.c
@@ -557,6 +557,9 @@ static int __init __fdt_scan_reserved_mem(unsigned long node, const char *uname,
  */
 void __init early_init_fdt_scan_reserved_mem(void)
 {
+	if (!initial_boot_params)
+		return;
+
 	of_scan_flat_dt(__fdt_scan_reserved_mem, NULL);
 	fdt_init_reserved_mem();
 }

