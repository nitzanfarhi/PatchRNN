commit 4327285af9454e401e60c20ff22ccb448f339d4d
Author: cristy <urban-warrior@git.imagemagick.org>
Date:   Mon Jan 19 01:30:15 2015 +0000

diff --git a/MagickCore/resource.c b/MagickCore/resource.c
index 6eb25a53e..330d79a48 100644
--- a/MagickCore/resource.c
+++ b/MagickCore/resource.c
@@ -500,7 +500,12 @@ MagickExport int AcquireUniqueFileResource(char *path)
   assert(path != (char *) NULL);
   (void) LogMagickEvent(ResourceEvent,GetMagickModule(),"...");
   if (random_info == (RandomInfo *) NULL)
-    random_info=AcquireRandomInfo();
+    {
+      LockSemaphoreInfo(resource_semaphore);
+      if (random_info == (RandomInfo *) NULL)
+        random_info=AcquireRandomInfo();
+      UnlockSemaphoreInfo(resource_semaphore);
+    }
   file=(-1);
   for (i=0; i < (ssize_t) TMP_MAX; i++)
   {

