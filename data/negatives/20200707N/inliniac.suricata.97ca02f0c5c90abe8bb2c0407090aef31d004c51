commit 97ca02f0c5c90abe8bb2c0407090aef31d004c51
Author: Eric Leblond <eric@regit.org>
Date:   Tue Jun 17 11:19:05 2014 +0200

    defrag: fix reconstruction
    
    This patch is fixing an issue in defragmentation code. The
    insertion of a fragment in the list of fragments is done with
    respect to the offset of the fragment. But the code was using
    the original offset of the fragment and not the one of the
    new reconstructed fragment (which can be different in the
    case of overlapping segment where the left part is trimmed).
    
    This case could lead to some evasion techniques by causing
    Suricata to analyse a different payload.

diff --git a/src/defrag.c b/src/defrag.c
index bd2c6e85..f7243537 100644
--- a/src/defrag.c
+++ b/src/defrag.c
@@ -697,7 +697,7 @@ insert:
 
     Frag *frag;
     TAILQ_FOREACH(frag, &tracker->frags, next) {
-        if (frag_offset < frag->offset)
+        if (new->offset < frag->offset)
             break;
     }
     if (frag == NULL) {

