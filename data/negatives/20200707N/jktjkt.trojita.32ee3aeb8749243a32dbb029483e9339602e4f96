commit 32ee3aeb8749243a32dbb029483e9339602e4f96
Author: Jan Kundr√°t <jkt@flaska.net>
Date:   Sat Aug 18 16:08:46 2012 +0200

    Make sure that the BINARY responses are parsed correctly
    
    And *finally* cover that by at least the minimal set of unit tests.
    
    refs #503

diff --git a/src/Imap/Parser/LowLevelParser.cpp b/src/Imap/Parser/LowLevelParser.cpp
index 6dad83fb..ee0787d7 100644
--- a/src/Imap/Parser/LowLevelParser.cpp
+++ b/src/Imap/Parser/LowLevelParser.cpp
@@ -231,7 +231,7 @@ QVariant getAnything(const QByteArray &line, int &start)
     } else if (line[start] == '(') {
         QVariant res = parseList('(', ')', line, start);
         return res;
-    } else if (line[start] == '"' || line[start] == '{') {
+    } else if (line[start] == '"' || line[start] == '{' || line[start] == '~') {
         QPair<QByteArray,ParsedAs> res = getString(line, start);
         return res.first;
     } else if (line.mid(start, 3).toUpper() == "NIL") {
diff --git a/tests/tests/test_Imap_LowLevelParser/test_Imap_LowLevelParser.cpp b/tests/tests/test_Imap_LowLevelParser/test_Imap_LowLevelParser.cpp
index 138098b8..58537c94 100644
--- a/tests/tests/test_Imap_LowLevelParser/test_Imap_LowLevelParser.cpp
+++ b/tests/tests/test_Imap_LowLevelParser/test_Imap_LowLevelParser.cpp
@@ -150,6 +150,18 @@ void ImapLowLevelParserTest::testGetString()
     QCOMPARE( res.first, QByteArray("666") );
     QCOMPARE( res.second, LITERAL );
     QCOMPARE( pos, line.size() );
+    pos = 0;
+    QCOMPARE(getAnything(line, pos).toByteArray(), QByteArray("666"));
+    QCOMPARE(pos, line.size());
+
+    line = "~{3}\r\n666"; pos = 0;
+    res = getString( line, pos );
+    QCOMPARE( res.first, QByteArray("666") );
+    QCOMPARE( res.second, LITERAL8 );
+    QCOMPARE( pos, line.size() );
+    pos = 0;
+    QCOMPARE(getAnything(line, pos).toByteArray(), QByteArray("666"));
+    QCOMPARE(pos, line.size());
 
     QByteArray myData;
     myData.append('\x00');

