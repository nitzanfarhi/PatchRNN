commit 1989b5ceb5aa57862ed770368ae90bf44fd13198
Author: Alexander Shishkin <alexander.shishkin@linux.intel.com>
Date:   Fri May 11 17:25:40 2012 +0300

    usb: gadget: ci13xxx_pci: guard against devices without driver_data
    
    Don't try to initialize devices that don't have driver_data assigned
    to their pci ids.
    
    Reported-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Alexander Shishkin <alexander.shishkin@linux.intel.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/usb/gadget/ci13xxx_pci.c b/drivers/usb/gadget/ci13xxx_pci.c
index c76844110e36..f075ef33834f 100644
--- a/drivers/usb/gadget/ci13xxx_pci.c
+++ b/drivers/usb/gadget/ci13xxx_pci.c
@@ -51,6 +51,11 @@ static int __devinit ci13xxx_pci_probe(struct pci_dev *pdev,
 	struct resource res[3];
 	int retval = 0, nres = 2;
 
+	if (!driver) {
+		dev_err(&pdev->dev, "device doesn't provide driver data\n");
+		return -ENODEV;
+	}
+
 	retval = pci_enable_device(pdev);
 	if (retval)
 		goto done;

