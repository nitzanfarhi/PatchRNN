commit f8c96d011e72f52513c62cec63ae76ff24e4f135
Author: Reimar DÃ¶ffinger <Reimar.Doeffinger@gmx.de>
Date:   Mon Feb 23 15:18:28 2009 +0000

    Check return value of ff_fill_pointer in avcodec_default_get_buffer,
    if it returns -1 we do not know how to allocate an AVFrame for that format
    and must return -1 instead of returning nonsense.
    
    Originally committed as revision 17542 to svn://svn.ffmpeg.org/ffmpeg/trunk

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index 2ae5ce4fd4..f9b9a30049 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -271,6 +271,8 @@ int avcodec_default_get_buffer(AVCodecContext *s, AVFrame *pic){
         }
 
         tmpsize = ff_fill_pointer(&picture, NULL, s->pix_fmt, h);
+        if (tmpsize < 0)
+            return -1;
 
         for (i=0; i<3 && picture.data[i+1]; i++)
             size[i] = picture.data[i+1] - picture.data[i];

