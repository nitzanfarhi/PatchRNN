commit 093563b6676f1dfd4e42469251849b3bdb512c87
Author: Gerald Combs <gerald@wireshark.org>
Date:   Fri Sep 18 09:09:38 2015 -0700

    Sync GTK+ and Qt progress timer logic.
    
    The GTK+ update_progress_dlg() initially forces a UI update. Do so in
    the Qt version as well.
    
    Change-Id: I05d9e61a0d0e4e05af448039bbb81785ac00908c
    Reviewed-on: https://code.wireshark.org/review/10568
    Petri-Dish: Gerald Combs <gerald@wireshark.org>
    Tested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>
    Reviewed-by: Gerald Combs <gerald@wireshark.org>

diff --git a/ui/qt/progress_frame.cpp b/ui/qt/progress_frame.cpp
index 91c8072d0c..5c206fcafe 100644
--- a/ui/qt/progress_frame.cpp
+++ b/ui/qt/progress_frame.cpp
@@ -36,7 +36,6 @@
 #include "wireshark_application.h"
 
 // To do:
-// - Use a different icon?
 // - Add an NSProgressIndicator to the dock icon on OS X.
 // - Start adding the progress bar to dialogs.
 // - Don't complain so loudly when the user stops a capture.
@@ -81,7 +80,9 @@ static const int app_update_freq_ = 100; // ms
 void
 update_progress_dlg(progdlg_t *dlg, gfloat percentage, const gchar *)
 {
-    if (!dlg || dlg->elapsed_timer->elapsed() < app_update_freq_) return;
+    if (!dlg) return;
+    if (dlg->elapsed_timer->isValid() && !dlg->elapsed_timer->hasExpired(app_update_freq_)) return;
+    dlg->elapsed_timer->restart();
 
     dlg->progress_frame->setValue(percentage * 100);
 
@@ -89,7 +90,6 @@ update_progress_dlg(progdlg_t *dlg, gfloat percentage, const gchar *)
      * Flush out the update and process any input events.
      */
     WiresharkApplication::processEvents();
-    dlg->elapsed_timer->restart();
 
     /* Redraw so the progress bar shows the update */
     dlg->progress_frame->update();
@@ -170,7 +170,7 @@ struct progdlg *ProgressFrame::showProgress(bool animate, bool terminate_is_stop
 {
     setMaximumValue(100);
     ui->progressBar->setValue(value);
-    progress_dialog_.elapsed_timer->start();
+    progress_dialog_.elapsed_timer->invalidate();
     emit showRequested(animate, terminate_is_stop, stop_flag);
     return &progress_dialog_;
 }

