commit bac0382c6ad764156025978845147e5a6eccca09
Author: Hillf Danton <dhillf@gmail.com>
Date:   Tue Nov 27 14:46:24 2012 +0000

    mm: numa: migrate: Set last_nid on newly allocated page
    
    Pass last_nid from misplaced page to newly allocated migration target page.
    
    Signed-off-by: Hillf Danton <dhillf@gmail.com>
    Signed-off-by: Mel Gorman <mgorman@suse.de>

diff --git a/mm/migrate.c b/mm/migrate.c
index 32a1afca6009..2a5ce135eef0 100644
--- a/mm/migrate.c
+++ b/mm/migrate.c
@@ -1457,6 +1457,9 @@ static struct page *alloc_misplaced_dst_page(struct page *page,
 					  __GFP_NOMEMALLOC | __GFP_NORETRY |
 					  __GFP_NOWARN) &
 					 ~GFP_IOFS, 0);
+	if (newpage)
+		page_xchg_last_nid(newpage, page_last_nid(page));
+
 	return newpage;
 }
 

