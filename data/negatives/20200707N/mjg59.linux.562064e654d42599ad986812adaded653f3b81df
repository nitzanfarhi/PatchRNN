commit 562064e654d42599ad986812adaded653f3b81df
Author: Johan Hedberg <johan.hedberg@intel.com>
Date:   Tue Jul 8 16:35:34 2014 +0300

    Bluetooth: Fix toggling background scan when changing connectable state
    
    If the connectable state change doesn't require any special HCI commands
    the set_connectable_update_settings() function is used instead of the
    set_connectable_complete() function. We must therefore make sure to call
    hci_update_background_scan() there as well. This code path is used also
    when we're powered off, but that's fine since hci_update_background_scan()
    has the necessary checks for it.
    
    Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
    Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

diff --git a/net/bluetooth/mgmt.c b/net/bluetooth/mgmt.c
index 376b164c5250..216aa93514b6 100644
--- a/net/bluetooth/mgmt.c
+++ b/net/bluetooth/mgmt.c
@@ -1794,8 +1794,10 @@ static int set_connectable_update_settings(struct hci_dev *hdev,
 	if (err < 0)
 		return err;
 
-	if (changed)
+	if (changed) {
+		hci_update_background_scan(hdev);
 		return new_settings(hdev, sk);
+	}
 
 	return 0;
 }

