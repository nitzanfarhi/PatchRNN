commit 390f3258cb2d031f1c17aa32e771ebd336e89073
Author: Kirill Tkhai <ktkhai@parallels.com>
Date:   Tue Jan 28 11:26:14 2014 +0400

    sched/deadline: Skip in switched_to_dl() if task is current
    
    When p is current and it's not of dl class, then there are no other
    dl taks in the rq. If we had had pushable tasks in some other rq,
    they would have been pushed earlier. So, skip "p == rq->curr" case.
    
    Signed-off-by: Kirill Tkhai <ktkhai@parallels.com>
    Acked-by: Juri Lelli <juri.lelli@gmail.com>
    Signed-off-by: Peter Zijlstra <peterz@infradead.org>
    Link: http://lkml.kernel.org/r/20140128072421.32315.25300.stgit@tkhai
    Signed-off-by: Ingo Molnar <mingo@kernel.org>

diff --git a/kernel/sched/deadline.c b/kernel/sched/deadline.c
index 0dd5e0971a07..b5700bceee55 100644
--- a/kernel/sched/deadline.c
+++ b/kernel/sched/deadline.c
@@ -1560,7 +1560,7 @@ static void switched_to_dl(struct rq *rq, struct task_struct *p)
 	if (unlikely(p->dl.dl_throttled))
 		return;
 
-	if (p->on_rq || rq->curr != p) {
+	if (p->on_rq && rq->curr != p) {
 #ifdef CONFIG_SMP
 		if (rq->dl.overloaded && push_dl_task(rq) && rq != task_rq(p))
 			/* Only reschedule if pushing failed */

