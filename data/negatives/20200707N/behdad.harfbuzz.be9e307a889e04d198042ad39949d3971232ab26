commit be9e307a889e04d198042ad39949d3971232ab26
Author: Behdad Esfahbod <behdad@behdad.org>
Date:   Fri Dec 1 12:36:26 2017 -0800

    [ot] Ensure layout in hb_ot_layout_table_get_lookup_count()

diff --git a/src/hb-ot-layout.cc b/src/hb-ot-layout.cc
index 8fe15313..88458898 100644
--- a/src/hb-ot-layout.cc
+++ b/src/hb-ot-layout.cc
@@ -601,6 +601,7 @@ unsigned int
 hb_ot_layout_table_get_lookup_count (hb_face_t    *face,
 				     hb_tag_t      table_tag)
 {
+  if (unlikely (!hb_ot_shaper_face_data_ensure (face))) return 0;
   switch (table_tag)
   {
     case HB_OT_TAG_GSUB:

