commit 10aaa64769d960c345f0b0780edae27941da83a4
Author: gilles <gilles@openbsd.org>
Date:   Wed Mar 18 10:29:27 2009 +0000

    we can no longer create batches of MDA deliveries, so make sure runner
    does not do a batch lookup when dealing with a MDA message

diff --git a/usr.sbin/smtpd/runner.c b/usr.sbin/smtpd/runner.c
index 5e0c7bca9f2..48176e88abf 100644
--- a/usr.sbin/smtpd/runner.c
+++ b/usr.sbin/smtpd/runner.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: runner.c,v 1.35 2009/03/15 19:15:25 gilles Exp $	*/
+/*	$OpenBSD: runner.c,v 1.36 2009/03/18 10:29:27 gilles Exp $	*/
 
 /*
  * Copyright (c) 2008 Gilles Chehade <gilles@openbsd.org>
@@ -867,6 +867,10 @@ batch_lookup(struct smtpd *env, struct message *message)
 	struct batch *batchp;
 	struct batch lookup;
 
+	/* We only support delivery of one message at a time, in MDA */
+	if (message->flags & T_MDA_MESSAGE)
+		return NULL;
+
 	/* If message->batch_id != 0, we can retrieve batch by id */
 	if (message->batch_id != 0) {
 		lookup.id = message->batch_id;

