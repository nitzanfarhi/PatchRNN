commit 32bb404a6a4d726dfd691f75704f08257ce65ffe
Author: Markus Armbruster <armbru@redhat.com>
Date:   Thu Feb 25 11:23:52 2010 +0100

    scsi: Make device scsi-disk reject /dev/sg*
    
    You're supposed to use scsi-generic for that.  Which rejects anything
    but /dev/sg*.
    
    Signed-off-by: Markus Armbruster <armbru@redhat.com>
    Signed-off-by: Anthony Liguori <aliguori@us.ibm.com>

diff --git a/hw/scsi-disk.c b/hw/scsi-disk.c
index 522f521649..8f7ffc143d 100644
--- a/hw/scsi-disk.c
+++ b/hw/scsi-disk.c
@@ -1031,6 +1031,11 @@ static int scsi_disk_initfn(SCSIDevice *dev)
     }
     s->bs = s->qdev.conf.dinfo->bdrv;
 
+    if (bdrv_is_sg(s->bs)) {
+        qemu_error("scsi-disk: unwanted /dev/sg*\n");
+        return -1;
+    }
+
     if (bdrv_get_type_hint(s->bs) == BDRV_TYPE_CDROM) {
         s->cluster_size = 4;
     } else {

