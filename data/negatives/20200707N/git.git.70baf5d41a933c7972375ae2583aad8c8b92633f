commit 70baf5d41a933c7972375ae2583aad8c8b92633f
Author: Nicolas Pitre <nico@cam.org>
Date:   Fri May 2 15:11:51 2008 -0400

    pack-objects: fix early eviction for max depth delta objects
    
    The 'depth' variable doesn't reflect the actual maximum depth used
    when other objects already depend on the current one.
    
    Signed-off-by: Nicolas Pitre <nico@cam.org>
    Signed-off-by: Junio C Hamano <gitster@pobox.com>

diff --git a/builtin-pack-objects.c b/builtin-pack-objects.c
index 4a0c9c907..e20851e1c 100644
--- a/builtin-pack-objects.c
+++ b/builtin-pack-objects.c
@@ -1486,7 +1486,7 @@ static void find_deltas(struct object_entry **list, unsigned *list_size,
 		 * depth, leaving it in the window is pointless.  we
 		 * should evict it first.
 		 */
-		if (entry->delta && depth <= n->depth)
+		if (entry->delta && max_depth <= n->depth)
 			continue;
 
 		/*

