commit 60d8f0b2bce1f9b502fb2cddf135592050e411f7
Author: marko <Unknown>
Date:   Thu Apr 23 06:40:34 2009 +0000

    branches/zip: row_scan_and_check_index(): Check
    row_merge_is_index_usable() earlier, to make the logic clearer.

diff --git a/row/row0mysql.c b/row/row0mysql.c
index 0f74bfeff25..2d6d6217bd8 100644
--- a/row/row0mysql.c
+++ b/row/row0mysql.c
@@ -3943,6 +3943,10 @@ row_scan_and_check_index(
 
 	*n_rows = 0;
 
+	if (!row_merge_is_index_usable(prebuilt->trx, index)) {
+		return(is_ok);
+	}
+
 	buf = mem_alloc(UNIV_PAGE_SIZE);
 	heap = mem_heap_create(100);
 
@@ -3950,8 +3954,7 @@ row_scan_and_check_index(
 	in scanning the index entries */
 
 	prebuilt->index = index;
-	prebuilt->index_usable = row_merge_is_index_usable(prebuilt->trx,
-							   index);
+	prebuilt->index_usable = TRUE;
 	prebuilt->sql_stat_start = TRUE;
 	prebuilt->template_type = ROW_MYSQL_DUMMY_TEMPLATE;
 	prebuilt->n_template = 0;

