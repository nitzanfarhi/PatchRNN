commit ed087a257f82dc6bc38b5abf343f0e6429278b42
Author: Eliot Horowitz <eliot@10gen.com>
Date:   Thu Apr 22 13:32:22 2010 -0400

    only 1 auto split at a time

diff --git a/s/chunk.cpp b/s/chunk.cpp
index c3798cf725..c13c1e5324 100644
--- a/s/chunk.cpp
+++ b/s/chunk.cpp
@@ -27,6 +27,8 @@
 
 namespace mongo {
 
+    RWLock chunkSplitLock;
+
     // -------  Shard --------
 
     int Chunk::MaxChunkSize = 1024 * 1204 * 200;
@@ -254,7 +256,12 @@ namespace mongo {
         if ( _dataWritten < MaxChunkSize / 5 )
             return false;
         
-        log(1) << "\t want to split chunk : " << this << endl;
+        if ( ! chunkSplitLock.lock_try(0) )
+            return false;
+        
+        rwlock lk( chunkSplitLock , 1 , true );
+
+        log(1) << "\t splitIfShould : " << this << endl;
 
         _dataWritten = 0;
         

