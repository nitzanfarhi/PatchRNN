commit c449e0b0843381306cc196affcd5a38a40804178
Author: Timo Sirainen <tss@iki.fi>
Date:   Fri Mar 28 15:29:53 2014 +0200

    lib-fs: ostream-metawrap shouldn't count metadata header as part of the stream offsets.

diff --git a/src/lib-fs/ostream-metawrap.c b/src/lib-fs/ostream-metawrap.c
index 1d324e10f..6ad8a94bf 100644
--- a/src/lib-fs/ostream-metawrap.c
+++ b/src/lib-fs/ostream-metawrap.c
@@ -17,6 +17,8 @@ static void o_stream_metawrap_call_callback(struct metawrap_ostream *mstream)
 	if (write_callback != NULL) {
 		mstream->write_callback = NULL;
 		write_callback(mstream->context);
+		/* metadata headers aren't counted as part of the offset */
+		mstream->ostream.ostream.offset = 0;
 	}
 }
 

