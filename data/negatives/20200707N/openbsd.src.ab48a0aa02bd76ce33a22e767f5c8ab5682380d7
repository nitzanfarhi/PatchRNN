commit ab48a0aa02bd76ce33a22e767f5c8ab5682380d7
Author: henning <henning@openbsd.org>
Date:   Tue Jul 30 08:23:28 2002 +0000

    two more strip_chroot
    found by Steph <sengel@melshake.com>, who also tested this.
    I'm very happy with the way you help here. Thanks a lot.

diff --git a/usr.sbin/httpd/src/modules/standard/mod_rewrite.c b/usr.sbin/httpd/src/modules/standard/mod_rewrite.c
index f138b546c52..953b351572a 100644
--- a/usr.sbin/httpd/src/modules/standard/mod_rewrite.c
+++ b/usr.sbin/httpd/src/modules/standard/mod_rewrite.c
@@ -515,6 +515,10 @@ static const char *cmd_rewritemap(cmd_parms *cmd, void *dconf, char *a1,
     new->fpin  = -1;
     new->fpout = -1;
 
+    /* yes, we do it twice. needed for restart awareness */
+    ap_server_strip_chroot(new->checkfile, 0);
+    ap_server_strip_chroot(new->datafile, 0);
+
     if (new->checkfile && (sconf->state == ENGINE_ENABLED)
         && (stat(new->checkfile, &st) == -1)) {
         return ap_pstrcat(cmd->pool,
@@ -522,6 +526,9 @@ static const char *cmd_rewritemap(cmd_parms *cmd, void *dconf, char *a1,
                           new->checkfile, NULL);
     }
 
+    ap_server_strip_chroot(new->checkfile, 1);
+    ap_server_strip_chroot(new->datafile, 1);
+
     return NULL;
 }
 

