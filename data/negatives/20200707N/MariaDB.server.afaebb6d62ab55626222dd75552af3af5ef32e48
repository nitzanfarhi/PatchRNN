commit afaebb6d62ab55626222dd75552af3af5ef32e48
Author: svoj@mysql.com/june.mysql.com <>
Date:   Mon Jan 22 16:34:58 2007 +0400

    BUG#24401 - MySQL server crashes if you try to retrieve data from
                corrupted table
    
    Accessing a table with corrupted column definition results in server
    crash.
    
    This is fixed by refusing to open such tables. Affects MyISAM only.
    No test case, since it requires crashed table.

diff --git a/myisam/mi_open.c b/myisam/mi_open.c
index 047686278b4..b007eb63e63 100644
--- a/myisam/mi_open.c
+++ b/myisam/mi_open.c
@@ -435,6 +435,13 @@ MI_INFO *mi_open(const char *name, int mode, uint open_flags)
       offset+=share->rec[i].length;
     }
     share->rec[i].type=(int) FIELD_LAST;	/* End marker */
+    if (offset > share->base.reclength)
+    {
+      /* purecov: begin inspected */
+      my_errno= HA_ERR_CRASHED;
+      goto err;
+      /* purecov: end */
+    }
 
     if (! lock_error)
     {

