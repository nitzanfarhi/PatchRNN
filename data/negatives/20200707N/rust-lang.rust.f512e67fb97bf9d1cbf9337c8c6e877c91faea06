commit f512e67fb97bf9d1cbf9337c8c6e877c91faea06
Author: Niko Matsakis <niko@alum.mit.edu>
Date:   Tue Dec 13 16:53:10 2011 -0800

    clone type desc into exchange heap

diff --git a/src/rt/rust_upcall.cpp b/src/rt/rust_upcall.cpp
index d91e282d2e..754a1f2d18 100644
--- a/src/rt/rust_upcall.cpp
+++ b/src/rt/rust_upcall.cpp
@@ -202,11 +202,14 @@ struct s_clone_type_desc_args {
 
 void upcall_s_clone_type_desc(s_clone_type_desc_args *args)
 {
+    rust_task *task = rust_scheduler::get_task();
+    LOG_UPCALL_ENTRY(task);
+
     // Copy the main part of the type descriptor:
     const type_desc *td = args->td;
     int n_descs = td->n_descs;
     size_t sz = sizeof(type_desc) + sizeof(type_desc*) * n_descs;
-    args->res = (type_desc*) malloc(sz);
+    args->res = (type_desc*) task->kernel->malloc(sz, "clone_type_desc");
     memcpy(args->res, td, sizeof(type_desc));
 
     // Recursively copy any referenced descriptors:

