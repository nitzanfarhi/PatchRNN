commit 04c8a9554e34ad1afed9291e673cd452ee93e849
Author: Timo Sirainen <timo.sirainen@dovecot.fi>
Date:   Fri Nov 17 14:56:20 2017 +0200

    director: Make sure user's timestamp isn't set to future
    
    The sending director could have the system clock slightly in the future.

diff --git a/src/director/director-connection.c b/src/director/director-connection.c
index fa530aff3..f4f2d1913 100644
--- a/src/director/director-connection.c
+++ b/src/director/director-connection.c
@@ -714,6 +714,10 @@ director_handshake_cmd_user(struct director_connection *conn,
 		return FALSE;
 	}
 
+	if (timestamp > ioloop_time) {
+		/* make sure we don't set user's timestamp to future */
+		timestamp = ioloop_time;
+	}
 	(void)director_user_refresh(conn, username_hash, host,
 				    timestamp, weak, &forced, &user);
 	if (user->timestamp < timestamp) {

