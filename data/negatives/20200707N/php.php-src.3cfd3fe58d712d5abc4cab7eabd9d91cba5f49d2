commit 3cfd3fe58d712d5abc4cab7eabd9d91cba5f49d2
Author: Matt Wilmas <mattwil@php.net>
Date:   Sun Dec 7 10:54:16 2008 +0000

    Fixed bug #46782 (fastcgi.c parse error)

diff --git a/sapi/cgi/fastcgi.c b/sapi/cgi/fastcgi.c
index 58d06ea0d7..0ef1c70cd4 100644
--- a/sapi/cgi/fastcgi.c
+++ b/sapi/cgi/fastcgi.c
@@ -191,8 +191,14 @@ void fcgi_shutdown(void)
 int fcgi_init(void)
 {
 	if (!is_initialized) {
+#ifndef _WIN32
+		sa_t sa;
+		socklen_t len = sizeof(sa);
+#endif
 		zend_hash_init(&fcgi_mgmt_vars, 0, NULL, fcgi_free_mgmt_var_cb, 1);
 		fcgi_set_mgmt_var("FCGI_MPXS_CONNS", sizeof("FCGI_MPXS_CONNS")-1, "0", sizeof("0")-1);
+
+		is_initialized = 1;
 #ifdef _WIN32
 # if 0
 		/* TODO: Support for TCP sockets */
@@ -203,8 +209,6 @@ int fcgi_init(void)
 			return 0;
 		}
 # endif
-		is_initialized = 1;
-
 		if ((GetStdHandle(STD_OUTPUT_HANDLE) == INVALID_HANDLE_VALUE) &&
 		    (GetStdHandle(STD_ERROR_HANDLE)  == INVALID_HANDLE_VALUE) &&
 		    (GetStdHandle(STD_INPUT_HANDLE)  != INVALID_HANDLE_VALUE)) {
@@ -231,10 +235,6 @@ int fcgi_init(void)
 			return is_fastcgi = 0;
 		}
 #else
-		sa_t sa;
-		socklen_t len = sizeof(sa);
-
-		is_initialized = 1;
 		errno = 0;
 		if (getpeername(0, (struct sockaddr *)&sa, &len) != 0 && errno == ENOTCONN) {
 			fcgi_setup_signals();

