commit 0822afe8ebb9389997ef677447c7b08e08797de9
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Thu Jan 16 09:18:07 2014 +0100

    iwlwifi: mvm: disable scheduled scan
    
    The iwlwifi scheduled scan implementation doesn't adhere to the
    userspace API correctly - the API assumes that any new incoming
    'incompatible' request (like scan or remain-on-channel for this
    driver) will just cancel the scheduled scan. Instead our driver
    relies on userspace cancelling it, thus breaking existing wpa_s
    versions.
    
    Cc: stable@vger.kernel.org [3.13]
    Fixes: 35a000b7c1bb ("iwlwifi: mvm: support sched scan if supported by the fw")
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>

diff --git a/drivers/net/wireless/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/iwlwifi/mvm/mac80211.c
index c49b5073c251..6bf9766e5982 100644
--- a/drivers/net/wireless/iwlwifi/mvm/mac80211.c
+++ b/drivers/net/wireless/iwlwifi/mvm/mac80211.c
@@ -246,7 +246,7 @@ int iwl_mvm_mac_setup_register(struct iwl_mvm *mvm)
 	else
 		hw->wiphy->flags &= ~WIPHY_FLAG_PS_ON_BY_DEFAULT;
 
-	if (mvm->fw->ucode_capa.flags & IWL_UCODE_TLV_FLAGS_SCHED_SCAN) {
+	if (0 && mvm->fw->ucode_capa.flags & IWL_UCODE_TLV_FLAGS_SCHED_SCAN) {
 		hw->wiphy->flags |= WIPHY_FLAG_SUPPORTS_SCHED_SCAN;
 		hw->wiphy->max_sched_scan_ssids = PROBE_OPTION_MAX;
 		hw->wiphy->max_match_sets = IWL_SCAN_MAX_PROFILES;

