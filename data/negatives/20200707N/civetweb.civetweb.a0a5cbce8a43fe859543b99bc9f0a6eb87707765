commit a0a5cbce8a43fe859543b99bc9f0a6eb87707765
Author: bel <bel2125@gmail.com>
Date:   Sat Jul 2 01:07:13 2016 +0200

    It is indeed possible for SSL_write to fail with SSL_ERROR_WANT_READ.
    
    See http://openssl.6102.n7.nabble.com/SSL-write-fails-td17473.html

diff --git a/src/civetweb.c b/src/civetweb.c
index e6095dee..a4f9485c 100644
--- a/src/civetweb.c
+++ b/src/civetweb.c
@@ -3916,7 +3916,8 @@ push(struct mg_context *ctx,
 				err = SSL_get_error(ssl, n);
 				if ((err == SSL_ERROR_SYSCALL) && (n == -1)) {
 					err = ERRNO;
-				} else if (err == SSL_ERROR_WANT_WRITE) {
+				} else if ((err == SSL_ERROR_WANT_READ)
+				           || (err == SSL_ERROR_WANT_WRITE)) {
 					n = 0;
 				} else {
 					DEBUG_TRACE("SSL_write() failed, error %d", err);
@@ -4057,7 +4058,8 @@ pull(FILE *fp, struct mg_connection *conn, char *buf, int len, double timeout)
 				err = SSL_get_error(conn->ssl, nread);
 				if ((err == SSL_ERROR_SYSCALL) && (nread == -1)) {
 					err = ERRNO;
-				} else if (err == SSL_ERROR_WANT_READ) {
+				} else if ((err == SSL_ERROR_WANT_READ)
+				           || (err == SSL_ERROR_WANT_WRITE)) {
 					nread = 0;
 				} else {
 					DEBUG_TRACE("SSL_read() failed, error %d", err);

