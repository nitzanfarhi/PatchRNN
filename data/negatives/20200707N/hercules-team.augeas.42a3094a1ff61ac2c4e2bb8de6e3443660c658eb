commit 42a3094a1ff61ac2c4e2bb8de6e3443660c658eb
Author: David Lutterkort <lutter@redhat.com>
Date:   Tue Apr 7 12:58:37 2009 -0700

    * src/transform.c (transform_save): append newline to old text
    
    If we appended a newline to initially load the file, we also need to do
    that when we parse the file again during save.
    
    Bug reported by Michael Conigliaro <mike@conigliaro.org>

diff --git a/src/transform.c b/src/transform.c
index b50a9bb5..fe4a5112 100644
--- a/src/transform.c
+++ b/src/transform.c
@@ -735,6 +735,8 @@ int transform_save(struct augeas *aug, struct tree *xfm,
         goto done;
     }
 
+    text = append_newline(text, strlen(text));
+
     // FIXME: We might have to create intermediary directories
     // to be able to write augnew, but we have no idea what permissions
     // etc. they should get. Just the process default ?

