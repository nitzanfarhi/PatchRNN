commit d53499d1565dd7ba6d93939e552cc604b26dccd7
Author: Florian Festi <ffesti@redhat.com>
Date:   Fri Feb 26 11:15:23 2016 +0100

    Use %_build_cpu instead of noarch when evaluating ExcludeArch and ExclusiveArch
    
    Some noarch packages need build tools not available on all architectures.
    By using %_build_cpu you can restrict the architectures those noarch
    packages can be build on.

diff --git a/build/parsePreamble.c b/build/parsePreamble.c
index 13501de7d..933f7340f 100644
--- a/build/parsePreamble.c
+++ b/build/parsePreamble.c
@@ -428,6 +428,11 @@ static rpmRC checkForValidArchitectures(rpmSpec spec)
     char *arch = rpmExpand("%{_target_cpu}", NULL);
     char *os = rpmExpand("%{_target_os}", NULL);
     rpmRC rc = RPMRC_FAIL; /* assume failure */
+
+    if (!strcmp(arch, "noarch")) {
+	free(arch);
+	arch = rpmExpand("%{_build_cpu}", NULL);
+    }
     
     if (isMemberInEntry(spec->buildRestrictions,
 			arch, RPMTAG_EXCLUDEARCH) == 1) {

