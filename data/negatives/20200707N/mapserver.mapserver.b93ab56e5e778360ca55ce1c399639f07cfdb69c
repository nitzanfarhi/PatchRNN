commit b93ab56e5e778360ca55ce1c399639f07cfdb69c
Author: Assefa Yewondwossen <assefa@dmsolutions.ca>
Date:   Wed Feb 4 16:24:44 2009 +0000

    fix ms_newmapobjfromstring on windows #2877
    
    git-svn-id: http://svn.osgeo.org/mapserver/trunk@8495 7532c77e-422f-0410-93f4-f0b67bdd69e2

diff --git a/mapscript/php3/php_mapscript.c b/mapscript/php3/php_mapscript.c
index 4ce53efb..b26c2c7e 100755
--- a/mapscript/php3/php_mapscript.c
+++ b/mapscript/php3/php_mapscript.c
@@ -1736,7 +1736,7 @@ DLEXPORT void php3_ms_map_new_from_string(INTERNAL_FUNCTION_PARAMETERS)
     HashTable   *list=NULL;
 
 #if defined(WIN32)
-    char        szPath[MS_MAXPATHLEN], szMapText[MS_MAXPATHLEN];
+    char        szMapText[MS_MAXPATHLEN];
     char        szNewPath[MS_MAXPATHLEN];
 #endif
 
@@ -1762,11 +1762,12 @@ DLEXPORT void php3_ms_map_new_from_string(INTERNAL_FUNCTION_PARAMETERS)
 
     if (pszNewPath)
     {
-        msBuildPath(szNewPath, NULL, pszNewPath);
-        pNewMap = mapObj_newFromString(szMapText, szNewPath);
+        virtual_getcwd(szMapText, MS_MAXPATHLEN TSRMLS_CC);
+        msBuildPath(szNewPath, szMapText, pszNewPath);
+        pNewMap = mapObj_newFromString(pMapText->value.str.val, szNewPath);
     }
     else
-       pNewMap = mapObj_newFromString(szMapText, pszNewPath);
+       pNewMap = mapObj_newFromString(pMapText->value.str.val, pszNewPath);
    
 #else
     pNewMap = mapObj_newFromString(pMapText->value.str.val, pszNewPath);

