commit 297de4f65698ee1e1c75e27d57933b5fa8227e72
Author: andros@citi.umich.edu <andros@citi.umich.edu>
Date:   Tue Aug 29 12:19:41 2006 -0400

    Fix a referral error Oops
    
    Fix an oops when the referral server is not responding.
    Check the error return from nfs4_set_client() in nfs4_create_referral_server.
    
    Signed-off-by: Andy Adamson <andros@citi.umich.edu>
    Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>

diff --git a/fs/nfs/client.c b/fs/nfs/client.c
index a4aa47913a5c..110f80e7bd4c 100644
--- a/fs/nfs/client.c
+++ b/fs/nfs/client.c
@@ -1059,6 +1059,8 @@ struct nfs_server *nfs4_create_referral_server(struct nfs_clone_mount *data,
 			parent_server->client->cl_xprt->prot,
 			parent_client->retrans_timeo,
 			parent_client->retrans_count);
+	if (error < 0)
+		goto error;
 
 	/* Initialise the client representation from the parent server */
 	nfs_server_copy_userdata(server, parent_server);

