commit 7c14d1953b8d23d4cd809f896b761b607a77e483
Author: Panu Matilainen <pmatilai@redhat.com>
Date:   Mon Jun 8 14:13:58 2009 +0300

    Dont bother adding dependencies to self, ever

diff --git a/lib/depends.c b/lib/depends.c
index 0f6926fb2..e11154ceb 100644
--- a/lib/depends.c
+++ b/lib/depends.c
@@ -840,7 +840,8 @@ static inline int addRelation(rpmts ts,
 
     q = rpmalSatisfiesDepend(al, requires);
 
-    if (q == NULL)
+    /* Avoid deps outside this transaction and self dependencies */
+    if (q == NULL || q == p)
 	return 0;
 
     /* Avoid certain dependency relations. */

