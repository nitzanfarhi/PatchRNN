commit 3ef2fd614d578b0cb56c563a5fa7eeaa20ce652b
Author: Pascal Quantin <pascal.quantin@gmail.com>
Date:   Fri Oct 16 15:00:24 2015 +0200

    Qt: fix crash when using Telephony -> VOIP Calls -> Flow Sequence
    
    Bug: 11600
    Change-Id: I1baa02b3d57ded5602c3c16466e7a9eb87459f61
    Reviewed-on: https://code.wireshark.org/review/11091
    Reviewed-by: Pascal Quantin <pascal.quantin@gmail.com>
    Petri-Dish: Pascal Quantin <pascal.quantin@gmail.com>
    Tested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>
    Reviewed-by: Alexis La Goutte <alexis.lagoutte@gmail.com>

diff --git a/ui/qt/voip_calls_dialog.cpp b/ui/qt/voip_calls_dialog.cpp
index ee15caf6ca..38b919c94a 100644
--- a/ui/qt/voip_calls_dialog.cpp
+++ b/ui/qt/voip_calls_dialog.cpp
@@ -352,7 +352,11 @@ void VoipCallsDialog::prepareFilter()
     /* Build a new filter based on frame numbers */
     const char *or_prepend = "";
     foreach (QTreeWidgetItem *ti, ui->callTreeWidget->selectedItems()) {
-        voip_calls_info_t *call_info = ti->data(0, Qt::UserRole).value<voip_calls_info_t*>();
+        VoipCallsTreeWidgetItem *vc_ti = static_cast<VoipCallsTreeWidgetItem *>(ti);
+        voip_calls_info_t *call_info = vc_ti->callInfo();
+        if (!call_info) {
+            return;
+        }
         selected_calls << call_info->call_num;
     }
 
@@ -463,7 +467,11 @@ void VoipCallsDialog::showSequence()
 
     QSet<guint16> selected_calls;
     foreach (QTreeWidgetItem *ti, ui->callTreeWidget->selectedItems()) {
-        voip_calls_info_t *call_info = ti->data(0, Qt::UserRole).value<voip_calls_info_t*>();
+        VoipCallsTreeWidgetItem *vc_ti = static_cast<VoipCallsTreeWidgetItem *>(ti);
+        voip_calls_info_t *call_info = vc_ti->callInfo();
+        if (!call_info) {
+            return;
+        }
         selected_calls << call_info->call_num;
     }
 
@@ -513,7 +521,8 @@ void VoipCallsDialog::showPlayer()
 
 void VoipCallsDialog::on_callTreeWidget_itemActivated(QTreeWidgetItem *item, int)
 {
-    voip_calls_info_t *call_info = item->data(0, Qt::UserRole).value<voip_calls_info_t*>();
+    VoipCallsTreeWidgetItem *vc_ti = static_cast<VoipCallsTreeWidgetItem *>(item);
+    voip_calls_info_t *call_info = vc_ti->callInfo();
     if (!call_info) {
         return;
     }

