commit 0566603d16205e759aa1ee3e924395df8b015b22
Author: alobbs <alvaro@alobbs.com>
Date:   Tue Aug 10 21:21:31 2010 +0000

    If a "Range: bytes=" exceeds the file size, the reply had to a '206
    Partial Content' instead of the previous '416 Requested Range Not
    Satisfiable' response. Fixes http://bugs.cherokee-project.com/754
    
    git-svn-id: svn://cherokee-project.com/cherokee/trunk@5364 5dc97367-97f1-0310-9951-d761b3857238

diff --git a/cherokee/handler_file.c b/cherokee/handler_file.c
index 4323e654..5c145471 100644
--- a/cherokee/handler_file.c
+++ b/cherokee/handler_file.c
@@ -501,8 +501,7 @@ cherokee_handler_file_custom_init (cherokee_handler_file_t *fhdl,
 
 	/* Range 1: Check the range and file size
 	 */
-	if (unlikely ((conn->range_start >= fhdl->info->st_size) ||
-		      (conn->range_end   >= fhdl->info->st_size)))
+	if (unlikely (conn->range_start >= fhdl->info->st_size))
 	{
 		/* Sets the range limits, so the error handler can
 		 * report the error properly.
@@ -513,6 +512,16 @@ cherokee_handler_file_custom_init (cherokee_handler_file_t *fhdl,
 
 		ret = ret_error;
 		goto out;
+
+	}
+
+	if (unlikely ((conn->range_end >= fhdl->info->st_size)))
+	{
+		/* Send the full file. Set the end to -1 so it is
+		 * updated later on.
+		 */
+		conn->range_start = 0;
+		conn->range_end   = -1;
 	}
 
 	/* Set the error code

