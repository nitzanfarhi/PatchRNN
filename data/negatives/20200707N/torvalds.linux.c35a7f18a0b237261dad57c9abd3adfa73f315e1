commit c35a7f18a0b237261dad57c9abd3adfa73f315e1
Author: Oleg Nesterov <oleg@redhat.com>
Date:   Wed Dec 10 15:54:56 2014 -0800

    exit: proc: don't try to flush /proc/tgid/task/tgid
    
    proc_flush_task_mnt() always tries to flush task/pid, but this is
    pointless if we reap the leader. d_invalidate() is recursive, and
    if nothing else the next d_hash_and_lookup(tgid) should fail anyway.
    
    Signed-off-by: Oleg Nesterov <oleg@redhat.com>
    Cc: Aaron Tomlin <atomlin@redhat.com>
    Cc: "Eric W. Biederman" <ebiederm@xmission.com>
    Cc: Rik van Riel <riel@redhat.com>
    Cc: Sterling Alexander <stalexan@redhat.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/fs/proc/base.c b/fs/proc/base.c
index 772efa45a452..e7b04a321cc1 100644
--- a/fs/proc/base.c
+++ b/fs/proc/base.c
@@ -2618,6 +2618,9 @@ static void proc_flush_task_mnt(struct vfsmount *mnt, pid_t pid, pid_t tgid)
 		dput(dentry);
 	}
 
+	if (pid == tgid)
+		return;
+
 	name.name = buf;
 	name.len = snprintf(buf, sizeof(buf), "%d", tgid);
 	leader = d_hash_and_lookup(mnt->mnt_root, &name);

