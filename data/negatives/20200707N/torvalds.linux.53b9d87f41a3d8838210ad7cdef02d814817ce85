commit 53b9d87f41a3d8838210ad7cdef02d814817ce85
Author: Andrew Morton <akpm@linux-foundation.org>
Date:   Thu Sep 11 17:02:58 2008 -0700

    lock debug: sit tight when we are already in a panic
    
    in:
    
      > http://bugzilla.kernel.org/show_bug.cgi?id=11543
    
    The panic code called the kexec code which called mutex_trylock() which
    called spin_lock_mutex() which then stupidly went and blurted a load of
    debug stuff because of in_interrupt().
    
    Keep the lock debug code from escallating an already crappy situation.
    
    Signed-off-by: Ingo Molnar <mingo@elte.hu>

diff --git a/include/linux/debug_locks.h b/include/linux/debug_locks.h
index 4aaa4afb1cb9..096476f1fb35 100644
--- a/include/linux/debug_locks.h
+++ b/include/linux/debug_locks.h
@@ -17,7 +17,7 @@ extern int debug_locks_off(void);
 ({									\
 	int __ret = 0;							\
 									\
-	if (unlikely(c)) {						\
+	if (!oops_in_progress && unlikely(c)) {				\
 		if (debug_locks_off() && !debug_locks_silent)		\
 			WARN_ON(1);					\
 		__ret = 1;						\

