commit bf12c1fa8c78e3c667f2fe2ecc656f4f3cfb914e
Author: Laszlo Ersek <lersek@redhat.com>
Date:   Sat May 18 06:31:51 2013 +0200

    qga: create state directory on win32
    
    On Win32 the local state directory is application specific and users might
    expect qemu-ga to create it automatically.
    
    Signed-off-by: Laszlo Ersek <lersek@redhat.com>
    Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>

diff --git a/qga/main.c b/qga/main.c
index f5f033d151..5f2d141431 100644
--- a/qga/main.c
+++ b/qga/main.c
@@ -1041,6 +1041,20 @@ int main(int argc, char **argv)
         }
     }
 
+#ifdef _WIN32
+    /* On win32 the state directory is application specific (be it the default
+     * or a user override). We got past the command line parsing; let's create
+     * the directory (with any intermediate directories). If we run into an
+     * error later on, we won't try to clean up the directory, it is considered
+     * persistent.
+     */
+    if (g_mkdir_with_parents(state_dir, S_IRWXU) == -1) {
+        g_critical("unable to create (an ancestor of) the state directory"
+                   " '%s': %s", state_dir, strerror(errno));
+        return EXIT_FAILURE;
+    }
+#endif
+
     s = g_malloc0(sizeof(GAState));
     s->log_level = log_level;
     s->log_file = stderr;

