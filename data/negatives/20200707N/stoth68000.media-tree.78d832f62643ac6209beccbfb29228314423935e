commit 78d832f62643ac6209beccbfb29228314423935e
Author: Serge E. Hallyn <serue@us.ibm.com>
Date:   Mon Mar 26 21:32:22 2007 -0800

    [PATCH] utsns: fix !CONFIG_UTS_NS behavior
    
    When CONFIG_UTS_NS=n, clone(CLONE_NEWUTS) quietly refuses.  So correctly does
    not unshare a new uts namespace, but also does not return -EINVAL.
    
    Fix this to return -EINVAL so the caller knows his request was denied.
    
    Signed-off-by: Serge E. Hallyn <serue@us.ibm.com>
    Cc: "Eric W. Biederman" <ebiederm@xmission.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

diff --git a/include/linux/utsname.h b/include/linux/utsname.h
index a4555fe3754c..e10267d402c5 100644
--- a/include/linux/utsname.h
+++ b/include/linux/utsname.h
@@ -70,6 +70,8 @@ static inline int unshare_utsname(unsigned long unshare_flags,
 
 static inline int copy_utsname(int flags, struct task_struct *tsk)
 {
+	if (flags & CLONE_NEWUTS)
+		return -EINVAL;
 	return 0;
 }
 static inline void put_uts_ns(struct uts_namespace *ns)

