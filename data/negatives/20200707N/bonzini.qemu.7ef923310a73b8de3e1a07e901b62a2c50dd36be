commit 7ef923310a73b8de3e1a07e901b62a2c50dd36be
Author: Zachary Amsden <zamsden@redhat.com>
Date:   Thu Jul 30 00:15:00 2009 -1000

    Don't segfault when changing VNC password on an SDL display.
    
    Signed-off-by: Zachary Amsden <zamsden@redhat.com>
    Signed-off-by: Anthony Liguori <aliguori@us.ibm.com>

diff --git a/vnc.c b/vnc.c
index 4fde9aae5d..9dbe82ac06 100644
--- a/vnc.c
+++ b/vnc.c
@@ -2263,6 +2263,10 @@ int vnc_display_password(DisplayState *ds, const char *password)
 {
     VncDisplay *vs = ds ? (VncDisplay *)ds->opaque : vnc_display;
 
+    if (!vs) {
+        return -1;
+    }
+
     if (vs->password) {
         qemu_free(vs->password);
         vs->password = NULL;

