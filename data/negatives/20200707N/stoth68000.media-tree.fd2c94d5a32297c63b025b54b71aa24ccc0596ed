commit fd2c94d5a32297c63b025b54b71aa24ccc0596ed
Author: Ezequiel Garcia <ezequiel.garcia@free-electrons.com>
Date:   Tue May 6 13:59:49 2014 -0300

    thermal: armada: Allow to specify an 'inverted readout' sensor
    
    In order to support inverted-formula thermal sensor readout, this commit
    introduces an 'inverted' field in the SoC-specific structure which
    allows to specify an inversion of the temperature formula.
    
    Acked-by: Jason Cooper <jason@lakedaemon.net>
    Signed-off-by: Ezequiel Garcia <ezequiel.garcia@free-electrons.com>
    Signed-off-by: Zhang Rui <rui.zhang@intel.com>

diff --git a/drivers/thermal/armada_thermal.c b/drivers/thermal/armada_thermal.c
index 6fd648337e63..f84d9f077fe2 100644
--- a/drivers/thermal/armada_thermal.c
+++ b/drivers/thermal/armada_thermal.c
@@ -56,6 +56,7 @@ struct armada_thermal_data {
 	unsigned long coef_b;
 	unsigned long coef_m;
 	unsigned long coef_div;
+	bool inverted;
 
 	/* Register shift and mask to access the sensor temperature */
 	unsigned int temp_shift;
@@ -138,7 +139,10 @@ static int armada_get_temp(struct thermal_zone_device *thermal,
 	m = priv->data->coef_m;
 	div = priv->data->coef_div;
 
-	*temp = (b - (m * reg)) / div;
+	if (priv->data->inverted)
+		*temp = ((m * reg) - b) / div;
+	else
+		*temp = (b - (m * reg)) / div;
 	return 0;
 }
 

