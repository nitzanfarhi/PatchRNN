commit e3d786be4e5d75aca1821955831209fd46dbe6eb
Author: Marcus Boerger <helly@php.net>
Date:   Thu Feb 22 23:26:03 2007 +0000

    - MFH Fix logic

diff --git a/main/streams/memory.c b/main/streams/memory.c
index b5e434c4c7..e0b3f88990 100644
--- a/main/streams/memory.c
+++ b/main/streams/memory.c
@@ -260,14 +260,14 @@ static int php_stream_memory_set_option(php_stream *stream, int option, int valu
 					if (newsize <= ms->fsize) {
 						if (newsize < ms->fpos) {
 							ms->fpos = newsize;
-						} else {
-							ms->data = erealloc(ms->data, newsize);
-							memset(ms->data+ms->fsize, 0, newsize - ms->fsize);
-							ms->fsize = newsize;
 						}
+					} else {
+						ms->data = erealloc(ms->data, newsize);
+						memset(ms->data+ms->fsize, 0, newsize - ms->fsize);
 						ms->fsize = newsize;
-						return PHP_STREAM_OPTION_RETURN_OK;
 					}
+					ms->fsize = newsize;
+					return PHP_STREAM_OPTION_RETURN_OK;
 			}
 		default:
 			return PHP_STREAM_OPTION_RETURN_NOTIMPL;

