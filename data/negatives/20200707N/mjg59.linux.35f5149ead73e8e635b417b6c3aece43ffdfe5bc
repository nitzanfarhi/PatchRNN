commit 35f5149ead73e8e635b417b6c3aece43ffdfe5bc
Author: Felix Fietkau <nbd@openwrt.org>
Date:   Wed Oct 31 15:50:34 2012 +0100

    mac80211: do not call ieee80211_configure_filter if no interfaces are up
    
    Drivers are not expected to handle it before drv_start has been called. It
    will be called again after an interface has been brought up.
    
    Signed-off-by: Felix Fietkau <nbd@openwrt.org>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

diff --git a/net/mac80211/cfg.c b/net/mac80211/cfg.c
index 05f3a313db88..7371f676cf41 100644
--- a/net/mac80211/cfg.c
+++ b/net/mac80211/cfg.c
@@ -2594,6 +2594,9 @@ static void ieee80211_mgmt_frame_register(struct wiphy *wiphy,
 		else
 			local->probe_req_reg--;
 
+		if (!local->open_count)
+			break;
+
 		ieee80211_queue_work(&local->hw, &local->reconfig_filter);
 		break;
 	default:

