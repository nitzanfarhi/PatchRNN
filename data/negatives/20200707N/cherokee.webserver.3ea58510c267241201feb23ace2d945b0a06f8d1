commit 3ea58510c267241201feb23ace2d945b0a06f8d1
Author: alobbs <alvaro@alobbs.com>
Date:   Sun Jun 4 18:04:35 2006 +0000

    git-svn-id: svn://cherokee-project.com/cherokee/trunk@292 5dc97367-97f1-0310-9951-d761b3857238

diff --git a/cherokee/util.c b/cherokee/util.c
index d89b91f3..d44f5921 100644
--- a/cherokee/util.c
+++ b/cherokee/util.c
@@ -879,10 +879,13 @@ cherokee_trace (const char *entry, const char *file, int line, const char *func,
 	cherokee_buffer_add_va_list (&output, (char *)fmt, args);
 	va_end (args);
 
-	if (use_syslog) 
+	if (use_syslog) {
 		syslog (LOG_DEBUG, "%s", output.buf);
-	else
-		printf ("%s", output.buf);
+	} else {
+		flockfile (stdout);
+		fprintf (stdout, "%s", output.buf);
+		funlockfile (stdout);
+	}
 
 out:
 	cherokee_buffer_mrproper (&output);

