commit 41a9e6ff2f1420a69d7e41953182c1e93795287b
Author: okir <okir@c6295689-39f2-0310-b995-f0e70906c6a9>
Date:   Tue May 13 20:24:24 2003 +0000

    - sc_pkcs15_compute_signature(RSA_RAW): zero pad input if shorter than modulus length
    
    
    git-svn-id: https://www.opensc-project.org/svnp/opensc/trunk@1103 c6295689-39f2-0310-b995-f0e70906c6a9

diff --git a/src/libopensc/pkcs15-sec.c b/src/libopensc/pkcs15-sec.c
index b4ea1ec1..0749cb0f 100644
--- a/src/libopensc/pkcs15-sec.c
+++ b/src/libopensc/pkcs15-sec.c
@@ -359,6 +359,18 @@ int sc_pkcs15_compute_signature(struct sc_pkcs15_card *p15card,
 			return SC_ERROR_NOT_SUPPORTED;
 		}
 		senv.algorithm_flags |= SC_ALGORITHM_RSA_RAW;
+
+		/* Add zero-padding if input shorter than modulus */
+		if (inlen < prkey->modulus_length/8) {
+			unsigned int	modulus_len = prkey->modulus_length/8;
+
+			if (modulus_len > sizeof(buf))
+				return SC_ERROR_BUFFER_TOO_SMALL;
+			memset(buf, 0, sizeof(buf));
+			memcpy(buf + modulus_len - inlen, in, inlen);
+			inlen = modulus_len;
+			in = buf;
+		}
 	}
 	if (pad_flags) {
                 buflen = sizeof(buf);

