commit d907b51d224e965a876eada6bc49455773e416e9
Author: Timo Sirainen <tss@iki.fi>
Date:   Mon Mar 2 14:41:11 2015 +0200

    lib: Added assert to i_stream_create_seekable*() to have non-zero max_buffer_size.
    This size is used for the created fd istream and it can't be zero.

diff --git a/src/lib/istream-seekable.c b/src/lib/istream-seekable.c
index daba7a3dd..1954341e6 100644
--- a/src/lib/istream-seekable.c
+++ b/src/lib/istream-seekable.c
@@ -377,6 +377,8 @@ i_streams_merge(struct istream *input[], size_t max_buffer_size,
 	size_t size;
 	bool blocking = TRUE;
 
+	i_assert(max_buffer_size > 0);
+
 	/* if any of the streams isn't blocking, set ourself also nonblocking */
 	for (count = 0; input[count] != NULL; count++) {
 		if (!input[count]->blocking)
@@ -434,6 +436,8 @@ i_stream_create_seekable(struct istream *input[],
 			 int (*fd_callback)(const char **path_r, void *context),
 			 void *context)
 {
+	i_assert(max_buffer_size > 0);
+
 	/* If all input streams are seekable, use concat istream instead */
 	if (inputs_are_seekable(input))
 		return i_stream_create_concat(input);
@@ -475,6 +479,8 @@ i_stream_create_seekable_path(struct istream *input[],
 	struct seekable_istream *sstream;
 	struct istream *stream;
 
+	i_assert(max_buffer_size > 0);
+
 	if (inputs_are_seekable(input))
 		return i_stream_create_concat(input);
 

