commit 5fe4fe4d92f5b2d67896beac9b5b3b48b309a6b4
Author: John Spray <john.spray@redhat.com>
Date:   Tue May 17 14:03:09 2016 +0100

    mon: fix metadata dumps for empty lists
    
    Because 'r' was set inside loop, these would
    fail to set it (leaving ENOSYS) if no
    metadata is present.
    
    Signed-off-by: John Spray <john.spray@redhat.com>

diff --git a/src/mon/MDSMonitor.cc b/src/mon/MDSMonitor.cc
index fc872b9c51..12da11e48f 100644
--- a/src/mon/MDSMonitor.cc
+++ b/src/mon/MDSMonitor.cc
@@ -1024,6 +1024,7 @@ bool MDSMonitor::preprocess_command(MonOpRequestRef op)
     bool all = !cmd_getval(g_ceph_context, cmdmap, "who", who);
     dout(1) << "all = " << all << dendl;
     if (all) {
+      r = 0;
       // Dump all MDSs' metadata
       const auto all_info = fsmap.get_mds_info();
 
diff --git a/src/mon/Monitor.cc b/src/mon/Monitor.cc
index 0ae20989a1..d2d183c908 100644
--- a/src/mon/Monitor.cc
+++ b/src/mon/Monitor.cc
@@ -2972,6 +2972,7 @@ void Monitor::handle_command(MonOpRequestRef op)
       f->close_section();
     } else {
       // Dump all mons' metadata
+      r = 0;
       f->open_array_section("mon_metadata");
       for (unsigned int rank = 0; rank < monmap->size(); ++rank) {
         std::ostringstream get_err;
diff --git a/src/mon/OSDMonitor.cc b/src/mon/OSDMonitor.cc
index 8c16bb76f1..60ce607ccd 100644
--- a/src/mon/OSDMonitor.cc
+++ b/src/mon/OSDMonitor.cc
@@ -3238,6 +3238,7 @@ bool OSDMonitor::preprocess_command(MonOpRequestRef op)
         goto reply;
       f->close_section();
     } else {
+      r = 0;
       f->open_array_section("osd_metadata");
       for (int i=0; i<osdmap.get_max_osd(); ++i) {
         if (osdmap.exists(i)) {

