commit bf3695b55b0c2b07708b5f55d9b481b1f296ec93
Author: Kazuho Oku <kazuhooku@gmail.com>
Date:   Wed Sep 24 13:01:43 2014 +0900

    ignore SIGPIPE using sigaction

diff --git a/src/main.c b/src/main.c
index 6f476ba7..70be3e71 100644
--- a/src/main.c
+++ b/src/main.c
@@ -24,6 +24,7 @@
 #include <getopt.h>
 #include <netinet/in.h>
 #include <pthread.h>
+#include <signal.h>
 #include <stdio.h>
 #include <sys/socket.h>
 #include "yoml-parser.h"
@@ -169,6 +170,16 @@ yoml_t *load_config(const char *fn)
     return yoml;
 }
 
+static void setup_signal_handlers(void)
+{
+    struct sigaction sa;
+
+    memset(&sa, 0, sizeof(sa));
+    sa.sa_handler = SIG_IGN;
+    sigemptyset(&sa.sa_mask);
+    sigaction(SIGPIPE, &sa, NULL);
+}
+
 static void *run_loop(void *_config)
 {
     h2o_global_configuration_t *config = _config;
@@ -242,6 +253,8 @@ int main(int argc, char **argv)
         exit(EX_CONFIG);
     yoml_free(config_yoml);
 
+    setup_signal_handlers();
+
     if (num_threads_configurator.num_threads <= 1) {
         run_loop(&config);
     } else {

