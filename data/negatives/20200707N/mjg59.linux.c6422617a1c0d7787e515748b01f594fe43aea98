commit c6422617a1c0d7787e515748b01f594fe43aea98
Author: Lachlan McIlroy <lachlan@redback.melbourne.sgi.com>
Date:   Fri Dec 5 13:16:15 2008 +1100

    [XFS] Check return value of xfs_buf_get_noaddr()
    
    We check the return value of all other calls to xfs_buf_get_noaddr().
    Make sense to do it here too.
    
    Signed-off-by: Lachlan McIlroy <lachlan@sgi.com>
    Reviewed-by: Christoph Hellwig <hch@infradead.org>
    Reviewed-by: Eric Sandeen <sandeen@sandeen.net>

diff --git a/fs/xfs/xfs_vnodeops.c b/fs/xfs/xfs_vnodeops.c
index 2d57aae0e310..4547608b46c4 100644
--- a/fs/xfs/xfs_vnodeops.c
+++ b/fs/xfs/xfs_vnodeops.c
@@ -3034,6 +3034,8 @@ xfs_zero_remaining_bytes(
 	bp = xfs_buf_get_noaddr(mp->m_sb.sb_blocksize,
 				XFS_IS_REALTIME_INODE(ip) ?
 				mp->m_rtdev_targp : mp->m_ddev_targp);
+	if (!bp)
+		return XFS_ERROR(ENOMEM);
 
 	for (offset = startoff; offset <= endoff; offset = lastoffset + 1) {
 		offset_fsb = XFS_B_TO_FSBT(mp, offset);

