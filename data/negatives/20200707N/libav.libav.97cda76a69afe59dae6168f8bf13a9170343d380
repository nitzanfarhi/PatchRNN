commit 97cda76a69afe59dae6168f8bf13a9170343d380
Author: Reimar DÃ¶ffinger <Reimar.Doeffinger@gmx.de>
Date:   Mon Mar 8 19:41:57 2010 +0000

    Check for allocation failure for c->lumMmx2FilterCode and c->chrMmx2FilterCode.
    
    Originally committed as revision 30864 to svn://svn.mplayerhq.hu/mplayer/trunk/libswscale

diff --git a/libswscale/utils.c b/libswscale/utils.c
index 2b9f27282..5409980eb 100644
--- a/libswscale/utils.c
+++ b/libswscale/utils.c
@@ -968,6 +968,8 @@ SwsContext *sws_getContext(int srcW, int srcH, enum PixelFormat srcFormat,
             c->chrMmx2FilterCode = av_malloc(c->chrMmx2FilterCodeSize);
 #endif
 
+            if (!c->lumMmx2FilterCode || !c->chrMmx2FilterCode)
+                goto fail;
             FF_ALLOCZ_OR_GOTO(c, c->hLumFilter   , (dstW        /8+8)*sizeof(int16_t), fail);
             FF_ALLOCZ_OR_GOTO(c, c->hChrFilter   , (c->chrDstW  /4+8)*sizeof(int16_t), fail);
             FF_ALLOCZ_OR_GOTO(c, c->hLumFilterPos, (dstW      /2/8+8)*sizeof(int32_t), fail);

