commit f06b85218a41fd6f8e797a925f4ea75640b69c9e
Author: Alon Levy <alevy@redhat.com>
Date:   Mon Jan 20 12:44:19 2014 +0200

    qxl: clear irq on reset
    
    Without this we occasionally trigger an assert at
    hw/pci/pci.c:pcibus_reset that asserts the irq_count is zero on reset.
    
    This has become a problem with the new drm driver for linux, since doing
    a reboot from console causes a race between console updates that set the
    irq and the reset assertion that the irq is clear.
    
    Signed-off-by: Alon Levy <alevy@redhat.com>
    Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>

diff --git a/hw/display/qxl.c b/hw/display/qxl.c
index e4f172e3fb..56b61c8ad8 100644
--- a/hw/display/qxl.c
+++ b/hw/display/qxl.c
@@ -1126,6 +1126,7 @@ static void qxl_reset_state(PCIQXLDevice *d)
     d->num_free_res = 0;
     d->last_release = NULL;
     memset(&d->ssd.dirty, 0, sizeof(d->ssd.dirty));
+    qxl_update_irq(d);
 }
 
 static void qxl_soft_reset(PCIQXLDevice *d)

