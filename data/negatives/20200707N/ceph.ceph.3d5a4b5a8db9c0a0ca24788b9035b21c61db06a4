commit 3d5a4b5a8db9c0a0ca24788b9035b21c61db06a4
Author: Samuel Just <sam.just@inktank.com>
Date:   Mon Mar 10 13:01:36 2014 -0700

    ReplicatedPG: CEPH_OSD_OP_WATCH return -ENOENT if !obs.exists
    
    Fixes: #7671
    Signed-off-by: Samuel Just <sam.just@inktank.com>

diff --git a/src/osd/ReplicatedPG.cc b/src/osd/ReplicatedPG.cc
index 8ea8a62485..aec6e5f82b 100644
--- a/src/osd/ReplicatedPG.cc
+++ b/src/osd/ReplicatedPG.cc
@@ -3837,6 +3837,10 @@ int ReplicatedPG::do_osd_ops(OpContext *ctx, vector<OSDOp>& ops)
     case CEPH_OSD_OP_WATCH:
       ++ctx->num_write;
       {
+	if (!obs.exists) {
+	  result = -ENOENT;
+	  break;
+	}
         uint64_t cookie = op.watch.cookie;
 	bool do_watch = op.watch.flag & 1;
         entity_name_t entity = ctx->reqid.name;

