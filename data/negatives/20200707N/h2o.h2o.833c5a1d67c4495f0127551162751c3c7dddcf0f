commit 833c5a1d67c4495f0127551162751c3c7dddcf0f
Author: Kazuho Oku <kazuhooku@gmail.com>
Date:   Mon Sep 8 17:15:56 2014 +0900

    [http2] do not start a pending request while trying to close the connection on error

diff --git a/src/http2/connection.c b/src/http2/connection.c
index 4b11f3ca..ba4258fc 100644
--- a/src/http2/connection.c
+++ b/src/http2/connection.c
@@ -163,7 +163,8 @@ void h2o_http2_conn_unregister_stream(h2o_http2_conn_t *conn, h2o_http2_stream_t
         break;
     }
 
-    run_pending_requests(conn);
+    if (conn->state != H2O_HTTP2_CONN_STATE_IS_CLOSING)
+        run_pending_requests(conn);
 }
 
 static void close_connection_now(h2o_http2_conn_t *conn)

