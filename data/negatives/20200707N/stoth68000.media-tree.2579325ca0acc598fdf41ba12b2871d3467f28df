commit 2579325ca0acc598fdf41ba12b2871d3467f28df
Author: Mike Christie <mchristi@redhat.com>
Date:   Wed Mar 1 23:14:40 2017 -0600

    tcmu: return on first Opt parse failure
    
    We only were returing failure if the last opt to be parsed failed.
    This has a return failure when we first detect a failure.
    
    Signed-off-by: Mike Christie <mchristi@redhat.com>
    Signed-off-by: Nicholas Bellinger <nab@linux-iscsi.org>

diff --git a/drivers/target/target_core_user.c b/drivers/target/target_core_user.c
index 24e8580f07b8..4339ab2133b3 100644
--- a/drivers/target/target_core_user.c
+++ b/drivers/target/target_core_user.c
@@ -1118,6 +1118,9 @@ static ssize_t tcmu_set_configfs_dev_params(struct se_device *dev,
 		default:
 			break;
 		}
+
+		if (ret)
+			break;
 	}
 
 	kfree(orig);

