commit 217c906ea57fecdf78469048bb1384c0e1ff2a19
Author: Felipe Pena <felipensp@gmail.com>
Date:   Mon Nov 11 22:33:17 2013 -0200

    - Improve error message and added check for fstat return

diff --git a/phpdbg_list.c b/phpdbg_list.c
index 9102a797fc..d460315531 100644
--- a/phpdbg_list.c
+++ b/phpdbg_list.c
@@ -33,11 +33,14 @@ void phpdbg_list_file(const char *filename, long count, long offset) /* {{{ */
 	unsigned int line = 0, displayed = 0;
 
 	if ((fd = open(filename, O_RDONLY)) == -1) {
-		printf("[Failed to open file to list]\n");
+		printf("[Failed to open file %s to list]\n", filename);
 		return;
 	}
 
-	fstat(fd, &st);
+	if (fstat(fd, &st) == -1) {
+		printf("[Failed to stat file %s]\n", filename);
+		goto out;
+	}
 
 	last_pos = mem = mmap(0, st.st_size, PROT_READ, MAP_SHARED, fd, 0);
 	end_pos = mem + st.st_size;
@@ -67,6 +70,6 @@ void phpdbg_list_file(const char *filename, long count, long offset) /* {{{ */
 	}
 
 	munmap(mem, st.st_size);
+out:
 	close(fd);
-
 } /* }}} */

