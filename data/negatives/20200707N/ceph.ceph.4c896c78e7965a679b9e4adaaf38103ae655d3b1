commit 4c896c78e7965a679b9e4adaaf38103ae655d3b1
Author: Jashan Kamboj <jashank42@gmail.com>
Date:   Wed Jul 29 00:37:34 2015 +0530

    add stray_prior_path to store path before rename
    
    Signed-off-by: Jashan Kamboj <jashank42@gmail.com>

diff --git a/src/mds/Server.cc b/src/mds/Server.cc
index d5c59e4a4a..acc2965c82 100644
--- a/src/mds/Server.cc
+++ b/src/mds/Server.cc
@@ -6597,6 +6597,7 @@ void Server::_rename_prepare(MDRequestRef& mdr,
     }
     if (tpi) {
       tpi->ctime = mdr->get_op_stamp();
+      destdn->make_path_string(tpi->stray_prior_path);
       tpi->nlink--;
       if (tpi->nlink == 0)
 	oldin->state_set(CInode::STATE_ORPHAN);

