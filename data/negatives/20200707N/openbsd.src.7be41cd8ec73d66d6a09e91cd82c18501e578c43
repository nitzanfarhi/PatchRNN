commit 7be41cd8ec73d66d6a09e91cd82c18501e578c43
Author: thib <thib@openbsd.org>
Date:   Sat Jan 24 11:33:34 2009 +0000

    make sure the from mbuf gets freed on error to.
    
    from David <dunnoseriously _att_ gmail.com>
    ok blambert@

diff --git a/sys/nfs/krpc_subr.c b/sys/nfs/krpc_subr.c
index 38d7f28bb8d..0a0e47f3dc3 100644
--- a/sys/nfs/krpc_subr.c
+++ b/sys/nfs/krpc_subr.c
@@ -1,4 +1,4 @@
-/*	$OpenBSD: krpc_subr.c,v 1.17 2008/06/10 23:15:32 blambert Exp $	*/
+/*	$OpenBSD: krpc_subr.c,v 1.18 2009/01/24 11:33:34 thib Exp $	*/
 /*	$NetBSD: krpc_subr.c,v 1.12.4.1 1996/06/07 00:52:26 cgd Exp $	*/
 
 /*
@@ -449,7 +449,7 @@ krpc_call(sa, prog, vers, func, data, from_p, retries)
 
 	/* result */
 	*data = m;
-	if (from_p) {
+	if (from_p && error == 0) {
 		*from_p = from;
 		from = NULL;
 	}

