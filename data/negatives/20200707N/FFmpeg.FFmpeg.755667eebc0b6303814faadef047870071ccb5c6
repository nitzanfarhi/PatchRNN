commit 755667eebc0b6303814faadef047870071ccb5c6
Author: Reimar Döffinger <Reimar.Doeffinger@gmx.de>
Date:   Sun Apr 29 00:08:36 2012 +0200

    rmenc: more than 2 streams are not currently possible.
    
    It is possible that just extending the RMMuxContext.streams
    array would avoid it.
    It is also possible that two audio streams will fail to mux
    correctly as well, though at least it should not crash for
    this reason.
    I do not feel like checking either of these.
    This patch fixes trac issue #1022 (at least it makes it
    exit with a proper error message instead of crashing).
    
    Signed-off-by: Reimar Döffinger <Reimar.Doeffinger@gmx.de>

diff --git a/libavformat/rmenc.c b/libavformat/rmenc.c
index 8a9d84017a..3919ee9219 100644
--- a/libavformat/rmenc.c
+++ b/libavformat/rmenc.c
@@ -309,6 +309,11 @@ static int rm_write_header(AVFormatContext *s)
     int n;
     AVCodecContext *codec;
 
+    if (s->nb_streams > 2) {
+        av_log(s, AV_LOG_ERROR, "At most 2 streams are currently supported for muxing in RM\n");
+        return AVERROR_PATCHWELCOME;
+    }
+
     for(n=0;n<s->nb_streams;n++) {
         s->streams[n]->id = n;
         codec = s->streams[n]->codec;

