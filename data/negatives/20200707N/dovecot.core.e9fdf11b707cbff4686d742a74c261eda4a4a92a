commit e9fdf11b707cbff4686d742a74c261eda4a4a92a
Author: Timo Sirainen <timo.sirainen@dovecot.fi>
Date:   Sun Jun 5 15:31:20 2016 +0300

    mailbox-alias plugin: Fixed error handling

diff --git a/src/plugins/mailbox-alias/mailbox-alias-plugin.c b/src/plugins/mailbox-alias/mailbox-alias-plugin.c
index 6cfe6a801..d7ee7f9de 100644
--- a/src/plugins/mailbox-alias/mailbox-alias-plugin.c
+++ b/src/plugins/mailbox-alias/mailbox-alias-plugin.c
@@ -225,7 +225,9 @@ static int mailbox_alias_delete(struct mailbox *box)
 		return -1;
 	}
 
-	if (mailbox_is_alias_symlink(box)) {
+	if ((ret = mailbox_is_alias_symlink(box)) < 0)
+		return -1;
+	if (ret > 0) {
 		/* we're deleting an alias mailbox. we'll need to handle this
 		   explicitly since box->name points to the original mailbox */
 		symlink_name = alist->module_ctx.super.
@@ -245,12 +247,16 @@ static int mailbox_alias_rename(struct mailbox *src, struct mailbox *dest)
 	struct mailbox_alias_mailbox *abox = MAILBOX_ALIAS_CONTEXT(src);
 	int ret;
 
-	if (mailbox_is_alias_symlink(src)) {
+	if ((ret = mailbox_is_alias_symlink(src)) < 0)
+		return -1;
+	else if (ret > 0) {
 		mail_storage_set_error(src->storage, MAIL_ERROR_NOTPOSSIBLE,
 				       "Can't rename alias mailboxes");
 		return -1;
 	}
-	if (mailbox_is_alias_symlink(dest)) {
+	if ((ret = mailbox_is_alias_symlink(dest)) < 0)
+		return -1;
+	else {
 		mail_storage_set_error(src->storage, MAIL_ERROR_NOTPOSSIBLE,
 				       "Can't rename to mailbox alias");
 		return -1;

