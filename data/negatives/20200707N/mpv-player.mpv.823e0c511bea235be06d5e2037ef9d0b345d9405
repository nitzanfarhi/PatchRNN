commit 823e0c511bea235be06d5e2037ef9d0b345d9405
Author: wm4 <wm4@nowhere>
Date:   Fri Jun 28 20:30:37 2013 +0200

    mp_image: copy palette only if allocated
    
    Normally, we assume that IMGFMT_PAL8 always has a palette allocated
    in plane 1. But there may be corner cases in ffmpeg where it doesn't
    (namely pseudo-pal stuff).

diff --git a/video/mp_image.c b/video/mp_image.c
index d0be9d4ded..ec8f14fc34 100644
--- a/video/mp_image.c
+++ b/video/mp_image.c
@@ -327,7 +327,8 @@ void mp_image_copy_attributes(struct mp_image *dst, struct mp_image *src)
         dst->levels = src->levels;
     }
     if (dst->imgfmt == IMGFMT_PAL8 && src->imgfmt == IMGFMT_PAL8) {
-        memcpy(dst->planes[1], src->planes[1], MP_PALETTE_SIZE);
+        if (dst->planes[1] && src->planes[1])
+            memcpy(dst->planes[1], src->planes[1], MP_PALETTE_SIZE);
     }
 }
 

