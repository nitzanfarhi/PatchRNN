commit 6bb705711b90a64dd1b4ff4dad41cf866e69de78
Author: bellard <bellard@c046a42c-6fe2-441c-8c8c-71466251a162>
Date:   Sun Nov 23 23:26:39 2003 +0000

    a20 fix
    
    
    git-svn-id: svn://svn.savannah.nongnu.org/qemu/trunk@477 c046a42c-6fe2-441c-8c8c-71466251a162

diff --git a/target-i386/helper2.c b/target-i386/helper2.c
index 9abf7ffc7f..47c18fbaad 100644
--- a/target-i386/helper2.c
+++ b/target-i386/helper2.c
@@ -190,6 +190,10 @@ void cpu_x86_set_a20(CPUX86State *env, int a20_state)
 {
     a20_state = (a20_state != 0);
     if (a20_state != a20_enabled) {
+        /* if the cpu is currently executing code, we must unlink it and
+           all the potentially executing TB */
+        cpu_interrupt(env, 0);
+
         /* when a20 is changed, all the MMU mappings are invalid, so
            we must flush everything */
         page_unmap();

