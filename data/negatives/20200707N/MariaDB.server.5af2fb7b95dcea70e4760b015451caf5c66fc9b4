commit 5af2fb7b95dcea70e4760b015451caf5c66fc9b4
Author: Zardosht Kasheff <zardosht@tokutek.com>
Date:   Wed Apr 17 00:01:59 2013 -0400

    [t:2435], display amount of data_free in show table status
    
    git-svn-id: file:///svn/mysql/tokudb-engine/tokudb-engine@18267 c7de825b-a66e-492c-adef-691d508d4ae1

diff --git a/storage/tokudb/ha_tokudb.cc b/storage/tokudb/ha_tokudb.cc
index b51af000eb4..8927d454561 100644
--- a/storage/tokudb/ha_tokudb.cc
+++ b/storage/tokudb/ha_tokudb.cc
@@ -4708,6 +4708,8 @@ int ha_tokudb::info(uint flag) {
         stats.deleted = 0;
         if (!(flag & HA_STATUS_NO_LOCK)) {
             u_int64_t num_rows = 0;
+            TOKU_DB_FRAGMENTATION_S frag_info = {0};
+            u_int64_t num_deleted_bytes = 0;
             error = db_env->txn_begin(db_env, NULL, &txn, DB_READ_UNCOMMITTED);
             if (error) { goto cleanup; }
 
@@ -4719,6 +4721,12 @@ int ha_tokudb::info(uint flag) {
             else {
                 goto cleanup;
             }
+            error = share->file->get_fragmentation(
+                share->file,
+                &frag_info
+                );
+            if (error) { goto cleanup; }
+            stats.delete_length = frag_info.unused_bytes;
 
             error = share->file->stat64(
                 share->file, 
@@ -4757,6 +4765,13 @@ int ha_tokudb::info(uint flag) {
                     );
                 if (error) { goto cleanup; }
                 stats.index_file_length += dict_stats.bt_dsize;
+
+                error = share->file->get_fragmentation(
+                    share->file,
+                    &frag_info
+                    );
+                if (error) { goto cleanup; }
+                stats.delete_length += frag_info.unused_bytes;
             }
         }
     }

