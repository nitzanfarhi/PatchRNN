commit ac02b2e15db98537e9d06b1d4b045c44c1928951
Author: mskold@mysql.com <>
Date:   Tue Jul 20 16:31:18 2004 +0200

    Fix for bug#4650 Scan does not report timeout of owning transaction

diff --git a/ndb/src/kernel/blocks/dbtc/DbtcMain.cpp b/ndb/src/kernel/blocks/dbtc/DbtcMain.cpp
index fe179ee6b62..ba92d563d65 100644
--- a/ndb/src/kernel/blocks/dbtc/DbtcMain.cpp
+++ b/ndb/src/kernel/blocks/dbtc/DbtcMain.cpp
@@ -8502,6 +8502,13 @@ void Dbtc::execSCAN_TABREQ(Signal* signal)
     if ((transid1 == buddyApiPtr.p->transid[0]) &&
 	(transid2 == buddyApiPtr.p->transid[1])) {
       jam();
+      
+      if (buddyApiPtr.p->apiConnectstate == CS_ABORTING) {
+	// transaction has timed out
+	jam();
+	errCode = ZTIME_OUT_ERROR;
+	goto SCAN_TAB_error;
+      }//if
       currSavePointId = buddyApiPtr.p->currSavePointId;
       buddyApiPtr.p->currSavePointId++;
     }

