commit f0075735e9e6c921e6f882864fb043be95edb3cf
Author: dbeer <dbeer@8f940c70-5916-0410-ac46-d1fa2fa6ea29>
Date:   Thu May 24 15:50:10 2012 +0000

    Check for NULL before free'ing properties in node_spec() and make sure we're cray enabled before changing parsing in parse_req_data()

diff --git a/src/server/node_manager.c b/src/server/node_manager.c
index dd16d9f2a..48f8bbb8b 100644
--- a/src/server/node_manager.c
+++ b/src/server/node_manager.c
@@ -3474,9 +3474,11 @@ int parse_req_data(
   {
   int               i;
   int               j;
+  long              cray_enabled = FALSE;
 
   single_spec_data *req;
 
+  get_svr_attr_l(SRV_ATR_CrayEnabled, &cray_enabled);
   all_reqs->total_nodes = 0;
 
   for (i = 0; i < all_reqs->num_reqs; i++)
@@ -3487,7 +3489,8 @@ int parse_req_data(
     req->ppn   = 1;
     req->prop  = NULL;
 
-    if (is_compute_node(all_reqs->req_start[i]) == FALSE)
+    if ((cray_enabled == FALSE) ||
+        (is_compute_node(all_reqs->req_start[i]) == FALSE))
       {
       if ((j = number(&(all_reqs->req_start[i]), &(req->nodes))) == -1)
         return(j);
@@ -4041,8 +4044,11 @@ int node_spec(
 
   free(all_reqs.reqs);
   free(all_reqs.req_start);
+
   for (i = 0; i < all_reqs.num_reqs; i++)
-    free_prop(all_reqs.reqs[i].prop);
+    if (all_reqs.reqs[i].prop != NULL)
+      free_prop(all_reqs.reqs[i].prop);
+
   free(spec);
 
 #ifndef CRAY_MOAB_PASSTHRU

