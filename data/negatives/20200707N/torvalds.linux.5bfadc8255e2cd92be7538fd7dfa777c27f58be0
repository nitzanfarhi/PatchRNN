commit 5bfadc8255e2cd92be7538fd7dfa777c27f58be0
Author: Haim Dreyfuss <haim.dreyfuss@intel.com>
Date:   Mon Sep 12 10:24:19 2016 +0300

    iwlwifi: mvm: comply with fw_restart mod param on suspend
    
    If the suspend flow fails, we restart the hardware to go back to
    the D0 image (with non-unified images), but we don't comply with
    the fw_restart module parameter.  If something goes wrong when
    starting the D3 image, we may want to debug it, so we should
    comply with the fw_restart flag to avoid clearing everything up
    and losing the firmware state when the error occurred.
    
    Signed-off-by: Haim Dreyfuss <haim.dreyfuss@intel.com>
    Signed-off-by: Luca Coelho <luciano.coelho@intel.com>

diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/d3.c b/drivers/net/wireless/intel/iwlwifi/mvm/d3.c
index 0e17cb238643..03a8fc586548 100644
--- a/drivers/net/wireless/intel/iwlwifi/mvm/d3.c
+++ b/drivers/net/wireless/intel/iwlwifi/mvm/d3.c
@@ -1254,7 +1254,10 @@ static int __iwl_mvm_suspend(struct ieee80211_hw *hw,
  out:
 	if (ret < 0) {
 		iwl_mvm_ref(mvm, IWL_MVM_REF_UCODE_DOWN);
-		ieee80211_restart_hw(mvm->hw);
+		if (mvm->restart_fw > 0) {
+			mvm->restart_fw--;
+			ieee80211_restart_hw(mvm->hw);
+		}
 		iwl_mvm_free_nd(mvm);
 	}
  out_noreset:

