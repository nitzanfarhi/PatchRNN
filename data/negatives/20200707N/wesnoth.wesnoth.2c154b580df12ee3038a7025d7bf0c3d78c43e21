commit 2c154b580df12ee3038a7025d7bf0c3d78c43e21
Author: Victor Sergienko <singalen@gmail.com>
Date:   Thu Nov 23 21:19:28 2017 -0800

    Crash in attack_type::matches_filter - impl_unit_attack_match in some scenarios.

diff --git a/src/scripting/lua_unit_attacks.cpp b/src/scripting/lua_unit_attacks.cpp
index 6740e0b755..1fc3eec538 100644
--- a/src/scripting/lua_unit_attacks.cpp
+++ b/src/scripting/lua_unit_attacks.cpp
@@ -319,6 +319,9 @@ static int impl_unit_attack_match(lua_State* L)
 {
 	const_attack_ptr atk = luaW_toweapon(L, 1);
 	config cfg = luaW_checkconfig(L, 2);
+	if(!atk) {
+		return luaL_argerror(L, 1, "invalid attack");
+	}
 	lua_pushboolean(L, atk->matches_filter(cfg));
 	return 1;
 }

