commit 1650d66a8da45f79e965e30abdd7ce0c1d017396
Author: Hongli Lai (Phusion) <hongli@phusion.nl>
Date:   Tue Feb 24 19:57:39 2009 +0100

    Remove DOCUMENT_URI variable. Generate PATH_INFO the same way as DOCUMENT_ROOT is generated.

diff --git a/ext/nginx/Configuration.c b/ext/nginx/Configuration.c
index 098a3086d..23ba735aa 100644
--- a/ext/nginx/Configuration.c
+++ b/ext/nginx/Configuration.c
@@ -192,8 +192,6 @@ passenger_create_loc_conf(ngx_conf_t *cf)
     DEFINE_VAR_TO_PASS("REQUEST_METHOD",  "$request_method");
     DEFINE_VAR_TO_PASS("CONTENT_TYPE",    "$content_type");
     DEFINE_VAR_TO_PASS("REQUEST_URI",     "$request_uri");
-    DEFINE_VAR_TO_PASS("PATH_INFO",       "$document_uri");
-    DEFINE_VAR_TO_PASS("DOCUMENT_URI",    "$document_uri");
     DEFINE_VAR_TO_PASS("SERVER_PROTOCOL", "$server_protocol");
     DEFINE_VAR_TO_PASS("SERVER_SOFTWARE", "nginx/$nginx_version");
     DEFINE_VAR_TO_PASS("REMOTE_ADDR",     "$remote_addr");
diff --git a/ext/nginx/ContentHandler.c b/ext/nginx/ContentHandler.c
index c2d64d5f7..c267e3621 100644
--- a/ext/nginx/ContentHandler.c
+++ b/ext/nginx/ContentHandler.c
@@ -227,8 +227,9 @@ create_request(ngx_http_request_t *r)
     /* +1 for trailing null */
     len = sizeof("CONTENT_LENGTH") + ngx_strlen(buf) + 1;
     
-    /* DOCUMENT_ROOT and base URI */
+    /* DOCUMENT_ROOT, PATH_INFO and base URI */
     len += sizeof("DOCUMENT_ROOT") + context->public_dir.len + 1;
+    len += sizeof("PATH_INFO") + context->public_dir.len + 1;
     if (context->base_uri.len > 0) {
         len += sizeof("RAILS_RELATIVE_URL_ROOT") +
                context->base_uri.len + 1;
@@ -332,6 +333,11 @@ create_request(ngx_http_request_t *r)
     b->last = ngx_copy(b->last, "DOCUMENT_ROOT", sizeof("DOCUMENT_ROOT"));
     b->last = ngx_copy(b->last, context->public_dir.data,
                        context->public_dir.len + 1);
+    
+    b->last = ngx_copy(b->last, "PATH_INFO", sizeof("PATH_INFO"));
+    b->last = ngx_copy(b->last, context->public_dir.data,
+                       context->public_dir.len + 1);
+    
     if (context->base_uri.len > 0) {
         b->last = ngx_copy(b->last, "RAILS_RELATIVE_URL_ROOT",
                            sizeof("RAILS_RELATIVE_URL_ROOT"));

