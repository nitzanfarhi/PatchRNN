commit 90719fa67d5459fcf9d2fad06ff42b3ddead9434
Author: John C. Frickson <jfrickson@nagios.com>
Date:   Wed Aug 19 16:40:17 2015 -0500

    exclude (!) not working
    
    Fixes issue https://github.com/NagiosEnterprises/nagioscore/issues/72

diff --git a/xdata/xodtemplate.c b/xdata/xodtemplate.c
index d07c4c10..02b62fa9 100644
--- a/xdata/xodtemplate.c
+++ b/xdata/xodtemplate.c
@@ -4896,6 +4896,9 @@ static int xodtemplate_register_and_destroy_servicedependency(void *sd_)
 			continue;
 		bitmap_set(parent_map, p->id);
 
+        bitmap_clear(service_map);
+
+
 		/*
 		 * if this is a same-host dependency, we must expand
 		 * dependent_service_description for the host we're
@@ -4911,8 +4914,6 @@ static int xodtemplate_register_and_destroy_servicedependency(void *sd_)
 			}
 		}
 
-        bitmap_clear(service_map);
-
 		for(clist = children; clist; clist = clist->next) {
 			xodtemplate_service *c = (xodtemplate_service *)clist->object_ptr;
 			if(bitmap_isset(service_map, c->id))

