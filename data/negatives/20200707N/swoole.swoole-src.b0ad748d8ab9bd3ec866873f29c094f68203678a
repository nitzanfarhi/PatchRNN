commit b0ad748d8ab9bd3ec866873f29c094f68203678a
Author: matyhtf <mikan.tenny@gmail.com>
Date:   Fri Jul 14 15:08:23 2017 +0800

    fixed CID#1414719

diff --git a/src/network/Server.c b/src/network/Server.c
index a2df84b3..02ab48c8 100644
--- a/src/network/Server.c
+++ b/src/network/Server.c
@@ -1094,6 +1094,9 @@ int swServer_add_worker(swServer *serv, swWorker *worker)
     return worker->id;
 }
 
+/**
+ * Return the number of ports successfully
+ */
 int swserver_add_systemd_socket(swServer *serv)
 {
     char *e = getenv("LISTEN_PID");
@@ -1120,6 +1123,11 @@ int swserver_add_systemd_socket(swServer *serv)
         swWarn("invalid LISTEN_FDS.");
         return 0;
     }
+    else if (n >= SW_MAX_LISTEN_PORT)
+    {
+        swoole_error_log(SW_LOG_ERROR, SW_ERROR_SERVER_TOO_MANY_LISTEN_PORT, "LISTEN_FDS is too big.");
+        return 0;
+    }
 
     int count = 0;
     int sock, val;

