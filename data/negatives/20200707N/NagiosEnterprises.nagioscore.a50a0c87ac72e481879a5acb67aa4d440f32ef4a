commit a50a0c87ac72e481879a5acb67aa4d440f32ef4a
Author: Andreas Ericsson <ae@op5.se>
Date:   Tue May 10 14:48:49 2011 +0000

    Use retry_interval for host freshness (re)checking
    
    Previously the normal check_interval was used regardless of the
    state of the host. This contradicted the documented behaviour
    and the behaviour of services, so fix hosts to work as people
    expect them to.
    
    This fixes issue #184, which suggests a slightly different patch.
    
    Reported-by: Rodney Ramos <rodneyra@gmail.com>
    Original-patch-by: Rodney Ramos <rodneyra@gmail.com>
    Signed-off-by: Andreas Ericsson <ae@op5.se>
    
    git-svn-id: https://nagios.svn.sourceforge.net/svnroot/nagios/nagioscore/trunk@1728 5f96b256-904b-4d8d-8c98-d829582c6739

diff --git a/base/checks.c b/base/checks.c
index b0fc9684..049c8b60 100644
--- a/base/checks.c
+++ b/base/checks.c
@@ -2440,8 +2440,16 @@ int is_host_result_fresh(host *temp_host, time_t current_time, int log_this){
 	log_debug_info(DEBUGL_CHECKS,2,"Checking freshness of host '%s'...\n",temp_host->name);
 
 	/* use user-supplied freshness threshold or auto-calculate a freshness threshold to use? */
-	if(temp_host->freshness_threshold==0)
-		freshness_threshold=(temp_host->check_interval*interval_length)+temp_host->latency+additional_freshness_latency;
+	if(temp_host->freshness_threshold==0) {
+		double interval;
+
+		if(temp_host->state_type==HARD_STATE || temp_host->current_state==STATE_OK) {
+			interval=temp_host->check_interval;
+		} else {
+			interval=temp_host->retry_interval;
+		}
+		freshness_threshold=(interval*interval_length)+temp_host->latency+additional_freshness_latency;
+	}
 	else
 		freshness_threshold=temp_host->freshness_threshold;
 

