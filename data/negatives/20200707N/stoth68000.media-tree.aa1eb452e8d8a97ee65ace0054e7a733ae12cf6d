commit aa1eb452e8d8a97ee65ace0054e7a733ae12cf6d
Author: Ben Dooks <ben-linux@fluff.org>
Date:   Tue Jun 24 22:16:03 2008 +0100

    DM9000: Use NSR to determine link-status on internal PHY
    
    The DM9000_NSR register contains a copy of the internal PHY's
    link status which we can use to determine if the link is up
    or down. This eliminates the more costly (and sleeping) PHY
    read when using the DM9000's own PHY.
    
    Signed-off-by: Ben Dooks <ben-linux@fluff.org>
    Signed-off-by: Jeff Garzik <jgarzik@redhat.com>

diff --git a/drivers/net/dm9000.c b/drivers/net/dm9000.c
index 679c291107f5..7c38f6129b55 100644
--- a/drivers/net/dm9000.c
+++ b/drivers/net/dm9000.c
@@ -473,7 +473,14 @@ static int dm9000_nway_reset(struct net_device *dev)
 static u32 dm9000_get_link(struct net_device *dev)
 {
 	board_info_t *dm = to_dm9000_board(dev);
-	return mii_link_ok(&dm->mii);
+	u32 ret;
+
+	if (dm->flags & DM9000_PLATF_EXT_PHY)
+		ret = mii_link_ok(&dm->mii);
+	else
+		ret = dm9000_read_locked(dm, DM9000_NSR) & NSR_LINKST ? 1 : 0;
+
+	return ret;
 }
 
 #define DM_EEPROM_MAGIC		(0x444D394B)

