commit 813ffb8b53c6a0c0f34cbd0255c7fa481991fc77
Author: nobu <nobu@b2dd03c8-39d4-4d8f-98ff-823fe69b080e>
Date:   Tue Sep 5 07:52:08 2017 +0000

    st.c: fix num_entries
    
    * st.c (st_insert2): should manage num_entries when the key is
      undefined, as well as st_insert().
    
    git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/trunk@59748 b2dd03c8-39d4-4d8f-98ff-823fe69b080e

diff --git a/st.c b/st.c
index 976bcf4648..a465de4ae5 100644
--- a/st.c
+++ b/st.c
@@ -1197,6 +1197,8 @@ st_insert2(st_table *tab, st_data_t key, st_data_t value,
     if (tab->bins == NULL) {
         bin = find_entry(tab, hash_value, key);
 	new_p = bin == UNDEFINED_ENTRY_IND;
+	if (new_p)
+	    tab->num_entries++;
 	bin_ind = UNDEFINED_BIN_IND;
     }
     else {

