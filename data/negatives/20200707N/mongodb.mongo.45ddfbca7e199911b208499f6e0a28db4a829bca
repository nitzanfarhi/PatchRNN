commit 45ddfbca7e199911b208499f6e0a28db4a829bca
Author: Brandon Diamond <brandon@10gen.com>
Date:   Tue Dec 6 14:00:51 2011 -0500

    SERVER-4415: Added safe isinf function

diff --git a/bson/bson-inl.h b/bson/bson-inl.h
index 00f7ac8721..9e8b365480 100644
--- a/bson/bson-inl.h
+++ b/bson/bson-inl.h
@@ -34,6 +34,23 @@ namespace mongo {
         return d != d;
     }
 
+    inline bool isInf(double d, int* sign = 0) {
+        volatile double tmp = d;
+
+        if ((tmp == d) && ((tmp - d) != 0.0)) {
+            if ( sign ) {
+                *sign = (d < 0.0 ? -1 : 1);
+            }
+            return true;
+        }
+        
+        if ( sign ) {
+            *sign = 0;
+        }
+
+        return false;
+    }
+
     /* must be same type when called, unless both sides are #s 
        this large function is in header to facilitate inline-only use of bson
     */

