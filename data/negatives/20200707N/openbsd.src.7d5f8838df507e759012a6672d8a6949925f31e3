commit 7d5f8838df507e759012a6672d8a6949925f31e3
Author: sthen <sthen@openbsd.org>
Date:   Sat Aug 20 11:11:30 2011 +0000

    event_del() a persistent event; fixes segfault seen on the server when the
    remote end closes and reopens a connection.
    
    From Christiano F. Haesbaert, ok claudio@

diff --git a/usr.bin/tcpbench/tcpbench.c b/usr.bin/tcpbench/tcpbench.c
index cdd60771570..a25314882d1 100644
--- a/usr.bin/tcpbench/tcpbench.c
+++ b/usr.bin/tcpbench/tcpbench.c
@@ -642,6 +642,7 @@ again:
 	} else if (n == 0) {
 		if (ptb->vflag)
 			fprintf(stderr, "%8d closed by remote end\n", sc->fd);
+		event_del(&sc->ev);
 		close(sc->fd);
 		TAILQ_REMOVE(&sc_queue, sc, entry);
 		free(sc);

