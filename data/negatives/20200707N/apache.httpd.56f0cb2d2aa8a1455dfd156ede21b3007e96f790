commit 56f0cb2d2aa8a1455dfd156ede21b3007e96f790
Author: Ryan Bloom <rbb@apache.org>
Date:   Fri Apr 5 17:43:03 2002 +0000

    This fixes the mod_autoindex problem of not getting the list of files.
    The problem was that the internal_fast_redirect removed the SUB_REQ
    filter, but we are still in a sub_request.  The solution is to have the
    fast_internal_Redirect function check if we are in a sub_Request and
    re-add the filter if we are.
    Submitted by:   Ryan Bloom, Greg Ames, Jeff Trawick, and Will Rowe
    
    
    git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/trunk@94456 13f79535-47bb-0310-9956-ffa450edef68

diff --git a/modules/http/http_request.c b/modules/http/http_request.c
index 07e4de542c..7d3f82e3f1 100644
--- a/modules/http/http_request.c
+++ b/modules/http/http_request.c
@@ -420,6 +420,11 @@ AP_DECLARE(void) ap_internal_fast_redirect(request_rec *rr, request_rec *r)
 
     r->output_filters = rr->output_filters;
     r->input_filters = rr->input_filters;
+
+    if (r->main) {
+        ap_add_output_filter_handle(ap_subreq_core_filter_handle,
+                                    NULL, r, r->connection);
+    }
 }
 
 AP_DECLARE(void) ap_internal_redirect(const char *new_uri, request_rec *r)

