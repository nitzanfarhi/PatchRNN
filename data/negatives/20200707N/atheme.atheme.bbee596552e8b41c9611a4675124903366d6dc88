commit bbee596552e8b41c9611a4675124903366d6dc88
Author: William Pitcock <nenolod@atheme.org>
Date:   Sun Aug 29 13:16:11 2010 -0500

    Validate service hosts using is_valid_host().
    Reject and warn about invalid hostnames in the config file.  Since the hostname is
    rejected, the default hostname is used instead, which is the services server name.

diff --git a/src/servtree.c b/src/servtree.c
index 5a1626233..8a2633f0b 100644
--- a/src/servtree.c
+++ b/src/servtree.c
@@ -123,6 +123,12 @@ static int conf_service_host(config_entry_t *ce)
 	if (!ce->ce_vardata)
 		return -1;
 
+	if (!is_valid_host(ce->ce_vardata))
+	{
+		conf_report_warning(ce, "invalid hostname: %s", ce->ce_vardata);
+		return -1;
+	}
+
 	sptr = service_find(ce->ce_prevlevel->ce_varname);
 	if (!sptr)
 		return -1;

