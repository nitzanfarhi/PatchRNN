commit 9dd694d3d6fa1cc7c52e462325bfe7d7f096215d
Author: Bertrand Bellenot <bertrand.bellenot@cern.ch>
Date:   Tue Feb 17 09:49:47 2015 +0100

    From Axel: Forward eof on Windows and assert on non-Windows platforms

diff --git a/interpreter/cling/lib/Interpreter/IncrementalParser.cpp b/interpreter/cling/lib/Interpreter/IncrementalParser.cpp
index c91c0af5e8..2350546867 100644
--- a/interpreter/cling/lib/Interpreter/IncrementalParser.cpp
+++ b/interpreter/cling/lib/Interpreter/IncrementalParser.cpp
@@ -814,6 +814,7 @@ namespace cling {
         m_Consumer->HandleTopLevelDecl(ADecl.get());
     };
 
+#ifdef LLVM_ON_WIN32
     // Microsoft-specific:
     // Late parsed templates can leave unswallowed "macro"-like tokens.
     // They will seriously confuse the Parser when entering the next
@@ -822,6 +823,13 @@ namespace cling {
     do {
       PP.Lex(Tok);
     } while (Tok.isNot(tok::eof));
+#endif
+
+#ifndef NDEBUG
+    Token AssertTok;
+    PP.Lex(AssertTok);
+    assert(AssertTok.is(tok::eof) && "Lexer must be EOF when starting incremental parse!");
+#endif
 
     if (IgnorePromptDiags) {
       SourceLocation Loc = SM.getLocForEndOfFile(m_MemoryBuffers.back().second);

