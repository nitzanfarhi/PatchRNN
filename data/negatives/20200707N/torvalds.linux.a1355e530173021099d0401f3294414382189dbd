commit a1355e530173021099d0401f3294414382189dbd
Author: Andrew Morton <akpm@linux-foundation.org>
Date:   Wed Apr 30 11:40:17 2008 -0300

    V4L/DVB (7800): tuner_symbol_probe(): don't do symbol_put() if symbol_request() failed
    
    Because it goes BUG.
    
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Acked-by: Michael Krufky <mkrufky@linuxtv.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>

diff --git a/drivers/media/video/tuner-core.c b/drivers/media/video/tuner-core.c
index 6bf104ea051d..c8cd718675ab 100644
--- a/drivers/media/video/tuner-core.c
+++ b/drivers/media/video/tuner-core.c
@@ -40,11 +40,11 @@
 	typeof(&FUNCTION) __a = symbol_request(FUNCTION); \
 	if (__a) { \
 		__r = (int) __a(ARGS); \
+		symbol_put(FUNCTION); \
 	} else { \
 		printk(KERN_ERR "TUNER: Unable to find " \
 				"symbol "#FUNCTION"()\n"); \
 	} \
-	symbol_put(FUNCTION); \
 	__r; \
 })
 

