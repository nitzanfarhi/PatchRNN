commit 49cd619c69d643b30a24029e40eb5364c7a26b2e
Author: Alan Cox <alan@redhat.com>
Date:   Mon Jan 9 09:35:28 2006 -0500

    [PATCH] moxa serial: add proper capability check
    
    This requires the proper capabilities for the moxa bios update ioctl's.
    
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

diff --git a/drivers/char/moxa.c b/drivers/char/moxa.c
index 5e3ef5522194..f43c2e04eadd 100644
--- a/drivers/char/moxa.c
+++ b/drivers/char/moxa.c
@@ -1649,6 +1649,8 @@ int MoxaDriverIoctl(unsigned int cmd, unsigned long arg, int port)
 	case MOXA_FIND_BOARD:
 	case MOXA_LOAD_C320B:
 	case MOXA_LOAD_CODE:
+		if (!capable(CAP_SYS_RAWIO))
+			return -EPERM;
 		break;
 	}
 

