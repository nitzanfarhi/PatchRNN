commit fc7ceab0834291cda02eb6f15bb20513f6a8d4e8
Author: Zoltan Varga <vargaz@gmail.com>
Date:   Mon Jul 8 22:30:11 2013 +0200

    Remove the constraint checks from get_shared_inst (), it is no longer needed since we replace gsharedvt arguments with a vtype now. Fixes #12727.

diff --git a/mono/mini/mini.c b/mono/mini/mini.c
index 5b4d3c66f1e..e0576bd1fbd 100644
--- a/mono/mini/mini.c
+++ b/mono/mini/mini.c
@@ -4511,26 +4511,6 @@ is_open_method (MonoMethod *method)
 	return FALSE;
 }
 
-static gboolean
-has_ref_constraint (MonoGenericParamInfo *info)
-{
-	MonoClass **constraints;
-
-	//return FALSE;
-
-	if (info && info->constraints) {
-		constraints = info->constraints;
-
-		while (*constraints) {
-			MonoClass *cklass = *constraints;
-			if (!(cklass == mono_defaults.object_class || (cklass->image == mono_defaults.corlib && !strcmp (cklass->name, "ValueType")) || MONO_CLASS_IS_INTERFACE (cklass)))
-				return TRUE;
-			constraints ++;
-		}
-	}
-	return FALSE;
-}
-
 static MonoGenericInst*
 get_shared_inst (MonoGenericInst *inst, MonoGenericInst *shared_inst, MonoGenericContainer *container, gboolean all_vt, gboolean gsharedvt)
 {
@@ -4543,10 +4523,7 @@ get_shared_inst (MonoGenericInst *inst, MonoGenericInst *shared_inst, MonoGeneri
 		if (!all_vt && (MONO_TYPE_IS_REFERENCE (inst->type_argv [i]) || inst->type_argv [i]->type == MONO_TYPE_VAR || inst->type_argv [i]->type == MONO_TYPE_MVAR)) {
 			type_argv [i] = shared_inst->type_argv [i];
 		} else if (all_vt) {
-			if (container && has_ref_constraint (&container->type_params [i].info))
-				type_argv [i] = shared_inst->type_argv [i];
-			else
-				type_argv [i] = get_gsharedvt_type (shared_inst->type_argv [i]);
+			type_argv [i] = get_gsharedvt_type (shared_inst->type_argv [i]);
 		} else if (gsharedvt) {
 			type_argv [i] = get_gsharedvt_type (shared_inst->type_argv [i]);
 		} else {

