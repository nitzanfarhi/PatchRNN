commit 2782c2d302557403e314a43856f681a5385e62c6
Author: Yann Droneaud <ydroneaud@opteya.com>
Date:   Wed Dec 11 23:01:48 2013 +0100

    IB/uverbs: Check comp_mask in destroy_flow
    
    Just like the check added to create_flow in 22878dbc9173 ("IB/core:
    Better checking of userspace values for receive flow steering"),
    comp_mask must be checked in destroy_flow too.
    
    Since only empty comp_mask is currently supported, any other value
    must be rejected.
    
    This check was silently added in a previous patch[1] to move comp_mask
    in extended command header, part of previous patchset[2] against
    create/destroy_flow uverbs. The idea of moving comp_mask to the header
    was discarded for the final patchset[3].
    
    Unfortunately the check added in destroy_flow uverb was not integrated
    in the final patchset.
    
    [1] http://marc.info/?i=40175eda10d670d098204da6aa4c327a0171ae5f.1381510045.git.ydroneaud@opteya.com
    [2] http://marc.info/?i=cover.1381510045.git.ydroneaud@opteya.com
    [3] http://marc.info/?i=cover.1383773832.git.ydroneaud@opteya.com
    
    Cc: Matan Barak <matanb@mellanox.com>
    Link: http://marc.info/?i=cover.1386798254.git.ydroneaud@opteya.com>
    Signed-off-by: Yann Droneaud <ydroneaud@opteya.com>
    Signed-off-by: Roland Dreier <roland@purestorage.com>

diff --git a/drivers/infiniband/core/uverbs_cmd.c b/drivers/infiniband/core/uverbs_cmd.c
index 65f6e7dc380c..f0ee6b92132a 100644
--- a/drivers/infiniband/core/uverbs_cmd.c
+++ b/drivers/infiniband/core/uverbs_cmd.c
@@ -2795,6 +2795,9 @@ int ib_uverbs_ex_destroy_flow(struct ib_uverbs_file *file,
 	if (ret)
 		return ret;
 
+	if (cmd.comp_mask)
+		return -EINVAL;
+
 	uobj = idr_write_uobj(&ib_uverbs_rule_idr, cmd.flow_handle,
 			      file->ucontext);
 	if (!uobj)

