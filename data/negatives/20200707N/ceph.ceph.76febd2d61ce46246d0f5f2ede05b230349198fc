commit 76febd2d61ce46246d0f5f2ede05b230349198fc
Author: Josh Durgin <josh.durgin@dreamhost.com>
Date:   Thu May 5 16:28:06 2011 -0700

    PG: clear peering flag when we transition from Peering to Reset
    
    This is safe because the only other transitions are to Pending (still
    peering) and Active, which clears the state itself.
    
    Signed-off-by: Josh Durgin <josh.durgin@dreamhost.com>

diff --git a/src/osd/PG.cc b/src/osd/PG.cc
index 60bb1b89d3..8652106570 100644
--- a/src/osd/PG.cc
+++ b/src/osd/PG.cc
@@ -3908,6 +3908,7 @@ PG::RecoveryState::Peering::react(const AdvMap& advmap) {
   dout(10) << "Peering advmap" << dendl;
   if (pg->prior_set_affected(*prior_set.get(), &advmap.osdmap)) {
     dout(1) << "Peering, priors_set_affected, going to Reset" << dendl;
+    pg->state_clear(PG_STATE_PEERING);
     post_event(advmap);
     return transit< Reset >();
   }

