commit d5f201bcb544b3a58d36730bf6472d36bd94ddb5
Author: viktor.tarasov <viktor.tarasov@c6295689-39f2-0310-b995-f0e70906c6a9>
Date:   Wed Apr 28 09:20:17 2010 +0000

    pkcs15init: in sc_pkcs15init_update_file() take care about file selection errors
    
    Noted by Ludovic.
    
    In sc_pkcs15init_update_file() procedure the file selection errors other then SC_ERROR_FILE_NOT_FOUND were not treated.
    
    
    git-svn-id: https://www.opensc-project.org/svnp/opensc/trunk@4271 c6295689-39f2-0310-b995-f0e70906c6a9

diff --git a/src/pkcs15init/pkcs15-lib.c b/src/pkcs15init/pkcs15-lib.c
index e4565042..7aa56708 100644
--- a/src/pkcs15init/pkcs15-lib.c
+++ b/src/pkcs15init/pkcs15-lib.c
@@ -3253,8 +3253,11 @@ sc_pkcs15init_update_file(struct sc_profile *profile,
 		SC_TEST_RET(ctx, SC_LOG_DEBUG_NORMAL, r, "Failed to create file");
 		
 		r = sc_select_file(p15card->card, &file->path, &selected_file);
+		SC_TEST_RET(ctx, SC_LOG_DEBUG_NORMAL, r, "Failed to select newly created file");
+	}
+	else   {
 		SC_TEST_RET(ctx, SC_LOG_DEBUG_NORMAL, r, "Failed to select file");
-	} 
+	}	
 
 	if (selected_file->size < datalen) {
 		sc_debug(ctx, SC_LOG_DEBUG_NORMAL, "File %s too small (require %u, have %u)", 

