commit 7ff94b3808d45c12e1216b102c5af3933d156282
Author: heikki@hundin.mysql.fi <>
Date:   Mon May 17 17:27:25 2004 +0300

    dict0dict.c:
      Allocate the table name buffer from the mem heap of a foreign key object rather than pointing to the name buffer in the table object; even though this apparently caused no bugs in RENAME, DROP, ALTER TABLE, or elsewhere, this convention was very prone to memory allocation bugs

diff --git a/innobase/dict/dict0dict.c b/innobase/dict/dict0dict.c
index 51e92a9900f..0fc4ac2b687 100644
--- a/innobase/dict/dict0dict.c
+++ b/innobase/dict/dict0dict.c
@@ -2892,7 +2892,8 @@ col_loop1:
 	}
 
 	foreign->foreign_table = table;
-	foreign->foreign_table_name = table->name;
+	foreign->foreign_table_name = mem_heap_strdup(foreign->heap,
+							table->name);
 	foreign->foreign_index = index;
 	foreign->n_fields = i;
 	foreign->foreign_col_names = mem_heap_alloc(foreign->heap,

