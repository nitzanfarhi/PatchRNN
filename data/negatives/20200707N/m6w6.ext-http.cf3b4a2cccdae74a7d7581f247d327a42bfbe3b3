commit cf3b4a2cccdae74a7d7581f247d327a42bfbe3b3
Author: Michael Wallner <mike@php.net>
Date:   Thu Feb 12 16:50:54 2009 +0000

    MFB: Fixed Bug #15813      Requests not removed from multi stack when fatal errors occur

diff --git a/http_request_pool_api.c b/http_request_pool_api.c
index fcc015e..d1d76c3 100644
--- a/http_request_pool_api.c
+++ b/http_request_pool_api.c
@@ -301,6 +301,8 @@ PHP_HTTP_API void _http_request_pool_dtor(http_request_pool *pool)
 	efree(pool->timeout);
 #endif
 	
+	http_request_pool_detach_all(pool);
+	
 	pool->unfinished = 0;
 	zend_llist_clean(&pool->finished);
 	zend_llist_clean(&pool->handles);

