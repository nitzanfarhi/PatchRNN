commit 511de7f5dc047368799e18d028e1e3f2864e05ac
Author: Daniel-Constantin Mierla <miconda@gmail.com>
Date:   Mon Apr 21 17:56:01 2014 +0200

    core: link regex before replacement field allocation can fail
    
    - regex will be freed properly if there was an error for replacement

diff --git a/re.c b/re.c
index a90fe37eb..cf6a4854b 100644
--- a/re.c
+++ b/re.c
@@ -310,6 +310,7 @@ found_re:
 		goto error;
 	}
 	memset((void*)se, 0, sizeof(struct subst_expr));
+	se->re=regex;
 	se->replacement.len=repl_end-repl;
 	if (se->replacement.len > 0) {
 		if ((se->replacement.s=pkg_malloc(se->replacement.len))==0){
@@ -321,7 +322,6 @@ found_re:
 	} else {
 		se->replacement.s = NULL;
 	}
-	se->re=regex;
 	se->replace_all=replace_all;
 	se->n_escapes=rw_no;
 	se->max_pmatch=max_pmatch;

