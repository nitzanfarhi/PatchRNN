commit 84785f120f4d64c5fa8cf4bab1cf07c2507d434f
Author: Manuel Lauss <manuel.lauss@googlemail.com>
Date:   Sat Oct 22 13:34:38 2011 +0200

    i2c-au1550: increase timeout waiting for master done
    
    Double the timeout in the loop which busy-waits for the "master-done"
    bit to be set.  This bit indicates whether an i2c transaction has
    completed;  on the DB1300 and DB1550 boards this timeout is slightly
    too short and causes transactions to the WM8731 codec to be falsely flagged
    as failed.  The timeout itself is necessary since transactions to
    non-existant slaves never set this bit in the first place (and cause
    i2cdetect to hang).
    
    With this change the WM8731 codec on the DB1300/DB1550 boards is correctly
    detected and initialized.
    
    Signed-off-by: Manuel Lauss <manuel.lauss@googlemail.com>
    Signed-off-by: Ben Dooks <ben-linux@fluff.org>

diff --git a/drivers/i2c/busses/i2c-au1550.c b/drivers/i2c/busses/i2c-au1550.c
index 98ee11aa9e2c..4f5150c417a2 100644
--- a/drivers/i2c/busses/i2c-au1550.c
+++ b/drivers/i2c/busses/i2c-au1550.c
@@ -101,7 +101,7 @@ static int wait_master_done(struct i2c_au1550_data *adap)
 	int i;
 
 	/* Wait for Master Done. */
-	for (i = 0; i < adap->xfer_timeout; i++) {
+	for (i = 0; i < 2 * adap->xfer_timeout; i++) {
 		if ((RD(adap, PSC_SMBEVNT) & PSC_SMBEVNT_MD) != 0)
 			return 0;
 		udelay(1);

