From 39bbdebb1ed8eb9c9b0cd6db85afde6ba89d86e4 Mon Sep 17 00:00:00 2001
From: Michael Niedermayer <michael@niedermayer.cc>
Date: Mon, 13 Jul 2015 16:05:21 +0200
Subject: [PATCH] avcodec/sanm: Reset sizes in destroy_buffers()
MIME-Version: 1.0
Content-Type: text/plain; charset=utf8
Content-Transfer-Encoding: 8bit

Fixes crash in 1288a2fe8e9ae6b00ca40e089d08ca65_signal_sigsegv_7ffff71426a7_354_accident.san with allocation limit 65536

Found-by: Samuel GroÃ, Mateusz "j00ru" Jurczyk and Gynvael Coldwind
Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>
---
 libavcodec/sanm.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/libavcodec/sanm.c b/libavcodec/sanm.c
index 9e5ec5400e..2547abb840 100644
--- a/libavcodec/sanm.c
+++ b/libavcodec/sanm.c
@@ -457,6 +457,7 @@ static void destroy_buffers(SANMVideoContext *ctx)
     ctx->frm0_size =
     ctx->frm1_size =
     ctx->frm2_size = 0;
+    init_sizes(ctx, 0, 0);
 }
 
 static av_cold int init_buffers(SANMVideoContext *ctx)
-- 
2.11.0

