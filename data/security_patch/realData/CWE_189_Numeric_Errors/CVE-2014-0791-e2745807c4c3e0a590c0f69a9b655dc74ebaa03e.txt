From e2745807c4c3e0a590c0f69a9b655dc74ebaa03e Mon Sep 17 00:00:00 2001
From: Huzaifa Sidhpurwala <huzaifas@redhat.com>
Date: Thu, 2 Jan 2014 14:34:03 +0530
Subject: [PATCH] Fix possible integer overflow in license_read_scope_list()

---
 libfreerdp/core/license.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/libfreerdp/core/license.c b/libfreerdp/core/license.c
index e26e5e0fdb..d5b5d33ab2 100644
--- a/libfreerdp/core/license.c
+++ b/libfreerdp/core/license.c
@@ -670,6 +670,9 @@ BOOL license_read_scope_list(wStream* s, SCOPE_LIST* scopeList)
 
 	Stream_Read_UINT32(s, scopeCount); /* ScopeCount (4 bytes) */
 
+        if (Stream_GetRemainingLength(s) / sizeof(LICENSE_BLOB) < scopeCount)
+                return FALSE;  /* Avoid overflow in malloc */
+
 	scopeList->count = scopeCount;
 	scopeList->array = (LICENSE_BLOB*) malloc(sizeof(LICENSE_BLOB) * scopeCount);
 
