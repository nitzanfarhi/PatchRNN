From d2f339726d9a0adff075f7548232e2ca0c81a2f6 Mon Sep 17 00:00:00 2001
From: Matthew Farrellee <matt@redhat.com>
Date: Fri, 10 Aug 2012 10:09:25 -0400
Subject: [PATCH] Remove unused GIVE_REQUEST_AD command from the startd, #3169

Note: dos2unix was run on command.h for a clean cherry-pick from master

Signed-off-by: Jaime Frey <jfrey@cs.wisc.edu>
---
 src/condor_startd.V6/command.cpp     | 44 ------------------------------------
 src/condor_startd.V6/command.h       |  2 +-
 src/condor_startd.V6/startd_main.cpp |  3 ---
 3 files changed, 1 insertion(+), 48 deletions(-)

diff --git a/src/condor_startd.V6/command.cpp b/src/condor_startd.V6/command.cpp
index bbc279a..438827e 100644
--- a/src/condor_startd.V6/command.cpp
+++ b/src/condor_startd.V6/command.cpp
@@ -545,50 +545,6 @@ command_match_info( Service*, int cmd, Stream* stream )
 
 
 int
-command_give_request_ad( Service*, int, Stream* stream) 
-{
-	int pid = -1;  // Starter sends it's pid so we know what
-				   // resource's request ad to send 
-	Claim*		claim;
-	ClassAd*	cp;
-
-	if( ! stream->code(pid) ) {
-		dprintf( D_ALWAYS, "give_request_ad: Can't read pid\n" );
-		stream->encode();
-		stream->end_of_message();
-		return FALSE;
-	}
-	if( ! stream->end_of_message() ) {
-		dprintf( D_ALWAYS, "give_request_ad: Can't read eom\n" );
-		stream->encode();
-		stream->end_of_message();
-		return FALSE;
-	}
-	claim = resmgr->getClaimByPid( pid );
-	if( !claim ) {
-		dprintf( D_ALWAYS, 
-				 "give_request_ad: Can't find starter with pid %d\n",
-				 pid ); 
-		stream->encode();
-		stream->end_of_message();
-		return FALSE;
-	}
-	cp = claim->ad();
-	if( !cp ) {
-		claim->dprintf( D_ALWAYS, 
-						"give_request_ad: current claim has NULL classad.\n" );
-		stream->encode();
-		stream->end_of_message();
-		return FALSE;
-	}
-	stream->encode();
-	cp->put( *stream );
-	stream->end_of_message();
-	return TRUE;
-}
-
-
-int
 command_query_ads( Service*, int, Stream* stream) 
 {
 	ClassAd queryAd;
diff --git a/src/condor_startd.V6/command.h b/src/condor_startd.V6/command.h
index d0b18ba..9342938 100644
--- a/src/condor_startd.V6/command.h
+++ b/src/condor_startd.V6/command.h
@@ -83,7 +83,7 @@ int command_name_handler( Service*, int, Stream* );
    Command handler for dealing w/ ClassAd-only protocol commands
 */
 int command_classad_handler( Service*, int, Stream* );
-
+
 /*
   Since the protocol is complex and what we have to do so
   complicated, these functions are here that actually do the work of 
diff --git a/src/condor_startd.V6/startd_main.cpp b/src/condor_startd.V6/startd_main.cpp
index 0f8be91..c6f0b68 100644
--- a/src/condor_startd.V6/startd_main.cpp
+++ b/src/condor_startd.V6/startd_main.cpp
@@ -273,9 +273,6 @@ main_init( int, char* argv[] )
 								  "GIVE_TOTALS_CLASSAD",
 								  (CommandHandler)command_give_totals_classad,
 								  "command_give_totals_classad", 0, READ );
-	daemonCore->Register_Command( GIVE_REQUEST_AD, "GIVE_REQUEST_AD",
-								  (CommandHandler)command_give_request_ad,
-								  "command_give_request_ad", 0, READ );
 	daemonCore->Register_Command( QUERY_STARTD_ADS, "QUERY_STARTD_ADS",
 								  (CommandHandler)command_query_ads,
 								  "command_query_ads", 0, READ );
-- 
1.7.12.4

