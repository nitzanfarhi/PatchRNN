From b3f456a8ceefac6e9f2e9acc2ea0c159d412b595 Mon Sep 17 00:00:00 2001
From: "Fabio M. Di Nitto" <fdinitto@redhat.com>
Date: Mon, 14 Jan 2013 11:12:48 +0100
Subject: [PATCH] totemcrypto: fix hmac key initialization

Signed-off-by: Fabio M. Di Nitto <fdinitto@redhat.com>
Reviewed-by: Jan Friesse <jfriesse@redhat.com>
---
 exec/totemcrypto.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/exec/totemcrypto.c b/exec/totemcrypto.c
index 44faaaf50..90cbb248b 100644
--- a/exec/totemcrypto.c
+++ b/exec/totemcrypto.c
@@ -478,8 +478,8 @@ static int init_nss_hash(struct crypto_instance *instance)
 	}
 
 	hash_param.type = siBuffer;
-	hash_param.data = 0;
-	hash_param.len = 0;
+	hash_param.data = instance->private_key;
+	hash_param.len = instance->private_key_len;
 
 	hash_slot = PK11_GetBestSlot(hash_to_nss[instance->crypto_hash_type], NULL);
 	if (hash_slot == NULL) {
