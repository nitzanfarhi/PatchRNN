From 62a110d447bb8c16a4c69629e28a42e8c39fd7e0 Mon Sep 17 00:00:00 2001
From: jsing <jsing>
Date: Thu, 27 Nov 2014 16:07:33 +0000
Subject: [PATCH] Avoid a double-free in an error path.

Reported by Felix Groebert of the Google Security Team.

ok beck@ miod@
---
 src/ssl/d1_srtp.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/src/ssl/d1_srtp.c b/src/ssl/d1_srtp.c
index 5b12570b..98a6bd9e 100644
--- a/src/ssl/d1_srtp.c
+++ b/src/ssl/d1_srtp.c
@@ -1,4 +1,4 @@
-/* $OpenBSD: d1_srtp.c,v 1.8 2014/07/14 08:21:47 miod Exp $ */
+/* $OpenBSD: d1_srtp.c,v 1.9 2014/11/16 14:12:47 jsing Exp $ */
 /* Copyright (C) 1995-1998 Eric Young (eay@cryptsoft.com)
  * All rights reserved.
  *
@@ -355,7 +355,6 @@ ssl_parse_clienthello_use_srtp_ext(SSL *s, unsigned char *d, int len, int *al)
 		SSLerr(SSL_F_SSL_PARSE_CLIENTHELLO_USE_SRTP_EXT,
 		    SSL_R_BAD_SRTP_MKI_VALUE);
 		*al = SSL_AD_DECODE_ERROR;
-		sk_SRTP_PROTECTION_PROFILE_free(clnt);
 		goto done;
 	}
 
