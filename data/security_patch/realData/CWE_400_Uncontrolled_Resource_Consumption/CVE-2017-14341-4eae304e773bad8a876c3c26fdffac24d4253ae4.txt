From 4eae304e773bad8a876c3c26fdffac24d4253ae4 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Mon, 7 Aug 2017 15:01:02 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/654

---
 coders/wpg.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/coders/wpg.c b/coders/wpg.c
index a53c17f2cc..ecd0a71503 100644
--- a/coders/wpg.c
+++ b/coders/wpg.c
@@ -1045,6 +1045,8 @@ static Image *ReadWPGImage(const ImageInfo *image_info,
           if(i==EOF)
             break;
           Rd_WP_DWORD(image,&Rec.RecordLength);
+          if (Rec.RecordLength > GetBlobSize(image))
+            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
           if(EOFBlob(image))
             break;
 
