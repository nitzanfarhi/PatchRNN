From 3a10f6b829297dae63492a8c63385044bc6953ed Mon Sep 17 00:00:00 2001
From: Even Rouault <even.rouault@mines-paris.org>
Date: Tue, 31 Dec 2013 13:54:40 +0100
Subject: [PATCH] Fix potential SQL Injection with postgis TIME filters (#4834)

---
 mappostgis.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/mappostgis.c b/mappostgis.c
index 1f4c64eba..f24d9697a 100644
--- a/mappostgis.c
+++ b/mappostgis.c
@@ -3212,6 +3212,11 @@ int msPostGISLayerSetTimeFilter(layerObj *lp, const char *timestring, const char
   if (!lp || !timestring || !timefield)
     return MS_FALSE;
 
+  if( strchr(timestring,'\'') || strchr(timestring, '\\') ) {
+     msSetError(MS_MISCERR, "Invalid time filter.", "msPostGISLayerSetTimeFilter()");
+     return MS_FALSE;
+  }
+
   /* discrete time */
   if (strstr(timestring, ",") == NULL &&
       strstr(timestring, "/") == NULL) { /* discrete time */
