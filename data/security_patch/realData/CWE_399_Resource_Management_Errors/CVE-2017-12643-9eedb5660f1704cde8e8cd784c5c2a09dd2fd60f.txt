From 9eedb5660f1704cde8e8cd784c5c2a09dd2fd60f Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Sat, 8 Jul 2017 08:17:29 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/549

---
 coders/png.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/coders/png.c b/coders/png.c
index 2ebb6e9d8f..3445ce7882 100644
--- a/coders/png.c
+++ b/coders/png.c
@@ -4300,6 +4300,8 @@ static Image *ReadOneJNGImage(MngInfo *mng_info,
 
     if (length != 0)
       {
+        if (length > GetBlobSize(image))
+          ThrowReaderException(CorruptImageError,"InsufficientImageDataInFile");
         chunk=(unsigned char *) AcquireQuantumMemory(length+MagickPathExtent,
           sizeof(*chunk));
 
@@ -5168,6 +5170,9 @@ static Image *ReadOneMNGImage(MngInfo* mng_info, const ImageInfo *image_info,
 
         if (length != 0)
           {
+            if (length > GetBlobSize(image))
+              ThrowReaderException(CorruptImageError,
+                "InsufficientImageDataInFile");
             chunk=(unsigned char *) AcquireQuantumMemory(length+
               MagickPathExtent,sizeof(*chunk));
 
