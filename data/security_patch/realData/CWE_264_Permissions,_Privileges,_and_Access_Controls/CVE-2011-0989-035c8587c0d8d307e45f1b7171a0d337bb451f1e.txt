From 035c8587c0d8d307e45f1b7171a0d337bb451f1e Mon Sep 17 00:00:00 2001
From: Zoltan Varga <vargaz@gmail.com>
Date: Tue, 18 Jan 2011 16:41:37 +0100
Subject: [PATCH] Allow only primitive types/enums in
 RuntimeHelpers.InitializeArray ().

---
 mono/metadata/icall.c | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/mono/metadata/icall.c b/mono/metadata/icall.c
index ec2daf574447..b75791231e2a 100644
--- a/mono/metadata/icall.c
+++ b/mono/metadata/icall.c
@@ -854,12 +854,9 @@ ves_icall_System_Runtime_CompilerServices_RuntimeHelpers_InitializeArray (MonoAr
 	int align;
 	const char *field_data;
 
-	if (MONO_TYPE_IS_REFERENCE (type) ||
-			(type->type == MONO_TYPE_VALUETYPE &&
-				(!mono_type_get_class (type) ||
-				mono_type_get_class (type)->has_references))) {
+	if (MONO_TYPE_IS_REFERENCE (type) || type->type == MONO_TYPE_VALUETYPE) {
 		MonoException *exc = mono_get_exception_argument("array",
-			"Cannot initialize array containing references");
+			"Cannot initialize array of non-primitive type.");
 		mono_raise_exception (exc);
 	}
 
