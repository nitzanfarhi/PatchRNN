From ff7f30129f15f7a2213f8ced0cd65c9a331493d9 Mon Sep 17 00:00:00 2001
From: Luke Dashjr <luke-jr+git@utopios.org>
Date: Thu, 5 Jun 2014 17:10:43 +0000
Subject: [PATCH] Bugfix: initiate_stratum: Ensure extranonce2 size is not
 negative (which could lead to exploits later as too little memory gets
 allocated)

Thanks to Mick Ayzenberg <mick@dejavusecurity.com> for finding this!
---
 util.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/util.c b/util.c
index 4c8d100a84..a9dc017e7c 100644
--- a/util.c
+++ b/util.c
@@ -1705,7 +1705,8 @@ bool initiate_stratum(struct pool *pool)
 		goto out;
 	}
 	n2size = json_integer_value(json_array_get(res_val, 2));
-	if (!n2size) {
+	if (n2size < 1)
+	{
 		applog(LOG_INFO, "Failed to get n2size in initiate_stratum");
 		free(sessionid);
 		free(nonce1);
