From f5955d9f6f9ffdb81864c3de1c7b801782a55725 Mon Sep 17 00:00:00 2001
From: Michael Niedermayer <michaelni@gmx.at>
Date: Sat, 9 Feb 2013 20:49:32 +0100
Subject: [PATCH] targa: Fix y check in advance_line

Fixes out of array accesses

Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
(cherry picked from commit 796012af6c780b5b13ebca39a491f215515a18fe)

Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
---
 libavcodec/targa.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/libavcodec/targa.c b/libavcodec/targa.c
index 6bb05a93ad..321441cb08 100644
--- a/libavcodec/targa.c
+++ b/libavcodec/targa.c
@@ -40,7 +40,7 @@ static uint8_t *advance_line(uint8_t *start, uint8_t *line,
         return line + interleave * stride;
     } else {
         *y = (*y + 1) & (interleave - 1);
-        if (*y) {
+        if (*y && *y < h) {
             return start + *y * stride;
         } else {
             return NULL;
-- 
2.11.0

