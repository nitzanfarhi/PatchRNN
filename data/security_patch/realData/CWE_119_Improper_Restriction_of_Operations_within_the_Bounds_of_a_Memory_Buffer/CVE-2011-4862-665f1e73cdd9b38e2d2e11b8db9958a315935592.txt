From 665f1e73cdd9b38e2d2e11b8db9958a315935592 Mon Sep 17 00:00:00 2001
From: "Alfred M. Szmidt" <ams@gnu.org>
Date: Sun, 25 Dec 2011 13:11:52 +0100
Subject: libtelnet/encrypt.c (encrypt_keyid): Make sure that LEN never is
 greater than MAXKEYLEN.

---
 ChangeLog           | 5 +++++
 libtelnet/encrypt.c | 3 +++
 2 files changed, 8 insertions(+)

diff --git a/ChangeLog b/ChangeLog
index dd381d1..f4e4457 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,8 @@
+2011-12-25  Alfred M. Szmidt  <ams@gnu.org>
+
+	* libtelnet/encrypt.c (encrypt_keyid): Make sure that LEN never is
+	greater than MAXKEYLEN.
+
 2011-12-22  Mats Erik Andersson <gnu@gisladisker.se>
 
 	* libinetutils/setsig.c (setsig) [HAVE_SIGACTION]: Initialize
diff --git a/libtelnet/encrypt.c b/libtelnet/encrypt.c
index 06827d9..abfa6d4 100644
--- a/libtelnet/encrypt.c
+++ b/libtelnet/encrypt.c
@@ -796,6 +796,9 @@ encrypt_keyid (kp, keyid, len)
   int dir = kp->dir;
   register int ret = 0;
 
+  if (len > MAXKEYLEN)
+    len = MAXKEYLEN;
+
   if (!(ep = (*kp->getcrypt) (*kp->modep)))
     {
       if (len == 0)
-- 
cgit v1.0-41-gc330

