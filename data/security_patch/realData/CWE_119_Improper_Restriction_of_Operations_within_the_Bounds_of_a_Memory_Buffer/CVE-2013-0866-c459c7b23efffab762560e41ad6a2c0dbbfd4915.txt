From c459c7b23efffab762560e41ad6a2c0dbbfd4915 Mon Sep 17 00:00:00 2001
From: Michael Niedermayer <michaelni@gmx.at>
Date: Sun, 27 Jan 2013 20:37:27 +0100
Subject: [PATCH] aacdec: check channel count

Prevent out of array accesses

Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
(cherry picked from commit 96f452ac647dae33c53c242ef3266b65a9beafb6)

Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
---
 libavcodec/aacdec.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/libavcodec/aacdec.c b/libavcodec/aacdec.c
index 62df283b78..34cc18bda6 100644
--- a/libavcodec/aacdec.c
+++ b/libavcodec/aacdec.c
@@ -883,6 +883,11 @@ static av_cold int aac_decode_init(AVCodecContext *avctx)
         }
     }
 
+    if (avctx->channels > MAX_CHANNELS) {
+        av_log(avctx, AV_LOG_ERROR, "Too many channels\n");
+        return AVERROR_INVALIDDATA;
+    }
+
     AAC_INIT_VLC_STATIC( 0, 304);
     AAC_INIT_VLC_STATIC( 1, 270);
     AAC_INIT_VLC_STATIC( 2, 550);
-- 
2.11.0

