From 4cd1dad91ae97fe1f0dd534c3f5566787566f137 Mon Sep 17 00:00:00 2001
From: Michael Niedermayer <michaelni@gmx.at>
Date: Fri, 18 Jan 2013 01:28:44 +0100
Subject: [PATCH] avcodec_decode_audio: do not trust the channel layout, use
 the channel count.

Fixes memory corruption

Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
(cherry picked from commit d270c3202539e8364c46410e15f7570800e33343)

Conflicts:

	libavcodec/utils.c
---
 libavcodec/utils.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index 00434c9114..384d457f61 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -1744,7 +1744,7 @@ int attribute_align_arg avcodec_decode_audio4(AVCodecContext *avctx,
      * make sure it's set correctly; assume decoders that actually use
      * extended_data are doing it correctly */
     planar   = av_sample_fmt_is_planar(frame->format);
-    channels = av_get_channel_layout_nb_channels(frame->channel_layout);
+    channels = frame->channels;
     if (!(planar && channels > AV_NUM_DATA_POINTERS))
         frame->extended_data = frame->data;
 
-- 
2.11.0

