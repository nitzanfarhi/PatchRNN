From 68e48ed72e0597ae61bc3e9e6e6d9edcb1a00073 Mon Sep 17 00:00:00 2001
From: =?utf8?q?Cl=C3=A9ment=20B=C5=93sch?= <ubitux@gmail.com>
Date: Tue, 1 Jan 2013 16:41:37 +0100
Subject: [PATCH] lavc/movtextdec: keep the min size instead of max to fix
 overread.

Fixes Ticket #2087.
(cherry picked from commit 7d66bc7920240cc0e8df6c44b2d2cdbe4b228fbe)
---
 libavcodec/movtextdec.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/libavcodec/movtextdec.c b/libavcodec/movtextdec.c
index a65bbb83e3..05ff53afb4 100644
--- a/libavcodec/movtextdec.c
+++ b/libavcodec/movtextdec.c
@@ -83,7 +83,7 @@ static int mov_text_decode_frame(AVCodecContext *avctx,
      * In complex cases, there are style descriptors appended to the string
      * so we can't just assume the packet size is the string size.
      */
-    end = ptr + FFMAX(2 + AV_RB16(ptr), avpkt->size);
+    end = ptr + FFMIN(2 + AV_RB16(ptr), avpkt->size);
     ptr += 2;
 
     ts_start = av_rescale_q(avpkt->pts,
-- 
2.11.0

