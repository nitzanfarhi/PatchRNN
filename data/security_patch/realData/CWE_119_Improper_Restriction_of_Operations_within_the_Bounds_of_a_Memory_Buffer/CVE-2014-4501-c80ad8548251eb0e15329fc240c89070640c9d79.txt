From c80ad8548251eb0e15329fc240c89070640c9d79 Mon Sep 17 00:00:00 2001
From: Luke Dashjr <luke-jr+git@utopios.org>
Date: Thu, 5 Jun 2014 17:05:12 +0000
Subject: [PATCH] Stratum: extract_sockaddr: Truncate overlong addresses rather
 than stack overflow

Thanks to Mick Ayzenberg <mick@dejavusecurity.com> for finding this!
---
 util.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/util.c b/util.c
index c72773b5f8..4c8d100a84 100644
--- a/util.c
+++ b/util.c
@@ -1002,6 +1002,13 @@ bool extract_sockaddr(struct pool *pool, char *url)
 
 	if (url_len < 1)
 		return false;
+	
+	if (url_len >= sizeof(url_address))
+	{
+		applog(LOG_WARNING, "%s: Truncating overflowed address '%.*s'",
+		       __func__, url_len, url_begin);
+		url_len = sizeof(url_address) - 1;
+	}
 
 	sprintf(url_address, "%.*s", url_len, url_begin);
 
