From aeea342904978c9fe17d85f4906a0f6fcce2d315 Mon Sep 17 00:00:00 2001
From: Chris Liddell <chris.liddell@artifex.com>
Date: Mon, 12 Nov 2018 17:21:33 +0000
Subject: [PATCH] Bug 700153: restore: always check available stack

Previously, we were checking there was enough stack space available when the
restore operation required a device change, but since we have to use
Postscript to reset the userparams (ick!), we need the stack check even when
not changing the device.
---
 psi/zdevice2.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/psi/zdevice2.c b/psi/zdevice2.c
index 159a0c0..e11b075 100644
--- a/psi/zdevice2.c
+++ b/psi/zdevice2.c
@@ -277,7 +277,7 @@ restore_page_device(i_ctx_t *i_ctx_p, const gs_gstate * pgs_old, const gs_gstate
             samepagedevice = false;
     }
 
-    if (LockSafetyParams && !samepagedevice) {
+    if (LockSafetyParams) {
         const int required_ops = 512;
         const int required_es = 32;
 
-- 
2.9.1

