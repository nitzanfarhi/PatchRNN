From 8f9b304c4f6c0a98dafa61b2c0e4beb3b70e4c84 Mon Sep 17 00:00:00 2001
From: Peter MacKinnon <pmackinn@redhat.com>
Date: Fri, 28 Sep 2012 00:35:42 -0400
Subject: [PATCH] Fixed job id parse check in aviary job control ops

---
 src/condor_contrib/aviary/src/AviaryScheddPlugin.cpp |  2 +-
 src/condor_contrib/aviary/src/SchedulerObject.cpp    | 12 ++++++------
 2 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/src/condor_contrib/aviary/src/AviaryScheddPlugin.cpp b/src/condor_contrib/aviary/src/AviaryScheddPlugin.cpp
index 981a2ef..9f7325e 100644
--- a/src/condor_contrib/aviary/src/AviaryScheddPlugin.cpp
+++ b/src/condor_contrib/aviary/src/AviaryScheddPlugin.cpp
@@ -268,7 +268,7 @@ AviaryScheddPlugin::processJob(const char *key,
 //	dprintf(D_FULLDEBUG, "Processing: %s\n", key);
 
 	id = getProcByString(key);
-	if (id.cluster < 0 || id.proc < 0) {
+	if (id.cluster <= 0 || id.proc < 0) {
 		dprintf(D_FULLDEBUG, "Failed to parse key: %s - skipping\n", key);
 		return false;
 	}
diff --git a/src/condor_contrib/aviary/src/SchedulerObject.cpp b/src/condor_contrib/aviary/src/SchedulerObject.cpp
index 89d4a85..4d00667 100644
--- a/src/condor_contrib/aviary/src/SchedulerObject.cpp
+++ b/src/condor_contrib/aviary/src/SchedulerObject.cpp
@@ -263,7 +263,7 @@ SchedulerObject::setAttribute(std::string key,
 							  std::string &text)
 {
 	PROC_ID id = getProcByString(key.c_str());
-	if (id.cluster < 0 || id.proc < 0) {
+	if (id.cluster <= 0 || id.proc < 0) {
 		dprintf(D_FULLDEBUG, "SetAttribute: Failed to parse id: %s\n", key.c_str());
 		text = "Invalid Id";
 		return false;
@@ -303,7 +303,7 @@ bool
 SchedulerObject::hold(std::string key, std::string &reason, std::string &text)
 {
 	PROC_ID id = getProcByString(key.c_str());
-	if (id.cluster < 0 || id.proc < 0) {
+	if (id.cluster <= 0 || id.proc < 0) {
 		dprintf(D_FULLDEBUG, "Hold: Failed to parse id: %s\n", key.c_str());
 		text = "Invalid Id";
 		return false;
@@ -329,7 +329,7 @@ bool
 SchedulerObject::release(std::string key, std::string &reason, std::string &text)
 {
 	PROC_ID id = getProcByString(key.c_str());
-	if (id.cluster < 0 || id.proc < 0) {
+	if (id.cluster <= 0 || id.proc < 0) {
 		dprintf(D_FULLDEBUG, "Release: Failed to parse id: %s\n", key.c_str());
 		text = "Invalid Id";
 		return false;
@@ -353,7 +353,7 @@ bool
 SchedulerObject::remove(std::string key, std::string &reason, std::string &text)
 {
 	PROC_ID id = getProcByString(key.c_str());
-	if (id.cluster < 0 || id.proc < 0) {
+	if (id.cluster <= 0 || id.proc < 0) {
 		dprintf(D_FULLDEBUG, "Remove: Failed to parse id: %s\n", key.c_str());
 		text = "Invalid Id";
 		return false;
@@ -375,7 +375,7 @@ bool
 SchedulerObject::suspend(std::string key, std::string &/*reason*/, std::string &text)
 {
 	PROC_ID id = getProcByString(key.c_str());
-	if (id.cluster < 0 || id.proc < 0) {
+	if (id.cluster <= 0 || id.proc < 0) {
 		dprintf(D_FULLDEBUG, "Remove: Failed to parse id: %s\n", key.c_str());
 		text = "Invalid Id";
 		return false;
@@ -390,7 +390,7 @@ bool
 SchedulerObject::_continue(std::string key, std::string &/*reason*/, std::string &text)
 {
 	PROC_ID id = getProcByString(key.c_str());
-	if (id.cluster < 0 || id.proc < 0) {
+	if (id.cluster <= 0 || id.proc < 0) {
 		dprintf(D_FULLDEBUG, "Remove: Failed to parse id: %s\n", key.c_str());
 		text = "Invalid Id";
 		return false;
-- 
1.7.12.4

