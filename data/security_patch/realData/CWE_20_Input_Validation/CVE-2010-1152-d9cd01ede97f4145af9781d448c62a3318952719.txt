From d9cd01ede97f4145af9781d448c62a3318952719 Mon Sep 17 00:00:00 2001
From: Tomash Brechko <tomash.brechko@gmail.com>
Date: Mon, 2 Nov 2009 18:15:54 +0100
Subject: [PATCH] Use strncmp when checking for large ascii multigets.

---
 memcached.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/memcached.c b/memcached.c
index ed67eb06e..3e2e9c59e 100644
--- a/memcached.c
+++ b/memcached.c
@@ -3148,7 +3148,9 @@ static int try_read_command(conn *c) {
                     ++ptr;
                 }
 
-                if (strcmp(ptr, "get ") && strcmp(ptr, "gets ")) {
+                if (ptr - c->rcurr > 100 ||
+                    (strncmp(ptr, "get ", 4) && strncmp(ptr, "gets ", 5))) {
+
                     conn_set_state(c, conn_closing);
                     return 1;
                 }
