From 8a3257b01faa899dd9b5e35c6bb3403cd709c371 Mon Sep 17 00:00:00 2001
From: Tor Andersson <tor.andersson@artifex.com>
Date: Wed, 24 Jan 2018 14:05:09 +0100
Subject: [PATCH 1/1] Fix 698886: Don't try to load non-stream XObjects.

---
 source/pdf/pdf-interpret.c | 2 --
 source/pdf/pdf-xobject.c   | 3 +++
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/source/pdf/pdf-interpret.c b/source/pdf/pdf-interpret.c
index 6ce63eb..3aeeeae 100644
--- a/source/pdf/pdf-interpret.c
+++ b/source/pdf/pdf-interpret.c
@@ -264,8 +264,6 @@ pdf_process_extgstate(fz_context *ctx, pdf_processor *proc, pdf_csi *csi, pdf_ob
 			fz_var(xobj);
 
 			group = pdf_dict_get(ctx, obj, PDF_NAME_G);
-			if (!group)
-				fz_throw(ctx, FZ_ERROR_SYNTAX, "cannot load softmask xobject (%d 0 R)", pdf_to_num(ctx, obj));
 			xobj = pdf_load_xobject(ctx, csi->doc, group);
 
 			fz_try(ctx)
diff --git a/source/pdf/pdf-xobject.c b/source/pdf/pdf-xobject.c
index c7b03a4..38a31c4 100644
--- a/source/pdf/pdf-xobject.c
+++ b/source/pdf/pdf-xobject.c
@@ -97,6 +97,9 @@ pdf_load_xobject(fz_context *ctx, pdf_document *doc, pdf_obj *dict)
 {
 	pdf_xobject *form;
 
+	if (!pdf_is_stream(ctx, dict))
+		fz_throw(ctx, FZ_ERROR_SYNTAX, "XObject must be a stream");
+
 	if ((form = pdf_find_item(ctx, pdf_drop_xobject_imp, dict)) != NULL)
 		return form;
 
-- 
2.9.1

