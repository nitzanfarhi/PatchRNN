From 6799f2c525a584dc998821a6ce897e463dad7840 Mon Sep 17 00:00:00 2001
From: Philip Withnall <philip@tecnocode.co.uk>
Date: Thu, 8 Mar 2012 00:09:08 +0000
Subject: [PATCH] core: Validate SSL certificates for all connections

This prevents MitM attacks which use spoofed SSL certificates.

Note that this bumps our libsoup requirement to 2.37.91.

Closes: https://bugzilla.gnome.org/show_bug.cgi?id=671535
---
 configure.ac          | 2 +-
 gdata/gdata-service.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/configure.ac b/configure.ac
index a624296b..78b0c301 100644
--- a/configure.ac
+++ b/configure.ac
@@ -33,7 +33,7 @@ AC_PATH_PROG([GLIB_MKENUMS],[glib-mkenums])
 # Requirements
 GLIB_REQS=2.30.0
 GIO_REQS=2.17.3
-SOUP_REQS=2.26.1
+SOUP_REQS=2.37.91
 OAUTH_REQS=0.9.4
 GTK_REQS=2.91.2
 
diff --git a/gdata/gdata-service.c b/gdata/gdata-service.c
index 93ac8fb8..de9f020f 100644
--- a/gdata/gdata-service.c
+++ b/gdata/gdata-service.c
@@ -2134,7 +2134,7 @@ _gdata_service_get_log_level (void)
 SoupSession *
 _gdata_service_build_session (void)
 {
-	SoupSession *session = soup_session_sync_new ();
+	SoupSession *session = soup_session_sync_new_with_options (SOUP_SESSION_SSL_USE_SYSTEM_CA_FILE, TRUE, NULL);
 
 #ifdef HAVE_GNOME
 	soup_session_add_feature_by_type (session, SOUP_TYPE_GNOME_FEATURES_2_26);
-- 
2.21.0

