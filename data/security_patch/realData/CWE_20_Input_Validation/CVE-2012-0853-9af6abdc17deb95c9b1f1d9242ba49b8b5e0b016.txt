From 9af6abdc17deb95c9b1f1d9242ba49b8b5e0b016 Mon Sep 17 00:00:00 2001
From: Michael Niedermayer <michaelni@gmx.at>
Date: Sat, 17 Dec 2011 03:18:58 +0100
Subject: [PATCH] atrac3: Fix crash in tonal component decoding. Fixes
 Ticket780 Bug Found by: cosminamironesei

Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
---
 libavcodec/atrac3.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/libavcodec/atrac3.c b/libavcodec/atrac3.c
index b9f1f516cc..fcf7c925eb 100644
--- a/libavcodec/atrac3.c
+++ b/libavcodec/atrac3.c
@@ -402,6 +402,8 @@ static int decodeTonalComponents (GetBitContext *gb, tonal_component *pComponent
 
             for (k=0; k<coded_components; k++) {
                 sfIndx = get_bits(gb,6);
+                if(component_count>=64)
+                    return AVERROR_INVALIDDATA;
                 pComponent[component_count].pos = j * 64 + (get_bits(gb,6));
                 max_coded_values = SAMPLES_PER_FRAME - pComponent[component_count].pos;
                 coded_values = coded_values_per_component + 1;
-- 
2.11.0

