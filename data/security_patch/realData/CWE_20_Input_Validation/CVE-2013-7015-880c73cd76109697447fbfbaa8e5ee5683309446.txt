From 880c73cd76109697447fbfbaa8e5ee5683309446 Mon Sep 17 00:00:00 2001
From: Michael Niedermayer <michaelni@gmx.at>
Date: Tue, 20 Aug 2013 23:18:48 +0200
Subject: [PATCH] avcodec/flashsv: check diff_start/height

Fixes out of array accesses
Fixes Ticket2844

Found-by: ami_stuff
Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
---
 libavcodec/flashsv.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/libavcodec/flashsv.c b/libavcodec/flashsv.c
index 9982b5e9663..f00bf21d472 100644
--- a/libavcodec/flashsv.c
+++ b/libavcodec/flashsv.c
@@ -387,6 +387,10 @@ static int flashsv_decode_frame(AVCodecContext *avctx, void *data,
                     }
                     s->diff_start  = get_bits(&gb, 8);
                     s->diff_height = get_bits(&gb, 8);
+                    if (s->diff_start + s->diff_height > cur_blk_height) {
+                        av_log(avctx, AV_LOG_ERROR, "Block parameters invalid\n");
+                        return AVERROR_INVALIDDATA;
+                    }
                     av_log(avctx, AV_LOG_DEBUG,
                            "%dx%d diff start %d height %d\n",
                            i, j, s->diff_start, s->diff_height);
